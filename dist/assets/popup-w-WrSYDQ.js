(function polyfill() {
  const relList = document.createElement("link").relList;
  if (relList && relList.supports && relList.supports("modulepreload")) {
    return;
  }
  for (const link of document.querySelectorAll('link[rel="modulepreload"]')) {
    processPreload(link);
  }
  new MutationObserver((mutations) => {
    for (const mutation of mutations) {
      if (mutation.type !== "childList") {
        continue;
      }
      for (const node of mutation.addedNodes) {
        if (node.tagName === "LINK" && node.rel === "modulepreload")
          processPreload(node);
      }
    }
  }).observe(document, { childList: true, subtree: true });
  function getFetchOpts(link) {
    const fetchOpts = {};
    if (link.integrity) fetchOpts.integrity = link.integrity;
    if (link.referrerPolicy) fetchOpts.referrerPolicy = link.referrerPolicy;
    if (link.crossOrigin === "use-credentials")
      fetchOpts.credentials = "include";
    else if (link.crossOrigin === "anonymous") fetchOpts.credentials = "omit";
    else fetchOpts.credentials = "same-origin";
    return fetchOpts;
  }
  function processPreload(link) {
    if (link.ep)
      return;
    link.ep = true;
    const fetchOpts = getFetchOpts(link);
    fetch(link.href, fetchOpts);
  }
})();
const scriptRel = "modulepreload";
const assetsURL = function(dep) {
  return "/" + dep;
};
const seen = {};
const __vitePreload = function preload(baseModule, deps, importerUrl) {
  let promise = Promise.resolve();
  if (deps && deps.length > 0) {
    document.getElementsByTagName("link");
    const cspNonceMeta = document.querySelector(
      "meta[property=csp-nonce]"
    );
    const cspNonce = (cspNonceMeta == null ? void 0 : cspNonceMeta.nonce) || (cspNonceMeta == null ? void 0 : cspNonceMeta.getAttribute("nonce"));
    promise = Promise.allSettled(
      deps.map((dep) => {
        dep = assetsURL(dep);
        if (dep in seen) return;
        seen[dep] = true;
        const isCss = dep.endsWith(".css");
        const cssSelector = isCss ? '[rel="stylesheet"]' : "";
        if (document.querySelector(`link[href="${dep}"]${cssSelector}`)) {
          return;
        }
        const link = document.createElement("link");
        link.rel = isCss ? "stylesheet" : scriptRel;
        if (!isCss) {
          link.as = "script";
        }
        link.crossOrigin = "";
        link.href = dep;
        if (cspNonce) {
          link.setAttribute("nonce", cspNonce);
        }
        document.head.appendChild(link);
        if (isCss) {
          return new Promise((res, rej) => {
            link.addEventListener("load", res);
            link.addEventListener(
              "error",
              () => rej(new Error(`Unable to preload CSS for ${dep}`))
            );
          });
        }
      })
    );
  }
  function handlePreloadError(err) {
    const e = new Event("vite:preloadError", {
      cancelable: true
    });
    e.payload = err;
    window.dispatchEvent(e);
    if (!e.defaultPrevented) {
      throw err;
    }
  }
  return promise.then((res) => {
    for (const item of res || []) {
      if (item.status !== "rejected") continue;
      handlePreloadError(item.reason);
    }
    return baseModule().catch(handlePreloadError);
  });
};
var define_process_env_default = {};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const stringToByteArray$1 = function(str) {
  const out = [];
  let p = 0;
  for (let i = 0; i < str.length; i++) {
    let c = str.charCodeAt(i);
    if (c < 128) {
      out[p++] = c;
    } else if (c < 2048) {
      out[p++] = c >> 6 | 192;
      out[p++] = c & 63 | 128;
    } else if ((c & 64512) === 55296 && i + 1 < str.length && (str.charCodeAt(i + 1) & 64512) === 56320) {
      c = 65536 + ((c & 1023) << 10) + (str.charCodeAt(++i) & 1023);
      out[p++] = c >> 18 | 240;
      out[p++] = c >> 12 & 63 | 128;
      out[p++] = c >> 6 & 63 | 128;
      out[p++] = c & 63 | 128;
    } else {
      out[p++] = c >> 12 | 224;
      out[p++] = c >> 6 & 63 | 128;
      out[p++] = c & 63 | 128;
    }
  }
  return out;
};
const byteArrayToString = function(bytes) {
  const out = [];
  let pos = 0, c = 0;
  while (pos < bytes.length) {
    const c1 = bytes[pos++];
    if (c1 < 128) {
      out[c++] = String.fromCharCode(c1);
    } else if (c1 > 191 && c1 < 224) {
      const c2 = bytes[pos++];
      out[c++] = String.fromCharCode((c1 & 31) << 6 | c2 & 63);
    } else if (c1 > 239 && c1 < 365) {
      const c2 = bytes[pos++];
      const c3 = bytes[pos++];
      const c4 = bytes[pos++];
      const u = ((c1 & 7) << 18 | (c2 & 63) << 12 | (c3 & 63) << 6 | c4 & 63) - 65536;
      out[c++] = String.fromCharCode(55296 + (u >> 10));
      out[c++] = String.fromCharCode(56320 + (u & 1023));
    } else {
      const c2 = bytes[pos++];
      const c3 = bytes[pos++];
      out[c++] = String.fromCharCode((c1 & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
    }
  }
  return out.join("");
};
const base64 = {
  /**
   * Maps bytes to characters.
   */
  byteToCharMap_: null,
  /**
   * Maps characters to bytes.
   */
  charToByteMap_: null,
  /**
   * Maps bytes to websafe characters.
   * @private
   */
  byteToCharMapWebSafe_: null,
  /**
   * Maps websafe characters to bytes.
   * @private
   */
  charToByteMapWebSafe_: null,
  /**
   * Our default alphabet, shared between
   * ENCODED_VALS and ENCODED_VALS_WEBSAFE
   */
  ENCODED_VALS_BASE: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
  /**
   * Our default alphabet. Value 64 (=) is special; it means "nothing."
   */
  get ENCODED_VALS() {
    return this.ENCODED_VALS_BASE + "+/=";
  },
  /**
   * Our websafe alphabet.
   */
  get ENCODED_VALS_WEBSAFE() {
    return this.ENCODED_VALS_BASE + "-_.";
  },
  /**
   * Whether this browser supports the atob and btoa functions. This extension
   * started at Mozilla but is now implemented by many browsers. We use the
   * ASSUME_* variables to avoid pulling in the full useragent detection library
   * but still allowing the standard per-browser compilations.
   *
   */
  HAS_NATIVE_SUPPORT: typeof atob === "function",
  /**
   * Base64-encode an array of bytes.
   *
   * @param input An array of bytes (numbers with
   *     value in [0, 255]) to encode.
   * @param webSafe Boolean indicating we should use the
   *     alternative alphabet.
   * @return The base64 encoded string.
   */
  encodeByteArray(input, webSafe) {
    if (!Array.isArray(input)) {
      throw Error("encodeByteArray takes an array as a parameter");
    }
    this.init_();
    const byteToCharMap = webSafe ? this.byteToCharMapWebSafe_ : this.byteToCharMap_;
    const output = [];
    for (let i = 0; i < input.length; i += 3) {
      const byte1 = input[i];
      const haveByte2 = i + 1 < input.length;
      const byte2 = haveByte2 ? input[i + 1] : 0;
      const haveByte3 = i + 2 < input.length;
      const byte3 = haveByte3 ? input[i + 2] : 0;
      const outByte1 = byte1 >> 2;
      const outByte2 = (byte1 & 3) << 4 | byte2 >> 4;
      let outByte3 = (byte2 & 15) << 2 | byte3 >> 6;
      let outByte4 = byte3 & 63;
      if (!haveByte3) {
        outByte4 = 64;
        if (!haveByte2) {
          outByte3 = 64;
        }
      }
      output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);
    }
    return output.join("");
  },
  /**
   * Base64-encode a string.
   *
   * @param input A string to encode.
   * @param webSafe If true, we should use the
   *     alternative alphabet.
   * @return The base64 encoded string.
   */
  encodeString(input, webSafe) {
    if (this.HAS_NATIVE_SUPPORT && !webSafe) {
      return btoa(input);
    }
    return this.encodeByteArray(stringToByteArray$1(input), webSafe);
  },
  /**
   * Base64-decode a string.
   *
   * @param input to decode.
   * @param webSafe True if we should use the
   *     alternative alphabet.
   * @return string representing the decoded value.
   */
  decodeString(input, webSafe) {
    if (this.HAS_NATIVE_SUPPORT && !webSafe) {
      return atob(input);
    }
    return byteArrayToString(this.decodeStringToByteArray(input, webSafe));
  },
  /**
   * Base64-decode a string.
   *
   * In base-64 decoding, groups of four characters are converted into three
   * bytes.  If the encoder did not apply padding, the input length may not
   * be a multiple of 4.
   *
   * In this case, the last group will have fewer than 4 characters, and
   * padding will be inferred.  If the group has one or two characters, it decodes
   * to one byte.  If the group has three characters, it decodes to two bytes.
   *
   * @param input Input to decode.
   * @param webSafe True if we should use the web-safe alphabet.
   * @return bytes representing the decoded value.
   */
  decodeStringToByteArray(input, webSafe) {
    this.init_();
    const charToByteMap = webSafe ? this.charToByteMapWebSafe_ : this.charToByteMap_;
    const output = [];
    for (let i = 0; i < input.length; ) {
      const byte1 = charToByteMap[input.charAt(i++)];
      const haveByte2 = i < input.length;
      const byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;
      ++i;
      const haveByte3 = i < input.length;
      const byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;
      ++i;
      const haveByte4 = i < input.length;
      const byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;
      ++i;
      if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {
        throw new DecodeBase64StringError();
      }
      const outByte1 = byte1 << 2 | byte2 >> 4;
      output.push(outByte1);
      if (byte3 !== 64) {
        const outByte2 = byte2 << 4 & 240 | byte3 >> 2;
        output.push(outByte2);
        if (byte4 !== 64) {
          const outByte3 = byte3 << 6 & 192 | byte4;
          output.push(outByte3);
        }
      }
    }
    return output;
  },
  /**
   * Lazy static initialization function. Called before
   * accessing any of the static map variables.
   * @private
   */
  init_() {
    if (!this.byteToCharMap_) {
      this.byteToCharMap_ = {};
      this.charToByteMap_ = {};
      this.byteToCharMapWebSafe_ = {};
      this.charToByteMapWebSafe_ = {};
      for (let i = 0; i < this.ENCODED_VALS.length; i++) {
        this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);
        this.charToByteMap_[this.byteToCharMap_[i]] = i;
        this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);
        this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;
        if (i >= this.ENCODED_VALS_BASE.length) {
          this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;
          this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;
        }
      }
    }
  }
};
class DecodeBase64StringError extends Error {
  constructor() {
    super(...arguments);
    this.name = "DecodeBase64StringError";
  }
}
const base64Encode = function(str) {
  const utf8Bytes = stringToByteArray$1(str);
  return base64.encodeByteArray(utf8Bytes, true);
};
const base64urlEncodeWithoutPadding = function(str) {
  return base64Encode(str).replace(/\./g, "");
};
const base64Decode = function(str) {
  try {
    return base64.decodeString(str, true);
  } catch (e) {
    console.error("base64Decode failed: ", e);
  }
  return null;
};
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function getGlobal() {
  if (typeof self !== "undefined") {
    return self;
  }
  if (typeof window !== "undefined") {
    return window;
  }
  if (typeof global !== "undefined") {
    return global;
  }
  throw new Error("Unable to locate global object.");
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const getDefaultsFromGlobal = () => getGlobal().__FIREBASE_DEFAULTS__;
const getDefaultsFromEnvVariable = () => {
  if (typeof process === "undefined" || typeof define_process_env_default === "undefined") {
    return;
  }
  const defaultsJsonString = define_process_env_default.__FIREBASE_DEFAULTS__;
  if (defaultsJsonString) {
    return JSON.parse(defaultsJsonString);
  }
};
const getDefaultsFromCookie = () => {
  if (typeof document === "undefined") {
    return;
  }
  let match;
  try {
    match = document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/);
  } catch (e) {
    return;
  }
  const decoded = match && base64Decode(match[1]);
  return decoded && JSON.parse(decoded);
};
const getDefaults = () => {
  try {
    return getDefaultsFromGlobal() || getDefaultsFromEnvVariable() || getDefaultsFromCookie();
  } catch (e) {
    console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);
    return;
  }
};
const getDefaultEmulatorHost = (productName) => {
  var _a, _b;
  return (_b = (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.emulatorHosts) === null || _b === void 0 ? void 0 : _b[productName];
};
const getDefaultEmulatorHostnameAndPort = (productName) => {
  const host = getDefaultEmulatorHost(productName);
  if (!host) {
    return void 0;
  }
  const separatorIndex = host.lastIndexOf(":");
  if (separatorIndex <= 0 || separatorIndex + 1 === host.length) {
    throw new Error(`Invalid host ${host} with no separate hostname and port!`);
  }
  const port = parseInt(host.substring(separatorIndex + 1), 10);
  if (host[0] === "[") {
    return [host.substring(1, separatorIndex - 1), port];
  } else {
    return [host.substring(0, separatorIndex), port];
  }
};
const getDefaultAppConfig = () => {
  var _a;
  return (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.config;
};
const getExperimentalSetting = (name2) => {
  var _a;
  return (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a[`_${name2}`];
};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Deferred {
  constructor() {
    this.reject = () => {
    };
    this.resolve = () => {
    };
    this.promise = new Promise((resolve, reject) => {
      this.resolve = resolve;
      this.reject = reject;
    });
  }
  /**
   * Our API internals are not promisified and cannot because our callback APIs have subtle expectations around
   * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback
   * and returns a node-style callback which will resolve or reject the Deferred's promise.
   */
  wrapCallback(callback) {
    return (error, value) => {
      if (error) {
        this.reject(error);
      } else {
        this.resolve(value);
      }
      if (typeof callback === "function") {
        this.promise.catch(() => {
        });
        if (callback.length === 1) {
          callback(error);
        } else {
          callback(error, value);
        }
      }
    };
  }
}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function createMockUserToken(token, projectId) {
  if (token.uid) {
    throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');
  }
  const header = {
    alg: "none",
    type: "JWT"
  };
  const project = projectId || "demo-project";
  const iat = token.iat || 0;
  const sub = token.sub || token.user_id;
  if (!sub) {
    throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");
  }
  const payload = Object.assign({
    // Set all required fields to decent defaults
    iss: `https://securetoken.google.com/${project}`,
    aud: project,
    iat,
    exp: iat + 3600,
    auth_time: iat,
    sub,
    user_id: sub,
    firebase: {
      sign_in_provider: "custom",
      identities: {}
    }
  }, token);
  const signature = "";
  return [
    base64urlEncodeWithoutPadding(JSON.stringify(header)),
    base64urlEncodeWithoutPadding(JSON.stringify(payload)),
    signature
  ].join(".");
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function getUA() {
  if (typeof navigator !== "undefined" && typeof navigator["userAgent"] === "string") {
    return navigator["userAgent"];
  } else {
    return "";
  }
}
function isMobileCordova() {
  return typeof window !== "undefined" && // @ts-ignore Setting up an broadly applicable index signature for Window
  // just to deal with this case would probably be a bad idea.
  !!(window["cordova"] || window["phonegap"] || window["PhoneGap"]) && /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA());
}
function isNode() {
  var _a;
  const forceEnvironment = (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.forceEnvironment;
  if (forceEnvironment === "node") {
    return true;
  } else if (forceEnvironment === "browser") {
    return false;
  }
  try {
    return Object.prototype.toString.call(global.process) === "[object process]";
  } catch (e) {
    return false;
  }
}
function isCloudflareWorker() {
  return typeof navigator !== "undefined" && navigator.userAgent === "Cloudflare-Workers";
}
function isBrowserExtension() {
  const runtime = typeof chrome === "object" ? chrome.runtime : typeof browser === "object" ? browser.runtime : void 0;
  return typeof runtime === "object" && runtime.id !== void 0;
}
function isReactNative() {
  return typeof navigator === "object" && navigator["product"] === "ReactNative";
}
function isIE() {
  const ua = getUA();
  return ua.indexOf("MSIE ") >= 0 || ua.indexOf("Trident/") >= 0;
}
function isSafari() {
  return !isNode() && !!navigator.userAgent && navigator.userAgent.includes("Safari") && !navigator.userAgent.includes("Chrome");
}
function isIndexedDBAvailable() {
  try {
    return typeof indexedDB === "object";
  } catch (e) {
    return false;
  }
}
function validateIndexedDBOpenable() {
  return new Promise((resolve, reject) => {
    try {
      let preExist = true;
      const DB_CHECK_NAME = "validate-browser-context-for-indexeddb-analytics-module";
      const request = self.indexedDB.open(DB_CHECK_NAME);
      request.onsuccess = () => {
        request.result.close();
        if (!preExist) {
          self.indexedDB.deleteDatabase(DB_CHECK_NAME);
        }
        resolve(true);
      };
      request.onupgradeneeded = () => {
        preExist = false;
      };
      request.onerror = () => {
        var _a;
        reject(((_a = request.error) === null || _a === void 0 ? void 0 : _a.message) || "");
      };
    } catch (error) {
      reject(error);
    }
  });
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ERROR_NAME = "FirebaseError";
class FirebaseError extends Error {
  constructor(code, message, customData) {
    super(message);
    this.code = code;
    this.customData = customData;
    this.name = ERROR_NAME;
    Object.setPrototypeOf(this, FirebaseError.prototype);
    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, ErrorFactory.prototype.create);
    }
  }
}
class ErrorFactory {
  constructor(service, serviceName, errors) {
    this.service = service;
    this.serviceName = serviceName;
    this.errors = errors;
  }
  create(code, ...data) {
    const customData = data[0] || {};
    const fullCode = `${this.service}/${code}`;
    const template = this.errors[code];
    const message = template ? replaceTemplate(template, customData) : "Error";
    const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;
    const error = new FirebaseError(fullCode, fullMessage, customData);
    return error;
  }
}
function replaceTemplate(template, data) {
  return template.replace(PATTERN, (_, key) => {
    const value = data[key];
    return value != null ? String(value) : `<${key}?>`;
  });
}
const PATTERN = /\{\$([^}]+)}/g;
function isEmpty$1(obj) {
  for (const key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      return false;
    }
  }
  return true;
}
function deepEqual(a, b2) {
  if (a === b2) {
    return true;
  }
  const aKeys = Object.keys(a);
  const bKeys = Object.keys(b2);
  for (const k of aKeys) {
    if (!bKeys.includes(k)) {
      return false;
    }
    const aProp = a[k];
    const bProp = b2[k];
    if (isObject(aProp) && isObject(bProp)) {
      if (!deepEqual(aProp, bProp)) {
        return false;
      }
    } else if (aProp !== bProp) {
      return false;
    }
  }
  for (const k of bKeys) {
    if (!aKeys.includes(k)) {
      return false;
    }
  }
  return true;
}
function isObject(thing) {
  return thing !== null && typeof thing === "object";
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function querystring(querystringParams) {
  const params = [];
  for (const [key, value] of Object.entries(querystringParams)) {
    if (Array.isArray(value)) {
      value.forEach((arrayVal) => {
        params.push(encodeURIComponent(key) + "=" + encodeURIComponent(arrayVal));
      });
    } else {
      params.push(encodeURIComponent(key) + "=" + encodeURIComponent(value));
    }
  }
  return params.length ? "&" + params.join("&") : "";
}
function querystringDecode(querystring2) {
  const obj = {};
  const tokens = querystring2.replace(/^\?/, "").split("&");
  tokens.forEach((token) => {
    if (token) {
      const [key, value] = token.split("=");
      obj[decodeURIComponent(key)] = decodeURIComponent(value);
    }
  });
  return obj;
}
function extractQuerystring(url) {
  const queryStart = url.indexOf("?");
  if (!queryStart) {
    return "";
  }
  const fragmentStart = url.indexOf("#", queryStart);
  return url.substring(queryStart, fragmentStart > 0 ? fragmentStart : void 0);
}
function createSubscribe(executor, onNoObservers) {
  const proxy = new ObserverProxy(executor, onNoObservers);
  return proxy.subscribe.bind(proxy);
}
class ObserverProxy {
  /**
   * @param executor Function which can make calls to a single Observer
   *     as a proxy.
   * @param onNoObservers Callback when count of Observers goes to zero.
   */
  constructor(executor, onNoObservers) {
    this.observers = [];
    this.unsubscribes = [];
    this.observerCount = 0;
    this.task = Promise.resolve();
    this.finalized = false;
    this.onNoObservers = onNoObservers;
    this.task.then(() => {
      executor(this);
    }).catch((e) => {
      this.error(e);
    });
  }
  next(value) {
    this.forEachObserver((observer) => {
      observer.next(value);
    });
  }
  error(error) {
    this.forEachObserver((observer) => {
      observer.error(error);
    });
    this.close(error);
  }
  complete() {
    this.forEachObserver((observer) => {
      observer.complete();
    });
    this.close();
  }
  /**
   * Subscribe function that can be used to add an Observer to the fan-out list.
   *
   * - We require that no event is sent to a subscriber synchronously to their
   *   call to subscribe().
   */
  subscribe(nextOrObserver, error, complete) {
    let observer;
    if (nextOrObserver === void 0 && error === void 0 && complete === void 0) {
      throw new Error("Missing Observer.");
    }
    if (implementsAnyMethods(nextOrObserver, [
      "next",
      "error",
      "complete"
    ])) {
      observer = nextOrObserver;
    } else {
      observer = {
        next: nextOrObserver,
        error,
        complete
      };
    }
    if (observer.next === void 0) {
      observer.next = noop;
    }
    if (observer.error === void 0) {
      observer.error = noop;
    }
    if (observer.complete === void 0) {
      observer.complete = noop;
    }
    const unsub = this.unsubscribeOne.bind(this, this.observers.length);
    if (this.finalized) {
      this.task.then(() => {
        try {
          if (this.finalError) {
            observer.error(this.finalError);
          } else {
            observer.complete();
          }
        } catch (e) {
        }
        return;
      });
    }
    this.observers.push(observer);
    return unsub;
  }
  // Unsubscribe is synchronous - we guarantee that no events are sent to
  // any unsubscribed Observer.
  unsubscribeOne(i) {
    if (this.observers === void 0 || this.observers[i] === void 0) {
      return;
    }
    delete this.observers[i];
    this.observerCount -= 1;
    if (this.observerCount === 0 && this.onNoObservers !== void 0) {
      this.onNoObservers(this);
    }
  }
  forEachObserver(fn) {
    if (this.finalized) {
      return;
    }
    for (let i = 0; i < this.observers.length; i++) {
      this.sendOne(i, fn);
    }
  }
  // Call the Observer via one of it's callback function. We are careful to
  // confirm that the observe has not been unsubscribed since this asynchronous
  // function had been queued.
  sendOne(i, fn) {
    this.task.then(() => {
      if (this.observers !== void 0 && this.observers[i] !== void 0) {
        try {
          fn(this.observers[i]);
        } catch (e) {
          if (typeof console !== "undefined" && console.error) {
            console.error(e);
          }
        }
      }
    });
  }
  close(err) {
    if (this.finalized) {
      return;
    }
    this.finalized = true;
    if (err !== void 0) {
      this.finalError = err;
    }
    this.task.then(() => {
      this.observers = void 0;
      this.onNoObservers = void 0;
    });
  }
}
function implementsAnyMethods(obj, methods) {
  if (typeof obj !== "object" || obj === null) {
    return false;
  }
  for (const method of methods) {
    if (method in obj && typeof obj[method] === "function") {
      return true;
    }
  }
  return false;
}
function noop() {
}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function getModularInstance(service) {
  if (service && service._delegate) {
    return service._delegate;
  } else {
    return service;
  }
}
class Component {
  /**
   *
   * @param name The public service name, e.g. app, auth, firestore, database
   * @param instanceFactory Service factory responsible for creating the public interface
   * @param type whether the service provided by the component is public or private
   */
  constructor(name2, instanceFactory, type) {
    this.name = name2;
    this.instanceFactory = instanceFactory;
    this.type = type;
    this.multipleInstances = false;
    this.serviceProps = {};
    this.instantiationMode = "LAZY";
    this.onInstanceCreated = null;
  }
  setInstantiationMode(mode) {
    this.instantiationMode = mode;
    return this;
  }
  setMultipleInstances(multipleInstances) {
    this.multipleInstances = multipleInstances;
    return this;
  }
  setServiceProps(props) {
    this.serviceProps = props;
    return this;
  }
  setInstanceCreatedCallback(callback) {
    this.onInstanceCreated = callback;
    return this;
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const DEFAULT_ENTRY_NAME$1 = "[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Provider {
  constructor(name2, container) {
    this.name = name2;
    this.container = container;
    this.component = null;
    this.instances = /* @__PURE__ */ new Map();
    this.instancesDeferred = /* @__PURE__ */ new Map();
    this.instancesOptions = /* @__PURE__ */ new Map();
    this.onInitCallbacks = /* @__PURE__ */ new Map();
  }
  /**
   * @param identifier A provider can provide multiple instances of a service
   * if this.component.multipleInstances is true.
   */
  get(identifier) {
    const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);
    if (!this.instancesDeferred.has(normalizedIdentifier)) {
      const deferred = new Deferred();
      this.instancesDeferred.set(normalizedIdentifier, deferred);
      if (this.isInitialized(normalizedIdentifier) || this.shouldAutoInitialize()) {
        try {
          const instance = this.getOrInitializeService({
            instanceIdentifier: normalizedIdentifier
          });
          if (instance) {
            deferred.resolve(instance);
          }
        } catch (e) {
        }
      }
    }
    return this.instancesDeferred.get(normalizedIdentifier).promise;
  }
  getImmediate(options) {
    var _a;
    const normalizedIdentifier = this.normalizeInstanceIdentifier(options === null || options === void 0 ? void 0 : options.identifier);
    const optional = (_a = options === null || options === void 0 ? void 0 : options.optional) !== null && _a !== void 0 ? _a : false;
    if (this.isInitialized(normalizedIdentifier) || this.shouldAutoInitialize()) {
      try {
        return this.getOrInitializeService({
          instanceIdentifier: normalizedIdentifier
        });
      } catch (e) {
        if (optional) {
          return null;
        } else {
          throw e;
        }
      }
    } else {
      if (optional) {
        return null;
      } else {
        throw Error(`Service ${this.name} is not available`);
      }
    }
  }
  getComponent() {
    return this.component;
  }
  setComponent(component) {
    if (component.name !== this.name) {
      throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);
    }
    if (this.component) {
      throw Error(`Component for ${this.name} has already been provided`);
    }
    this.component = component;
    if (!this.shouldAutoInitialize()) {
      return;
    }
    if (isComponentEager(component)) {
      try {
        this.getOrInitializeService({ instanceIdentifier: DEFAULT_ENTRY_NAME$1 });
      } catch (e) {
      }
    }
    for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {
      const normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);
      try {
        const instance = this.getOrInitializeService({
          instanceIdentifier: normalizedIdentifier
        });
        instanceDeferred.resolve(instance);
      } catch (e) {
      }
    }
  }
  clearInstance(identifier = DEFAULT_ENTRY_NAME$1) {
    this.instancesDeferred.delete(identifier);
    this.instancesOptions.delete(identifier);
    this.instances.delete(identifier);
  }
  // app.delete() will call this method on every provider to delete the services
  // TODO: should we mark the provider as deleted?
  async delete() {
    const services = Array.from(this.instances.values());
    await Promise.all([
      ...services.filter((service) => "INTERNAL" in service).map((service) => service.INTERNAL.delete()),
      ...services.filter((service) => "_delete" in service).map((service) => service._delete())
    ]);
  }
  isComponentSet() {
    return this.component != null;
  }
  isInitialized(identifier = DEFAULT_ENTRY_NAME$1) {
    return this.instances.has(identifier);
  }
  getOptions(identifier = DEFAULT_ENTRY_NAME$1) {
    return this.instancesOptions.get(identifier) || {};
  }
  initialize(opts = {}) {
    const { options = {} } = opts;
    const normalizedIdentifier = this.normalizeInstanceIdentifier(opts.instanceIdentifier);
    if (this.isInitialized(normalizedIdentifier)) {
      throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);
    }
    if (!this.isComponentSet()) {
      throw Error(`Component ${this.name} has not been registered yet`);
    }
    const instance = this.getOrInitializeService({
      instanceIdentifier: normalizedIdentifier,
      options
    });
    for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {
      const normalizedDeferredIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);
      if (normalizedIdentifier === normalizedDeferredIdentifier) {
        instanceDeferred.resolve(instance);
      }
    }
    return instance;
  }
  /**
   *
   * @param callback - a function that will be invoked  after the provider has been initialized by calling provider.initialize().
   * The function is invoked SYNCHRONOUSLY, so it should not execute any longrunning tasks in order to not block the program.
   *
   * @param identifier An optional instance identifier
   * @returns a function to unregister the callback
   */
  onInit(callback, identifier) {
    var _a;
    const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);
    const existingCallbacks = (_a = this.onInitCallbacks.get(normalizedIdentifier)) !== null && _a !== void 0 ? _a : /* @__PURE__ */ new Set();
    existingCallbacks.add(callback);
    this.onInitCallbacks.set(normalizedIdentifier, existingCallbacks);
    const existingInstance = this.instances.get(normalizedIdentifier);
    if (existingInstance) {
      callback(existingInstance, normalizedIdentifier);
    }
    return () => {
      existingCallbacks.delete(callback);
    };
  }
  /**
   * Invoke onInit callbacks synchronously
   * @param instance the service instance`
   */
  invokeOnInitCallbacks(instance, identifier) {
    const callbacks = this.onInitCallbacks.get(identifier);
    if (!callbacks) {
      return;
    }
    for (const callback of callbacks) {
      try {
        callback(instance, identifier);
      } catch (_a) {
      }
    }
  }
  getOrInitializeService({ instanceIdentifier, options = {} }) {
    let instance = this.instances.get(instanceIdentifier);
    if (!instance && this.component) {
      instance = this.component.instanceFactory(this.container, {
        instanceIdentifier: normalizeIdentifierForFactory(instanceIdentifier),
        options
      });
      this.instances.set(instanceIdentifier, instance);
      this.instancesOptions.set(instanceIdentifier, options);
      this.invokeOnInitCallbacks(instance, instanceIdentifier);
      if (this.component.onInstanceCreated) {
        try {
          this.component.onInstanceCreated(this.container, instanceIdentifier, instance);
        } catch (_a) {
        }
      }
    }
    return instance || null;
  }
  normalizeInstanceIdentifier(identifier = DEFAULT_ENTRY_NAME$1) {
    if (this.component) {
      return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME$1;
    } else {
      return identifier;
    }
  }
  shouldAutoInitialize() {
    return !!this.component && this.component.instantiationMode !== "EXPLICIT";
  }
}
function normalizeIdentifierForFactory(identifier) {
  return identifier === DEFAULT_ENTRY_NAME$1 ? void 0 : identifier;
}
function isComponentEager(component) {
  return component.instantiationMode === "EAGER";
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ComponentContainer {
  constructor(name2) {
    this.name = name2;
    this.providers = /* @__PURE__ */ new Map();
  }
  /**
   *
   * @param component Component being added
   * @param overwrite When a component with the same name has already been registered,
   * if overwrite is true: overwrite the existing component with the new component and create a new
   * provider with the new component. It can be useful in tests where you want to use different mocks
   * for different tests.
   * if overwrite is false: throw an exception
   */
  addComponent(component) {
    const provider = this.getProvider(component.name);
    if (provider.isComponentSet()) {
      throw new Error(`Component ${component.name} has already been registered with ${this.name}`);
    }
    provider.setComponent(component);
  }
  addOrOverwriteComponent(component) {
    const provider = this.getProvider(component.name);
    if (provider.isComponentSet()) {
      this.providers.delete(component.name);
    }
    this.addComponent(component);
  }
  /**
   * getProvider provides a type safe interface where it can only be called with a field name
   * present in NameServiceMapping interface.
   *
   * Firebase SDKs providing services should extend NameServiceMapping interface to register
   * themselves.
   */
  getProvider(name2) {
    if (this.providers.has(name2)) {
      return this.providers.get(name2);
    }
    const provider = new Provider(name2, this);
    this.providers.set(name2, provider);
    return provider;
  }
  getProviders() {
    return Array.from(this.providers.values());
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var LogLevel;
(function(LogLevel2) {
  LogLevel2[LogLevel2["DEBUG"] = 0] = "DEBUG";
  LogLevel2[LogLevel2["VERBOSE"] = 1] = "VERBOSE";
  LogLevel2[LogLevel2["INFO"] = 2] = "INFO";
  LogLevel2[LogLevel2["WARN"] = 3] = "WARN";
  LogLevel2[LogLevel2["ERROR"] = 4] = "ERROR";
  LogLevel2[LogLevel2["SILENT"] = 5] = "SILENT";
})(LogLevel || (LogLevel = {}));
const levelStringToEnum = {
  "debug": LogLevel.DEBUG,
  "verbose": LogLevel.VERBOSE,
  "info": LogLevel.INFO,
  "warn": LogLevel.WARN,
  "error": LogLevel.ERROR,
  "silent": LogLevel.SILENT
};
const defaultLogLevel = LogLevel.INFO;
const ConsoleMethod = {
  [LogLevel.DEBUG]: "log",
  [LogLevel.VERBOSE]: "log",
  [LogLevel.INFO]: "info",
  [LogLevel.WARN]: "warn",
  [LogLevel.ERROR]: "error"
};
const defaultLogHandler = (instance, logType, ...args) => {
  if (logType < instance.logLevel) {
    return;
  }
  const now = (/* @__PURE__ */ new Date()).toISOString();
  const method = ConsoleMethod[logType];
  if (method) {
    console[method](`[${now}]  ${instance.name}:`, ...args);
  } else {
    throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);
  }
};
class Logger {
  /**
   * Gives you an instance of a Logger to capture messages according to
   * Firebase's logging scheme.
   *
   * @param name The name that the logs will be associated with
   */
  constructor(name2) {
    this.name = name2;
    this._logLevel = defaultLogLevel;
    this._logHandler = defaultLogHandler;
    this._userLogHandler = null;
  }
  get logLevel() {
    return this._logLevel;
  }
  set logLevel(val) {
    if (!(val in LogLevel)) {
      throw new TypeError(`Invalid value "${val}" assigned to \`logLevel\``);
    }
    this._logLevel = val;
  }
  // Workaround for setter/getter having to be the same type.
  setLogLevel(val) {
    this._logLevel = typeof val === "string" ? levelStringToEnum[val] : val;
  }
  get logHandler() {
    return this._logHandler;
  }
  set logHandler(val) {
    if (typeof val !== "function") {
      throw new TypeError("Value assigned to `logHandler` must be a function");
    }
    this._logHandler = val;
  }
  get userLogHandler() {
    return this._userLogHandler;
  }
  set userLogHandler(val) {
    this._userLogHandler = val;
  }
  /**
   * The functions below are all based on the `console` interface
   */
  debug(...args) {
    this._userLogHandler && this._userLogHandler(this, LogLevel.DEBUG, ...args);
    this._logHandler(this, LogLevel.DEBUG, ...args);
  }
  log(...args) {
    this._userLogHandler && this._userLogHandler(this, LogLevel.VERBOSE, ...args);
    this._logHandler(this, LogLevel.VERBOSE, ...args);
  }
  info(...args) {
    this._userLogHandler && this._userLogHandler(this, LogLevel.INFO, ...args);
    this._logHandler(this, LogLevel.INFO, ...args);
  }
  warn(...args) {
    this._userLogHandler && this._userLogHandler(this, LogLevel.WARN, ...args);
    this._logHandler(this, LogLevel.WARN, ...args);
  }
  error(...args) {
    this._userLogHandler && this._userLogHandler(this, LogLevel.ERROR, ...args);
    this._logHandler(this, LogLevel.ERROR, ...args);
  }
}
const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);
let idbProxyableTypes;
let cursorAdvanceMethods;
function getIdbProxyableTypes() {
  return idbProxyableTypes || (idbProxyableTypes = [
    IDBDatabase,
    IDBObjectStore,
    IDBIndex,
    IDBCursor,
    IDBTransaction
  ]);
}
function getCursorAdvanceMethods() {
  return cursorAdvanceMethods || (cursorAdvanceMethods = [
    IDBCursor.prototype.advance,
    IDBCursor.prototype.continue,
    IDBCursor.prototype.continuePrimaryKey
  ]);
}
const cursorRequestMap = /* @__PURE__ */ new WeakMap();
const transactionDoneMap = /* @__PURE__ */ new WeakMap();
const transactionStoreNamesMap = /* @__PURE__ */ new WeakMap();
const transformCache = /* @__PURE__ */ new WeakMap();
const reverseTransformCache = /* @__PURE__ */ new WeakMap();
function promisifyRequest(request) {
  const promise = new Promise((resolve, reject) => {
    const unlisten = () => {
      request.removeEventListener("success", success);
      request.removeEventListener("error", error);
    };
    const success = () => {
      resolve(wrap(request.result));
      unlisten();
    };
    const error = () => {
      reject(request.error);
      unlisten();
    };
    request.addEventListener("success", success);
    request.addEventListener("error", error);
  });
  promise.then((value) => {
    if (value instanceof IDBCursor) {
      cursorRequestMap.set(value, request);
    }
  }).catch(() => {
  });
  reverseTransformCache.set(promise, request);
  return promise;
}
function cacheDonePromiseForTransaction(tx) {
  if (transactionDoneMap.has(tx))
    return;
  const done = new Promise((resolve, reject) => {
    const unlisten = () => {
      tx.removeEventListener("complete", complete);
      tx.removeEventListener("error", error);
      tx.removeEventListener("abort", error);
    };
    const complete = () => {
      resolve();
      unlisten();
    };
    const error = () => {
      reject(tx.error || new DOMException("AbortError", "AbortError"));
      unlisten();
    };
    tx.addEventListener("complete", complete);
    tx.addEventListener("error", error);
    tx.addEventListener("abort", error);
  });
  transactionDoneMap.set(tx, done);
}
let idbProxyTraps = {
  get(target, prop, receiver) {
    if (target instanceof IDBTransaction) {
      if (prop === "done")
        return transactionDoneMap.get(target);
      if (prop === "objectStoreNames") {
        return target.objectStoreNames || transactionStoreNamesMap.get(target);
      }
      if (prop === "store") {
        return receiver.objectStoreNames[1] ? void 0 : receiver.objectStore(receiver.objectStoreNames[0]);
      }
    }
    return wrap(target[prop]);
  },
  set(target, prop, value) {
    target[prop] = value;
    return true;
  },
  has(target, prop) {
    if (target instanceof IDBTransaction && (prop === "done" || prop === "store")) {
      return true;
    }
    return prop in target;
  }
};
function replaceTraps(callback) {
  idbProxyTraps = callback(idbProxyTraps);
}
function wrapFunction(func) {
  if (func === IDBDatabase.prototype.transaction && !("objectStoreNames" in IDBTransaction.prototype)) {
    return function(storeNames, ...args) {
      const tx = func.call(unwrap(this), storeNames, ...args);
      transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);
      return wrap(tx);
    };
  }
  if (getCursorAdvanceMethods().includes(func)) {
    return function(...args) {
      func.apply(unwrap(this), args);
      return wrap(cursorRequestMap.get(this));
    };
  }
  return function(...args) {
    return wrap(func.apply(unwrap(this), args));
  };
}
function transformCachableValue(value) {
  if (typeof value === "function")
    return wrapFunction(value);
  if (value instanceof IDBTransaction)
    cacheDonePromiseForTransaction(value);
  if (instanceOfAny(value, getIdbProxyableTypes()))
    return new Proxy(value, idbProxyTraps);
  return value;
}
function wrap(value) {
  if (value instanceof IDBRequest)
    return promisifyRequest(value);
  if (transformCache.has(value))
    return transformCache.get(value);
  const newValue = transformCachableValue(value);
  if (newValue !== value) {
    transformCache.set(value, newValue);
    reverseTransformCache.set(newValue, value);
  }
  return newValue;
}
const unwrap = (value) => reverseTransformCache.get(value);
function openDB(name2, version2, { blocked, upgrade, blocking, terminated } = {}) {
  const request = indexedDB.open(name2, version2);
  const openPromise = wrap(request);
  if (upgrade) {
    request.addEventListener("upgradeneeded", (event) => {
      upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);
    });
  }
  if (blocked) {
    request.addEventListener("blocked", (event) => blocked(
      // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405
      event.oldVersion,
      event.newVersion,
      event
    ));
  }
  openPromise.then((db2) => {
    if (terminated)
      db2.addEventListener("close", () => terminated());
    if (blocking) {
      db2.addEventListener("versionchange", (event) => blocking(event.oldVersion, event.newVersion, event));
    }
  }).catch(() => {
  });
  return openPromise;
}
const readMethods = ["get", "getKey", "getAll", "getAllKeys", "count"];
const writeMethods = ["put", "add", "delete", "clear"];
const cachedMethods = /* @__PURE__ */ new Map();
function getMethod(target, prop) {
  if (!(target instanceof IDBDatabase && !(prop in target) && typeof prop === "string")) {
    return;
  }
  if (cachedMethods.get(prop))
    return cachedMethods.get(prop);
  const targetFuncName = prop.replace(/FromIndex$/, "");
  const useIndex = prop !== targetFuncName;
  const isWrite = writeMethods.includes(targetFuncName);
  if (
    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.
    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) || !(isWrite || readMethods.includes(targetFuncName))
  ) {
    return;
  }
  const method = async function(storeName, ...args) {
    const tx = this.transaction(storeName, isWrite ? "readwrite" : "readonly");
    let target2 = tx.store;
    if (useIndex)
      target2 = target2.index(args.shift());
    return (await Promise.all([
      target2[targetFuncName](...args),
      isWrite && tx.done
    ]))[0];
  };
  cachedMethods.set(prop, method);
  return method;
}
replaceTraps((oldTraps) => ({
  ...oldTraps,
  get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),
  has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop)
}));
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class PlatformLoggerServiceImpl {
  constructor(container) {
    this.container = container;
  }
  // In initial implementation, this will be called by installations on
  // auth token refresh, and installations will send this string.
  getPlatformInfoString() {
    const providers = this.container.getProviders();
    return providers.map((provider) => {
      if (isVersionServiceProvider(provider)) {
        const service = provider.getImmediate();
        return `${service.library}/${service.version}`;
      } else {
        return null;
      }
    }).filter((logString) => logString).join(" ");
  }
}
function isVersionServiceProvider(provider) {
  const component = provider.getComponent();
  return (component === null || component === void 0 ? void 0 : component.type) === "VERSION";
}
const name$q = "@firebase/app";
const version$1$1 = "0.10.13";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const logger = new Logger("@firebase/app");
const name$p = "@firebase/app-compat";
const name$o = "@firebase/analytics-compat";
const name$n = "@firebase/analytics";
const name$m = "@firebase/app-check-compat";
const name$l = "@firebase/app-check";
const name$k = "@firebase/auth";
const name$j = "@firebase/auth-compat";
const name$i = "@firebase/database";
const name$h = "@firebase/data-connect";
const name$g = "@firebase/database-compat";
const name$f = "@firebase/functions";
const name$e = "@firebase/functions-compat";
const name$d = "@firebase/installations";
const name$c = "@firebase/installations-compat";
const name$b = "@firebase/messaging";
const name$a = "@firebase/messaging-compat";
const name$9 = "@firebase/performance";
const name$8 = "@firebase/performance-compat";
const name$7 = "@firebase/remote-config";
const name$6 = "@firebase/remote-config-compat";
const name$5 = "@firebase/storage";
const name$4 = "@firebase/storage-compat";
const name$3 = "@firebase/firestore";
const name$2 = "@firebase/vertexai-preview";
const name$1$1 = "@firebase/firestore-compat";
const name$r = "firebase";
const version$2 = "10.14.1";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const DEFAULT_ENTRY_NAME = "[DEFAULT]";
const PLATFORM_LOG_STRING = {
  [name$q]: "fire-core",
  [name$p]: "fire-core-compat",
  [name$n]: "fire-analytics",
  [name$o]: "fire-analytics-compat",
  [name$l]: "fire-app-check",
  [name$m]: "fire-app-check-compat",
  [name$k]: "fire-auth",
  [name$j]: "fire-auth-compat",
  [name$i]: "fire-rtdb",
  [name$h]: "fire-data-connect",
  [name$g]: "fire-rtdb-compat",
  [name$f]: "fire-fn",
  [name$e]: "fire-fn-compat",
  [name$d]: "fire-iid",
  [name$c]: "fire-iid-compat",
  [name$b]: "fire-fcm",
  [name$a]: "fire-fcm-compat",
  [name$9]: "fire-perf",
  [name$8]: "fire-perf-compat",
  [name$7]: "fire-rc",
  [name$6]: "fire-rc-compat",
  [name$5]: "fire-gcs",
  [name$4]: "fire-gcs-compat",
  [name$3]: "fire-fst",
  [name$1$1]: "fire-fst-compat",
  [name$2]: "fire-vertex",
  "fire-js": "fire-js",
  [name$r]: "fire-js-all"
};
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _apps = /* @__PURE__ */ new Map();
const _serverApps = /* @__PURE__ */ new Map();
const _components = /* @__PURE__ */ new Map();
function _addComponent(app2, component) {
  try {
    app2.container.addComponent(component);
  } catch (e) {
    logger.debug(`Component ${component.name} failed to register with FirebaseApp ${app2.name}`, e);
  }
}
function _registerComponent(component) {
  const componentName = component.name;
  if (_components.has(componentName)) {
    logger.debug(`There were multiple attempts to register component ${componentName}.`);
    return false;
  }
  _components.set(componentName, component);
  for (const app2 of _apps.values()) {
    _addComponent(app2, component);
  }
  for (const serverApp of _serverApps.values()) {
    _addComponent(serverApp, component);
  }
  return true;
}
function _getProvider(app2, name2) {
  const heartbeatController = app2.container.getProvider("heartbeat").getImmediate({ optional: true });
  if (heartbeatController) {
    void heartbeatController.triggerHeartbeat();
  }
  return app2.container.getProvider(name2);
}
function _isFirebaseServerApp(obj) {
  return obj.settings !== void 0;
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ERRORS = {
  [
    "no-app"
    /* AppError.NO_APP */
  ]: "No Firebase App '{$appName}' has been created - call initializeApp() first",
  [
    "bad-app-name"
    /* AppError.BAD_APP_NAME */
  ]: "Illegal App name: '{$appName}'",
  [
    "duplicate-app"
    /* AppError.DUPLICATE_APP */
  ]: "Firebase App named '{$appName}' already exists with different options or config",
  [
    "app-deleted"
    /* AppError.APP_DELETED */
  ]: "Firebase App named '{$appName}' already deleted",
  [
    "server-app-deleted"
    /* AppError.SERVER_APP_DELETED */
  ]: "Firebase Server App has been deleted",
  [
    "no-options"
    /* AppError.NO_OPTIONS */
  ]: "Need to provide options, when not being deployed to hosting via source.",
  [
    "invalid-app-argument"
    /* AppError.INVALID_APP_ARGUMENT */
  ]: "firebase.{$appName}() takes either no argument or a Firebase App instance.",
  [
    "invalid-log-argument"
    /* AppError.INVALID_LOG_ARGUMENT */
  ]: "First argument to `onLog` must be null or a function.",
  [
    "idb-open"
    /* AppError.IDB_OPEN */
  ]: "Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",
  [
    "idb-get"
    /* AppError.IDB_GET */
  ]: "Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",
  [
    "idb-set"
    /* AppError.IDB_WRITE */
  ]: "Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",
  [
    "idb-delete"
    /* AppError.IDB_DELETE */
  ]: "Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",
  [
    "finalization-registry-not-supported"
    /* AppError.FINALIZATION_REGISTRY_NOT_SUPPORTED */
  ]: "FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",
  [
    "invalid-server-app-environment"
    /* AppError.INVALID_SERVER_APP_ENVIRONMENT */
  ]: "FirebaseServerApp is not for use in browser environments."
};
const ERROR_FACTORY = new ErrorFactory("app", "Firebase", ERRORS);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FirebaseAppImpl {
  constructor(options, config, container) {
    this._isDeleted = false;
    this._options = Object.assign({}, options);
    this._config = Object.assign({}, config);
    this._name = config.name;
    this._automaticDataCollectionEnabled = config.automaticDataCollectionEnabled;
    this._container = container;
    this.container.addComponent(new Component(
      "app",
      () => this,
      "PUBLIC"
      /* ComponentType.PUBLIC */
    ));
  }
  get automaticDataCollectionEnabled() {
    this.checkDestroyed();
    return this._automaticDataCollectionEnabled;
  }
  set automaticDataCollectionEnabled(val) {
    this.checkDestroyed();
    this._automaticDataCollectionEnabled = val;
  }
  get name() {
    this.checkDestroyed();
    return this._name;
  }
  get options() {
    this.checkDestroyed();
    return this._options;
  }
  get config() {
    this.checkDestroyed();
    return this._config;
  }
  get container() {
    return this._container;
  }
  get isDeleted() {
    return this._isDeleted;
  }
  set isDeleted(val) {
    this._isDeleted = val;
  }
  /**
   * This function will throw an Error if the App has already been deleted -
   * use before performing API actions on the App.
   */
  checkDestroyed() {
    if (this.isDeleted) {
      throw ERROR_FACTORY.create("app-deleted", { appName: this._name });
    }
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const SDK_VERSION = version$2;
function initializeApp(_options, rawConfig = {}) {
  let options = _options;
  if (typeof rawConfig !== "object") {
    const name3 = rawConfig;
    rawConfig = { name: name3 };
  }
  const config = Object.assign({ name: DEFAULT_ENTRY_NAME, automaticDataCollectionEnabled: false }, rawConfig);
  const name2 = config.name;
  if (typeof name2 !== "string" || !name2) {
    throw ERROR_FACTORY.create("bad-app-name", {
      appName: String(name2)
    });
  }
  options || (options = getDefaultAppConfig());
  if (!options) {
    throw ERROR_FACTORY.create(
      "no-options"
      /* AppError.NO_OPTIONS */
    );
  }
  const existingApp = _apps.get(name2);
  if (existingApp) {
    if (deepEqual(options, existingApp.options) && deepEqual(config, existingApp.config)) {
      return existingApp;
    } else {
      throw ERROR_FACTORY.create("duplicate-app", { appName: name2 });
    }
  }
  const container = new ComponentContainer(name2);
  for (const component of _components.values()) {
    container.addComponent(component);
  }
  const newApp = new FirebaseAppImpl(options, config, container);
  _apps.set(name2, newApp);
  return newApp;
}
function getApp(name2 = DEFAULT_ENTRY_NAME) {
  const app2 = _apps.get(name2);
  if (!app2 && name2 === DEFAULT_ENTRY_NAME && getDefaultAppConfig()) {
    return initializeApp();
  }
  if (!app2) {
    throw ERROR_FACTORY.create("no-app", { appName: name2 });
  }
  return app2;
}
function registerVersion(libraryKeyOrName, version2, variant) {
  var _a;
  let library = (_a = PLATFORM_LOG_STRING[libraryKeyOrName]) !== null && _a !== void 0 ? _a : libraryKeyOrName;
  if (variant) {
    library += `-${variant}`;
  }
  const libraryMismatch = library.match(/\s|\//);
  const versionMismatch = version2.match(/\s|\//);
  if (libraryMismatch || versionMismatch) {
    const warning = [
      `Unable to register library "${library}" with version "${version2}":`
    ];
    if (libraryMismatch) {
      warning.push(`library name "${library}" contains illegal characters (whitespace or "/")`);
    }
    if (libraryMismatch && versionMismatch) {
      warning.push("and");
    }
    if (versionMismatch) {
      warning.push(`version name "${version2}" contains illegal characters (whitespace or "/")`);
    }
    logger.warn(warning.join(" "));
    return;
  }
  _registerComponent(new Component(
    `${library}-version`,
    () => ({ library, version: version2 }),
    "VERSION"
    /* ComponentType.VERSION */
  ));
}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const DB_NAME$1 = "firebase-heartbeat-database";
const DB_VERSION$1 = 1;
const STORE_NAME = "firebase-heartbeat-store";
let dbPromise = null;
function getDbPromise() {
  if (!dbPromise) {
    dbPromise = openDB(DB_NAME$1, DB_VERSION$1, {
      upgrade: (db2, oldVersion) => {
        switch (oldVersion) {
          case 0:
            try {
              db2.createObjectStore(STORE_NAME);
            } catch (e) {
              console.warn(e);
            }
        }
      }
    }).catch((e) => {
      throw ERROR_FACTORY.create("idb-open", {
        originalErrorMessage: e.message
      });
    });
  }
  return dbPromise;
}
async function readHeartbeatsFromIndexedDB(app2) {
  try {
    const db2 = await getDbPromise();
    const tx = db2.transaction(STORE_NAME);
    const result = await tx.objectStore(STORE_NAME).get(computeKey(app2));
    await tx.done;
    return result;
  } catch (e) {
    if (e instanceof FirebaseError) {
      logger.warn(e.message);
    } else {
      const idbGetError = ERROR_FACTORY.create("idb-get", {
        originalErrorMessage: e === null || e === void 0 ? void 0 : e.message
      });
      logger.warn(idbGetError.message);
    }
  }
}
async function writeHeartbeatsToIndexedDB(app2, heartbeatObject) {
  try {
    const db2 = await getDbPromise();
    const tx = db2.transaction(STORE_NAME, "readwrite");
    const objectStore = tx.objectStore(STORE_NAME);
    await objectStore.put(heartbeatObject, computeKey(app2));
    await tx.done;
  } catch (e) {
    if (e instanceof FirebaseError) {
      logger.warn(e.message);
    } else {
      const idbGetError = ERROR_FACTORY.create("idb-set", {
        originalErrorMessage: e === null || e === void 0 ? void 0 : e.message
      });
      logger.warn(idbGetError.message);
    }
  }
}
function computeKey(app2) {
  return `${app2.name}!${app2.options.appId}`;
}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const MAX_HEADER_BYTES = 1024;
const STORED_HEARTBEAT_RETENTION_MAX_MILLIS = 30 * 24 * 60 * 60 * 1e3;
class HeartbeatServiceImpl {
  constructor(container) {
    this.container = container;
    this._heartbeatsCache = null;
    const app2 = this.container.getProvider("app").getImmediate();
    this._storage = new HeartbeatStorageImpl(app2);
    this._heartbeatsCachePromise = this._storage.read().then((result) => {
      this._heartbeatsCache = result;
      return result;
    });
  }
  /**
   * Called to report a heartbeat. The function will generate
   * a HeartbeatsByUserAgent object, update heartbeatsCache, and persist it
   * to IndexedDB.
   * Note that we only store one heartbeat per day. So if a heartbeat for today is
   * already logged, subsequent calls to this function in the same day will be ignored.
   */
  async triggerHeartbeat() {
    var _a, _b;
    try {
      const platformLogger = this.container.getProvider("platform-logger").getImmediate();
      const agent = platformLogger.getPlatformInfoString();
      const date = getUTCDateString();
      if (((_a = this._heartbeatsCache) === null || _a === void 0 ? void 0 : _a.heartbeats) == null) {
        this._heartbeatsCache = await this._heartbeatsCachePromise;
        if (((_b = this._heartbeatsCache) === null || _b === void 0 ? void 0 : _b.heartbeats) == null) {
          return;
        }
      }
      if (this._heartbeatsCache.lastSentHeartbeatDate === date || this._heartbeatsCache.heartbeats.some((singleDateHeartbeat) => singleDateHeartbeat.date === date)) {
        return;
      } else {
        this._heartbeatsCache.heartbeats.push({ date, agent });
      }
      this._heartbeatsCache.heartbeats = this._heartbeatsCache.heartbeats.filter((singleDateHeartbeat) => {
        const hbTimestamp = new Date(singleDateHeartbeat.date).valueOf();
        const now = Date.now();
        return now - hbTimestamp <= STORED_HEARTBEAT_RETENTION_MAX_MILLIS;
      });
      return this._storage.overwrite(this._heartbeatsCache);
    } catch (e) {
      logger.warn(e);
    }
  }
  /**
   * Returns a base64 encoded string which can be attached to the heartbeat-specific header directly.
   * It also clears all heartbeats from memory as well as in IndexedDB.
   *
   * NOTE: Consuming product SDKs should not send the header if this method
   * returns an empty string.
   */
  async getHeartbeatsHeader() {
    var _a;
    try {
      if (this._heartbeatsCache === null) {
        await this._heartbeatsCachePromise;
      }
      if (((_a = this._heartbeatsCache) === null || _a === void 0 ? void 0 : _a.heartbeats) == null || this._heartbeatsCache.heartbeats.length === 0) {
        return "";
      }
      const date = getUTCDateString();
      const { heartbeatsToSend, unsentEntries } = extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats);
      const headerString = base64urlEncodeWithoutPadding(JSON.stringify({ version: 2, heartbeats: heartbeatsToSend }));
      this._heartbeatsCache.lastSentHeartbeatDate = date;
      if (unsentEntries.length > 0) {
        this._heartbeatsCache.heartbeats = unsentEntries;
        await this._storage.overwrite(this._heartbeatsCache);
      } else {
        this._heartbeatsCache.heartbeats = [];
        void this._storage.overwrite(this._heartbeatsCache);
      }
      return headerString;
    } catch (e) {
      logger.warn(e);
      return "";
    }
  }
}
function getUTCDateString() {
  const today = /* @__PURE__ */ new Date();
  return today.toISOString().substring(0, 10);
}
function extractHeartbeatsForHeader(heartbeatsCache, maxSize = MAX_HEADER_BYTES) {
  const heartbeatsToSend = [];
  let unsentEntries = heartbeatsCache.slice();
  for (const singleDateHeartbeat of heartbeatsCache) {
    const heartbeatEntry = heartbeatsToSend.find((hb) => hb.agent === singleDateHeartbeat.agent);
    if (!heartbeatEntry) {
      heartbeatsToSend.push({
        agent: singleDateHeartbeat.agent,
        dates: [singleDateHeartbeat.date]
      });
      if (countBytes(heartbeatsToSend) > maxSize) {
        heartbeatsToSend.pop();
        break;
      }
    } else {
      heartbeatEntry.dates.push(singleDateHeartbeat.date);
      if (countBytes(heartbeatsToSend) > maxSize) {
        heartbeatEntry.dates.pop();
        break;
      }
    }
    unsentEntries = unsentEntries.slice(1);
  }
  return {
    heartbeatsToSend,
    unsentEntries
  };
}
class HeartbeatStorageImpl {
  constructor(app2) {
    this.app = app2;
    this._canUseIndexedDBPromise = this.runIndexedDBEnvironmentCheck();
  }
  async runIndexedDBEnvironmentCheck() {
    if (!isIndexedDBAvailable()) {
      return false;
    } else {
      return validateIndexedDBOpenable().then(() => true).catch(() => false);
    }
  }
  /**
   * Read all heartbeats.
   */
  async read() {
    const canUseIndexedDB = await this._canUseIndexedDBPromise;
    if (!canUseIndexedDB) {
      return { heartbeats: [] };
    } else {
      const idbHeartbeatObject = await readHeartbeatsFromIndexedDB(this.app);
      if (idbHeartbeatObject === null || idbHeartbeatObject === void 0 ? void 0 : idbHeartbeatObject.heartbeats) {
        return idbHeartbeatObject;
      } else {
        return { heartbeats: [] };
      }
    }
  }
  // overwrite the storage with the provided heartbeats
  async overwrite(heartbeatsObject) {
    var _a;
    const canUseIndexedDB = await this._canUseIndexedDBPromise;
    if (!canUseIndexedDB) {
      return;
    } else {
      const existingHeartbeatsObject = await this.read();
      return writeHeartbeatsToIndexedDB(this.app, {
        lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,
        heartbeats: heartbeatsObject.heartbeats
      });
    }
  }
  // add heartbeats
  async add(heartbeatsObject) {
    var _a;
    const canUseIndexedDB = await this._canUseIndexedDBPromise;
    if (!canUseIndexedDB) {
      return;
    } else {
      const existingHeartbeatsObject = await this.read();
      return writeHeartbeatsToIndexedDB(this.app, {
        lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,
        heartbeats: [
          ...existingHeartbeatsObject.heartbeats,
          ...heartbeatsObject.heartbeats
        ]
      });
    }
  }
}
function countBytes(heartbeatsCache) {
  return base64urlEncodeWithoutPadding(
    // heartbeatsCache wrapper properties
    JSON.stringify({ version: 2, heartbeats: heartbeatsCache })
  ).length;
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function registerCoreComponents(variant) {
  _registerComponent(new Component(
    "platform-logger",
    (container) => new PlatformLoggerServiceImpl(container),
    "PRIVATE"
    /* ComponentType.PRIVATE */
  ));
  _registerComponent(new Component(
    "heartbeat",
    (container) => new HeartbeatServiceImpl(container),
    "PRIVATE"
    /* ComponentType.PRIVATE */
  ));
  registerVersion(name$q, version$1$1, variant);
  registerVersion(name$q, version$1$1, "esm2017");
  registerVersion("fire-js", "");
}
registerCoreComponents("");
var name$1 = "firebase";
var version$1 = "10.14.1";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
registerVersion(name$1, version$1, "app");
function __rest(s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
    t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
      if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
        t[p[i]] = s[p[i]];
    }
  return t;
}
typeof SuppressedError === "function" ? SuppressedError : function(error, suppressed, message) {
  var e = new Error(message);
  return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};
function _prodErrorMap() {
  return {
    [
      "dependent-sdk-initialized-before-auth"
      /* AuthErrorCode.DEPENDENT_SDK_INIT_BEFORE_AUTH */
    ]: "Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."
  };
}
const prodErrorMap = _prodErrorMap;
const _DEFAULT_AUTH_ERROR_FACTORY = new ErrorFactory("auth", "Firebase", _prodErrorMap());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const logClient = new Logger("@firebase/auth");
function _logWarn(msg, ...args) {
  if (logClient.logLevel <= LogLevel.WARN) {
    logClient.warn(`Auth (${SDK_VERSION}): ${msg}`, ...args);
  }
}
function _logError(msg, ...args) {
  if (logClient.logLevel <= LogLevel.ERROR) {
    logClient.error(`Auth (${SDK_VERSION}): ${msg}`, ...args);
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _fail(authOrCode, ...rest) {
  throw createErrorInternal(authOrCode, ...rest);
}
function _createError(authOrCode, ...rest) {
  return createErrorInternal(authOrCode, ...rest);
}
function _errorWithCustomMessage(auth2, code, message) {
  const errorMap = Object.assign(Object.assign({}, prodErrorMap()), { [code]: message });
  const factory = new ErrorFactory("auth", "Firebase", errorMap);
  return factory.create(code, {
    appName: auth2.name
  });
}
function _serverAppCurrentUserOperationNotSupportedError(auth2) {
  return _errorWithCustomMessage(auth2, "operation-not-supported-in-this-environment", "Operations that alter the current user are not supported in conjunction with FirebaseServerApp");
}
function createErrorInternal(authOrCode, ...rest) {
  if (typeof authOrCode !== "string") {
    const code = rest[0];
    const fullParams = [...rest.slice(1)];
    if (fullParams[0]) {
      fullParams[0].appName = authOrCode.name;
    }
    return authOrCode._errorFactory.create(code, ...fullParams);
  }
  return _DEFAULT_AUTH_ERROR_FACTORY.create(authOrCode, ...rest);
}
function _assert(assertion, authOrCode, ...rest) {
  if (!assertion) {
    throw createErrorInternal(authOrCode, ...rest);
  }
}
function debugFail(failure) {
  const message = `INTERNAL ASSERTION FAILED: ` + failure;
  _logError(message);
  throw new Error(message);
}
function debugAssert(assertion, message) {
  if (!assertion) {
    debugFail(message);
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _getCurrentUrl() {
  var _a;
  return typeof self !== "undefined" && ((_a = self.location) === null || _a === void 0 ? void 0 : _a.href) || "";
}
function _isHttpOrHttps() {
  return _getCurrentScheme() === "http:" || _getCurrentScheme() === "https:";
}
function _getCurrentScheme() {
  var _a;
  return typeof self !== "undefined" && ((_a = self.location) === null || _a === void 0 ? void 0 : _a.protocol) || null;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _isOnline() {
  if (typeof navigator !== "undefined" && navigator && "onLine" in navigator && typeof navigator.onLine === "boolean" && // Apply only for traditional web apps and Chrome extensions.
  // This is especially true for Cordova apps which have unreliable
  // navigator.onLine behavior unless cordova-plugin-network-information is
  // installed which overwrites the native navigator.onLine value and
  // defines navigator.connection.
  (_isHttpOrHttps() || isBrowserExtension() || "connection" in navigator)) {
    return navigator.onLine;
  }
  return true;
}
function _getUserLanguage() {
  if (typeof navigator === "undefined") {
    return null;
  }
  const navigatorLanguage = navigator;
  return (
    // Most reliable, but only supported in Chrome/Firefox.
    navigatorLanguage.languages && navigatorLanguage.languages[0] || // Supported in most browsers, but returns the language of the browser
    // UI, not the language set in browser settings.
    navigatorLanguage.language || // Couldn't determine language.
    null
  );
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Delay {
  constructor(shortDelay, longDelay) {
    this.shortDelay = shortDelay;
    this.longDelay = longDelay;
    debugAssert(longDelay > shortDelay, "Short delay should be less than long delay!");
    this.isMobile = isMobileCordova() || isReactNative();
  }
  get() {
    if (!_isOnline()) {
      return Math.min(5e3, this.shortDelay);
    }
    return this.isMobile ? this.longDelay : this.shortDelay;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _emulatorUrl(config, path) {
  debugAssert(config.emulator, "Emulator should always be set here");
  const { url } = config.emulator;
  if (!path) {
    return url;
  }
  return `${url}${path.startsWith("/") ? path.slice(1) : path}`;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FetchProvider {
  static initialize(fetchImpl, headersImpl, responseImpl) {
    this.fetchImpl = fetchImpl;
    if (headersImpl) {
      this.headersImpl = headersImpl;
    }
    if (responseImpl) {
      this.responseImpl = responseImpl;
    }
  }
  static fetch() {
    if (this.fetchImpl) {
      return this.fetchImpl;
    }
    if (typeof self !== "undefined" && "fetch" in self) {
      return self.fetch;
    }
    if (typeof globalThis !== "undefined" && globalThis.fetch) {
      return globalThis.fetch;
    }
    if (typeof fetch !== "undefined") {
      return fetch;
    }
    debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill");
  }
  static headers() {
    if (this.headersImpl) {
      return this.headersImpl;
    }
    if (typeof self !== "undefined" && "Headers" in self) {
      return self.Headers;
    }
    if (typeof globalThis !== "undefined" && globalThis.Headers) {
      return globalThis.Headers;
    }
    if (typeof Headers !== "undefined") {
      return Headers;
    }
    debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill");
  }
  static response() {
    if (this.responseImpl) {
      return this.responseImpl;
    }
    if (typeof self !== "undefined" && "Response" in self) {
      return self.Response;
    }
    if (typeof globalThis !== "undefined" && globalThis.Response) {
      return globalThis.Response;
    }
    if (typeof Response !== "undefined") {
      return Response;
    }
    debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill");
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const SERVER_ERROR_MAP = {
  // Custom token errors.
  [
    "CREDENTIAL_MISMATCH"
    /* ServerError.CREDENTIAL_MISMATCH */
  ]: "custom-token-mismatch",
  // This can only happen if the SDK sends a bad request.
  [
    "MISSING_CUSTOM_TOKEN"
    /* ServerError.MISSING_CUSTOM_TOKEN */
  ]: "internal-error",
  // Create Auth URI errors.
  [
    "INVALID_IDENTIFIER"
    /* ServerError.INVALID_IDENTIFIER */
  ]: "invalid-email",
  // This can only happen if the SDK sends a bad request.
  [
    "MISSING_CONTINUE_URI"
    /* ServerError.MISSING_CONTINUE_URI */
  ]: "internal-error",
  // Sign in with email and password errors (some apply to sign up too).
  [
    "INVALID_PASSWORD"
    /* ServerError.INVALID_PASSWORD */
  ]: "wrong-password",
  // This can only happen if the SDK sends a bad request.
  [
    "MISSING_PASSWORD"
    /* ServerError.MISSING_PASSWORD */
  ]: "missing-password",
  // Thrown if Email Enumeration Protection is enabled in the project and the email or password is
  // invalid.
  [
    "INVALID_LOGIN_CREDENTIALS"
    /* ServerError.INVALID_LOGIN_CREDENTIALS */
  ]: "invalid-credential",
  // Sign up with email and password errors.
  [
    "EMAIL_EXISTS"
    /* ServerError.EMAIL_EXISTS */
  ]: "email-already-in-use",
  [
    "PASSWORD_LOGIN_DISABLED"
    /* ServerError.PASSWORD_LOGIN_DISABLED */
  ]: "operation-not-allowed",
  // Verify assertion for sign in with credential errors:
  [
    "INVALID_IDP_RESPONSE"
    /* ServerError.INVALID_IDP_RESPONSE */
  ]: "invalid-credential",
  [
    "INVALID_PENDING_TOKEN"
    /* ServerError.INVALID_PENDING_TOKEN */
  ]: "invalid-credential",
  [
    "FEDERATED_USER_ID_ALREADY_LINKED"
    /* ServerError.FEDERATED_USER_ID_ALREADY_LINKED */
  ]: "credential-already-in-use",
  // This can only happen if the SDK sends a bad request.
  [
    "MISSING_REQ_TYPE"
    /* ServerError.MISSING_REQ_TYPE */
  ]: "internal-error",
  // Send Password reset email errors:
  [
    "EMAIL_NOT_FOUND"
    /* ServerError.EMAIL_NOT_FOUND */
  ]: "user-not-found",
  [
    "RESET_PASSWORD_EXCEED_LIMIT"
    /* ServerError.RESET_PASSWORD_EXCEED_LIMIT */
  ]: "too-many-requests",
  [
    "EXPIRED_OOB_CODE"
    /* ServerError.EXPIRED_OOB_CODE */
  ]: "expired-action-code",
  [
    "INVALID_OOB_CODE"
    /* ServerError.INVALID_OOB_CODE */
  ]: "invalid-action-code",
  // This can only happen if the SDK sends a bad request.
  [
    "MISSING_OOB_CODE"
    /* ServerError.MISSING_OOB_CODE */
  ]: "internal-error",
  // Operations that require ID token in request:
  [
    "CREDENTIAL_TOO_OLD_LOGIN_AGAIN"
    /* ServerError.CREDENTIAL_TOO_OLD_LOGIN_AGAIN */
  ]: "requires-recent-login",
  [
    "INVALID_ID_TOKEN"
    /* ServerError.INVALID_ID_TOKEN */
  ]: "invalid-user-token",
  [
    "TOKEN_EXPIRED"
    /* ServerError.TOKEN_EXPIRED */
  ]: "user-token-expired",
  [
    "USER_NOT_FOUND"
    /* ServerError.USER_NOT_FOUND */
  ]: "user-token-expired",
  // Other errors.
  [
    "TOO_MANY_ATTEMPTS_TRY_LATER"
    /* ServerError.TOO_MANY_ATTEMPTS_TRY_LATER */
  ]: "too-many-requests",
  [
    "PASSWORD_DOES_NOT_MEET_REQUIREMENTS"
    /* ServerError.PASSWORD_DOES_NOT_MEET_REQUIREMENTS */
  ]: "password-does-not-meet-requirements",
  // Phone Auth related errors.
  [
    "INVALID_CODE"
    /* ServerError.INVALID_CODE */
  ]: "invalid-verification-code",
  [
    "INVALID_SESSION_INFO"
    /* ServerError.INVALID_SESSION_INFO */
  ]: "invalid-verification-id",
  [
    "INVALID_TEMPORARY_PROOF"
    /* ServerError.INVALID_TEMPORARY_PROOF */
  ]: "invalid-credential",
  [
    "MISSING_SESSION_INFO"
    /* ServerError.MISSING_SESSION_INFO */
  ]: "missing-verification-id",
  [
    "SESSION_EXPIRED"
    /* ServerError.SESSION_EXPIRED */
  ]: "code-expired",
  // Other action code errors when additional settings passed.
  // MISSING_CONTINUE_URI is getting mapped to INTERNAL_ERROR above.
  // This is OK as this error will be caught by client side validation.
  [
    "MISSING_ANDROID_PACKAGE_NAME"
    /* ServerError.MISSING_ANDROID_PACKAGE_NAME */
  ]: "missing-android-pkg-name",
  [
    "UNAUTHORIZED_DOMAIN"
    /* ServerError.UNAUTHORIZED_DOMAIN */
  ]: "unauthorized-continue-uri",
  // getProjectConfig errors when clientId is passed.
  [
    "INVALID_OAUTH_CLIENT_ID"
    /* ServerError.INVALID_OAUTH_CLIENT_ID */
  ]: "invalid-oauth-client-id",
  // User actions (sign-up or deletion) disabled errors.
  [
    "ADMIN_ONLY_OPERATION"
    /* ServerError.ADMIN_ONLY_OPERATION */
  ]: "admin-restricted-operation",
  // Multi factor related errors.
  [
    "INVALID_MFA_PENDING_CREDENTIAL"
    /* ServerError.INVALID_MFA_PENDING_CREDENTIAL */
  ]: "invalid-multi-factor-session",
  [
    "MFA_ENROLLMENT_NOT_FOUND"
    /* ServerError.MFA_ENROLLMENT_NOT_FOUND */
  ]: "multi-factor-info-not-found",
  [
    "MISSING_MFA_ENROLLMENT_ID"
    /* ServerError.MISSING_MFA_ENROLLMENT_ID */
  ]: "missing-multi-factor-info",
  [
    "MISSING_MFA_PENDING_CREDENTIAL"
    /* ServerError.MISSING_MFA_PENDING_CREDENTIAL */
  ]: "missing-multi-factor-session",
  [
    "SECOND_FACTOR_EXISTS"
    /* ServerError.SECOND_FACTOR_EXISTS */
  ]: "second-factor-already-in-use",
  [
    "SECOND_FACTOR_LIMIT_EXCEEDED"
    /* ServerError.SECOND_FACTOR_LIMIT_EXCEEDED */
  ]: "maximum-second-factor-count-exceeded",
  // Blocking functions related errors.
  [
    "BLOCKING_FUNCTION_ERROR_RESPONSE"
    /* ServerError.BLOCKING_FUNCTION_ERROR_RESPONSE */
  ]: "internal-error",
  // Recaptcha related errors.
  [
    "RECAPTCHA_NOT_ENABLED"
    /* ServerError.RECAPTCHA_NOT_ENABLED */
  ]: "recaptcha-not-enabled",
  [
    "MISSING_RECAPTCHA_TOKEN"
    /* ServerError.MISSING_RECAPTCHA_TOKEN */
  ]: "missing-recaptcha-token",
  [
    "INVALID_RECAPTCHA_TOKEN"
    /* ServerError.INVALID_RECAPTCHA_TOKEN */
  ]: "invalid-recaptcha-token",
  [
    "INVALID_RECAPTCHA_ACTION"
    /* ServerError.INVALID_RECAPTCHA_ACTION */
  ]: "invalid-recaptcha-action",
  [
    "MISSING_CLIENT_TYPE"
    /* ServerError.MISSING_CLIENT_TYPE */
  ]: "missing-client-type",
  [
    "MISSING_RECAPTCHA_VERSION"
    /* ServerError.MISSING_RECAPTCHA_VERSION */
  ]: "missing-recaptcha-version",
  [
    "INVALID_RECAPTCHA_VERSION"
    /* ServerError.INVALID_RECAPTCHA_VERSION */
  ]: "invalid-recaptcha-version",
  [
    "INVALID_REQ_TYPE"
    /* ServerError.INVALID_REQ_TYPE */
  ]: "invalid-req-type"
  /* AuthErrorCode.INVALID_REQ_TYPE */
};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const DEFAULT_API_TIMEOUT_MS = new Delay(3e4, 6e4);
function _addTidIfNecessary(auth2, request) {
  if (auth2.tenantId && !request.tenantId) {
    return Object.assign(Object.assign({}, request), { tenantId: auth2.tenantId });
  }
  return request;
}
async function _performApiRequest(auth2, method, path, request, customErrorMap = {}) {
  return _performFetchWithErrorHandling(auth2, customErrorMap, async () => {
    let body = {};
    let params = {};
    if (request) {
      if (method === "GET") {
        params = request;
      } else {
        body = {
          body: JSON.stringify(request)
        };
      }
    }
    const query = querystring(Object.assign({ key: auth2.config.apiKey }, params)).slice(1);
    const headers = await auth2._getAdditionalHeaders();
    headers[
      "Content-Type"
      /* HttpHeader.CONTENT_TYPE */
    ] = "application/json";
    if (auth2.languageCode) {
      headers[
        "X-Firebase-Locale"
        /* HttpHeader.X_FIREBASE_LOCALE */
      ] = auth2.languageCode;
    }
    const fetchArgs = Object.assign({
      method,
      headers
    }, body);
    if (!isCloudflareWorker()) {
      fetchArgs.referrerPolicy = "no-referrer";
    }
    return FetchProvider.fetch()(_getFinalTarget(auth2, auth2.config.apiHost, path, query), fetchArgs);
  });
}
async function _performFetchWithErrorHandling(auth2, customErrorMap, fetchFn) {
  auth2._canInitEmulator = false;
  const errorMap = Object.assign(Object.assign({}, SERVER_ERROR_MAP), customErrorMap);
  try {
    const networkTimeout = new NetworkTimeout(auth2);
    const response = await Promise.race([
      fetchFn(),
      networkTimeout.promise
    ]);
    networkTimeout.clearNetworkTimeout();
    const json = await response.json();
    if ("needConfirmation" in json) {
      throw _makeTaggedError(auth2, "account-exists-with-different-credential", json);
    }
    if (response.ok && !("errorMessage" in json)) {
      return json;
    } else {
      const errorMessage = response.ok ? json.errorMessage : json.error.message;
      const [serverErrorCode, serverErrorMessage] = errorMessage.split(" : ");
      if (serverErrorCode === "FEDERATED_USER_ID_ALREADY_LINKED") {
        throw _makeTaggedError(auth2, "credential-already-in-use", json);
      } else if (serverErrorCode === "EMAIL_EXISTS") {
        throw _makeTaggedError(auth2, "email-already-in-use", json);
      } else if (serverErrorCode === "USER_DISABLED") {
        throw _makeTaggedError(auth2, "user-disabled", json);
      }
      const authError2 = errorMap[serverErrorCode] || serverErrorCode.toLowerCase().replace(/[_\s]+/g, "-");
      if (serverErrorMessage) {
        throw _errorWithCustomMessage(auth2, authError2, serverErrorMessage);
      } else {
        _fail(auth2, authError2);
      }
    }
  } catch (e) {
    if (e instanceof FirebaseError) {
      throw e;
    }
    _fail(auth2, "network-request-failed", { "message": String(e) });
  }
}
async function _performSignInRequest(auth2, method, path, request, customErrorMap = {}) {
  const serverResponse = await _performApiRequest(auth2, method, path, request, customErrorMap);
  if ("mfaPendingCredential" in serverResponse) {
    _fail(auth2, "multi-factor-auth-required", {
      _serverResponse: serverResponse
    });
  }
  return serverResponse;
}
function _getFinalTarget(auth2, host, path, query) {
  const base = `${host}${path}?${query}`;
  if (!auth2.config.emulator) {
    return `${auth2.config.apiScheme}://${base}`;
  }
  return _emulatorUrl(auth2.config, base);
}
function _parseEnforcementState(enforcementStateStr) {
  switch (enforcementStateStr) {
    case "ENFORCE":
      return "ENFORCE";
    case "AUDIT":
      return "AUDIT";
    case "OFF":
      return "OFF";
    default:
      return "ENFORCEMENT_STATE_UNSPECIFIED";
  }
}
class NetworkTimeout {
  constructor(auth2) {
    this.auth = auth2;
    this.timer = null;
    this.promise = new Promise((_, reject) => {
      this.timer = setTimeout(() => {
        return reject(_createError(
          this.auth,
          "network-request-failed"
          /* AuthErrorCode.NETWORK_REQUEST_FAILED */
        ));
      }, DEFAULT_API_TIMEOUT_MS.get());
    });
  }
  clearNetworkTimeout() {
    clearTimeout(this.timer);
  }
}
function _makeTaggedError(auth2, code, response) {
  const errorParams = {
    appName: auth2.name
  };
  if (response.email) {
    errorParams.email = response.email;
  }
  if (response.phoneNumber) {
    errorParams.phoneNumber = response.phoneNumber;
  }
  const error = _createError(auth2, code, errorParams);
  error.customData._tokenResponse = response;
  return error;
}
function isEnterprise(grecaptcha) {
  return grecaptcha !== void 0 && grecaptcha.enterprise !== void 0;
}
class RecaptchaConfig {
  constructor(response) {
    this.siteKey = "";
    this.recaptchaEnforcementState = [];
    if (response.recaptchaKey === void 0) {
      throw new Error("recaptchaKey undefined");
    }
    this.siteKey = response.recaptchaKey.split("/")[3];
    this.recaptchaEnforcementState = response.recaptchaEnforcementState;
  }
  /**
   * Returns the reCAPTCHA Enterprise enforcement state for the given provider.
   *
   * @param providerStr - The provider whose enforcement state is to be returned.
   * @returns The reCAPTCHA Enterprise enforcement state for the given provider.
   */
  getProviderEnforcementState(providerStr) {
    if (!this.recaptchaEnforcementState || this.recaptchaEnforcementState.length === 0) {
      return null;
    }
    for (const recaptchaEnforcementState of this.recaptchaEnforcementState) {
      if (recaptchaEnforcementState.provider && recaptchaEnforcementState.provider === providerStr) {
        return _parseEnforcementState(recaptchaEnforcementState.enforcementState);
      }
    }
    return null;
  }
  /**
   * Returns true if the reCAPTCHA Enterprise enforcement state for the provider is set to ENFORCE or AUDIT.
   *
   * @param providerStr - The provider whose enablement state is to be returned.
   * @returns Whether or not reCAPTCHA Enterprise protection is enabled for the given provider.
   */
  isProviderEnabled(providerStr) {
    return this.getProviderEnforcementState(providerStr) === "ENFORCE" || this.getProviderEnforcementState(providerStr) === "AUDIT";
  }
}
async function getRecaptchaConfig(auth2, request) {
  return _performApiRequest(auth2, "GET", "/v2/recaptchaConfig", _addTidIfNecessary(auth2, request));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function deleteAccount(auth2, request) {
  return _performApiRequest(auth2, "POST", "/v1/accounts:delete", request);
}
async function getAccountInfo(auth2, request) {
  return _performApiRequest(auth2, "POST", "/v1/accounts:lookup", request);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function utcTimestampToDateString(utcTimestamp) {
  if (!utcTimestamp) {
    return void 0;
  }
  try {
    const date = new Date(Number(utcTimestamp));
    if (!isNaN(date.getTime())) {
      return date.toUTCString();
    }
  } catch (e) {
  }
  return void 0;
}
async function getIdTokenResult(user, forceRefresh = false) {
  const userInternal = getModularInstance(user);
  const token = await userInternal.getIdToken(forceRefresh);
  const claims = _parseToken(token);
  _assert(
    claims && claims.exp && claims.auth_time && claims.iat,
    userInternal.auth,
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  const firebase = typeof claims.firebase === "object" ? claims.firebase : void 0;
  const signInProvider = firebase === null || firebase === void 0 ? void 0 : firebase["sign_in_provider"];
  return {
    claims,
    token,
    authTime: utcTimestampToDateString(secondsStringToMilliseconds(claims.auth_time)),
    issuedAtTime: utcTimestampToDateString(secondsStringToMilliseconds(claims.iat)),
    expirationTime: utcTimestampToDateString(secondsStringToMilliseconds(claims.exp)),
    signInProvider: signInProvider || null,
    signInSecondFactor: (firebase === null || firebase === void 0 ? void 0 : firebase["sign_in_second_factor"]) || null
  };
}
function secondsStringToMilliseconds(seconds) {
  return Number(seconds) * 1e3;
}
function _parseToken(token) {
  const [algorithm, payload, signature] = token.split(".");
  if (algorithm === void 0 || payload === void 0 || signature === void 0) {
    _logError("JWT malformed, contained fewer than 3 sections");
    return null;
  }
  try {
    const decoded = base64Decode(payload);
    if (!decoded) {
      _logError("Failed to decode base64 JWT payload");
      return null;
    }
    return JSON.parse(decoded);
  } catch (e) {
    _logError("Caught error parsing JWT payload as JSON", e === null || e === void 0 ? void 0 : e.toString());
    return null;
  }
}
function _tokenExpiresIn(token) {
  const parsedToken = _parseToken(token);
  _assert(
    parsedToken,
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  _assert(
    typeof parsedToken.exp !== "undefined",
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  _assert(
    typeof parsedToken.iat !== "undefined",
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  return Number(parsedToken.exp) - Number(parsedToken.iat);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function _logoutIfInvalidated(user, promise, bypassAuthState = false) {
  if (bypassAuthState) {
    return promise;
  }
  try {
    return await promise;
  } catch (e) {
    if (e instanceof FirebaseError && isUserInvalidated(e)) {
      if (user.auth.currentUser === user) {
        await user.auth.signOut();
      }
    }
    throw e;
  }
}
function isUserInvalidated({ code }) {
  return code === `auth/${"user-disabled"}` || code === `auth/${"user-token-expired"}`;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ProactiveRefresh {
  constructor(user) {
    this.user = user;
    this.isRunning = false;
    this.timerId = null;
    this.errorBackoff = 3e4;
  }
  _start() {
    if (this.isRunning) {
      return;
    }
    this.isRunning = true;
    this.schedule();
  }
  _stop() {
    if (!this.isRunning) {
      return;
    }
    this.isRunning = false;
    if (this.timerId !== null) {
      clearTimeout(this.timerId);
    }
  }
  getInterval(wasError) {
    var _a;
    if (wasError) {
      const interval = this.errorBackoff;
      this.errorBackoff = Math.min(
        this.errorBackoff * 2,
        96e4
        /* Duration.RETRY_BACKOFF_MAX */
      );
      return interval;
    } else {
      this.errorBackoff = 3e4;
      const expTime = (_a = this.user.stsTokenManager.expirationTime) !== null && _a !== void 0 ? _a : 0;
      const interval = expTime - Date.now() - 3e5;
      return Math.max(0, interval);
    }
  }
  schedule(wasError = false) {
    if (!this.isRunning) {
      return;
    }
    const interval = this.getInterval(wasError);
    this.timerId = setTimeout(async () => {
      await this.iteration();
    }, interval);
  }
  async iteration() {
    try {
      await this.user.getIdToken(true);
    } catch (e) {
      if ((e === null || e === void 0 ? void 0 : e.code) === `auth/${"network-request-failed"}`) {
        this.schedule(
          /* wasError */
          true
        );
      }
      return;
    }
    this.schedule();
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class UserMetadata {
  constructor(createdAt, lastLoginAt) {
    this.createdAt = createdAt;
    this.lastLoginAt = lastLoginAt;
    this._initializeTime();
  }
  _initializeTime() {
    this.lastSignInTime = utcTimestampToDateString(this.lastLoginAt);
    this.creationTime = utcTimestampToDateString(this.createdAt);
  }
  _copy(metadata) {
    this.createdAt = metadata.createdAt;
    this.lastLoginAt = metadata.lastLoginAt;
    this._initializeTime();
  }
  toJSON() {
    return {
      createdAt: this.createdAt,
      lastLoginAt: this.lastLoginAt
    };
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function _reloadWithoutSaving(user) {
  var _a;
  const auth2 = user.auth;
  const idToken = await user.getIdToken();
  const response = await _logoutIfInvalidated(user, getAccountInfo(auth2, { idToken }));
  _assert(
    response === null || response === void 0 ? void 0 : response.users.length,
    auth2,
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  const coreAccount = response.users[0];
  user._notifyReloadListener(coreAccount);
  const newProviderData = ((_a = coreAccount.providerUserInfo) === null || _a === void 0 ? void 0 : _a.length) ? extractProviderData(coreAccount.providerUserInfo) : [];
  const providerData = mergeProviderData(user.providerData, newProviderData);
  const oldIsAnonymous = user.isAnonymous;
  const newIsAnonymous = !(user.email && coreAccount.passwordHash) && !(providerData === null || providerData === void 0 ? void 0 : providerData.length);
  const isAnonymous = !oldIsAnonymous ? false : newIsAnonymous;
  const updates = {
    uid: coreAccount.localId,
    displayName: coreAccount.displayName || null,
    photoURL: coreAccount.photoUrl || null,
    email: coreAccount.email || null,
    emailVerified: coreAccount.emailVerified || false,
    phoneNumber: coreAccount.phoneNumber || null,
    tenantId: coreAccount.tenantId || null,
    providerData,
    metadata: new UserMetadata(coreAccount.createdAt, coreAccount.lastLoginAt),
    isAnonymous
  };
  Object.assign(user, updates);
}
async function reload(user) {
  const userInternal = getModularInstance(user);
  await _reloadWithoutSaving(userInternal);
  await userInternal.auth._persistUserIfCurrent(userInternal);
  userInternal.auth._notifyListenersIfCurrent(userInternal);
}
function mergeProviderData(original, newData) {
  const deduped = original.filter((o) => !newData.some((n) => n.providerId === o.providerId));
  return [...deduped, ...newData];
}
function extractProviderData(providers) {
  return providers.map((_a) => {
    var { providerId } = _a, provider = __rest(_a, ["providerId"]);
    return {
      providerId,
      uid: provider.rawId || "",
      displayName: provider.displayName || null,
      email: provider.email || null,
      phoneNumber: provider.phoneNumber || null,
      photoURL: provider.photoUrl || null
    };
  });
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function requestStsToken(auth2, refreshToken) {
  const response = await _performFetchWithErrorHandling(auth2, {}, async () => {
    const body = querystring({
      "grant_type": "refresh_token",
      "refresh_token": refreshToken
    }).slice(1);
    const { tokenApiHost, apiKey } = auth2.config;
    const url = _getFinalTarget(auth2, tokenApiHost, "/v1/token", `key=${apiKey}`);
    const headers = await auth2._getAdditionalHeaders();
    headers[
      "Content-Type"
      /* HttpHeader.CONTENT_TYPE */
    ] = "application/x-www-form-urlencoded";
    return FetchProvider.fetch()(url, {
      method: "POST",
      headers,
      body
    });
  });
  return {
    accessToken: response.access_token,
    expiresIn: response.expires_in,
    refreshToken: response.refresh_token
  };
}
async function revokeToken(auth2, request) {
  return _performApiRequest(auth2, "POST", "/v2/accounts:revokeToken", _addTidIfNecessary(auth2, request));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class StsTokenManager {
  constructor() {
    this.refreshToken = null;
    this.accessToken = null;
    this.expirationTime = null;
  }
  get isExpired() {
    return !this.expirationTime || Date.now() > this.expirationTime - 3e4;
  }
  updateFromServerResponse(response) {
    _assert(
      response.idToken,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    _assert(
      typeof response.idToken !== "undefined",
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    _assert(
      typeof response.refreshToken !== "undefined",
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const expiresIn = "expiresIn" in response && typeof response.expiresIn !== "undefined" ? Number(response.expiresIn) : _tokenExpiresIn(response.idToken);
    this.updateTokensAndExpiration(response.idToken, response.refreshToken, expiresIn);
  }
  updateFromIdToken(idToken) {
    _assert(
      idToken.length !== 0,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const expiresIn = _tokenExpiresIn(idToken);
    this.updateTokensAndExpiration(idToken, null, expiresIn);
  }
  async getToken(auth2, forceRefresh = false) {
    if (!forceRefresh && this.accessToken && !this.isExpired) {
      return this.accessToken;
    }
    _assert(
      this.refreshToken,
      auth2,
      "user-token-expired"
      /* AuthErrorCode.TOKEN_EXPIRED */
    );
    if (this.refreshToken) {
      await this.refresh(auth2, this.refreshToken);
      return this.accessToken;
    }
    return null;
  }
  clearRefreshToken() {
    this.refreshToken = null;
  }
  async refresh(auth2, oldToken) {
    const { accessToken, refreshToken, expiresIn } = await requestStsToken(auth2, oldToken);
    this.updateTokensAndExpiration(accessToken, refreshToken, Number(expiresIn));
  }
  updateTokensAndExpiration(accessToken, refreshToken, expiresInSec) {
    this.refreshToken = refreshToken || null;
    this.accessToken = accessToken || null;
    this.expirationTime = Date.now() + expiresInSec * 1e3;
  }
  static fromJSON(appName, object) {
    const { refreshToken, accessToken, expirationTime } = object;
    const manager = new StsTokenManager();
    if (refreshToken) {
      _assert(typeof refreshToken === "string", "internal-error", {
        appName
      });
      manager.refreshToken = refreshToken;
    }
    if (accessToken) {
      _assert(typeof accessToken === "string", "internal-error", {
        appName
      });
      manager.accessToken = accessToken;
    }
    if (expirationTime) {
      _assert(typeof expirationTime === "number", "internal-error", {
        appName
      });
      manager.expirationTime = expirationTime;
    }
    return manager;
  }
  toJSON() {
    return {
      refreshToken: this.refreshToken,
      accessToken: this.accessToken,
      expirationTime: this.expirationTime
    };
  }
  _assign(stsTokenManager) {
    this.accessToken = stsTokenManager.accessToken;
    this.refreshToken = stsTokenManager.refreshToken;
    this.expirationTime = stsTokenManager.expirationTime;
  }
  _clone() {
    return Object.assign(new StsTokenManager(), this.toJSON());
  }
  _performRefresh() {
    return debugFail("not implemented");
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function assertStringOrUndefined(assertion, appName) {
  _assert(typeof assertion === "string" || typeof assertion === "undefined", "internal-error", { appName });
}
class UserImpl {
  constructor(_a) {
    var { uid, auth: auth2, stsTokenManager } = _a, opt = __rest(_a, ["uid", "auth", "stsTokenManager"]);
    this.providerId = "firebase";
    this.proactiveRefresh = new ProactiveRefresh(this);
    this.reloadUserInfo = null;
    this.reloadListener = null;
    this.uid = uid;
    this.auth = auth2;
    this.stsTokenManager = stsTokenManager;
    this.accessToken = stsTokenManager.accessToken;
    this.displayName = opt.displayName || null;
    this.email = opt.email || null;
    this.emailVerified = opt.emailVerified || false;
    this.phoneNumber = opt.phoneNumber || null;
    this.photoURL = opt.photoURL || null;
    this.isAnonymous = opt.isAnonymous || false;
    this.tenantId = opt.tenantId || null;
    this.providerData = opt.providerData ? [...opt.providerData] : [];
    this.metadata = new UserMetadata(opt.createdAt || void 0, opt.lastLoginAt || void 0);
  }
  async getIdToken(forceRefresh) {
    const accessToken = await _logoutIfInvalidated(this, this.stsTokenManager.getToken(this.auth, forceRefresh));
    _assert(
      accessToken,
      this.auth,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    if (this.accessToken !== accessToken) {
      this.accessToken = accessToken;
      await this.auth._persistUserIfCurrent(this);
      this.auth._notifyListenersIfCurrent(this);
    }
    return accessToken;
  }
  getIdTokenResult(forceRefresh) {
    return getIdTokenResult(this, forceRefresh);
  }
  reload() {
    return reload(this);
  }
  _assign(user) {
    if (this === user) {
      return;
    }
    _assert(
      this.uid === user.uid,
      this.auth,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    this.displayName = user.displayName;
    this.photoURL = user.photoURL;
    this.email = user.email;
    this.emailVerified = user.emailVerified;
    this.phoneNumber = user.phoneNumber;
    this.isAnonymous = user.isAnonymous;
    this.tenantId = user.tenantId;
    this.providerData = user.providerData.map((userInfo) => Object.assign({}, userInfo));
    this.metadata._copy(user.metadata);
    this.stsTokenManager._assign(user.stsTokenManager);
  }
  _clone(auth2) {
    const newUser = new UserImpl(Object.assign(Object.assign({}, this), { auth: auth2, stsTokenManager: this.stsTokenManager._clone() }));
    newUser.metadata._copy(this.metadata);
    return newUser;
  }
  _onReload(callback) {
    _assert(
      !this.reloadListener,
      this.auth,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    this.reloadListener = callback;
    if (this.reloadUserInfo) {
      this._notifyReloadListener(this.reloadUserInfo);
      this.reloadUserInfo = null;
    }
  }
  _notifyReloadListener(userInfo) {
    if (this.reloadListener) {
      this.reloadListener(userInfo);
    } else {
      this.reloadUserInfo = userInfo;
    }
  }
  _startProactiveRefresh() {
    this.proactiveRefresh._start();
  }
  _stopProactiveRefresh() {
    this.proactiveRefresh._stop();
  }
  async _updateTokensIfNecessary(response, reload2 = false) {
    let tokensRefreshed = false;
    if (response.idToken && response.idToken !== this.stsTokenManager.accessToken) {
      this.stsTokenManager.updateFromServerResponse(response);
      tokensRefreshed = true;
    }
    if (reload2) {
      await _reloadWithoutSaving(this);
    }
    await this.auth._persistUserIfCurrent(this);
    if (tokensRefreshed) {
      this.auth._notifyListenersIfCurrent(this);
    }
  }
  async delete() {
    if (_isFirebaseServerApp(this.auth.app)) {
      return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this.auth));
    }
    const idToken = await this.getIdToken();
    await _logoutIfInvalidated(this, deleteAccount(this.auth, { idToken }));
    this.stsTokenManager.clearRefreshToken();
    return this.auth.signOut();
  }
  toJSON() {
    return Object.assign(Object.assign({
      uid: this.uid,
      email: this.email || void 0,
      emailVerified: this.emailVerified,
      displayName: this.displayName || void 0,
      isAnonymous: this.isAnonymous,
      photoURL: this.photoURL || void 0,
      phoneNumber: this.phoneNumber || void 0,
      tenantId: this.tenantId || void 0,
      providerData: this.providerData.map((userInfo) => Object.assign({}, userInfo)),
      stsTokenManager: this.stsTokenManager.toJSON(),
      // Redirect event ID must be maintained in case there is a pending
      // redirect event.
      _redirectEventId: this._redirectEventId
    }, this.metadata.toJSON()), {
      // Required for compatibility with the legacy SDK (go/firebase-auth-sdk-persistence-parsing):
      apiKey: this.auth.config.apiKey,
      appName: this.auth.name
    });
  }
  get refreshToken() {
    return this.stsTokenManager.refreshToken || "";
  }
  static _fromJSON(auth2, object) {
    var _a, _b, _c, _d, _e2, _f, _g, _h;
    const displayName = (_a = object.displayName) !== null && _a !== void 0 ? _a : void 0;
    const email = (_b = object.email) !== null && _b !== void 0 ? _b : void 0;
    const phoneNumber = (_c = object.phoneNumber) !== null && _c !== void 0 ? _c : void 0;
    const photoURL = (_d = object.photoURL) !== null && _d !== void 0 ? _d : void 0;
    const tenantId = (_e2 = object.tenantId) !== null && _e2 !== void 0 ? _e2 : void 0;
    const _redirectEventId = (_f = object._redirectEventId) !== null && _f !== void 0 ? _f : void 0;
    const createdAt = (_g = object.createdAt) !== null && _g !== void 0 ? _g : void 0;
    const lastLoginAt = (_h = object.lastLoginAt) !== null && _h !== void 0 ? _h : void 0;
    const { uid, emailVerified, isAnonymous, providerData, stsTokenManager: plainObjectTokenManager } = object;
    _assert(
      uid && plainObjectTokenManager,
      auth2,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const stsTokenManager = StsTokenManager.fromJSON(this.name, plainObjectTokenManager);
    _assert(
      typeof uid === "string",
      auth2,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    assertStringOrUndefined(displayName, auth2.name);
    assertStringOrUndefined(email, auth2.name);
    _assert(
      typeof emailVerified === "boolean",
      auth2,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    _assert(
      typeof isAnonymous === "boolean",
      auth2,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    assertStringOrUndefined(phoneNumber, auth2.name);
    assertStringOrUndefined(photoURL, auth2.name);
    assertStringOrUndefined(tenantId, auth2.name);
    assertStringOrUndefined(_redirectEventId, auth2.name);
    assertStringOrUndefined(createdAt, auth2.name);
    assertStringOrUndefined(lastLoginAt, auth2.name);
    const user = new UserImpl({
      uid,
      auth: auth2,
      email,
      emailVerified,
      displayName,
      isAnonymous,
      photoURL,
      phoneNumber,
      tenantId,
      stsTokenManager,
      createdAt,
      lastLoginAt
    });
    if (providerData && Array.isArray(providerData)) {
      user.providerData = providerData.map((userInfo) => Object.assign({}, userInfo));
    }
    if (_redirectEventId) {
      user._redirectEventId = _redirectEventId;
    }
    return user;
  }
  /**
   * Initialize a User from an idToken server response
   * @param auth
   * @param idTokenResponse
   */
  static async _fromIdTokenResponse(auth2, idTokenResponse, isAnonymous = false) {
    const stsTokenManager = new StsTokenManager();
    stsTokenManager.updateFromServerResponse(idTokenResponse);
    const user = new UserImpl({
      uid: idTokenResponse.localId,
      auth: auth2,
      stsTokenManager,
      isAnonymous
    });
    await _reloadWithoutSaving(user);
    return user;
  }
  /**
   * Initialize a User from an idToken server response
   * @param auth
   * @param idTokenResponse
   */
  static async _fromGetAccountInfoResponse(auth2, response, idToken) {
    const coreAccount = response.users[0];
    _assert(
      coreAccount.localId !== void 0,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const providerData = coreAccount.providerUserInfo !== void 0 ? extractProviderData(coreAccount.providerUserInfo) : [];
    const isAnonymous = !(coreAccount.email && coreAccount.passwordHash) && !(providerData === null || providerData === void 0 ? void 0 : providerData.length);
    const stsTokenManager = new StsTokenManager();
    stsTokenManager.updateFromIdToken(idToken);
    const user = new UserImpl({
      uid: coreAccount.localId,
      auth: auth2,
      stsTokenManager,
      isAnonymous
    });
    const updates = {
      uid: coreAccount.localId,
      displayName: coreAccount.displayName || null,
      photoURL: coreAccount.photoUrl || null,
      email: coreAccount.email || null,
      emailVerified: coreAccount.emailVerified || false,
      phoneNumber: coreAccount.phoneNumber || null,
      tenantId: coreAccount.tenantId || null,
      providerData,
      metadata: new UserMetadata(coreAccount.createdAt, coreAccount.lastLoginAt),
      isAnonymous: !(coreAccount.email && coreAccount.passwordHash) && !(providerData === null || providerData === void 0 ? void 0 : providerData.length)
    };
    Object.assign(user, updates);
    return user;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const instanceCache = /* @__PURE__ */ new Map();
function _getInstance(cls) {
  debugAssert(cls instanceof Function, "Expected a class definition");
  let instance = instanceCache.get(cls);
  if (instance) {
    debugAssert(instance instanceof cls, "Instance stored in cache mismatched with class");
    return instance;
  }
  instance = new cls();
  instanceCache.set(cls, instance);
  return instance;
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class InMemoryPersistence {
  constructor() {
    this.type = "NONE";
    this.storage = {};
  }
  async _isAvailable() {
    return true;
  }
  async _set(key, value) {
    this.storage[key] = value;
  }
  async _get(key) {
    const value = this.storage[key];
    return value === void 0 ? null : value;
  }
  async _remove(key) {
    delete this.storage[key];
  }
  _addListener(_key, _listener) {
    return;
  }
  _removeListener(_key, _listener) {
    return;
  }
}
InMemoryPersistence.type = "NONE";
const inMemoryPersistence = InMemoryPersistence;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _persistenceKeyName(key, apiKey, appName) {
  return `${"firebase"}:${key}:${apiKey}:${appName}`;
}
class PersistenceUserManager {
  constructor(persistence, auth2, userKey) {
    this.persistence = persistence;
    this.auth = auth2;
    this.userKey = userKey;
    const { config, name: name2 } = this.auth;
    this.fullUserKey = _persistenceKeyName(this.userKey, config.apiKey, name2);
    this.fullPersistenceKey = _persistenceKeyName("persistence", config.apiKey, name2);
    this.boundEventHandler = auth2._onStorageEvent.bind(auth2);
    this.persistence._addListener(this.fullUserKey, this.boundEventHandler);
  }
  setCurrentUser(user) {
    return this.persistence._set(this.fullUserKey, user.toJSON());
  }
  async getCurrentUser() {
    const blob = await this.persistence._get(this.fullUserKey);
    return blob ? UserImpl._fromJSON(this.auth, blob) : null;
  }
  removeCurrentUser() {
    return this.persistence._remove(this.fullUserKey);
  }
  savePersistenceForRedirect() {
    return this.persistence._set(this.fullPersistenceKey, this.persistence.type);
  }
  async setPersistence(newPersistence) {
    if (this.persistence === newPersistence) {
      return;
    }
    const currentUser = await this.getCurrentUser();
    await this.removeCurrentUser();
    this.persistence = newPersistence;
    if (currentUser) {
      return this.setCurrentUser(currentUser);
    }
  }
  delete() {
    this.persistence._removeListener(this.fullUserKey, this.boundEventHandler);
  }
  static async create(auth2, persistenceHierarchy, userKey = "authUser") {
    if (!persistenceHierarchy.length) {
      return new PersistenceUserManager(_getInstance(inMemoryPersistence), auth2, userKey);
    }
    const availablePersistences = (await Promise.all(persistenceHierarchy.map(async (persistence) => {
      if (await persistence._isAvailable()) {
        return persistence;
      }
      return void 0;
    }))).filter((persistence) => persistence);
    let selectedPersistence = availablePersistences[0] || _getInstance(inMemoryPersistence);
    const key = _persistenceKeyName(userKey, auth2.config.apiKey, auth2.name);
    let userToMigrate = null;
    for (const persistence of persistenceHierarchy) {
      try {
        const blob = await persistence._get(key);
        if (blob) {
          const user = UserImpl._fromJSON(auth2, blob);
          if (persistence !== selectedPersistence) {
            userToMigrate = user;
          }
          selectedPersistence = persistence;
          break;
        }
      } catch (_a) {
      }
    }
    const migrationHierarchy = availablePersistences.filter((p) => p._shouldAllowMigration);
    if (!selectedPersistence._shouldAllowMigration || !migrationHierarchy.length) {
      return new PersistenceUserManager(selectedPersistence, auth2, userKey);
    }
    selectedPersistence = migrationHierarchy[0];
    if (userToMigrate) {
      await selectedPersistence._set(key, userToMigrate.toJSON());
    }
    await Promise.all(persistenceHierarchy.map(async (persistence) => {
      if (persistence !== selectedPersistence) {
        try {
          await persistence._remove(key);
        } catch (_a) {
        }
      }
    }));
    return new PersistenceUserManager(selectedPersistence, auth2, userKey);
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _getBrowserName(userAgent) {
  const ua = userAgent.toLowerCase();
  if (ua.includes("opera/") || ua.includes("opr/") || ua.includes("opios/")) {
    return "Opera";
  } else if (_isIEMobile(ua)) {
    return "IEMobile";
  } else if (ua.includes("msie") || ua.includes("trident/")) {
    return "IE";
  } else if (ua.includes("edge/")) {
    return "Edge";
  } else if (_isFirefox(ua)) {
    return "Firefox";
  } else if (ua.includes("silk/")) {
    return "Silk";
  } else if (_isBlackBerry(ua)) {
    return "Blackberry";
  } else if (_isWebOS(ua)) {
    return "Webos";
  } else if (_isSafari(ua)) {
    return "Safari";
  } else if ((ua.includes("chrome/") || _isChromeIOS(ua)) && !ua.includes("edge/")) {
    return "Chrome";
  } else if (_isAndroid(ua)) {
    return "Android";
  } else {
    const re2 = /([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/;
    const matches = userAgent.match(re2);
    if ((matches === null || matches === void 0 ? void 0 : matches.length) === 2) {
      return matches[1];
    }
  }
  return "Other";
}
function _isFirefox(ua = getUA()) {
  return /firefox\//i.test(ua);
}
function _isSafari(userAgent = getUA()) {
  const ua = userAgent.toLowerCase();
  return ua.includes("safari/") && !ua.includes("chrome/") && !ua.includes("crios/") && !ua.includes("android");
}
function _isChromeIOS(ua = getUA()) {
  return /crios\//i.test(ua);
}
function _isIEMobile(ua = getUA()) {
  return /iemobile/i.test(ua);
}
function _isAndroid(ua = getUA()) {
  return /android/i.test(ua);
}
function _isBlackBerry(ua = getUA()) {
  return /blackberry/i.test(ua);
}
function _isWebOS(ua = getUA()) {
  return /webos/i.test(ua);
}
function _isIOS(ua = getUA()) {
  return /iphone|ipad|ipod/i.test(ua) || /macintosh/i.test(ua) && /mobile/i.test(ua);
}
function _isIOSStandalone(ua = getUA()) {
  var _a;
  return _isIOS(ua) && !!((_a = window.navigator) === null || _a === void 0 ? void 0 : _a.standalone);
}
function _isIE10() {
  return isIE() && document.documentMode === 10;
}
function _isMobileBrowser(ua = getUA()) {
  return _isIOS(ua) || _isAndroid(ua) || _isWebOS(ua) || _isBlackBerry(ua) || /windows phone/i.test(ua) || _isIEMobile(ua);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _getClientVersion(clientPlatform, frameworks = []) {
  let reportedPlatform;
  switch (clientPlatform) {
    case "Browser":
      reportedPlatform = _getBrowserName(getUA());
      break;
    case "Worker":
      reportedPlatform = `${_getBrowserName(getUA())}-${clientPlatform}`;
      break;
    default:
      reportedPlatform = clientPlatform;
  }
  const reportedFrameworks = frameworks.length ? frameworks.join(",") : "FirebaseCore-web";
  return `${reportedPlatform}/${"JsCore"}/${SDK_VERSION}/${reportedFrameworks}`;
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class AuthMiddlewareQueue {
  constructor(auth2) {
    this.auth = auth2;
    this.queue = [];
  }
  pushCallback(callback, onAbort) {
    const wrappedCallback = (user) => new Promise((resolve, reject) => {
      try {
        const result = callback(user);
        resolve(result);
      } catch (e) {
        reject(e);
      }
    });
    wrappedCallback.onAbort = onAbort;
    this.queue.push(wrappedCallback);
    const index = this.queue.length - 1;
    return () => {
      this.queue[index] = () => Promise.resolve();
    };
  }
  async runMiddleware(nextUser) {
    if (this.auth.currentUser === nextUser) {
      return;
    }
    const onAbortStack = [];
    try {
      for (const beforeStateCallback of this.queue) {
        await beforeStateCallback(nextUser);
        if (beforeStateCallback.onAbort) {
          onAbortStack.push(beforeStateCallback.onAbort);
        }
      }
    } catch (e) {
      onAbortStack.reverse();
      for (const onAbort of onAbortStack) {
        try {
          onAbort();
        } catch (_) {
        }
      }
      throw this.auth._errorFactory.create("login-blocked", {
        originalMessage: e === null || e === void 0 ? void 0 : e.message
      });
    }
  }
}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function _getPasswordPolicy(auth2, request = {}) {
  return _performApiRequest(auth2, "GET", "/v2/passwordPolicy", _addTidIfNecessary(auth2, request));
}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const MINIMUM_MIN_PASSWORD_LENGTH = 6;
class PasswordPolicyImpl {
  constructor(response) {
    var _a, _b, _c, _d;
    const responseOptions = response.customStrengthOptions;
    this.customStrengthOptions = {};
    this.customStrengthOptions.minPasswordLength = (_a = responseOptions.minPasswordLength) !== null && _a !== void 0 ? _a : MINIMUM_MIN_PASSWORD_LENGTH;
    if (responseOptions.maxPasswordLength) {
      this.customStrengthOptions.maxPasswordLength = responseOptions.maxPasswordLength;
    }
    if (responseOptions.containsLowercaseCharacter !== void 0) {
      this.customStrengthOptions.containsLowercaseLetter = responseOptions.containsLowercaseCharacter;
    }
    if (responseOptions.containsUppercaseCharacter !== void 0) {
      this.customStrengthOptions.containsUppercaseLetter = responseOptions.containsUppercaseCharacter;
    }
    if (responseOptions.containsNumericCharacter !== void 0) {
      this.customStrengthOptions.containsNumericCharacter = responseOptions.containsNumericCharacter;
    }
    if (responseOptions.containsNonAlphanumericCharacter !== void 0) {
      this.customStrengthOptions.containsNonAlphanumericCharacter = responseOptions.containsNonAlphanumericCharacter;
    }
    this.enforcementState = response.enforcementState;
    if (this.enforcementState === "ENFORCEMENT_STATE_UNSPECIFIED") {
      this.enforcementState = "OFF";
    }
    this.allowedNonAlphanumericCharacters = (_c = (_b = response.allowedNonAlphanumericCharacters) === null || _b === void 0 ? void 0 : _b.join("")) !== null && _c !== void 0 ? _c : "";
    this.forceUpgradeOnSignin = (_d = response.forceUpgradeOnSignin) !== null && _d !== void 0 ? _d : false;
    this.schemaVersion = response.schemaVersion;
  }
  validatePassword(password) {
    var _a, _b, _c, _d, _e2, _f;
    const status = {
      isValid: true,
      passwordPolicy: this
    };
    this.validatePasswordLengthOptions(password, status);
    this.validatePasswordCharacterOptions(password, status);
    status.isValid && (status.isValid = (_a = status.meetsMinPasswordLength) !== null && _a !== void 0 ? _a : true);
    status.isValid && (status.isValid = (_b = status.meetsMaxPasswordLength) !== null && _b !== void 0 ? _b : true);
    status.isValid && (status.isValid = (_c = status.containsLowercaseLetter) !== null && _c !== void 0 ? _c : true);
    status.isValid && (status.isValid = (_d = status.containsUppercaseLetter) !== null && _d !== void 0 ? _d : true);
    status.isValid && (status.isValid = (_e2 = status.containsNumericCharacter) !== null && _e2 !== void 0 ? _e2 : true);
    status.isValid && (status.isValid = (_f = status.containsNonAlphanumericCharacter) !== null && _f !== void 0 ? _f : true);
    return status;
  }
  /**
   * Validates that the password meets the length options for the policy.
   *
   * @param password Password to validate.
   * @param status Validation status.
   */
  validatePasswordLengthOptions(password, status) {
    const minPasswordLength = this.customStrengthOptions.minPasswordLength;
    const maxPasswordLength = this.customStrengthOptions.maxPasswordLength;
    if (minPasswordLength) {
      status.meetsMinPasswordLength = password.length >= minPasswordLength;
    }
    if (maxPasswordLength) {
      status.meetsMaxPasswordLength = password.length <= maxPasswordLength;
    }
  }
  /**
   * Validates that the password meets the character options for the policy.
   *
   * @param password Password to validate.
   * @param status Validation status.
   */
  validatePasswordCharacterOptions(password, status) {
    this.updatePasswordCharacterOptionsStatuses(
      status,
      /* containsLowercaseCharacter= */
      false,
      /* containsUppercaseCharacter= */
      false,
      /* containsNumericCharacter= */
      false,
      /* containsNonAlphanumericCharacter= */
      false
    );
    let passwordChar;
    for (let i = 0; i < password.length; i++) {
      passwordChar = password.charAt(i);
      this.updatePasswordCharacterOptionsStatuses(
        status,
        /* containsLowercaseCharacter= */
        passwordChar >= "a" && passwordChar <= "z",
        /* containsUppercaseCharacter= */
        passwordChar >= "A" && passwordChar <= "Z",
        /* containsNumericCharacter= */
        passwordChar >= "0" && passwordChar <= "9",
        /* containsNonAlphanumericCharacter= */
        this.allowedNonAlphanumericCharacters.includes(passwordChar)
      );
    }
  }
  /**
   * Updates the running validation status with the statuses for the character options.
   * Expected to be called each time a character is processed to update each option status
   * based on the current character.
   *
   * @param status Validation status.
   * @param containsLowercaseCharacter Whether the character is a lowercase letter.
   * @param containsUppercaseCharacter Whether the character is an uppercase letter.
   * @param containsNumericCharacter Whether the character is a numeric character.
   * @param containsNonAlphanumericCharacter Whether the character is a non-alphanumeric character.
   */
  updatePasswordCharacterOptionsStatuses(status, containsLowercaseCharacter, containsUppercaseCharacter, containsNumericCharacter, containsNonAlphanumericCharacter) {
    if (this.customStrengthOptions.containsLowercaseLetter) {
      status.containsLowercaseLetter || (status.containsLowercaseLetter = containsLowercaseCharacter);
    }
    if (this.customStrengthOptions.containsUppercaseLetter) {
      status.containsUppercaseLetter || (status.containsUppercaseLetter = containsUppercaseCharacter);
    }
    if (this.customStrengthOptions.containsNumericCharacter) {
      status.containsNumericCharacter || (status.containsNumericCharacter = containsNumericCharacter);
    }
    if (this.customStrengthOptions.containsNonAlphanumericCharacter) {
      status.containsNonAlphanumericCharacter || (status.containsNonAlphanumericCharacter = containsNonAlphanumericCharacter);
    }
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class AuthImpl {
  constructor(app2, heartbeatServiceProvider, appCheckServiceProvider, config) {
    this.app = app2;
    this.heartbeatServiceProvider = heartbeatServiceProvider;
    this.appCheckServiceProvider = appCheckServiceProvider;
    this.config = config;
    this.currentUser = null;
    this.emulatorConfig = null;
    this.operations = Promise.resolve();
    this.authStateSubscription = new Subscription(this);
    this.idTokenSubscription = new Subscription(this);
    this.beforeStateQueue = new AuthMiddlewareQueue(this);
    this.redirectUser = null;
    this.isProactiveRefreshEnabled = false;
    this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION = 1;
    this._canInitEmulator = true;
    this._isInitialized = false;
    this._deleted = false;
    this._initializationPromise = null;
    this._popupRedirectResolver = null;
    this._errorFactory = _DEFAULT_AUTH_ERROR_FACTORY;
    this._agentRecaptchaConfig = null;
    this._tenantRecaptchaConfigs = {};
    this._projectPasswordPolicy = null;
    this._tenantPasswordPolicies = {};
    this.lastNotifiedUid = void 0;
    this.languageCode = null;
    this.tenantId = null;
    this.settings = { appVerificationDisabledForTesting: false };
    this.frameworks = [];
    this.name = app2.name;
    this.clientVersion = config.sdkClientVersion;
  }
  _initializeWithPersistence(persistenceHierarchy, popupRedirectResolver) {
    if (popupRedirectResolver) {
      this._popupRedirectResolver = _getInstance(popupRedirectResolver);
    }
    this._initializationPromise = this.queue(async () => {
      var _a, _b;
      if (this._deleted) {
        return;
      }
      this.persistenceManager = await PersistenceUserManager.create(this, persistenceHierarchy);
      if (this._deleted) {
        return;
      }
      if ((_a = this._popupRedirectResolver) === null || _a === void 0 ? void 0 : _a._shouldInitProactively) {
        try {
          await this._popupRedirectResolver._initialize(this);
        } catch (e) {
        }
      }
      await this.initializeCurrentUser(popupRedirectResolver);
      this.lastNotifiedUid = ((_b = this.currentUser) === null || _b === void 0 ? void 0 : _b.uid) || null;
      if (this._deleted) {
        return;
      }
      this._isInitialized = true;
    });
    return this._initializationPromise;
  }
  /**
   * If the persistence is changed in another window, the user manager will let us know
   */
  async _onStorageEvent() {
    if (this._deleted) {
      return;
    }
    const user = await this.assertedPersistence.getCurrentUser();
    if (!this.currentUser && !user) {
      return;
    }
    if (this.currentUser && user && this.currentUser.uid === user.uid) {
      this._currentUser._assign(user);
      await this.currentUser.getIdToken();
      return;
    }
    await this._updateCurrentUser(
      user,
      /* skipBeforeStateCallbacks */
      true
    );
  }
  async initializeCurrentUserFromIdToken(idToken) {
    try {
      const response = await getAccountInfo(this, { idToken });
      const user = await UserImpl._fromGetAccountInfoResponse(this, response, idToken);
      await this.directlySetCurrentUser(user);
    } catch (err) {
      console.warn("FirebaseServerApp could not login user with provided authIdToken: ", err);
      await this.directlySetCurrentUser(null);
    }
  }
  async initializeCurrentUser(popupRedirectResolver) {
    var _a;
    if (_isFirebaseServerApp(this.app)) {
      const idToken = this.app.settings.authIdToken;
      if (idToken) {
        return new Promise((resolve) => {
          setTimeout(() => this.initializeCurrentUserFromIdToken(idToken).then(resolve, resolve));
        });
      } else {
        return this.directlySetCurrentUser(null);
      }
    }
    const previouslyStoredUser = await this.assertedPersistence.getCurrentUser();
    let futureCurrentUser = previouslyStoredUser;
    let needsTocheckMiddleware = false;
    if (popupRedirectResolver && this.config.authDomain) {
      await this.getOrInitRedirectPersistenceManager();
      const redirectUserEventId = (_a = this.redirectUser) === null || _a === void 0 ? void 0 : _a._redirectEventId;
      const storedUserEventId = futureCurrentUser === null || futureCurrentUser === void 0 ? void 0 : futureCurrentUser._redirectEventId;
      const result = await this.tryRedirectSignIn(popupRedirectResolver);
      if ((!redirectUserEventId || redirectUserEventId === storedUserEventId) && (result === null || result === void 0 ? void 0 : result.user)) {
        futureCurrentUser = result.user;
        needsTocheckMiddleware = true;
      }
    }
    if (!futureCurrentUser) {
      return this.directlySetCurrentUser(null);
    }
    if (!futureCurrentUser._redirectEventId) {
      if (needsTocheckMiddleware) {
        try {
          await this.beforeStateQueue.runMiddleware(futureCurrentUser);
        } catch (e) {
          futureCurrentUser = previouslyStoredUser;
          this._popupRedirectResolver._overrideRedirectResult(this, () => Promise.reject(e));
        }
      }
      if (futureCurrentUser) {
        return this.reloadAndSetCurrentUserOrClear(futureCurrentUser);
      } else {
        return this.directlySetCurrentUser(null);
      }
    }
    _assert(
      this._popupRedirectResolver,
      this,
      "argument-error"
      /* AuthErrorCode.ARGUMENT_ERROR */
    );
    await this.getOrInitRedirectPersistenceManager();
    if (this.redirectUser && this.redirectUser._redirectEventId === futureCurrentUser._redirectEventId) {
      return this.directlySetCurrentUser(futureCurrentUser);
    }
    return this.reloadAndSetCurrentUserOrClear(futureCurrentUser);
  }
  async tryRedirectSignIn(redirectResolver) {
    let result = null;
    try {
      result = await this._popupRedirectResolver._completeRedirectFn(this, redirectResolver, true);
    } catch (e) {
      await this._setRedirectUser(null);
    }
    return result;
  }
  async reloadAndSetCurrentUserOrClear(user) {
    try {
      await _reloadWithoutSaving(user);
    } catch (e) {
      if ((e === null || e === void 0 ? void 0 : e.code) !== `auth/${"network-request-failed"}`) {
        return this.directlySetCurrentUser(null);
      }
    }
    return this.directlySetCurrentUser(user);
  }
  useDeviceLanguage() {
    this.languageCode = _getUserLanguage();
  }
  async _delete() {
    this._deleted = true;
  }
  async updateCurrentUser(userExtern) {
    if (_isFirebaseServerApp(this.app)) {
      return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));
    }
    const user = userExtern ? getModularInstance(userExtern) : null;
    if (user) {
      _assert(
        user.auth.config.apiKey === this.config.apiKey,
        this,
        "invalid-user-token"
        /* AuthErrorCode.INVALID_AUTH */
      );
    }
    return this._updateCurrentUser(user && user._clone(this));
  }
  async _updateCurrentUser(user, skipBeforeStateCallbacks = false) {
    if (this._deleted) {
      return;
    }
    if (user) {
      _assert(
        this.tenantId === user.tenantId,
        this,
        "tenant-id-mismatch"
        /* AuthErrorCode.TENANT_ID_MISMATCH */
      );
    }
    if (!skipBeforeStateCallbacks) {
      await this.beforeStateQueue.runMiddleware(user);
    }
    return this.queue(async () => {
      await this.directlySetCurrentUser(user);
      this.notifyAuthListeners();
    });
  }
  async signOut() {
    if (_isFirebaseServerApp(this.app)) {
      return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));
    }
    await this.beforeStateQueue.runMiddleware(null);
    if (this.redirectPersistenceManager || this._popupRedirectResolver) {
      await this._setRedirectUser(null);
    }
    return this._updateCurrentUser(
      null,
      /* skipBeforeStateCallbacks */
      true
    );
  }
  setPersistence(persistence) {
    if (_isFirebaseServerApp(this.app)) {
      return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));
    }
    return this.queue(async () => {
      await this.assertedPersistence.setPersistence(_getInstance(persistence));
    });
  }
  _getRecaptchaConfig() {
    if (this.tenantId == null) {
      return this._agentRecaptchaConfig;
    } else {
      return this._tenantRecaptchaConfigs[this.tenantId];
    }
  }
  async validatePassword(password) {
    if (!this._getPasswordPolicyInternal()) {
      await this._updatePasswordPolicy();
    }
    const passwordPolicy = this._getPasswordPolicyInternal();
    if (passwordPolicy.schemaVersion !== this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION) {
      return Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version", {}));
    }
    return passwordPolicy.validatePassword(password);
  }
  _getPasswordPolicyInternal() {
    if (this.tenantId === null) {
      return this._projectPasswordPolicy;
    } else {
      return this._tenantPasswordPolicies[this.tenantId];
    }
  }
  async _updatePasswordPolicy() {
    const response = await _getPasswordPolicy(this);
    const passwordPolicy = new PasswordPolicyImpl(response);
    if (this.tenantId === null) {
      this._projectPasswordPolicy = passwordPolicy;
    } else {
      this._tenantPasswordPolicies[this.tenantId] = passwordPolicy;
    }
  }
  _getPersistence() {
    return this.assertedPersistence.persistence.type;
  }
  _updateErrorMap(errorMap) {
    this._errorFactory = new ErrorFactory("auth", "Firebase", errorMap());
  }
  onAuthStateChanged(nextOrObserver, error, completed) {
    return this.registerStateListener(this.authStateSubscription, nextOrObserver, error, completed);
  }
  beforeAuthStateChanged(callback, onAbort) {
    return this.beforeStateQueue.pushCallback(callback, onAbort);
  }
  onIdTokenChanged(nextOrObserver, error, completed) {
    return this.registerStateListener(this.idTokenSubscription, nextOrObserver, error, completed);
  }
  authStateReady() {
    return new Promise((resolve, reject) => {
      if (this.currentUser) {
        resolve();
      } else {
        const unsubscribe = this.onAuthStateChanged(() => {
          unsubscribe();
          resolve();
        }, reject);
      }
    });
  }
  /**
   * Revokes the given access token. Currently only supports Apple OAuth access tokens.
   */
  async revokeAccessToken(token) {
    if (this.currentUser) {
      const idToken = await this.currentUser.getIdToken();
      const request = {
        providerId: "apple.com",
        tokenType: "ACCESS_TOKEN",
        token,
        idToken
      };
      if (this.tenantId != null) {
        request.tenantId = this.tenantId;
      }
      await revokeToken(this, request);
    }
  }
  toJSON() {
    var _a;
    return {
      apiKey: this.config.apiKey,
      authDomain: this.config.authDomain,
      appName: this.name,
      currentUser: (_a = this._currentUser) === null || _a === void 0 ? void 0 : _a.toJSON()
    };
  }
  async _setRedirectUser(user, popupRedirectResolver) {
    const redirectManager = await this.getOrInitRedirectPersistenceManager(popupRedirectResolver);
    return user === null ? redirectManager.removeCurrentUser() : redirectManager.setCurrentUser(user);
  }
  async getOrInitRedirectPersistenceManager(popupRedirectResolver) {
    if (!this.redirectPersistenceManager) {
      const resolver = popupRedirectResolver && _getInstance(popupRedirectResolver) || this._popupRedirectResolver;
      _assert(
        resolver,
        this,
        "argument-error"
        /* AuthErrorCode.ARGUMENT_ERROR */
      );
      this.redirectPersistenceManager = await PersistenceUserManager.create(
        this,
        [_getInstance(resolver._redirectPersistence)],
        "redirectUser"
        /* KeyName.REDIRECT_USER */
      );
      this.redirectUser = await this.redirectPersistenceManager.getCurrentUser();
    }
    return this.redirectPersistenceManager;
  }
  async _redirectUserForId(id) {
    var _a, _b;
    if (this._isInitialized) {
      await this.queue(async () => {
      });
    }
    if (((_a = this._currentUser) === null || _a === void 0 ? void 0 : _a._redirectEventId) === id) {
      return this._currentUser;
    }
    if (((_b = this.redirectUser) === null || _b === void 0 ? void 0 : _b._redirectEventId) === id) {
      return this.redirectUser;
    }
    return null;
  }
  async _persistUserIfCurrent(user) {
    if (user === this.currentUser) {
      return this.queue(async () => this.directlySetCurrentUser(user));
    }
  }
  /** Notifies listeners only if the user is current */
  _notifyListenersIfCurrent(user) {
    if (user === this.currentUser) {
      this.notifyAuthListeners();
    }
  }
  _key() {
    return `${this.config.authDomain}:${this.config.apiKey}:${this.name}`;
  }
  _startProactiveRefresh() {
    this.isProactiveRefreshEnabled = true;
    if (this.currentUser) {
      this._currentUser._startProactiveRefresh();
    }
  }
  _stopProactiveRefresh() {
    this.isProactiveRefreshEnabled = false;
    if (this.currentUser) {
      this._currentUser._stopProactiveRefresh();
    }
  }
  /** Returns the current user cast as the internal type */
  get _currentUser() {
    return this.currentUser;
  }
  notifyAuthListeners() {
    var _a, _b;
    if (!this._isInitialized) {
      return;
    }
    this.idTokenSubscription.next(this.currentUser);
    const currentUid = (_b = (_a = this.currentUser) === null || _a === void 0 ? void 0 : _a.uid) !== null && _b !== void 0 ? _b : null;
    if (this.lastNotifiedUid !== currentUid) {
      this.lastNotifiedUid = currentUid;
      this.authStateSubscription.next(this.currentUser);
    }
  }
  registerStateListener(subscription, nextOrObserver, error, completed) {
    if (this._deleted) {
      return () => {
      };
    }
    const cb = typeof nextOrObserver === "function" ? nextOrObserver : nextOrObserver.next.bind(nextOrObserver);
    let isUnsubscribed = false;
    const promise = this._isInitialized ? Promise.resolve() : this._initializationPromise;
    _assert(
      promise,
      this,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    promise.then(() => {
      if (isUnsubscribed) {
        return;
      }
      cb(this.currentUser);
    });
    if (typeof nextOrObserver === "function") {
      const unsubscribe = subscription.addObserver(nextOrObserver, error, completed);
      return () => {
        isUnsubscribed = true;
        unsubscribe();
      };
    } else {
      const unsubscribe = subscription.addObserver(nextOrObserver);
      return () => {
        isUnsubscribed = true;
        unsubscribe();
      };
    }
  }
  /**
   * Unprotected (from race conditions) method to set the current user. This
   * should only be called from within a queued callback. This is necessary
   * because the queue shouldn't rely on another queued callback.
   */
  async directlySetCurrentUser(user) {
    if (this.currentUser && this.currentUser !== user) {
      this._currentUser._stopProactiveRefresh();
    }
    if (user && this.isProactiveRefreshEnabled) {
      user._startProactiveRefresh();
    }
    this.currentUser = user;
    if (user) {
      await this.assertedPersistence.setCurrentUser(user);
    } else {
      await this.assertedPersistence.removeCurrentUser();
    }
  }
  queue(action) {
    this.operations = this.operations.then(action, action);
    return this.operations;
  }
  get assertedPersistence() {
    _assert(
      this.persistenceManager,
      this,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    return this.persistenceManager;
  }
  _logFramework(framework) {
    if (!framework || this.frameworks.includes(framework)) {
      return;
    }
    this.frameworks.push(framework);
    this.frameworks.sort();
    this.clientVersion = _getClientVersion(this.config.clientPlatform, this._getFrameworks());
  }
  _getFrameworks() {
    return this.frameworks;
  }
  async _getAdditionalHeaders() {
    var _a;
    const headers = {
      [
        "X-Client-Version"
        /* HttpHeader.X_CLIENT_VERSION */
      ]: this.clientVersion
    };
    if (this.app.options.appId) {
      headers[
        "X-Firebase-gmpid"
        /* HttpHeader.X_FIREBASE_GMPID */
      ] = this.app.options.appId;
    }
    const heartbeatsHeader = await ((_a = this.heartbeatServiceProvider.getImmediate({
      optional: true
    })) === null || _a === void 0 ? void 0 : _a.getHeartbeatsHeader());
    if (heartbeatsHeader) {
      headers[
        "X-Firebase-Client"
        /* HttpHeader.X_FIREBASE_CLIENT */
      ] = heartbeatsHeader;
    }
    const appCheckToken = await this._getAppCheckToken();
    if (appCheckToken) {
      headers[
        "X-Firebase-AppCheck"
        /* HttpHeader.X_FIREBASE_APP_CHECK */
      ] = appCheckToken;
    }
    return headers;
  }
  async _getAppCheckToken() {
    var _a;
    const appCheckTokenResult = await ((_a = this.appCheckServiceProvider.getImmediate({ optional: true })) === null || _a === void 0 ? void 0 : _a.getToken());
    if (appCheckTokenResult === null || appCheckTokenResult === void 0 ? void 0 : appCheckTokenResult.error) {
      _logWarn(`Error while retrieving App Check token: ${appCheckTokenResult.error}`);
    }
    return appCheckTokenResult === null || appCheckTokenResult === void 0 ? void 0 : appCheckTokenResult.token;
  }
}
function _castAuth(auth2) {
  return getModularInstance(auth2);
}
class Subscription {
  constructor(auth2) {
    this.auth = auth2;
    this.observer = null;
    this.addObserver = createSubscribe((observer) => this.observer = observer);
  }
  get next() {
    _assert(
      this.observer,
      this.auth,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    return this.observer.next.bind(this.observer);
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let externalJSProvider = {
  async loadJS() {
    throw new Error("Unable to load external scripts");
  },
  recaptchaV2Script: "",
  recaptchaEnterpriseScript: "",
  gapiScript: ""
};
function _setExternalJSProvider(p) {
  externalJSProvider = p;
}
function _loadJS(url) {
  return externalJSProvider.loadJS(url);
}
function _recaptchaEnterpriseScriptUrl() {
  return externalJSProvider.recaptchaEnterpriseScript;
}
function _gapiScriptUrl() {
  return externalJSProvider.gapiScript;
}
function _generateCallbackName(prefix) {
  return `__${prefix}${Math.floor(Math.random() * 1e6)}`;
}
const RECAPTCHA_ENTERPRISE_VERIFIER_TYPE = "recaptcha-enterprise";
const FAKE_TOKEN = "NO_RECAPTCHA";
class RecaptchaEnterpriseVerifier {
  /**
   *
   * @param authExtern - The corresponding Firebase {@link Auth} instance.
   *
   */
  constructor(authExtern) {
    this.type = RECAPTCHA_ENTERPRISE_VERIFIER_TYPE;
    this.auth = _castAuth(authExtern);
  }
  /**
   * Executes the verification process.
   *
   * @returns A Promise for a token that can be used to assert the validity of a request.
   */
  async verify(action = "verify", forceRefresh = false) {
    async function retrieveSiteKey(auth2) {
      if (!forceRefresh) {
        if (auth2.tenantId == null && auth2._agentRecaptchaConfig != null) {
          return auth2._agentRecaptchaConfig.siteKey;
        }
        if (auth2.tenantId != null && auth2._tenantRecaptchaConfigs[auth2.tenantId] !== void 0) {
          return auth2._tenantRecaptchaConfigs[auth2.tenantId].siteKey;
        }
      }
      return new Promise(async (resolve, reject) => {
        getRecaptchaConfig(auth2, {
          clientType: "CLIENT_TYPE_WEB",
          version: "RECAPTCHA_ENTERPRISE"
          /* RecaptchaVersion.ENTERPRISE */
        }).then((response) => {
          if (response.recaptchaKey === void 0) {
            reject(new Error("recaptcha Enterprise site key undefined"));
          } else {
            const config = new RecaptchaConfig(response);
            if (auth2.tenantId == null) {
              auth2._agentRecaptchaConfig = config;
            } else {
              auth2._tenantRecaptchaConfigs[auth2.tenantId] = config;
            }
            return resolve(config.siteKey);
          }
        }).catch((error) => {
          reject(error);
        });
      });
    }
    function retrieveRecaptchaToken(siteKey, resolve, reject) {
      const grecaptcha = window.grecaptcha;
      if (isEnterprise(grecaptcha)) {
        grecaptcha.enterprise.ready(() => {
          grecaptcha.enterprise.execute(siteKey, { action }).then((token) => {
            resolve(token);
          }).catch(() => {
            resolve(FAKE_TOKEN);
          });
        });
      } else {
        reject(Error("No reCAPTCHA enterprise script loaded."));
      }
    }
    return new Promise((resolve, reject) => {
      retrieveSiteKey(this.auth).then((siteKey) => {
        if (!forceRefresh && isEnterprise(window.grecaptcha)) {
          retrieveRecaptchaToken(siteKey, resolve, reject);
        } else {
          if (typeof window === "undefined") {
            reject(new Error("RecaptchaVerifier is only supported in browser"));
            return;
          }
          let url = _recaptchaEnterpriseScriptUrl();
          if (url.length !== 0) {
            url += siteKey;
          }
          _loadJS(url).then(() => {
            retrieveRecaptchaToken(siteKey, resolve, reject);
          }).catch((error) => {
            reject(error);
          });
        }
      }).catch((error) => {
        reject(error);
      });
    });
  }
}
async function injectRecaptchaFields(auth2, request, action, captchaResp = false) {
  const verifier = new RecaptchaEnterpriseVerifier(auth2);
  let captchaResponse;
  try {
    captchaResponse = await verifier.verify(action);
  } catch (error) {
    captchaResponse = await verifier.verify(action, true);
  }
  const newRequest = Object.assign({}, request);
  if (!captchaResp) {
    Object.assign(newRequest, { captchaResponse });
  } else {
    Object.assign(newRequest, { "captchaResp": captchaResponse });
  }
  Object.assign(newRequest, {
    "clientType": "CLIENT_TYPE_WEB"
    /* RecaptchaClientType.WEB */
  });
  Object.assign(newRequest, {
    "recaptchaVersion": "RECAPTCHA_ENTERPRISE"
    /* RecaptchaVersion.ENTERPRISE */
  });
  return newRequest;
}
async function handleRecaptchaFlow(authInstance, request, actionName, actionMethod) {
  var _a;
  if ((_a = authInstance._getRecaptchaConfig()) === null || _a === void 0 ? void 0 : _a.isProviderEnabled(
    "EMAIL_PASSWORD_PROVIDER"
    /* RecaptchaProvider.EMAIL_PASSWORD_PROVIDER */
  )) {
    const requestWithRecaptcha = await injectRecaptchaFields(
      authInstance,
      request,
      actionName,
      actionName === "getOobCode"
      /* RecaptchaActionName.GET_OOB_CODE */
    );
    return actionMethod(authInstance, requestWithRecaptcha);
  } else {
    return actionMethod(authInstance, request).catch(async (error) => {
      if (error.code === `auth/${"missing-recaptcha-token"}`) {
        console.log(`${actionName} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);
        const requestWithRecaptcha = await injectRecaptchaFields(
          authInstance,
          request,
          actionName,
          actionName === "getOobCode"
          /* RecaptchaActionName.GET_OOB_CODE */
        );
        return actionMethod(authInstance, requestWithRecaptcha);
      } else {
        return Promise.reject(error);
      }
    });
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function initializeAuth(app2, deps) {
  const provider = _getProvider(app2, "auth");
  if (provider.isInitialized()) {
    const auth3 = provider.getImmediate();
    const initialOptions = provider.getOptions();
    if (deepEqual(initialOptions, deps !== null && deps !== void 0 ? deps : {})) {
      return auth3;
    } else {
      _fail(
        auth3,
        "already-initialized"
        /* AuthErrorCode.ALREADY_INITIALIZED */
      );
    }
  }
  const auth2 = provider.initialize({ options: deps });
  return auth2;
}
function _initializeAuthInstance(auth2, deps) {
  const persistence = (deps === null || deps === void 0 ? void 0 : deps.persistence) || [];
  const hierarchy = (Array.isArray(persistence) ? persistence : [persistence]).map(_getInstance);
  if (deps === null || deps === void 0 ? void 0 : deps.errorMap) {
    auth2._updateErrorMap(deps.errorMap);
  }
  auth2._initializeWithPersistence(hierarchy, deps === null || deps === void 0 ? void 0 : deps.popupRedirectResolver);
}
function connectAuthEmulator(auth2, url, options) {
  const authInternal = _castAuth(auth2);
  _assert(
    authInternal._canInitEmulator,
    authInternal,
    "emulator-config-failed"
    /* AuthErrorCode.EMULATOR_CONFIG_FAILED */
  );
  _assert(
    /^https?:\/\//.test(url),
    authInternal,
    "invalid-emulator-scheme"
    /* AuthErrorCode.INVALID_EMULATOR_SCHEME */
  );
  const disableWarnings = false;
  const protocol = extractProtocol(url);
  const { host, port } = extractHostAndPort(url);
  const portStr = port === null ? "" : `:${port}`;
  authInternal.config.emulator = { url: `${protocol}//${host}${portStr}/` };
  authInternal.settings.appVerificationDisabledForTesting = true;
  authInternal.emulatorConfig = Object.freeze({
    host,
    port,
    protocol: protocol.replace(":", ""),
    options: Object.freeze({ disableWarnings })
  });
  {
    emitEmulatorWarning();
  }
}
function extractProtocol(url) {
  const protocolEnd = url.indexOf(":");
  return protocolEnd < 0 ? "" : url.substr(0, protocolEnd + 1);
}
function extractHostAndPort(url) {
  const protocol = extractProtocol(url);
  const authority = /(\/\/)?([^?#/]+)/.exec(url.substr(protocol.length));
  if (!authority) {
    return { host: "", port: null };
  }
  const hostAndPort = authority[2].split("@").pop() || "";
  const bracketedIPv6 = /^(\[[^\]]+\])(:|$)/.exec(hostAndPort);
  if (bracketedIPv6) {
    const host = bracketedIPv6[1];
    return { host, port: parsePort(hostAndPort.substr(host.length + 1)) };
  } else {
    const [host, port] = hostAndPort.split(":");
    return { host, port: parsePort(port) };
  }
}
function parsePort(portStr) {
  if (!portStr) {
    return null;
  }
  const port = Number(portStr);
  if (isNaN(port)) {
    return null;
  }
  return port;
}
function emitEmulatorWarning() {
  function attachBanner() {
    const el = document.createElement("p");
    const sty = el.style;
    el.innerText = "Running in emulator mode. Do not use with production credentials.";
    sty.position = "fixed";
    sty.width = "100%";
    sty.backgroundColor = "#ffffff";
    sty.border = ".1em solid #000000";
    sty.color = "#b50000";
    sty.bottom = "0px";
    sty.left = "0px";
    sty.margin = "0px";
    sty.zIndex = "10000";
    sty.textAlign = "center";
    el.classList.add("firebase-emulator-warning");
    document.body.appendChild(el);
  }
  if (typeof console !== "undefined" && typeof console.info === "function") {
    console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");
  }
  if (typeof window !== "undefined" && typeof document !== "undefined") {
    if (document.readyState === "loading") {
      window.addEventListener("DOMContentLoaded", attachBanner);
    } else {
      attachBanner();
    }
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class AuthCredential {
  /** @internal */
  constructor(providerId, signInMethod) {
    this.providerId = providerId;
    this.signInMethod = signInMethod;
  }
  /**
   * Returns a JSON-serializable representation of this object.
   *
   * @returns a JSON-serializable representation of this object.
   */
  toJSON() {
    return debugFail("not implemented");
  }
  /** @internal */
  _getIdTokenResponse(_auth) {
    return debugFail("not implemented");
  }
  /** @internal */
  _linkToIdToken(_auth, _idToken) {
    return debugFail("not implemented");
  }
  /** @internal */
  _getReauthenticationResolver(_auth) {
    return debugFail("not implemented");
  }
}
async function linkEmailPassword(auth2, request) {
  return _performApiRequest(auth2, "POST", "/v1/accounts:signUp", request);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function signInWithPassword(auth2, request) {
  return _performSignInRequest(auth2, "POST", "/v1/accounts:signInWithPassword", _addTidIfNecessary(auth2, request));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function signInWithEmailLink$1(auth2, request) {
  return _performSignInRequest(auth2, "POST", "/v1/accounts:signInWithEmailLink", _addTidIfNecessary(auth2, request));
}
async function signInWithEmailLinkForLinking(auth2, request) {
  return _performSignInRequest(auth2, "POST", "/v1/accounts:signInWithEmailLink", _addTidIfNecessary(auth2, request));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class EmailAuthCredential extends AuthCredential {
  /** @internal */
  constructor(_email, _password, signInMethod, _tenantId = null) {
    super("password", signInMethod);
    this._email = _email;
    this._password = _password;
    this._tenantId = _tenantId;
  }
  /** @internal */
  static _fromEmailAndPassword(email, password) {
    return new EmailAuthCredential(
      email,
      password,
      "password"
      /* SignInMethod.EMAIL_PASSWORD */
    );
  }
  /** @internal */
  static _fromEmailAndCode(email, oobCode, tenantId = null) {
    return new EmailAuthCredential(email, oobCode, "emailLink", tenantId);
  }
  /** {@inheritdoc AuthCredential.toJSON} */
  toJSON() {
    return {
      email: this._email,
      password: this._password,
      signInMethod: this.signInMethod,
      tenantId: this._tenantId
    };
  }
  /**
   * Static method to deserialize a JSON representation of an object into an {@link  AuthCredential}.
   *
   * @param json - Either `object` or the stringified representation of the object. When string is
   * provided, `JSON.parse` would be called first.
   *
   * @returns If the JSON input does not represent an {@link AuthCredential}, null is returned.
   */
  static fromJSON(json) {
    const obj = typeof json === "string" ? JSON.parse(json) : json;
    if ((obj === null || obj === void 0 ? void 0 : obj.email) && (obj === null || obj === void 0 ? void 0 : obj.password)) {
      if (obj.signInMethod === "password") {
        return this._fromEmailAndPassword(obj.email, obj.password);
      } else if (obj.signInMethod === "emailLink") {
        return this._fromEmailAndCode(obj.email, obj.password, obj.tenantId);
      }
    }
    return null;
  }
  /** @internal */
  async _getIdTokenResponse(auth2) {
    switch (this.signInMethod) {
      case "password":
        const request = {
          returnSecureToken: true,
          email: this._email,
          password: this._password,
          clientType: "CLIENT_TYPE_WEB"
          /* RecaptchaClientType.WEB */
        };
        return handleRecaptchaFlow(auth2, request, "signInWithPassword", signInWithPassword);
      case "emailLink":
        return signInWithEmailLink$1(auth2, {
          email: this._email,
          oobCode: this._password
        });
      default:
        _fail(
          auth2,
          "internal-error"
          /* AuthErrorCode.INTERNAL_ERROR */
        );
    }
  }
  /** @internal */
  async _linkToIdToken(auth2, idToken) {
    switch (this.signInMethod) {
      case "password":
        const request = {
          idToken,
          returnSecureToken: true,
          email: this._email,
          password: this._password,
          clientType: "CLIENT_TYPE_WEB"
          /* RecaptchaClientType.WEB */
        };
        return handleRecaptchaFlow(auth2, request, "signUpPassword", linkEmailPassword);
      case "emailLink":
        return signInWithEmailLinkForLinking(auth2, {
          idToken,
          email: this._email,
          oobCode: this._password
        });
      default:
        _fail(
          auth2,
          "internal-error"
          /* AuthErrorCode.INTERNAL_ERROR */
        );
    }
  }
  /** @internal */
  _getReauthenticationResolver(auth2) {
    return this._getIdTokenResponse(auth2);
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function signInWithIdp(auth2, request) {
  return _performSignInRequest(auth2, "POST", "/v1/accounts:signInWithIdp", _addTidIfNecessary(auth2, request));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const IDP_REQUEST_URI$1 = "http://localhost";
class OAuthCredential extends AuthCredential {
  constructor() {
    super(...arguments);
    this.pendingToken = null;
  }
  /** @internal */
  static _fromParams(params) {
    const cred = new OAuthCredential(params.providerId, params.signInMethod);
    if (params.idToken || params.accessToken) {
      if (params.idToken) {
        cred.idToken = params.idToken;
      }
      if (params.accessToken) {
        cred.accessToken = params.accessToken;
      }
      if (params.nonce && !params.pendingToken) {
        cred.nonce = params.nonce;
      }
      if (params.pendingToken) {
        cred.pendingToken = params.pendingToken;
      }
    } else if (params.oauthToken && params.oauthTokenSecret) {
      cred.accessToken = params.oauthToken;
      cred.secret = params.oauthTokenSecret;
    } else {
      _fail(
        "argument-error"
        /* AuthErrorCode.ARGUMENT_ERROR */
      );
    }
    return cred;
  }
  /** {@inheritdoc AuthCredential.toJSON}  */
  toJSON() {
    return {
      idToken: this.idToken,
      accessToken: this.accessToken,
      secret: this.secret,
      nonce: this.nonce,
      pendingToken: this.pendingToken,
      providerId: this.providerId,
      signInMethod: this.signInMethod
    };
  }
  /**
   * Static method to deserialize a JSON representation of an object into an
   * {@link  AuthCredential}.
   *
   * @param json - Input can be either Object or the stringified representation of the object.
   * When string is provided, JSON.parse would be called first.
   *
   * @returns If the JSON input does not represent an {@link  AuthCredential}, null is returned.
   */
  static fromJSON(json) {
    const obj = typeof json === "string" ? JSON.parse(json) : json;
    const { providerId, signInMethod } = obj, rest = __rest(obj, ["providerId", "signInMethod"]);
    if (!providerId || !signInMethod) {
      return null;
    }
    const cred = new OAuthCredential(providerId, signInMethod);
    cred.idToken = rest.idToken || void 0;
    cred.accessToken = rest.accessToken || void 0;
    cred.secret = rest.secret;
    cred.nonce = rest.nonce;
    cred.pendingToken = rest.pendingToken || null;
    return cred;
  }
  /** @internal */
  _getIdTokenResponse(auth2) {
    const request = this.buildRequest();
    return signInWithIdp(auth2, request);
  }
  /** @internal */
  _linkToIdToken(auth2, idToken) {
    const request = this.buildRequest();
    request.idToken = idToken;
    return signInWithIdp(auth2, request);
  }
  /** @internal */
  _getReauthenticationResolver(auth2) {
    const request = this.buildRequest();
    request.autoCreate = false;
    return signInWithIdp(auth2, request);
  }
  buildRequest() {
    const request = {
      requestUri: IDP_REQUEST_URI$1,
      returnSecureToken: true
    };
    if (this.pendingToken) {
      request.pendingToken = this.pendingToken;
    } else {
      const postBody = {};
      if (this.idToken) {
        postBody["id_token"] = this.idToken;
      }
      if (this.accessToken) {
        postBody["access_token"] = this.accessToken;
      }
      if (this.secret) {
        postBody["oauth_token_secret"] = this.secret;
      }
      postBody["providerId"] = this.providerId;
      if (this.nonce && !this.pendingToken) {
        postBody["nonce"] = this.nonce;
      }
      request.postBody = querystring(postBody);
    }
    return request;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function parseMode(mode) {
  switch (mode) {
    case "recoverEmail":
      return "RECOVER_EMAIL";
    case "resetPassword":
      return "PASSWORD_RESET";
    case "signIn":
      return "EMAIL_SIGNIN";
    case "verifyEmail":
      return "VERIFY_EMAIL";
    case "verifyAndChangeEmail":
      return "VERIFY_AND_CHANGE_EMAIL";
    case "revertSecondFactorAddition":
      return "REVERT_SECOND_FACTOR_ADDITION";
    default:
      return null;
  }
}
function parseDeepLink(url) {
  const link = querystringDecode(extractQuerystring(url))["link"];
  const doubleDeepLink = link ? querystringDecode(extractQuerystring(link))["deep_link_id"] : null;
  const iOSDeepLink = querystringDecode(extractQuerystring(url))["deep_link_id"];
  const iOSDoubleDeepLink = iOSDeepLink ? querystringDecode(extractQuerystring(iOSDeepLink))["link"] : null;
  return iOSDoubleDeepLink || iOSDeepLink || doubleDeepLink || link || url;
}
class ActionCodeURL {
  /**
   * @param actionLink - The link from which to extract the URL.
   * @returns The {@link ActionCodeURL} object, or null if the link is invalid.
   *
   * @internal
   */
  constructor(actionLink) {
    var _a, _b, _c, _d, _e2, _f;
    const searchParams = querystringDecode(extractQuerystring(actionLink));
    const apiKey = (_a = searchParams[
      "apiKey"
      /* QueryField.API_KEY */
    ]) !== null && _a !== void 0 ? _a : null;
    const code = (_b = searchParams[
      "oobCode"
      /* QueryField.CODE */
    ]) !== null && _b !== void 0 ? _b : null;
    const operation = parseMode((_c = searchParams[
      "mode"
      /* QueryField.MODE */
    ]) !== null && _c !== void 0 ? _c : null);
    _assert(
      apiKey && code && operation,
      "argument-error"
      /* AuthErrorCode.ARGUMENT_ERROR */
    );
    this.apiKey = apiKey;
    this.operation = operation;
    this.code = code;
    this.continueUrl = (_d = searchParams[
      "continueUrl"
      /* QueryField.CONTINUE_URL */
    ]) !== null && _d !== void 0 ? _d : null;
    this.languageCode = (_e2 = searchParams[
      "languageCode"
      /* QueryField.LANGUAGE_CODE */
    ]) !== null && _e2 !== void 0 ? _e2 : null;
    this.tenantId = (_f = searchParams[
      "tenantId"
      /* QueryField.TENANT_ID */
    ]) !== null && _f !== void 0 ? _f : null;
  }
  /**
   * Parses the email action link string and returns an {@link ActionCodeURL} if the link is valid,
   * otherwise returns null.
   *
   * @param link  - The email action link string.
   * @returns The {@link ActionCodeURL} object, or null if the link is invalid.
   *
   * @public
   */
  static parseLink(link) {
    const actionLink = parseDeepLink(link);
    try {
      return new ActionCodeURL(actionLink);
    } catch (_a) {
      return null;
    }
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class EmailAuthProvider {
  constructor() {
    this.providerId = EmailAuthProvider.PROVIDER_ID;
  }
  /**
   * Initialize an {@link AuthCredential} using an email and password.
   *
   * @example
   * ```javascript
   * const authCredential = EmailAuthProvider.credential(email, password);
   * const userCredential = await signInWithCredential(auth, authCredential);
   * ```
   *
   * @example
   * ```javascript
   * const userCredential = await signInWithEmailAndPassword(auth, email, password);
   * ```
   *
   * @param email - Email address.
   * @param password - User account password.
   * @returns The auth provider credential.
   */
  static credential(email, password) {
    return EmailAuthCredential._fromEmailAndPassword(email, password);
  }
  /**
   * Initialize an {@link AuthCredential} using an email and an email link after a sign in with
   * email link operation.
   *
   * @example
   * ```javascript
   * const authCredential = EmailAuthProvider.credentialWithLink(auth, email, emailLink);
   * const userCredential = await signInWithCredential(auth, authCredential);
   * ```
   *
   * @example
   * ```javascript
   * await sendSignInLinkToEmail(auth, email);
   * // Obtain emailLink from user.
   * const userCredential = await signInWithEmailLink(auth, email, emailLink);
   * ```
   *
   * @param auth - The {@link Auth} instance used to verify the link.
   * @param email - Email address.
   * @param emailLink - Sign-in email link.
   * @returns - The auth provider credential.
   */
  static credentialWithLink(email, emailLink) {
    const actionCodeUrl = ActionCodeURL.parseLink(emailLink);
    _assert(
      actionCodeUrl,
      "argument-error"
      /* AuthErrorCode.ARGUMENT_ERROR */
    );
    return EmailAuthCredential._fromEmailAndCode(email, actionCodeUrl.code, actionCodeUrl.tenantId);
  }
}
EmailAuthProvider.PROVIDER_ID = "password";
EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD = "password";
EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD = "emailLink";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FederatedAuthProvider {
  /**
   * Constructor for generic OAuth providers.
   *
   * @param providerId - Provider for which credentials should be generated.
   */
  constructor(providerId) {
    this.providerId = providerId;
    this.defaultLanguageCode = null;
    this.customParameters = {};
  }
  /**
   * Set the language gode.
   *
   * @param languageCode - language code
   */
  setDefaultLanguage(languageCode) {
    this.defaultLanguageCode = languageCode;
  }
  /**
   * Sets the OAuth custom parameters to pass in an OAuth request for popup and redirect sign-in
   * operations.
   *
   * @remarks
   * For a detailed list, check the reserved required OAuth 2.0 parameters such as `client_id`,
   * `redirect_uri`, `scope`, `response_type`, and `state` are not allowed and will be ignored.
   *
   * @param customOAuthParameters - The custom OAuth parameters to pass in the OAuth request.
   */
  setCustomParameters(customOAuthParameters) {
    this.customParameters = customOAuthParameters;
    return this;
  }
  /**
   * Retrieve the current list of {@link CustomParameters}.
   */
  getCustomParameters() {
    return this.customParameters;
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class BaseOAuthProvider extends FederatedAuthProvider {
  constructor() {
    super(...arguments);
    this.scopes = [];
  }
  /**
   * Add an OAuth scope to the credential.
   *
   * @param scope - Provider OAuth scope to add.
   */
  addScope(scope) {
    if (!this.scopes.includes(scope)) {
      this.scopes.push(scope);
    }
    return this;
  }
  /**
   * Retrieve the current list of OAuth scopes.
   */
  getScopes() {
    return [...this.scopes];
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FacebookAuthProvider extends BaseOAuthProvider {
  constructor() {
    super(
      "facebook.com"
      /* ProviderId.FACEBOOK */
    );
  }
  /**
   * Creates a credential for Facebook.
   *
   * @example
   * ```javascript
   * // `event` from the Facebook auth.authResponseChange callback.
   * const credential = FacebookAuthProvider.credential(event.authResponse.accessToken);
   * const result = await signInWithCredential(credential);
   * ```
   *
   * @param accessToken - Facebook access token.
   */
  static credential(accessToken) {
    return OAuthCredential._fromParams({
      providerId: FacebookAuthProvider.PROVIDER_ID,
      signInMethod: FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,
      accessToken
    });
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link UserCredential}.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromResult(userCredential) {
    return FacebookAuthProvider.credentialFromTaggedObject(userCredential);
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link AuthError} which was
   * thrown during a sign-in, link, or reauthenticate operation.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromError(error) {
    return FacebookAuthProvider.credentialFromTaggedObject(error.customData || {});
  }
  static credentialFromTaggedObject({ _tokenResponse: tokenResponse }) {
    if (!tokenResponse || !("oauthAccessToken" in tokenResponse)) {
      return null;
    }
    if (!tokenResponse.oauthAccessToken) {
      return null;
    }
    try {
      return FacebookAuthProvider.credential(tokenResponse.oauthAccessToken);
    } catch (_a) {
      return null;
    }
  }
}
FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD = "facebook.com";
FacebookAuthProvider.PROVIDER_ID = "facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class GoogleAuthProvider extends BaseOAuthProvider {
  constructor() {
    super(
      "google.com"
      /* ProviderId.GOOGLE */
    );
    this.addScope("profile");
  }
  /**
   * Creates a credential for Google. At least one of ID token and access token is required.
   *
   * @example
   * ```javascript
   * // \`googleUser\` from the onsuccess Google Sign In callback.
   * const credential = GoogleAuthProvider.credential(googleUser.getAuthResponse().id_token);
   * const result = await signInWithCredential(credential);
   * ```
   *
   * @param idToken - Google ID token.
   * @param accessToken - Google access token.
   */
  static credential(idToken, accessToken) {
    return OAuthCredential._fromParams({
      providerId: GoogleAuthProvider.PROVIDER_ID,
      signInMethod: GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,
      idToken,
      accessToken
    });
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link UserCredential}.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromResult(userCredential) {
    return GoogleAuthProvider.credentialFromTaggedObject(userCredential);
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link AuthError} which was
   * thrown during a sign-in, link, or reauthenticate operation.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromError(error) {
    return GoogleAuthProvider.credentialFromTaggedObject(error.customData || {});
  }
  static credentialFromTaggedObject({ _tokenResponse: tokenResponse }) {
    if (!tokenResponse) {
      return null;
    }
    const { oauthIdToken, oauthAccessToken } = tokenResponse;
    if (!oauthIdToken && !oauthAccessToken) {
      return null;
    }
    try {
      return GoogleAuthProvider.credential(oauthIdToken, oauthAccessToken);
    } catch (_a) {
      return null;
    }
  }
}
GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD = "google.com";
GoogleAuthProvider.PROVIDER_ID = "google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class GithubAuthProvider extends BaseOAuthProvider {
  constructor() {
    super(
      "github.com"
      /* ProviderId.GITHUB */
    );
  }
  /**
   * Creates a credential for GitHub.
   *
   * @param accessToken - GitHub access token.
   */
  static credential(accessToken) {
    return OAuthCredential._fromParams({
      providerId: GithubAuthProvider.PROVIDER_ID,
      signInMethod: GithubAuthProvider.GITHUB_SIGN_IN_METHOD,
      accessToken
    });
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link UserCredential}.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromResult(userCredential) {
    return GithubAuthProvider.credentialFromTaggedObject(userCredential);
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link AuthError} which was
   * thrown during a sign-in, link, or reauthenticate operation.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromError(error) {
    return GithubAuthProvider.credentialFromTaggedObject(error.customData || {});
  }
  static credentialFromTaggedObject({ _tokenResponse: tokenResponse }) {
    if (!tokenResponse || !("oauthAccessToken" in tokenResponse)) {
      return null;
    }
    if (!tokenResponse.oauthAccessToken) {
      return null;
    }
    try {
      return GithubAuthProvider.credential(tokenResponse.oauthAccessToken);
    } catch (_a) {
      return null;
    }
  }
}
GithubAuthProvider.GITHUB_SIGN_IN_METHOD = "github.com";
GithubAuthProvider.PROVIDER_ID = "github.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class TwitterAuthProvider extends BaseOAuthProvider {
  constructor() {
    super(
      "twitter.com"
      /* ProviderId.TWITTER */
    );
  }
  /**
   * Creates a credential for Twitter.
   *
   * @param token - Twitter access token.
   * @param secret - Twitter secret.
   */
  static credential(token, secret) {
    return OAuthCredential._fromParams({
      providerId: TwitterAuthProvider.PROVIDER_ID,
      signInMethod: TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,
      oauthToken: token,
      oauthTokenSecret: secret
    });
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link UserCredential}.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromResult(userCredential) {
    return TwitterAuthProvider.credentialFromTaggedObject(userCredential);
  }
  /**
   * Used to extract the underlying {@link OAuthCredential} from a {@link AuthError} which was
   * thrown during a sign-in, link, or reauthenticate operation.
   *
   * @param userCredential - The user credential.
   */
  static credentialFromError(error) {
    return TwitterAuthProvider.credentialFromTaggedObject(error.customData || {});
  }
  static credentialFromTaggedObject({ _tokenResponse: tokenResponse }) {
    if (!tokenResponse) {
      return null;
    }
    const { oauthAccessToken, oauthTokenSecret } = tokenResponse;
    if (!oauthAccessToken || !oauthTokenSecret) {
      return null;
    }
    try {
      return TwitterAuthProvider.credential(oauthAccessToken, oauthTokenSecret);
    } catch (_a) {
      return null;
    }
  }
}
TwitterAuthProvider.TWITTER_SIGN_IN_METHOD = "twitter.com";
TwitterAuthProvider.PROVIDER_ID = "twitter.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function signUp(auth2, request) {
  return _performSignInRequest(auth2, "POST", "/v1/accounts:signUp", _addTidIfNecessary(auth2, request));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class UserCredentialImpl {
  constructor(params) {
    this.user = params.user;
    this.providerId = params.providerId;
    this._tokenResponse = params._tokenResponse;
    this.operationType = params.operationType;
  }
  static async _fromIdTokenResponse(auth2, operationType, idTokenResponse, isAnonymous = false) {
    const user = await UserImpl._fromIdTokenResponse(auth2, idTokenResponse, isAnonymous);
    const providerId = providerIdForResponse(idTokenResponse);
    const userCred = new UserCredentialImpl({
      user,
      providerId,
      _tokenResponse: idTokenResponse,
      operationType
    });
    return userCred;
  }
  static async _forOperation(user, operationType, response) {
    await user._updateTokensIfNecessary(
      response,
      /* reload */
      true
    );
    const providerId = providerIdForResponse(response);
    return new UserCredentialImpl({
      user,
      providerId,
      _tokenResponse: response,
      operationType
    });
  }
}
function providerIdForResponse(response) {
  if (response.providerId) {
    return response.providerId;
  }
  if ("phoneNumber" in response) {
    return "phone";
  }
  return null;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class MultiFactorError extends FirebaseError {
  constructor(auth2, error, operationType, user) {
    var _a;
    super(error.code, error.message);
    this.operationType = operationType;
    this.user = user;
    Object.setPrototypeOf(this, MultiFactorError.prototype);
    this.customData = {
      appName: auth2.name,
      tenantId: (_a = auth2.tenantId) !== null && _a !== void 0 ? _a : void 0,
      _serverResponse: error.customData._serverResponse,
      operationType
    };
  }
  static _fromErrorAndOperation(auth2, error, operationType, user) {
    return new MultiFactorError(auth2, error, operationType, user);
  }
}
function _processCredentialSavingMfaContextIfNecessary(auth2, operationType, credential, user) {
  const idTokenProvider = operationType === "reauthenticate" ? credential._getReauthenticationResolver(auth2) : credential._getIdTokenResponse(auth2);
  return idTokenProvider.catch((error) => {
    if (error.code === `auth/${"multi-factor-auth-required"}`) {
      throw MultiFactorError._fromErrorAndOperation(auth2, error, operationType, user);
    }
    throw error;
  });
}
async function _link$1(user, credential, bypassAuthState = false) {
  const response = await _logoutIfInvalidated(user, credential._linkToIdToken(user.auth, await user.getIdToken()), bypassAuthState);
  return UserCredentialImpl._forOperation(user, "link", response);
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function _reauthenticate(user, credential, bypassAuthState = false) {
  const { auth: auth2 } = user;
  if (_isFirebaseServerApp(auth2.app)) {
    return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth2));
  }
  const operationType = "reauthenticate";
  try {
    const response = await _logoutIfInvalidated(user, _processCredentialSavingMfaContextIfNecessary(auth2, operationType, credential, user), bypassAuthState);
    _assert(
      response.idToken,
      auth2,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const parsed = _parseToken(response.idToken);
    _assert(
      parsed,
      auth2,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const { sub: localId } = parsed;
    _assert(
      user.uid === localId,
      auth2,
      "user-mismatch"
      /* AuthErrorCode.USER_MISMATCH */
    );
    return UserCredentialImpl._forOperation(user, operationType, response);
  } catch (e) {
    if ((e === null || e === void 0 ? void 0 : e.code) === `auth/${"user-not-found"}`) {
      _fail(
        auth2,
        "user-mismatch"
        /* AuthErrorCode.USER_MISMATCH */
      );
    }
    throw e;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function _signInWithCredential(auth2, credential, bypassAuthState = false) {
  if (_isFirebaseServerApp(auth2.app)) {
    return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth2));
  }
  const operationType = "signIn";
  const response = await _processCredentialSavingMfaContextIfNecessary(auth2, operationType, credential);
  const userCredential = await UserCredentialImpl._fromIdTokenResponse(auth2, operationType, response);
  if (!bypassAuthState) {
    await auth2._updateCurrentUser(userCredential.user);
  }
  return userCredential;
}
async function signInWithCredential(auth2, credential) {
  return _signInWithCredential(_castAuth(auth2), credential);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function recachePasswordPolicy(auth2) {
  const authInternal = _castAuth(auth2);
  if (authInternal._getPasswordPolicyInternal()) {
    await authInternal._updatePasswordPolicy();
  }
}
async function createUserWithEmailAndPassword(auth2, email, password) {
  if (_isFirebaseServerApp(auth2.app)) {
    return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth2));
  }
  const authInternal = _castAuth(auth2);
  const request = {
    returnSecureToken: true,
    email,
    password,
    clientType: "CLIENT_TYPE_WEB"
    /* RecaptchaClientType.WEB */
  };
  const signUpResponse = handleRecaptchaFlow(authInternal, request, "signUpPassword", signUp);
  const response = await signUpResponse.catch((error) => {
    if (error.code === `auth/${"password-does-not-meet-requirements"}`) {
      void recachePasswordPolicy(auth2);
    }
    throw error;
  });
  const userCredential = await UserCredentialImpl._fromIdTokenResponse(authInternal, "signIn", response);
  await authInternal._updateCurrentUser(userCredential.user);
  return userCredential;
}
function signInWithEmailAndPassword(auth2, email, password) {
  if (_isFirebaseServerApp(auth2.app)) {
    return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth2));
  }
  return signInWithCredential(getModularInstance(auth2), EmailAuthProvider.credential(email, password)).catch(async (error) => {
    if (error.code === `auth/${"password-does-not-meet-requirements"}`) {
      void recachePasswordPolicy(auth2);
    }
    throw error;
  });
}
function onIdTokenChanged(auth2, nextOrObserver, error, completed) {
  return getModularInstance(auth2).onIdTokenChanged(nextOrObserver, error, completed);
}
function beforeAuthStateChanged(auth2, callback, onAbort) {
  return getModularInstance(auth2).beforeAuthStateChanged(callback, onAbort);
}
function onAuthStateChanged(auth2, nextOrObserver, error, completed) {
  return getModularInstance(auth2).onAuthStateChanged(nextOrObserver, error, completed);
}
function signOut(auth2) {
  return getModularInstance(auth2).signOut();
}
const STORAGE_AVAILABLE_KEY = "__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class BrowserPersistenceClass {
  constructor(storageRetriever, type) {
    this.storageRetriever = storageRetriever;
    this.type = type;
  }
  _isAvailable() {
    try {
      if (!this.storage) {
        return Promise.resolve(false);
      }
      this.storage.setItem(STORAGE_AVAILABLE_KEY, "1");
      this.storage.removeItem(STORAGE_AVAILABLE_KEY);
      return Promise.resolve(true);
    } catch (_a) {
      return Promise.resolve(false);
    }
  }
  _set(key, value) {
    this.storage.setItem(key, JSON.stringify(value));
    return Promise.resolve();
  }
  _get(key) {
    const json = this.storage.getItem(key);
    return Promise.resolve(json ? JSON.parse(json) : null);
  }
  _remove(key) {
    this.storage.removeItem(key);
    return Promise.resolve();
  }
  get storage() {
    return this.storageRetriever();
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _POLLING_INTERVAL_MS$1 = 1e3;
const IE10_LOCAL_STORAGE_SYNC_DELAY = 10;
class BrowserLocalPersistence extends BrowserPersistenceClass {
  constructor() {
    super(
      () => window.localStorage,
      "LOCAL"
      /* PersistenceType.LOCAL */
    );
    this.boundEventHandler = (event, poll) => this.onStorageEvent(event, poll);
    this.listeners = {};
    this.localCache = {};
    this.pollTimer = null;
    this.fallbackToPolling = _isMobileBrowser();
    this._shouldAllowMigration = true;
  }
  forAllChangedKeys(cb) {
    for (const key of Object.keys(this.listeners)) {
      const newValue = this.storage.getItem(key);
      const oldValue = this.localCache[key];
      if (newValue !== oldValue) {
        cb(key, oldValue, newValue);
      }
    }
  }
  onStorageEvent(event, poll = false) {
    if (!event.key) {
      this.forAllChangedKeys((key2, _oldValue, newValue) => {
        this.notifyListeners(key2, newValue);
      });
      return;
    }
    const key = event.key;
    if (poll) {
      this.detachListener();
    } else {
      this.stopPolling();
    }
    const triggerListeners = () => {
      const storedValue2 = this.storage.getItem(key);
      if (!poll && this.localCache[key] === storedValue2) {
        return;
      }
      this.notifyListeners(key, storedValue2);
    };
    const storedValue = this.storage.getItem(key);
    if (_isIE10() && storedValue !== event.newValue && event.newValue !== event.oldValue) {
      setTimeout(triggerListeners, IE10_LOCAL_STORAGE_SYNC_DELAY);
    } else {
      triggerListeners();
    }
  }
  notifyListeners(key, value) {
    this.localCache[key] = value;
    const listeners = this.listeners[key];
    if (listeners) {
      for (const listener of Array.from(listeners)) {
        listener(value ? JSON.parse(value) : value);
      }
    }
  }
  startPolling() {
    this.stopPolling();
    this.pollTimer = setInterval(() => {
      this.forAllChangedKeys((key, oldValue, newValue) => {
        this.onStorageEvent(
          new StorageEvent("storage", {
            key,
            oldValue,
            newValue
          }),
          /* poll */
          true
        );
      });
    }, _POLLING_INTERVAL_MS$1);
  }
  stopPolling() {
    if (this.pollTimer) {
      clearInterval(this.pollTimer);
      this.pollTimer = null;
    }
  }
  attachListener() {
    window.addEventListener("storage", this.boundEventHandler);
  }
  detachListener() {
    window.removeEventListener("storage", this.boundEventHandler);
  }
  _addListener(key, listener) {
    if (Object.keys(this.listeners).length === 0) {
      if (this.fallbackToPolling) {
        this.startPolling();
      } else {
        this.attachListener();
      }
    }
    if (!this.listeners[key]) {
      this.listeners[key] = /* @__PURE__ */ new Set();
      this.localCache[key] = this.storage.getItem(key);
    }
    this.listeners[key].add(listener);
  }
  _removeListener(key, listener) {
    if (this.listeners[key]) {
      this.listeners[key].delete(listener);
      if (this.listeners[key].size === 0) {
        delete this.listeners[key];
      }
    }
    if (Object.keys(this.listeners).length === 0) {
      this.detachListener();
      this.stopPolling();
    }
  }
  // Update local cache on base operations:
  async _set(key, value) {
    await super._set(key, value);
    this.localCache[key] = JSON.stringify(value);
  }
  async _get(key) {
    const value = await super._get(key);
    this.localCache[key] = JSON.stringify(value);
    return value;
  }
  async _remove(key) {
    await super._remove(key);
    delete this.localCache[key];
  }
}
BrowserLocalPersistence.type = "LOCAL";
const browserLocalPersistence = BrowserLocalPersistence;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class BrowserSessionPersistence extends BrowserPersistenceClass {
  constructor() {
    super(
      () => window.sessionStorage,
      "SESSION"
      /* PersistenceType.SESSION */
    );
  }
  _addListener(_key, _listener) {
    return;
  }
  _removeListener(_key, _listener) {
    return;
  }
}
BrowserSessionPersistence.type = "SESSION";
const browserSessionPersistence = BrowserSessionPersistence;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _allSettled(promises) {
  return Promise.all(promises.map(async (promise) => {
    try {
      const value = await promise;
      return {
        fulfilled: true,
        value
      };
    } catch (reason) {
      return {
        fulfilled: false,
        reason
      };
    }
  }));
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Receiver {
  constructor(eventTarget) {
    this.eventTarget = eventTarget;
    this.handlersMap = {};
    this.boundEventHandler = this.handleEvent.bind(this);
  }
  /**
   * Obtain an instance of a Receiver for a given event target, if none exists it will be created.
   *
   * @param eventTarget - An event target (such as window or self) through which the underlying
   * messages will be received.
   */
  static _getInstance(eventTarget) {
    const existingInstance = this.receivers.find((receiver) => receiver.isListeningto(eventTarget));
    if (existingInstance) {
      return existingInstance;
    }
    const newInstance = new Receiver(eventTarget);
    this.receivers.push(newInstance);
    return newInstance;
  }
  isListeningto(eventTarget) {
    return this.eventTarget === eventTarget;
  }
  /**
   * Fans out a MessageEvent to the appropriate listeners.
   *
   * @remarks
   * Sends an {@link Status.ACK} upon receipt and a {@link Status.DONE} once all handlers have
   * finished processing.
   *
   * @param event - The MessageEvent.
   *
   */
  async handleEvent(event) {
    const messageEvent = event;
    const { eventId, eventType, data } = messageEvent.data;
    const handlers = this.handlersMap[eventType];
    if (!(handlers === null || handlers === void 0 ? void 0 : handlers.size)) {
      return;
    }
    messageEvent.ports[0].postMessage({
      status: "ack",
      eventId,
      eventType
    });
    const promises = Array.from(handlers).map(async (handler) => handler(messageEvent.origin, data));
    const response = await _allSettled(promises);
    messageEvent.ports[0].postMessage({
      status: "done",
      eventId,
      eventType,
      response
    });
  }
  /**
   * Subscribe an event handler for a particular event.
   *
   * @param eventType - Event name to subscribe to.
   * @param eventHandler - The event handler which should receive the events.
   *
   */
  _subscribe(eventType, eventHandler) {
    if (Object.keys(this.handlersMap).length === 0) {
      this.eventTarget.addEventListener("message", this.boundEventHandler);
    }
    if (!this.handlersMap[eventType]) {
      this.handlersMap[eventType] = /* @__PURE__ */ new Set();
    }
    this.handlersMap[eventType].add(eventHandler);
  }
  /**
   * Unsubscribe an event handler from a particular event.
   *
   * @param eventType - Event name to unsubscribe from.
   * @param eventHandler - Optional event handler, if none provided, unsubscribe all handlers on this event.
   *
   */
  _unsubscribe(eventType, eventHandler) {
    if (this.handlersMap[eventType] && eventHandler) {
      this.handlersMap[eventType].delete(eventHandler);
    }
    if (!eventHandler || this.handlersMap[eventType].size === 0) {
      delete this.handlersMap[eventType];
    }
    if (Object.keys(this.handlersMap).length === 0) {
      this.eventTarget.removeEventListener("message", this.boundEventHandler);
    }
  }
}
Receiver.receivers = [];
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _generateEventId(prefix = "", digits = 10) {
  let random = "";
  for (let i = 0; i < digits; i++) {
    random += Math.floor(Math.random() * 10);
  }
  return prefix + random;
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Sender {
  constructor(target) {
    this.target = target;
    this.handlers = /* @__PURE__ */ new Set();
  }
  /**
   * Unsubscribe the handler and remove it from our tracking Set.
   *
   * @param handler - The handler to unsubscribe.
   */
  removeMessageHandler(handler) {
    if (handler.messageChannel) {
      handler.messageChannel.port1.removeEventListener("message", handler.onMessage);
      handler.messageChannel.port1.close();
    }
    this.handlers.delete(handler);
  }
  /**
   * Send a message to the Receiver located at {@link target}.
   *
   * @remarks
   * We'll first wait a bit for an ACK , if we get one we will wait significantly longer until the
   * receiver has had a chance to fully process the event.
   *
   * @param eventType - Type of event to send.
   * @param data - The payload of the event.
   * @param timeout - Timeout for waiting on an ACK from the receiver.
   *
   * @returns An array of settled promises from all the handlers that were listening on the receiver.
   */
  async _send(eventType, data, timeout = 50) {
    const messageChannel = typeof MessageChannel !== "undefined" ? new MessageChannel() : null;
    if (!messageChannel) {
      throw new Error(
        "connection_unavailable"
        /* _MessageError.CONNECTION_UNAVAILABLE */
      );
    }
    let completionTimer;
    let handler;
    return new Promise((resolve, reject) => {
      const eventId = _generateEventId("", 20);
      messageChannel.port1.start();
      const ackTimer = setTimeout(() => {
        reject(new Error(
          "unsupported_event"
          /* _MessageError.UNSUPPORTED_EVENT */
        ));
      }, timeout);
      handler = {
        messageChannel,
        onMessage(event) {
          const messageEvent = event;
          if (messageEvent.data.eventId !== eventId) {
            return;
          }
          switch (messageEvent.data.status) {
            case "ack":
              clearTimeout(ackTimer);
              completionTimer = setTimeout(
                () => {
                  reject(new Error(
                    "timeout"
                    /* _MessageError.TIMEOUT */
                  ));
                },
                3e3
                /* _TimeoutDuration.COMPLETION */
              );
              break;
            case "done":
              clearTimeout(completionTimer);
              resolve(messageEvent.data.response);
              break;
            default:
              clearTimeout(ackTimer);
              clearTimeout(completionTimer);
              reject(new Error(
                "invalid_response"
                /* _MessageError.INVALID_RESPONSE */
              ));
              break;
          }
        }
      };
      this.handlers.add(handler);
      messageChannel.port1.addEventListener("message", handler.onMessage);
      this.target.postMessage({
        eventType,
        eventId,
        data
      }, [messageChannel.port2]);
    }).finally(() => {
      if (handler) {
        this.removeMessageHandler(handler);
      }
    });
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _window() {
  return window;
}
function _setWindowLocation(url) {
  _window().location.href = url;
}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _isWorker() {
  return typeof _window()["WorkerGlobalScope"] !== "undefined" && typeof _window()["importScripts"] === "function";
}
async function _getActiveServiceWorker() {
  if (!(navigator === null || navigator === void 0 ? void 0 : navigator.serviceWorker)) {
    return null;
  }
  try {
    const registration = await navigator.serviceWorker.ready;
    return registration.active;
  } catch (_a) {
    return null;
  }
}
function _getServiceWorkerController() {
  var _a;
  return ((_a = navigator === null || navigator === void 0 ? void 0 : navigator.serviceWorker) === null || _a === void 0 ? void 0 : _a.controller) || null;
}
function _getWorkerGlobalScope() {
  return _isWorker() ? self : null;
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const DB_NAME = "firebaseLocalStorageDb";
const DB_VERSION = 1;
const DB_OBJECTSTORE_NAME = "firebaseLocalStorage";
const DB_DATA_KEYPATH = "fbase_key";
class DBPromise {
  constructor(request) {
    this.request = request;
  }
  toPromise() {
    return new Promise((resolve, reject) => {
      this.request.addEventListener("success", () => {
        resolve(this.request.result);
      });
      this.request.addEventListener("error", () => {
        reject(this.request.error);
      });
    });
  }
}
function getObjectStore(db2, isReadWrite) {
  return db2.transaction([DB_OBJECTSTORE_NAME], isReadWrite ? "readwrite" : "readonly").objectStore(DB_OBJECTSTORE_NAME);
}
function _deleteDatabase() {
  const request = indexedDB.deleteDatabase(DB_NAME);
  return new DBPromise(request).toPromise();
}
function _openDatabase() {
  const request = indexedDB.open(DB_NAME, DB_VERSION);
  return new Promise((resolve, reject) => {
    request.addEventListener("error", () => {
      reject(request.error);
    });
    request.addEventListener("upgradeneeded", () => {
      const db2 = request.result;
      try {
        db2.createObjectStore(DB_OBJECTSTORE_NAME, { keyPath: DB_DATA_KEYPATH });
      } catch (e) {
        reject(e);
      }
    });
    request.addEventListener("success", async () => {
      const db2 = request.result;
      if (!db2.objectStoreNames.contains(DB_OBJECTSTORE_NAME)) {
        db2.close();
        await _deleteDatabase();
        resolve(await _openDatabase());
      } else {
        resolve(db2);
      }
    });
  });
}
async function _putObject(db2, key, value) {
  const request = getObjectStore(db2, true).put({
    [DB_DATA_KEYPATH]: key,
    value
  });
  return new DBPromise(request).toPromise();
}
async function getObject(db2, key) {
  const request = getObjectStore(db2, false).get(key);
  const data = await new DBPromise(request).toPromise();
  return data === void 0 ? null : data.value;
}
function _deleteObject(db2, key) {
  const request = getObjectStore(db2, true).delete(key);
  return new DBPromise(request).toPromise();
}
const _POLLING_INTERVAL_MS = 800;
const _TRANSACTION_RETRY_COUNT = 3;
class IndexedDBLocalPersistence {
  constructor() {
    this.type = "LOCAL";
    this._shouldAllowMigration = true;
    this.listeners = {};
    this.localCache = {};
    this.pollTimer = null;
    this.pendingWrites = 0;
    this.receiver = null;
    this.sender = null;
    this.serviceWorkerReceiverAvailable = false;
    this.activeServiceWorker = null;
    this._workerInitializationPromise = this.initializeServiceWorkerMessaging().then(() => {
    }, () => {
    });
  }
  async _openDb() {
    if (this.db) {
      return this.db;
    }
    this.db = await _openDatabase();
    return this.db;
  }
  async _withRetries(op) {
    let numAttempts = 0;
    while (true) {
      try {
        const db2 = await this._openDb();
        return await op(db2);
      } catch (e) {
        if (numAttempts++ > _TRANSACTION_RETRY_COUNT) {
          throw e;
        }
        if (this.db) {
          this.db.close();
          this.db = void 0;
        }
      }
    }
  }
  /**
   * IndexedDB events do not propagate from the main window to the worker context.  We rely on a
   * postMessage interface to send these events to the worker ourselves.
   */
  async initializeServiceWorkerMessaging() {
    return _isWorker() ? this.initializeReceiver() : this.initializeSender();
  }
  /**
   * As the worker we should listen to events from the main window.
   */
  async initializeReceiver() {
    this.receiver = Receiver._getInstance(_getWorkerGlobalScope());
    this.receiver._subscribe("keyChanged", async (_origin, data) => {
      const keys = await this._poll();
      return {
        keyProcessed: keys.includes(data.key)
      };
    });
    this.receiver._subscribe("ping", async (_origin, _data) => {
      return [
        "keyChanged"
        /* _EventType.KEY_CHANGED */
      ];
    });
  }
  /**
   * As the main window, we should let the worker know when keys change (set and remove).
   *
   * @remarks
   * {@link https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/ready | ServiceWorkerContainer.ready}
   * may not resolve.
   */
  async initializeSender() {
    var _a, _b;
    this.activeServiceWorker = await _getActiveServiceWorker();
    if (!this.activeServiceWorker) {
      return;
    }
    this.sender = new Sender(this.activeServiceWorker);
    const results = await this.sender._send(
      "ping",
      {},
      800
      /* _TimeoutDuration.LONG_ACK */
    );
    if (!results) {
      return;
    }
    if (((_a = results[0]) === null || _a === void 0 ? void 0 : _a.fulfilled) && ((_b = results[0]) === null || _b === void 0 ? void 0 : _b.value.includes(
      "keyChanged"
      /* _EventType.KEY_CHANGED */
    ))) {
      this.serviceWorkerReceiverAvailable = true;
    }
  }
  /**
   * Let the worker know about a changed key, the exact key doesn't technically matter since the
   * worker will just trigger a full sync anyway.
   *
   * @remarks
   * For now, we only support one service worker per page.
   *
   * @param key - Storage key which changed.
   */
  async notifyServiceWorker(key) {
    if (!this.sender || !this.activeServiceWorker || _getServiceWorkerController() !== this.activeServiceWorker) {
      return;
    }
    try {
      await this.sender._send(
        "keyChanged",
        { key },
        // Use long timeout if receiver has previously responded to a ping from us.
        this.serviceWorkerReceiverAvailable ? 800 : 50
        /* _TimeoutDuration.ACK */
      );
    } catch (_a) {
    }
  }
  async _isAvailable() {
    try {
      if (!indexedDB) {
        return false;
      }
      const db2 = await _openDatabase();
      await _putObject(db2, STORAGE_AVAILABLE_KEY, "1");
      await _deleteObject(db2, STORAGE_AVAILABLE_KEY);
      return true;
    } catch (_a) {
    }
    return false;
  }
  async _withPendingWrite(write) {
    this.pendingWrites++;
    try {
      await write();
    } finally {
      this.pendingWrites--;
    }
  }
  async _set(key, value) {
    return this._withPendingWrite(async () => {
      await this._withRetries((db2) => _putObject(db2, key, value));
      this.localCache[key] = value;
      return this.notifyServiceWorker(key);
    });
  }
  async _get(key) {
    const obj = await this._withRetries((db2) => getObject(db2, key));
    this.localCache[key] = obj;
    return obj;
  }
  async _remove(key) {
    return this._withPendingWrite(async () => {
      await this._withRetries((db2) => _deleteObject(db2, key));
      delete this.localCache[key];
      return this.notifyServiceWorker(key);
    });
  }
  async _poll() {
    const result = await this._withRetries((db2) => {
      const getAllRequest = getObjectStore(db2, false).getAll();
      return new DBPromise(getAllRequest).toPromise();
    });
    if (!result) {
      return [];
    }
    if (this.pendingWrites !== 0) {
      return [];
    }
    const keys = [];
    const keysInResult = /* @__PURE__ */ new Set();
    if (result.length !== 0) {
      for (const { fbase_key: key, value } of result) {
        keysInResult.add(key);
        if (JSON.stringify(this.localCache[key]) !== JSON.stringify(value)) {
          this.notifyListeners(key, value);
          keys.push(key);
        }
      }
    }
    for (const localKey of Object.keys(this.localCache)) {
      if (this.localCache[localKey] && !keysInResult.has(localKey)) {
        this.notifyListeners(localKey, null);
        keys.push(localKey);
      }
    }
    return keys;
  }
  notifyListeners(key, newValue) {
    this.localCache[key] = newValue;
    const listeners = this.listeners[key];
    if (listeners) {
      for (const listener of Array.from(listeners)) {
        listener(newValue);
      }
    }
  }
  startPolling() {
    this.stopPolling();
    this.pollTimer = setInterval(async () => this._poll(), _POLLING_INTERVAL_MS);
  }
  stopPolling() {
    if (this.pollTimer) {
      clearInterval(this.pollTimer);
      this.pollTimer = null;
    }
  }
  _addListener(key, listener) {
    if (Object.keys(this.listeners).length === 0) {
      this.startPolling();
    }
    if (!this.listeners[key]) {
      this.listeners[key] = /* @__PURE__ */ new Set();
      void this._get(key);
    }
    this.listeners[key].add(listener);
  }
  _removeListener(key, listener) {
    if (this.listeners[key]) {
      this.listeners[key].delete(listener);
      if (this.listeners[key].size === 0) {
        delete this.listeners[key];
      }
    }
    if (Object.keys(this.listeners).length === 0) {
      this.stopPolling();
    }
  }
}
IndexedDBLocalPersistence.type = "LOCAL";
const indexedDBLocalPersistence = IndexedDBLocalPersistence;
new Delay(3e4, 6e4);
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _withDefaultResolver(auth2, resolverOverride) {
  if (resolverOverride) {
    return _getInstance(resolverOverride);
  }
  _assert(
    auth2._popupRedirectResolver,
    auth2,
    "argument-error"
    /* AuthErrorCode.ARGUMENT_ERROR */
  );
  return auth2._popupRedirectResolver;
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class IdpCredential extends AuthCredential {
  constructor(params) {
    super(
      "custom",
      "custom"
      /* ProviderId.CUSTOM */
    );
    this.params = params;
  }
  _getIdTokenResponse(auth2) {
    return signInWithIdp(auth2, this._buildIdpRequest());
  }
  _linkToIdToken(auth2, idToken) {
    return signInWithIdp(auth2, this._buildIdpRequest(idToken));
  }
  _getReauthenticationResolver(auth2) {
    return signInWithIdp(auth2, this._buildIdpRequest());
  }
  _buildIdpRequest(idToken) {
    const request = {
      requestUri: this.params.requestUri,
      sessionId: this.params.sessionId,
      postBody: this.params.postBody,
      tenantId: this.params.tenantId,
      pendingToken: this.params.pendingToken,
      returnSecureToken: true,
      returnIdpCredential: true
    };
    if (idToken) {
      request.idToken = idToken;
    }
    return request;
  }
}
function _signIn(params) {
  return _signInWithCredential(params.auth, new IdpCredential(params), params.bypassAuthState);
}
function _reauth(params) {
  const { auth: auth2, user } = params;
  _assert(
    user,
    auth2,
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  return _reauthenticate(user, new IdpCredential(params), params.bypassAuthState);
}
async function _link(params) {
  const { auth: auth2, user } = params;
  _assert(
    user,
    auth2,
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  return _link$1(user, new IdpCredential(params), params.bypassAuthState);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class AbstractPopupRedirectOperation {
  constructor(auth2, filter, resolver, user, bypassAuthState = false) {
    this.auth = auth2;
    this.resolver = resolver;
    this.user = user;
    this.bypassAuthState = bypassAuthState;
    this.pendingPromise = null;
    this.eventManager = null;
    this.filter = Array.isArray(filter) ? filter : [filter];
  }
  execute() {
    return new Promise(async (resolve, reject) => {
      this.pendingPromise = { resolve, reject };
      try {
        this.eventManager = await this.resolver._initialize(this.auth);
        await this.onExecution();
        this.eventManager.registerConsumer(this);
      } catch (e) {
        this.reject(e);
      }
    });
  }
  async onAuthEvent(event) {
    const { urlResponse, sessionId, postBody, tenantId, error, type } = event;
    if (error) {
      this.reject(error);
      return;
    }
    const params = {
      auth: this.auth,
      requestUri: urlResponse,
      sessionId,
      tenantId: tenantId || void 0,
      postBody: postBody || void 0,
      user: this.user,
      bypassAuthState: this.bypassAuthState
    };
    try {
      this.resolve(await this.getIdpTask(type)(params));
    } catch (e) {
      this.reject(e);
    }
  }
  onError(error) {
    this.reject(error);
  }
  getIdpTask(type) {
    switch (type) {
      case "signInViaPopup":
      case "signInViaRedirect":
        return _signIn;
      case "linkViaPopup":
      case "linkViaRedirect":
        return _link;
      case "reauthViaPopup":
      case "reauthViaRedirect":
        return _reauth;
      default:
        _fail(
          this.auth,
          "internal-error"
          /* AuthErrorCode.INTERNAL_ERROR */
        );
    }
  }
  resolve(cred) {
    debugAssert(this.pendingPromise, "Pending promise was never set");
    this.pendingPromise.resolve(cred);
    this.unregisterAndCleanUp();
  }
  reject(error) {
    debugAssert(this.pendingPromise, "Pending promise was never set");
    this.pendingPromise.reject(error);
    this.unregisterAndCleanUp();
  }
  unregisterAndCleanUp() {
    if (this.eventManager) {
      this.eventManager.unregisterConsumer(this);
    }
    this.pendingPromise = null;
    this.cleanUp();
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _POLL_WINDOW_CLOSE_TIMEOUT = new Delay(2e3, 1e4);
class PopupOperation extends AbstractPopupRedirectOperation {
  constructor(auth2, filter, provider, resolver, user) {
    super(auth2, filter, resolver, user);
    this.provider = provider;
    this.authWindow = null;
    this.pollId = null;
    if (PopupOperation.currentPopupAction) {
      PopupOperation.currentPopupAction.cancel();
    }
    PopupOperation.currentPopupAction = this;
  }
  async executeNotNull() {
    const result = await this.execute();
    _assert(
      result,
      this.auth,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    return result;
  }
  async onExecution() {
    debugAssert(this.filter.length === 1, "Popup operations only handle one event");
    const eventId = _generateEventId();
    this.authWindow = await this.resolver._openPopup(
      this.auth,
      this.provider,
      this.filter[0],
      // There's always one, see constructor
      eventId
    );
    this.authWindow.associatedEvent = eventId;
    this.resolver._originValidation(this.auth).catch((e) => {
      this.reject(e);
    });
    this.resolver._isIframeWebStorageSupported(this.auth, (isSupported) => {
      if (!isSupported) {
        this.reject(_createError(
          this.auth,
          "web-storage-unsupported"
          /* AuthErrorCode.WEB_STORAGE_UNSUPPORTED */
        ));
      }
    });
    this.pollUserCancellation();
  }
  get eventId() {
    var _a;
    return ((_a = this.authWindow) === null || _a === void 0 ? void 0 : _a.associatedEvent) || null;
  }
  cancel() {
    this.reject(_createError(
      this.auth,
      "cancelled-popup-request"
      /* AuthErrorCode.EXPIRED_POPUP_REQUEST */
    ));
  }
  cleanUp() {
    if (this.authWindow) {
      this.authWindow.close();
    }
    if (this.pollId) {
      window.clearTimeout(this.pollId);
    }
    this.authWindow = null;
    this.pollId = null;
    PopupOperation.currentPopupAction = null;
  }
  pollUserCancellation() {
    const poll = () => {
      var _a, _b;
      if ((_b = (_a = this.authWindow) === null || _a === void 0 ? void 0 : _a.window) === null || _b === void 0 ? void 0 : _b.closed) {
        this.pollId = window.setTimeout(
          () => {
            this.pollId = null;
            this.reject(_createError(
              this.auth,
              "popup-closed-by-user"
              /* AuthErrorCode.POPUP_CLOSED_BY_USER */
            ));
          },
          8e3
          /* _Timeout.AUTH_EVENT */
        );
        return;
      }
      this.pollId = window.setTimeout(poll, _POLL_WINDOW_CLOSE_TIMEOUT.get());
    };
    poll();
  }
}
PopupOperation.currentPopupAction = null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const PENDING_REDIRECT_KEY = "pendingRedirect";
const redirectOutcomeMap = /* @__PURE__ */ new Map();
class RedirectAction extends AbstractPopupRedirectOperation {
  constructor(auth2, resolver, bypassAuthState = false) {
    super(auth2, [
      "signInViaRedirect",
      "linkViaRedirect",
      "reauthViaRedirect",
      "unknown"
      /* AuthEventType.UNKNOWN */
    ], resolver, void 0, bypassAuthState);
    this.eventId = null;
  }
  /**
   * Override the execute function; if we already have a redirect result, then
   * just return it.
   */
  async execute() {
    let readyOutcome = redirectOutcomeMap.get(this.auth._key());
    if (!readyOutcome) {
      try {
        const hasPendingRedirect = await _getAndClearPendingRedirectStatus(this.resolver, this.auth);
        const result = hasPendingRedirect ? await super.execute() : null;
        readyOutcome = () => Promise.resolve(result);
      } catch (e) {
        readyOutcome = () => Promise.reject(e);
      }
      redirectOutcomeMap.set(this.auth._key(), readyOutcome);
    }
    if (!this.bypassAuthState) {
      redirectOutcomeMap.set(this.auth._key(), () => Promise.resolve(null));
    }
    return readyOutcome();
  }
  async onAuthEvent(event) {
    if (event.type === "signInViaRedirect") {
      return super.onAuthEvent(event);
    } else if (event.type === "unknown") {
      this.resolve(null);
      return;
    }
    if (event.eventId) {
      const user = await this.auth._redirectUserForId(event.eventId);
      if (user) {
        this.user = user;
        return super.onAuthEvent(event);
      } else {
        this.resolve(null);
      }
    }
  }
  async onExecution() {
  }
  cleanUp() {
  }
}
async function _getAndClearPendingRedirectStatus(resolver, auth2) {
  const key = pendingRedirectKey(auth2);
  const persistence = resolverPersistence(resolver);
  if (!await persistence._isAvailable()) {
    return false;
  }
  const hasPendingRedirect = await persistence._get(key) === "true";
  await persistence._remove(key);
  return hasPendingRedirect;
}
function _overrideRedirectResult(auth2, result) {
  redirectOutcomeMap.set(auth2._key(), result);
}
function resolverPersistence(resolver) {
  return _getInstance(resolver._redirectPersistence);
}
function pendingRedirectKey(auth2) {
  return _persistenceKeyName(PENDING_REDIRECT_KEY, auth2.config.apiKey, auth2.name);
}
async function _getRedirectResult(auth2, resolverExtern, bypassAuthState = false) {
  if (_isFirebaseServerApp(auth2.app)) {
    return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth2));
  }
  const authInternal = _castAuth(auth2);
  const resolver = _withDefaultResolver(authInternal, resolverExtern);
  const action = new RedirectAction(authInternal, resolver, bypassAuthState);
  const result = await action.execute();
  if (result && !bypassAuthState) {
    delete result.user._redirectEventId;
    await authInternal._persistUserIfCurrent(result.user);
    await authInternal._setRedirectUser(null, resolverExtern);
  }
  return result;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const EVENT_DUPLICATION_CACHE_DURATION_MS = 10 * 60 * 1e3;
class AuthEventManager {
  constructor(auth2) {
    this.auth = auth2;
    this.cachedEventUids = /* @__PURE__ */ new Set();
    this.consumers = /* @__PURE__ */ new Set();
    this.queuedRedirectEvent = null;
    this.hasHandledPotentialRedirect = false;
    this.lastProcessedEventTime = Date.now();
  }
  registerConsumer(authEventConsumer) {
    this.consumers.add(authEventConsumer);
    if (this.queuedRedirectEvent && this.isEventForConsumer(this.queuedRedirectEvent, authEventConsumer)) {
      this.sendToConsumer(this.queuedRedirectEvent, authEventConsumer);
      this.saveEventToCache(this.queuedRedirectEvent);
      this.queuedRedirectEvent = null;
    }
  }
  unregisterConsumer(authEventConsumer) {
    this.consumers.delete(authEventConsumer);
  }
  onEvent(event) {
    if (this.hasEventBeenHandled(event)) {
      return false;
    }
    let handled = false;
    this.consumers.forEach((consumer) => {
      if (this.isEventForConsumer(event, consumer)) {
        handled = true;
        this.sendToConsumer(event, consumer);
        this.saveEventToCache(event);
      }
    });
    if (this.hasHandledPotentialRedirect || !isRedirectEvent(event)) {
      return handled;
    }
    this.hasHandledPotentialRedirect = true;
    if (!handled) {
      this.queuedRedirectEvent = event;
      handled = true;
    }
    return handled;
  }
  sendToConsumer(event, consumer) {
    var _a;
    if (event.error && !isNullRedirectEvent(event)) {
      const code = ((_a = event.error.code) === null || _a === void 0 ? void 0 : _a.split("auth/")[1]) || "internal-error";
      consumer.onError(_createError(this.auth, code));
    } else {
      consumer.onAuthEvent(event);
    }
  }
  isEventForConsumer(event, consumer) {
    const eventIdMatches = consumer.eventId === null || !!event.eventId && event.eventId === consumer.eventId;
    return consumer.filter.includes(event.type) && eventIdMatches;
  }
  hasEventBeenHandled(event) {
    if (Date.now() - this.lastProcessedEventTime >= EVENT_DUPLICATION_CACHE_DURATION_MS) {
      this.cachedEventUids.clear();
    }
    return this.cachedEventUids.has(eventUid(event));
  }
  saveEventToCache(event) {
    this.cachedEventUids.add(eventUid(event));
    this.lastProcessedEventTime = Date.now();
  }
}
function eventUid(e) {
  return [e.type, e.eventId, e.sessionId, e.tenantId].filter((v2) => v2).join("-");
}
function isNullRedirectEvent({ type, error }) {
  return type === "unknown" && (error === null || error === void 0 ? void 0 : error.code) === `auth/${"no-auth-event"}`;
}
function isRedirectEvent(event) {
  switch (event.type) {
    case "signInViaRedirect":
    case "linkViaRedirect":
    case "reauthViaRedirect":
      return true;
    case "unknown":
      return isNullRedirectEvent(event);
    default:
      return false;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function _getProjectConfig(auth2, request = {}) {
  return _performApiRequest(auth2, "GET", "/v1/projects", request);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const IP_ADDRESS_REGEX = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;
const HTTP_REGEX = /^https?/;
async function _validateOrigin(auth2) {
  if (auth2.config.emulator) {
    return;
  }
  const { authorizedDomains } = await _getProjectConfig(auth2);
  for (const domain of authorizedDomains) {
    try {
      if (matchDomain(domain)) {
        return;
      }
    } catch (_a) {
    }
  }
  _fail(
    auth2,
    "unauthorized-domain"
    /* AuthErrorCode.INVALID_ORIGIN */
  );
}
function matchDomain(expected) {
  const currentUrl = _getCurrentUrl();
  const { protocol, hostname } = new URL(currentUrl);
  if (expected.startsWith("chrome-extension://")) {
    const ceUrl = new URL(expected);
    if (ceUrl.hostname === "" && hostname === "") {
      return protocol === "chrome-extension:" && expected.replace("chrome-extension://", "") === currentUrl.replace("chrome-extension://", "");
    }
    return protocol === "chrome-extension:" && ceUrl.hostname === hostname;
  }
  if (!HTTP_REGEX.test(protocol)) {
    return false;
  }
  if (IP_ADDRESS_REGEX.test(expected)) {
    return hostname === expected;
  }
  const escapedDomainPattern = expected.replace(/\./g, "\\.");
  const re2 = new RegExp("^(.+\\." + escapedDomainPattern + "|" + escapedDomainPattern + ")$", "i");
  return re2.test(hostname);
}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const NETWORK_TIMEOUT = new Delay(3e4, 6e4);
function resetUnloadedGapiModules() {
  const beacon = _window().___jsl;
  if (beacon === null || beacon === void 0 ? void 0 : beacon.H) {
    for (const hint of Object.keys(beacon.H)) {
      beacon.H[hint].r = beacon.H[hint].r || [];
      beacon.H[hint].L = beacon.H[hint].L || [];
      beacon.H[hint].r = [...beacon.H[hint].L];
      if (beacon.CP) {
        for (let i = 0; i < beacon.CP.length; i++) {
          beacon.CP[i] = null;
        }
      }
    }
  }
}
function loadGapi(auth2) {
  return new Promise((resolve, reject) => {
    var _a, _b, _c;
    function loadGapiIframe() {
      resetUnloadedGapiModules();
      gapi.load("gapi.iframes", {
        callback: () => {
          resolve(gapi.iframes.getContext());
        },
        ontimeout: () => {
          resetUnloadedGapiModules();
          reject(_createError(
            auth2,
            "network-request-failed"
            /* AuthErrorCode.NETWORK_REQUEST_FAILED */
          ));
        },
        timeout: NETWORK_TIMEOUT.get()
      });
    }
    if ((_b = (_a = _window().gapi) === null || _a === void 0 ? void 0 : _a.iframes) === null || _b === void 0 ? void 0 : _b.Iframe) {
      resolve(gapi.iframes.getContext());
    } else if (!!((_c = _window().gapi) === null || _c === void 0 ? void 0 : _c.load)) {
      loadGapiIframe();
    } else {
      const cbName = _generateCallbackName("iframefcb");
      _window()[cbName] = () => {
        if (!!gapi.load) {
          loadGapiIframe();
        } else {
          reject(_createError(
            auth2,
            "network-request-failed"
            /* AuthErrorCode.NETWORK_REQUEST_FAILED */
          ));
        }
      };
      return _loadJS(`${_gapiScriptUrl()}?onload=${cbName}`).catch((e) => reject(e));
    }
  }).catch((error) => {
    cachedGApiLoader = null;
    throw error;
  });
}
let cachedGApiLoader = null;
function _loadGapi(auth2) {
  cachedGApiLoader = cachedGApiLoader || loadGapi(auth2);
  return cachedGApiLoader;
}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const PING_TIMEOUT = new Delay(5e3, 15e3);
const IFRAME_PATH = "__/auth/iframe";
const EMULATED_IFRAME_PATH = "emulator/auth/iframe";
const IFRAME_ATTRIBUTES = {
  style: {
    position: "absolute",
    top: "-100px",
    width: "1px",
    height: "1px"
  },
  "aria-hidden": "true",
  tabindex: "-1"
};
const EID_FROM_APIHOST = /* @__PURE__ */ new Map([
  ["identitytoolkit.googleapis.com", "p"],
  ["staging-identitytoolkit.sandbox.googleapis.com", "s"],
  ["test-identitytoolkit.sandbox.googleapis.com", "t"]
  // test
]);
function getIframeUrl(auth2) {
  const config = auth2.config;
  _assert(
    config.authDomain,
    auth2,
    "auth-domain-config-required"
    /* AuthErrorCode.MISSING_AUTH_DOMAIN */
  );
  const url = config.emulator ? _emulatorUrl(config, EMULATED_IFRAME_PATH) : `https://${auth2.config.authDomain}/${IFRAME_PATH}`;
  const params = {
    apiKey: config.apiKey,
    appName: auth2.name,
    v: SDK_VERSION
  };
  const eid = EID_FROM_APIHOST.get(auth2.config.apiHost);
  if (eid) {
    params.eid = eid;
  }
  const frameworks = auth2._getFrameworks();
  if (frameworks.length) {
    params.fw = frameworks.join(",");
  }
  return `${url}?${querystring(params).slice(1)}`;
}
async function _openIframe(auth2) {
  const context = await _loadGapi(auth2);
  const gapi2 = _window().gapi;
  _assert(
    gapi2,
    auth2,
    "internal-error"
    /* AuthErrorCode.INTERNAL_ERROR */
  );
  return context.open({
    where: document.body,
    url: getIframeUrl(auth2),
    messageHandlersFilter: gapi2.iframes.CROSS_ORIGIN_IFRAMES_FILTER,
    attributes: IFRAME_ATTRIBUTES,
    dontclear: true
  }, (iframe) => new Promise(async (resolve, reject) => {
    await iframe.restyle({
      // Prevent iframe from closing on mouse out.
      setHideOnLeave: false
    });
    const networkError = _createError(
      auth2,
      "network-request-failed"
      /* AuthErrorCode.NETWORK_REQUEST_FAILED */
    );
    const networkErrorTimer = _window().setTimeout(() => {
      reject(networkError);
    }, PING_TIMEOUT.get());
    function clearTimerAndResolve() {
      _window().clearTimeout(networkErrorTimer);
      resolve(iframe);
    }
    iframe.ping(clearTimerAndResolve).then(clearTimerAndResolve, () => {
      reject(networkError);
    });
  }));
}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const BASE_POPUP_OPTIONS = {
  location: "yes",
  resizable: "yes",
  statusbar: "yes",
  toolbar: "no"
};
const DEFAULT_WIDTH = 500;
const DEFAULT_HEIGHT = 600;
const TARGET_BLANK = "_blank";
const FIREFOX_EMPTY_URL = "http://localhost";
class AuthPopup {
  constructor(window2) {
    this.window = window2;
    this.associatedEvent = null;
  }
  close() {
    if (this.window) {
      try {
        this.window.close();
      } catch (e) {
      }
    }
  }
}
function _open(auth2, url, name2, width = DEFAULT_WIDTH, height = DEFAULT_HEIGHT) {
  const top = Math.max((window.screen.availHeight - height) / 2, 0).toString();
  const left = Math.max((window.screen.availWidth - width) / 2, 0).toString();
  let target = "";
  const options = Object.assign(Object.assign({}, BASE_POPUP_OPTIONS), {
    width: width.toString(),
    height: height.toString(),
    top,
    left
  });
  const ua = getUA().toLowerCase();
  if (name2) {
    target = _isChromeIOS(ua) ? TARGET_BLANK : name2;
  }
  if (_isFirefox(ua)) {
    url = url || FIREFOX_EMPTY_URL;
    options.scrollbars = "yes";
  }
  const optionsString = Object.entries(options).reduce((accum, [key, value]) => `${accum}${key}=${value},`, "");
  if (_isIOSStandalone(ua) && target !== "_self") {
    openAsNewWindowIOS(url || "", target);
    return new AuthPopup(null);
  }
  const newWin = window.open(url || "", target, optionsString);
  _assert(
    newWin,
    auth2,
    "popup-blocked"
    /* AuthErrorCode.POPUP_BLOCKED */
  );
  try {
    newWin.focus();
  } catch (e) {
  }
  return new AuthPopup(newWin);
}
function openAsNewWindowIOS(url, target) {
  const el = document.createElement("a");
  el.href = url;
  el.target = target;
  const click = document.createEvent("MouseEvent");
  click.initMouseEvent("click", true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 1, null);
  el.dispatchEvent(click);
}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const WIDGET_PATH = "__/auth/handler";
const EMULATOR_WIDGET_PATH = "emulator/auth/handler";
const FIREBASE_APP_CHECK_FRAGMENT_ID = encodeURIComponent("fac");
async function _getRedirectUrl(auth2, provider, authType, redirectUrl, eventId, additionalParams) {
  _assert(
    auth2.config.authDomain,
    auth2,
    "auth-domain-config-required"
    /* AuthErrorCode.MISSING_AUTH_DOMAIN */
  );
  _assert(
    auth2.config.apiKey,
    auth2,
    "invalid-api-key"
    /* AuthErrorCode.INVALID_API_KEY */
  );
  const params = {
    apiKey: auth2.config.apiKey,
    appName: auth2.name,
    authType,
    redirectUrl,
    v: SDK_VERSION,
    eventId
  };
  if (provider instanceof FederatedAuthProvider) {
    provider.setDefaultLanguage(auth2.languageCode);
    params.providerId = provider.providerId || "";
    if (!isEmpty$1(provider.getCustomParameters())) {
      params.customParameters = JSON.stringify(provider.getCustomParameters());
    }
    for (const [key, value] of Object.entries({})) {
      params[key] = value;
    }
  }
  if (provider instanceof BaseOAuthProvider) {
    const scopes = provider.getScopes().filter((scope) => scope !== "");
    if (scopes.length > 0) {
      params.scopes = scopes.join(",");
    }
  }
  if (auth2.tenantId) {
    params.tid = auth2.tenantId;
  }
  const paramsDict = params;
  for (const key of Object.keys(paramsDict)) {
    if (paramsDict[key] === void 0) {
      delete paramsDict[key];
    }
  }
  const appCheckToken = await auth2._getAppCheckToken();
  const appCheckTokenFragment = appCheckToken ? `#${FIREBASE_APP_CHECK_FRAGMENT_ID}=${encodeURIComponent(appCheckToken)}` : "";
  return `${getHandlerBase(auth2)}?${querystring(paramsDict).slice(1)}${appCheckTokenFragment}`;
}
function getHandlerBase({ config }) {
  if (!config.emulator) {
    return `https://${config.authDomain}/${WIDGET_PATH}`;
  }
  return _emulatorUrl(config, EMULATOR_WIDGET_PATH);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const WEB_STORAGE_SUPPORT_KEY = "webStorageSupport";
class BrowserPopupRedirectResolver {
  constructor() {
    this.eventManagers = {};
    this.iframes = {};
    this.originValidationPromises = {};
    this._redirectPersistence = browserSessionPersistence;
    this._completeRedirectFn = _getRedirectResult;
    this._overrideRedirectResult = _overrideRedirectResult;
  }
  // Wrapping in async even though we don't await anywhere in order
  // to make sure errors are raised as promise rejections
  async _openPopup(auth2, provider, authType, eventId) {
    var _a;
    debugAssert((_a = this.eventManagers[auth2._key()]) === null || _a === void 0 ? void 0 : _a.manager, "_initialize() not called before _openPopup()");
    const url = await _getRedirectUrl(auth2, provider, authType, _getCurrentUrl(), eventId);
    return _open(auth2, url, _generateEventId());
  }
  async _openRedirect(auth2, provider, authType, eventId) {
    await this._originValidation(auth2);
    const url = await _getRedirectUrl(auth2, provider, authType, _getCurrentUrl(), eventId);
    _setWindowLocation(url);
    return new Promise(() => {
    });
  }
  _initialize(auth2) {
    const key = auth2._key();
    if (this.eventManagers[key]) {
      const { manager, promise: promise2 } = this.eventManagers[key];
      if (manager) {
        return Promise.resolve(manager);
      } else {
        debugAssert(promise2, "If manager is not set, promise should be");
        return promise2;
      }
    }
    const promise = this.initAndGetManager(auth2);
    this.eventManagers[key] = { promise };
    promise.catch(() => {
      delete this.eventManagers[key];
    });
    return promise;
  }
  async initAndGetManager(auth2) {
    const iframe = await _openIframe(auth2);
    const manager = new AuthEventManager(auth2);
    iframe.register("authEvent", (iframeEvent) => {
      _assert(
        iframeEvent === null || iframeEvent === void 0 ? void 0 : iframeEvent.authEvent,
        auth2,
        "invalid-auth-event"
        /* AuthErrorCode.INVALID_AUTH_EVENT */
      );
      const handled = manager.onEvent(iframeEvent.authEvent);
      return {
        status: handled ? "ACK" : "ERROR"
        /* GapiOutcome.ERROR */
      };
    }, gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER);
    this.eventManagers[auth2._key()] = { manager };
    this.iframes[auth2._key()] = iframe;
    return manager;
  }
  _isIframeWebStorageSupported(auth2, cb) {
    const iframe = this.iframes[auth2._key()];
    iframe.send(WEB_STORAGE_SUPPORT_KEY, { type: WEB_STORAGE_SUPPORT_KEY }, (result) => {
      var _a;
      const isSupported = (_a = result === null || result === void 0 ? void 0 : result[0]) === null || _a === void 0 ? void 0 : _a[WEB_STORAGE_SUPPORT_KEY];
      if (isSupported !== void 0) {
        cb(!!isSupported);
      }
      _fail(
        auth2,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
    }, gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER);
  }
  _originValidation(auth2) {
    const key = auth2._key();
    if (!this.originValidationPromises[key]) {
      this.originValidationPromises[key] = _validateOrigin(auth2);
    }
    return this.originValidationPromises[key];
  }
  get _shouldInitProactively() {
    return _isMobileBrowser() || _isSafari() || _isIOS();
  }
}
const browserPopupRedirectResolver = BrowserPopupRedirectResolver;
var name = "@firebase/auth";
var version = "1.7.9";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class AuthInterop {
  constructor(auth2) {
    this.auth = auth2;
    this.internalListeners = /* @__PURE__ */ new Map();
  }
  getUid() {
    var _a;
    this.assertAuthConfigured();
    return ((_a = this.auth.currentUser) === null || _a === void 0 ? void 0 : _a.uid) || null;
  }
  async getToken(forceRefresh) {
    this.assertAuthConfigured();
    await this.auth._initializationPromise;
    if (!this.auth.currentUser) {
      return null;
    }
    const accessToken = await this.auth.currentUser.getIdToken(forceRefresh);
    return { accessToken };
  }
  addAuthTokenListener(listener) {
    this.assertAuthConfigured();
    if (this.internalListeners.has(listener)) {
      return;
    }
    const unsubscribe = this.auth.onIdTokenChanged((user) => {
      listener((user === null || user === void 0 ? void 0 : user.stsTokenManager.accessToken) || null);
    });
    this.internalListeners.set(listener, unsubscribe);
    this.updateProactiveRefresh();
  }
  removeAuthTokenListener(listener) {
    this.assertAuthConfigured();
    const unsubscribe = this.internalListeners.get(listener);
    if (!unsubscribe) {
      return;
    }
    this.internalListeners.delete(listener);
    unsubscribe();
    this.updateProactiveRefresh();
  }
  assertAuthConfigured() {
    _assert(
      this.auth._initializationPromise,
      "dependent-sdk-initialized-before-auth"
      /* AuthErrorCode.DEPENDENT_SDK_INIT_BEFORE_AUTH */
    );
  }
  updateProactiveRefresh() {
    if (this.internalListeners.size > 0) {
      this.auth._startProactiveRefresh();
    } else {
      this.auth._stopProactiveRefresh();
    }
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function getVersionForPlatform(clientPlatform) {
  switch (clientPlatform) {
    case "Node":
      return "node";
    case "ReactNative":
      return "rn";
    case "Worker":
      return "webworker";
    case "Cordova":
      return "cordova";
    case "WebExtension":
      return "web-extension";
    default:
      return void 0;
  }
}
function registerAuth(clientPlatform) {
  _registerComponent(new Component(
    "auth",
    (container, { options: deps }) => {
      const app2 = container.getProvider("app").getImmediate();
      const heartbeatServiceProvider = container.getProvider("heartbeat");
      const appCheckServiceProvider = container.getProvider("app-check-internal");
      const { apiKey, authDomain } = app2.options;
      _assert(apiKey && !apiKey.includes(":"), "invalid-api-key", { appName: app2.name });
      const config = {
        apiKey,
        authDomain,
        clientPlatform,
        apiHost: "identitytoolkit.googleapis.com",
        tokenApiHost: "securetoken.googleapis.com",
        apiScheme: "https",
        sdkClientVersion: _getClientVersion(clientPlatform)
      };
      const authInstance = new AuthImpl(app2, heartbeatServiceProvider, appCheckServiceProvider, config);
      _initializeAuthInstance(authInstance, deps);
      return authInstance;
    },
    "PUBLIC"
    /* ComponentType.PUBLIC */
  ).setInstantiationMode(
    "EXPLICIT"
    /* InstantiationMode.EXPLICIT */
  ).setInstanceCreatedCallback((container, _instanceIdentifier, _instance) => {
    const authInternalProvider = container.getProvider(
      "auth-internal"
      /* _ComponentName.AUTH_INTERNAL */
    );
    authInternalProvider.initialize();
  }));
  _registerComponent(new Component(
    "auth-internal",
    (container) => {
      const auth2 = _castAuth(container.getProvider(
        "auth"
        /* _ComponentName.AUTH */
      ).getImmediate());
      return ((auth3) => new AuthInterop(auth3))(auth2);
    },
    "PRIVATE"
    /* ComponentType.PRIVATE */
  ).setInstantiationMode(
    "EXPLICIT"
    /* InstantiationMode.EXPLICIT */
  ));
  registerVersion(name, version, getVersionForPlatform(clientPlatform));
  registerVersion(name, version, "esm2017");
}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const DEFAULT_ID_TOKEN_MAX_AGE = 5 * 60;
const authIdTokenMaxAge = getExperimentalSetting("authIdTokenMaxAge") || DEFAULT_ID_TOKEN_MAX_AGE;
let lastPostedIdToken = null;
const mintCookieFactory = (url) => async (user) => {
  const idTokenResult = user && await user.getIdTokenResult();
  const idTokenAge = idTokenResult && ((/* @__PURE__ */ new Date()).getTime() - Date.parse(idTokenResult.issuedAtTime)) / 1e3;
  if (idTokenAge && idTokenAge > authIdTokenMaxAge) {
    return;
  }
  const idToken = idTokenResult === null || idTokenResult === void 0 ? void 0 : idTokenResult.token;
  if (lastPostedIdToken === idToken) {
    return;
  }
  lastPostedIdToken = idToken;
  await fetch(url, {
    method: idToken ? "POST" : "DELETE",
    headers: idToken ? {
      "Authorization": `Bearer ${idToken}`
    } : {}
  });
};
function getAuth(app2 = getApp()) {
  const provider = _getProvider(app2, "auth");
  if (provider.isInitialized()) {
    return provider.getImmediate();
  }
  const auth2 = initializeAuth(app2, {
    popupRedirectResolver: browserPopupRedirectResolver,
    persistence: [
      indexedDBLocalPersistence,
      browserLocalPersistence,
      browserSessionPersistence
    ]
  });
  const authTokenSyncPath = getExperimentalSetting("authTokenSyncURL");
  if (authTokenSyncPath && typeof isSecureContext === "boolean" && isSecureContext) {
    const authTokenSyncUrl = new URL(authTokenSyncPath, location.origin);
    if (location.origin === authTokenSyncUrl.origin) {
      const mintCookie = mintCookieFactory(authTokenSyncUrl.toString());
      beforeAuthStateChanged(auth2, mintCookie, () => mintCookie(auth2.currentUser));
      onIdTokenChanged(auth2, (user) => mintCookie(user));
    }
  }
  const authEmulatorHost = getDefaultEmulatorHost("auth");
  if (authEmulatorHost) {
    connectAuthEmulator(auth2, `http://${authEmulatorHost}`);
  }
  return auth2;
}
function getScriptParentElement() {
  var _a, _b;
  return (_b = (_a = document.getElementsByTagName("head")) === null || _a === void 0 ? void 0 : _a[0]) !== null && _b !== void 0 ? _b : document;
}
_setExternalJSProvider({
  loadJS(url) {
    return new Promise((resolve, reject) => {
      const el = document.createElement("script");
      el.setAttribute("src", url);
      el.onload = resolve;
      el.onerror = (e) => {
        const error = _createError(
          "internal-error"
          /* AuthErrorCode.INTERNAL_ERROR */
        );
        error.customData = e;
        reject(error);
      };
      el.type = "text/javascript";
      el.charset = "UTF-8";
      getScriptParentElement().appendChild(el);
    });
  },
  gapiScript: "https://apis.google.com/js/api.js",
  recaptchaV2Script: "https://www.google.com/recaptcha/api.js",
  recaptchaEnterpriseScript: "https://www.google.com/recaptcha/enterprise.js?render="
});
registerAuth(
  "Browser"
  /* ClientPlatform.BROWSER */
);
var commonjsGlobal$1 = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/
var Integer;
var Md5;
(function() {
  var h;
  /** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */
  function k(f, a) {
    function c() {
    }
    c.prototype = a.prototype;
    f.D = a.prototype;
    f.prototype = new c();
    f.prototype.constructor = f;
    f.C = function(d, e, g) {
      for (var b2 = Array(arguments.length - 2), r = 2; r < arguments.length; r++) b2[r - 2] = arguments[r];
      return a.prototype[e].apply(d, b2);
    };
  }
  function l() {
    this.blockSize = -1;
  }
  function m() {
    this.blockSize = -1;
    this.blockSize = 64;
    this.g = Array(4);
    this.B = Array(this.blockSize);
    this.o = this.h = 0;
    this.s();
  }
  k(m, l);
  m.prototype.s = function() {
    this.g[0] = 1732584193;
    this.g[1] = 4023233417;
    this.g[2] = 2562383102;
    this.g[3] = 271733878;
    this.o = this.h = 0;
  };
  function n(f, a, c) {
    c || (c = 0);
    var d = Array(16);
    if ("string" === typeof a) for (var e = 0; 16 > e; ++e) d[e] = a.charCodeAt(c++) | a.charCodeAt(c++) << 8 | a.charCodeAt(c++) << 16 | a.charCodeAt(c++) << 24;
    else for (e = 0; 16 > e; ++e) d[e] = a[c++] | a[c++] << 8 | a[c++] << 16 | a[c++] << 24;
    a = f.g[0];
    c = f.g[1];
    e = f.g[2];
    var g = f.g[3];
    var b2 = a + (g ^ c & (e ^ g)) + d[0] + 3614090360 & 4294967295;
    a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
    b2 = g + (e ^ a & (c ^ e)) + d[1] + 3905402710 & 4294967295;
    g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
    b2 = e + (c ^ g & (a ^ c)) + d[2] + 606105819 & 4294967295;
    e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
    b2 = c + (a ^ e & (g ^ a)) + d[3] + 3250441966 & 4294967295;
    c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
    b2 = a + (g ^ c & (e ^ g)) + d[4] + 4118548399 & 4294967295;
    a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
    b2 = g + (e ^ a & (c ^ e)) + d[5] + 1200080426 & 4294967295;
    g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
    b2 = e + (c ^ g & (a ^ c)) + d[6] + 2821735955 & 4294967295;
    e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
    b2 = c + (a ^ e & (g ^ a)) + d[7] + 4249261313 & 4294967295;
    c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
    b2 = a + (g ^ c & (e ^ g)) + d[8] + 1770035416 & 4294967295;
    a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
    b2 = g + (e ^ a & (c ^ e)) + d[9] + 2336552879 & 4294967295;
    g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
    b2 = e + (c ^ g & (a ^ c)) + d[10] + 4294925233 & 4294967295;
    e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
    b2 = c + (a ^ e & (g ^ a)) + d[11] + 2304563134 & 4294967295;
    c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
    b2 = a + (g ^ c & (e ^ g)) + d[12] + 1804603682 & 4294967295;
    a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
    b2 = g + (e ^ a & (c ^ e)) + d[13] + 4254626195 & 4294967295;
    g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
    b2 = e + (c ^ g & (a ^ c)) + d[14] + 2792965006 & 4294967295;
    e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
    b2 = c + (a ^ e & (g ^ a)) + d[15] + 1236535329 & 4294967295;
    c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
    b2 = a + (e ^ g & (c ^ e)) + d[1] + 4129170786 & 4294967295;
    a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
    b2 = g + (c ^ e & (a ^ c)) + d[6] + 3225465664 & 4294967295;
    g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
    b2 = e + (a ^ c & (g ^ a)) + d[11] + 643717713 & 4294967295;
    e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
    b2 = c + (g ^ a & (e ^ g)) + d[0] + 3921069994 & 4294967295;
    c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
    b2 = a + (e ^ g & (c ^ e)) + d[5] + 3593408605 & 4294967295;
    a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
    b2 = g + (c ^ e & (a ^ c)) + d[10] + 38016083 & 4294967295;
    g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
    b2 = e + (a ^ c & (g ^ a)) + d[15] + 3634488961 & 4294967295;
    e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
    b2 = c + (g ^ a & (e ^ g)) + d[4] + 3889429448 & 4294967295;
    c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
    b2 = a + (e ^ g & (c ^ e)) + d[9] + 568446438 & 4294967295;
    a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
    b2 = g + (c ^ e & (a ^ c)) + d[14] + 3275163606 & 4294967295;
    g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
    b2 = e + (a ^ c & (g ^ a)) + d[3] + 4107603335 & 4294967295;
    e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
    b2 = c + (g ^ a & (e ^ g)) + d[8] + 1163531501 & 4294967295;
    c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
    b2 = a + (e ^ g & (c ^ e)) + d[13] + 2850285829 & 4294967295;
    a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
    b2 = g + (c ^ e & (a ^ c)) + d[2] + 4243563512 & 4294967295;
    g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
    b2 = e + (a ^ c & (g ^ a)) + d[7] + 1735328473 & 4294967295;
    e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
    b2 = c + (g ^ a & (e ^ g)) + d[12] + 2368359562 & 4294967295;
    c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
    b2 = a + (c ^ e ^ g) + d[5] + 4294588738 & 4294967295;
    a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
    b2 = g + (a ^ c ^ e) + d[8] + 2272392833 & 4294967295;
    g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
    b2 = e + (g ^ a ^ c) + d[11] + 1839030562 & 4294967295;
    e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
    b2 = c + (e ^ g ^ a) + d[14] + 4259657740 & 4294967295;
    c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
    b2 = a + (c ^ e ^ g) + d[1] + 2763975236 & 4294967295;
    a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
    b2 = g + (a ^ c ^ e) + d[4] + 1272893353 & 4294967295;
    g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
    b2 = e + (g ^ a ^ c) + d[7] + 4139469664 & 4294967295;
    e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
    b2 = c + (e ^ g ^ a) + d[10] + 3200236656 & 4294967295;
    c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
    b2 = a + (c ^ e ^ g) + d[13] + 681279174 & 4294967295;
    a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
    b2 = g + (a ^ c ^ e) + d[0] + 3936430074 & 4294967295;
    g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
    b2 = e + (g ^ a ^ c) + d[3] + 3572445317 & 4294967295;
    e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
    b2 = c + (e ^ g ^ a) + d[6] + 76029189 & 4294967295;
    c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
    b2 = a + (c ^ e ^ g) + d[9] + 3654602809 & 4294967295;
    a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
    b2 = g + (a ^ c ^ e) + d[12] + 3873151461 & 4294967295;
    g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
    b2 = e + (g ^ a ^ c) + d[15] + 530742520 & 4294967295;
    e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
    b2 = c + (e ^ g ^ a) + d[2] + 3299628645 & 4294967295;
    c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
    b2 = a + (e ^ (c | ~g)) + d[0] + 4096336452 & 4294967295;
    a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
    b2 = g + (c ^ (a | ~e)) + d[7] + 1126891415 & 4294967295;
    g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
    b2 = e + (a ^ (g | ~c)) + d[14] + 2878612391 & 4294967295;
    e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
    b2 = c + (g ^ (e | ~a)) + d[5] + 4237533241 & 4294967295;
    c = e + (b2 << 21 & 4294967295 | b2 >>> 11);
    b2 = a + (e ^ (c | ~g)) + d[12] + 1700485571 & 4294967295;
    a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
    b2 = g + (c ^ (a | ~e)) + d[3] + 2399980690 & 4294967295;
    g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
    b2 = e + (a ^ (g | ~c)) + d[10] + 4293915773 & 4294967295;
    e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
    b2 = c + (g ^ (e | ~a)) + d[1] + 2240044497 & 4294967295;
    c = e + (b2 << 21 & 4294967295 | b2 >>> 11);
    b2 = a + (e ^ (c | ~g)) + d[8] + 1873313359 & 4294967295;
    a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
    b2 = g + (c ^ (a | ~e)) + d[15] + 4264355552 & 4294967295;
    g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
    b2 = e + (a ^ (g | ~c)) + d[6] + 2734768916 & 4294967295;
    e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
    b2 = c + (g ^ (e | ~a)) + d[13] + 1309151649 & 4294967295;
    c = e + (b2 << 21 & 4294967295 | b2 >>> 11);
    b2 = a + (e ^ (c | ~g)) + d[4] + 4149444226 & 4294967295;
    a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
    b2 = g + (c ^ (a | ~e)) + d[11] + 3174756917 & 4294967295;
    g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
    b2 = e + (a ^ (g | ~c)) + d[2] + 718787259 & 4294967295;
    e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
    b2 = c + (g ^ (e | ~a)) + d[9] + 3951481745 & 4294967295;
    f.g[0] = f.g[0] + a & 4294967295;
    f.g[1] = f.g[1] + (e + (b2 << 21 & 4294967295 | b2 >>> 11)) & 4294967295;
    f.g[2] = f.g[2] + e & 4294967295;
    f.g[3] = f.g[3] + g & 4294967295;
  }
  m.prototype.u = function(f, a) {
    void 0 === a && (a = f.length);
    for (var c = a - this.blockSize, d = this.B, e = this.h, g = 0; g < a; ) {
      if (0 == e) for (; g <= c; ) n(this, f, g), g += this.blockSize;
      if ("string" === typeof f) for (; g < a; ) {
        if (d[e++] = f.charCodeAt(g++), e == this.blockSize) {
          n(this, d);
          e = 0;
          break;
        }
      }
      else for (; g < a; ) if (d[e++] = f[g++], e == this.blockSize) {
        n(this, d);
        e = 0;
        break;
      }
    }
    this.h = e;
    this.o += a;
  };
  m.prototype.v = function() {
    var f = Array((56 > this.h ? this.blockSize : 2 * this.blockSize) - this.h);
    f[0] = 128;
    for (var a = 1; a < f.length - 8; ++a) f[a] = 0;
    var c = 8 * this.o;
    for (a = f.length - 8; a < f.length; ++a) f[a] = c & 255, c /= 256;
    this.u(f);
    f = Array(16);
    for (a = c = 0; 4 > a; ++a) for (var d = 0; 32 > d; d += 8) f[c++] = this.g[a] >>> d & 255;
    return f;
  };
  function p(f, a) {
    var c = q;
    return Object.prototype.hasOwnProperty.call(c, f) ? c[f] : c[f] = a(f);
  }
  function t(f, a) {
    this.h = a;
    for (var c = [], d = true, e = f.length - 1; 0 <= e; e--) {
      var g = f[e] | 0;
      d && g == a || (c[e] = g, d = false);
    }
    this.g = c;
  }
  var q = {};
  function u(f) {
    return -128 <= f && 128 > f ? p(f, function(a) {
      return new t([a | 0], 0 > a ? -1 : 0);
    }) : new t([f | 0], 0 > f ? -1 : 0);
  }
  function v2(f) {
    if (isNaN(f) || !isFinite(f)) return w2;
    if (0 > f) return x(v2(-f));
    for (var a = [], c = 1, d = 0; f >= c; d++) a[d] = f / c | 0, c *= 4294967296;
    return new t(a, 0);
  }
  function y(f, a) {
    if (0 == f.length) throw Error("number format error: empty string");
    a = a || 10;
    if (2 > a || 36 < a) throw Error("radix out of range: " + a);
    if ("-" == f.charAt(0)) return x(y(f.substring(1), a));
    if (0 <= f.indexOf("-")) throw Error('number format error: interior "-" character');
    for (var c = v2(Math.pow(a, 8)), d = w2, e = 0; e < f.length; e += 8) {
      var g = Math.min(8, f.length - e), b2 = parseInt(f.substring(e, e + g), a);
      8 > g ? (g = v2(Math.pow(a, g)), d = d.j(g).add(v2(b2))) : (d = d.j(c), d = d.add(v2(b2)));
    }
    return d;
  }
  var w2 = u(0), z = u(1), A = u(16777216);
  h = t.prototype;
  h.m = function() {
    if (B(this)) return -x(this).m();
    for (var f = 0, a = 1, c = 0; c < this.g.length; c++) {
      var d = this.i(c);
      f += (0 <= d ? d : 4294967296 + d) * a;
      a *= 4294967296;
    }
    return f;
  };
  h.toString = function(f) {
    f = f || 10;
    if (2 > f || 36 < f) throw Error("radix out of range: " + f);
    if (C2(this)) return "0";
    if (B(this)) return "-" + x(this).toString(f);
    for (var a = v2(Math.pow(f, 6)), c = this, d = ""; ; ) {
      var e = D2(c, a).g;
      c = F(c, e.j(a));
      var g = ((0 < c.g.length ? c.g[0] : c.h) >>> 0).toString(f);
      c = e;
      if (C2(c)) return g + d;
      for (; 6 > g.length; ) g = "0" + g;
      d = g + d;
    }
  };
  h.i = function(f) {
    return 0 > f ? 0 : f < this.g.length ? this.g[f] : this.h;
  };
  function C2(f) {
    if (0 != f.h) return false;
    for (var a = 0; a < f.g.length; a++) if (0 != f.g[a]) return false;
    return true;
  }
  function B(f) {
    return -1 == f.h;
  }
  h.l = function(f) {
    f = F(this, f);
    return B(f) ? -1 : C2(f) ? 0 : 1;
  };
  function x(f) {
    for (var a = f.g.length, c = [], d = 0; d < a; d++) c[d] = ~f.g[d];
    return new t(c, ~f.h).add(z);
  }
  h.abs = function() {
    return B(this) ? x(this) : this;
  };
  h.add = function(f) {
    for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0, e = 0; e <= a; e++) {
      var g = d + (this.i(e) & 65535) + (f.i(e) & 65535), b2 = (g >>> 16) + (this.i(e) >>> 16) + (f.i(e) >>> 16);
      d = b2 >>> 16;
      g &= 65535;
      b2 &= 65535;
      c[e] = b2 << 16 | g;
    }
    return new t(c, c[c.length - 1] & -2147483648 ? -1 : 0);
  };
  function F(f, a) {
    return f.add(x(a));
  }
  h.j = function(f) {
    if (C2(this) || C2(f)) return w2;
    if (B(this)) return B(f) ? x(this).j(x(f)) : x(x(this).j(f));
    if (B(f)) return x(this.j(x(f)));
    if (0 > this.l(A) && 0 > f.l(A)) return v2(this.m() * f.m());
    for (var a = this.g.length + f.g.length, c = [], d = 0; d < 2 * a; d++) c[d] = 0;
    for (d = 0; d < this.g.length; d++) for (var e = 0; e < f.g.length; e++) {
      var g = this.i(d) >>> 16, b2 = this.i(d) & 65535, r = f.i(e) >>> 16, E = f.i(e) & 65535;
      c[2 * d + 2 * e] += b2 * E;
      G(c, 2 * d + 2 * e);
      c[2 * d + 2 * e + 1] += g * E;
      G(c, 2 * d + 2 * e + 1);
      c[2 * d + 2 * e + 1] += b2 * r;
      G(c, 2 * d + 2 * e + 1);
      c[2 * d + 2 * e + 2] += g * r;
      G(c, 2 * d + 2 * e + 2);
    }
    for (d = 0; d < a; d++) c[d] = c[2 * d + 1] << 16 | c[2 * d];
    for (d = a; d < 2 * a; d++) c[d] = 0;
    return new t(c, 0);
  };
  function G(f, a) {
    for (; (f[a] & 65535) != f[a]; ) f[a + 1] += f[a] >>> 16, f[a] &= 65535, a++;
  }
  function H(f, a) {
    this.g = f;
    this.h = a;
  }
  function D2(f, a) {
    if (C2(a)) throw Error("division by zero");
    if (C2(f)) return new H(w2, w2);
    if (B(f)) return a = D2(x(f), a), new H(x(a.g), x(a.h));
    if (B(a)) return a = D2(f, x(a)), new H(x(a.g), a.h);
    if (30 < f.g.length) {
      if (B(f) || B(a)) throw Error("slowDivide_ only works with positive integers.");
      for (var c = z, d = a; 0 >= d.l(f); ) c = I(c), d = I(d);
      var e = J(c, 1), g = J(d, 1);
      d = J(d, 2);
      for (c = J(c, 2); !C2(d); ) {
        var b2 = g.add(d);
        0 >= b2.l(f) && (e = e.add(c), g = b2);
        d = J(d, 1);
        c = J(c, 1);
      }
      a = F(f, e.j(a));
      return new H(e, a);
    }
    for (e = w2; 0 <= f.l(a); ) {
      c = Math.max(1, Math.floor(f.m() / a.m()));
      d = Math.ceil(Math.log(c) / Math.LN2);
      d = 48 >= d ? 1 : Math.pow(2, d - 48);
      g = v2(c);
      for (b2 = g.j(a); B(b2) || 0 < b2.l(f); ) c -= d, g = v2(c), b2 = g.j(a);
      C2(g) && (g = z);
      e = e.add(g);
      f = F(f, b2);
    }
    return new H(e, f);
  }
  h.A = function(f) {
    return D2(this, f).h;
  };
  h.and = function(f) {
    for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0; d < a; d++) c[d] = this.i(d) & f.i(d);
    return new t(c, this.h & f.h);
  };
  h.or = function(f) {
    for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0; d < a; d++) c[d] = this.i(d) | f.i(d);
    return new t(c, this.h | f.h);
  };
  h.xor = function(f) {
    for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0; d < a; d++) c[d] = this.i(d) ^ f.i(d);
    return new t(c, this.h ^ f.h);
  };
  function I(f) {
    for (var a = f.g.length + 1, c = [], d = 0; d < a; d++) c[d] = f.i(d) << 1 | f.i(d - 1) >>> 31;
    return new t(c, f.h);
  }
  function J(f, a) {
    var c = a >> 5;
    a %= 32;
    for (var d = f.g.length - c, e = [], g = 0; g < d; g++) e[g] = 0 < a ? f.i(g + c) >>> a | f.i(g + c + 1) << 32 - a : f.i(g + c);
    return new t(e, f.h);
  }
  m.prototype.digest = m.prototype.v;
  m.prototype.reset = m.prototype.s;
  m.prototype.update = m.prototype.u;
  Md5 = m;
  t.prototype.add = t.prototype.add;
  t.prototype.multiply = t.prototype.j;
  t.prototype.modulo = t.prototype.A;
  t.prototype.compare = t.prototype.l;
  t.prototype.toNumber = t.prototype.m;
  t.prototype.toString = t.prototype.toString;
  t.prototype.getBits = t.prototype.i;
  t.fromNumber = v2;
  t.fromString = y;
  Integer = t;
}).apply(typeof commonjsGlobal$1 !== "undefined" ? commonjsGlobal$1 : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {});
var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/
var XhrIo;
var WebChannel;
var EventType;
var ErrorCode;
var Stat;
var Event$1;
var getStatEventTarget;
var createWebChannelTransport;
(function() {
  var h, aa = "function" == typeof Object.defineProperties ? Object.defineProperty : function(a, b2, c) {
    if (a == Array.prototype || a == Object.prototype) return a;
    a[b2] = c.value;
    return a;
  };
  function ba(a) {
    a = ["object" == typeof globalThis && globalThis, a, "object" == typeof window && window, "object" == typeof self && self, "object" == typeof commonjsGlobal && commonjsGlobal];
    for (var b2 = 0; b2 < a.length; ++b2) {
      var c = a[b2];
      if (c && c.Math == Math) return c;
    }
    throw Error("Cannot find global object");
  }
  var ca = ba(this);
  function da(a, b2) {
    if (b2) a: {
      var c = ca;
      a = a.split(".");
      for (var d = 0; d < a.length - 1; d++) {
        var e = a[d];
        if (!(e in c)) break a;
        c = c[e];
      }
      a = a[a.length - 1];
      d = c[a];
      b2 = b2(d);
      b2 != d && null != b2 && aa(c, a, { configurable: true, writable: true, value: b2 });
    }
  }
  function ea(a, b2) {
    a instanceof String && (a += "");
    var c = 0, d = false, e = { next: function() {
      if (!d && c < a.length) {
        var f = c++;
        return { value: b2(f, a[f]), done: false };
      }
      d = true;
      return { done: true, value: void 0 };
    } };
    e[Symbol.iterator] = function() {
      return e;
    };
    return e;
  }
  da("Array.prototype.values", function(a) {
    return a ? a : function() {
      return ea(this, function(b2, c) {
        return c;
      });
    };
  });
  /** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */
  var fa = fa || {}, k = this || self;
  function ha(a) {
    var b2 = typeof a;
    b2 = "object" != b2 ? b2 : a ? Array.isArray(a) ? "array" : b2 : "null";
    return "array" == b2 || "object" == b2 && "number" == typeof a.length;
  }
  function n(a) {
    var b2 = typeof a;
    return "object" == b2 && null != a || "function" == b2;
  }
  function ia(a, b2, c) {
    return a.call.apply(a.bind, arguments);
  }
  function ja(a, b2, c) {
    if (!a) throw Error();
    if (2 < arguments.length) {
      var d = Array.prototype.slice.call(arguments, 2);
      return function() {
        var e = Array.prototype.slice.call(arguments);
        Array.prototype.unshift.apply(e, d);
        return a.apply(b2, e);
      };
    }
    return function() {
      return a.apply(b2, arguments);
    };
  }
  function p(a, b2, c) {
    p = Function.prototype.bind && -1 != Function.prototype.bind.toString().indexOf("native code") ? ia : ja;
    return p.apply(null, arguments);
  }
  function ka(a, b2) {
    var c = Array.prototype.slice.call(arguments, 1);
    return function() {
      var d = c.slice();
      d.push.apply(d, arguments);
      return a.apply(this, d);
    };
  }
  function r(a, b2) {
    function c() {
    }
    c.prototype = b2.prototype;
    a.aa = b2.prototype;
    a.prototype = new c();
    a.prototype.constructor = a;
    a.Qb = function(d, e, f) {
      for (var g = Array(arguments.length - 2), m = 2; m < arguments.length; m++) g[m - 2] = arguments[m];
      return b2.prototype[e].apply(d, g);
    };
  }
  function la(a) {
    const b2 = a.length;
    if (0 < b2) {
      const c = Array(b2);
      for (let d = 0; d < b2; d++) c[d] = a[d];
      return c;
    }
    return [];
  }
  function ma(a, b2) {
    for (let c = 1; c < arguments.length; c++) {
      const d = arguments[c];
      if (ha(d)) {
        const e = a.length || 0, f = d.length || 0;
        a.length = e + f;
        for (let g = 0; g < f; g++) a[e + g] = d[g];
      } else a.push(d);
    }
  }
  class na {
    constructor(a, b2) {
      this.i = a;
      this.j = b2;
      this.h = 0;
      this.g = null;
    }
    get() {
      let a;
      0 < this.h ? (this.h--, a = this.g, this.g = a.next, a.next = null) : a = this.i();
      return a;
    }
  }
  function t(a) {
    return /^[\s\xa0]*$/.test(a);
  }
  function u() {
    var a = k.navigator;
    return a && (a = a.userAgent) ? a : "";
  }
  function oa(a) {
    oa[" "](a);
    return a;
  }
  oa[" "] = function() {
  };
  var pa = -1 != u().indexOf("Gecko") && !(-1 != u().toLowerCase().indexOf("webkit") && -1 == u().indexOf("Edge")) && !(-1 != u().indexOf("Trident") || -1 != u().indexOf("MSIE")) && -1 == u().indexOf("Edge");
  function qa(a, b2, c) {
    for (const d in a) b2.call(c, a[d], d, a);
  }
  function ra(a, b2) {
    for (const c in a) b2.call(void 0, a[c], c, a);
  }
  function sa(a) {
    const b2 = {};
    for (const c in a) b2[c] = a[c];
    return b2;
  }
  const ta = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
  function ua(a, b2) {
    let c, d;
    for (let e = 1; e < arguments.length; e++) {
      d = arguments[e];
      for (c in d) a[c] = d[c];
      for (let f = 0; f < ta.length; f++) c = ta[f], Object.prototype.hasOwnProperty.call(d, c) && (a[c] = d[c]);
    }
  }
  function va(a) {
    var b2 = 1;
    a = a.split(":");
    const c = [];
    for (; 0 < b2 && a.length; ) c.push(a.shift()), b2--;
    a.length && c.push(a.join(":"));
    return c;
  }
  function wa(a) {
    k.setTimeout(() => {
      throw a;
    }, 0);
  }
  function xa() {
    var a = za;
    let b2 = null;
    a.g && (b2 = a.g, a.g = a.g.next, a.g || (a.h = null), b2.next = null);
    return b2;
  }
  class Aa {
    constructor() {
      this.h = this.g = null;
    }
    add(a, b2) {
      const c = Ba.get();
      c.set(a, b2);
      this.h ? this.h.next = c : this.g = c;
      this.h = c;
    }
  }
  var Ba = new na(() => new Ca(), (a) => a.reset());
  class Ca {
    constructor() {
      this.next = this.g = this.h = null;
    }
    set(a, b2) {
      this.h = a;
      this.g = b2;
      this.next = null;
    }
    reset() {
      this.next = this.g = this.h = null;
    }
  }
  let x, y = false, za = new Aa(), Ea = () => {
    const a = k.Promise.resolve(void 0);
    x = () => {
      a.then(Da);
    };
  };
  var Da = () => {
    for (var a; a = xa(); ) {
      try {
        a.h.call(a.g);
      } catch (c) {
        wa(c);
      }
      var b2 = Ba;
      b2.j(a);
      100 > b2.h && (b2.h++, a.next = b2.g, b2.g = a);
    }
    y = false;
  };
  function z() {
    this.s = this.s;
    this.C = this.C;
  }
  z.prototype.s = false;
  z.prototype.ma = function() {
    this.s || (this.s = true, this.N());
  };
  z.prototype.N = function() {
    if (this.C) for (; this.C.length; ) this.C.shift()();
  };
  function A(a, b2) {
    this.type = a;
    this.g = this.target = b2;
    this.defaultPrevented = false;
  }
  A.prototype.h = function() {
    this.defaultPrevented = true;
  };
  var Fa = function() {
    if (!k.addEventListener || !Object.defineProperty) return false;
    var a = false, b2 = Object.defineProperty({}, "passive", { get: function() {
      a = true;
    } });
    try {
      const c = () => {
      };
      k.addEventListener("test", c, b2);
      k.removeEventListener("test", c, b2);
    } catch (c) {
    }
    return a;
  }();
  function C2(a, b2) {
    A.call(this, a ? a.type : "");
    this.relatedTarget = this.g = this.target = null;
    this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;
    this.key = "";
    this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = false;
    this.state = null;
    this.pointerId = 0;
    this.pointerType = "";
    this.i = null;
    if (a) {
      var c = this.type = a.type, d = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;
      this.target = a.target || a.srcElement;
      this.g = b2;
      if (b2 = a.relatedTarget) {
        if (pa) {
          a: {
            try {
              oa(b2.nodeName);
              var e = true;
              break a;
            } catch (f) {
            }
            e = false;
          }
          e || (b2 = null);
        }
      } else "mouseover" == c ? b2 = a.fromElement : "mouseout" == c && (b2 = a.toElement);
      this.relatedTarget = b2;
      d ? (this.clientX = void 0 !== d.clientX ? d.clientX : d.pageX, this.clientY = void 0 !== d.clientY ? d.clientY : d.pageY, this.screenX = d.screenX || 0, this.screenY = d.screenY || 0) : (this.clientX = void 0 !== a.clientX ? a.clientX : a.pageX, this.clientY = void 0 !== a.clientY ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);
      this.button = a.button;
      this.key = a.key || "";
      this.ctrlKey = a.ctrlKey;
      this.altKey = a.altKey;
      this.shiftKey = a.shiftKey;
      this.metaKey = a.metaKey;
      this.pointerId = a.pointerId || 0;
      this.pointerType = "string" === typeof a.pointerType ? a.pointerType : Ga[a.pointerType] || "";
      this.state = a.state;
      this.i = a;
      a.defaultPrevented && C2.aa.h.call(this);
    }
  }
  r(C2, A);
  var Ga = { 2: "touch", 3: "pen", 4: "mouse" };
  C2.prototype.h = function() {
    C2.aa.h.call(this);
    var a = this.i;
    a.preventDefault ? a.preventDefault() : a.returnValue = false;
  };
  var D2 = "closure_listenable_" + (1e6 * Math.random() | 0);
  var Ha = 0;
  function Ia(a, b2, c, d, e) {
    this.listener = a;
    this.proxy = null;
    this.src = b2;
    this.type = c;
    this.capture = !!d;
    this.ha = e;
    this.key = ++Ha;
    this.da = this.fa = false;
  }
  function Ja(a) {
    a.da = true;
    a.listener = null;
    a.proxy = null;
    a.src = null;
    a.ha = null;
  }
  function Ka(a) {
    this.src = a;
    this.g = {};
    this.h = 0;
  }
  Ka.prototype.add = function(a, b2, c, d, e) {
    var f = a.toString();
    a = this.g[f];
    a || (a = this.g[f] = [], this.h++);
    var g = La(a, b2, d, e);
    -1 < g ? (b2 = a[g], c || (b2.fa = false)) : (b2 = new Ia(b2, this.src, f, !!d, e), b2.fa = c, a.push(b2));
    return b2;
  };
  function Ma(a, b2) {
    var c = b2.type;
    if (c in a.g) {
      var d = a.g[c], e = Array.prototype.indexOf.call(d, b2, void 0), f;
      (f = 0 <= e) && Array.prototype.splice.call(d, e, 1);
      f && (Ja(b2), 0 == a.g[c].length && (delete a.g[c], a.h--));
    }
  }
  function La(a, b2, c, d) {
    for (var e = 0; e < a.length; ++e) {
      var f = a[e];
      if (!f.da && f.listener == b2 && f.capture == !!c && f.ha == d) return e;
    }
    return -1;
  }
  var Na = "closure_lm_" + (1e6 * Math.random() | 0), Oa = {};
  function Qa(a, b2, c, d, e) {
    if (Array.isArray(b2)) {
      for (var f = 0; f < b2.length; f++) Qa(a, b2[f], c, d, e);
      return null;
    }
    c = Sa(c);
    return a && a[D2] ? a.K(b2, c, n(d) ? !!d.capture : false, e) : Ta(a, b2, c, false, d, e);
  }
  function Ta(a, b2, c, d, e, f) {
    if (!b2) throw Error("Invalid event type");
    var g = n(e) ? !!e.capture : !!e, m = Ua(a);
    m || (a[Na] = m = new Ka(a));
    c = m.add(b2, c, d, g, f);
    if (c.proxy) return c;
    d = Va();
    c.proxy = d;
    d.src = a;
    d.listener = c;
    if (a.addEventListener) Fa || (e = g), void 0 === e && (e = false), a.addEventListener(b2.toString(), d, e);
    else if (a.attachEvent) a.attachEvent(Wa(b2.toString()), d);
    else if (a.addListener && a.removeListener) a.addListener(d);
    else throw Error("addEventListener and attachEvent are unavailable.");
    return c;
  }
  function Va() {
    function a(c) {
      return b2.call(a.src, a.listener, c);
    }
    const b2 = Xa;
    return a;
  }
  function Ya(a, b2, c, d, e) {
    if (Array.isArray(b2)) for (var f = 0; f < b2.length; f++) Ya(a, b2[f], c, d, e);
    else (d = n(d) ? !!d.capture : !!d, c = Sa(c), a && a[D2]) ? (a = a.i, b2 = String(b2).toString(), b2 in a.g && (f = a.g[b2], c = La(f, c, d, e), -1 < c && (Ja(f[c]), Array.prototype.splice.call(f, c, 1), 0 == f.length && (delete a.g[b2], a.h--)))) : a && (a = Ua(a)) && (b2 = a.g[b2.toString()], a = -1, b2 && (a = La(b2, c, d, e)), (c = -1 < a ? b2[a] : null) && Za(c));
  }
  function Za(a) {
    if ("number" !== typeof a && a && !a.da) {
      var b2 = a.src;
      if (b2 && b2[D2]) Ma(b2.i, a);
      else {
        var c = a.type, d = a.proxy;
        b2.removeEventListener ? b2.removeEventListener(c, d, a.capture) : b2.detachEvent ? b2.detachEvent(Wa(c), d) : b2.addListener && b2.removeListener && b2.removeListener(d);
        (c = Ua(b2)) ? (Ma(c, a), 0 == c.h && (c.src = null, b2[Na] = null)) : Ja(a);
      }
    }
  }
  function Wa(a) {
    return a in Oa ? Oa[a] : Oa[a] = "on" + a;
  }
  function Xa(a, b2) {
    if (a.da) a = true;
    else {
      b2 = new C2(b2, this);
      var c = a.listener, d = a.ha || a.src;
      a.fa && Za(a);
      a = c.call(d, b2);
    }
    return a;
  }
  function Ua(a) {
    a = a[Na];
    return a instanceof Ka ? a : null;
  }
  var $a = "__closure_events_fn_" + (1e9 * Math.random() >>> 0);
  function Sa(a) {
    if ("function" === typeof a) return a;
    a[$a] || (a[$a] = function(b2) {
      return a.handleEvent(b2);
    });
    return a[$a];
  }
  function E() {
    z.call(this);
    this.i = new Ka(this);
    this.M = this;
    this.F = null;
  }
  r(E, z);
  E.prototype[D2] = true;
  E.prototype.removeEventListener = function(a, b2, c, d) {
    Ya(this, a, b2, c, d);
  };
  function F(a, b2) {
    var c, d = a.F;
    if (d) for (c = []; d; d = d.F) c.push(d);
    a = a.M;
    d = b2.type || b2;
    if ("string" === typeof b2) b2 = new A(b2, a);
    else if (b2 instanceof A) b2.target = b2.target || a;
    else {
      var e = b2;
      b2 = new A(d, a);
      ua(b2, e);
    }
    e = true;
    if (c) for (var f = c.length - 1; 0 <= f; f--) {
      var g = b2.g = c[f];
      e = ab(g, d, true, b2) && e;
    }
    g = b2.g = a;
    e = ab(g, d, true, b2) && e;
    e = ab(g, d, false, b2) && e;
    if (c) for (f = 0; f < c.length; f++) g = b2.g = c[f], e = ab(g, d, false, b2) && e;
  }
  E.prototype.N = function() {
    E.aa.N.call(this);
    if (this.i) {
      var a = this.i, c;
      for (c in a.g) {
        for (var d = a.g[c], e = 0; e < d.length; e++) Ja(d[e]);
        delete a.g[c];
        a.h--;
      }
    }
    this.F = null;
  };
  E.prototype.K = function(a, b2, c, d) {
    return this.i.add(String(a), b2, false, c, d);
  };
  E.prototype.L = function(a, b2, c, d) {
    return this.i.add(String(a), b2, true, c, d);
  };
  function ab(a, b2, c, d) {
    b2 = a.i.g[String(b2)];
    if (!b2) return true;
    b2 = b2.concat();
    for (var e = true, f = 0; f < b2.length; ++f) {
      var g = b2[f];
      if (g && !g.da && g.capture == c) {
        var m = g.listener, q = g.ha || g.src;
        g.fa && Ma(a.i, g);
        e = false !== m.call(q, d) && e;
      }
    }
    return e && !d.defaultPrevented;
  }
  function bb(a, b2, c) {
    if ("function" === typeof a) c && (a = p(a, c));
    else if (a && "function" == typeof a.handleEvent) a = p(a.handleEvent, a);
    else throw Error("Invalid listener argument");
    return 2147483647 < Number(b2) ? -1 : k.setTimeout(a, b2 || 0);
  }
  function cb(a) {
    a.g = bb(() => {
      a.g = null;
      a.i && (a.i = false, cb(a));
    }, a.l);
    const b2 = a.h;
    a.h = null;
    a.m.apply(null, b2);
  }
  class eb extends z {
    constructor(a, b2) {
      super();
      this.m = a;
      this.l = b2;
      this.h = null;
      this.i = false;
      this.g = null;
    }
    j(a) {
      this.h = arguments;
      this.g ? this.i = true : cb(this);
    }
    N() {
      super.N();
      this.g && (k.clearTimeout(this.g), this.g = null, this.i = false, this.h = null);
    }
  }
  function G(a) {
    z.call(this);
    this.h = a;
    this.g = {};
  }
  r(G, z);
  var fb = [];
  function gb(a) {
    qa(a.g, function(b2, c) {
      this.g.hasOwnProperty(c) && Za(b2);
    }, a);
    a.g = {};
  }
  G.prototype.N = function() {
    G.aa.N.call(this);
    gb(this);
  };
  G.prototype.handleEvent = function() {
    throw Error("EventHandler.handleEvent not implemented");
  };
  var hb = k.JSON.stringify;
  var ib = k.JSON.parse;
  var jb = class {
    stringify(a) {
      return k.JSON.stringify(a, void 0);
    }
    parse(a) {
      return k.JSON.parse(a, void 0);
    }
  };
  function kb() {
  }
  kb.prototype.h = null;
  function lb(a) {
    return a.h || (a.h = a.i());
  }
  function mb() {
  }
  var H = { OPEN: "a", kb: "b", Ja: "c", wb: "d" };
  function nb() {
    A.call(this, "d");
  }
  r(nb, A);
  function ob() {
    A.call(this, "c");
  }
  r(ob, A);
  var I = {}, pb = null;
  function qb() {
    return pb = pb || new E();
  }
  I.La = "serverreachability";
  function rb(a) {
    A.call(this, I.La, a);
  }
  r(rb, A);
  function J(a) {
    const b2 = qb();
    F(b2, new rb(b2));
  }
  I.STAT_EVENT = "statevent";
  function sb(a, b2) {
    A.call(this, I.STAT_EVENT, a);
    this.stat = b2;
  }
  r(sb, A);
  function K(a) {
    const b2 = qb();
    F(b2, new sb(b2, a));
  }
  I.Ma = "timingevent";
  function tb(a, b2) {
    A.call(this, I.Ma, a);
    this.size = b2;
  }
  r(tb, A);
  function ub(a, b2) {
    if ("function" !== typeof a) throw Error("Fn must not be null and must be a function");
    return k.setTimeout(function() {
      a();
    }, b2);
  }
  function vb() {
    this.g = true;
  }
  vb.prototype.xa = function() {
    this.g = false;
  };
  function wb(a, b2, c, d, e, f) {
    a.info(function() {
      if (a.g) if (f) {
        var g = "";
        for (var m = f.split("&"), q = 0; q < m.length; q++) {
          var l = m[q].split("=");
          if (1 < l.length) {
            var v2 = l[0];
            l = l[1];
            var w2 = v2.split("_");
            g = 2 <= w2.length && "type" == w2[1] ? g + (v2 + "=" + l + "&") : g + (v2 + "=redacted&");
          }
        }
      } else g = null;
      else g = f;
      return "XMLHTTP REQ (" + d + ") [attempt " + e + "]: " + b2 + "\n" + c + "\n" + g;
    });
  }
  function xb(a, b2, c, d, e, f, g) {
    a.info(function() {
      return "XMLHTTP RESP (" + d + ") [ attempt " + e + "]: " + b2 + "\n" + c + "\n" + f + " " + g;
    });
  }
  function L(a, b2, c, d) {
    a.info(function() {
      return "XMLHTTP TEXT (" + b2 + "): " + yb(a, c) + (d ? " " + d : "");
    });
  }
  function zb(a, b2) {
    a.info(function() {
      return "TIMEOUT: " + b2;
    });
  }
  vb.prototype.info = function() {
  };
  function yb(a, b2) {
    if (!a.g) return b2;
    if (!b2) return null;
    try {
      var c = JSON.parse(b2);
      if (c) {
        for (a = 0; a < c.length; a++) if (Array.isArray(c[a])) {
          var d = c[a];
          if (!(2 > d.length)) {
            var e = d[1];
            if (Array.isArray(e) && !(1 > e.length)) {
              var f = e[0];
              if ("noop" != f && "stop" != f && "close" != f) for (var g = 1; g < e.length; g++) e[g] = "";
            }
          }
        }
      }
      return hb(c);
    } catch (m) {
      return b2;
    }
  }
  var Ab = { NO_ERROR: 0, gb: 1, tb: 2, sb: 3, nb: 4, rb: 5, ub: 6, Ia: 7, TIMEOUT: 8, xb: 9 };
  var Bb = { lb: "complete", Hb: "success", Ja: "error", Ia: "abort", zb: "ready", Ab: "readystatechange", TIMEOUT: "timeout", vb: "incrementaldata", yb: "progress", ob: "downloadprogress", Pb: "uploadprogress" };
  var Cb;
  function Db() {
  }
  r(Db, kb);
  Db.prototype.g = function() {
    return new XMLHttpRequest();
  };
  Db.prototype.i = function() {
    return {};
  };
  Cb = new Db();
  function M(a, b2, c, d) {
    this.j = a;
    this.i = b2;
    this.l = c;
    this.R = d || 1;
    this.U = new G(this);
    this.I = 45e3;
    this.H = null;
    this.o = false;
    this.m = this.A = this.v = this.L = this.F = this.S = this.B = null;
    this.D = [];
    this.g = null;
    this.C = 0;
    this.s = this.u = null;
    this.X = -1;
    this.J = false;
    this.O = 0;
    this.M = null;
    this.W = this.K = this.T = this.P = false;
    this.h = new Eb();
  }
  function Eb() {
    this.i = null;
    this.g = "";
    this.h = false;
  }
  var Fb = {}, Gb = {};
  function Hb(a, b2, c) {
    a.L = 1;
    a.v = Ib(N(b2));
    a.m = c;
    a.P = true;
    Jb(a, null);
  }
  function Jb(a, b2) {
    a.F = Date.now();
    Kb(a);
    a.A = N(a.v);
    var c = a.A, d = a.R;
    Array.isArray(d) || (d = [String(d)]);
    Lb(c.i, "t", d);
    a.C = 0;
    c = a.j.J;
    a.h = new Eb();
    a.g = Mb(a.j, c ? b2 : null, !a.m);
    0 < a.O && (a.M = new eb(p(a.Y, a, a.g), a.O));
    b2 = a.U;
    c = a.g;
    d = a.ca;
    var e = "readystatechange";
    Array.isArray(e) || (e && (fb[0] = e.toString()), e = fb);
    for (var f = 0; f < e.length; f++) {
      var g = Qa(c, e[f], d || b2.handleEvent, false, b2.h || b2);
      if (!g) break;
      b2.g[g.key] = g;
    }
    b2 = a.H ? sa(a.H) : {};
    a.m ? (a.u || (a.u = "POST"), b2["Content-Type"] = "application/x-www-form-urlencoded", a.g.ea(
      a.A,
      a.u,
      a.m,
      b2
    )) : (a.u = "GET", a.g.ea(a.A, a.u, null, b2));
    J();
    wb(a.i, a.u, a.A, a.l, a.R, a.m);
  }
  M.prototype.ca = function(a) {
    a = a.target;
    const b2 = this.M;
    b2 && 3 == P(a) ? b2.j() : this.Y(a);
  };
  M.prototype.Y = function(a) {
    try {
      if (a == this.g) a: {
        const w2 = P(this.g);
        var b2 = this.g.Ba();
        const O = this.g.Z();
        if (!(3 > w2) && (3 != w2 || this.g && (this.h.h || this.g.oa() || Nb(this.g)))) {
          this.J || 4 != w2 || 7 == b2 || (8 == b2 || 0 >= O ? J(3) : J(2));
          Ob(this);
          var c = this.g.Z();
          this.X = c;
          b: if (Pb(this)) {
            var d = Nb(this.g);
            a = "";
            var e = d.length, f = 4 == P(this.g);
            if (!this.h.i) {
              if ("undefined" === typeof TextDecoder) {
                Q(this);
                Qb(this);
                var g = "";
                break b;
              }
              this.h.i = new k.TextDecoder();
            }
            for (b2 = 0; b2 < e; b2++) this.h.h = true, a += this.h.i.decode(d[b2], { stream: !(f && b2 == e - 1) });
            d.length = 0;
            this.h.g += a;
            this.C = 0;
            g = this.h.g;
          } else g = this.g.oa();
          this.o = 200 == c;
          xb(this.i, this.u, this.A, this.l, this.R, w2, c);
          if (this.o) {
            if (this.T && !this.K) {
              b: {
                if (this.g) {
                  var m, q = this.g;
                  if ((m = q.g ? q.g.getResponseHeader("X-HTTP-Initial-Response") : null) && !t(m)) {
                    var l = m;
                    break b;
                  }
                }
                l = null;
              }
              if (c = l) L(this.i, this.l, c, "Initial handshake response via X-HTTP-Initial-Response"), this.K = true, Rb(this, c);
              else {
                this.o = false;
                this.s = 3;
                K(12);
                Q(this);
                Qb(this);
                break a;
              }
            }
            if (this.P) {
              c = true;
              let B;
              for (; !this.J && this.C < g.length; ) if (B = Sb(this, g), B == Gb) {
                4 == w2 && (this.s = 4, K(14), c = false);
                L(this.i, this.l, null, "[Incomplete Response]");
                break;
              } else if (B == Fb) {
                this.s = 4;
                K(15);
                L(this.i, this.l, g, "[Invalid Chunk]");
                c = false;
                break;
              } else L(this.i, this.l, B, null), Rb(this, B);
              Pb(this) && 0 != this.C && (this.h.g = this.h.g.slice(this.C), this.C = 0);
              4 != w2 || 0 != g.length || this.h.h || (this.s = 1, K(16), c = false);
              this.o = this.o && c;
              if (!c) L(this.i, this.l, g, "[Invalid Chunked Response]"), Q(this), Qb(this);
              else if (0 < g.length && !this.W) {
                this.W = true;
                var v2 = this.j;
                v2.g == this && v2.ba && !v2.M && (v2.j.info("Great, no buffering proxy detected. Bytes received: " + g.length), Tb(v2), v2.M = true, K(11));
              }
            } else L(this.i, this.l, g, null), Rb(this, g);
            4 == w2 && Q(this);
            this.o && !this.J && (4 == w2 ? Ub(this.j, this) : (this.o = false, Kb(this)));
          } else Vb(this.g), 400 == c && 0 < g.indexOf("Unknown SID") ? (this.s = 3, K(12)) : (this.s = 0, K(13)), Q(this), Qb(this);
        }
      }
    } catch (w2) {
    } finally {
    }
  };
  function Pb(a) {
    return a.g ? "GET" == a.u && 2 != a.L && a.j.Ca : false;
  }
  function Sb(a, b2) {
    var c = a.C, d = b2.indexOf("\n", c);
    if (-1 == d) return Gb;
    c = Number(b2.substring(c, d));
    if (isNaN(c)) return Fb;
    d += 1;
    if (d + c > b2.length) return Gb;
    b2 = b2.slice(d, d + c);
    a.C = d + c;
    return b2;
  }
  M.prototype.cancel = function() {
    this.J = true;
    Q(this);
  };
  function Kb(a) {
    a.S = Date.now() + a.I;
    Wb(a, a.I);
  }
  function Wb(a, b2) {
    if (null != a.B) throw Error("WatchDog timer not null");
    a.B = ub(p(a.ba, a), b2);
  }
  function Ob(a) {
    a.B && (k.clearTimeout(a.B), a.B = null);
  }
  M.prototype.ba = function() {
    this.B = null;
    const a = Date.now();
    0 <= a - this.S ? (zb(this.i, this.A), 2 != this.L && (J(), K(17)), Q(this), this.s = 2, Qb(this)) : Wb(this, this.S - a);
  };
  function Qb(a) {
    0 == a.j.G || a.J || Ub(a.j, a);
  }
  function Q(a) {
    Ob(a);
    var b2 = a.M;
    b2 && "function" == typeof b2.ma && b2.ma();
    a.M = null;
    gb(a.U);
    a.g && (b2 = a.g, a.g = null, b2.abort(), b2.ma());
  }
  function Rb(a, b2) {
    try {
      var c = a.j;
      if (0 != c.G && (c.g == a || Xb(c.h, a))) {
        if (!a.K && Xb(c.h, a) && 3 == c.G) {
          try {
            var d = c.Da.g.parse(b2);
          } catch (l) {
            d = null;
          }
          if (Array.isArray(d) && 3 == d.length) {
            var e = d;
            if (0 == e[0]) a: {
              if (!c.u) {
                if (c.g) if (c.g.F + 3e3 < a.F) Yb(c), Zb(c);
                else break a;
                $b(c);
                K(18);
              }
            }
            else c.za = e[1], 0 < c.za - c.T && 37500 > e[2] && c.F && 0 == c.v && !c.C && (c.C = ub(p(c.Za, c), 6e3));
            if (1 >= ac(c.h) && c.ca) {
              try {
                c.ca();
              } catch (l) {
              }
              c.ca = void 0;
            }
          } else R(c, 11);
        } else if ((a.K || c.g == a) && Yb(c), !t(b2)) for (e = c.Da.g.parse(b2), b2 = 0; b2 < e.length; b2++) {
          let l = e[b2];
          c.T = l[0];
          l = l[1];
          if (2 == c.G) if ("c" == l[0]) {
            c.K = l[1];
            c.ia = l[2];
            const v2 = l[3];
            null != v2 && (c.la = v2, c.j.info("VER=" + c.la));
            const w2 = l[4];
            null != w2 && (c.Aa = w2, c.j.info("SVER=" + c.Aa));
            const O = l[5];
            null != O && "number" === typeof O && 0 < O && (d = 1.5 * O, c.L = d, c.j.info("backChannelRequestTimeoutMs_=" + d));
            d = c;
            const B = a.g;
            if (B) {
              const ya = B.g ? B.g.getResponseHeader("X-Client-Wire-Protocol") : null;
              if (ya) {
                var f = d.h;
                f.g || -1 == ya.indexOf("spdy") && -1 == ya.indexOf("quic") && -1 == ya.indexOf("h2") || (f.j = f.l, f.g = /* @__PURE__ */ new Set(), f.h && (bc(f, f.h), f.h = null));
              }
              if (d.D) {
                const db2 = B.g ? B.g.getResponseHeader("X-HTTP-Session-Id") : null;
                db2 && (d.ya = db2, S2(d.I, d.D, db2));
              }
            }
            c.G = 3;
            c.l && c.l.ua();
            c.ba && (c.R = Date.now() - a.F, c.j.info("Handshake RTT: " + c.R + "ms"));
            d = c;
            var g = a;
            d.qa = cc(d, d.J ? d.ia : null, d.W);
            if (g.K) {
              dc(d.h, g);
              var m = g, q = d.L;
              q && (m.I = q);
              m.B && (Ob(m), Kb(m));
              d.g = g;
            } else ec(d);
            0 < c.i.length && fc(c);
          } else "stop" != l[0] && "close" != l[0] || R(c, 7);
          else 3 == c.G && ("stop" == l[0] || "close" == l[0] ? "stop" == l[0] ? R(c, 7) : gc(c) : "noop" != l[0] && c.l && c.l.ta(l), c.v = 0);
        }
      }
      J(4);
    } catch (l) {
    }
  }
  var hc = class {
    constructor(a, b2) {
      this.g = a;
      this.map = b2;
    }
  };
  function ic(a) {
    this.l = a || 10;
    k.PerformanceNavigationTiming ? (a = k.performance.getEntriesByType("navigation"), a = 0 < a.length && ("hq" == a[0].nextHopProtocol || "h2" == a[0].nextHopProtocol)) : a = !!(k.chrome && k.chrome.loadTimes && k.chrome.loadTimes() && k.chrome.loadTimes().wasFetchedViaSpdy);
    this.j = a ? this.l : 1;
    this.g = null;
    1 < this.j && (this.g = /* @__PURE__ */ new Set());
    this.h = null;
    this.i = [];
  }
  function jc(a) {
    return a.h ? true : a.g ? a.g.size >= a.j : false;
  }
  function ac(a) {
    return a.h ? 1 : a.g ? a.g.size : 0;
  }
  function Xb(a, b2) {
    return a.h ? a.h == b2 : a.g ? a.g.has(b2) : false;
  }
  function bc(a, b2) {
    a.g ? a.g.add(b2) : a.h = b2;
  }
  function dc(a, b2) {
    a.h && a.h == b2 ? a.h = null : a.g && a.g.has(b2) && a.g.delete(b2);
  }
  ic.prototype.cancel = function() {
    this.i = kc(this);
    if (this.h) this.h.cancel(), this.h = null;
    else if (this.g && 0 !== this.g.size) {
      for (const a of this.g.values()) a.cancel();
      this.g.clear();
    }
  };
  function kc(a) {
    if (null != a.h) return a.i.concat(a.h.D);
    if (null != a.g && 0 !== a.g.size) {
      let b2 = a.i;
      for (const c of a.g.values()) b2 = b2.concat(c.D);
      return b2;
    }
    return la(a.i);
  }
  function lc(a) {
    if (a.V && "function" == typeof a.V) return a.V();
    if ("undefined" !== typeof Map && a instanceof Map || "undefined" !== typeof Set && a instanceof Set) return Array.from(a.values());
    if ("string" === typeof a) return a.split("");
    if (ha(a)) {
      for (var b2 = [], c = a.length, d = 0; d < c; d++) b2.push(a[d]);
      return b2;
    }
    b2 = [];
    c = 0;
    for (d in a) b2[c++] = a[d];
    return b2;
  }
  function mc(a) {
    if (a.na && "function" == typeof a.na) return a.na();
    if (!a.V || "function" != typeof a.V) {
      if ("undefined" !== typeof Map && a instanceof Map) return Array.from(a.keys());
      if (!("undefined" !== typeof Set && a instanceof Set)) {
        if (ha(a) || "string" === typeof a) {
          var b2 = [];
          a = a.length;
          for (var c = 0; c < a; c++) b2.push(c);
          return b2;
        }
        b2 = [];
        c = 0;
        for (const d in a) b2[c++] = d;
        return b2;
      }
    }
  }
  function nc(a, b2) {
    if (a.forEach && "function" == typeof a.forEach) a.forEach(b2, void 0);
    else if (ha(a) || "string" === typeof a) Array.prototype.forEach.call(a, b2, void 0);
    else for (var c = mc(a), d = lc(a), e = d.length, f = 0; f < e; f++) b2.call(void 0, d[f], c && c[f], a);
  }
  var oc = RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");
  function pc(a, b2) {
    if (a) {
      a = a.split("&");
      for (var c = 0; c < a.length; c++) {
        var d = a[c].indexOf("="), e = null;
        if (0 <= d) {
          var f = a[c].substring(0, d);
          e = a[c].substring(d + 1);
        } else f = a[c];
        b2(f, e ? decodeURIComponent(e.replace(/\+/g, " ")) : "");
      }
    }
  }
  function T(a) {
    this.g = this.o = this.j = "";
    this.s = null;
    this.m = this.l = "";
    this.h = false;
    if (a instanceof T) {
      this.h = a.h;
      qc(this, a.j);
      this.o = a.o;
      this.g = a.g;
      rc(this, a.s);
      this.l = a.l;
      var b2 = a.i;
      var c = new sc();
      c.i = b2.i;
      b2.g && (c.g = new Map(b2.g), c.h = b2.h);
      tc(this, c);
      this.m = a.m;
    } else a && (b2 = String(a).match(oc)) ? (this.h = false, qc(this, b2[1] || "", true), this.o = uc(b2[2] || ""), this.g = uc(b2[3] || "", true), rc(this, b2[4]), this.l = uc(b2[5] || "", true), tc(this, b2[6] || "", true), this.m = uc(b2[7] || "")) : (this.h = false, this.i = new sc(null, this.h));
  }
  T.prototype.toString = function() {
    var a = [], b2 = this.j;
    b2 && a.push(vc(b2, wc, true), ":");
    var c = this.g;
    if (c || "file" == b2) a.push("//"), (b2 = this.o) && a.push(vc(b2, wc, true), "@"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, "%$1")), c = this.s, null != c && a.push(":", String(c));
    if (c = this.l) this.g && "/" != c.charAt(0) && a.push("/"), a.push(vc(c, "/" == c.charAt(0) ? xc : yc, true));
    (c = this.i.toString()) && a.push("?", c);
    (c = this.m) && a.push("#", vc(c, zc));
    return a.join("");
  };
  function N(a) {
    return new T(a);
  }
  function qc(a, b2, c) {
    a.j = c ? uc(b2, true) : b2;
    a.j && (a.j = a.j.replace(/:$/, ""));
  }
  function rc(a, b2) {
    if (b2) {
      b2 = Number(b2);
      if (isNaN(b2) || 0 > b2) throw Error("Bad port number " + b2);
      a.s = b2;
    } else a.s = null;
  }
  function tc(a, b2, c) {
    b2 instanceof sc ? (a.i = b2, Ac(a.i, a.h)) : (c || (b2 = vc(b2, Bc)), a.i = new sc(b2, a.h));
  }
  function S2(a, b2, c) {
    a.i.set(b2, c);
  }
  function Ib(a) {
    S2(a, "zx", Math.floor(2147483648 * Math.random()).toString(36) + Math.abs(Math.floor(2147483648 * Math.random()) ^ Date.now()).toString(36));
    return a;
  }
  function uc(a, b2) {
    return a ? b2 ? decodeURI(a.replace(/%25/g, "%2525")) : decodeURIComponent(a) : "";
  }
  function vc(a, b2, c) {
    return "string" === typeof a ? (a = encodeURI(a).replace(b2, Cc), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
  }
  function Cc(a) {
    a = a.charCodeAt(0);
    return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
  }
  var wc = /[#\/\?@]/g, yc = /[#\?:]/g, xc = /[#\?]/g, Bc = /[#\?@]/g, zc = /#/g;
  function sc(a, b2) {
    this.h = this.g = null;
    this.i = a || null;
    this.j = !!b2;
  }
  function U(a) {
    a.g || (a.g = /* @__PURE__ */ new Map(), a.h = 0, a.i && pc(a.i, function(b2, c) {
      a.add(decodeURIComponent(b2.replace(/\+/g, " ")), c);
    }));
  }
  h = sc.prototype;
  h.add = function(a, b2) {
    U(this);
    this.i = null;
    a = V(this, a);
    var c = this.g.get(a);
    c || this.g.set(a, c = []);
    c.push(b2);
    this.h += 1;
    return this;
  };
  function Dc(a, b2) {
    U(a);
    b2 = V(a, b2);
    a.g.has(b2) && (a.i = null, a.h -= a.g.get(b2).length, a.g.delete(b2));
  }
  function Ec(a, b2) {
    U(a);
    b2 = V(a, b2);
    return a.g.has(b2);
  }
  h.forEach = function(a, b2) {
    U(this);
    this.g.forEach(function(c, d) {
      c.forEach(function(e) {
        a.call(b2, e, d, this);
      }, this);
    }, this);
  };
  h.na = function() {
    U(this);
    const a = Array.from(this.g.values()), b2 = Array.from(this.g.keys()), c = [];
    for (let d = 0; d < b2.length; d++) {
      const e = a[d];
      for (let f = 0; f < e.length; f++) c.push(b2[d]);
    }
    return c;
  };
  h.V = function(a) {
    U(this);
    let b2 = [];
    if ("string" === typeof a) Ec(this, a) && (b2 = b2.concat(this.g.get(V(this, a))));
    else {
      a = Array.from(this.g.values());
      for (let c = 0; c < a.length; c++) b2 = b2.concat(a[c]);
    }
    return b2;
  };
  h.set = function(a, b2) {
    U(this);
    this.i = null;
    a = V(this, a);
    Ec(this, a) && (this.h -= this.g.get(a).length);
    this.g.set(a, [b2]);
    this.h += 1;
    return this;
  };
  h.get = function(a, b2) {
    if (!a) return b2;
    a = this.V(a);
    return 0 < a.length ? String(a[0]) : b2;
  };
  function Lb(a, b2, c) {
    Dc(a, b2);
    0 < c.length && (a.i = null, a.g.set(V(a, b2), la(c)), a.h += c.length);
  }
  h.toString = function() {
    if (this.i) return this.i;
    if (!this.g) return "";
    const a = [], b2 = Array.from(this.g.keys());
    for (var c = 0; c < b2.length; c++) {
      var d = b2[c];
      const f = encodeURIComponent(String(d)), g = this.V(d);
      for (d = 0; d < g.length; d++) {
        var e = f;
        "" !== g[d] && (e += "=" + encodeURIComponent(String(g[d])));
        a.push(e);
      }
    }
    return this.i = a.join("&");
  };
  function V(a, b2) {
    b2 = String(b2);
    a.j && (b2 = b2.toLowerCase());
    return b2;
  }
  function Ac(a, b2) {
    b2 && !a.j && (U(a), a.i = null, a.g.forEach(function(c, d) {
      var e = d.toLowerCase();
      d != e && (Dc(this, d), Lb(this, e, c));
    }, a));
    a.j = b2;
  }
  function Fc(a, b2) {
    const c = new vb();
    if (k.Image) {
      const d = new Image();
      d.onload = ka(W, c, "TestLoadImage: loaded", true, b2, d);
      d.onerror = ka(W, c, "TestLoadImage: error", false, b2, d);
      d.onabort = ka(W, c, "TestLoadImage: abort", false, b2, d);
      d.ontimeout = ka(W, c, "TestLoadImage: timeout", false, b2, d);
      k.setTimeout(function() {
        if (d.ontimeout) d.ontimeout();
      }, 1e4);
      d.src = a;
    } else b2(false);
  }
  function Gc(a, b2) {
    const c = new vb(), d = new AbortController(), e = setTimeout(() => {
      d.abort();
      W(c, "TestPingServer: timeout", false, b2);
    }, 1e4);
    fetch(a, { signal: d.signal }).then((f) => {
      clearTimeout(e);
      f.ok ? W(c, "TestPingServer: ok", true, b2) : W(c, "TestPingServer: server error", false, b2);
    }).catch(() => {
      clearTimeout(e);
      W(c, "TestPingServer: error", false, b2);
    });
  }
  function W(a, b2, c, d, e) {
    try {
      e && (e.onload = null, e.onerror = null, e.onabort = null, e.ontimeout = null), d(c);
    } catch (f) {
    }
  }
  function Hc() {
    this.g = new jb();
  }
  function Ic(a, b2, c) {
    const d = c || "";
    try {
      nc(a, function(e, f) {
        let g = e;
        n(e) && (g = hb(e));
        b2.push(d + f + "=" + encodeURIComponent(g));
      });
    } catch (e) {
      throw b2.push(d + "type=" + encodeURIComponent("_badmap")), e;
    }
  }
  function Jc(a) {
    this.l = a.Ub || null;
    this.j = a.eb || false;
  }
  r(Jc, kb);
  Jc.prototype.g = function() {
    return new Kc(this.l, this.j);
  };
  Jc.prototype.i = /* @__PURE__ */ function(a) {
    return function() {
      return a;
    };
  }({});
  function Kc(a, b2) {
    E.call(this);
    this.D = a;
    this.o = b2;
    this.m = void 0;
    this.status = this.readyState = 0;
    this.responseType = this.responseText = this.response = this.statusText = "";
    this.onreadystatechange = null;
    this.u = new Headers();
    this.h = null;
    this.B = "GET";
    this.A = "";
    this.g = false;
    this.v = this.j = this.l = null;
  }
  r(Kc, E);
  h = Kc.prototype;
  h.open = function(a, b2) {
    if (0 != this.readyState) throw this.abort(), Error("Error reopening a connection");
    this.B = a;
    this.A = b2;
    this.readyState = 1;
    Lc(this);
  };
  h.send = function(a) {
    if (1 != this.readyState) throw this.abort(), Error("need to call open() first. ");
    this.g = true;
    const b2 = { headers: this.u, method: this.B, credentials: this.m, cache: void 0 };
    a && (b2.body = a);
    (this.D || k).fetch(new Request(this.A, b2)).then(this.Sa.bind(this), this.ga.bind(this));
  };
  h.abort = function() {
    this.response = this.responseText = "";
    this.u = new Headers();
    this.status = 0;
    this.j && this.j.cancel("Request was aborted.").catch(() => {
    });
    1 <= this.readyState && this.g && 4 != this.readyState && (this.g = false, Mc(this));
    this.readyState = 0;
  };
  h.Sa = function(a) {
    if (this.g && (this.l = a, this.h || (this.status = this.l.status, this.statusText = this.l.statusText, this.h = a.headers, this.readyState = 2, Lc(this)), this.g && (this.readyState = 3, Lc(this), this.g))) if ("arraybuffer" === this.responseType) a.arrayBuffer().then(this.Qa.bind(this), this.ga.bind(this));
    else if ("undefined" !== typeof k.ReadableStream && "body" in a) {
      this.j = a.body.getReader();
      if (this.o) {
        if (this.responseType) throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');
        this.response = [];
      } else this.response = this.responseText = "", this.v = new TextDecoder();
      Nc(this);
    } else a.text().then(this.Ra.bind(this), this.ga.bind(this));
  };
  function Nc(a) {
    a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a));
  }
  h.Pa = function(a) {
    if (this.g) {
      if (this.o && a.value) this.response.push(a.value);
      else if (!this.o) {
        var b2 = a.value ? a.value : new Uint8Array(0);
        if (b2 = this.v.decode(b2, { stream: !a.done })) this.response = this.responseText += b2;
      }
      a.done ? Mc(this) : Lc(this);
      3 == this.readyState && Nc(this);
    }
  };
  h.Ra = function(a) {
    this.g && (this.response = this.responseText = a, Mc(this));
  };
  h.Qa = function(a) {
    this.g && (this.response = a, Mc(this));
  };
  h.ga = function() {
    this.g && Mc(this);
  };
  function Mc(a) {
    a.readyState = 4;
    a.l = null;
    a.j = null;
    a.v = null;
    Lc(a);
  }
  h.setRequestHeader = function(a, b2) {
    this.u.append(a, b2);
  };
  h.getResponseHeader = function(a) {
    return this.h ? this.h.get(a.toLowerCase()) || "" : "";
  };
  h.getAllResponseHeaders = function() {
    if (!this.h) return "";
    const a = [], b2 = this.h.entries();
    for (var c = b2.next(); !c.done; ) c = c.value, a.push(c[0] + ": " + c[1]), c = b2.next();
    return a.join("\r\n");
  };
  function Lc(a) {
    a.onreadystatechange && a.onreadystatechange.call(a);
  }
  Object.defineProperty(Kc.prototype, "withCredentials", { get: function() {
    return "include" === this.m;
  }, set: function(a) {
    this.m = a ? "include" : "same-origin";
  } });
  function Oc(a) {
    let b2 = "";
    qa(a, function(c, d) {
      b2 += d;
      b2 += ":";
      b2 += c;
      b2 += "\r\n";
    });
    return b2;
  }
  function Pc(a, b2, c) {
    a: {
      for (d in c) {
        var d = false;
        break a;
      }
      d = true;
    }
    d || (c = Oc(c), "string" === typeof a ? null != c && encodeURIComponent(String(c)) : S2(a, b2, c));
  }
  function X(a) {
    E.call(this);
    this.headers = /* @__PURE__ */ new Map();
    this.o = a || null;
    this.h = false;
    this.v = this.g = null;
    this.D = "";
    this.m = 0;
    this.l = "";
    this.j = this.B = this.u = this.A = false;
    this.I = null;
    this.H = "";
    this.J = false;
  }
  r(X, E);
  var Qc = /^https?$/i, Rc = ["POST", "PUT"];
  h = X.prototype;
  h.Ha = function(a) {
    this.J = a;
  };
  h.ea = function(a, b2, c, d) {
    if (this.g) throw Error("[goog.net.XhrIo] Object is active with another request=" + this.D + "; newUri=" + a);
    b2 = b2 ? b2.toUpperCase() : "GET";
    this.D = a;
    this.l = "";
    this.m = 0;
    this.A = false;
    this.h = true;
    this.g = this.o ? this.o.g() : Cb.g();
    this.v = this.o ? lb(this.o) : lb(Cb);
    this.g.onreadystatechange = p(this.Ea, this);
    try {
      this.B = true, this.g.open(b2, String(a), true), this.B = false;
    } catch (f) {
      Sc(this, f);
      return;
    }
    a = c || "";
    c = new Map(this.headers);
    if (d) if (Object.getPrototypeOf(d) === Object.prototype) for (var e in d) c.set(e, d[e]);
    else if ("function" === typeof d.keys && "function" === typeof d.get) for (const f of d.keys()) c.set(f, d.get(f));
    else throw Error("Unknown input type for opt_headers: " + String(d));
    d = Array.from(c.keys()).find((f) => "content-type" == f.toLowerCase());
    e = k.FormData && a instanceof k.FormData;
    !(0 <= Array.prototype.indexOf.call(Rc, b2, void 0)) || d || e || c.set("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
    for (const [f, g] of c) this.g.setRequestHeader(f, g);
    this.H && (this.g.responseType = this.H);
    "withCredentials" in this.g && this.g.withCredentials !== this.J && (this.g.withCredentials = this.J);
    try {
      Tc(this), this.u = true, this.g.send(a), this.u = false;
    } catch (f) {
      Sc(this, f);
    }
  };
  function Sc(a, b2) {
    a.h = false;
    a.g && (a.j = true, a.g.abort(), a.j = false);
    a.l = b2;
    a.m = 5;
    Uc(a);
    Vc(a);
  }
  function Uc(a) {
    a.A || (a.A = true, F(a, "complete"), F(a, "error"));
  }
  h.abort = function(a) {
    this.g && this.h && (this.h = false, this.j = true, this.g.abort(), this.j = false, this.m = a || 7, F(this, "complete"), F(this, "abort"), Vc(this));
  };
  h.N = function() {
    this.g && (this.h && (this.h = false, this.j = true, this.g.abort(), this.j = false), Vc(this, true));
    X.aa.N.call(this);
  };
  h.Ea = function() {
    this.s || (this.B || this.u || this.j ? Wc(this) : this.bb());
  };
  h.bb = function() {
    Wc(this);
  };
  function Wc(a) {
    if (a.h && "undefined" != typeof fa && (!a.v[1] || 4 != P(a) || 2 != a.Z())) {
      if (a.u && 4 == P(a)) bb(a.Ea, 0, a);
      else if (F(a, "readystatechange"), 4 == P(a)) {
        a.h = false;
        try {
          const g = a.Z();
          a: switch (g) {
            case 200:
            case 201:
            case 202:
            case 204:
            case 206:
            case 304:
            case 1223:
              var b2 = true;
              break a;
            default:
              b2 = false;
          }
          var c;
          if (!(c = b2)) {
            var d;
            if (d = 0 === g) {
              var e = String(a.D).match(oc)[1] || null;
              !e && k.self && k.self.location && (e = k.self.location.protocol.slice(0, -1));
              d = !Qc.test(e ? e.toLowerCase() : "");
            }
            c = d;
          }
          if (c) F(a, "complete"), F(a, "success");
          else {
            a.m = 6;
            try {
              var f = 2 < P(a) ? a.g.statusText : "";
            } catch (m) {
              f = "";
            }
            a.l = f + " [" + a.Z() + "]";
            Uc(a);
          }
        } finally {
          Vc(a);
        }
      }
    }
  }
  function Vc(a, b2) {
    if (a.g) {
      Tc(a);
      const c = a.g, d = a.v[0] ? () => {
      } : null;
      a.g = null;
      a.v = null;
      b2 || F(a, "ready");
      try {
        c.onreadystatechange = d;
      } catch (e) {
      }
    }
  }
  function Tc(a) {
    a.I && (k.clearTimeout(a.I), a.I = null);
  }
  h.isActive = function() {
    return !!this.g;
  };
  function P(a) {
    return a.g ? a.g.readyState : 0;
  }
  h.Z = function() {
    try {
      return 2 < P(this) ? this.g.status : -1;
    } catch (a) {
      return -1;
    }
  };
  h.oa = function() {
    try {
      return this.g ? this.g.responseText : "";
    } catch (a) {
      return "";
    }
  };
  h.Oa = function(a) {
    if (this.g) {
      var b2 = this.g.responseText;
      a && 0 == b2.indexOf(a) && (b2 = b2.substring(a.length));
      return ib(b2);
    }
  };
  function Nb(a) {
    try {
      if (!a.g) return null;
      if ("response" in a.g) return a.g.response;
      switch (a.H) {
        case "":
        case "text":
          return a.g.responseText;
        case "arraybuffer":
          if ("mozResponseArrayBuffer" in a.g) return a.g.mozResponseArrayBuffer;
      }
      return null;
    } catch (b2) {
      return null;
    }
  }
  function Vb(a) {
    const b2 = {};
    a = (a.g && 2 <= P(a) ? a.g.getAllResponseHeaders() || "" : "").split("\r\n");
    for (let d = 0; d < a.length; d++) {
      if (t(a[d])) continue;
      var c = va(a[d]);
      const e = c[0];
      c = c[1];
      if ("string" !== typeof c) continue;
      c = c.trim();
      const f = b2[e] || [];
      b2[e] = f;
      f.push(c);
    }
    ra(b2, function(d) {
      return d.join(", ");
    });
  }
  h.Ba = function() {
    return this.m;
  };
  h.Ka = function() {
    return "string" === typeof this.l ? this.l : String(this.l);
  };
  function Xc(a, b2, c) {
    return c && c.internalChannelParams ? c.internalChannelParams[a] || b2 : b2;
  }
  function Yc(a) {
    this.Aa = 0;
    this.i = [];
    this.j = new vb();
    this.ia = this.qa = this.I = this.W = this.g = this.ya = this.D = this.H = this.m = this.S = this.o = null;
    this.Ya = this.U = 0;
    this.Va = Xc("failFast", false, a);
    this.F = this.C = this.u = this.s = this.l = null;
    this.X = true;
    this.za = this.T = -1;
    this.Y = this.v = this.B = 0;
    this.Ta = Xc("baseRetryDelayMs", 5e3, a);
    this.cb = Xc("retryDelaySeedMs", 1e4, a);
    this.Wa = Xc("forwardChannelMaxRetries", 2, a);
    this.wa = Xc("forwardChannelRequestTimeoutMs", 2e4, a);
    this.pa = a && a.xmlHttpFactory || void 0;
    this.Xa = a && a.Tb || void 0;
    this.Ca = a && a.useFetchStreams || false;
    this.L = void 0;
    this.J = a && a.supportsCrossDomainXhr || false;
    this.K = "";
    this.h = new ic(a && a.concurrentRequestLimit);
    this.Da = new Hc();
    this.P = a && a.fastHandshake || false;
    this.O = a && a.encodeInitMessageHeaders || false;
    this.P && this.O && (this.O = false);
    this.Ua = a && a.Rb || false;
    a && a.xa && this.j.xa();
    a && a.forceLongPolling && (this.X = false);
    this.ba = !this.P && this.X && a && a.detectBufferingProxy || false;
    this.ja = void 0;
    a && a.longPollingTimeout && 0 < a.longPollingTimeout && (this.ja = a.longPollingTimeout);
    this.ca = void 0;
    this.R = 0;
    this.M = false;
    this.ka = this.A = null;
  }
  h = Yc.prototype;
  h.la = 8;
  h.G = 1;
  h.connect = function(a, b2, c, d) {
    K(0);
    this.W = a;
    this.H = b2 || {};
    c && void 0 !== d && (this.H.OSID = c, this.H.OAID = d);
    this.F = this.X;
    this.I = cc(this, null, this.W);
    fc(this);
  };
  function gc(a) {
    Zc(a);
    if (3 == a.G) {
      var b2 = a.U++, c = N(a.I);
      S2(c, "SID", a.K);
      S2(c, "RID", b2);
      S2(c, "TYPE", "terminate");
      $c(a, c);
      b2 = new M(a, a.j, b2);
      b2.L = 2;
      b2.v = Ib(N(c));
      c = false;
      if (k.navigator && k.navigator.sendBeacon) try {
        c = k.navigator.sendBeacon(b2.v.toString(), "");
      } catch (d) {
      }
      !c && k.Image && (new Image().src = b2.v, c = true);
      c || (b2.g = Mb(b2.j, null), b2.g.ea(b2.v));
      b2.F = Date.now();
      Kb(b2);
    }
    ad(a);
  }
  function Zb(a) {
    a.g && (Tb(a), a.g.cancel(), a.g = null);
  }
  function Zc(a) {
    Zb(a);
    a.u && (k.clearTimeout(a.u), a.u = null);
    Yb(a);
    a.h.cancel();
    a.s && ("number" === typeof a.s && k.clearTimeout(a.s), a.s = null);
  }
  function fc(a) {
    if (!jc(a.h) && !a.s) {
      a.s = true;
      var b2 = a.Ga;
      x || Ea();
      y || (x(), y = true);
      za.add(b2, a);
      a.B = 0;
    }
  }
  function bd(a, b2) {
    if (ac(a.h) >= a.h.j - (a.s ? 1 : 0)) return false;
    if (a.s) return a.i = b2.D.concat(a.i), true;
    if (1 == a.G || 2 == a.G || a.B >= (a.Va ? 0 : a.Wa)) return false;
    a.s = ub(p(a.Ga, a, b2), cd(a, a.B));
    a.B++;
    return true;
  }
  h.Ga = function(a) {
    if (this.s) if (this.s = null, 1 == this.G) {
      if (!a) {
        this.U = Math.floor(1e5 * Math.random());
        a = this.U++;
        const e = new M(this, this.j, a);
        let f = this.o;
        this.S && (f ? (f = sa(f), ua(f, this.S)) : f = this.S);
        null !== this.m || this.O || (e.H = f, f = null);
        if (this.P) a: {
          var b2 = 0;
          for (var c = 0; c < this.i.length; c++) {
            b: {
              var d = this.i[c];
              if ("__data__" in d.map && (d = d.map.__data__, "string" === typeof d)) {
                d = d.length;
                break b;
              }
              d = void 0;
            }
            if (void 0 === d) break;
            b2 += d;
            if (4096 < b2) {
              b2 = c;
              break a;
            }
            if (4096 === b2 || c === this.i.length - 1) {
              b2 = c + 1;
              break a;
            }
          }
          b2 = 1e3;
        }
        else b2 = 1e3;
        b2 = dd(this, e, b2);
        c = N(this.I);
        S2(c, "RID", a);
        S2(c, "CVER", 22);
        this.D && S2(c, "X-HTTP-Session-Id", this.D);
        $c(this, c);
        f && (this.O ? b2 = "headers=" + encodeURIComponent(String(Oc(f))) + "&" + b2 : this.m && Pc(c, this.m, f));
        bc(this.h, e);
        this.Ua && S2(c, "TYPE", "init");
        this.P ? (S2(c, "$req", b2), S2(c, "SID", "null"), e.T = true, Hb(e, c, null)) : Hb(e, c, b2);
        this.G = 2;
      }
    } else 3 == this.G && (a ? ed(this, a) : 0 == this.i.length || jc(this.h) || ed(this));
  };
  function ed(a, b2) {
    var c;
    b2 ? c = b2.l : c = a.U++;
    const d = N(a.I);
    S2(d, "SID", a.K);
    S2(d, "RID", c);
    S2(d, "AID", a.T);
    $c(a, d);
    a.m && a.o && Pc(d, a.m, a.o);
    c = new M(a, a.j, c, a.B + 1);
    null === a.m && (c.H = a.o);
    b2 && (a.i = b2.D.concat(a.i));
    b2 = dd(a, c, 1e3);
    c.I = Math.round(0.5 * a.wa) + Math.round(0.5 * a.wa * Math.random());
    bc(a.h, c);
    Hb(c, d, b2);
  }
  function $c(a, b2) {
    a.H && qa(a.H, function(c, d) {
      S2(b2, d, c);
    });
    a.l && nc({}, function(c, d) {
      S2(b2, d, c);
    });
  }
  function dd(a, b2, c) {
    c = Math.min(a.i.length, c);
    var d = a.l ? p(a.l.Na, a.l, a) : null;
    a: {
      var e = a.i;
      let f = -1;
      for (; ; ) {
        const g = ["count=" + c];
        -1 == f ? 0 < c ? (f = e[0].g, g.push("ofs=" + f)) : f = 0 : g.push("ofs=" + f);
        let m = true;
        for (let q = 0; q < c; q++) {
          let l = e[q].g;
          const v2 = e[q].map;
          l -= f;
          if (0 > l) f = Math.max(0, e[q].g - 100), m = false;
          else try {
            Ic(v2, g, "req" + l + "_");
          } catch (w2) {
            d && d(v2);
          }
        }
        if (m) {
          d = g.join("&");
          break a;
        }
      }
    }
    a = a.i.splice(0, c);
    b2.D = a;
    return d;
  }
  function ec(a) {
    if (!a.g && !a.u) {
      a.Y = 1;
      var b2 = a.Fa;
      x || Ea();
      y || (x(), y = true);
      za.add(b2, a);
      a.v = 0;
    }
  }
  function $b(a) {
    if (a.g || a.u || 3 <= a.v) return false;
    a.Y++;
    a.u = ub(p(a.Fa, a), cd(a, a.v));
    a.v++;
    return true;
  }
  h.Fa = function() {
    this.u = null;
    fd(this);
    if (this.ba && !(this.M || null == this.g || 0 >= this.R)) {
      var a = 2 * this.R;
      this.j.info("BP detection timer enabled: " + a);
      this.A = ub(p(this.ab, this), a);
    }
  };
  h.ab = function() {
    this.A && (this.A = null, this.j.info("BP detection timeout reached."), this.j.info("Buffering proxy detected and switch to long-polling!"), this.F = false, this.M = true, K(10), Zb(this), fd(this));
  };
  function Tb(a) {
    null != a.A && (k.clearTimeout(a.A), a.A = null);
  }
  function fd(a) {
    a.g = new M(a, a.j, "rpc", a.Y);
    null === a.m && (a.g.H = a.o);
    a.g.O = 0;
    var b2 = N(a.qa);
    S2(b2, "RID", "rpc");
    S2(b2, "SID", a.K);
    S2(b2, "AID", a.T);
    S2(b2, "CI", a.F ? "0" : "1");
    !a.F && a.ja && S2(b2, "TO", a.ja);
    S2(b2, "TYPE", "xmlhttp");
    $c(a, b2);
    a.m && a.o && Pc(b2, a.m, a.o);
    a.L && (a.g.I = a.L);
    var c = a.g;
    a = a.ia;
    c.L = 1;
    c.v = Ib(N(b2));
    c.m = null;
    c.P = true;
    Jb(c, a);
  }
  h.Za = function() {
    null != this.C && (this.C = null, Zb(this), $b(this), K(19));
  };
  function Yb(a) {
    null != a.C && (k.clearTimeout(a.C), a.C = null);
  }
  function Ub(a, b2) {
    var c = null;
    if (a.g == b2) {
      Yb(a);
      Tb(a);
      a.g = null;
      var d = 2;
    } else if (Xb(a.h, b2)) c = b2.D, dc(a.h, b2), d = 1;
    else return;
    if (0 != a.G) {
      if (b2.o) if (1 == d) {
        c = b2.m ? b2.m.length : 0;
        b2 = Date.now() - b2.F;
        var e = a.B;
        d = qb();
        F(d, new tb(d, c));
        fc(a);
      } else ec(a);
      else if (e = b2.s, 3 == e || 0 == e && 0 < b2.X || !(1 == d && bd(a, b2) || 2 == d && $b(a))) switch (c && 0 < c.length && (b2 = a.h, b2.i = b2.i.concat(c)), e) {
        case 1:
          R(a, 5);
          break;
        case 4:
          R(a, 10);
          break;
        case 3:
          R(a, 6);
          break;
        default:
          R(a, 2);
      }
    }
  }
  function cd(a, b2) {
    let c = a.Ta + Math.floor(Math.random() * a.cb);
    a.isActive() || (c *= 2);
    return c * b2;
  }
  function R(a, b2) {
    a.j.info("Error code " + b2);
    if (2 == b2) {
      var c = p(a.fb, a), d = a.Xa;
      const e = !d;
      d = new T(d || "//www.google.com/images/cleardot.gif");
      k.location && "http" == k.location.protocol || qc(d, "https");
      Ib(d);
      e ? Fc(d.toString(), c) : Gc(d.toString(), c);
    } else K(2);
    a.G = 0;
    a.l && a.l.sa(b2);
    ad(a);
    Zc(a);
  }
  h.fb = function(a) {
    a ? (this.j.info("Successfully pinged google.com"), K(2)) : (this.j.info("Failed to ping google.com"), K(1));
  };
  function ad(a) {
    a.G = 0;
    a.ka = [];
    if (a.l) {
      const b2 = kc(a.h);
      if (0 != b2.length || 0 != a.i.length) ma(a.ka, b2), ma(a.ka, a.i), a.h.i.length = 0, la(a.i), a.i.length = 0;
      a.l.ra();
    }
  }
  function cc(a, b2, c) {
    var d = c instanceof T ? N(c) : new T(c);
    if ("" != d.g) b2 && (d.g = b2 + "." + d.g), rc(d, d.s);
    else {
      var e = k.location;
      d = e.protocol;
      b2 = b2 ? b2 + "." + e.hostname : e.hostname;
      e = +e.port;
      var f = new T(null);
      d && qc(f, d);
      b2 && (f.g = b2);
      e && rc(f, e);
      c && (f.l = c);
      d = f;
    }
    c = a.D;
    b2 = a.ya;
    c && b2 && S2(d, c, b2);
    S2(d, "VER", a.la);
    $c(a, d);
    return d;
  }
  function Mb(a, b2, c) {
    if (b2 && !a.J) throw Error("Can't create secondary domain capable XhrIo object.");
    b2 = a.Ca && !a.pa ? new X(new Jc({ eb: c })) : new X(a.pa);
    b2.Ha(a.J);
    return b2;
  }
  h.isActive = function() {
    return !!this.l && this.l.isActive(this);
  };
  function gd() {
  }
  h = gd.prototype;
  h.ua = function() {
  };
  h.ta = function() {
  };
  h.sa = function() {
  };
  h.ra = function() {
  };
  h.isActive = function() {
    return true;
  };
  h.Na = function() {
  };
  function hd() {
  }
  hd.prototype.g = function(a, b2) {
    return new Y(a, b2);
  };
  function Y(a, b2) {
    E.call(this);
    this.g = new Yc(b2);
    this.l = a;
    this.h = b2 && b2.messageUrlParams || null;
    a = b2 && b2.messageHeaders || null;
    b2 && b2.clientProtocolHeaderRequired && (a ? a["X-Client-Protocol"] = "webchannel" : a = { "X-Client-Protocol": "webchannel" });
    this.g.o = a;
    a = b2 && b2.initMessageHeaders || null;
    b2 && b2.messageContentType && (a ? a["X-WebChannel-Content-Type"] = b2.messageContentType : a = { "X-WebChannel-Content-Type": b2.messageContentType });
    b2 && b2.va && (a ? a["X-WebChannel-Client-Profile"] = b2.va : a = { "X-WebChannel-Client-Profile": b2.va });
    this.g.S = a;
    (a = b2 && b2.Sb) && !t(a) && (this.g.m = a);
    this.v = b2 && b2.supportsCrossDomainXhr || false;
    this.u = b2 && b2.sendRawJson || false;
    (b2 = b2 && b2.httpSessionIdParam) && !t(b2) && (this.g.D = b2, a = this.h, null !== a && b2 in a && (a = this.h, b2 in a && delete a[b2]));
    this.j = new Z(this);
  }
  r(Y, E);
  Y.prototype.m = function() {
    this.g.l = this.j;
    this.v && (this.g.J = true);
    this.g.connect(this.l, this.h || void 0);
  };
  Y.prototype.close = function() {
    gc(this.g);
  };
  Y.prototype.o = function(a) {
    var b2 = this.g;
    if ("string" === typeof a) {
      var c = {};
      c.__data__ = a;
      a = c;
    } else this.u && (c = {}, c.__data__ = hb(a), a = c);
    b2.i.push(new hc(b2.Ya++, a));
    3 == b2.G && fc(b2);
  };
  Y.prototype.N = function() {
    this.g.l = null;
    delete this.j;
    gc(this.g);
    delete this.g;
    Y.aa.N.call(this);
  };
  function id(a) {
    nb.call(this);
    a.__headers__ && (this.headers = a.__headers__, this.statusCode = a.__status__, delete a.__headers__, delete a.__status__);
    var b2 = a.__sm__;
    if (b2) {
      a: {
        for (const c in b2) {
          a = c;
          break a;
        }
        a = void 0;
      }
      if (this.i = a) a = this.i, b2 = null !== b2 && a in b2 ? b2[a] : void 0;
      this.data = b2;
    } else this.data = a;
  }
  r(id, nb);
  function jd() {
    ob.call(this);
    this.status = 1;
  }
  r(jd, ob);
  function Z(a) {
    this.g = a;
  }
  r(Z, gd);
  Z.prototype.ua = function() {
    F(this.g, "a");
  };
  Z.prototype.ta = function(a) {
    F(this.g, new id(a));
  };
  Z.prototype.sa = function(a) {
    F(this.g, new jd());
  };
  Z.prototype.ra = function() {
    F(this.g, "b");
  };
  hd.prototype.createWebChannel = hd.prototype.g;
  Y.prototype.send = Y.prototype.o;
  Y.prototype.open = Y.prototype.m;
  Y.prototype.close = Y.prototype.close;
  createWebChannelTransport = function() {
    return new hd();
  };
  getStatEventTarget = function() {
    return qb();
  };
  Event$1 = I;
  Stat = { mb: 0, pb: 1, qb: 2, Jb: 3, Ob: 4, Lb: 5, Mb: 6, Kb: 7, Ib: 8, Nb: 9, PROXY: 10, NOPROXY: 11, Gb: 12, Cb: 13, Db: 14, Bb: 15, Eb: 16, Fb: 17, ib: 18, hb: 19, jb: 20 };
  Ab.NO_ERROR = 0;
  Ab.TIMEOUT = 8;
  Ab.HTTP_ERROR = 6;
  ErrorCode = Ab;
  Bb.COMPLETE = "complete";
  EventType = Bb;
  mb.EventType = H;
  H.OPEN = "a";
  H.CLOSE = "b";
  H.ERROR = "c";
  H.MESSAGE = "d";
  E.prototype.listen = E.prototype.K;
  WebChannel = mb;
  X.prototype.listenOnce = X.prototype.L;
  X.prototype.getLastError = X.prototype.Ka;
  X.prototype.getLastErrorCode = X.prototype.Ba;
  X.prototype.getStatus = X.prototype.Z;
  X.prototype.getResponseJson = X.prototype.Oa;
  X.prototype.getResponseText = X.prototype.oa;
  X.prototype.send = X.prototype.ea;
  X.prototype.setWithCredentials = X.prototype.Ha;
  XhrIo = X;
}).apply(typeof commonjsGlobal !== "undefined" ? commonjsGlobal : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {});
const w = "@firebase/firestore";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class User {
  constructor(e) {
    this.uid = e;
  }
  isAuthenticated() {
    return null != this.uid;
  }
  /**
   * Returns a key representing this user, suitable for inclusion in a
   * dictionary.
   */
  toKey() {
    return this.isAuthenticated() ? "uid:" + this.uid : "anonymous-user";
  }
  isEqual(e) {
    return e.uid === this.uid;
  }
}
User.UNAUTHENTICATED = new User(null), // TODO(mikelehen): Look into getting a proper uid-equivalent for
// non-FirebaseAuth providers.
User.GOOGLE_CREDENTIALS = new User("google-credentials-uid"), User.FIRST_PARTY = new User("first-party-uid"), User.MOCK_USER = new User("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let S = "10.14.0";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const b = new Logger("@firebase/firestore");
function __PRIVATE_getLogLevel() {
  return b.logLevel;
}
function __PRIVATE_logDebug(e, ...t) {
  if (b.logLevel <= LogLevel.DEBUG) {
    const n = t.map(__PRIVATE_argToString);
    b.debug(`Firestore (${S}): ${e}`, ...n);
  }
}
function __PRIVATE_logError(e, ...t) {
  if (b.logLevel <= LogLevel.ERROR) {
    const n = t.map(__PRIVATE_argToString);
    b.error(`Firestore (${S}): ${e}`, ...n);
  }
}
function __PRIVATE_logWarn(e, ...t) {
  if (b.logLevel <= LogLevel.WARN) {
    const n = t.map(__PRIVATE_argToString);
    b.warn(`Firestore (${S}): ${e}`, ...n);
  }
}
function __PRIVATE_argToString(e) {
  if ("string" == typeof e) return e;
  try {
    /**
    * @license
    * Copyright 2020 Google LLC
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    *   http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    */
    return function __PRIVATE_formatJSON(e2) {
      return JSON.stringify(e2);
    }(e);
  } catch (t) {
    return e;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function fail(e = "Unexpected state") {
  const t = `FIRESTORE (${S}) INTERNAL ASSERTION FAILED: ` + e;
  throw __PRIVATE_logError(t), new Error(t);
}
function __PRIVATE_hardAssert(e, t) {
  e || fail();
}
function __PRIVATE_debugCast(e, t) {
  return e;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const D = {
  // Causes are copied from:
  // https://github.com/grpc/grpc/blob/bceec94ea4fc5f0085d81235d8e1c06798dc341a/include/grpc%2B%2B/impl/codegen/status_code_enum.h
  /** Not an error; returned on success. */
  OK: "ok",
  /** The operation was cancelled (typically by the caller). */
  CANCELLED: "cancelled",
  /** Unknown error or an error from a different error domain. */
  UNKNOWN: "unknown",
  /**
   * Client specified an invalid argument. Note that this differs from
   * FAILED_PRECONDITION. INVALID_ARGUMENT indicates arguments that are
   * problematic regardless of the state of the system (e.g., a malformed file
   * name).
   */
  INVALID_ARGUMENT: "invalid-argument",
  /**
   * Deadline expired before operation could complete. For operations that
   * change the state of the system, this error may be returned even if the
   * operation has completed successfully. For example, a successful response
   * from a server could have been delayed long enough for the deadline to
   * expire.
   */
  DEADLINE_EXCEEDED: "deadline-exceeded",
  /** Some requested entity (e.g., file or directory) was not found. */
  NOT_FOUND: "not-found",
  /**
   * Some entity that we attempted to create (e.g., file or directory) already
   * exists.
   */
  ALREADY_EXISTS: "already-exists",
  /**
   * The caller does not have permission to execute the specified operation.
   * PERMISSION_DENIED must not be used for rejections caused by exhausting
   * some resource (use RESOURCE_EXHAUSTED instead for those errors).
   * PERMISSION_DENIED must not be used if the caller cannot be identified
   * (use UNAUTHENTICATED instead for those errors).
   */
  PERMISSION_DENIED: "permission-denied",
  /**
   * The request does not have valid authentication credentials for the
   * operation.
   */
  UNAUTHENTICATED: "unauthenticated",
  /**
   * Some resource has been exhausted, perhaps a per-user quota, or perhaps the
   * entire file system is out of space.
   */
  RESOURCE_EXHAUSTED: "resource-exhausted",
  /**
   * Operation was rejected because the system is not in a state required for
   * the operation's execution. For example, directory to be deleted may be
   * non-empty, an rmdir operation is applied to a non-directory, etc.
   *
   * A litmus test that may help a service implementor in deciding
   * between FAILED_PRECONDITION, ABORTED, and UNAVAILABLE:
   *  (a) Use UNAVAILABLE if the client can retry just the failing call.
   *  (b) Use ABORTED if the client should retry at a higher-level
   *      (e.g., restarting a read-modify-write sequence).
   *  (c) Use FAILED_PRECONDITION if the client should not retry until
   *      the system state has been explicitly fixed. E.g., if an "rmdir"
   *      fails because the directory is non-empty, FAILED_PRECONDITION
   *      should be returned since the client should not retry unless
   *      they have first fixed up the directory by deleting files from it.
   *  (d) Use FAILED_PRECONDITION if the client performs conditional
   *      REST Get/Update/Delete on a resource and the resource on the
   *      server does not match the condition. E.g., conflicting
   *      read-modify-write on the same resource.
   */
  FAILED_PRECONDITION: "failed-precondition",
  /**
   * The operation was aborted, typically due to a concurrency issue like
   * sequencer check failures, transaction aborts, etc.
   *
   * See litmus test above for deciding between FAILED_PRECONDITION, ABORTED,
   * and UNAVAILABLE.
   */
  ABORTED: "aborted",
  /**
   * Operation was attempted past the valid range. E.g., seeking or reading
   * past end of file.
   *
   * Unlike INVALID_ARGUMENT, this error indicates a problem that may be fixed
   * if the system state changes. For example, a 32-bit file system will
   * generate INVALID_ARGUMENT if asked to read at an offset that is not in the
   * range [0,2^32-1], but it will generate OUT_OF_RANGE if asked to read from
   * an offset past the current file size.
   *
   * There is a fair bit of overlap between FAILED_PRECONDITION and
   * OUT_OF_RANGE. We recommend using OUT_OF_RANGE (the more specific error)
   * when it applies so that callers who are iterating through a space can
   * easily look for an OUT_OF_RANGE error to detect when they are done.
   */
  OUT_OF_RANGE: "out-of-range",
  /** Operation is not implemented or not supported/enabled in this service. */
  UNIMPLEMENTED: "unimplemented",
  /**
   * Internal errors. Means some invariants expected by underlying System has
   * been broken. If you see one of these errors, Something is very broken.
   */
  INTERNAL: "internal",
  /**
   * The service is currently unavailable. This is a most likely a transient
   * condition and may be corrected by retrying with a backoff.
   *
   * See litmus test above for deciding between FAILED_PRECONDITION, ABORTED,
   * and UNAVAILABLE.
   */
  UNAVAILABLE: "unavailable",
  /** Unrecoverable data loss or corruption. */
  DATA_LOSS: "data-loss"
};
class FirestoreError extends FirebaseError {
  /** @hideconstructor */
  constructor(e, t) {
    super(e, t), this.code = e, this.message = t, // HACK: We write a toString property directly because Error is not a real
    // class and so inheritance does not work correctly. We could alternatively
    // do the same "back-door inheritance" trick that FirebaseError does.
    this.toString = () => `${this.name}: [code=${this.code}]: ${this.message}`;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_Deferred {
  constructor() {
    this.promise = new Promise((e, t) => {
      this.resolve = e, this.reject = t;
    });
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_OAuthToken {
  constructor(e, t) {
    this.user = t, this.type = "OAuth", this.headers = /* @__PURE__ */ new Map(), this.headers.set("Authorization", `Bearer ${e}`);
  }
}
class __PRIVATE_EmptyAuthCredentialsProvider {
  getToken() {
    return Promise.resolve(null);
  }
  invalidateToken() {
  }
  start(e, t) {
    e.enqueueRetryable(() => t(User.UNAUTHENTICATED));
  }
  shutdown() {
  }
}
class __PRIVATE_EmulatorAuthCredentialsProvider {
  constructor(e) {
    this.token = e, /**
     * Stores the listener registered with setChangeListener()
     * This isn't actually necessary since the UID never changes, but we use this
     * to verify the listen contract is adhered to in tests.
     */
    this.changeListener = null;
  }
  getToken() {
    return Promise.resolve(this.token);
  }
  invalidateToken() {
  }
  start(e, t) {
    this.changeListener = t, // Fire with initial user.
    e.enqueueRetryable(() => t(this.token.user));
  }
  shutdown() {
    this.changeListener = null;
  }
}
class __PRIVATE_FirebaseAuthCredentialsProvider {
  constructor(e) {
    this.t = e, /** Tracks the current User. */
    this.currentUser = User.UNAUTHENTICATED, /**
     * Counter used to detect if the token changed while a getToken request was
     * outstanding.
     */
    this.i = 0, this.forceRefresh = false, this.auth = null;
  }
  start(e, t) {
    __PRIVATE_hardAssert(void 0 === this.o);
    let n = this.i;
    const __PRIVATE_guardedChangeListener = (e2) => this.i !== n ? (n = this.i, t(e2)) : Promise.resolve();
    let r = new __PRIVATE_Deferred();
    this.o = () => {
      this.i++, this.currentUser = this.u(), r.resolve(), r = new __PRIVATE_Deferred(), e.enqueueRetryable(() => __PRIVATE_guardedChangeListener(this.currentUser));
    };
    const __PRIVATE_awaitNextToken = () => {
      const t2 = r;
      e.enqueueRetryable(async () => {
        await t2.promise, await __PRIVATE_guardedChangeListener(this.currentUser);
      });
    }, __PRIVATE_registerAuth = (e2) => {
      __PRIVATE_logDebug("FirebaseAuthCredentialsProvider", "Auth detected"), this.auth = e2, this.o && (this.auth.addAuthTokenListener(this.o), __PRIVATE_awaitNextToken());
    };
    this.t.onInit((e2) => __PRIVATE_registerAuth(e2)), // Our users can initialize Auth right after Firestore, so we give it
    // a chance to register itself with the component framework before we
    // determine whether to start up in unauthenticated mode.
    setTimeout(() => {
      if (!this.auth) {
        const e2 = this.t.getImmediate({
          optional: true
        });
        e2 ? __PRIVATE_registerAuth(e2) : (
          // If auth is still not available, proceed with `null` user
          (__PRIVATE_logDebug("FirebaseAuthCredentialsProvider", "Auth not yet detected"), r.resolve(), r = new __PRIVATE_Deferred())
        );
      }
    }, 0), __PRIVATE_awaitNextToken();
  }
  getToken() {
    const e = this.i, t = this.forceRefresh;
    return this.forceRefresh = false, this.auth ? this.auth.getToken(t).then((t2) => (
      // Cancel the request since the token changed while the request was
      // outstanding so the response is potentially for a previous user (which
      // user, we can't be sure).
      this.i !== e ? (__PRIVATE_logDebug("FirebaseAuthCredentialsProvider", "getToken aborted due to token change."), this.getToken()) : t2 ? (__PRIVATE_hardAssert("string" == typeof t2.accessToken), new __PRIVATE_OAuthToken(t2.accessToken, this.currentUser)) : null
    )) : Promise.resolve(null);
  }
  invalidateToken() {
    this.forceRefresh = true;
  }
  shutdown() {
    this.auth && this.o && this.auth.removeAuthTokenListener(this.o), this.o = void 0;
  }
  // Auth.getUid() can return null even with a user logged in. It is because
  // getUid() is synchronous, but the auth code populating Uid is asynchronous.
  // This method should only be called in the AuthTokenListener callback
  // to guarantee to get the actual user.
  u() {
    const e = this.auth && this.auth.getUid();
    return __PRIVATE_hardAssert(null === e || "string" == typeof e), new User(e);
  }
}
class __PRIVATE_FirstPartyToken {
  constructor(e, t, n) {
    this.l = e, this.h = t, this.P = n, this.type = "FirstParty", this.user = User.FIRST_PARTY, this.I = /* @__PURE__ */ new Map();
  }
  /**
   * Gets an authorization token, using a provided factory function, or return
   * null.
   */
  T() {
    return this.P ? this.P() : null;
  }
  get headers() {
    this.I.set("X-Goog-AuthUser", this.l);
    const e = this.T();
    return e && this.I.set("Authorization", e), this.h && this.I.set("X-Goog-Iam-Authorization-Token", this.h), this.I;
  }
}
class __PRIVATE_FirstPartyAuthCredentialsProvider {
  constructor(e, t, n) {
    this.l = e, this.h = t, this.P = n;
  }
  getToken() {
    return Promise.resolve(new __PRIVATE_FirstPartyToken(this.l, this.h, this.P));
  }
  start(e, t) {
    e.enqueueRetryable(() => t(User.FIRST_PARTY));
  }
  shutdown() {
  }
  invalidateToken() {
  }
}
class AppCheckToken {
  constructor(e) {
    this.value = e, this.type = "AppCheck", this.headers = /* @__PURE__ */ new Map(), e && e.length > 0 && this.headers.set("x-firebase-appcheck", this.value);
  }
}
class __PRIVATE_FirebaseAppCheckTokenProvider {
  constructor(e) {
    this.A = e, this.forceRefresh = false, this.appCheck = null, this.R = null;
  }
  start(e, t) {
    __PRIVATE_hardAssert(void 0 === this.o);
    const onTokenChanged = (e2) => {
      null != e2.error && __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", `Error getting App Check token; using placeholder token instead. Error: ${e2.error.message}`);
      const n = e2.token !== this.R;
      return this.R = e2.token, __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", `Received ${n ? "new" : "existing"} token.`), n ? t(e2.token) : Promise.resolve();
    };
    this.o = (t2) => {
      e.enqueueRetryable(() => onTokenChanged(t2));
    };
    const __PRIVATE_registerAppCheck = (e2) => {
      __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", "AppCheck detected"), this.appCheck = e2, this.o && this.appCheck.addTokenListener(this.o);
    };
    this.A.onInit((e2) => __PRIVATE_registerAppCheck(e2)), // Our users can initialize AppCheck after Firestore, so we give it
    // a chance to register itself with the component framework.
    setTimeout(() => {
      if (!this.appCheck) {
        const e2 = this.A.getImmediate({
          optional: true
        });
        e2 ? __PRIVATE_registerAppCheck(e2) : (
          // If AppCheck is still not available, proceed without it.
          __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", "AppCheck not yet detected")
        );
      }
    }, 0);
  }
  getToken() {
    const e = this.forceRefresh;
    return this.forceRefresh = false, this.appCheck ? this.appCheck.getToken(e).then((e2) => e2 ? (__PRIVATE_hardAssert("string" == typeof e2.token), this.R = e2.token, new AppCheckToken(e2.token)) : null) : Promise.resolve(null);
  }
  invalidateToken() {
    this.forceRefresh = true;
  }
  shutdown() {
    this.appCheck && this.o && this.appCheck.removeTokenListener(this.o), this.o = void 0;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_randomBytes(e) {
  const t = (
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    "undefined" != typeof self && (self.crypto || self.msCrypto)
  ), n = new Uint8Array(e);
  if (t && "function" == typeof t.getRandomValues) t.getRandomValues(n);
  else
    for (let t2 = 0; t2 < e; t2++) n[t2] = Math.floor(256 * Math.random());
  return n;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_AutoId {
  static newId() {
    const e = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", t = Math.floor(256 / e.length) * e.length;
    let n = "";
    for (; n.length < 20; ) {
      const r = __PRIVATE_randomBytes(40);
      for (let i = 0; i < r.length; ++i)
        n.length < 20 && r[i] < t && (n += e.charAt(r[i] % e.length));
    }
    return n;
  }
}
function __PRIVATE_primitiveComparator(e, t) {
  return e < t ? -1 : e > t ? 1 : 0;
}
function __PRIVATE_arrayEquals(e, t, n) {
  return e.length === t.length && e.every((e2, r) => n(e2, t[r]));
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Timestamp {
  /**
   * Creates a new timestamp.
   *
   * @param seconds - The number of seconds of UTC time since Unix epoch
   *     1970-01-01T00:00:00Z. Must be from 0001-01-01T00:00:00Z to
   *     9999-12-31T23:59:59Z inclusive.
   * @param nanoseconds - The non-negative fractions of a second at nanosecond
   *     resolution. Negative second values with fractions must still have
   *     non-negative nanoseconds values that count forward in time. Must be
   *     from 0 to 999,999,999 inclusive.
   */
  constructor(e, t) {
    if (this.seconds = e, this.nanoseconds = t, t < 0) throw new FirestoreError(D.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + t);
    if (t >= 1e9) throw new FirestoreError(D.INVALID_ARGUMENT, "Timestamp nanoseconds out of range: " + t);
    if (e < -62135596800) throw new FirestoreError(D.INVALID_ARGUMENT, "Timestamp seconds out of range: " + e);
    if (e >= 253402300800) throw new FirestoreError(D.INVALID_ARGUMENT, "Timestamp seconds out of range: " + e);
  }
  /**
   * Creates a new timestamp with the current date, with millisecond precision.
   *
   * @returns a new timestamp representing the current date.
   */
  static now() {
    return Timestamp.fromMillis(Date.now());
  }
  /**
   * Creates a new timestamp from the given date.
   *
   * @param date - The date to initialize the `Timestamp` from.
   * @returns A new `Timestamp` representing the same point in time as the given
   *     date.
   */
  static fromDate(e) {
    return Timestamp.fromMillis(e.getTime());
  }
  /**
   * Creates a new timestamp from the given number of milliseconds.
   *
   * @param milliseconds - Number of milliseconds since Unix epoch
   *     1970-01-01T00:00:00Z.
   * @returns A new `Timestamp` representing the same point in time as the given
   *     number of milliseconds.
   */
  static fromMillis(e) {
    const t = Math.floor(e / 1e3), n = Math.floor(1e6 * (e - 1e3 * t));
    return new Timestamp(t, n);
  }
  /**
   * Converts a `Timestamp` to a JavaScript `Date` object. This conversion
   * causes a loss of precision since `Date` objects only support millisecond
   * precision.
   *
   * @returns JavaScript `Date` object representing the same point in time as
   *     this `Timestamp`, with millisecond precision.
   */
  toDate() {
    return new Date(this.toMillis());
  }
  /**
   * Converts a `Timestamp` to a numeric timestamp (in milliseconds since
   * epoch). This operation causes a loss of precision.
   *
   * @returns The point in time corresponding to this timestamp, represented as
   *     the number of milliseconds since Unix epoch 1970-01-01T00:00:00Z.
   */
  toMillis() {
    return 1e3 * this.seconds + this.nanoseconds / 1e6;
  }
  _compareTo(e) {
    return this.seconds === e.seconds ? __PRIVATE_primitiveComparator(this.nanoseconds, e.nanoseconds) : __PRIVATE_primitiveComparator(this.seconds, e.seconds);
  }
  /**
   * Returns true if this `Timestamp` is equal to the provided one.
   *
   * @param other - The `Timestamp` to compare against.
   * @returns true if this `Timestamp` is equal to the provided one.
   */
  isEqual(e) {
    return e.seconds === this.seconds && e.nanoseconds === this.nanoseconds;
  }
  /** Returns a textual representation of this `Timestamp`. */
  toString() {
    return "Timestamp(seconds=" + this.seconds + ", nanoseconds=" + this.nanoseconds + ")";
  }
  /** Returns a JSON-serializable representation of this `Timestamp`. */
  toJSON() {
    return {
      seconds: this.seconds,
      nanoseconds: this.nanoseconds
    };
  }
  /**
   * Converts this object to a primitive string, which allows `Timestamp` objects
   * to be compared using the `>`, `<=`, `>=` and `>` operators.
   */
  valueOf() {
    const e = this.seconds - -62135596800;
    return String(e).padStart(12, "0") + "." + String(this.nanoseconds).padStart(9, "0");
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class SnapshotVersion {
  constructor(e) {
    this.timestamp = e;
  }
  static fromTimestamp(e) {
    return new SnapshotVersion(e);
  }
  static min() {
    return new SnapshotVersion(new Timestamp(0, 0));
  }
  static max() {
    return new SnapshotVersion(new Timestamp(253402300799, 999999999));
  }
  compareTo(e) {
    return this.timestamp._compareTo(e.timestamp);
  }
  isEqual(e) {
    return this.timestamp.isEqual(e.timestamp);
  }
  /** Returns a number representation of the version for use in spec tests. */
  toMicroseconds() {
    return 1e6 * this.timestamp.seconds + this.timestamp.nanoseconds / 1e3;
  }
  toString() {
    return "SnapshotVersion(" + this.timestamp.toString() + ")";
  }
  toTimestamp() {
    return this.timestamp;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class BasePath {
  constructor(e, t, n) {
    void 0 === t ? t = 0 : t > e.length && fail(), void 0 === n ? n = e.length - t : n > e.length - t && fail(), this.segments = e, this.offset = t, this.len = n;
  }
  get length() {
    return this.len;
  }
  isEqual(e) {
    return 0 === BasePath.comparator(this, e);
  }
  child(e) {
    const t = this.segments.slice(this.offset, this.limit());
    return e instanceof BasePath ? e.forEach((e2) => {
      t.push(e2);
    }) : t.push(e), this.construct(t);
  }
  /** The index of one past the last segment of the path. */
  limit() {
    return this.offset + this.length;
  }
  popFirst(e) {
    return e = void 0 === e ? 1 : e, this.construct(this.segments, this.offset + e, this.length - e);
  }
  popLast() {
    return this.construct(this.segments, this.offset, this.length - 1);
  }
  firstSegment() {
    return this.segments[this.offset];
  }
  lastSegment() {
    return this.get(this.length - 1);
  }
  get(e) {
    return this.segments[this.offset + e];
  }
  isEmpty() {
    return 0 === this.length;
  }
  isPrefixOf(e) {
    if (e.length < this.length) return false;
    for (let t = 0; t < this.length; t++) if (this.get(t) !== e.get(t)) return false;
    return true;
  }
  isImmediateParentOf(e) {
    if (this.length + 1 !== e.length) return false;
    for (let t = 0; t < this.length; t++) if (this.get(t) !== e.get(t)) return false;
    return true;
  }
  forEach(e) {
    for (let t = this.offset, n = this.limit(); t < n; t++) e(this.segments[t]);
  }
  toArray() {
    return this.segments.slice(this.offset, this.limit());
  }
  static comparator(e, t) {
    const n = Math.min(e.length, t.length);
    for (let r = 0; r < n; r++) {
      const n2 = e.get(r), i = t.get(r);
      if (n2 < i) return -1;
      if (n2 > i) return 1;
    }
    return e.length < t.length ? -1 : e.length > t.length ? 1 : 0;
  }
}
class ResourcePath extends BasePath {
  construct(e, t, n) {
    return new ResourcePath(e, t, n);
  }
  canonicalString() {
    return this.toArray().join("/");
  }
  toString() {
    return this.canonicalString();
  }
  /**
   * Returns a string representation of this path
   * where each path segment has been encoded with
   * `encodeURIComponent`.
   */
  toUriEncodedString() {
    return this.toArray().map(encodeURIComponent).join("/");
  }
  /**
   * Creates a resource path from the given slash-delimited string. If multiple
   * arguments are provided, all components are combined. Leading and trailing
   * slashes from all components are ignored.
   */
  static fromString(...e) {
    const t = [];
    for (const n of e) {
      if (n.indexOf("//") >= 0) throw new FirestoreError(D.INVALID_ARGUMENT, `Invalid segment (${n}). Paths must not contain // in them.`);
      t.push(...n.split("/").filter((e2) => e2.length > 0));
    }
    return new ResourcePath(t);
  }
  static emptyPath() {
    return new ResourcePath([]);
  }
}
const v = /^[_a-zA-Z][_a-zA-Z0-9]*$/;
class FieldPath$1 extends BasePath {
  construct(e, t, n) {
    return new FieldPath$1(e, t, n);
  }
  /**
   * Returns true if the string could be used as a segment in a field path
   * without escaping.
   */
  static isValidIdentifier(e) {
    return v.test(e);
  }
  canonicalString() {
    return this.toArray().map((e) => (e = e.replace(/\\/g, "\\\\").replace(/`/g, "\\`"), FieldPath$1.isValidIdentifier(e) || (e = "`" + e + "`"), e)).join(".");
  }
  toString() {
    return this.canonicalString();
  }
  /**
   * Returns true if this field references the key of a document.
   */
  isKeyField() {
    return 1 === this.length && "__name__" === this.get(0);
  }
  /**
   * The field designating the key of a document.
   */
  static keyField() {
    return new FieldPath$1(["__name__"]);
  }
  /**
   * Parses a field string from the given server-formatted string.
   *
   * - Splitting the empty string is not allowed (for now at least).
   * - Empty segments within the string (e.g. if there are two consecutive
   *   separators) are not allowed.
   *
   * TODO(b/37244157): we should make this more strict. Right now, it allows
   * non-identifier path components, even if they aren't escaped.
   */
  static fromServerFormat(e) {
    const t = [];
    let n = "", r = 0;
    const __PRIVATE_addCurrentSegment = () => {
      if (0 === n.length) throw new FirestoreError(D.INVALID_ARGUMENT, `Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);
      t.push(n), n = "";
    };
    let i = false;
    for (; r < e.length; ) {
      const t2 = e[r];
      if ("\\" === t2) {
        if (r + 1 === e.length) throw new FirestoreError(D.INVALID_ARGUMENT, "Path has trailing escape character: " + e);
        const t3 = e[r + 1];
        if ("\\" !== t3 && "." !== t3 && "`" !== t3) throw new FirestoreError(D.INVALID_ARGUMENT, "Path has invalid escape sequence: " + e);
        n += t3, r += 2;
      } else "`" === t2 ? (i = !i, r++) : "." !== t2 || i ? (n += t2, r++) : (__PRIVATE_addCurrentSegment(), r++);
    }
    if (__PRIVATE_addCurrentSegment(), i) throw new FirestoreError(D.INVALID_ARGUMENT, "Unterminated ` in path: " + e);
    return new FieldPath$1(t);
  }
  static emptyPath() {
    return new FieldPath$1([]);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class DocumentKey {
  constructor(e) {
    this.path = e;
  }
  static fromPath(e) {
    return new DocumentKey(ResourcePath.fromString(e));
  }
  static fromName(e) {
    return new DocumentKey(ResourcePath.fromString(e).popFirst(5));
  }
  static empty() {
    return new DocumentKey(ResourcePath.emptyPath());
  }
  get collectionGroup() {
    return this.path.popLast().lastSegment();
  }
  /** Returns true if the document is in the specified collectionId. */
  hasCollectionId(e) {
    return this.path.length >= 2 && this.path.get(this.path.length - 2) === e;
  }
  /** Returns the collection group (i.e. the name of the parent collection) for this key. */
  getCollectionGroup() {
    return this.path.get(this.path.length - 2);
  }
  /** Returns the fully qualified path to the parent collection. */
  getCollectionPath() {
    return this.path.popLast();
  }
  isEqual(e) {
    return null !== e && 0 === ResourcePath.comparator(this.path, e.path);
  }
  toString() {
    return this.path.toString();
  }
  static comparator(e, t) {
    return ResourcePath.comparator(e.path, t.path);
  }
  static isDocumentKey(e) {
    return e.length % 2 == 0;
  }
  /**
   * Creates and returns a new document key with the given segments.
   *
   * @param segments - The segments of the path to the document
   * @returns A new instance of DocumentKey
   */
  static fromSegments(e) {
    return new DocumentKey(new ResourcePath(e.slice()));
  }
}
function __PRIVATE_newIndexOffsetSuccessorFromReadTime(e, t) {
  const n = e.toTimestamp().seconds, r = e.toTimestamp().nanoseconds + 1, i = SnapshotVersion.fromTimestamp(1e9 === r ? new Timestamp(n + 1, 0) : new Timestamp(n, r));
  return new IndexOffset(i, DocumentKey.empty(), t);
}
function __PRIVATE_newIndexOffsetFromDocument(e) {
  return new IndexOffset(e.readTime, e.key, -1);
}
class IndexOffset {
  constructor(e, t, n) {
    this.readTime = e, this.documentKey = t, this.largestBatchId = n;
  }
  /** Returns an offset that sorts before all regular offsets. */
  static min() {
    return new IndexOffset(SnapshotVersion.min(), DocumentKey.empty(), -1);
  }
  /** Returns an offset that sorts after all regular offsets. */
  static max() {
    return new IndexOffset(SnapshotVersion.max(), DocumentKey.empty(), -1);
  }
}
function __PRIVATE_indexOffsetComparator(e, t) {
  let n = e.readTime.compareTo(t.readTime);
  return 0 !== n ? n : (n = DocumentKey.comparator(e.documentKey, t.documentKey), 0 !== n ? n : __PRIVATE_primitiveComparator(e.largestBatchId, t.largestBatchId));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const C = "The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";
class PersistenceTransaction {
  constructor() {
    this.onCommittedListeners = [];
  }
  addOnCommittedListener(e) {
    this.onCommittedListeners.push(e);
  }
  raiseOnCommittedEvent() {
    this.onCommittedListeners.forEach((e) => e());
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function __PRIVATE_ignoreIfPrimaryLeaseLoss(e) {
  if (e.code !== D.FAILED_PRECONDITION || e.message !== C) throw e;
  __PRIVATE_logDebug("LocalStore", "Unexpectedly lost primary lease");
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class PersistencePromise {
  constructor(e) {
    this.nextCallback = null, this.catchCallback = null, // When the operation resolves, we'll set result or error and mark isDone.
    this.result = void 0, this.error = void 0, this.isDone = false, // Set to true when .then() or .catch() are called and prevents additional
    // chaining.
    this.callbackAttached = false, e((e2) => {
      this.isDone = true, this.result = e2, this.nextCallback && // value should be defined unless T is Void, but we can't express
      // that in the type system.
      this.nextCallback(e2);
    }, (e2) => {
      this.isDone = true, this.error = e2, this.catchCallback && this.catchCallback(e2);
    });
  }
  catch(e) {
    return this.next(void 0, e);
  }
  next(e, t) {
    return this.callbackAttached && fail(), this.callbackAttached = true, this.isDone ? this.error ? this.wrapFailure(t, this.error) : this.wrapSuccess(e, this.result) : new PersistencePromise((n, r) => {
      this.nextCallback = (t2) => {
        this.wrapSuccess(e, t2).next(n, r);
      }, this.catchCallback = (e2) => {
        this.wrapFailure(t, e2).next(n, r);
      };
    });
  }
  toPromise() {
    return new Promise((e, t) => {
      this.next(e, t);
    });
  }
  wrapUserFunction(e) {
    try {
      const t = e();
      return t instanceof PersistencePromise ? t : PersistencePromise.resolve(t);
    } catch (e2) {
      return PersistencePromise.reject(e2);
    }
  }
  wrapSuccess(e, t) {
    return e ? this.wrapUserFunction(() => e(t)) : PersistencePromise.resolve(t);
  }
  wrapFailure(e, t) {
    return e ? this.wrapUserFunction(() => e(t)) : PersistencePromise.reject(t);
  }
  static resolve(e) {
    return new PersistencePromise((t, n) => {
      t(e);
    });
  }
  static reject(e) {
    return new PersistencePromise((t, n) => {
      n(e);
    });
  }
  static waitFor(e) {
    return new PersistencePromise((t, n) => {
      let r = 0, i = 0, s = false;
      e.forEach((e2) => {
        ++r, e2.next(() => {
          ++i, s && i === r && t();
        }, (e3) => n(e3));
      }), s = true, i === r && t();
    });
  }
  /**
   * Given an array of predicate functions that asynchronously evaluate to a
   * boolean, implements a short-circuiting `or` between the results. Predicates
   * will be evaluated until one of them returns `true`, then stop. The final
   * result will be whether any of them returned `true`.
   */
  static or(e) {
    let t = PersistencePromise.resolve(false);
    for (const n of e) t = t.next((e2) => e2 ? PersistencePromise.resolve(e2) : n());
    return t;
  }
  static forEach(e, t) {
    const n = [];
    return e.forEach((e2, r) => {
      n.push(t.call(this, e2, r));
    }), this.waitFor(n);
  }
  /**
   * Concurrently map all array elements through asynchronous function.
   */
  static mapArray(e, t) {
    return new PersistencePromise((n, r) => {
      const i = e.length, s = new Array(i);
      let o = 0;
      for (let _ = 0; _ < i; _++) {
        const a = _;
        t(e[a]).next((e2) => {
          s[a] = e2, ++o, o === i && n(s);
        }, (e2) => r(e2));
      }
    });
  }
  /**
   * An alternative to recursive PersistencePromise calls, that avoids
   * potential memory problems from unbounded chains of promises.
   *
   * The `action` will be called repeatedly while `condition` is true.
   */
  static doWhile(e, t) {
    return new PersistencePromise((n, r) => {
      const process2 = () => {
        true === e() ? t().next(() => {
          process2();
        }, r) : n();
      };
      process2();
    });
  }
}
function __PRIVATE_getAndroidVersion(e) {
  const t = e.match(/Android ([\d.]+)/i), n = t ? t[1].split(".").slice(0, 2).join(".") : "-1";
  return Number(n);
}
function __PRIVATE_isIndexedDbTransactionError(e) {
  return "IndexedDbTransactionError" === e.name;
}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_ListenSequence {
  constructor(e, t) {
    this.previousValue = e, t && (t.sequenceNumberHandler = (e2) => this.ie(e2), this.se = (e2) => t.writeSequenceNumber(e2));
  }
  ie(e) {
    return this.previousValue = Math.max(e, this.previousValue), this.previousValue;
  }
  next() {
    const e = ++this.previousValue;
    return this.se && this.se(e), e;
  }
}
__PRIVATE_ListenSequence.oe = -1;
function __PRIVATE_isNullOrUndefined(e) {
  return null == e;
}
function __PRIVATE_isNegativeZero(e) {
  return 0 === e && 1 / e == -1 / 0;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_objectSize(e) {
  let t = 0;
  for (const n in e) Object.prototype.hasOwnProperty.call(e, n) && t++;
  return t;
}
function forEach(e, t) {
  for (const n in e) Object.prototype.hasOwnProperty.call(e, n) && t(n, e[n]);
}
function isEmpty(e) {
  for (const t in e) if (Object.prototype.hasOwnProperty.call(e, t)) return false;
  return true;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class SortedMap {
  constructor(e, t) {
    this.comparator = e, this.root = t || LLRBNode.EMPTY;
  }
  // Returns a copy of the map, with the specified key/value added or replaced.
  insert(e, t) {
    return new SortedMap(this.comparator, this.root.insert(e, t, this.comparator).copy(null, null, LLRBNode.BLACK, null, null));
  }
  // Returns a copy of the map, with the specified key removed.
  remove(e) {
    return new SortedMap(this.comparator, this.root.remove(e, this.comparator).copy(null, null, LLRBNode.BLACK, null, null));
  }
  // Returns the value of the node with the given key, or null.
  get(e) {
    let t = this.root;
    for (; !t.isEmpty(); ) {
      const n = this.comparator(e, t.key);
      if (0 === n) return t.value;
      n < 0 ? t = t.left : n > 0 && (t = t.right);
    }
    return null;
  }
  // Returns the index of the element in this sorted map, or -1 if it doesn't
  // exist.
  indexOf(e) {
    let t = 0, n = this.root;
    for (; !n.isEmpty(); ) {
      const r = this.comparator(e, n.key);
      if (0 === r) return t + n.left.size;
      r < 0 ? n = n.left : (
        // Count all nodes left of the node plus the node itself
        (t += n.left.size + 1, n = n.right)
      );
    }
    return -1;
  }
  isEmpty() {
    return this.root.isEmpty();
  }
  // Returns the total number of nodes in the map.
  get size() {
    return this.root.size;
  }
  // Returns the minimum key in the map.
  minKey() {
    return this.root.minKey();
  }
  // Returns the maximum key in the map.
  maxKey() {
    return this.root.maxKey();
  }
  // Traverses the map in key order and calls the specified action function
  // for each key/value pair. If action returns true, traversal is aborted.
  // Returns the first truthy value returned by action, or the last falsey
  // value returned by action.
  inorderTraversal(e) {
    return this.root.inorderTraversal(e);
  }
  forEach(e) {
    this.inorderTraversal((t, n) => (e(t, n), false));
  }
  toString() {
    const e = [];
    return this.inorderTraversal((t, n) => (e.push(`${t}:${n}`), false)), `{${e.join(", ")}}`;
  }
  // Traverses the map in reverse key order and calls the specified action
  // function for each key/value pair. If action returns true, traversal is
  // aborted.
  // Returns the first truthy value returned by action, or the last falsey
  // value returned by action.
  reverseTraversal(e) {
    return this.root.reverseTraversal(e);
  }
  // Returns an iterator over the SortedMap.
  getIterator() {
    return new SortedMapIterator(this.root, null, this.comparator, false);
  }
  getIteratorFrom(e) {
    return new SortedMapIterator(this.root, e, this.comparator, false);
  }
  getReverseIterator() {
    return new SortedMapIterator(this.root, null, this.comparator, true);
  }
  getReverseIteratorFrom(e) {
    return new SortedMapIterator(this.root, e, this.comparator, true);
  }
}
class SortedMapIterator {
  constructor(e, t, n, r) {
    this.isReverse = r, this.nodeStack = [];
    let i = 1;
    for (; !e.isEmpty(); ) if (i = t ? n(e.key, t) : 1, // flip the comparison if we're going in reverse
    t && r && (i *= -1), i < 0)
      e = this.isReverse ? e.left : e.right;
    else {
      if (0 === i) {
        this.nodeStack.push(e);
        break;
      }
      this.nodeStack.push(e), e = this.isReverse ? e.right : e.left;
    }
  }
  getNext() {
    let e = this.nodeStack.pop();
    const t = {
      key: e.key,
      value: e.value
    };
    if (this.isReverse) for (e = e.left; !e.isEmpty(); ) this.nodeStack.push(e), e = e.right;
    else for (e = e.right; !e.isEmpty(); ) this.nodeStack.push(e), e = e.left;
    return t;
  }
  hasNext() {
    return this.nodeStack.length > 0;
  }
  peek() {
    if (0 === this.nodeStack.length) return null;
    const e = this.nodeStack[this.nodeStack.length - 1];
    return {
      key: e.key,
      value: e.value
    };
  }
}
class LLRBNode {
  constructor(e, t, n, r, i) {
    this.key = e, this.value = t, this.color = null != n ? n : LLRBNode.RED, this.left = null != r ? r : LLRBNode.EMPTY, this.right = null != i ? i : LLRBNode.EMPTY, this.size = this.left.size + 1 + this.right.size;
  }
  // Returns a copy of the current node, optionally replacing pieces of it.
  copy(e, t, n, r, i) {
    return new LLRBNode(null != e ? e : this.key, null != t ? t : this.value, null != n ? n : this.color, null != r ? r : this.left, null != i ? i : this.right);
  }
  isEmpty() {
    return false;
  }
  // Traverses the tree in key order and calls the specified action function
  // for each node. If action returns true, traversal is aborted.
  // Returns the first truthy value returned by action, or the last falsey
  // value returned by action.
  inorderTraversal(e) {
    return this.left.inorderTraversal(e) || e(this.key, this.value) || this.right.inorderTraversal(e);
  }
  // Traverses the tree in reverse key order and calls the specified action
  // function for each node. If action returns true, traversal is aborted.
  // Returns the first truthy value returned by action, or the last falsey
  // value returned by action.
  reverseTraversal(e) {
    return this.right.reverseTraversal(e) || e(this.key, this.value) || this.left.reverseTraversal(e);
  }
  // Returns the minimum node in the tree.
  min() {
    return this.left.isEmpty() ? this : this.left.min();
  }
  // Returns the maximum key in the tree.
  minKey() {
    return this.min().key;
  }
  // Returns the maximum key in the tree.
  maxKey() {
    return this.right.isEmpty() ? this.key : this.right.maxKey();
  }
  // Returns new tree, with the key/value added.
  insert(e, t, n) {
    let r = this;
    const i = n(e, r.key);
    return r = i < 0 ? r.copy(null, null, null, r.left.insert(e, t, n), null) : 0 === i ? r.copy(null, t, null, null, null) : r.copy(null, null, null, null, r.right.insert(e, t, n)), r.fixUp();
  }
  removeMin() {
    if (this.left.isEmpty()) return LLRBNode.EMPTY;
    let e = this;
    return e.left.isRed() || e.left.left.isRed() || (e = e.moveRedLeft()), e = e.copy(null, null, null, e.left.removeMin(), null), e.fixUp();
  }
  // Returns new tree, with the specified item removed.
  remove(e, t) {
    let n, r = this;
    if (t(e, r.key) < 0) r.left.isEmpty() || r.left.isRed() || r.left.left.isRed() || (r = r.moveRedLeft()), r = r.copy(null, null, null, r.left.remove(e, t), null);
    else {
      if (r.left.isRed() && (r = r.rotateRight()), r.right.isEmpty() || r.right.isRed() || r.right.left.isRed() || (r = r.moveRedRight()), 0 === t(e, r.key)) {
        if (r.right.isEmpty()) return LLRBNode.EMPTY;
        n = r.right.min(), r = r.copy(n.key, n.value, null, null, r.right.removeMin());
      }
      r = r.copy(null, null, null, null, r.right.remove(e, t));
    }
    return r.fixUp();
  }
  isRed() {
    return this.color;
  }
  // Returns new tree after performing any needed rotations.
  fixUp() {
    let e = this;
    return e.right.isRed() && !e.left.isRed() && (e = e.rotateLeft()), e.left.isRed() && e.left.left.isRed() && (e = e.rotateRight()), e.left.isRed() && e.right.isRed() && (e = e.colorFlip()), e;
  }
  moveRedLeft() {
    let e = this.colorFlip();
    return e.right.left.isRed() && (e = e.copy(null, null, null, null, e.right.rotateRight()), e = e.rotateLeft(), e = e.colorFlip()), e;
  }
  moveRedRight() {
    let e = this.colorFlip();
    return e.left.left.isRed() && (e = e.rotateRight(), e = e.colorFlip()), e;
  }
  rotateLeft() {
    const e = this.copy(null, null, LLRBNode.RED, null, this.right.left);
    return this.right.copy(null, null, this.color, e, null);
  }
  rotateRight() {
    const e = this.copy(null, null, LLRBNode.RED, this.left.right, null);
    return this.left.copy(null, null, this.color, null, e);
  }
  colorFlip() {
    const e = this.left.copy(null, null, !this.left.color, null, null), t = this.right.copy(null, null, !this.right.color, null, null);
    return this.copy(null, null, !this.color, e, t);
  }
  // For testing.
  checkMaxDepth() {
    const e = this.check();
    return Math.pow(2, e) <= this.size + 1;
  }
  // In a balanced RB tree, the black-depth (number of black nodes) from root to
  // leaves is equal on both sides.  This function verifies that or asserts.
  check() {
    if (this.isRed() && this.left.isRed()) throw fail();
    if (this.right.isRed()) throw fail();
    const e = this.left.check();
    if (e !== this.right.check()) throw fail();
    return e + (this.isRed() ? 0 : 1);
  }
}
LLRBNode.EMPTY = null, LLRBNode.RED = true, LLRBNode.BLACK = false;
LLRBNode.EMPTY = new // Represents an empty node (a leaf node in the Red-Black Tree).
class LLRBEmptyNode {
  constructor() {
    this.size = 0;
  }
  get key() {
    throw fail();
  }
  get value() {
    throw fail();
  }
  get color() {
    throw fail();
  }
  get left() {
    throw fail();
  }
  get right() {
    throw fail();
  }
  // Returns a copy of the current node.
  copy(e, t, n, r, i) {
    return this;
  }
  // Returns a copy of the tree, with the specified key/value added.
  insert(e, t, n) {
    return new LLRBNode(e, t);
  }
  // Returns a copy of the tree, with the specified key removed.
  remove(e, t) {
    return this;
  }
  isEmpty() {
    return true;
  }
  inorderTraversal(e) {
    return false;
  }
  reverseTraversal(e) {
    return false;
  }
  minKey() {
    return null;
  }
  maxKey() {
    return null;
  }
  isRed() {
    return false;
  }
  // For testing.
  checkMaxDepth() {
    return true;
  }
  check() {
    return 0;
  }
}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class SortedSet {
  constructor(e) {
    this.comparator = e, this.data = new SortedMap(this.comparator);
  }
  has(e) {
    return null !== this.data.get(e);
  }
  first() {
    return this.data.minKey();
  }
  last() {
    return this.data.maxKey();
  }
  get size() {
    return this.data.size;
  }
  indexOf(e) {
    return this.data.indexOf(e);
  }
  /** Iterates elements in order defined by "comparator" */
  forEach(e) {
    this.data.inorderTraversal((t, n) => (e(t), false));
  }
  /** Iterates over `elem`s such that: range[0] &lt;= elem &lt; range[1]. */
  forEachInRange(e, t) {
    const n = this.data.getIteratorFrom(e[0]);
    for (; n.hasNext(); ) {
      const r = n.getNext();
      if (this.comparator(r.key, e[1]) >= 0) return;
      t(r.key);
    }
  }
  /**
   * Iterates over `elem`s such that: start &lt;= elem until false is returned.
   */
  forEachWhile(e, t) {
    let n;
    for (n = void 0 !== t ? this.data.getIteratorFrom(t) : this.data.getIterator(); n.hasNext(); ) {
      if (!e(n.getNext().key)) return;
    }
  }
  /** Finds the least element greater than or equal to `elem`. */
  firstAfterOrEqual(e) {
    const t = this.data.getIteratorFrom(e);
    return t.hasNext() ? t.getNext().key : null;
  }
  getIterator() {
    return new SortedSetIterator(this.data.getIterator());
  }
  getIteratorFrom(e) {
    return new SortedSetIterator(this.data.getIteratorFrom(e));
  }
  /** Inserts or updates an element */
  add(e) {
    return this.copy(this.data.remove(e).insert(e, true));
  }
  /** Deletes an element */
  delete(e) {
    return this.has(e) ? this.copy(this.data.remove(e)) : this;
  }
  isEmpty() {
    return this.data.isEmpty();
  }
  unionWith(e) {
    let t = this;
    return t.size < e.size && (t = e, e = this), e.forEach((e2) => {
      t = t.add(e2);
    }), t;
  }
  isEqual(e) {
    if (!(e instanceof SortedSet)) return false;
    if (this.size !== e.size) return false;
    const t = this.data.getIterator(), n = e.data.getIterator();
    for (; t.hasNext(); ) {
      const e2 = t.getNext().key, r = n.getNext().key;
      if (0 !== this.comparator(e2, r)) return false;
    }
    return true;
  }
  toArray() {
    const e = [];
    return this.forEach((t) => {
      e.push(t);
    }), e;
  }
  toString() {
    const e = [];
    return this.forEach((t) => e.push(t)), "SortedSet(" + e.toString() + ")";
  }
  copy(e) {
    const t = new SortedSet(this.comparator);
    return t.data = e, t;
  }
}
class SortedSetIterator {
  constructor(e) {
    this.iter = e;
  }
  getNext() {
    return this.iter.getNext().key;
  }
  hasNext() {
    return this.iter.hasNext();
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FieldMask {
  constructor(e) {
    this.fields = e, // TODO(dimond): validation of FieldMask
    // Sort the field mask to support `FieldMask.isEqual()` and assert below.
    e.sort(FieldPath$1.comparator);
  }
  static empty() {
    return new FieldMask([]);
  }
  /**
   * Returns a new FieldMask object that is the result of adding all the given
   * fields paths to this field mask.
   */
  unionWith(e) {
    let t = new SortedSet(FieldPath$1.comparator);
    for (const e2 of this.fields) t = t.add(e2);
    for (const n of e) t = t.add(n);
    return new FieldMask(t.toArray());
  }
  /**
   * Verifies that `fieldPath` is included by at least one field in this field
   * mask.
   *
   * This is an O(n) operation, where `n` is the size of the field mask.
   */
  covers(e) {
    for (const t of this.fields) if (t.isPrefixOf(e)) return true;
    return false;
  }
  isEqual(e) {
    return __PRIVATE_arrayEquals(this.fields, e.fields, (e2, t) => e2.isEqual(t));
  }
}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_Base64DecodeError extends Error {
  constructor() {
    super(...arguments), this.name = "Base64DecodeError";
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ByteString {
  constructor(e) {
    this.binaryString = e;
  }
  static fromBase64String(e) {
    const t = function __PRIVATE_decodeBase64(e2) {
      try {
        return atob(e2);
      } catch (e3) {
        throw "undefined" != typeof DOMException && e3 instanceof DOMException ? new __PRIVATE_Base64DecodeError("Invalid base64 string: " + e3) : e3;
      }
    }(e);
    return new ByteString(t);
  }
  static fromUint8Array(e) {
    const t = (
      /**
      * Helper function to convert an Uint8array to a binary string.
      */
      function __PRIVATE_binaryStringFromUint8Array(e2) {
        let t2 = "";
        for (let n = 0; n < e2.length; ++n) t2 += String.fromCharCode(e2[n]);
        return t2;
      }(e)
    );
    return new ByteString(t);
  }
  [Symbol.iterator]() {
    let e = 0;
    return {
      next: () => e < this.binaryString.length ? {
        value: this.binaryString.charCodeAt(e++),
        done: false
      } : {
        value: void 0,
        done: true
      }
    };
  }
  toBase64() {
    return function __PRIVATE_encodeBase64(e) {
      return btoa(e);
    }(this.binaryString);
  }
  toUint8Array() {
    return function __PRIVATE_uint8ArrayFromBinaryString(e) {
      const t = new Uint8Array(e.length);
      for (let n = 0; n < e.length; n++) t[n] = e.charCodeAt(n);
      return t;
    }(this.binaryString);
  }
  approximateByteSize() {
    return 2 * this.binaryString.length;
  }
  compareTo(e) {
    return __PRIVATE_primitiveComparator(this.binaryString, e.binaryString);
  }
  isEqual(e) {
    return this.binaryString === e.binaryString;
  }
}
ByteString.EMPTY_BYTE_STRING = new ByteString("");
const ne = new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
function __PRIVATE_normalizeTimestamp(e) {
  if (__PRIVATE_hardAssert(!!e), "string" == typeof e) {
    let t = 0;
    const n = ne.exec(e);
    if (__PRIVATE_hardAssert(!!n), n[1]) {
      let e2 = n[1];
      e2 = (e2 + "000000000").substr(0, 9), t = Number(e2);
    }
    const r = new Date(e);
    return {
      seconds: Math.floor(r.getTime() / 1e3),
      nanos: t
    };
  }
  return {
    seconds: __PRIVATE_normalizeNumber(e.seconds),
    nanos: __PRIVATE_normalizeNumber(e.nanos)
  };
}
function __PRIVATE_normalizeNumber(e) {
  return "number" == typeof e ? e : "string" == typeof e ? Number(e) : 0;
}
function __PRIVATE_normalizeByteString(e) {
  return "string" == typeof e ? ByteString.fromBase64String(e) : ByteString.fromUint8Array(e);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_isServerTimestamp(e) {
  var t, n;
  return "server_timestamp" === (null === (n = ((null === (t = null == e ? void 0 : e.mapValue) || void 0 === t ? void 0 : t.fields) || {}).__type__) || void 0 === n ? void 0 : n.stringValue);
}
function __PRIVATE_getPreviousValue(e) {
  const t = e.mapValue.fields.__previous_value__;
  return __PRIVATE_isServerTimestamp(t) ? __PRIVATE_getPreviousValue(t) : t;
}
function __PRIVATE_getLocalWriteTime(e) {
  const t = __PRIVATE_normalizeTimestamp(e.mapValue.fields.__local_write_time__.timestampValue);
  return new Timestamp(t.seconds, t.nanos);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class DatabaseInfo {
  /**
   * Constructs a DatabaseInfo using the provided host, databaseId and
   * persistenceKey.
   *
   * @param databaseId - The database to use.
   * @param appId - The Firebase App Id.
   * @param persistenceKey - A unique identifier for this Firestore's local
   * storage (used in conjunction with the databaseId).
   * @param host - The Firestore backend host to connect to.
   * @param ssl - Whether to use SSL when connecting.
   * @param forceLongPolling - Whether to use the forceLongPolling option
   * when using WebChannel as the network transport.
   * @param autoDetectLongPolling - Whether to use the detectBufferingProxy
   * option when using WebChannel as the network transport.
   * @param longPollingOptions Options that configure long-polling.
   * @param useFetchStreams Whether to use the Fetch API instead of
   * XMLHTTPRequest
   */
  constructor(e, t, n, r, i, s, o, _, a) {
    this.databaseId = e, this.appId = t, this.persistenceKey = n, this.host = r, this.ssl = i, this.forceLongPolling = s, this.autoDetectLongPolling = o, this.longPollingOptions = _, this.useFetchStreams = a;
  }
}
class DatabaseId {
  constructor(e, t) {
    this.projectId = e, this.database = t || "(default)";
  }
  static empty() {
    return new DatabaseId("", "");
  }
  get isDefaultDatabase() {
    return "(default)" === this.database;
  }
  isEqual(e) {
    return e instanceof DatabaseId && e.projectId === this.projectId && e.database === this.database;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const re = {
  mapValue: {}
};
function __PRIVATE_typeOrder(e) {
  return "nullValue" in e ? 0 : "booleanValue" in e ? 1 : "integerValue" in e || "doubleValue" in e ? 2 : "timestampValue" in e ? 3 : "stringValue" in e ? 5 : "bytesValue" in e ? 6 : "referenceValue" in e ? 7 : "geoPointValue" in e ? 8 : "arrayValue" in e ? 9 : "mapValue" in e ? __PRIVATE_isServerTimestamp(e) ? 4 : __PRIVATE_isMaxValue(e) ? 9007199254740991 : __PRIVATE_isVectorValue(e) ? 10 : 11 : fail();
}
function __PRIVATE_valueEquals(e, t) {
  if (e === t) return true;
  const n = __PRIVATE_typeOrder(e);
  if (n !== __PRIVATE_typeOrder(t)) return false;
  switch (n) {
    case 0:
    case 9007199254740991:
      return true;
    case 1:
      return e.booleanValue === t.booleanValue;
    case 4:
      return __PRIVATE_getLocalWriteTime(e).isEqual(__PRIVATE_getLocalWriteTime(t));
    case 3:
      return function __PRIVATE_timestampEquals(e2, t2) {
        if ("string" == typeof e2.timestampValue && "string" == typeof t2.timestampValue && e2.timestampValue.length === t2.timestampValue.length)
          return e2.timestampValue === t2.timestampValue;
        const n2 = __PRIVATE_normalizeTimestamp(e2.timestampValue), r = __PRIVATE_normalizeTimestamp(t2.timestampValue);
        return n2.seconds === r.seconds && n2.nanos === r.nanos;
      }(e, t);
    case 5:
      return e.stringValue === t.stringValue;
    case 6:
      return function __PRIVATE_blobEquals(e2, t2) {
        return __PRIVATE_normalizeByteString(e2.bytesValue).isEqual(__PRIVATE_normalizeByteString(t2.bytesValue));
      }(e, t);
    case 7:
      return e.referenceValue === t.referenceValue;
    case 8:
      return function __PRIVATE_geoPointEquals(e2, t2) {
        return __PRIVATE_normalizeNumber(e2.geoPointValue.latitude) === __PRIVATE_normalizeNumber(t2.geoPointValue.latitude) && __PRIVATE_normalizeNumber(e2.geoPointValue.longitude) === __PRIVATE_normalizeNumber(t2.geoPointValue.longitude);
      }(e, t);
    case 2:
      return function __PRIVATE_numberEquals(e2, t2) {
        if ("integerValue" in e2 && "integerValue" in t2) return __PRIVATE_normalizeNumber(e2.integerValue) === __PRIVATE_normalizeNumber(t2.integerValue);
        if ("doubleValue" in e2 && "doubleValue" in t2) {
          const n2 = __PRIVATE_normalizeNumber(e2.doubleValue), r = __PRIVATE_normalizeNumber(t2.doubleValue);
          return n2 === r ? __PRIVATE_isNegativeZero(n2) === __PRIVATE_isNegativeZero(r) : isNaN(n2) && isNaN(r);
        }
        return false;
      }(e, t);
    case 9:
      return __PRIVATE_arrayEquals(e.arrayValue.values || [], t.arrayValue.values || [], __PRIVATE_valueEquals);
    case 10:
    case 11:
      return function __PRIVATE_objectEquals(e2, t2) {
        const n2 = e2.mapValue.fields || {}, r = t2.mapValue.fields || {};
        if (__PRIVATE_objectSize(n2) !== __PRIVATE_objectSize(r)) return false;
        for (const e3 in n2) if (n2.hasOwnProperty(e3) && (void 0 === r[e3] || !__PRIVATE_valueEquals(n2[e3], r[e3]))) return false;
        return true;
      }(e, t);
    default:
      return fail();
  }
}
function __PRIVATE_arrayValueContains(e, t) {
  return void 0 !== (e.values || []).find((e2) => __PRIVATE_valueEquals(e2, t));
}
function __PRIVATE_valueCompare(e, t) {
  if (e === t) return 0;
  const n = __PRIVATE_typeOrder(e), r = __PRIVATE_typeOrder(t);
  if (n !== r) return __PRIVATE_primitiveComparator(n, r);
  switch (n) {
    case 0:
    case 9007199254740991:
      return 0;
    case 1:
      return __PRIVATE_primitiveComparator(e.booleanValue, t.booleanValue);
    case 2:
      return function __PRIVATE_compareNumbers(e2, t2) {
        const n2 = __PRIVATE_normalizeNumber(e2.integerValue || e2.doubleValue), r2 = __PRIVATE_normalizeNumber(t2.integerValue || t2.doubleValue);
        return n2 < r2 ? -1 : n2 > r2 ? 1 : n2 === r2 ? 0 : (
          // one or both are NaN.
          isNaN(n2) ? isNaN(r2) ? 0 : -1 : 1
        );
      }(e, t);
    case 3:
      return __PRIVATE_compareTimestamps(e.timestampValue, t.timestampValue);
    case 4:
      return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(e), __PRIVATE_getLocalWriteTime(t));
    case 5:
      return __PRIVATE_primitiveComparator(e.stringValue, t.stringValue);
    case 6:
      return function __PRIVATE_compareBlobs(e2, t2) {
        const n2 = __PRIVATE_normalizeByteString(e2), r2 = __PRIVATE_normalizeByteString(t2);
        return n2.compareTo(r2);
      }(e.bytesValue, t.bytesValue);
    case 7:
      return function __PRIVATE_compareReferences(e2, t2) {
        const n2 = e2.split("/"), r2 = t2.split("/");
        for (let e3 = 0; e3 < n2.length && e3 < r2.length; e3++) {
          const t3 = __PRIVATE_primitiveComparator(n2[e3], r2[e3]);
          if (0 !== t3) return t3;
        }
        return __PRIVATE_primitiveComparator(n2.length, r2.length);
      }(e.referenceValue, t.referenceValue);
    case 8:
      return function __PRIVATE_compareGeoPoints(e2, t2) {
        const n2 = __PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e2.latitude), __PRIVATE_normalizeNumber(t2.latitude));
        if (0 !== n2) return n2;
        return __PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e2.longitude), __PRIVATE_normalizeNumber(t2.longitude));
      }(e.geoPointValue, t.geoPointValue);
    case 9:
      return __PRIVATE_compareArrays(e.arrayValue, t.arrayValue);
    case 10:
      return function __PRIVATE_compareVectors(e2, t2) {
        var n2, r2, i, s;
        const o = e2.fields || {}, _ = t2.fields || {}, a = null === (n2 = o.value) || void 0 === n2 ? void 0 : n2.arrayValue, u = null === (r2 = _.value) || void 0 === r2 ? void 0 : r2.arrayValue, c = __PRIVATE_primitiveComparator((null === (i = null == a ? void 0 : a.values) || void 0 === i ? void 0 : i.length) || 0, (null === (s = null == u ? void 0 : u.values) || void 0 === s ? void 0 : s.length) || 0);
        if (0 !== c) return c;
        return __PRIVATE_compareArrays(a, u);
      }(e.mapValue, t.mapValue);
    case 11:
      return function __PRIVATE_compareMaps(e2, t2) {
        if (e2 === re.mapValue && t2 === re.mapValue) return 0;
        if (e2 === re.mapValue) return 1;
        if (t2 === re.mapValue) return -1;
        const n2 = e2.fields || {}, r2 = Object.keys(n2), i = t2.fields || {}, s = Object.keys(i);
        r2.sort(), s.sort();
        for (let e3 = 0; e3 < r2.length && e3 < s.length; ++e3) {
          const t3 = __PRIVATE_primitiveComparator(r2[e3], s[e3]);
          if (0 !== t3) return t3;
          const o = __PRIVATE_valueCompare(n2[r2[e3]], i[s[e3]]);
          if (0 !== o) return o;
        }
        return __PRIVATE_primitiveComparator(r2.length, s.length);
      }(e.mapValue, t.mapValue);
    default:
      throw fail();
  }
}
function __PRIVATE_compareTimestamps(e, t) {
  if ("string" == typeof e && "string" == typeof t && e.length === t.length) return __PRIVATE_primitiveComparator(e, t);
  const n = __PRIVATE_normalizeTimestamp(e), r = __PRIVATE_normalizeTimestamp(t), i = __PRIVATE_primitiveComparator(n.seconds, r.seconds);
  return 0 !== i ? i : __PRIVATE_primitiveComparator(n.nanos, r.nanos);
}
function __PRIVATE_compareArrays(e, t) {
  const n = e.values || [], r = t.values || [];
  for (let e2 = 0; e2 < n.length && e2 < r.length; ++e2) {
    const t2 = __PRIVATE_valueCompare(n[e2], r[e2]);
    if (t2) return t2;
  }
  return __PRIVATE_primitiveComparator(n.length, r.length);
}
function canonicalId(e) {
  return __PRIVATE_canonifyValue(e);
}
function __PRIVATE_canonifyValue(e) {
  return "nullValue" in e ? "null" : "booleanValue" in e ? "" + e.booleanValue : "integerValue" in e ? "" + e.integerValue : "doubleValue" in e ? "" + e.doubleValue : "timestampValue" in e ? function __PRIVATE_canonifyTimestamp(e2) {
    const t = __PRIVATE_normalizeTimestamp(e2);
    return `time(${t.seconds},${t.nanos})`;
  }(e.timestampValue) : "stringValue" in e ? e.stringValue : "bytesValue" in e ? function __PRIVATE_canonifyByteString(e2) {
    return __PRIVATE_normalizeByteString(e2).toBase64();
  }(e.bytesValue) : "referenceValue" in e ? function __PRIVATE_canonifyReference(e2) {
    return DocumentKey.fromName(e2).toString();
  }(e.referenceValue) : "geoPointValue" in e ? function __PRIVATE_canonifyGeoPoint(e2) {
    return `geo(${e2.latitude},${e2.longitude})`;
  }(e.geoPointValue) : "arrayValue" in e ? function __PRIVATE_canonifyArray(e2) {
    let t = "[", n = true;
    for (const r of e2.values || []) n ? n = false : t += ",", t += __PRIVATE_canonifyValue(r);
    return t + "]";
  }(e.arrayValue) : "mapValue" in e ? function __PRIVATE_canonifyMap(e2) {
    const t = Object.keys(e2.fields || {}).sort();
    let n = "{", r = true;
    for (const i of t) r ? r = false : n += ",", n += `${i}:${__PRIVATE_canonifyValue(e2.fields[i])}`;
    return n + "}";
  }(e.mapValue) : fail();
}
function isInteger(e) {
  return !!e && "integerValue" in e;
}
function isArray(e) {
  return !!e && "arrayValue" in e;
}
function __PRIVATE_isNullValue(e) {
  return !!e && "nullValue" in e;
}
function __PRIVATE_isNanValue(e) {
  return !!e && "doubleValue" in e && isNaN(Number(e.doubleValue));
}
function __PRIVATE_isMapValue(e) {
  return !!e && "mapValue" in e;
}
function __PRIVATE_isVectorValue(e) {
  var t, n;
  return "__vector__" === (null === (n = ((null === (t = null == e ? void 0 : e.mapValue) || void 0 === t ? void 0 : t.fields) || {}).__type__) || void 0 === n ? void 0 : n.stringValue);
}
function __PRIVATE_deepClone(e) {
  if (e.geoPointValue) return {
    geoPointValue: Object.assign({}, e.geoPointValue)
  };
  if (e.timestampValue && "object" == typeof e.timestampValue) return {
    timestampValue: Object.assign({}, e.timestampValue)
  };
  if (e.mapValue) {
    const t = {
      mapValue: {
        fields: {}
      }
    };
    return forEach(e.mapValue.fields, (e2, n) => t.mapValue.fields[e2] = __PRIVATE_deepClone(n)), t;
  }
  if (e.arrayValue) {
    const t = {
      arrayValue: {
        values: []
      }
    };
    for (let n = 0; n < (e.arrayValue.values || []).length; ++n) t.arrayValue.values[n] = __PRIVATE_deepClone(e.arrayValue.values[n]);
    return t;
  }
  return Object.assign({}, e);
}
function __PRIVATE_isMaxValue(e) {
  return "__max__" === (((e.mapValue || {}).fields || {}).__type__ || {}).stringValue;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ObjectValue {
  constructor(e) {
    this.value = e;
  }
  static empty() {
    return new ObjectValue({
      mapValue: {}
    });
  }
  /**
   * Returns the value at the given path or null.
   *
   * @param path - the path to search
   * @returns The value at the path or null if the path is not set.
   */
  field(e) {
    if (e.isEmpty()) return this.value;
    {
      let t = this.value;
      for (let n = 0; n < e.length - 1; ++n) if (t = (t.mapValue.fields || {})[e.get(n)], !__PRIVATE_isMapValue(t)) return null;
      return t = (t.mapValue.fields || {})[e.lastSegment()], t || null;
    }
  }
  /**
   * Sets the field to the provided value.
   *
   * @param path - The field path to set.
   * @param value - The value to set.
   */
  set(e, t) {
    this.getFieldsMap(e.popLast())[e.lastSegment()] = __PRIVATE_deepClone(t);
  }
  /**
   * Sets the provided fields to the provided values.
   *
   * @param data - A map of fields to values (or null for deletes).
   */
  setAll(e) {
    let t = FieldPath$1.emptyPath(), n = {}, r = [];
    e.forEach((e2, i2) => {
      if (!t.isImmediateParentOf(i2)) {
        const e3 = this.getFieldsMap(t);
        this.applyChanges(e3, n, r), n = {}, r = [], t = i2.popLast();
      }
      e2 ? n[i2.lastSegment()] = __PRIVATE_deepClone(e2) : r.push(i2.lastSegment());
    });
    const i = this.getFieldsMap(t);
    this.applyChanges(i, n, r);
  }
  /**
   * Removes the field at the specified path. If there is no field at the
   * specified path, nothing is changed.
   *
   * @param path - The field path to remove.
   */
  delete(e) {
    const t = this.field(e.popLast());
    __PRIVATE_isMapValue(t) && t.mapValue.fields && delete t.mapValue.fields[e.lastSegment()];
  }
  isEqual(e) {
    return __PRIVATE_valueEquals(this.value, e.value);
  }
  /**
   * Returns the map that contains the leaf element of `path`. If the parent
   * entry does not yet exist, or if it is not a map, a new map will be created.
   */
  getFieldsMap(e) {
    let t = this.value;
    t.mapValue.fields || (t.mapValue = {
      fields: {}
    });
    for (let n = 0; n < e.length; ++n) {
      let r = t.mapValue.fields[e.get(n)];
      __PRIVATE_isMapValue(r) && r.mapValue.fields || (r = {
        mapValue: {
          fields: {}
        }
      }, t.mapValue.fields[e.get(n)] = r), t = r;
    }
    return t.mapValue.fields;
  }
  /**
   * Modifies `fieldsMap` by adding, replacing or deleting the specified
   * entries.
   */
  applyChanges(e, t, n) {
    forEach(t, (t2, n2) => e[t2] = n2);
    for (const t2 of n) delete e[t2];
  }
  clone() {
    return new ObjectValue(__PRIVATE_deepClone(this.value));
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class MutableDocument {
  constructor(e, t, n, r, i, s, o) {
    this.key = e, this.documentType = t, this.version = n, this.readTime = r, this.createTime = i, this.data = s, this.documentState = o;
  }
  /**
   * Creates a document with no known version or data, but which can serve as
   * base document for mutations.
   */
  static newInvalidDocument(e) {
    return new MutableDocument(
      e,
      0,
      /* version */
      SnapshotVersion.min(),
      /* readTime */
      SnapshotVersion.min(),
      /* createTime */
      SnapshotVersion.min(),
      ObjectValue.empty(),
      0
      /* DocumentState.SYNCED */
    );
  }
  /**
   * Creates a new document that is known to exist with the given data at the
   * given version.
   */
  static newFoundDocument(e, t, n, r) {
    return new MutableDocument(
      e,
      1,
      /* version */
      t,
      /* readTime */
      SnapshotVersion.min(),
      /* createTime */
      n,
      r,
      0
      /* DocumentState.SYNCED */
    );
  }
  /** Creates a new document that is known to not exist at the given version. */
  static newNoDocument(e, t) {
    return new MutableDocument(
      e,
      2,
      /* version */
      t,
      /* readTime */
      SnapshotVersion.min(),
      /* createTime */
      SnapshotVersion.min(),
      ObjectValue.empty(),
      0
      /* DocumentState.SYNCED */
    );
  }
  /**
   * Creates a new document that is known to exist at the given version but
   * whose data is not known (e.g. a document that was updated without a known
   * base document).
   */
  static newUnknownDocument(e, t) {
    return new MutableDocument(
      e,
      3,
      /* version */
      t,
      /* readTime */
      SnapshotVersion.min(),
      /* createTime */
      SnapshotVersion.min(),
      ObjectValue.empty(),
      2
      /* DocumentState.HAS_COMMITTED_MUTATIONS */
    );
  }
  /**
   * Changes the document type to indicate that it exists and that its version
   * and data are known.
   */
  convertToFoundDocument(e, t) {
    return !this.createTime.isEqual(SnapshotVersion.min()) || 2 !== this.documentType && 0 !== this.documentType || (this.createTime = e), this.version = e, this.documentType = 1, this.data = t, this.documentState = 0, this;
  }
  /**
   * Changes the document type to indicate that it doesn't exist at the given
   * version.
   */
  convertToNoDocument(e) {
    return this.version = e, this.documentType = 2, this.data = ObjectValue.empty(), this.documentState = 0, this;
  }
  /**
   * Changes the document type to indicate that it exists at a given version but
   * that its data is not known (e.g. a document that was updated without a known
   * base document).
   */
  convertToUnknownDocument(e) {
    return this.version = e, this.documentType = 3, this.data = ObjectValue.empty(), this.documentState = 2, this;
  }
  setHasCommittedMutations() {
    return this.documentState = 2, this;
  }
  setHasLocalMutations() {
    return this.documentState = 1, this.version = SnapshotVersion.min(), this;
  }
  setReadTime(e) {
    return this.readTime = e, this;
  }
  get hasLocalMutations() {
    return 1 === this.documentState;
  }
  get hasCommittedMutations() {
    return 2 === this.documentState;
  }
  get hasPendingWrites() {
    return this.hasLocalMutations || this.hasCommittedMutations;
  }
  isValidDocument() {
    return 0 !== this.documentType;
  }
  isFoundDocument() {
    return 1 === this.documentType;
  }
  isNoDocument() {
    return 2 === this.documentType;
  }
  isUnknownDocument() {
    return 3 === this.documentType;
  }
  isEqual(e) {
    return e instanceof MutableDocument && this.key.isEqual(e.key) && this.version.isEqual(e.version) && this.documentType === e.documentType && this.documentState === e.documentState && this.data.isEqual(e.data);
  }
  mutableCopy() {
    return new MutableDocument(this.key, this.documentType, this.version, this.readTime, this.createTime, this.data.clone(), this.documentState);
  }
  toString() {
    return `Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`;
  }
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Bound {
  constructor(e, t) {
    this.position = e, this.inclusive = t;
  }
}
function __PRIVATE_boundCompareToDocument(e, t, n) {
  let r = 0;
  for (let i = 0; i < e.position.length; i++) {
    const s = t[i], o = e.position[i];
    if (s.field.isKeyField()) r = DocumentKey.comparator(DocumentKey.fromName(o.referenceValue), n.key);
    else {
      r = __PRIVATE_valueCompare(o, n.data.field(s.field));
    }
    if ("desc" === s.dir && (r *= -1), 0 !== r) break;
  }
  return r;
}
function __PRIVATE_boundEquals(e, t) {
  if (null === e) return null === t;
  if (null === t) return false;
  if (e.inclusive !== t.inclusive || e.position.length !== t.position.length) return false;
  for (let n = 0; n < e.position.length; n++) {
    if (!__PRIVATE_valueEquals(e.position[n], t.position[n])) return false;
  }
  return true;
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class OrderBy {
  constructor(e, t = "asc") {
    this.field = e, this.dir = t;
  }
}
function __PRIVATE_orderByEquals(e, t) {
  return e.dir === t.dir && e.field.isEqual(t.field);
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Filter {
}
class FieldFilter extends Filter {
  constructor(e, t, n) {
    super(), this.field = e, this.op = t, this.value = n;
  }
  /**
   * Creates a filter based on the provided arguments.
   */
  static create(e, t, n) {
    return e.isKeyField() ? "in" === t || "not-in" === t ? this.createKeyFieldInFilter(e, t, n) : new __PRIVATE_KeyFieldFilter(e, t, n) : "array-contains" === t ? new __PRIVATE_ArrayContainsFilter(e, n) : "in" === t ? new __PRIVATE_InFilter(e, n) : "not-in" === t ? new __PRIVATE_NotInFilter(e, n) : "array-contains-any" === t ? new __PRIVATE_ArrayContainsAnyFilter(e, n) : new FieldFilter(e, t, n);
  }
  static createKeyFieldInFilter(e, t, n) {
    return "in" === t ? new __PRIVATE_KeyFieldInFilter(e, n) : new __PRIVATE_KeyFieldNotInFilter(e, n);
  }
  matches(e) {
    const t = e.data.field(this.field);
    return "!=" === this.op ? null !== t && this.matchesComparison(__PRIVATE_valueCompare(t, this.value)) : null !== t && __PRIVATE_typeOrder(this.value) === __PRIVATE_typeOrder(t) && this.matchesComparison(__PRIVATE_valueCompare(t, this.value));
  }
  matchesComparison(e) {
    switch (this.op) {
      case "<":
        return e < 0;
      case "<=":
        return e <= 0;
      case "==":
        return 0 === e;
      case "!=":
        return 0 !== e;
      case ">":
        return e > 0;
      case ">=":
        return e >= 0;
      default:
        return fail();
    }
  }
  isInequality() {
    return [
      "<",
      "<=",
      ">",
      ">=",
      "!=",
      "not-in"
      /* Operator.NOT_IN */
    ].indexOf(this.op) >= 0;
  }
  getFlattenedFilters() {
    return [this];
  }
  getFilters() {
    return [this];
  }
}
class CompositeFilter extends Filter {
  constructor(e, t) {
    super(), this.filters = e, this.op = t, this.ae = null;
  }
  /**
   * Creates a filter based on the provided arguments.
   */
  static create(e, t) {
    return new CompositeFilter(e, t);
  }
  matches(e) {
    return __PRIVATE_compositeFilterIsConjunction(this) ? void 0 === this.filters.find((t) => !t.matches(e)) : void 0 !== this.filters.find((t) => t.matches(e));
  }
  getFlattenedFilters() {
    return null !== this.ae || (this.ae = this.filters.reduce((e, t) => e.concat(t.getFlattenedFilters()), [])), this.ae;
  }
  // Returns a mutable copy of `this.filters`
  getFilters() {
    return Object.assign([], this.filters);
  }
}
function __PRIVATE_compositeFilterIsConjunction(e) {
  return "and" === e.op;
}
function __PRIVATE_compositeFilterIsFlatConjunction(e) {
  return __PRIVATE_compositeFilterIsFlat(e) && __PRIVATE_compositeFilterIsConjunction(e);
}
function __PRIVATE_compositeFilterIsFlat(e) {
  for (const t of e.filters) if (t instanceof CompositeFilter) return false;
  return true;
}
function __PRIVATE_canonifyFilter(e) {
  if (e instanceof FieldFilter)
    return e.field.canonicalString() + e.op.toString() + canonicalId(e.value);
  if (__PRIVATE_compositeFilterIsFlatConjunction(e))
    return e.filters.map((e2) => __PRIVATE_canonifyFilter(e2)).join(",");
  {
    const t = e.filters.map((e2) => __PRIVATE_canonifyFilter(e2)).join(",");
    return `${e.op}(${t})`;
  }
}
function __PRIVATE_filterEquals(e, t) {
  return e instanceof FieldFilter ? function __PRIVATE_fieldFilterEquals(e2, t2) {
    return t2 instanceof FieldFilter && e2.op === t2.op && e2.field.isEqual(t2.field) && __PRIVATE_valueEquals(e2.value, t2.value);
  }(e, t) : e instanceof CompositeFilter ? function __PRIVATE_compositeFilterEquals(e2, t2) {
    if (t2 instanceof CompositeFilter && e2.op === t2.op && e2.filters.length === t2.filters.length) {
      return e2.filters.reduce((e3, n, r) => e3 && __PRIVATE_filterEquals(n, t2.filters[r]), true);
    }
    return false;
  }(e, t) : void fail();
}
function __PRIVATE_stringifyFilter(e) {
  return e instanceof FieldFilter ? function __PRIVATE_stringifyFieldFilter(e2) {
    return `${e2.field.canonicalString()} ${e2.op} ${canonicalId(e2.value)}`;
  }(e) : e instanceof CompositeFilter ? function __PRIVATE_stringifyCompositeFilter(e2) {
    return e2.op.toString() + " {" + e2.getFilters().map(__PRIVATE_stringifyFilter).join(" ,") + "}";
  }(e) : "Filter";
}
class __PRIVATE_KeyFieldFilter extends FieldFilter {
  constructor(e, t, n) {
    super(e, t, n), this.key = DocumentKey.fromName(n.referenceValue);
  }
  matches(e) {
    const t = DocumentKey.comparator(e.key, this.key);
    return this.matchesComparison(t);
  }
}
class __PRIVATE_KeyFieldInFilter extends FieldFilter {
  constructor(e, t) {
    super(e, "in", t), this.keys = __PRIVATE_extractDocumentKeysFromArrayValue("in", t);
  }
  matches(e) {
    return this.keys.some((t) => t.isEqual(e.key));
  }
}
class __PRIVATE_KeyFieldNotInFilter extends FieldFilter {
  constructor(e, t) {
    super(e, "not-in", t), this.keys = __PRIVATE_extractDocumentKeysFromArrayValue("not-in", t);
  }
  matches(e) {
    return !this.keys.some((t) => t.isEqual(e.key));
  }
}
function __PRIVATE_extractDocumentKeysFromArrayValue(e, t) {
  var n;
  return ((null === (n = t.arrayValue) || void 0 === n ? void 0 : n.values) || []).map((e2) => DocumentKey.fromName(e2.referenceValue));
}
class __PRIVATE_ArrayContainsFilter extends FieldFilter {
  constructor(e, t) {
    super(e, "array-contains", t);
  }
  matches(e) {
    const t = e.data.field(this.field);
    return isArray(t) && __PRIVATE_arrayValueContains(t.arrayValue, this.value);
  }
}
class __PRIVATE_InFilter extends FieldFilter {
  constructor(e, t) {
    super(e, "in", t);
  }
  matches(e) {
    const t = e.data.field(this.field);
    return null !== t && __PRIVATE_arrayValueContains(this.value.arrayValue, t);
  }
}
class __PRIVATE_NotInFilter extends FieldFilter {
  constructor(e, t) {
    super(e, "not-in", t);
  }
  matches(e) {
    if (__PRIVATE_arrayValueContains(this.value.arrayValue, {
      nullValue: "NULL_VALUE"
    })) return false;
    const t = e.data.field(this.field);
    return null !== t && !__PRIVATE_arrayValueContains(this.value.arrayValue, t);
  }
}
class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter {
  constructor(e, t) {
    super(e, "array-contains-any", t);
  }
  matches(e) {
    const t = e.data.field(this.field);
    return !(!isArray(t) || !t.arrayValue.values) && t.arrayValue.values.some((e2) => __PRIVATE_arrayValueContains(this.value.arrayValue, e2));
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_TargetImpl {
  constructor(e, t = null, n = [], r = [], i = null, s = null, o = null) {
    this.path = e, this.collectionGroup = t, this.orderBy = n, this.filters = r, this.limit = i, this.startAt = s, this.endAt = o, this.ue = null;
  }
}
function __PRIVATE_newTarget(e, t = null, n = [], r = [], i = null, s = null, o = null) {
  return new __PRIVATE_TargetImpl(e, t, n, r, i, s, o);
}
function __PRIVATE_canonifyTarget(e) {
  const t = __PRIVATE_debugCast(e);
  if (null === t.ue) {
    let e2 = t.path.canonicalString();
    null !== t.collectionGroup && (e2 += "|cg:" + t.collectionGroup), e2 += "|f:", e2 += t.filters.map((e3) => __PRIVATE_canonifyFilter(e3)).join(","), e2 += "|ob:", e2 += t.orderBy.map((e3) => function __PRIVATE_canonifyOrderBy(e4) {
      return e4.field.canonicalString() + e4.dir;
    }(e3)).join(","), __PRIVATE_isNullOrUndefined(t.limit) || (e2 += "|l:", e2 += t.limit), t.startAt && (e2 += "|lb:", e2 += t.startAt.inclusive ? "b:" : "a:", e2 += t.startAt.position.map((e3) => canonicalId(e3)).join(",")), t.endAt && (e2 += "|ub:", e2 += t.endAt.inclusive ? "a:" : "b:", e2 += t.endAt.position.map((e3) => canonicalId(e3)).join(",")), t.ue = e2;
  }
  return t.ue;
}
function __PRIVATE_targetEquals(e, t) {
  if (e.limit !== t.limit) return false;
  if (e.orderBy.length !== t.orderBy.length) return false;
  for (let n = 0; n < e.orderBy.length; n++) if (!__PRIVATE_orderByEquals(e.orderBy[n], t.orderBy[n])) return false;
  if (e.filters.length !== t.filters.length) return false;
  for (let n = 0; n < e.filters.length; n++) if (!__PRIVATE_filterEquals(e.filters[n], t.filters[n])) return false;
  return e.collectionGroup === t.collectionGroup && (!!e.path.isEqual(t.path) && (!!__PRIVATE_boundEquals(e.startAt, t.startAt) && __PRIVATE_boundEquals(e.endAt, t.endAt)));
}
function __PRIVATE_targetIsDocumentTarget(e) {
  return DocumentKey.isDocumentKey(e.path) && null === e.collectionGroup && 0 === e.filters.length;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_QueryImpl {
  /**
   * Initializes a Query with a path and optional additional query constraints.
   * Path must currently be empty if this is a collection group query.
   */
  constructor(e, t = null, n = [], r = [], i = null, s = "F", o = null, _ = null) {
    this.path = e, this.collectionGroup = t, this.explicitOrderBy = n, this.filters = r, this.limit = i, this.limitType = s, this.startAt = o, this.endAt = _, this.ce = null, // The corresponding `Target` of this `Query` instance, for use with
    // non-aggregate queries.
    this.le = null, // The corresponding `Target` of this `Query` instance, for use with
    // aggregate queries. Unlike targets for non-aggregate queries,
    // aggregate query targets do not contain normalized order-bys, they only
    // contain explicit order-bys.
    this.he = null, this.startAt, this.endAt;
  }
}
function __PRIVATE_newQuery(e, t, n, r, i, s, o, _) {
  return new __PRIVATE_QueryImpl(e, t, n, r, i, s, o, _);
}
function __PRIVATE_newQueryForPath(e) {
  return new __PRIVATE_QueryImpl(e);
}
function __PRIVATE_queryMatchesAllDocuments(e) {
  return 0 === e.filters.length && null === e.limit && null == e.startAt && null == e.endAt && (0 === e.explicitOrderBy.length || 1 === e.explicitOrderBy.length && e.explicitOrderBy[0].field.isKeyField());
}
function __PRIVATE_isCollectionGroupQuery(e) {
  return null !== e.collectionGroup;
}
function __PRIVATE_queryNormalizedOrderBy(e) {
  const t = __PRIVATE_debugCast(e);
  if (null === t.ce) {
    t.ce = [];
    const e2 = /* @__PURE__ */ new Set();
    for (const n2 of t.explicitOrderBy) t.ce.push(n2), e2.add(n2.field.canonicalString());
    const n = t.explicitOrderBy.length > 0 ? t.explicitOrderBy[t.explicitOrderBy.length - 1].dir : "asc", r = function __PRIVATE_getInequalityFilterFields(e3) {
      let t2 = new SortedSet(FieldPath$1.comparator);
      return e3.filters.forEach((e4) => {
        e4.getFlattenedFilters().forEach((e5) => {
          e5.isInequality() && (t2 = t2.add(e5.field));
        });
      }), t2;
    }(t);
    r.forEach((r2) => {
      e2.has(r2.canonicalString()) || r2.isKeyField() || t.ce.push(new OrderBy(r2, n));
    }), // Add the document key field to the last if it is not explicitly ordered.
    e2.has(FieldPath$1.keyField().canonicalString()) || t.ce.push(new OrderBy(FieldPath$1.keyField(), n));
  }
  return t.ce;
}
function __PRIVATE_queryToTarget(e) {
  const t = __PRIVATE_debugCast(e);
  return t.le || (t.le = __PRIVATE__queryToTarget(t, __PRIVATE_queryNormalizedOrderBy(e))), t.le;
}
function __PRIVATE__queryToTarget(e, t) {
  if ("F" === e.limitType) return __PRIVATE_newTarget(e.path, e.collectionGroup, t, e.filters, e.limit, e.startAt, e.endAt);
  {
    t = t.map((e2) => {
      const t2 = "desc" === e2.dir ? "asc" : "desc";
      return new OrderBy(e2.field, t2);
    });
    const n = e.endAt ? new Bound(e.endAt.position, e.endAt.inclusive) : null, r = e.startAt ? new Bound(e.startAt.position, e.startAt.inclusive) : null;
    return __PRIVATE_newTarget(e.path, e.collectionGroup, t, e.filters, e.limit, n, r);
  }
}
function __PRIVATE_queryWithLimit(e, t, n) {
  return new __PRIVATE_QueryImpl(e.path, e.collectionGroup, e.explicitOrderBy.slice(), e.filters.slice(), t, n, e.startAt, e.endAt);
}
function __PRIVATE_queryEquals(e, t) {
  return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(e), __PRIVATE_queryToTarget(t)) && e.limitType === t.limitType;
}
function __PRIVATE_canonifyQuery(e) {
  return `${__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(e))}|lt:${e.limitType}`;
}
function __PRIVATE_stringifyQuery(e) {
  return `Query(target=${function __PRIVATE_stringifyTarget(e2) {
    let t = e2.path.canonicalString();
    return null !== e2.collectionGroup && (t += " collectionGroup=" + e2.collectionGroup), e2.filters.length > 0 && (t += `, filters: [${e2.filters.map((e3) => __PRIVATE_stringifyFilter(e3)).join(", ")}]`), __PRIVATE_isNullOrUndefined(e2.limit) || (t += ", limit: " + e2.limit), e2.orderBy.length > 0 && (t += `, orderBy: [${e2.orderBy.map((e3) => function __PRIVATE_stringifyOrderBy(e4) {
      return `${e4.field.canonicalString()} (${e4.dir})`;
    }(e3)).join(", ")}]`), e2.startAt && (t += ", startAt: ", t += e2.startAt.inclusive ? "b:" : "a:", t += e2.startAt.position.map((e3) => canonicalId(e3)).join(",")), e2.endAt && (t += ", endAt: ", t += e2.endAt.inclusive ? "a:" : "b:", t += e2.endAt.position.map((e3) => canonicalId(e3)).join(",")), `Target(${t})`;
  }(__PRIVATE_queryToTarget(e))}; limitType=${e.limitType})`;
}
function __PRIVATE_queryMatches(e, t) {
  return t.isFoundDocument() && function __PRIVATE_queryMatchesPathAndCollectionGroup(e2, t2) {
    const n = t2.key.path;
    return null !== e2.collectionGroup ? t2.key.hasCollectionId(e2.collectionGroup) && e2.path.isPrefixOf(n) : DocumentKey.isDocumentKey(e2.path) ? e2.path.isEqual(n) : e2.path.isImmediateParentOf(n);
  }(e, t) && function __PRIVATE_queryMatchesOrderBy(e2, t2) {
    for (const n of __PRIVATE_queryNormalizedOrderBy(e2))
      if (!n.field.isKeyField() && null === t2.data.field(n.field)) return false;
    return true;
  }(e, t) && function __PRIVATE_queryMatchesFilters(e2, t2) {
    for (const n of e2.filters) if (!n.matches(t2)) return false;
    return true;
  }(e, t) && function __PRIVATE_queryMatchesBounds(e2, t2) {
    if (e2.startAt && !/**
    * Returns true if a document sorts before a bound using the provided sort
    * order.
    */
    function __PRIVATE_boundSortsBeforeDocument(e3, t3, n) {
      const r = __PRIVATE_boundCompareToDocument(e3, t3, n);
      return e3.inclusive ? r <= 0 : r < 0;
    }(e2.startAt, __PRIVATE_queryNormalizedOrderBy(e2), t2)) return false;
    if (e2.endAt && !function __PRIVATE_boundSortsAfterDocument(e3, t3, n) {
      const r = __PRIVATE_boundCompareToDocument(e3, t3, n);
      return e3.inclusive ? r >= 0 : r > 0;
    }(e2.endAt, __PRIVATE_queryNormalizedOrderBy(e2), t2)) return false;
    return true;
  }(e, t);
}
function __PRIVATE_queryCollectionGroup(e) {
  return e.collectionGroup || (e.path.length % 2 == 1 ? e.path.lastSegment() : e.path.get(e.path.length - 2));
}
function __PRIVATE_newQueryComparator(e) {
  return (t, n) => {
    let r = false;
    for (const i of __PRIVATE_queryNormalizedOrderBy(e)) {
      const e2 = __PRIVATE_compareDocs(i, t, n);
      if (0 !== e2) return e2;
      r = r || i.field.isKeyField();
    }
    return 0;
  };
}
function __PRIVATE_compareDocs(e, t, n) {
  const r = e.field.isKeyField() ? DocumentKey.comparator(t.key, n.key) : function __PRIVATE_compareDocumentsByField(e2, t2, n2) {
    const r2 = t2.data.field(e2), i = n2.data.field(e2);
    return null !== r2 && null !== i ? __PRIVATE_valueCompare(r2, i) : fail();
  }(e.field, t, n);
  switch (e.dir) {
    case "asc":
      return r;
    case "desc":
      return -1 * r;
    default:
      return fail();
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ObjectMap {
  constructor(e, t) {
    this.mapKeyFn = e, this.equalsFn = t, /**
     * The inner map for a key/value pair. Due to the possibility of collisions we
     * keep a list of entries that we do a linear search through to find an actual
     * match. Note that collisions should be rare, so we still expect near
     * constant time lookups in practice.
     */
    this.inner = {}, /** The number of entries stored in the map */
    this.innerSize = 0;
  }
  /** Get a value for this key, or undefined if it does not exist. */
  get(e) {
    const t = this.mapKeyFn(e), n = this.inner[t];
    if (void 0 !== n) {
      for (const [t2, r] of n) if (this.equalsFn(t2, e)) return r;
    }
  }
  has(e) {
    return void 0 !== this.get(e);
  }
  /** Put this key and value in the map. */
  set(e, t) {
    const n = this.mapKeyFn(e), r = this.inner[n];
    if (void 0 === r) return this.inner[n] = [[e, t]], void this.innerSize++;
    for (let n2 = 0; n2 < r.length; n2++) if (this.equalsFn(r[n2][0], e))
      return void (r[n2] = [e, t]);
    r.push([e, t]), this.innerSize++;
  }
  /**
   * Remove this key from the map. Returns a boolean if anything was deleted.
   */
  delete(e) {
    const t = this.mapKeyFn(e), n = this.inner[t];
    if (void 0 === n) return false;
    for (let r = 0; r < n.length; r++) if (this.equalsFn(n[r][0], e)) return 1 === n.length ? delete this.inner[t] : n.splice(r, 1), this.innerSize--, true;
    return false;
  }
  forEach(e) {
    forEach(this.inner, (t, n) => {
      for (const [t2, r] of n) e(t2, r);
    });
  }
  isEmpty() {
    return isEmpty(this.inner);
  }
  size() {
    return this.innerSize;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const oe = new SortedMap(DocumentKey.comparator);
function __PRIVATE_mutableDocumentMap() {
  return oe;
}
const _e = new SortedMap(DocumentKey.comparator);
function documentMap(...e) {
  let t = _e;
  for (const n of e) t = t.insert(n.key, n);
  return t;
}
function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(e) {
  let t = _e;
  return e.forEach((e2, n) => t = t.insert(e2, n.overlayedDocument)), t;
}
function __PRIVATE_newOverlayMap() {
  return __PRIVATE_newDocumentKeyMap();
}
function __PRIVATE_newMutationMap() {
  return __PRIVATE_newDocumentKeyMap();
}
function __PRIVATE_newDocumentKeyMap() {
  return new ObjectMap((e) => e.toString(), (e, t) => e.isEqual(t));
}
const ue = new SortedSet(DocumentKey.comparator);
function __PRIVATE_documentKeySet(...e) {
  let t = ue;
  for (const n of e) t = t.add(n);
  return t;
}
const ce = new SortedSet(__PRIVATE_primitiveComparator);
function __PRIVATE_targetIdSet() {
  return ce;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_toDouble(e, t) {
  if (e.useProto3Json) {
    if (isNaN(t)) return {
      doubleValue: "NaN"
    };
    if (t === 1 / 0) return {
      doubleValue: "Infinity"
    };
    if (t === -1 / 0) return {
      doubleValue: "-Infinity"
    };
  }
  return {
    doubleValue: __PRIVATE_isNegativeZero(t) ? "-0" : t
  };
}
function __PRIVATE_toInteger(e) {
  return {
    integerValue: "" + e
  };
}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class TransformOperation {
  constructor() {
    this._ = void 0;
  }
}
function __PRIVATE_applyTransformOperationToLocalView(e, t, n) {
  return e instanceof __PRIVATE_ServerTimestampTransform ? function serverTimestamp$1(e2, t2) {
    const n2 = {
      fields: {
        __type__: {
          stringValue: "server_timestamp"
        },
        __local_write_time__: {
          timestampValue: {
            seconds: e2.seconds,
            nanos: e2.nanoseconds
          }
        }
      }
    };
    return t2 && __PRIVATE_isServerTimestamp(t2) && (t2 = __PRIVATE_getPreviousValue(t2)), t2 && (n2.fields.__previous_value__ = t2), {
      mapValue: n2
    };
  }(n, t) : e instanceof __PRIVATE_ArrayUnionTransformOperation ? __PRIVATE_applyArrayUnionTransformOperation(e, t) : e instanceof __PRIVATE_ArrayRemoveTransformOperation ? __PRIVATE_applyArrayRemoveTransformOperation(e, t) : function __PRIVATE_applyNumericIncrementTransformOperationToLocalView(e2, t2) {
    const n2 = __PRIVATE_computeTransformOperationBaseValue(e2, t2), r = asNumber(n2) + asNumber(e2.Pe);
    return isInteger(n2) && isInteger(e2.Pe) ? __PRIVATE_toInteger(r) : __PRIVATE_toDouble(e2.serializer, r);
  }(e, t);
}
function __PRIVATE_applyTransformOperationToRemoteDocument(e, t, n) {
  return e instanceof __PRIVATE_ArrayUnionTransformOperation ? __PRIVATE_applyArrayUnionTransformOperation(e, t) : e instanceof __PRIVATE_ArrayRemoveTransformOperation ? __PRIVATE_applyArrayRemoveTransformOperation(e, t) : n;
}
function __PRIVATE_computeTransformOperationBaseValue(e, t) {
  return e instanceof __PRIVATE_NumericIncrementTransformOperation ? (
    /** Returns true if `value` is either an IntegerValue or a DoubleValue. */
    function __PRIVATE_isNumber(e2) {
      return isInteger(e2) || function __PRIVATE_isDouble(e3) {
        return !!e3 && "doubleValue" in e3;
      }(e2);
    }(t) ? t : {
      integerValue: 0
    }
  ) : null;
}
class __PRIVATE_ServerTimestampTransform extends TransformOperation {
}
class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation {
  constructor(e) {
    super(), this.elements = e;
  }
}
function __PRIVATE_applyArrayUnionTransformOperation(e, t) {
  const n = __PRIVATE_coercedFieldValuesArray(t);
  for (const t2 of e.elements) n.some((e2) => __PRIVATE_valueEquals(e2, t2)) || n.push(t2);
  return {
    arrayValue: {
      values: n
    }
  };
}
class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation {
  constructor(e) {
    super(), this.elements = e;
  }
}
function __PRIVATE_applyArrayRemoveTransformOperation(e, t) {
  let n = __PRIVATE_coercedFieldValuesArray(t);
  for (const t2 of e.elements) n = n.filter((e2) => !__PRIVATE_valueEquals(e2, t2));
  return {
    arrayValue: {
      values: n
    }
  };
}
class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation {
  constructor(e, t) {
    super(), this.serializer = e, this.Pe = t;
  }
}
function asNumber(e) {
  return __PRIVATE_normalizeNumber(e.integerValue || e.doubleValue);
}
function __PRIVATE_coercedFieldValuesArray(e) {
  return isArray(e) && e.arrayValue.values ? e.arrayValue.values.slice() : [];
}
function __PRIVATE_fieldTransformEquals(e, t) {
  return e.field.isEqual(t.field) && function __PRIVATE_transformOperationEquals(e2, t2) {
    return e2 instanceof __PRIVATE_ArrayUnionTransformOperation && t2 instanceof __PRIVATE_ArrayUnionTransformOperation || e2 instanceof __PRIVATE_ArrayRemoveTransformOperation && t2 instanceof __PRIVATE_ArrayRemoveTransformOperation ? __PRIVATE_arrayEquals(e2.elements, t2.elements, __PRIVATE_valueEquals) : e2 instanceof __PRIVATE_NumericIncrementTransformOperation && t2 instanceof __PRIVATE_NumericIncrementTransformOperation ? __PRIVATE_valueEquals(e2.Pe, t2.Pe) : e2 instanceof __PRIVATE_ServerTimestampTransform && t2 instanceof __PRIVATE_ServerTimestampTransform;
  }(e.transform, t.transform);
}
class Precondition {
  constructor(e, t) {
    this.updateTime = e, this.exists = t;
  }
  /** Creates a new empty Precondition. */
  static none() {
    return new Precondition();
  }
  /** Creates a new Precondition with an exists flag. */
  static exists(e) {
    return new Precondition(void 0, e);
  }
  /** Creates a new Precondition based on a version a document exists at. */
  static updateTime(e) {
    return new Precondition(e);
  }
  /** Returns whether this Precondition is empty. */
  get isNone() {
    return void 0 === this.updateTime && void 0 === this.exists;
  }
  isEqual(e) {
    return this.exists === e.exists && (this.updateTime ? !!e.updateTime && this.updateTime.isEqual(e.updateTime) : !e.updateTime);
  }
}
function __PRIVATE_preconditionIsValidForDocument(e, t) {
  return void 0 !== e.updateTime ? t.isFoundDocument() && t.version.isEqual(e.updateTime) : void 0 === e.exists || e.exists === t.isFoundDocument();
}
class Mutation {
}
function __PRIVATE_calculateOverlayMutation(e, t) {
  if (!e.hasLocalMutations || t && 0 === t.fields.length) return null;
  if (null === t) return e.isNoDocument() ? new __PRIVATE_DeleteMutation(e.key, Precondition.none()) : new __PRIVATE_SetMutation(e.key, e.data, Precondition.none());
  {
    const n = e.data, r = ObjectValue.empty();
    let i = new SortedSet(FieldPath$1.comparator);
    for (let e2 of t.fields) if (!i.has(e2)) {
      let t2 = n.field(e2);
      null === t2 && e2.length > 1 && (e2 = e2.popLast(), t2 = n.field(e2)), null === t2 ? r.delete(e2) : r.set(e2, t2), i = i.add(e2);
    }
    return new __PRIVATE_PatchMutation(e.key, r, new FieldMask(i.toArray()), Precondition.none());
  }
}
function __PRIVATE_mutationApplyToRemoteDocument(e, t, n) {
  e instanceof __PRIVATE_SetMutation ? function __PRIVATE_setMutationApplyToRemoteDocument(e2, t2, n2) {
    const r = e2.value.clone(), i = __PRIVATE_serverTransformResults(e2.fieldTransforms, t2, n2.transformResults);
    r.setAll(i), t2.convertToFoundDocument(n2.version, r).setHasCommittedMutations();
  }(e, t, n) : e instanceof __PRIVATE_PatchMutation ? function __PRIVATE_patchMutationApplyToRemoteDocument(e2, t2, n2) {
    if (!__PRIVATE_preconditionIsValidForDocument(e2.precondition, t2))
      return void t2.convertToUnknownDocument(n2.version);
    const r = __PRIVATE_serverTransformResults(e2.fieldTransforms, t2, n2.transformResults), i = t2.data;
    i.setAll(__PRIVATE_getPatch(e2)), i.setAll(r), t2.convertToFoundDocument(n2.version, i).setHasCommittedMutations();
  }(e, t, n) : function __PRIVATE_deleteMutationApplyToRemoteDocument(e2, t2, n2) {
    t2.convertToNoDocument(n2.version).setHasCommittedMutations();
  }(0, t, n);
}
function __PRIVATE_mutationApplyToLocalView(e, t, n, r) {
  return e instanceof __PRIVATE_SetMutation ? function __PRIVATE_setMutationApplyToLocalView(e2, t2, n2, r2) {
    if (!__PRIVATE_preconditionIsValidForDocument(e2.precondition, t2))
      return n2;
    const i = e2.value.clone(), s = __PRIVATE_localTransformResults(e2.fieldTransforms, r2, t2);
    return i.setAll(s), t2.convertToFoundDocument(t2.version, i).setHasLocalMutations(), null;
  }(e, t, n, r) : e instanceof __PRIVATE_PatchMutation ? function __PRIVATE_patchMutationApplyToLocalView(e2, t2, n2, r2) {
    if (!__PRIVATE_preconditionIsValidForDocument(e2.precondition, t2)) return n2;
    const i = __PRIVATE_localTransformResults(e2.fieldTransforms, r2, t2), s = t2.data;
    if (s.setAll(__PRIVATE_getPatch(e2)), s.setAll(i), t2.convertToFoundDocument(t2.version, s).setHasLocalMutations(), null === n2) return null;
    return n2.unionWith(e2.fieldMask.fields).unionWith(e2.fieldTransforms.map((e3) => e3.field));
  }(e, t, n, r) : function __PRIVATE_deleteMutationApplyToLocalView(e2, t2, n2) {
    if (__PRIVATE_preconditionIsValidForDocument(e2.precondition, t2)) return t2.convertToNoDocument(t2.version).setHasLocalMutations(), null;
    return n2;
  }(e, t, n);
}
function __PRIVATE_mutationEquals(e, t) {
  return e.type === t.type && (!!e.key.isEqual(t.key) && (!!e.precondition.isEqual(t.precondition) && (!!function __PRIVATE_fieldTransformsAreEqual(e2, t2) {
    return void 0 === e2 && void 0 === t2 || !(!e2 || !t2) && __PRIVATE_arrayEquals(e2, t2, (e3, t3) => __PRIVATE_fieldTransformEquals(e3, t3));
  }(e.fieldTransforms, t.fieldTransforms) && (0 === e.type ? e.value.isEqual(t.value) : 1 !== e.type || e.data.isEqual(t.data) && e.fieldMask.isEqual(t.fieldMask)))));
}
class __PRIVATE_SetMutation extends Mutation {
  constructor(e, t, n, r = []) {
    super(), this.key = e, this.value = t, this.precondition = n, this.fieldTransforms = r, this.type = 0;
  }
  getFieldMask() {
    return null;
  }
}
class __PRIVATE_PatchMutation extends Mutation {
  constructor(e, t, n, r, i = []) {
    super(), this.key = e, this.data = t, this.fieldMask = n, this.precondition = r, this.fieldTransforms = i, this.type = 1;
  }
  getFieldMask() {
    return this.fieldMask;
  }
}
function __PRIVATE_getPatch(e) {
  const t = /* @__PURE__ */ new Map();
  return e.fieldMask.fields.forEach((n) => {
    if (!n.isEmpty()) {
      const r = e.data.field(n);
      t.set(n, r);
    }
  }), t;
}
function __PRIVATE_serverTransformResults(e, t, n) {
  const r = /* @__PURE__ */ new Map();
  __PRIVATE_hardAssert(e.length === n.length);
  for (let i = 0; i < n.length; i++) {
    const s = e[i], o = s.transform, _ = t.data.field(s.field);
    r.set(s.field, __PRIVATE_applyTransformOperationToRemoteDocument(o, _, n[i]));
  }
  return r;
}
function __PRIVATE_localTransformResults(e, t, n) {
  const r = /* @__PURE__ */ new Map();
  for (const i of e) {
    const e2 = i.transform, s = n.data.field(i.field);
    r.set(i.field, __PRIVATE_applyTransformOperationToLocalView(e2, s, t));
  }
  return r;
}
class __PRIVATE_DeleteMutation extends Mutation {
  constructor(e, t) {
    super(), this.key = e, this.precondition = t, this.type = 2, this.fieldTransforms = [];
  }
  getFieldMask() {
    return null;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class MutationBatch {
  /**
   * @param batchId - The unique ID of this mutation batch.
   * @param localWriteTime - The original write time of this mutation.
   * @param baseMutations - Mutations that are used to populate the base
   * values when this mutation is applied locally. This can be used to locally
   * overwrite values that are persisted in the remote document cache. Base
   * mutations are never sent to the backend.
   * @param mutations - The user-provided mutations in this mutation batch.
   * User-provided mutations are applied both locally and remotely on the
   * backend.
   */
  constructor(e, t, n, r) {
    this.batchId = e, this.localWriteTime = t, this.baseMutations = n, this.mutations = r;
  }
  /**
   * Applies all the mutations in this MutationBatch to the specified document
   * to compute the state of the remote document
   *
   * @param document - The document to apply mutations to.
   * @param batchResult - The result of applying the MutationBatch to the
   * backend.
   */
  applyToRemoteDocument(e, t) {
    const n = t.mutationResults;
    for (let t2 = 0; t2 < this.mutations.length; t2++) {
      const r = this.mutations[t2];
      if (r.key.isEqual(e.key)) {
        __PRIVATE_mutationApplyToRemoteDocument(r, e, n[t2]);
      }
    }
  }
  /**
   * Computes the local view of a document given all the mutations in this
   * batch.
   *
   * @param document - The document to apply mutations to.
   * @param mutatedFields - Fields that have been updated before applying this mutation batch.
   * @returns A `FieldMask` representing all the fields that are mutated.
   */
  applyToLocalView(e, t) {
    for (const n of this.baseMutations) n.key.isEqual(e.key) && (t = __PRIVATE_mutationApplyToLocalView(n, e, t, this.localWriteTime));
    for (const n of this.mutations) n.key.isEqual(e.key) && (t = __PRIVATE_mutationApplyToLocalView(n, e, t, this.localWriteTime));
    return t;
  }
  /**
   * Computes the local view for all provided documents given the mutations in
   * this batch. Returns a `DocumentKey` to `Mutation` map which can be used to
   * replace all the mutation applications.
   */
  applyToLocalDocumentSet(e, t) {
    const n = __PRIVATE_newMutationMap();
    return this.mutations.forEach((r) => {
      const i = e.get(r.key), s = i.overlayedDocument;
      let o = this.applyToLocalView(s, i.mutatedFields);
      o = t.has(r.key) ? null : o;
      const _ = __PRIVATE_calculateOverlayMutation(s, o);
      null !== _ && n.set(r.key, _), s.isValidDocument() || s.convertToNoDocument(SnapshotVersion.min());
    }), n;
  }
  keys() {
    return this.mutations.reduce((e, t) => e.add(t.key), __PRIVATE_documentKeySet());
  }
  isEqual(e) {
    return this.batchId === e.batchId && __PRIVATE_arrayEquals(this.mutations, e.mutations, (e2, t) => __PRIVATE_mutationEquals(e2, t)) && __PRIVATE_arrayEquals(this.baseMutations, e.baseMutations, (e2, t) => __PRIVATE_mutationEquals(e2, t));
  }
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Overlay {
  constructor(e, t) {
    this.largestBatchId = e, this.mutation = t;
  }
  getKey() {
    return this.mutation.key;
  }
  isEqual(e) {
    return null !== e && this.mutation === e.mutation;
  }
  toString() {
    return `Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ExistenceFilter {
  constructor(e, t) {
    this.count = e, this.unchangedNames = t;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var le, he;
function __PRIVATE_mapCodeFromRpcCode(e) {
  if (void 0 === e)
    return __PRIVATE_logError("GRPC error has no .code"), D.UNKNOWN;
  switch (e) {
    case le.OK:
      return D.OK;
    case le.CANCELLED:
      return D.CANCELLED;
    case le.UNKNOWN:
      return D.UNKNOWN;
    case le.DEADLINE_EXCEEDED:
      return D.DEADLINE_EXCEEDED;
    case le.RESOURCE_EXHAUSTED:
      return D.RESOURCE_EXHAUSTED;
    case le.INTERNAL:
      return D.INTERNAL;
    case le.UNAVAILABLE:
      return D.UNAVAILABLE;
    case le.UNAUTHENTICATED:
      return D.UNAUTHENTICATED;
    case le.INVALID_ARGUMENT:
      return D.INVALID_ARGUMENT;
    case le.NOT_FOUND:
      return D.NOT_FOUND;
    case le.ALREADY_EXISTS:
      return D.ALREADY_EXISTS;
    case le.PERMISSION_DENIED:
      return D.PERMISSION_DENIED;
    case le.FAILED_PRECONDITION:
      return D.FAILED_PRECONDITION;
    case le.ABORTED:
      return D.ABORTED;
    case le.OUT_OF_RANGE:
      return D.OUT_OF_RANGE;
    case le.UNIMPLEMENTED:
      return D.UNIMPLEMENTED;
    case le.DATA_LOSS:
      return D.DATA_LOSS;
    default:
      return fail();
  }
}
(he = le || (le = {}))[he.OK = 0] = "OK", he[he.CANCELLED = 1] = "CANCELLED", he[he.UNKNOWN = 2] = "UNKNOWN", he[he.INVALID_ARGUMENT = 3] = "INVALID_ARGUMENT", he[he.DEADLINE_EXCEEDED = 4] = "DEADLINE_EXCEEDED", he[he.NOT_FOUND = 5] = "NOT_FOUND", he[he.ALREADY_EXISTS = 6] = "ALREADY_EXISTS", he[he.PERMISSION_DENIED = 7] = "PERMISSION_DENIED", he[he.UNAUTHENTICATED = 16] = "UNAUTHENTICATED", he[he.RESOURCE_EXHAUSTED = 8] = "RESOURCE_EXHAUSTED", he[he.FAILED_PRECONDITION = 9] = "FAILED_PRECONDITION", he[he.ABORTED = 10] = "ABORTED", he[he.OUT_OF_RANGE = 11] = "OUT_OF_RANGE", he[he.UNIMPLEMENTED = 12] = "UNIMPLEMENTED", he[he.INTERNAL = 13] = "INTERNAL", he[he.UNAVAILABLE = 14] = "UNAVAILABLE", he[he.DATA_LOSS = 15] = "DATA_LOSS";
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_newTextEncoder() {
  return new TextEncoder();
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ie = new Integer([4294967295, 4294967295], 0);
function __PRIVATE_getMd5HashValue(e) {
  const t = __PRIVATE_newTextEncoder().encode(e), n = new Md5();
  return n.update(t), new Uint8Array(n.digest());
}
function __PRIVATE_get64BitUints(e) {
  const t = new DataView(e.buffer), n = t.getUint32(
    0,
    /* littleEndian= */
    true
  ), r = t.getUint32(
    4,
    /* littleEndian= */
    true
  ), i = t.getUint32(
    8,
    /* littleEndian= */
    true
  ), s = t.getUint32(
    12,
    /* littleEndian= */
    true
  );
  return [new Integer([n, r], 0), new Integer([i, s], 0)];
}
class BloomFilter {
  constructor(e, t, n) {
    if (this.bitmap = e, this.padding = t, this.hashCount = n, t < 0 || t >= 8) throw new __PRIVATE_BloomFilterError(`Invalid padding: ${t}`);
    if (n < 0) throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);
    if (e.length > 0 && 0 === this.hashCount)
      throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);
    if (0 === e.length && 0 !== t)
      throw new __PRIVATE_BloomFilterError(`Invalid padding when bitmap length is 0: ${t}`);
    this.Ie = 8 * e.length - t, // Set the bit count in Integer to avoid repetition in mightContain().
    this.Te = Integer.fromNumber(this.Ie);
  }
  // Calculate the ith hash value based on the hashed 64bit integers,
  // and calculate its corresponding bit index in the bitmap to be checked.
  Ee(e, t, n) {
    let r = e.add(t.multiply(Integer.fromNumber(n)));
    return 1 === r.compare(Ie) && (r = new Integer([r.getBits(0), r.getBits(1)], 0)), r.modulo(this.Te).toNumber();
  }
  // Return whether the bit on the given index in the bitmap is set to 1.
  de(e) {
    return 0 != (this.bitmap[Math.floor(e / 8)] & 1 << e % 8);
  }
  mightContain(e) {
    if (0 === this.Ie) return false;
    const t = __PRIVATE_getMd5HashValue(e), [n, r] = __PRIVATE_get64BitUints(t);
    for (let e2 = 0; e2 < this.hashCount; e2++) {
      const t2 = this.Ee(n, r, e2);
      if (!this.de(t2)) return false;
    }
    return true;
  }
  /** Create bloom filter for testing purposes only. */
  static create(e, t, n) {
    const r = e % 8 == 0 ? 0 : 8 - e % 8, i = new Uint8Array(Math.ceil(e / 8)), s = new BloomFilter(i, r, t);
    return n.forEach((e2) => s.insert(e2)), s;
  }
  insert(e) {
    if (0 === this.Ie) return;
    const t = __PRIVATE_getMd5HashValue(e), [n, r] = __PRIVATE_get64BitUints(t);
    for (let e2 = 0; e2 < this.hashCount; e2++) {
      const t2 = this.Ee(n, r, e2);
      this.Ae(t2);
    }
  }
  Ae(e) {
    const t = Math.floor(e / 8), n = e % 8;
    this.bitmap[t] |= 1 << n;
  }
}
class __PRIVATE_BloomFilterError extends Error {
  constructor() {
    super(...arguments), this.name = "BloomFilterError";
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class RemoteEvent {
  constructor(e, t, n, r, i) {
    this.snapshotVersion = e, this.targetChanges = t, this.targetMismatches = n, this.documentUpdates = r, this.resolvedLimboDocuments = i;
  }
  /**
   * HACK: Views require RemoteEvents in order to determine whether the view is
   * CURRENT, but secondary tabs don't receive remote events. So this method is
   * used to create a synthesized RemoteEvent that can be used to apply a
   * CURRENT status change to a View, for queries executed in a different tab.
   */
  // PORTING NOTE: Multi-tab only
  static createSynthesizedRemoteEventForCurrentChange(e, t, n) {
    const r = /* @__PURE__ */ new Map();
    return r.set(e, TargetChange.createSynthesizedTargetChangeForCurrentChange(e, t, n)), new RemoteEvent(SnapshotVersion.min(), r, new SortedMap(__PRIVATE_primitiveComparator), __PRIVATE_mutableDocumentMap(), __PRIVATE_documentKeySet());
  }
}
class TargetChange {
  constructor(e, t, n, r, i) {
    this.resumeToken = e, this.current = t, this.addedDocuments = n, this.modifiedDocuments = r, this.removedDocuments = i;
  }
  /**
   * This method is used to create a synthesized TargetChanges that can be used to
   * apply a CURRENT status change to a View (for queries executed in a different
   * tab) or for new queries (to raise snapshots with correct CURRENT status).
   */
  static createSynthesizedTargetChangeForCurrentChange(e, t, n) {
    return new TargetChange(n, t, __PRIVATE_documentKeySet(), __PRIVATE_documentKeySet(), __PRIVATE_documentKeySet());
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_DocumentWatchChange {
  constructor(e, t, n, r) {
    this.Re = e, this.removedTargetIds = t, this.key = n, this.Ve = r;
  }
}
class __PRIVATE_ExistenceFilterChange {
  constructor(e, t) {
    this.targetId = e, this.me = t;
  }
}
class __PRIVATE_WatchTargetChange {
  constructor(e, t, n = ByteString.EMPTY_BYTE_STRING, r = null) {
    this.state = e, this.targetIds = t, this.resumeToken = n, this.cause = r;
  }
}
class __PRIVATE_TargetState {
  constructor() {
    this.fe = 0, /**
     * Keeps track of the document changes since the last raised snapshot.
     *
     * These changes are continuously updated as we receive document updates and
     * always reflect the current set of changes against the last issued snapshot.
     */
    this.ge = __PRIVATE_snapshotChangesMap(), /** See public getters for explanations of these fields. */
    this.pe = ByteString.EMPTY_BYTE_STRING, this.ye = false, /**
     * Whether this target state should be included in the next snapshot. We
     * initialize to true so that newly-added targets are included in the next
     * RemoteEvent.
     */
    this.we = true;
  }
  /**
   * Whether this target has been marked 'current'.
   *
   * 'Current' has special meaning in the RPC protocol: It implies that the
   * Watch backend has sent us all changes up to the point at which the target
   * was added and that the target is consistent with the rest of the watch
   * stream.
   */
  get current() {
    return this.ye;
  }
  /** The last resume token sent to us for this target. */
  get resumeToken() {
    return this.pe;
  }
  /** Whether this target has pending target adds or target removes. */
  get Se() {
    return 0 !== this.fe;
  }
  /** Whether we have modified any state that should trigger a snapshot. */
  get be() {
    return this.we;
  }
  /**
   * Applies the resume token to the TargetChange, but only when it has a new
   * value. Empty resumeTokens are discarded.
   */
  De(e) {
    e.approximateByteSize() > 0 && (this.we = true, this.pe = e);
  }
  /**
   * Creates a target change from the current set of changes.
   *
   * To reset the document changes after raising this snapshot, call
   * `clearPendingChanges()`.
   */
  ve() {
    let e = __PRIVATE_documentKeySet(), t = __PRIVATE_documentKeySet(), n = __PRIVATE_documentKeySet();
    return this.ge.forEach((r, i) => {
      switch (i) {
        case 0:
          e = e.add(r);
          break;
        case 2:
          t = t.add(r);
          break;
        case 1:
          n = n.add(r);
          break;
        default:
          fail();
      }
    }), new TargetChange(this.pe, this.ye, e, t, n);
  }
  /**
   * Resets the document changes and sets `hasPendingChanges` to false.
   */
  Ce() {
    this.we = false, this.ge = __PRIVATE_snapshotChangesMap();
  }
  Fe(e, t) {
    this.we = true, this.ge = this.ge.insert(e, t);
  }
  Me(e) {
    this.we = true, this.ge = this.ge.remove(e);
  }
  xe() {
    this.fe += 1;
  }
  Oe() {
    this.fe -= 1, __PRIVATE_hardAssert(this.fe >= 0);
  }
  Ne() {
    this.we = true, this.ye = true;
  }
}
class __PRIVATE_WatchChangeAggregator {
  constructor(e) {
    this.Le = e, /** The internal state of all tracked targets. */
    this.Be = /* @__PURE__ */ new Map(), /** Keeps track of the documents to update since the last raised snapshot. */
    this.ke = __PRIVATE_mutableDocumentMap(), /** A mapping of document keys to their set of target IDs. */
    this.qe = __PRIVATE_documentTargetMap(), /**
     * A map of targets with existence filter mismatches. These targets are
     * known to be inconsistent and their listens needs to be re-established by
     * RemoteStore.
     */
    this.Qe = new SortedMap(__PRIVATE_primitiveComparator);
  }
  /**
   * Processes and adds the DocumentWatchChange to the current set of changes.
   */
  Ke(e) {
    for (const t of e.Re) e.Ve && e.Ve.isFoundDocument() ? this.$e(t, e.Ve) : this.Ue(t, e.key, e.Ve);
    for (const t of e.removedTargetIds) this.Ue(t, e.key, e.Ve);
  }
  /** Processes and adds the WatchTargetChange to the current set of changes. */
  We(e) {
    this.forEachTarget(e, (t) => {
      const n = this.Ge(t);
      switch (e.state) {
        case 0:
          this.ze(t) && n.De(e.resumeToken);
          break;
        case 1:
          n.Oe(), n.Se || // We have a freshly added target, so we need to reset any state
          // that we had previously. This can happen e.g. when remove and add
          // back a target for existence filter mismatches.
          n.Ce(), n.De(e.resumeToken);
          break;
        case 2:
          n.Oe(), n.Se || this.removeTarget(t);
          break;
        case 3:
          this.ze(t) && (n.Ne(), n.De(e.resumeToken));
          break;
        case 4:
          this.ze(t) && // Reset the target and synthesizes removes for all existing
          // documents. The backend will re-add any documents that still
          // match the target before it sends the next global snapshot.
          (this.je(t), n.De(e.resumeToken));
          break;
        default:
          fail();
      }
    });
  }
  /**
   * Iterates over all targetIds that the watch change applies to: either the
   * targetIds explicitly listed in the change or the targetIds of all currently
   * active targets.
   */
  forEachTarget(e, t) {
    e.targetIds.length > 0 ? e.targetIds.forEach(t) : this.Be.forEach((e2, n) => {
      this.ze(n) && t(n);
    });
  }
  /**
   * Handles existence filters and synthesizes deletes for filter mismatches.
   * Targets that are invalidated by filter mismatches are added to
   * `pendingTargetResets`.
   */
  He(e) {
    const t = e.targetId, n = e.me.count, r = this.Je(t);
    if (r) {
      const i = r.target;
      if (__PRIVATE_targetIsDocumentTarget(i)) if (0 === n) {
        const e2 = new DocumentKey(i.path);
        this.Ue(t, e2, MutableDocument.newNoDocument(e2, SnapshotVersion.min()));
      } else __PRIVATE_hardAssert(1 === n);
      else {
        const r2 = this.Ye(t);
        if (r2 !== n) {
          const n2 = this.Ze(e), i2 = n2 ? this.Xe(n2, e, r2) : 1;
          if (0 !== i2) {
            this.je(t);
            const e2 = 2 === i2 ? "TargetPurposeExistenceFilterMismatchBloom" : "TargetPurposeExistenceFilterMismatch";
            this.Qe = this.Qe.insert(t, e2);
          }
        }
      }
    }
  }
  /**
   * Parse the bloom filter from the "unchanged_names" field of an existence
   * filter.
   */
  Ze(e) {
    const t = e.me.unchangedNames;
    if (!t || !t.bits) return null;
    const { bits: { bitmap: n = "", padding: r = 0 }, hashCount: i = 0 } = t;
    let s, o;
    try {
      s = __PRIVATE_normalizeByteString(n).toUint8Array();
    } catch (e2) {
      if (e2 instanceof __PRIVATE_Base64DecodeError) return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed (" + e2.message + "); ignoring the bloom filter and falling back to full re-query."), null;
      throw e2;
    }
    try {
      o = new BloomFilter(s, r, i);
    } catch (e2) {
      return __PRIVATE_logWarn(e2 instanceof __PRIVATE_BloomFilterError ? "BloomFilter error: " : "Applying bloom filter failed: ", e2), null;
    }
    return 0 === o.Ie ? null : o;
  }
  /**
   * Apply bloom filter to remove the deleted documents, and return the
   * application status.
   */
  Xe(e, t, n) {
    return t.me.count === n - this.nt(e, t.targetId) ? 0 : 2;
  }
  /**
   * Filter out removed documents based on bloom filter membership result and
   * return number of documents removed.
   */
  nt(e, t) {
    const n = this.Le.getRemoteKeysForTarget(t);
    let r = 0;
    return n.forEach((n2) => {
      const i = this.Le.tt(), s = `projects/${i.projectId}/databases/${i.database}/documents/${n2.path.canonicalString()}`;
      e.mightContain(s) || (this.Ue(
        t,
        n2,
        /*updatedDocument=*/
        null
      ), r++);
    }), r;
  }
  /**
   * Converts the currently accumulated state into a remote event at the
   * provided snapshot version. Resets the accumulated changes before returning.
   */
  rt(e) {
    const t = /* @__PURE__ */ new Map();
    this.Be.forEach((n2, r2) => {
      const i = this.Je(r2);
      if (i) {
        if (n2.current && __PRIVATE_targetIsDocumentTarget(i.target)) {
          const t2 = new DocumentKey(i.target.path);
          null !== this.ke.get(t2) || this.it(r2, t2) || this.Ue(r2, t2, MutableDocument.newNoDocument(t2, e));
        }
        n2.be && (t.set(r2, n2.ve()), n2.Ce());
      }
    });
    let n = __PRIVATE_documentKeySet();
    this.qe.forEach((e2, t2) => {
      let r2 = true;
      t2.forEachWhile((e3) => {
        const t3 = this.Je(e3);
        return !t3 || "TargetPurposeLimboResolution" === t3.purpose || (r2 = false, false);
      }), r2 && (n = n.add(e2));
    }), this.ke.forEach((t2, n2) => n2.setReadTime(e));
    const r = new RemoteEvent(e, t, this.Qe, this.ke, n);
    return this.ke = __PRIVATE_mutableDocumentMap(), this.qe = __PRIVATE_documentTargetMap(), this.Qe = new SortedMap(__PRIVATE_primitiveComparator), r;
  }
  /**
   * Adds the provided document to the internal list of document updates and
   * its document key to the given target's mapping.
   */
  // Visible for testing.
  $e(e, t) {
    if (!this.ze(e)) return;
    const n = this.it(e, t.key) ? 2 : 0;
    this.Ge(e).Fe(t.key, n), this.ke = this.ke.insert(t.key, t), this.qe = this.qe.insert(t.key, this.st(t.key).add(e));
  }
  /**
   * Removes the provided document from the target mapping. If the
   * document no longer matches the target, but the document's state is still
   * known (e.g. we know that the document was deleted or we received the change
   * that caused the filter mismatch), the new document can be provided
   * to update the remote document cache.
   */
  // Visible for testing.
  Ue(e, t, n) {
    if (!this.ze(e)) return;
    const r = this.Ge(e);
    this.it(e, t) ? r.Fe(
      t,
      1
      /* ChangeType.Removed */
    ) : (
      // The document may have entered and left the target before we raised a
      // snapshot, so we can just ignore the change.
      r.Me(t)
    ), this.qe = this.qe.insert(t, this.st(t).delete(e)), n && (this.ke = this.ke.insert(t, n));
  }
  removeTarget(e) {
    this.Be.delete(e);
  }
  /**
   * Returns the current count of documents in the target. This includes both
   * the number of documents that the LocalStore considers to be part of the
   * target as well as any accumulated changes.
   */
  Ye(e) {
    const t = this.Ge(e).ve();
    return this.Le.getRemoteKeysForTarget(e).size + t.addedDocuments.size - t.removedDocuments.size;
  }
  /**
   * Increment the number of acks needed from watch before we can consider the
   * server to be 'in-sync' with the client's active targets.
   */
  xe(e) {
    this.Ge(e).xe();
  }
  Ge(e) {
    let t = this.Be.get(e);
    return t || (t = new __PRIVATE_TargetState(), this.Be.set(e, t)), t;
  }
  st(e) {
    let t = this.qe.get(e);
    return t || (t = new SortedSet(__PRIVATE_primitiveComparator), this.qe = this.qe.insert(e, t)), t;
  }
  /**
   * Verifies that the user is still interested in this target (by calling
   * `getTargetDataForTarget()`) and that we are not waiting for pending ADDs
   * from watch.
   */
  ze(e) {
    const t = null !== this.Je(e);
    return t || __PRIVATE_logDebug("WatchChangeAggregator", "Detected inactive target", e), t;
  }
  /**
   * Returns the TargetData for an active target (i.e. a target that the user
   * is still interested in that has no outstanding target change requests).
   */
  Je(e) {
    const t = this.Be.get(e);
    return t && t.Se ? null : this.Le.ot(e);
  }
  /**
   * Resets the state of a Watch target to its initial state (e.g. sets
   * 'current' to false, clears the resume token and removes its target mapping
   * from all documents).
   */
  je(e) {
    this.Be.set(e, new __PRIVATE_TargetState());
    this.Le.getRemoteKeysForTarget(e).forEach((t) => {
      this.Ue(
        e,
        t,
        /*updatedDocument=*/
        null
      );
    });
  }
  /**
   * Returns whether the LocalStore considers the document to be part of the
   * specified target.
   */
  it(e, t) {
    return this.Le.getRemoteKeysForTarget(e).has(t);
  }
}
function __PRIVATE_documentTargetMap() {
  return new SortedMap(DocumentKey.comparator);
}
function __PRIVATE_snapshotChangesMap() {
  return new SortedMap(DocumentKey.comparator);
}
const Te = /* @__PURE__ */ (() => {
  const e = {
    asc: "ASCENDING",
    desc: "DESCENDING"
  };
  return e;
})(), Ee = /* @__PURE__ */ (() => {
  const e = {
    "<": "LESS_THAN",
    "<=": "LESS_THAN_OR_EQUAL",
    ">": "GREATER_THAN",
    ">=": "GREATER_THAN_OR_EQUAL",
    "==": "EQUAL",
    "!=": "NOT_EQUAL",
    "array-contains": "ARRAY_CONTAINS",
    in: "IN",
    "not-in": "NOT_IN",
    "array-contains-any": "ARRAY_CONTAINS_ANY"
  };
  return e;
})(), de = /* @__PURE__ */ (() => {
  const e = {
    and: "AND",
    or: "OR"
  };
  return e;
})();
class JsonProtoSerializer {
  constructor(e, t) {
    this.databaseId = e, this.useProto3Json = t;
  }
}
function __PRIVATE_toInt32Proto(e, t) {
  return e.useProto3Json || __PRIVATE_isNullOrUndefined(t) ? t : {
    value: t
  };
}
function toTimestamp(e, t) {
  if (e.useProto3Json) {
    return `${new Date(1e3 * t.seconds).toISOString().replace(/\.\d*/, "").replace("Z", "")}.${("000000000" + t.nanoseconds).slice(-9)}Z`;
  }
  return {
    seconds: "" + t.seconds,
    nanos: t.nanoseconds
  };
}
function __PRIVATE_toBytes(e, t) {
  return e.useProto3Json ? t.toBase64() : t.toUint8Array();
}
function __PRIVATE_fromVersion(e) {
  return __PRIVATE_hardAssert(!!e), SnapshotVersion.fromTimestamp(function fromTimestamp(e2) {
    const t = __PRIVATE_normalizeTimestamp(e2);
    return new Timestamp(t.seconds, t.nanos);
  }(e));
}
function __PRIVATE_toResourceName(e, t) {
  return __PRIVATE_toResourcePath(e, t).canonicalString();
}
function __PRIVATE_toResourcePath(e, t) {
  const n = function __PRIVATE_fullyQualifiedPrefixPath(e2) {
    return new ResourcePath(["projects", e2.projectId, "databases", e2.database]);
  }(e).child("documents");
  return void 0 === t ? n : n.child(t);
}
function __PRIVATE_fromResourceName(e) {
  const t = ResourcePath.fromString(e);
  return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(t)), t;
}
function fromName(e, t) {
  const n = __PRIVATE_fromResourceName(t);
  if (n.get(1) !== e.databaseId.projectId) throw new FirestoreError(D.INVALID_ARGUMENT, "Tried to deserialize key from different project: " + n.get(1) + " vs " + e.databaseId.projectId);
  if (n.get(3) !== e.databaseId.database) throw new FirestoreError(D.INVALID_ARGUMENT, "Tried to deserialize key from different database: " + n.get(3) + " vs " + e.databaseId.database);
  return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(n));
}
function __PRIVATE_toQueryPath(e, t) {
  return __PRIVATE_toResourceName(e.databaseId, t);
}
function __PRIVATE_fromQueryPath(e) {
  const t = __PRIVATE_fromResourceName(e);
  return 4 === t.length ? ResourcePath.emptyPath() : __PRIVATE_extractLocalPathFromResourceName(t);
}
function __PRIVATE_getEncodedDatabaseId(e) {
  return new ResourcePath(["projects", e.databaseId.projectId, "databases", e.databaseId.database]).canonicalString();
}
function __PRIVATE_extractLocalPathFromResourceName(e) {
  return __PRIVATE_hardAssert(e.length > 4 && "documents" === e.get(4)), e.popFirst(5);
}
function __PRIVATE_fromWatchChange(e, t) {
  let n;
  if ("targetChange" in t) {
    t.targetChange;
    const r = function __PRIVATE_fromWatchTargetChangeState(e2) {
      return "NO_CHANGE" === e2 ? 0 : "ADD" === e2 ? 1 : "REMOVE" === e2 ? 2 : "CURRENT" === e2 ? 3 : "RESET" === e2 ? 4 : fail();
    }(t.targetChange.targetChangeType || "NO_CHANGE"), i = t.targetChange.targetIds || [], s = function __PRIVATE_fromBytes(e2, t2) {
      return e2.useProto3Json ? (__PRIVATE_hardAssert(void 0 === t2 || "string" == typeof t2), ByteString.fromBase64String(t2 || "")) : (__PRIVATE_hardAssert(void 0 === t2 || // Check if the value is an instance of both Buffer and Uint8Array,
      // despite the fact that Buffer extends Uint8Array. In some
      // environments, such as jsdom, the prototype chain of Buffer
      // does not indicate that it extends Uint8Array.
      t2 instanceof Buffer || t2 instanceof Uint8Array), ByteString.fromUint8Array(t2 || new Uint8Array()));
    }(e, t.targetChange.resumeToken), o = t.targetChange.cause, _ = o && function __PRIVATE_fromRpcStatus(e2) {
      const t2 = void 0 === e2.code ? D.UNKNOWN : __PRIVATE_mapCodeFromRpcCode(e2.code);
      return new FirestoreError(t2, e2.message || "");
    }(o);
    n = new __PRIVATE_WatchTargetChange(r, i, s, _ || null);
  } else if ("documentChange" in t) {
    t.documentChange;
    const r = t.documentChange;
    r.document, r.document.name, r.document.updateTime;
    const i = fromName(e, r.document.name), s = __PRIVATE_fromVersion(r.document.updateTime), o = r.document.createTime ? __PRIVATE_fromVersion(r.document.createTime) : SnapshotVersion.min(), _ = new ObjectValue({
      mapValue: {
        fields: r.document.fields
      }
    }), a = MutableDocument.newFoundDocument(i, s, o, _), u = r.targetIds || [], c = r.removedTargetIds || [];
    n = new __PRIVATE_DocumentWatchChange(u, c, a.key, a);
  } else if ("documentDelete" in t) {
    t.documentDelete;
    const r = t.documentDelete;
    r.document;
    const i = fromName(e, r.document), s = r.readTime ? __PRIVATE_fromVersion(r.readTime) : SnapshotVersion.min(), o = MutableDocument.newNoDocument(i, s), _ = r.removedTargetIds || [];
    n = new __PRIVATE_DocumentWatchChange([], _, o.key, o);
  } else if ("documentRemove" in t) {
    t.documentRemove;
    const r = t.documentRemove;
    r.document;
    const i = fromName(e, r.document), s = r.removedTargetIds || [];
    n = new __PRIVATE_DocumentWatchChange([], s, i, null);
  } else {
    if (!("filter" in t)) return fail();
    {
      t.filter;
      const e2 = t.filter;
      e2.targetId;
      const { count: r = 0, unchangedNames: i } = e2, s = new ExistenceFilter(r, i), o = e2.targetId;
      n = new __PRIVATE_ExistenceFilterChange(o, s);
    }
  }
  return n;
}
function __PRIVATE_toDocumentsTarget(e, t) {
  return {
    documents: [__PRIVATE_toQueryPath(e, t.path)]
  };
}
function __PRIVATE_toQueryTarget(e, t) {
  const n = {
    structuredQuery: {}
  }, r = t.path;
  let i;
  null !== t.collectionGroup ? (i = r, n.structuredQuery.from = [{
    collectionId: t.collectionGroup,
    allDescendants: true
  }]) : (i = r.popLast(), n.structuredQuery.from = [{
    collectionId: r.lastSegment()
  }]), n.parent = __PRIVATE_toQueryPath(e, i);
  const s = function __PRIVATE_toFilters(e2) {
    if (0 === e2.length) return;
    return __PRIVATE_toFilter(CompositeFilter.create(
      e2,
      "and"
      /* CompositeOperator.AND */
    ));
  }(t.filters);
  s && (n.structuredQuery.where = s);
  const o = function __PRIVATE_toOrder(e2) {
    if (0 === e2.length) return;
    return e2.map((e3) => (
      // visible for testing
      function __PRIVATE_toPropertyOrder(e4) {
        return {
          field: __PRIVATE_toFieldPathReference(e4.field),
          direction: __PRIVATE_toDirection(e4.dir)
        };
      }(e3)
    ));
  }(t.orderBy);
  o && (n.structuredQuery.orderBy = o);
  const _ = __PRIVATE_toInt32Proto(e, t.limit);
  return null !== _ && (n.structuredQuery.limit = _), t.startAt && (n.structuredQuery.startAt = function __PRIVATE_toStartAtCursor(e2) {
    return {
      before: e2.inclusive,
      values: e2.position
    };
  }(t.startAt)), t.endAt && (n.structuredQuery.endAt = function __PRIVATE_toEndAtCursor(e2) {
    return {
      before: !e2.inclusive,
      values: e2.position
    };
  }(t.endAt)), {
    _t: n,
    parent: i
  };
}
function __PRIVATE_convertQueryTargetToQuery(e) {
  let t = __PRIVATE_fromQueryPath(e.parent);
  const n = e.structuredQuery, r = n.from ? n.from.length : 0;
  let i = null;
  if (r > 0) {
    __PRIVATE_hardAssert(1 === r);
    const e2 = n.from[0];
    e2.allDescendants ? i = e2.collectionId : t = t.child(e2.collectionId);
  }
  let s = [];
  n.where && (s = function __PRIVATE_fromFilters(e2) {
    const t2 = __PRIVATE_fromFilter(e2);
    if (t2 instanceof CompositeFilter && __PRIVATE_compositeFilterIsFlatConjunction(t2)) return t2.getFilters();
    return [t2];
  }(n.where));
  let o = [];
  n.orderBy && (o = function __PRIVATE_fromOrder(e2) {
    return e2.map((e3) => function __PRIVATE_fromPropertyOrder(e4) {
      return new OrderBy(
        __PRIVATE_fromFieldPathReference(e4.field),
        // visible for testing
        function __PRIVATE_fromDirection(e5) {
          switch (e5) {
            case "ASCENDING":
              return "asc";
            case "DESCENDING":
              return "desc";
            default:
              return;
          }
        }(e4.direction)
      );
    }(e3));
  }(n.orderBy));
  let _ = null;
  n.limit && (_ = function __PRIVATE_fromInt32Proto(e2) {
    let t2;
    return t2 = "object" == typeof e2 ? e2.value : e2, __PRIVATE_isNullOrUndefined(t2) ? null : t2;
  }(n.limit));
  let a = null;
  n.startAt && (a = function __PRIVATE_fromStartAtCursor(e2) {
    const t2 = !!e2.before, n2 = e2.values || [];
    return new Bound(n2, t2);
  }(n.startAt));
  let u = null;
  return n.endAt && (u = function __PRIVATE_fromEndAtCursor(e2) {
    const t2 = !e2.before, n2 = e2.values || [];
    return new Bound(n2, t2);
  }(n.endAt)), __PRIVATE_newQuery(t, i, o, s, _, "F", a, u);
}
function __PRIVATE_toListenRequestLabels(e, t) {
  const n = function __PRIVATE_toLabel(e2) {
    switch (e2) {
      case "TargetPurposeListen":
        return null;
      case "TargetPurposeExistenceFilterMismatch":
        return "existence-filter-mismatch";
      case "TargetPurposeExistenceFilterMismatchBloom":
        return "existence-filter-mismatch-bloom";
      case "TargetPurposeLimboResolution":
        return "limbo-document";
      default:
        return fail();
    }
  }(t.purpose);
  return null == n ? null : {
    "goog-listen-tags": n
  };
}
function __PRIVATE_fromFilter(e) {
  return void 0 !== e.unaryFilter ? function __PRIVATE_fromUnaryFilter(e2) {
    switch (e2.unaryFilter.op) {
      case "IS_NAN":
        const t = __PRIVATE_fromFieldPathReference(e2.unaryFilter.field);
        return FieldFilter.create(t, "==", {
          doubleValue: NaN
        });
      case "IS_NULL":
        const n = __PRIVATE_fromFieldPathReference(e2.unaryFilter.field);
        return FieldFilter.create(n, "==", {
          nullValue: "NULL_VALUE"
        });
      case "IS_NOT_NAN":
        const r = __PRIVATE_fromFieldPathReference(e2.unaryFilter.field);
        return FieldFilter.create(r, "!=", {
          doubleValue: NaN
        });
      case "IS_NOT_NULL":
        const i = __PRIVATE_fromFieldPathReference(e2.unaryFilter.field);
        return FieldFilter.create(i, "!=", {
          nullValue: "NULL_VALUE"
        });
      default:
        return fail();
    }
  }(e) : void 0 !== e.fieldFilter ? function __PRIVATE_fromFieldFilter(e2) {
    return FieldFilter.create(__PRIVATE_fromFieldPathReference(e2.fieldFilter.field), function __PRIVATE_fromOperatorName(e3) {
      switch (e3) {
        case "EQUAL":
          return "==";
        case "NOT_EQUAL":
          return "!=";
        case "GREATER_THAN":
          return ">";
        case "GREATER_THAN_OR_EQUAL":
          return ">=";
        case "LESS_THAN":
          return "<";
        case "LESS_THAN_OR_EQUAL":
          return "<=";
        case "ARRAY_CONTAINS":
          return "array-contains";
        case "IN":
          return "in";
        case "NOT_IN":
          return "not-in";
        case "ARRAY_CONTAINS_ANY":
          return "array-contains-any";
        default:
          return fail();
      }
    }(e2.fieldFilter.op), e2.fieldFilter.value);
  }(e) : void 0 !== e.compositeFilter ? function __PRIVATE_fromCompositeFilter(e2) {
    return CompositeFilter.create(e2.compositeFilter.filters.map((e3) => __PRIVATE_fromFilter(e3)), function __PRIVATE_fromCompositeOperatorName(e3) {
      switch (e3) {
        case "AND":
          return "and";
        case "OR":
          return "or";
        default:
          return fail();
      }
    }(e2.compositeFilter.op));
  }(e) : fail();
}
function __PRIVATE_toDirection(e) {
  return Te[e];
}
function __PRIVATE_toOperatorName(e) {
  return Ee[e];
}
function __PRIVATE_toCompositeOperatorName(e) {
  return de[e];
}
function __PRIVATE_toFieldPathReference(e) {
  return {
    fieldPath: e.canonicalString()
  };
}
function __PRIVATE_fromFieldPathReference(e) {
  return FieldPath$1.fromServerFormat(e.fieldPath);
}
function __PRIVATE_toFilter(e) {
  return e instanceof FieldFilter ? function __PRIVATE_toUnaryOrFieldFilter(e2) {
    if ("==" === e2.op) {
      if (__PRIVATE_isNanValue(e2.value)) return {
        unaryFilter: {
          field: __PRIVATE_toFieldPathReference(e2.field),
          op: "IS_NAN"
        }
      };
      if (__PRIVATE_isNullValue(e2.value)) return {
        unaryFilter: {
          field: __PRIVATE_toFieldPathReference(e2.field),
          op: "IS_NULL"
        }
      };
    } else if ("!=" === e2.op) {
      if (__PRIVATE_isNanValue(e2.value)) return {
        unaryFilter: {
          field: __PRIVATE_toFieldPathReference(e2.field),
          op: "IS_NOT_NAN"
        }
      };
      if (__PRIVATE_isNullValue(e2.value)) return {
        unaryFilter: {
          field: __PRIVATE_toFieldPathReference(e2.field),
          op: "IS_NOT_NULL"
        }
      };
    }
    return {
      fieldFilter: {
        field: __PRIVATE_toFieldPathReference(e2.field),
        op: __PRIVATE_toOperatorName(e2.op),
        value: e2.value
      }
    };
  }(e) : e instanceof CompositeFilter ? function __PRIVATE_toCompositeFilter(e2) {
    const t = e2.getFilters().map((e3) => __PRIVATE_toFilter(e3));
    if (1 === t.length) return t[0];
    return {
      compositeFilter: {
        op: __PRIVATE_toCompositeOperatorName(e2.op),
        filters: t
      }
    };
  }(e) : fail();
}
function __PRIVATE_isValidResourceName(e) {
  return e.length >= 4 && "projects" === e.get(0) && "databases" === e.get(2);
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class TargetData {
  constructor(e, t, n, r, i = SnapshotVersion.min(), s = SnapshotVersion.min(), o = ByteString.EMPTY_BYTE_STRING, _ = null) {
    this.target = e, this.targetId = t, this.purpose = n, this.sequenceNumber = r, this.snapshotVersion = i, this.lastLimboFreeSnapshotVersion = s, this.resumeToken = o, this.expectedCount = _;
  }
  /** Creates a new target data instance with an updated sequence number. */
  withSequenceNumber(e) {
    return new TargetData(this.target, this.targetId, this.purpose, e, this.snapshotVersion, this.lastLimboFreeSnapshotVersion, this.resumeToken, this.expectedCount);
  }
  /**
   * Creates a new target data instance with an updated resume token and
   * snapshot version.
   */
  withResumeToken(e, t) {
    return new TargetData(
      this.target,
      this.targetId,
      this.purpose,
      this.sequenceNumber,
      t,
      this.lastLimboFreeSnapshotVersion,
      e,
      /* expectedCount= */
      null
    );
  }
  /**
   * Creates a new target data instance with an updated expected count.
   */
  withExpectedCount(e) {
    return new TargetData(this.target, this.targetId, this.purpose, this.sequenceNumber, this.snapshotVersion, this.lastLimboFreeSnapshotVersion, this.resumeToken, e);
  }
  /**
   * Creates a new target data instance with an updated last limbo free
   * snapshot version number.
   */
  withLastLimboFreeSnapshotVersion(e) {
    return new TargetData(this.target, this.targetId, this.purpose, this.sequenceNumber, this.snapshotVersion, e, this.resumeToken, this.expectedCount);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_LocalSerializer {
  constructor(e) {
    this.ct = e;
  }
}
function __PRIVATE_fromBundledQuery(e) {
  const t = __PRIVATE_convertQueryTargetToQuery({
    parent: e.parent,
    structuredQuery: e.structuredQuery
  });
  return "LAST" === e.limitType ? __PRIVATE_queryWithLimit(
    t,
    t.limit,
    "L"
    /* LimitType.Last */
  ) : t;
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryIndexManager {
  constructor() {
    this.un = new __PRIVATE_MemoryCollectionParentIndex();
  }
  addToCollectionParentIndex(e, t) {
    return this.un.add(t), PersistencePromise.resolve();
  }
  getCollectionParents(e, t) {
    return PersistencePromise.resolve(this.un.getEntries(t));
  }
  addFieldIndex(e, t) {
    return PersistencePromise.resolve();
  }
  deleteFieldIndex(e, t) {
    return PersistencePromise.resolve();
  }
  deleteAllFieldIndexes(e) {
    return PersistencePromise.resolve();
  }
  createTargetIndexes(e, t) {
    return PersistencePromise.resolve();
  }
  getDocumentsMatchingTarget(e, t) {
    return PersistencePromise.resolve(null);
  }
  getIndexType(e, t) {
    return PersistencePromise.resolve(
      0
      /* IndexType.NONE */
    );
  }
  getFieldIndexes(e, t) {
    return PersistencePromise.resolve([]);
  }
  getNextCollectionGroupToUpdate(e) {
    return PersistencePromise.resolve(null);
  }
  getMinOffset(e, t) {
    return PersistencePromise.resolve(IndexOffset.min());
  }
  getMinOffsetFromCollectionGroup(e, t) {
    return PersistencePromise.resolve(IndexOffset.min());
  }
  updateCollectionGroup(e, t, n) {
    return PersistencePromise.resolve();
  }
  updateIndexEntries(e, t) {
    return PersistencePromise.resolve();
  }
}
class __PRIVATE_MemoryCollectionParentIndex {
  constructor() {
    this.index = {};
  }
  // Returns false if the entry already existed.
  add(e) {
    const t = e.lastSegment(), n = e.popLast(), r = this.index[t] || new SortedSet(ResourcePath.comparator), i = !r.has(n);
    return this.index[t] = r.add(n), i;
  }
  has(e) {
    const t = e.lastSegment(), n = e.popLast(), r = this.index[t];
    return r && r.has(n);
  }
  getEntries(e) {
    return (this.index[e] || new SortedSet(ResourcePath.comparator)).toArray();
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_TargetIdGenerator {
  constructor(e) {
    this.Ln = e;
  }
  next() {
    return this.Ln += 2, this.Ln;
  }
  static Bn() {
    return new __PRIVATE_TargetIdGenerator(0);
  }
  static kn() {
    return new __PRIVATE_TargetIdGenerator(-1);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class RemoteDocumentChangeBuffer {
  constructor() {
    this.changes = new ObjectMap((e) => e.toString(), (e, t) => e.isEqual(t)), this.changesApplied = false;
  }
  /**
   * Buffers a `RemoteDocumentCache.addEntry()` call.
   *
   * You can only modify documents that have already been retrieved via
   * `getEntry()/getEntries()` (enforced via IndexedDbs `apply()`).
   */
  addEntry(e) {
    this.assertNotApplied(), this.changes.set(e.key, e);
  }
  /**
   * Buffers a `RemoteDocumentCache.removeEntry()` call.
   *
   * You can only remove documents that have already been retrieved via
   * `getEntry()/getEntries()` (enforced via IndexedDbs `apply()`).
   */
  removeEntry(e, t) {
    this.assertNotApplied(), this.changes.set(e, MutableDocument.newInvalidDocument(e).setReadTime(t));
  }
  /**
   * Looks up an entry in the cache. The buffered changes will first be checked,
   * and if no buffered change applies, this will forward to
   * `RemoteDocumentCache.getEntry()`.
   *
   * @param transaction - The transaction in which to perform any persistence
   *     operations.
   * @param documentKey - The key of the entry to look up.
   * @returns The cached document or an invalid document if we have nothing
   * cached.
   */
  getEntry(e, t) {
    this.assertNotApplied();
    const n = this.changes.get(t);
    return void 0 !== n ? PersistencePromise.resolve(n) : this.getFromCache(e, t);
  }
  /**
   * Looks up several entries in the cache, forwarding to
   * `RemoteDocumentCache.getEntry()`.
   *
   * @param transaction - The transaction in which to perform any persistence
   *     operations.
   * @param documentKeys - The keys of the entries to look up.
   * @returns A map of cached documents, indexed by key. If an entry cannot be
   *     found, the corresponding key will be mapped to an invalid document.
   */
  getEntries(e, t) {
    return this.getAllFromCache(e, t);
  }
  /**
   * Applies buffered changes to the underlying RemoteDocumentCache, using
   * the provided transaction.
   */
  apply(e) {
    return this.assertNotApplied(), this.changesApplied = true, this.applyChanges(e);
  }
  /** Helper to assert this.changes is not null  */
  assertNotApplied() {
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class OverlayedDocument {
  constructor(e, t) {
    this.overlayedDocument = e, this.mutatedFields = t;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class LocalDocumentsView {
  constructor(e, t, n, r) {
    this.remoteDocumentCache = e, this.mutationQueue = t, this.documentOverlayCache = n, this.indexManager = r;
  }
  /**
   * Get the local view of the document identified by `key`.
   *
   * @returns Local view of the document or null if we don't have any cached
   * state for it.
   */
  getDocument(e, t) {
    let n = null;
    return this.documentOverlayCache.getOverlay(e, t).next((r) => (n = r, this.remoteDocumentCache.getEntry(e, t))).next((e2) => (null !== n && __PRIVATE_mutationApplyToLocalView(n.mutation, e2, FieldMask.empty(), Timestamp.now()), e2));
  }
  /**
   * Gets the local view of the documents identified by `keys`.
   *
   * If we don't have cached state for a document in `keys`, a NoDocument will
   * be stored for that key in the resulting set.
   */
  getDocuments(e, t) {
    return this.remoteDocumentCache.getEntries(e, t).next((t2) => this.getLocalViewOfDocuments(e, t2, __PRIVATE_documentKeySet()).next(() => t2));
  }
  /**
   * Similar to `getDocuments`, but creates the local view from the given
   * `baseDocs` without retrieving documents from the local store.
   *
   * @param transaction - The transaction this operation is scoped to.
   * @param docs - The documents to apply local mutations to get the local views.
   * @param existenceStateChanged - The set of document keys whose existence state
   *   is changed. This is useful to determine if some documents overlay needs
   *   to be recalculated.
   */
  getLocalViewOfDocuments(e, t, n = __PRIVATE_documentKeySet()) {
    const r = __PRIVATE_newOverlayMap();
    return this.populateOverlays(e, r, t).next(() => this.computeViews(e, t, r, n).next((e2) => {
      let t2 = documentMap();
      return e2.forEach((e3, n2) => {
        t2 = t2.insert(e3, n2.overlayedDocument);
      }), t2;
    }));
  }
  /**
   * Gets the overlayed documents for the given document map, which will include
   * the local view of those documents and a `FieldMask` indicating which fields
   * are mutated locally, `null` if overlay is a Set or Delete mutation.
   */
  getOverlayedDocuments(e, t) {
    const n = __PRIVATE_newOverlayMap();
    return this.populateOverlays(e, n, t).next(() => this.computeViews(e, t, n, __PRIVATE_documentKeySet()));
  }
  /**
   * Fetches the overlays for {@code docs} and adds them to provided overlay map
   * if the map does not already contain an entry for the given document key.
   */
  populateOverlays(e, t, n) {
    const r = [];
    return n.forEach((e2) => {
      t.has(e2) || r.push(e2);
    }), this.documentOverlayCache.getOverlays(e, r).next((e2) => {
      e2.forEach((e3, n2) => {
        t.set(e3, n2);
      });
    });
  }
  /**
   * Computes the local view for the given documents.
   *
   * @param docs - The documents to compute views for. It also has the base
   *   version of the documents.
   * @param overlays - The overlays that need to be applied to the given base
   *   version of the documents.
   * @param existenceStateChanged - A set of documents whose existence states
   *   might have changed. This is used to determine if we need to re-calculate
   *   overlays from mutation queues.
   * @return A map represents the local documents view.
   */
  computeViews(e, t, n, r) {
    let i = __PRIVATE_mutableDocumentMap();
    const s = __PRIVATE_newDocumentKeyMap(), o = function __PRIVATE_newOverlayedDocumentMap() {
      return __PRIVATE_newDocumentKeyMap();
    }();
    return t.forEach((e2, t2) => {
      const o2 = n.get(t2.key);
      r.has(t2.key) && (void 0 === o2 || o2.mutation instanceof __PRIVATE_PatchMutation) ? i = i.insert(t2.key, t2) : void 0 !== o2 ? (s.set(t2.key, o2.mutation.getFieldMask()), __PRIVATE_mutationApplyToLocalView(o2.mutation, t2, o2.mutation.getFieldMask(), Timestamp.now())) : (
        // no overlay exists
        // Using EMPTY to indicate there is no overlay for the document.
        s.set(t2.key, FieldMask.empty())
      );
    }), this.recalculateAndSaveOverlays(e, i).next((e2) => (e2.forEach((e3, t2) => s.set(e3, t2)), t.forEach((e3, t2) => {
      var n2;
      return o.set(e3, new OverlayedDocument(t2, null !== (n2 = s.get(e3)) && void 0 !== n2 ? n2 : null));
    }), o));
  }
  recalculateAndSaveOverlays(e, t) {
    const n = __PRIVATE_newDocumentKeyMap();
    let r = new SortedMap((e2, t2) => e2 - t2), i = __PRIVATE_documentKeySet();
    return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e, t).next((e2) => {
      for (const i2 of e2) i2.keys().forEach((e3) => {
        const s = t.get(e3);
        if (null === s) return;
        let o = n.get(e3) || FieldMask.empty();
        o = i2.applyToLocalView(s, o), n.set(e3, o);
        const _ = (r.get(i2.batchId) || __PRIVATE_documentKeySet()).add(e3);
        r = r.insert(i2.batchId, _);
      });
    }).next(() => {
      const s = [], o = r.getReverseIterator();
      for (; o.hasNext(); ) {
        const r2 = o.getNext(), _ = r2.key, a = r2.value, u = __PRIVATE_newMutationMap();
        a.forEach((e2) => {
          if (!i.has(e2)) {
            const r3 = __PRIVATE_calculateOverlayMutation(t.get(e2), n.get(e2));
            null !== r3 && u.set(e2, r3), i = i.add(e2);
          }
        }), s.push(this.documentOverlayCache.saveOverlays(e, _, u));
      }
      return PersistencePromise.waitFor(s);
    }).next(() => n);
  }
  /**
   * Recalculates overlays by reading the documents from remote document cache
   * first, and saves them after they are calculated.
   */
  recalculateAndSaveOverlaysForDocumentKeys(e, t) {
    return this.remoteDocumentCache.getEntries(e, t).next((t2) => this.recalculateAndSaveOverlays(e, t2));
  }
  /**
   * Performs a query against the local view of all documents.
   *
   * @param transaction - The persistence transaction.
   * @param query - The query to match documents against.
   * @param offset - Read time and key to start scanning by (exclusive).
   * @param context - A optional tracker to keep a record of important details
   *   during database local query execution.
   */
  getDocumentsMatchingQuery(e, t, n, r) {
    return function __PRIVATE_isDocumentQuery$1(e2) {
      return DocumentKey.isDocumentKey(e2.path) && null === e2.collectionGroup && 0 === e2.filters.length;
    }(t) ? this.getDocumentsMatchingDocumentQuery(e, t.path) : __PRIVATE_isCollectionGroupQuery(t) ? this.getDocumentsMatchingCollectionGroupQuery(e, t, n, r) : this.getDocumentsMatchingCollectionQuery(e, t, n, r);
  }
  /**
   * Given a collection group, returns the next documents that follow the provided offset, along
   * with an updated batch ID.
   *
   * <p>The documents returned by this method are ordered by remote version from the provided
   * offset. If there are no more remote documents after the provided offset, documents with
   * mutations in order of batch id from the offset are returned. Since all documents in a batch are
   * returned together, the total number of documents returned can exceed {@code count}.
   *
   * @param transaction
   * @param collectionGroup The collection group for the documents.
   * @param offset The offset to index into.
   * @param count The number of documents to return
   * @return A LocalWriteResult with the documents that follow the provided offset and the last processed batch id.
   */
  getNextDocuments(e, t, n, r) {
    return this.remoteDocumentCache.getAllFromCollectionGroup(e, t, n, r).next((i) => {
      const s = r - i.size > 0 ? this.documentOverlayCache.getOverlaysForCollectionGroup(e, t, n.largestBatchId, r - i.size) : PersistencePromise.resolve(__PRIVATE_newOverlayMap());
      let o = -1, _ = i;
      return s.next((t2) => PersistencePromise.forEach(t2, (t3, n2) => (o < n2.largestBatchId && (o = n2.largestBatchId), i.get(t3) ? PersistencePromise.resolve() : this.remoteDocumentCache.getEntry(e, t3).next((e2) => {
        _ = _.insert(t3, e2);
      }))).next(() => this.populateOverlays(e, t2, i)).next(() => this.computeViews(e, _, t2, __PRIVATE_documentKeySet())).next((e2) => ({
        batchId: o,
        changes: __PRIVATE_convertOverlayedDocumentMapToDocumentMap(e2)
      })));
    });
  }
  getDocumentsMatchingDocumentQuery(e, t) {
    return this.getDocument(e, new DocumentKey(t)).next((e2) => {
      let t2 = documentMap();
      return e2.isFoundDocument() && (t2 = t2.insert(e2.key, e2)), t2;
    });
  }
  getDocumentsMatchingCollectionGroupQuery(e, t, n, r) {
    const i = t.collectionGroup;
    let s = documentMap();
    return this.indexManager.getCollectionParents(e, i).next((o) => PersistencePromise.forEach(o, (o2) => {
      const _ = function __PRIVATE_asCollectionQueryAtPath(e2, t2) {
        return new __PRIVATE_QueryImpl(
          t2,
          /*collectionGroup=*/
          null,
          e2.explicitOrderBy.slice(),
          e2.filters.slice(),
          e2.limit,
          e2.limitType,
          e2.startAt,
          e2.endAt
        );
      }(t, o2.child(i));
      return this.getDocumentsMatchingCollectionQuery(e, _, n, r).next((e2) => {
        e2.forEach((e3, t2) => {
          s = s.insert(e3, t2);
        });
      });
    }).next(() => s));
  }
  getDocumentsMatchingCollectionQuery(e, t, n, r) {
    let i;
    return this.documentOverlayCache.getOverlaysForCollection(e, t.path, n.largestBatchId).next((s) => (i = s, this.remoteDocumentCache.getDocumentsMatchingQuery(e, t, n, i, r))).next((e2) => {
      i.forEach((t2, n3) => {
        const r2 = n3.getKey();
        null === e2.get(r2) && (e2 = e2.insert(r2, MutableDocument.newInvalidDocument(r2)));
      });
      let n2 = documentMap();
      return e2.forEach((e3, r2) => {
        const s = i.get(e3);
        void 0 !== s && __PRIVATE_mutationApplyToLocalView(s.mutation, r2, FieldMask.empty(), Timestamp.now()), // Finally, insert the documents that still match the query
        __PRIVATE_queryMatches(t, r2) && (n2 = n2.insert(e3, r2));
      }), n2;
    });
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryBundleCache {
  constructor(e) {
    this.serializer = e, this.hr = /* @__PURE__ */ new Map(), this.Pr = /* @__PURE__ */ new Map();
  }
  getBundleMetadata(e, t) {
    return PersistencePromise.resolve(this.hr.get(t));
  }
  saveBundleMetadata(e, t) {
    return this.hr.set(
      t.id,
      /** Decodes a BundleMetadata proto into a BundleMetadata object. */
      function __PRIVATE_fromBundleMetadata(e2) {
        return {
          id: e2.id,
          version: e2.version,
          createTime: __PRIVATE_fromVersion(e2.createTime)
        };
      }(t)
    ), PersistencePromise.resolve();
  }
  getNamedQuery(e, t) {
    return PersistencePromise.resolve(this.Pr.get(t));
  }
  saveNamedQuery(e, t) {
    return this.Pr.set(t.name, function __PRIVATE_fromProtoNamedQuery(e2) {
      return {
        name: e2.name,
        query: __PRIVATE_fromBundledQuery(e2.bundledQuery),
        readTime: __PRIVATE_fromVersion(e2.readTime)
      };
    }(t)), PersistencePromise.resolve();
  }
}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryDocumentOverlayCache {
  constructor() {
    this.overlays = new SortedMap(DocumentKey.comparator), this.Ir = /* @__PURE__ */ new Map();
  }
  getOverlay(e, t) {
    return PersistencePromise.resolve(this.overlays.get(t));
  }
  getOverlays(e, t) {
    const n = __PRIVATE_newOverlayMap();
    return PersistencePromise.forEach(t, (t2) => this.getOverlay(e, t2).next((e2) => {
      null !== e2 && n.set(t2, e2);
    })).next(() => n);
  }
  saveOverlays(e, t, n) {
    return n.forEach((n2, r) => {
      this.ht(e, t, r);
    }), PersistencePromise.resolve();
  }
  removeOverlaysForBatchId(e, t, n) {
    const r = this.Ir.get(n);
    return void 0 !== r && (r.forEach((e2) => this.overlays = this.overlays.remove(e2)), this.Ir.delete(n)), PersistencePromise.resolve();
  }
  getOverlaysForCollection(e, t, n) {
    const r = __PRIVATE_newOverlayMap(), i = t.length + 1, s = new DocumentKey(t.child("")), o = this.overlays.getIteratorFrom(s);
    for (; o.hasNext(); ) {
      const e2 = o.getNext().value, s2 = e2.getKey();
      if (!t.isPrefixOf(s2.path)) break;
      s2.path.length === i && (e2.largestBatchId > n && r.set(e2.getKey(), e2));
    }
    return PersistencePromise.resolve(r);
  }
  getOverlaysForCollectionGroup(e, t, n, r) {
    let i = new SortedMap((e2, t2) => e2 - t2);
    const s = this.overlays.getIterator();
    for (; s.hasNext(); ) {
      const e2 = s.getNext().value;
      if (e2.getKey().getCollectionGroup() === t && e2.largestBatchId > n) {
        let t2 = i.get(e2.largestBatchId);
        null === t2 && (t2 = __PRIVATE_newOverlayMap(), i = i.insert(e2.largestBatchId, t2)), t2.set(e2.getKey(), e2);
      }
    }
    const o = __PRIVATE_newOverlayMap(), _ = i.getIterator();
    for (; _.hasNext(); ) {
      if (_.getNext().value.forEach((e2, t2) => o.set(e2, t2)), o.size() >= r) break;
    }
    return PersistencePromise.resolve(o);
  }
  ht(e, t, n) {
    const r = this.overlays.get(n.key);
    if (null !== r) {
      const e2 = this.Ir.get(r.largestBatchId).delete(n.key);
      this.Ir.set(r.largestBatchId, e2);
    }
    this.overlays = this.overlays.insert(n.key, new Overlay(t, n));
    let i = this.Ir.get(t);
    void 0 === i && (i = __PRIVATE_documentKeySet(), this.Ir.set(t, i)), this.Ir.set(t, i.add(n.key));
  }
}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryGlobalsCache {
  constructor() {
    this.sessionToken = ByteString.EMPTY_BYTE_STRING;
  }
  getSessionToken(e) {
    return PersistencePromise.resolve(this.sessionToken);
  }
  setSessionToken(e, t) {
    return this.sessionToken = t, PersistencePromise.resolve();
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_ReferenceSet {
  constructor() {
    this.Tr = new SortedSet(__PRIVATE_DocReference.Er), // A set of outstanding references to a document sorted by target id.
    this.dr = new SortedSet(__PRIVATE_DocReference.Ar);
  }
  /** Returns true if the reference set contains no references. */
  isEmpty() {
    return this.Tr.isEmpty();
  }
  /** Adds a reference to the given document key for the given ID. */
  addReference(e, t) {
    const n = new __PRIVATE_DocReference(e, t);
    this.Tr = this.Tr.add(n), this.dr = this.dr.add(n);
  }
  /** Add references to the given document keys for the given ID. */
  Rr(e, t) {
    e.forEach((e2) => this.addReference(e2, t));
  }
  /**
   * Removes a reference to the given document key for the given
   * ID.
   */
  removeReference(e, t) {
    this.Vr(new __PRIVATE_DocReference(e, t));
  }
  mr(e, t) {
    e.forEach((e2) => this.removeReference(e2, t));
  }
  /**
   * Clears all references with a given ID. Calls removeRef() for each key
   * removed.
   */
  gr(e) {
    const t = new DocumentKey(new ResourcePath([])), n = new __PRIVATE_DocReference(t, e), r = new __PRIVATE_DocReference(t, e + 1), i = [];
    return this.dr.forEachInRange([n, r], (e2) => {
      this.Vr(e2), i.push(e2.key);
    }), i;
  }
  pr() {
    this.Tr.forEach((e) => this.Vr(e));
  }
  Vr(e) {
    this.Tr = this.Tr.delete(e), this.dr = this.dr.delete(e);
  }
  yr(e) {
    const t = new DocumentKey(new ResourcePath([])), n = new __PRIVATE_DocReference(t, e), r = new __PRIVATE_DocReference(t, e + 1);
    let i = __PRIVATE_documentKeySet();
    return this.dr.forEachInRange([n, r], (e2) => {
      i = i.add(e2.key);
    }), i;
  }
  containsKey(e) {
    const t = new __PRIVATE_DocReference(e, 0), n = this.Tr.firstAfterOrEqual(t);
    return null !== n && e.isEqual(n.key);
  }
}
class __PRIVATE_DocReference {
  constructor(e, t) {
    this.key = e, this.wr = t;
  }
  /** Compare by key then by ID */
  static Er(e, t) {
    return DocumentKey.comparator(e.key, t.key) || __PRIVATE_primitiveComparator(e.wr, t.wr);
  }
  /** Compare by ID then by key */
  static Ar(e, t) {
    return __PRIVATE_primitiveComparator(e.wr, t.wr) || DocumentKey.comparator(e.key, t.key);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryMutationQueue {
  constructor(e, t) {
    this.indexManager = e, this.referenceDelegate = t, /**
     * The set of all mutations that have been sent but not yet been applied to
     * the backend.
     */
    this.mutationQueue = [], /** Next value to use when assigning sequential IDs to each mutation batch. */
    this.Sr = 1, /** An ordered mapping between documents and the mutations batch IDs. */
    this.br = new SortedSet(__PRIVATE_DocReference.Er);
  }
  checkEmpty(e) {
    return PersistencePromise.resolve(0 === this.mutationQueue.length);
  }
  addMutationBatch(e, t, n, r) {
    const i = this.Sr;
    this.Sr++, this.mutationQueue.length > 0 && this.mutationQueue[this.mutationQueue.length - 1];
    const s = new MutationBatch(i, t, n, r);
    this.mutationQueue.push(s);
    for (const t2 of r) this.br = this.br.add(new __PRIVATE_DocReference(t2.key, i)), this.indexManager.addToCollectionParentIndex(e, t2.key.path.popLast());
    return PersistencePromise.resolve(s);
  }
  lookupMutationBatch(e, t) {
    return PersistencePromise.resolve(this.Dr(t));
  }
  getNextMutationBatchAfterBatchId(e, t) {
    const n = t + 1, r = this.vr(n), i = r < 0 ? 0 : r;
    return PersistencePromise.resolve(this.mutationQueue.length > i ? this.mutationQueue[i] : null);
  }
  getHighestUnacknowledgedBatchId() {
    return PersistencePromise.resolve(0 === this.mutationQueue.length ? -1 : this.Sr - 1);
  }
  getAllMutationBatches(e) {
    return PersistencePromise.resolve(this.mutationQueue.slice());
  }
  getAllMutationBatchesAffectingDocumentKey(e, t) {
    const n = new __PRIVATE_DocReference(t, 0), r = new __PRIVATE_DocReference(t, Number.POSITIVE_INFINITY), i = [];
    return this.br.forEachInRange([n, r], (e2) => {
      const t2 = this.Dr(e2.wr);
      i.push(t2);
    }), PersistencePromise.resolve(i);
  }
  getAllMutationBatchesAffectingDocumentKeys(e, t) {
    let n = new SortedSet(__PRIVATE_primitiveComparator);
    return t.forEach((e2) => {
      const t2 = new __PRIVATE_DocReference(e2, 0), r = new __PRIVATE_DocReference(e2, Number.POSITIVE_INFINITY);
      this.br.forEachInRange([t2, r], (e3) => {
        n = n.add(e3.wr);
      });
    }), PersistencePromise.resolve(this.Cr(n));
  }
  getAllMutationBatchesAffectingQuery(e, t) {
    const n = t.path, r = n.length + 1;
    let i = n;
    DocumentKey.isDocumentKey(i) || (i = i.child(""));
    const s = new __PRIVATE_DocReference(new DocumentKey(i), 0);
    let o = new SortedSet(__PRIVATE_primitiveComparator);
    return this.br.forEachWhile((e2) => {
      const t2 = e2.key.path;
      return !!n.isPrefixOf(t2) && // Rows with document keys more than one segment longer than the query
      // path can't be matches. For example, a query on 'rooms' can't match
      // the document /rooms/abc/messages/xyx.
      // TODO(mcg): we'll need a different scanner when we implement
      // ancestor queries.
      (t2.length === r && (o = o.add(e2.wr)), true);
    }, s), PersistencePromise.resolve(this.Cr(o));
  }
  Cr(e) {
    const t = [];
    return e.forEach((e2) => {
      const n = this.Dr(e2);
      null !== n && t.push(n);
    }), t;
  }
  removeMutationBatch(e, t) {
    __PRIVATE_hardAssert(0 === this.Fr(t.batchId, "removed")), this.mutationQueue.shift();
    let n = this.br;
    return PersistencePromise.forEach(t.mutations, (r) => {
      const i = new __PRIVATE_DocReference(r.key, t.batchId);
      return n = n.delete(i), this.referenceDelegate.markPotentiallyOrphaned(e, r.key);
    }).next(() => {
      this.br = n;
    });
  }
  On(e) {
  }
  containsKey(e, t) {
    const n = new __PRIVATE_DocReference(t, 0), r = this.br.firstAfterOrEqual(n);
    return PersistencePromise.resolve(t.isEqual(r && r.key));
  }
  performConsistencyCheck(e) {
    return this.mutationQueue.length, PersistencePromise.resolve();
  }
  /**
   * Finds the index of the given batchId in the mutation queue and asserts that
   * the resulting index is within the bounds of the queue.
   *
   * @param batchId - The batchId to search for
   * @param action - A description of what the caller is doing, phrased in passive
   * form (e.g. "acknowledged" in a routine that acknowledges batches).
   */
  Fr(e, t) {
    return this.vr(e);
  }
  /**
   * Finds the index of the given batchId in the mutation queue. This operation
   * is O(1).
   *
   * @returns The computed index of the batch with the given batchId, based on
   * the state of the queue. Note this index can be negative if the requested
   * batchId has already been removed from the queue or past the end of the
   * queue if the batchId is larger than the last added batch.
   */
  vr(e) {
    if (0 === this.mutationQueue.length)
      return 0;
    return e - this.mutationQueue[0].batchId;
  }
  /**
   * A version of lookupMutationBatch that doesn't return a promise, this makes
   * other functions that uses this code easier to read and more efficient.
   */
  Dr(e) {
    const t = this.vr(e);
    if (t < 0 || t >= this.mutationQueue.length) return null;
    return this.mutationQueue[t];
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryRemoteDocumentCacheImpl {
  /**
   * @param sizer - Used to assess the size of a document. For eager GC, this is
   * expected to just return 0 to avoid unnecessarily doing the work of
   * calculating the size.
   */
  constructor(e) {
    this.Mr = e, /** Underlying cache of documents and their read times. */
    this.docs = function __PRIVATE_documentEntryMap() {
      return new SortedMap(DocumentKey.comparator);
    }(), /** Size of all cached documents. */
    this.size = 0;
  }
  setIndexManager(e) {
    this.indexManager = e;
  }
  /**
   * Adds the supplied entry to the cache and updates the cache size as appropriate.
   *
   * All calls of `addEntry`  are required to go through the RemoteDocumentChangeBuffer
   * returned by `newChangeBuffer()`.
   */
  addEntry(e, t) {
    const n = t.key, r = this.docs.get(n), i = r ? r.size : 0, s = this.Mr(t);
    return this.docs = this.docs.insert(n, {
      document: t.mutableCopy(),
      size: s
    }), this.size += s - i, this.indexManager.addToCollectionParentIndex(e, n.path.popLast());
  }
  /**
   * Removes the specified entry from the cache and updates the cache size as appropriate.
   *
   * All calls of `removeEntry` are required to go through the RemoteDocumentChangeBuffer
   * returned by `newChangeBuffer()`.
   */
  removeEntry(e) {
    const t = this.docs.get(e);
    t && (this.docs = this.docs.remove(e), this.size -= t.size);
  }
  getEntry(e, t) {
    const n = this.docs.get(t);
    return PersistencePromise.resolve(n ? n.document.mutableCopy() : MutableDocument.newInvalidDocument(t));
  }
  getEntries(e, t) {
    let n = __PRIVATE_mutableDocumentMap();
    return t.forEach((e2) => {
      const t2 = this.docs.get(e2);
      n = n.insert(e2, t2 ? t2.document.mutableCopy() : MutableDocument.newInvalidDocument(e2));
    }), PersistencePromise.resolve(n);
  }
  getDocumentsMatchingQuery(e, t, n, r) {
    let i = __PRIVATE_mutableDocumentMap();
    const s = t.path, o = new DocumentKey(s.child("")), _ = this.docs.getIteratorFrom(o);
    for (; _.hasNext(); ) {
      const { key: e2, value: { document: o2 } } = _.getNext();
      if (!s.isPrefixOf(e2.path)) break;
      e2.path.length > s.length + 1 || (__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument(o2), n) <= 0 || (r.has(o2.key) || __PRIVATE_queryMatches(t, o2)) && (i = i.insert(o2.key, o2.mutableCopy())));
    }
    return PersistencePromise.resolve(i);
  }
  getAllFromCollectionGroup(e, t, n, r) {
    fail();
  }
  Or(e, t) {
    return PersistencePromise.forEach(this.docs, (e2) => t(e2));
  }
  newChangeBuffer(e) {
    return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this);
  }
  getSize(e) {
    return PersistencePromise.resolve(this.size);
  }
}
class __PRIVATE_MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer {
  constructor(e) {
    super(), this.cr = e;
  }
  applyChanges(e) {
    const t = [];
    return this.changes.forEach((n, r) => {
      r.isValidDocument() ? t.push(this.cr.addEntry(e, r)) : this.cr.removeEntry(n);
    }), PersistencePromise.waitFor(t);
  }
  getFromCache(e, t) {
    return this.cr.getEntry(e, t);
  }
  getAllFromCache(e, t) {
    return this.cr.getEntries(e, t);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryTargetCache {
  constructor(e) {
    this.persistence = e, /**
     * Maps a target to the data about that target
     */
    this.Nr = new ObjectMap((e2) => __PRIVATE_canonifyTarget(e2), __PRIVATE_targetEquals), /** The last received snapshot version. */
    this.lastRemoteSnapshotVersion = SnapshotVersion.min(), /** The highest numbered target ID encountered. */
    this.highestTargetId = 0, /** The highest sequence number encountered. */
    this.Lr = 0, /**
     * A ordered bidirectional mapping between documents and the remote target
     * IDs.
     */
    this.Br = new __PRIVATE_ReferenceSet(), this.targetCount = 0, this.kr = __PRIVATE_TargetIdGenerator.Bn();
  }
  forEachTarget(e, t) {
    return this.Nr.forEach((e2, n) => t(n)), PersistencePromise.resolve();
  }
  getLastRemoteSnapshotVersion(e) {
    return PersistencePromise.resolve(this.lastRemoteSnapshotVersion);
  }
  getHighestSequenceNumber(e) {
    return PersistencePromise.resolve(this.Lr);
  }
  allocateTargetId(e) {
    return this.highestTargetId = this.kr.next(), PersistencePromise.resolve(this.highestTargetId);
  }
  setTargetsMetadata(e, t, n) {
    return n && (this.lastRemoteSnapshotVersion = n), t > this.Lr && (this.Lr = t), PersistencePromise.resolve();
  }
  Kn(e) {
    this.Nr.set(e.target, e);
    const t = e.targetId;
    t > this.highestTargetId && (this.kr = new __PRIVATE_TargetIdGenerator(t), this.highestTargetId = t), e.sequenceNumber > this.Lr && (this.Lr = e.sequenceNumber);
  }
  addTargetData(e, t) {
    return this.Kn(t), this.targetCount += 1, PersistencePromise.resolve();
  }
  updateTargetData(e, t) {
    return this.Kn(t), PersistencePromise.resolve();
  }
  removeTargetData(e, t) {
    return this.Nr.delete(t.target), this.Br.gr(t.targetId), this.targetCount -= 1, PersistencePromise.resolve();
  }
  removeTargets(e, t, n) {
    let r = 0;
    const i = [];
    return this.Nr.forEach((s, o) => {
      o.sequenceNumber <= t && null === n.get(o.targetId) && (this.Nr.delete(s), i.push(this.removeMatchingKeysForTargetId(e, o.targetId)), r++);
    }), PersistencePromise.waitFor(i).next(() => r);
  }
  getTargetCount(e) {
    return PersistencePromise.resolve(this.targetCount);
  }
  getTargetData(e, t) {
    const n = this.Nr.get(t) || null;
    return PersistencePromise.resolve(n);
  }
  addMatchingKeys(e, t, n) {
    return this.Br.Rr(t, n), PersistencePromise.resolve();
  }
  removeMatchingKeys(e, t, n) {
    this.Br.mr(t, n);
    const r = this.persistence.referenceDelegate, i = [];
    return r && t.forEach((t2) => {
      i.push(r.markPotentiallyOrphaned(e, t2));
    }), PersistencePromise.waitFor(i);
  }
  removeMatchingKeysForTargetId(e, t) {
    return this.Br.gr(t), PersistencePromise.resolve();
  }
  getMatchingKeysForTargetId(e, t) {
    const n = this.Br.yr(t);
    return PersistencePromise.resolve(n);
  }
  containsKey(e, t) {
    return PersistencePromise.resolve(this.Br.containsKey(t));
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_MemoryPersistence {
  /**
   * The constructor accepts a factory for creating a reference delegate. This
   * allows both the delegate and this instance to have strong references to
   * each other without having nullable fields that would then need to be
   * checked or asserted on every access.
   */
  constructor(e, t) {
    this.qr = {}, this.overlays = {}, this.Qr = new __PRIVATE_ListenSequence(0), this.Kr = false, this.Kr = true, this.$r = new __PRIVATE_MemoryGlobalsCache(), this.referenceDelegate = e(this), this.Ur = new __PRIVATE_MemoryTargetCache(this);
    this.indexManager = new __PRIVATE_MemoryIndexManager(), this.remoteDocumentCache = function __PRIVATE_newMemoryRemoteDocumentCache(e2) {
      return new __PRIVATE_MemoryRemoteDocumentCacheImpl(e2);
    }((e2) => this.referenceDelegate.Wr(e2)), this.serializer = new __PRIVATE_LocalSerializer(t), this.Gr = new __PRIVATE_MemoryBundleCache(this.serializer);
  }
  start() {
    return Promise.resolve();
  }
  shutdown() {
    return this.Kr = false, Promise.resolve();
  }
  get started() {
    return this.Kr;
  }
  setDatabaseDeletedListener() {
  }
  setNetworkEnabled() {
  }
  getIndexManager(e) {
    return this.indexManager;
  }
  getDocumentOverlayCache(e) {
    let t = this.overlays[e.toKey()];
    return t || (t = new __PRIVATE_MemoryDocumentOverlayCache(), this.overlays[e.toKey()] = t), t;
  }
  getMutationQueue(e, t) {
    let n = this.qr[e.toKey()];
    return n || (n = new __PRIVATE_MemoryMutationQueue(t, this.referenceDelegate), this.qr[e.toKey()] = n), n;
  }
  getGlobalsCache() {
    return this.$r;
  }
  getTargetCache() {
    return this.Ur;
  }
  getRemoteDocumentCache() {
    return this.remoteDocumentCache;
  }
  getBundleCache() {
    return this.Gr;
  }
  runTransaction(e, t, n) {
    __PRIVATE_logDebug("MemoryPersistence", "Starting transaction:", e);
    const r = new __PRIVATE_MemoryTransaction(this.Qr.next());
    return this.referenceDelegate.zr(), n(r).next((e2) => this.referenceDelegate.jr(r).next(() => e2)).toPromise().then((e2) => (r.raiseOnCommittedEvent(), e2));
  }
  Hr(e, t) {
    return PersistencePromise.or(Object.values(this.qr).map((n) => () => n.containsKey(e, t)));
  }
}
class __PRIVATE_MemoryTransaction extends PersistenceTransaction {
  constructor(e) {
    super(), this.currentSequenceNumber = e;
  }
}
class __PRIVATE_MemoryEagerDelegate {
  constructor(e) {
    this.persistence = e, /** Tracks all documents that are active in Query views. */
    this.Jr = new __PRIVATE_ReferenceSet(), /** The list of documents that are potentially GCed after each transaction. */
    this.Yr = null;
  }
  static Zr(e) {
    return new __PRIVATE_MemoryEagerDelegate(e);
  }
  get Xr() {
    if (this.Yr) return this.Yr;
    throw fail();
  }
  addReference(e, t, n) {
    return this.Jr.addReference(n, t), this.Xr.delete(n.toString()), PersistencePromise.resolve();
  }
  removeReference(e, t, n) {
    return this.Jr.removeReference(n, t), this.Xr.add(n.toString()), PersistencePromise.resolve();
  }
  markPotentiallyOrphaned(e, t) {
    return this.Xr.add(t.toString()), PersistencePromise.resolve();
  }
  removeTarget(e, t) {
    this.Jr.gr(t.targetId).forEach((e2) => this.Xr.add(e2.toString()));
    const n = this.persistence.getTargetCache();
    return n.getMatchingKeysForTargetId(e, t.targetId).next((e2) => {
      e2.forEach((e3) => this.Xr.add(e3.toString()));
    }).next(() => n.removeTargetData(e, t));
  }
  zr() {
    this.Yr = /* @__PURE__ */ new Set();
  }
  jr(e) {
    const t = this.persistence.getRemoteDocumentCache().newChangeBuffer();
    return PersistencePromise.forEach(this.Xr, (n) => {
      const r = DocumentKey.fromPath(n);
      return this.ei(e, r).next((e2) => {
        e2 || t.removeEntry(r, SnapshotVersion.min());
      });
    }).next(() => (this.Yr = null, t.apply(e)));
  }
  updateLimboDocument(e, t) {
    return this.ei(e, t).next((e2) => {
      e2 ? this.Xr.delete(t.toString()) : this.Xr.add(t.toString());
    });
  }
  Wr(e) {
    return 0;
  }
  ei(e, t) {
    return PersistencePromise.or([() => PersistencePromise.resolve(this.Jr.containsKey(t)), () => this.persistence.getTargetCache().containsKey(e, t), () => this.persistence.Hr(e, t)]);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_LocalViewChanges {
  constructor(e, t, n, r) {
    this.targetId = e, this.fromCache = t, this.$i = n, this.Ui = r;
  }
  static Wi(e, t) {
    let n = __PRIVATE_documentKeySet(), r = __PRIVATE_documentKeySet();
    for (const e2 of t.docChanges) switch (e2.type) {
      case 0:
        n = n.add(e2.doc.key);
        break;
      case 1:
        r = r.add(e2.doc.key);
    }
    return new __PRIVATE_LocalViewChanges(e, t.fromCache, n, r);
  }
}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class QueryContext {
  constructor() {
    this._documentReadCount = 0;
  }
  get documentReadCount() {
    return this._documentReadCount;
  }
  incrementDocumentReadCount(e) {
    this._documentReadCount += e;
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_QueryEngine {
  constructor() {
    this.Gi = false, this.zi = false, /**
     * SDK only decides whether it should create index when collection size is
     * larger than this.
     */
    this.ji = 100, this.Hi = /**
    * This cost represents the evaluation result of
    * (([index, docKey] + [docKey, docContent]) per document in the result set)
    * / ([docKey, docContent] per documents in full collection scan) coming from
    * experiment [enter PR experiment URL here].
    */
    function __PRIVATE_getDefaultRelativeIndexReadCostPerDocument() {
      return isSafari() ? 8 : __PRIVATE_getAndroidVersion(getUA()) > 0 ? 6 : 4;
    }();
  }
  /** Sets the document view to query against. */
  initialize(e, t) {
    this.Ji = e, this.indexManager = t, this.Gi = true;
  }
  /** Returns all local documents matching the specified query. */
  getDocumentsMatchingQuery(e, t, n, r) {
    const i = {
      result: null
    };
    return this.Yi(e, t).next((e2) => {
      i.result = e2;
    }).next(() => {
      if (!i.result) return this.Zi(e, t, r, n).next((e2) => {
        i.result = e2;
      });
    }).next(() => {
      if (i.result) return;
      const n2 = new QueryContext();
      return this.Xi(e, t, n2).next((r2) => {
        if (i.result = r2, this.zi) return this.es(e, t, n2, r2.size);
      });
    }).next(() => i.result);
  }
  es(e, t, n, r) {
    return n.documentReadCount < this.ji ? (__PRIVATE_getLogLevel() <= LogLevel.DEBUG && __PRIVATE_logDebug("QueryEngine", "SDK will not create cache indexes for query:", __PRIVATE_stringifyQuery(t), "since it only creates cache indexes for collection contains", "more than or equal to", this.ji, "documents"), PersistencePromise.resolve()) : (__PRIVATE_getLogLevel() <= LogLevel.DEBUG && __PRIVATE_logDebug("QueryEngine", "Query:", __PRIVATE_stringifyQuery(t), "scans", n.documentReadCount, "local documents and returns", r, "documents as results."), n.documentReadCount > this.Hi * r ? (__PRIVATE_getLogLevel() <= LogLevel.DEBUG && __PRIVATE_logDebug("QueryEngine", "The SDK decides to create cache indexes for query:", __PRIVATE_stringifyQuery(t), "as using cache indexes may help improve performance."), this.indexManager.createTargetIndexes(e, __PRIVATE_queryToTarget(t))) : PersistencePromise.resolve());
  }
  /**
   * Performs an indexed query that evaluates the query based on a collection's
   * persisted index values. Returns `null` if an index is not available.
   */
  Yi(e, t) {
    if (__PRIVATE_queryMatchesAllDocuments(t))
      return PersistencePromise.resolve(null);
    let n = __PRIVATE_queryToTarget(t);
    return this.indexManager.getIndexType(e, n).next((r) => 0 === r ? null : (null !== t.limit && 1 === r && // We cannot apply a limit for targets that are served using a partial
    // index. If a partial index will be used to serve the target, the
    // query may return a superset of documents that match the target
    // (e.g. if the index doesn't include all the target's filters), or
    // may return the correct set of documents in the wrong order (e.g. if
    // the index doesn't include a segment for one of the orderBys).
    // Therefore, a limit should not be applied in such cases.
    (t = __PRIVATE_queryWithLimit(
      t,
      null,
      "F"
      /* LimitType.First */
    ), n = __PRIVATE_queryToTarget(t)), this.indexManager.getDocumentsMatchingTarget(e, n).next((r2) => {
      const i = __PRIVATE_documentKeySet(...r2);
      return this.Ji.getDocuments(e, i).next((r3) => this.indexManager.getMinOffset(e, n).next((n2) => {
        const s = this.ts(t, r3);
        return this.ns(t, s, i, n2.readTime) ? this.Yi(e, __PRIVATE_queryWithLimit(
          t,
          null,
          "F"
          /* LimitType.First */
        )) : this.rs(e, s, t, n2);
      }));
    })));
  }
  /**
   * Performs a query based on the target's persisted query mapping. Returns
   * `null` if the mapping is not available or cannot be used.
   */
  Zi(e, t, n, r) {
    return __PRIVATE_queryMatchesAllDocuments(t) || r.isEqual(SnapshotVersion.min()) ? PersistencePromise.resolve(null) : this.Ji.getDocuments(e, n).next((i) => {
      const s = this.ts(t, i);
      return this.ns(t, s, n, r) ? PersistencePromise.resolve(null) : (__PRIVATE_getLogLevel() <= LogLevel.DEBUG && __PRIVATE_logDebug("QueryEngine", "Re-using previous result from %s to execute query: %s", r.toString(), __PRIVATE_stringifyQuery(t)), this.rs(e, s, t, __PRIVATE_newIndexOffsetSuccessorFromReadTime(r, -1)).next((e2) => e2));
    });
  }
  /** Applies the query filter and sorting to the provided documents.  */
  ts(e, t) {
    let n = new SortedSet(__PRIVATE_newQueryComparator(e));
    return t.forEach((t2, r) => {
      __PRIVATE_queryMatches(e, r) && (n = n.add(r));
    }), n;
  }
  /**
   * Determines if a limit query needs to be refilled from cache, making it
   * ineligible for index-free execution.
   *
   * @param query - The query.
   * @param sortedPreviousResults - The documents that matched the query when it
   * was last synchronized, sorted by the query's comparator.
   * @param remoteKeys - The document keys that matched the query at the last
   * snapshot.
   * @param limboFreeSnapshotVersion - The version of the snapshot when the
   * query was last synchronized.
   */
  ns(e, t, n, r) {
    if (null === e.limit)
      return false;
    if (n.size !== t.size)
      return true;
    const i = "F" === e.limitType ? t.last() : t.first();
    return !!i && (i.hasPendingWrites || i.version.compareTo(r) > 0);
  }
  Xi(e, t, n) {
    return __PRIVATE_getLogLevel() <= LogLevel.DEBUG && __PRIVATE_logDebug("QueryEngine", "Using full collection scan to execute query:", __PRIVATE_stringifyQuery(t)), this.Ji.getDocumentsMatchingQuery(e, t, IndexOffset.min(), n);
  }
  /**
   * Combines the results from an indexed execution with the remaining documents
   * that have not yet been indexed.
   */
  rs(e, t, n, r) {
    return this.Ji.getDocumentsMatchingQuery(e, n, r).next((e2) => (
      // Merge with existing results
      (t.forEach((t2) => {
        e2 = e2.insert(t2.key, t2);
      }), e2)
    ));
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_LocalStoreImpl {
  constructor(e, t, n, r) {
    this.persistence = e, this.ss = t, this.serializer = r, /**
     * Maps a targetID to data about its target.
     *
     * PORTING NOTE: We are using an immutable data structure on Web to make re-runs
     * of `applyRemoteEvent()` idempotent.
     */
    this.os = new SortedMap(__PRIVATE_primitiveComparator), /** Maps a target to its targetID. */
    // TODO(wuandy): Evaluate if TargetId can be part of Target.
    this._s = new ObjectMap((e2) => __PRIVATE_canonifyTarget(e2), __PRIVATE_targetEquals), /**
     * A per collection group index of the last read time processed by
     * `getNewDocumentChanges()`.
     *
     * PORTING NOTE: This is only used for multi-tab synchronization.
     */
    this.us = /* @__PURE__ */ new Map(), this.cs = e.getRemoteDocumentCache(), this.Ur = e.getTargetCache(), this.Gr = e.getBundleCache(), this.ls(n);
  }
  ls(e) {
    this.documentOverlayCache = this.persistence.getDocumentOverlayCache(e), this.indexManager = this.persistence.getIndexManager(e), this.mutationQueue = this.persistence.getMutationQueue(e, this.indexManager), this.localDocuments = new LocalDocumentsView(this.cs, this.mutationQueue, this.documentOverlayCache, this.indexManager), this.cs.setIndexManager(this.indexManager), this.ss.initialize(this.localDocuments, this.indexManager);
  }
  collectGarbage(e) {
    return this.persistence.runTransaction("Collect garbage", "readwrite-primary", (t) => e.collect(t, this.os));
  }
}
function __PRIVATE_newLocalStore(e, t, n, r) {
  return new __PRIVATE_LocalStoreImpl(e, t, n, r);
}
async function __PRIVATE_localStoreHandleUserChange(e, t) {
  const n = __PRIVATE_debugCast(e);
  return await n.persistence.runTransaction("Handle user change", "readonly", (e2) => {
    let r;
    return n.mutationQueue.getAllMutationBatches(e2).next((i) => (r = i, n.ls(t), n.mutationQueue.getAllMutationBatches(e2))).next((t2) => {
      const i = [], s = [];
      let o = __PRIVATE_documentKeySet();
      for (const e3 of r) {
        i.push(e3.batchId);
        for (const t3 of e3.mutations) o = o.add(t3.key);
      }
      for (const e3 of t2) {
        s.push(e3.batchId);
        for (const t3 of e3.mutations) o = o.add(t3.key);
      }
      return n.localDocuments.getDocuments(e2, o).next((e3) => ({
        hs: e3,
        removedBatchIds: i,
        addedBatchIds: s
      }));
    });
  });
}
function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e) {
  const t = __PRIVATE_debugCast(e);
  return t.persistence.runTransaction("Get last remote snapshot version", "readonly", (e2) => t.Ur.getLastRemoteSnapshotVersion(e2));
}
function __PRIVATE_localStoreApplyRemoteEventToLocalCache(e, t) {
  const n = __PRIVATE_debugCast(e), r = t.snapshotVersion;
  let i = n.os;
  return n.persistence.runTransaction("Apply remote event", "readwrite-primary", (e2) => {
    const s = n.cs.newChangeBuffer({
      trackRemovals: true
    });
    i = n.os;
    const o = [];
    t.targetChanges.forEach((s2, _2) => {
      const a2 = i.get(_2);
      if (!a2) return;
      o.push(n.Ur.removeMatchingKeys(e2, s2.removedDocuments, _2).next(() => n.Ur.addMatchingKeys(e2, s2.addedDocuments, _2)));
      let u = a2.withSequenceNumber(e2.currentSequenceNumber);
      null !== t.targetMismatches.get(_2) ? u = u.withResumeToken(ByteString.EMPTY_BYTE_STRING, SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()) : s2.resumeToken.approximateByteSize() > 0 && (u = u.withResumeToken(s2.resumeToken, r)), i = i.insert(_2, u), // Update the target data if there are target changes (or if
      // sufficient time has passed since the last update).
      /**
      * Returns true if the newTargetData should be persisted during an update of
      * an active target. TargetData should always be persisted when a target is
      * being released and should not call this function.
      *
      * While the target is active, TargetData updates can be omitted when nothing
      * about the target has changed except metadata like the resume token or
      * snapshot version. Occasionally it's worth the extra write to prevent these
      * values from getting too stale after a crash, but this doesn't have to be
      * too frequent.
      */
      function __PRIVATE_shouldPersistTargetData(e3, t2, n2) {
        if (0 === e3.resumeToken.approximateByteSize()) return true;
        if (t2.snapshotVersion.toMicroseconds() - e3.snapshotVersion.toMicroseconds() >= 3e8) return true;
        return n2.addedDocuments.size + n2.modifiedDocuments.size + n2.removedDocuments.size > 0;
      }(a2, u, s2) && o.push(n.Ur.updateTargetData(e2, u));
    });
    let _ = __PRIVATE_mutableDocumentMap(), a = __PRIVATE_documentKeySet();
    if (t.documentUpdates.forEach((r2) => {
      t.resolvedLimboDocuments.has(r2) && o.push(n.persistence.referenceDelegate.updateLimboDocument(e2, r2));
    }), // Each loop iteration only affects its "own" doc, so it's safe to get all
    // the remote documents in advance in a single call.
    o.push(__PRIVATE_populateDocumentChangeBuffer(e2, s, t.documentUpdates).next((e3) => {
      _ = e3.Ps, a = e3.Is;
    })), !r.isEqual(SnapshotVersion.min())) {
      const t2 = n.Ur.getLastRemoteSnapshotVersion(e2).next((t3) => n.Ur.setTargetsMetadata(e2, e2.currentSequenceNumber, r));
      o.push(t2);
    }
    return PersistencePromise.waitFor(o).next(() => s.apply(e2)).next(() => n.localDocuments.getLocalViewOfDocuments(e2, _, a)).next(() => _);
  }).then((e2) => (n.os = i, e2));
}
function __PRIVATE_populateDocumentChangeBuffer(e, t, n) {
  let r = __PRIVATE_documentKeySet(), i = __PRIVATE_documentKeySet();
  return n.forEach((e2) => r = r.add(e2)), t.getEntries(e, r).next((e2) => {
    let r2 = __PRIVATE_mutableDocumentMap();
    return n.forEach((n2, s) => {
      const o = e2.get(n2);
      s.isFoundDocument() !== o.isFoundDocument() && (i = i.add(n2)), // Note: The order of the steps below is important, since we want
      // to ensure that rejected limbo resolutions (which fabricate
      // NoDocuments with SnapshotVersion.min()) never add documents to
      // cache.
      s.isNoDocument() && s.version.isEqual(SnapshotVersion.min()) ? (
        // NoDocuments with SnapshotVersion.min() are used in manufactured
        // events. We remove these documents from cache since we lost
        // access.
        (t.removeEntry(n2, s.readTime), r2 = r2.insert(n2, s))
      ) : !o.isValidDocument() || s.version.compareTo(o.version) > 0 || 0 === s.version.compareTo(o.version) && o.hasPendingWrites ? (t.addEntry(s), r2 = r2.insert(n2, s)) : __PRIVATE_logDebug("LocalStore", "Ignoring outdated watch update for ", n2, ". Current version:", o.version, " Watch version:", s.version);
    }), {
      Ps: r2,
      Is: i
    };
  });
}
function __PRIVATE_localStoreAllocateTarget(e, t) {
  const n = __PRIVATE_debugCast(e);
  return n.persistence.runTransaction("Allocate target", "readwrite", (e2) => {
    let r;
    return n.Ur.getTargetData(e2, t).next((i) => i ? (
      // This target has been listened to previously, so reuse the
      // previous targetID.
      // TODO(mcg): freshen last accessed date?
      (r = i, PersistencePromise.resolve(r))
    ) : n.Ur.allocateTargetId(e2).next((i2) => (r = new TargetData(t, i2, "TargetPurposeListen", e2.currentSequenceNumber), n.Ur.addTargetData(e2, r).next(() => r))));
  }).then((e2) => {
    const r = n.os.get(e2.targetId);
    return (null === r || e2.snapshotVersion.compareTo(r.snapshotVersion) > 0) && (n.os = n.os.insert(e2.targetId, e2), n._s.set(t, e2.targetId)), e2;
  });
}
async function __PRIVATE_localStoreReleaseTarget(e, t, n) {
  const r = __PRIVATE_debugCast(e), i = r.os.get(t), s = n ? "readwrite" : "readwrite-primary";
  try {
    n || await r.persistence.runTransaction("Release target", s, (e2) => r.persistence.referenceDelegate.removeTarget(e2, i));
  } catch (e2) {
    if (!__PRIVATE_isIndexedDbTransactionError(e2)) throw e2;
    __PRIVATE_logDebug("LocalStore", `Failed to update sequence numbers for target ${t}: ${e2}`);
  }
  r.os = r.os.remove(t), r._s.delete(i.target);
}
function __PRIVATE_localStoreExecuteQuery(e, t, n) {
  const r = __PRIVATE_debugCast(e);
  let i = SnapshotVersion.min(), s = __PRIVATE_documentKeySet();
  return r.persistence.runTransaction(
    "Execute query",
    "readwrite",
    // Use readwrite instead of readonly so indexes can be created
    // Use readwrite instead of readonly so indexes can be created
    (e2) => function __PRIVATE_localStoreGetTargetData(e3, t2, n2) {
      const r2 = __PRIVATE_debugCast(e3), i2 = r2._s.get(n2);
      return void 0 !== i2 ? PersistencePromise.resolve(r2.os.get(i2)) : r2.Ur.getTargetData(t2, n2);
    }(r, e2, __PRIVATE_queryToTarget(t)).next((t2) => {
      if (t2) return i = t2.lastLimboFreeSnapshotVersion, r.Ur.getMatchingKeysForTargetId(e2, t2.targetId).next((e3) => {
        s = e3;
      });
    }).next(() => r.ss.getDocumentsMatchingQuery(e2, t, n ? i : SnapshotVersion.min(), n ? s : __PRIVATE_documentKeySet())).next((e3) => (__PRIVATE_setMaxReadTime(r, __PRIVATE_queryCollectionGroup(t), e3), {
      documents: e3,
      Ts: s
    }))
  );
}
function __PRIVATE_setMaxReadTime(e, t, n) {
  let r = e.us.get(t) || SnapshotVersion.min();
  n.forEach((e2, t2) => {
    t2.readTime.compareTo(r) > 0 && (r = t2.readTime);
  }), e.us.set(t, r);
}
class __PRIVATE_LocalClientState {
  constructor() {
    this.activeTargetIds = __PRIVATE_targetIdSet();
  }
  fs(e) {
    this.activeTargetIds = this.activeTargetIds.add(e);
  }
  gs(e) {
    this.activeTargetIds = this.activeTargetIds.delete(e);
  }
  /**
   * Converts this entry into a JSON-encoded format we can use for WebStorage.
   * Does not encode `clientId` as it is part of the key in WebStorage.
   */
  Vs() {
    const e = {
      activeTargetIds: this.activeTargetIds.toArray(),
      updateTimeMs: Date.now()
    };
    return JSON.stringify(e);
  }
}
class __PRIVATE_MemorySharedClientState {
  constructor() {
    this.so = new __PRIVATE_LocalClientState(), this.oo = {}, this.onlineStateHandler = null, this.sequenceNumberHandler = null;
  }
  addPendingMutation(e) {
  }
  updateMutationState(e, t, n) {
  }
  addLocalQueryTarget(e, t = true) {
    return t && this.so.fs(e), this.oo[e] || "not-current";
  }
  updateQueryState(e, t, n) {
    this.oo[e] = t;
  }
  removeLocalQueryTarget(e) {
    this.so.gs(e);
  }
  isLocalQueryTarget(e) {
    return this.so.activeTargetIds.has(e);
  }
  clearQueryState(e) {
    delete this.oo[e];
  }
  getAllActiveQueryTargets() {
    return this.so.activeTargetIds;
  }
  isActiveQueryTarget(e) {
    return this.so.activeTargetIds.has(e);
  }
  start() {
    return this.so = new __PRIVATE_LocalClientState(), Promise.resolve();
  }
  handleUserChange(e, t, n) {
  }
  setOnlineState(e) {
  }
  shutdown() {
  }
  writeSequenceNumber(e) {
  }
  notifyBundleLoaded(e) {
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_NoopConnectivityMonitor {
  _o(e) {
  }
  shutdown() {
  }
}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_BrowserConnectivityMonitor {
  constructor() {
    this.ao = () => this.uo(), this.co = () => this.lo(), this.ho = [], this.Po();
  }
  _o(e) {
    this.ho.push(e);
  }
  shutdown() {
    window.removeEventListener("online", this.ao), window.removeEventListener("offline", this.co);
  }
  Po() {
    window.addEventListener("online", this.ao), window.addEventListener("offline", this.co);
  }
  uo() {
    __PRIVATE_logDebug("ConnectivityMonitor", "Network connectivity changed: AVAILABLE");
    for (const e of this.ho) e(
      0
      /* NetworkStatus.AVAILABLE */
    );
  }
  lo() {
    __PRIVATE_logDebug("ConnectivityMonitor", "Network connectivity changed: UNAVAILABLE");
    for (const e of this.ho) e(
      1
      /* NetworkStatus.UNAVAILABLE */
    );
  }
  // TODO(chenbrian): Consider passing in window either into this component or
  // here for testing via FakeWindow.
  /** Checks that all used attributes of window are available. */
  static D() {
    return "undefined" != typeof window && void 0 !== window.addEventListener && void 0 !== window.removeEventListener;
  }
}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let me = null;
function __PRIVATE_generateUniqueDebugId() {
  return null === me ? me = function __PRIVATE_generateInitialUniqueDebugId() {
    return 268435456 + Math.round(2147483648 * Math.random());
  }() : me++, "0x" + me.toString(16);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const fe = {
  BatchGetDocuments: "batchGet",
  Commit: "commit",
  RunQuery: "runQuery",
  RunAggregationQuery: "runAggregationQuery"
};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_StreamBridge {
  constructor(e) {
    this.Io = e.Io, this.To = e.To;
  }
  Eo(e) {
    this.Ao = e;
  }
  Ro(e) {
    this.Vo = e;
  }
  mo(e) {
    this.fo = e;
  }
  onMessage(e) {
    this.po = e;
  }
  close() {
    this.To();
  }
  send(e) {
    this.Io(e);
  }
  yo() {
    this.Ao();
  }
  wo() {
    this.Vo();
  }
  So(e) {
    this.fo(e);
  }
  bo(e) {
    this.po(e);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ge = "WebChannelConnection";
class __PRIVATE_WebChannelConnection extends /**
 * Base class for all Rest-based connections to the backend (WebChannel and
 * HTTP).
 */
class __PRIVATE_RestConnection {
  constructor(e) {
    this.databaseInfo = e, this.databaseId = e.databaseId;
    const t = e.ssl ? "https" : "http", n = encodeURIComponent(this.databaseId.projectId), r = encodeURIComponent(this.databaseId.database);
    this.Do = t + "://" + e.host, this.vo = `projects/${n}/databases/${r}`, this.Co = "(default)" === this.databaseId.database ? `project_id=${n}` : `project_id=${n}&database_id=${r}`;
  }
  get Fo() {
    return false;
  }
  Mo(e, t, n, r, i) {
    const s = __PRIVATE_generateUniqueDebugId(), o = this.xo(e, t.toUriEncodedString());
    __PRIVATE_logDebug("RestConnection", `Sending RPC '${e}' ${s}:`, o, n);
    const _ = {
      "google-cloud-resource-prefix": this.vo,
      "x-goog-request-params": this.Co
    };
    return this.Oo(_, r, i), this.No(e, o, _, n).then((t2) => (__PRIVATE_logDebug("RestConnection", `Received RPC '${e}' ${s}: `, t2), t2), (t2) => {
      throw __PRIVATE_logWarn("RestConnection", `RPC '${e}' ${s} failed with error: `, t2, "url: ", o, "request:", n), t2;
    });
  }
  Lo(e, t, n, r, i, s) {
    return this.Mo(e, t, n, r, i);
  }
  /**
   * Modifies the headers for a request, adding any authorization token if
   * present and any additional headers for the request.
   */
  Oo(e, t, n) {
    e["X-Goog-Api-Client"] = // SDK_VERSION is updated to different value at runtime depending on the entry point,
    // so we need to get its value when we need it in a function.
    function __PRIVATE_getGoogApiClientValue() {
      return "gl-js/ fire/" + S;
    }(), // Content-Type: text/plain will avoid preflight requests which might
    // mess with CORS and redirects by proxies. If we add custom headers
    // we will need to change this code to potentially use the $httpOverwrite
    // parameter supported by ESF to avoid triggering preflight requests.
    e["Content-Type"] = "text/plain", this.databaseInfo.appId && (e["X-Firebase-GMPID"] = this.databaseInfo.appId), t && t.headers.forEach((t2, n2) => e[n2] = t2), n && n.headers.forEach((t2, n2) => e[n2] = t2);
  }
  xo(e, t) {
    const n = fe[e];
    return `${this.Do}/v1/${t}:${n}`;
  }
  /**
   * Closes and cleans up any resources associated with the connection. This
   * implementation is a no-op because there are no resources associated
   * with the RestConnection that need to be cleaned up.
   */
  terminate() {
  }
} {
  constructor(e) {
    super(e), this.forceLongPolling = e.forceLongPolling, this.autoDetectLongPolling = e.autoDetectLongPolling, this.useFetchStreams = e.useFetchStreams, this.longPollingOptions = e.longPollingOptions;
  }
  No(e, t, n, r) {
    const i = __PRIVATE_generateUniqueDebugId();
    return new Promise((s, o) => {
      const _ = new XhrIo();
      _.setWithCredentials(true), _.listenOnce(EventType.COMPLETE, () => {
        try {
          switch (_.getLastErrorCode()) {
            case ErrorCode.NO_ERROR:
              const t2 = _.getResponseJson();
              __PRIVATE_logDebug(ge, `XHR for RPC '${e}' ${i} received:`, JSON.stringify(t2)), s(t2);
              break;
            case ErrorCode.TIMEOUT:
              __PRIVATE_logDebug(ge, `RPC '${e}' ${i} timed out`), o(new FirestoreError(D.DEADLINE_EXCEEDED, "Request time out"));
              break;
            case ErrorCode.HTTP_ERROR:
              const n2 = _.getStatus();
              if (__PRIVATE_logDebug(ge, `RPC '${e}' ${i} failed with status:`, n2, "response text:", _.getResponseText()), n2 > 0) {
                let e2 = _.getResponseJson();
                Array.isArray(e2) && (e2 = e2[0]);
                const t3 = null == e2 ? void 0 : e2.error;
                if (t3 && t3.status && t3.message) {
                  const e3 = function __PRIVATE_mapCodeFromHttpResponseErrorStatus(e4) {
                    const t4 = e4.toLowerCase().replace(/_/g, "-");
                    return Object.values(D).indexOf(t4) >= 0 ? t4 : D.UNKNOWN;
                  }(t3.status);
                  o(new FirestoreError(e3, t3.message));
                } else o(new FirestoreError(D.UNKNOWN, "Server responded with status " + _.getStatus()));
              } else
                o(new FirestoreError(D.UNAVAILABLE, "Connection failed."));
              break;
            default:
              fail();
          }
        } finally {
          __PRIVATE_logDebug(ge, `RPC '${e}' ${i} completed.`);
        }
      });
      const a = JSON.stringify(r);
      __PRIVATE_logDebug(ge, `RPC '${e}' ${i} sending request:`, r), _.send(t, "POST", a, n, 15);
    });
  }
  Bo(e, t, n) {
    const r = __PRIVATE_generateUniqueDebugId(), i = [this.Do, "/", "google.firestore.v1.Firestore", "/", e, "/channel"], s = createWebChannelTransport(), o = getStatEventTarget(), _ = {
      // Required for backend stickiness, routing behavior is based on this
      // parameter.
      httpSessionIdParam: "gsessionid",
      initMessageHeaders: {},
      messageUrlParams: {
        // This param is used to improve routing and project isolation by the
        // backend and must be included in every request.
        database: `projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`
      },
      sendRawJson: true,
      supportsCrossDomainXhr: true,
      internalChannelParams: {
        // Override the default timeout (randomized between 10-20 seconds) since
        // a large write batch on a slow internet connection may take a long
        // time to send to the backend. Rather than have WebChannel impose a
        // tight timeout which could lead to infinite timeouts and retries, we
        // set it very large (5-10 minutes) and rely on the browser's builtin
        // timeouts to kick in if the request isn't working.
        forwardChannelRequestTimeoutMs: 6e5
      },
      forceLongPolling: this.forceLongPolling,
      detectBufferingProxy: this.autoDetectLongPolling
    }, a = this.longPollingOptions.timeoutSeconds;
    void 0 !== a && (_.longPollingTimeout = Math.round(1e3 * a)), this.useFetchStreams && (_.useFetchStreams = true), this.Oo(_.initMessageHeaders, t, n), // Sending the custom headers we just added to request.initMessageHeaders
    // (Authorization, etc.) will trigger the browser to make a CORS preflight
    // request because the XHR will no longer meet the criteria for a "simple"
    // CORS request:
    // https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Simple_requests
    // Therefore to avoid the CORS preflight request (an extra network
    // roundtrip), we use the encodeInitMessageHeaders option to specify that
    // the headers should instead be encoded in the request's POST payload,
    // which is recognized by the webchannel backend.
    _.encodeInitMessageHeaders = true;
    const u = i.join("");
    __PRIVATE_logDebug(ge, `Creating RPC '${e}' stream ${r}: ${u}`, _);
    const c = s.createWebChannel(u, _);
    let l = false, h = false;
    const P = new __PRIVATE_StreamBridge({
      Io: (t2) => {
        h ? __PRIVATE_logDebug(ge, `Not sending because RPC '${e}' stream ${r} is closed:`, t2) : (l || (__PRIVATE_logDebug(ge, `Opening RPC '${e}' stream ${r} transport.`), c.open(), l = true), __PRIVATE_logDebug(ge, `RPC '${e}' stream ${r} sending:`, t2), c.send(t2));
      },
      To: () => c.close()
    }), __PRIVATE_unguardedEventListen = (e2, t2, n2) => {
      e2.listen(t2, (e3) => {
        try {
          n2(e3);
        } catch (e4) {
          setTimeout(() => {
            throw e4;
          }, 0);
        }
      });
    };
    return __PRIVATE_unguardedEventListen(c, WebChannel.EventType.OPEN, () => {
      h || (__PRIVATE_logDebug(ge, `RPC '${e}' stream ${r} transport opened.`), P.yo());
    }), __PRIVATE_unguardedEventListen(c, WebChannel.EventType.CLOSE, () => {
      h || (h = true, __PRIVATE_logDebug(ge, `RPC '${e}' stream ${r} transport closed`), P.So());
    }), __PRIVATE_unguardedEventListen(c, WebChannel.EventType.ERROR, (t2) => {
      h || (h = true, __PRIVATE_logWarn(ge, `RPC '${e}' stream ${r} transport errored:`, t2), P.So(new FirestoreError(D.UNAVAILABLE, "The operation could not be completed")));
    }), __PRIVATE_unguardedEventListen(c, WebChannel.EventType.MESSAGE, (t2) => {
      var n2;
      if (!h) {
        const i2 = t2.data[0];
        __PRIVATE_hardAssert(!!i2);
        const s2 = i2, o2 = s2.error || (null === (n2 = s2[0]) || void 0 === n2 ? void 0 : n2.error);
        if (o2) {
          __PRIVATE_logDebug(ge, `RPC '${e}' stream ${r} received error:`, o2);
          const t3 = o2.status;
          let n3 = (
            /**
            * Maps an error Code from a GRPC status identifier like 'NOT_FOUND'.
            *
            * @returns The Code equivalent to the given status string or undefined if
            *     there is no match.
            */
            function __PRIVATE_mapCodeFromRpcStatus(e2) {
              const t4 = le[e2];
              if (void 0 !== t4) return __PRIVATE_mapCodeFromRpcCode(t4);
            }(t3)
          ), i3 = o2.message;
          void 0 === n3 && (n3 = D.INTERNAL, i3 = "Unknown error status: " + t3 + " with message " + o2.message), // Mark closed so no further events are propagated
          h = true, P.So(new FirestoreError(n3, i3)), c.close();
        } else __PRIVATE_logDebug(ge, `RPC '${e}' stream ${r} received:`, i2), P.bo(i2);
      }
    }), __PRIVATE_unguardedEventListen(o, Event$1.STAT_EVENT, (t2) => {
      t2.stat === Stat.PROXY ? __PRIVATE_logDebug(ge, `RPC '${e}' stream ${r} detected buffering proxy`) : t2.stat === Stat.NOPROXY && __PRIVATE_logDebug(ge, `RPC '${e}' stream ${r} detected no buffering proxy`);
    }), setTimeout(() => {
      P.wo();
    }, 0), P;
  }
}
function getDocument() {
  return "undefined" != typeof document ? document : null;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_newSerializer(e) {
  return new JsonProtoSerializer(
    e,
    /* useProto3Json= */
    true
  );
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_ExponentialBackoff {
  constructor(e, t, n = 1e3, r = 1.5, i = 6e4) {
    this.ui = e, this.timerId = t, this.ko = n, this.qo = r, this.Qo = i, this.Ko = 0, this.$o = null, /** The last backoff attempt, as epoch milliseconds. */
    this.Uo = Date.now(), this.reset();
  }
  /**
   * Resets the backoff delay.
   *
   * The very next backoffAndWait() will have no delay. If it is called again
   * (i.e. due to an error), initialDelayMs (plus jitter) will be used, and
   * subsequent ones will increase according to the backoffFactor.
   */
  reset() {
    this.Ko = 0;
  }
  /**
   * Resets the backoff delay to the maximum delay (e.g. for use after a
   * RESOURCE_EXHAUSTED error).
   */
  Wo() {
    this.Ko = this.Qo;
  }
  /**
   * Returns a promise that resolves after currentDelayMs, and increases the
   * delay for any subsequent attempts. If there was a pending backoff operation
   * already, it will be canceled.
   */
  Go(e) {
    this.cancel();
    const t = Math.floor(this.Ko + this.zo()), n = Math.max(0, Date.now() - this.Uo), r = Math.max(0, t - n);
    r > 0 && __PRIVATE_logDebug("ExponentialBackoff", `Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`), this.$o = this.ui.enqueueAfterDelay(this.timerId, r, () => (this.Uo = Date.now(), e())), // Apply backoff factor to determine next delay and ensure it is within
    // bounds.
    this.Ko *= this.qo, this.Ko < this.ko && (this.Ko = this.ko), this.Ko > this.Qo && (this.Ko = this.Qo);
  }
  jo() {
    null !== this.$o && (this.$o.skipDelay(), this.$o = null);
  }
  cancel() {
    null !== this.$o && (this.$o.cancel(), this.$o = null);
  }
  /** Returns a random value in the range [-currentBaseMs/2, currentBaseMs/2] */
  zo() {
    return (Math.random() - 0.5) * this.Ko;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_PersistentStream {
  constructor(e, t, n, r, i, s, o, _) {
    this.ui = e, this.Ho = n, this.Jo = r, this.connection = i, this.authCredentialsProvider = s, this.appCheckCredentialsProvider = o, this.listener = _, this.state = 0, /**
     * A close count that's incremented every time the stream is closed; used by
     * getCloseGuardedDispatcher() to invalidate callbacks that happen after
     * close.
     */
    this.Yo = 0, this.Zo = null, this.Xo = null, this.stream = null, /**
     * Count of response messages received.
     */
    this.e_ = 0, this.t_ = new __PRIVATE_ExponentialBackoff(e, t);
  }
  /**
   * Returns true if start() has been called and no error has occurred. True
   * indicates the stream is open or in the process of opening (which
   * encompasses respecting backoff, getting auth tokens, and starting the
   * actual RPC). Use isOpen() to determine if the stream is open and ready for
   * outbound requests.
   */
  n_() {
    return 1 === this.state || 5 === this.state || this.r_();
  }
  /**
   * Returns true if the underlying RPC is open (the onOpen() listener has been
   * called) and the stream is ready for outbound requests.
   */
  r_() {
    return 2 === this.state || 3 === this.state;
  }
  /**
   * Starts the RPC. Only allowed if isStarted() returns false. The stream is
   * not immediately ready for use: onOpen() will be invoked when the RPC is
   * ready for outbound requests, at which point isOpen() will return true.
   *
   * When start returns, isStarted() will return true.
   */
  start() {
    this.e_ = 0, 4 !== this.state ? this.auth() : this.i_();
  }
  /**
   * Stops the RPC. This call is idempotent and allowed regardless of the
   * current isStarted() state.
   *
   * When stop returns, isStarted() and isOpen() will both return false.
   */
  async stop() {
    this.n_() && await this.close(
      0
      /* PersistentStreamState.Initial */
    );
  }
  /**
   * After an error the stream will usually back off on the next attempt to
   * start it. If the error warrants an immediate restart of the stream, the
   * sender can use this to indicate that the receiver should not back off.
   *
   * Each error will call the onClose() listener. That function can decide to
   * inhibit backoff if required.
   */
  s_() {
    this.state = 0, this.t_.reset();
  }
  /**
   * Marks this stream as idle. If no further actions are performed on the
   * stream for one minute, the stream will automatically close itself and
   * notify the stream's onClose() handler with Status.OK. The stream will then
   * be in a !isStarted() state, requiring the caller to start the stream again
   * before further use.
   *
   * Only streams that are in state 'Open' can be marked idle, as all other
   * states imply pending network operations.
   */
  o_() {
    this.r_() && null === this.Zo && (this.Zo = this.ui.enqueueAfterDelay(this.Ho, 6e4, () => this.__()));
  }
  /** Sends a message to the underlying stream. */
  a_(e) {
    this.u_(), this.stream.send(e);
  }
  /** Called by the idle timer when the stream should close due to inactivity. */
  async __() {
    if (this.r_())
      return this.close(
        0
        /* PersistentStreamState.Initial */
      );
  }
  /** Marks the stream as active again. */
  u_() {
    this.Zo && (this.Zo.cancel(), this.Zo = null);
  }
  /** Cancels the health check delayed operation. */
  c_() {
    this.Xo && (this.Xo.cancel(), this.Xo = null);
  }
  /**
   * Closes the stream and cleans up as necessary:
   *
   * * closes the underlying GRPC stream;
   * * calls the onClose handler with the given 'error';
   * * sets internal stream state to 'finalState';
   * * adjusts the backoff timer based on the error
   *
   * A new stream can be opened by calling start().
   *
   * @param finalState - the intended state of the stream after closing.
   * @param error - the error the connection was closed with.
   */
  async close(e, t) {
    this.u_(), this.c_(), this.t_.cancel(), // Invalidates any stream-related callbacks (e.g. from auth or the
    // underlying stream), guaranteeing they won't execute.
    this.Yo++, 4 !== e ? (
      // If this is an intentional close ensure we don't delay our next connection attempt.
      this.t_.reset()
    ) : t && t.code === D.RESOURCE_EXHAUSTED ? (
      // Log the error. (Probably either 'quota exceeded' or 'max queue length reached'.)
      (__PRIVATE_logError(t.toString()), __PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."), this.t_.Wo())
    ) : t && t.code === D.UNAUTHENTICATED && 3 !== this.state && // "unauthenticated" error means the token was rejected. This should rarely
    // happen since both Auth and AppCheck ensure a sufficient TTL when we
    // request a token. If a user manually resets their system clock this can
    // fail, however. In this case, we should get a Code.UNAUTHENTICATED error
    // before we received the first message and we need to invalidate the token
    // to ensure that we fetch a new token.
    (this.authCredentialsProvider.invalidateToken(), this.appCheckCredentialsProvider.invalidateToken()), // Clean up the underlying stream because we are no longer interested in events.
    null !== this.stream && (this.l_(), this.stream.close(), this.stream = null), // This state must be assigned before calling onClose() to allow the callback to
    // inhibit backoff or otherwise manipulate the state in its non-started state.
    this.state = e, // Notify the listener that the stream closed.
    await this.listener.mo(t);
  }
  /**
   * Can be overridden to perform additional cleanup before the stream is closed.
   * Calling super.tearDown() is not required.
   */
  l_() {
  }
  auth() {
    this.state = 1;
    const e = this.h_(this.Yo), t = this.Yo;
    Promise.all([this.authCredentialsProvider.getToken(), this.appCheckCredentialsProvider.getToken()]).then(([e2, n]) => {
      this.Yo === t && // Normally we'd have to schedule the callback on the AsyncQueue.
      // However, the following calls are safe to be called outside the
      // AsyncQueue since they don't chain asynchronous calls
      this.P_(e2, n);
    }, (t2) => {
      e(() => {
        const e2 = new FirestoreError(D.UNKNOWN, "Fetching auth token failed: " + t2.message);
        return this.I_(e2);
      });
    });
  }
  P_(e, t) {
    const n = this.h_(this.Yo);
    this.stream = this.T_(e, t), this.stream.Eo(() => {
      n(() => this.listener.Eo());
    }), this.stream.Ro(() => {
      n(() => (this.state = 2, this.Xo = this.ui.enqueueAfterDelay(this.Jo, 1e4, () => (this.r_() && (this.state = 3), Promise.resolve())), this.listener.Ro()));
    }), this.stream.mo((e2) => {
      n(() => this.I_(e2));
    }), this.stream.onMessage((e2) => {
      n(() => 1 == ++this.e_ ? this.E_(e2) : this.onNext(e2));
    });
  }
  i_() {
    this.state = 5, this.t_.Go(async () => {
      this.state = 0, this.start();
    });
  }
  // Visible for tests
  I_(e) {
    return __PRIVATE_logDebug("PersistentStream", `close with error: ${e}`), this.stream = null, this.close(4, e);
  }
  /**
   * Returns a "dispatcher" function that dispatches operations onto the
   * AsyncQueue but only runs them if closeCount remains unchanged. This allows
   * us to turn auth / stream callbacks into no-ops if the stream is closed /
   * re-opened, etc.
   */
  h_(e) {
    return (t) => {
      this.ui.enqueueAndForget(() => this.Yo === e ? t() : (__PRIVATE_logDebug("PersistentStream", "stream callback skipped by getCloseGuardedDispatcher."), Promise.resolve()));
    };
  }
}
class __PRIVATE_PersistentListenStream extends __PRIVATE_PersistentStream {
  constructor(e, t, n, r, i, s) {
    super(e, "listen_stream_connection_backoff", "listen_stream_idle", "health_check_timeout", t, n, r, s), this.serializer = i;
  }
  T_(e, t) {
    return this.connection.Bo("Listen", e, t);
  }
  E_(e) {
    return this.onNext(e);
  }
  onNext(e) {
    this.t_.reset();
    const t = __PRIVATE_fromWatchChange(this.serializer, e), n = function __PRIVATE_versionFromListenResponse(e2) {
      if (!("targetChange" in e2)) return SnapshotVersion.min();
      const t2 = e2.targetChange;
      return t2.targetIds && t2.targetIds.length ? SnapshotVersion.min() : t2.readTime ? __PRIVATE_fromVersion(t2.readTime) : SnapshotVersion.min();
    }(e);
    return this.listener.d_(t, n);
  }
  /**
   * Registers interest in the results of the given target. If the target
   * includes a resumeToken it will be included in the request. Results that
   * affect the target will be streamed back as WatchChange messages that
   * reference the targetId.
   */
  A_(e) {
    const t = {};
    t.database = __PRIVATE_getEncodedDatabaseId(this.serializer), t.addTarget = function __PRIVATE_toTarget(e2, t2) {
      let n2;
      const r = t2.target;
      if (n2 = __PRIVATE_targetIsDocumentTarget(r) ? {
        documents: __PRIVATE_toDocumentsTarget(e2, r)
      } : {
        query: __PRIVATE_toQueryTarget(e2, r)._t
      }, n2.targetId = t2.targetId, t2.resumeToken.approximateByteSize() > 0) {
        n2.resumeToken = __PRIVATE_toBytes(e2, t2.resumeToken);
        const r2 = __PRIVATE_toInt32Proto(e2, t2.expectedCount);
        null !== r2 && (n2.expectedCount = r2);
      } else if (t2.snapshotVersion.compareTo(SnapshotVersion.min()) > 0) {
        n2.readTime = toTimestamp(e2, t2.snapshotVersion.toTimestamp());
        const r2 = __PRIVATE_toInt32Proto(e2, t2.expectedCount);
        null !== r2 && (n2.expectedCount = r2);
      }
      return n2;
    }(this.serializer, e);
    const n = __PRIVATE_toListenRequestLabels(this.serializer, e);
    n && (t.labels = n), this.a_(t);
  }
  /**
   * Unregisters interest in the results of the target associated with the
   * given targetId.
   */
  R_(e) {
    const t = {};
    t.database = __PRIVATE_getEncodedDatabaseId(this.serializer), t.removeTarget = e, this.a_(t);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_DatastoreImpl extends class Datastore {
} {
  constructor(e, t, n, r) {
    super(), this.authCredentials = e, this.appCheckCredentials = t, this.connection = n, this.serializer = r, this.y_ = false;
  }
  w_() {
    if (this.y_) throw new FirestoreError(D.FAILED_PRECONDITION, "The client has already been terminated.");
  }
  /** Invokes the provided RPC with auth and AppCheck tokens. */
  Mo(e, t, n, r) {
    return this.w_(), Promise.all([this.authCredentials.getToken(), this.appCheckCredentials.getToken()]).then(([i, s]) => this.connection.Mo(e, __PRIVATE_toResourcePath(t, n), r, i, s)).catch((e2) => {
      throw "FirebaseError" === e2.name ? (e2.code === D.UNAUTHENTICATED && (this.authCredentials.invalidateToken(), this.appCheckCredentials.invalidateToken()), e2) : new FirestoreError(D.UNKNOWN, e2.toString());
    });
  }
  /** Invokes the provided RPC with streamed results with auth and AppCheck tokens. */
  Lo(e, t, n, r, i) {
    return this.w_(), Promise.all([this.authCredentials.getToken(), this.appCheckCredentials.getToken()]).then(([s, o]) => this.connection.Lo(e, __PRIVATE_toResourcePath(t, n), r, s, o, i)).catch((e2) => {
      throw "FirebaseError" === e2.name ? (e2.code === D.UNAUTHENTICATED && (this.authCredentials.invalidateToken(), this.appCheckCredentials.invalidateToken()), e2) : new FirestoreError(D.UNKNOWN, e2.toString());
    });
  }
  terminate() {
    this.y_ = true, this.connection.terminate();
  }
}
class __PRIVATE_OnlineStateTracker {
  constructor(e, t) {
    this.asyncQueue = e, this.onlineStateHandler = t, /** The current OnlineState. */
    this.state = "Unknown", /**
     * A count of consecutive failures to open the stream. If it reaches the
     * maximum defined by MAX_WATCH_STREAM_FAILURES, we'll set the OnlineState to
     * Offline.
     */
    this.S_ = 0, /**
     * A timer that elapses after ONLINE_STATE_TIMEOUT_MS, at which point we
     * transition from OnlineState.Unknown to OnlineState.Offline without waiting
     * for the stream to actually fail (MAX_WATCH_STREAM_FAILURES times).
     */
    this.b_ = null, /**
     * Whether the client should log a warning message if it fails to connect to
     * the backend (initially true, cleared after a successful stream, or if we've
     * logged the message already).
     */
    this.D_ = true;
  }
  /**
   * Called by RemoteStore when a watch stream is started (including on each
   * backoff attempt).
   *
   * If this is the first attempt, it sets the OnlineState to Unknown and starts
   * the onlineStateTimer.
   */
  v_() {
    0 === this.S_ && (this.C_(
      "Unknown"
      /* OnlineState.Unknown */
    ), this.b_ = this.asyncQueue.enqueueAfterDelay("online_state_timeout", 1e4, () => (this.b_ = null, this.F_("Backend didn't respond within 10 seconds."), this.C_(
      "Offline"
      /* OnlineState.Offline */
    ), Promise.resolve())));
  }
  /**
   * Updates our OnlineState as appropriate after the watch stream reports a
   * failure. The first failure moves us to the 'Unknown' state. We then may
   * allow multiple failures (based on MAX_WATCH_STREAM_FAILURES) before we
   * actually transition to the 'Offline' state.
   */
  M_(e) {
    "Online" === this.state ? this.C_(
      "Unknown"
      /* OnlineState.Unknown */
    ) : (this.S_++, this.S_ >= 1 && (this.x_(), this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`), this.C_(
      "Offline"
      /* OnlineState.Offline */
    )));
  }
  /**
   * Explicitly sets the OnlineState to the specified state.
   *
   * Note that this resets our timers / failure counters, etc. used by our
   * Offline heuristics, so must not be used in place of
   * handleWatchStreamStart() and handleWatchStreamFailure().
   */
  set(e) {
    this.x_(), this.S_ = 0, "Online" === e && // We've connected to watch at least once. Don't warn the developer
    // about being offline going forward.
    (this.D_ = false), this.C_(e);
  }
  C_(e) {
    e !== this.state && (this.state = e, this.onlineStateHandler(e));
  }
  F_(e) {
    const t = `Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;
    this.D_ ? (__PRIVATE_logError(t), this.D_ = false) : __PRIVATE_logDebug("OnlineStateTracker", t);
  }
  x_() {
    null !== this.b_ && (this.b_.cancel(), this.b_ = null);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_RemoteStoreImpl {
  constructor(e, t, n, r, i) {
    this.localStore = e, this.datastore = t, this.asyncQueue = n, this.remoteSyncer = {}, /**
     * A list of up to MAX_PENDING_WRITES writes that we have fetched from the
     * LocalStore via fillWritePipeline() and have or will send to the write
     * stream.
     *
     * Whenever writePipeline.length > 0 the RemoteStore will attempt to start or
     * restart the write stream. When the stream is established the writes in the
     * pipeline will be sent in order.
     *
     * Writes remain in writePipeline until they are acknowledged by the backend
     * and thus will automatically be re-sent if the stream is interrupted /
     * restarted before they're acknowledged.
     *
     * Write responses from the backend are linked to their originating request
     * purely based on order, and so we can just shift() writes from the front of
     * the writePipeline as we receive responses.
     */
    this.O_ = [], /**
     * A mapping of watched targets that the client cares about tracking and the
     * user has explicitly called a 'listen' for this target.
     *
     * These targets may or may not have been sent to or acknowledged by the
     * server. On re-establishing the listen stream, these targets should be sent
     * to the server. The targets removed with unlistens are removed eagerly
     * without waiting for confirmation from the listen stream.
     */
    this.N_ = /* @__PURE__ */ new Map(), /**
     * A set of reasons for why the RemoteStore may be offline. If empty, the
     * RemoteStore may start its network connections.
     */
    this.L_ = /* @__PURE__ */ new Set(), /**
     * Event handlers that get called when the network is disabled or enabled.
     *
     * PORTING NOTE: These functions are used on the Web client to create the
     * underlying streams (to support tree-shakeable streams). On Android and iOS,
     * the streams are created during construction of RemoteStore.
     */
    this.B_ = [], this.k_ = i, this.k_._o((e2) => {
      n.enqueueAndForget(async () => {
        __PRIVATE_canUseNetwork(this) && (__PRIVATE_logDebug("RemoteStore", "Restarting streams for network reachability change."), await async function __PRIVATE_restartNetwork(e3) {
          const t2 = __PRIVATE_debugCast(e3);
          t2.L_.add(
            4
            /* OfflineCause.ConnectivityChange */
          ), await __PRIVATE_disableNetworkInternal(t2), t2.q_.set(
            "Unknown"
            /* OnlineState.Unknown */
          ), t2.L_.delete(
            4
            /* OfflineCause.ConnectivityChange */
          ), await __PRIVATE_enableNetworkInternal(t2);
        }(this));
      });
    }), this.q_ = new __PRIVATE_OnlineStateTracker(n, r);
  }
}
async function __PRIVATE_enableNetworkInternal(e) {
  if (__PRIVATE_canUseNetwork(e)) for (const t of e.B_) await t(
    /* enabled= */
    true
  );
}
async function __PRIVATE_disableNetworkInternal(e) {
  for (const t of e.B_) await t(
    /* enabled= */
    false
  );
}
function __PRIVATE_remoteStoreListen(e, t) {
  const n = __PRIVATE_debugCast(e);
  n.N_.has(t.targetId) || // Mark this as something the client is currently listening for.
  (n.N_.set(t.targetId, t), __PRIVATE_shouldStartWatchStream(n) ? (
    // The listen will be sent in onWatchStreamOpen
    __PRIVATE_startWatchStream(n)
  ) : __PRIVATE_ensureWatchStream(n).r_() && __PRIVATE_sendWatchRequest(n, t));
}
function __PRIVATE_remoteStoreUnlisten(e, t) {
  const n = __PRIVATE_debugCast(e), r = __PRIVATE_ensureWatchStream(n);
  n.N_.delete(t), r.r_() && __PRIVATE_sendUnwatchRequest(n, t), 0 === n.N_.size && (r.r_() ? r.o_() : __PRIVATE_canUseNetwork(n) && // Revert to OnlineState.Unknown if the watch stream is not open and we
  // have no listeners, since without any listens to send we cannot
  // confirm if the stream is healthy and upgrade to OnlineState.Online.
  n.q_.set(
    "Unknown"
    /* OnlineState.Unknown */
  ));
}
function __PRIVATE_sendWatchRequest(e, t) {
  if (e.Q_.xe(t.targetId), t.resumeToken.approximateByteSize() > 0 || t.snapshotVersion.compareTo(SnapshotVersion.min()) > 0) {
    const n = e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;
    t = t.withExpectedCount(n);
  }
  __PRIVATE_ensureWatchStream(e).A_(t);
}
function __PRIVATE_sendUnwatchRequest(e, t) {
  e.Q_.xe(t), __PRIVATE_ensureWatchStream(e).R_(t);
}
function __PRIVATE_startWatchStream(e) {
  e.Q_ = new __PRIVATE_WatchChangeAggregator({
    getRemoteKeysForTarget: (t) => e.remoteSyncer.getRemoteKeysForTarget(t),
    ot: (t) => e.N_.get(t) || null,
    tt: () => e.datastore.serializer.databaseId
  }), __PRIVATE_ensureWatchStream(e).start(), e.q_.v_();
}
function __PRIVATE_shouldStartWatchStream(e) {
  return __PRIVATE_canUseNetwork(e) && !__PRIVATE_ensureWatchStream(e).n_() && e.N_.size > 0;
}
function __PRIVATE_canUseNetwork(e) {
  return 0 === __PRIVATE_debugCast(e).L_.size;
}
function __PRIVATE_cleanUpWatchStreamState(e) {
  e.Q_ = void 0;
}
async function __PRIVATE_onWatchStreamConnected(e) {
  e.q_.set(
    "Online"
    /* OnlineState.Online */
  );
}
async function __PRIVATE_onWatchStreamOpen(e) {
  e.N_.forEach((t, n) => {
    __PRIVATE_sendWatchRequest(e, t);
  });
}
async function __PRIVATE_onWatchStreamClose(e, t) {
  __PRIVATE_cleanUpWatchStreamState(e), // If we still need the watch stream, retry the connection.
  __PRIVATE_shouldStartWatchStream(e) ? (e.q_.M_(t), __PRIVATE_startWatchStream(e)) : (
    // No need to restart watch stream because there are no active targets.
    // The online state is set to unknown because there is no active attempt
    // at establishing a connection
    e.q_.set(
      "Unknown"
      /* OnlineState.Unknown */
    )
  );
}
async function __PRIVATE_onWatchStreamChange(e, t, n) {
  if (
    // Mark the client as online since we got a message from the server
    e.q_.set(
      "Online"
      /* OnlineState.Online */
    ), t instanceof __PRIVATE_WatchTargetChange && 2 === t.state && t.cause
  )
    try {
      await /** Handles an error on a target */
      async function __PRIVATE_handleTargetError(e2, t2) {
        const n2 = t2.cause;
        for (const r of t2.targetIds)
          e2.N_.has(r) && (await e2.remoteSyncer.rejectListen(r, n2), e2.N_.delete(r), e2.Q_.removeTarget(r));
      }(e, t);
    } catch (n2) {
      __PRIVATE_logDebug("RemoteStore", "Failed to remove targets %s: %s ", t.targetIds.join(","), n2), await __PRIVATE_disableNetworkUntilRecovery(e, n2);
    }
  else if (t instanceof __PRIVATE_DocumentWatchChange ? e.Q_.Ke(t) : t instanceof __PRIVATE_ExistenceFilterChange ? e.Q_.He(t) : e.Q_.We(t), !n.isEqual(SnapshotVersion.min())) try {
    const t2 = await __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore);
    n.compareTo(t2) >= 0 && // We have received a target change with a global snapshot if the snapshot
    // version is not equal to SnapshotVersion.min().
    await /**
    * Takes a batch of changes from the Datastore, repackages them as a
    * RemoteEvent, and passes that on to the listener, which is typically the
    * SyncEngine.
    */
    function __PRIVATE_raiseWatchSnapshot(e2, t3) {
      const n2 = e2.Q_.rt(t3);
      return n2.targetChanges.forEach((n3, r) => {
        if (n3.resumeToken.approximateByteSize() > 0) {
          const i = e2.N_.get(r);
          i && e2.N_.set(r, i.withResumeToken(n3.resumeToken, t3));
        }
      }), // Re-establish listens for the targets that have been invalidated by
      // existence filter mismatches.
      n2.targetMismatches.forEach((t4, n3) => {
        const r = e2.N_.get(t4);
        if (!r)
          return;
        e2.N_.set(t4, r.withResumeToken(ByteString.EMPTY_BYTE_STRING, r.snapshotVersion)), // Cause a hard reset by unwatching and rewatching immediately, but
        // deliberately don't send a resume token so that we get a full update.
        __PRIVATE_sendUnwatchRequest(e2, t4);
        const i = new TargetData(r.target, t4, n3, r.sequenceNumber);
        __PRIVATE_sendWatchRequest(e2, i);
      }), e2.remoteSyncer.applyRemoteEvent(n2);
    }(e, n);
  } catch (t2) {
    __PRIVATE_logDebug("RemoteStore", "Failed to raise snapshot:", t2), await __PRIVATE_disableNetworkUntilRecovery(e, t2);
  }
}
async function __PRIVATE_disableNetworkUntilRecovery(e, t, n) {
  if (!__PRIVATE_isIndexedDbTransactionError(t)) throw t;
  e.L_.add(
    1
    /* OfflineCause.IndexedDbFailed */
  ), // Disable network and raise offline snapshots
  await __PRIVATE_disableNetworkInternal(e), e.q_.set(
    "Offline"
    /* OnlineState.Offline */
  ), n || // Use a simple read operation to determine if IndexedDB recovered.
  // Ideally, we would expose a health check directly on SimpleDb, but
  // RemoteStore only has access to persistence through LocalStore.
  (n = () => __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore)), // Probe IndexedDB periodically and re-enable network
  e.asyncQueue.enqueueRetryable(async () => {
    __PRIVATE_logDebug("RemoteStore", "Retrying IndexedDB access"), await n(), e.L_.delete(
      1
      /* OfflineCause.IndexedDbFailed */
    ), await __PRIVATE_enableNetworkInternal(e);
  });
}
async function __PRIVATE_remoteStoreHandleCredentialChange(e, t) {
  const n = __PRIVATE_debugCast(e);
  n.asyncQueue.verifyOperationInProgress(), __PRIVATE_logDebug("RemoteStore", "RemoteStore received new credentials");
  const r = __PRIVATE_canUseNetwork(n);
  n.L_.add(
    3
    /* OfflineCause.CredentialChange */
  ), await __PRIVATE_disableNetworkInternal(n), r && // Don't set the network status to Unknown if we are offline.
  n.q_.set(
    "Unknown"
    /* OnlineState.Unknown */
  ), await n.remoteSyncer.handleCredentialChange(t), n.L_.delete(
    3
    /* OfflineCause.CredentialChange */
  ), await __PRIVATE_enableNetworkInternal(n);
}
async function __PRIVATE_remoteStoreApplyPrimaryState(e, t) {
  const n = __PRIVATE_debugCast(e);
  t ? (n.L_.delete(
    2
    /* OfflineCause.IsSecondary */
  ), await __PRIVATE_enableNetworkInternal(n)) : t || (n.L_.add(
    2
    /* OfflineCause.IsSecondary */
  ), await __PRIVATE_disableNetworkInternal(n), n.q_.set(
    "Unknown"
    /* OnlineState.Unknown */
  ));
}
function __PRIVATE_ensureWatchStream(e) {
  return e.K_ || // Create stream (but note that it is not started yet).
  (e.K_ = function __PRIVATE_newPersistentWatchStream(e2, t, n) {
    const r = __PRIVATE_debugCast(e2);
    return r.w_(), new __PRIVATE_PersistentListenStream(t, r.connection, r.authCredentials, r.appCheckCredentials, r.serializer, n);
  }(e.datastore, e.asyncQueue, {
    Eo: __PRIVATE_onWatchStreamConnected.bind(null, e),
    Ro: __PRIVATE_onWatchStreamOpen.bind(null, e),
    mo: __PRIVATE_onWatchStreamClose.bind(null, e),
    d_: __PRIVATE_onWatchStreamChange.bind(null, e)
  }), e.B_.push(async (t) => {
    t ? (e.K_.s_(), __PRIVATE_shouldStartWatchStream(e) ? __PRIVATE_startWatchStream(e) : e.q_.set(
      "Unknown"
      /* OnlineState.Unknown */
    )) : (await e.K_.stop(), __PRIVATE_cleanUpWatchStreamState(e));
  })), e.K_;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class DelayedOperation {
  constructor(e, t, n, r, i) {
    this.asyncQueue = e, this.timerId = t, this.targetTimeMs = n, this.op = r, this.removalCallback = i, this.deferred = new __PRIVATE_Deferred(), this.then = this.deferred.promise.then.bind(this.deferred.promise), // It's normal for the deferred promise to be canceled (due to cancellation)
    // and so we attach a dummy catch callback to avoid
    // 'UnhandledPromiseRejectionWarning' log spam.
    this.deferred.promise.catch((e2) => {
    });
  }
  get promise() {
    return this.deferred.promise;
  }
  /**
   * Creates and returns a DelayedOperation that has been scheduled to be
   * executed on the provided asyncQueue after the provided delayMs.
   *
   * @param asyncQueue - The queue to schedule the operation on.
   * @param id - A Timer ID identifying the type of operation this is.
   * @param delayMs - The delay (ms) before the operation should be scheduled.
   * @param op - The operation to run.
   * @param removalCallback - A callback to be called synchronously once the
   *   operation is executed or canceled, notifying the AsyncQueue to remove it
   *   from its delayedOperations list.
   *   PORTING NOTE: This exists to prevent making removeDelayedOperation() and
   *   the DelayedOperation class public.
   */
  static createAndSchedule(e, t, n, r, i) {
    const s = Date.now() + n, o = new DelayedOperation(e, t, s, r, i);
    return o.start(n), o;
  }
  /**
   * Starts the timer. This is called immediately after construction by
   * createAndSchedule().
   */
  start(e) {
    this.timerHandle = setTimeout(() => this.handleDelayElapsed(), e);
  }
  /**
   * Queues the operation to run immediately (if it hasn't already been run or
   * canceled).
   */
  skipDelay() {
    return this.handleDelayElapsed();
  }
  /**
   * Cancels the operation if it hasn't already been executed or canceled. The
   * promise will be rejected.
   *
   * As long as the operation has not yet been run, calling cancel() provides a
   * guarantee that the operation will not be run.
   */
  cancel(e) {
    null !== this.timerHandle && (this.clearTimeout(), this.deferred.reject(new FirestoreError(D.CANCELLED, "Operation cancelled" + (e ? ": " + e : ""))));
  }
  handleDelayElapsed() {
    this.asyncQueue.enqueueAndForget(() => null !== this.timerHandle ? (this.clearTimeout(), this.op().then((e) => this.deferred.resolve(e))) : Promise.resolve());
  }
  clearTimeout() {
    null !== this.timerHandle && (this.removalCallback(this), clearTimeout(this.timerHandle), this.timerHandle = null);
  }
}
function __PRIVATE_wrapInUserErrorIfRecoverable(e, t) {
  if (__PRIVATE_logError("AsyncQueue", `${t}: ${e}`), __PRIVATE_isIndexedDbTransactionError(e)) return new FirestoreError(D.UNAVAILABLE, `${t}: ${e}`);
  throw e;
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class DocumentSet {
  /** The default ordering is by key if the comparator is omitted */
  constructor(e) {
    this.comparator = e ? (t, n) => e(t, n) || DocumentKey.comparator(t.key, n.key) : (e2, t) => DocumentKey.comparator(e2.key, t.key), this.keyedMap = documentMap(), this.sortedSet = new SortedMap(this.comparator);
  }
  /**
   * Returns an empty copy of the existing DocumentSet, using the same
   * comparator.
   */
  static emptySet(e) {
    return new DocumentSet(e.comparator);
  }
  has(e) {
    return null != this.keyedMap.get(e);
  }
  get(e) {
    return this.keyedMap.get(e);
  }
  first() {
    return this.sortedSet.minKey();
  }
  last() {
    return this.sortedSet.maxKey();
  }
  isEmpty() {
    return this.sortedSet.isEmpty();
  }
  /**
   * Returns the index of the provided key in the document set, or -1 if the
   * document key is not present in the set;
   */
  indexOf(e) {
    const t = this.keyedMap.get(e);
    return t ? this.sortedSet.indexOf(t) : -1;
  }
  get size() {
    return this.sortedSet.size;
  }
  /** Iterates documents in order defined by "comparator" */
  forEach(e) {
    this.sortedSet.inorderTraversal((t, n) => (e(t), false));
  }
  /** Inserts or updates a document with the same key */
  add(e) {
    const t = this.delete(e.key);
    return t.copy(t.keyedMap.insert(e.key, e), t.sortedSet.insert(e, null));
  }
  /** Deletes a document with a given key */
  delete(e) {
    const t = this.get(e);
    return t ? this.copy(this.keyedMap.remove(e), this.sortedSet.remove(t)) : this;
  }
  isEqual(e) {
    if (!(e instanceof DocumentSet)) return false;
    if (this.size !== e.size) return false;
    const t = this.sortedSet.getIterator(), n = e.sortedSet.getIterator();
    for (; t.hasNext(); ) {
      const e2 = t.getNext().key, r = n.getNext().key;
      if (!e2.isEqual(r)) return false;
    }
    return true;
  }
  toString() {
    const e = [];
    return this.forEach((t) => {
      e.push(t.toString());
    }), 0 === e.length ? "DocumentSet ()" : "DocumentSet (\n  " + e.join("  \n") + "\n)";
  }
  copy(e, t) {
    const n = new DocumentSet();
    return n.comparator = this.comparator, n.keyedMap = e, n.sortedSet = t, n;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_DocumentChangeSet {
  constructor() {
    this.W_ = new SortedMap(DocumentKey.comparator);
  }
  track(e) {
    const t = e.doc.key, n = this.W_.get(t);
    n ? (
      // Merge the new change with the existing change.
      0 !== e.type && 3 === n.type ? this.W_ = this.W_.insert(t, e) : 3 === e.type && 1 !== n.type ? this.W_ = this.W_.insert(t, {
        type: n.type,
        doc: e.doc
      }) : 2 === e.type && 2 === n.type ? this.W_ = this.W_.insert(t, {
        type: 2,
        doc: e.doc
      }) : 2 === e.type && 0 === n.type ? this.W_ = this.W_.insert(t, {
        type: 0,
        doc: e.doc
      }) : 1 === e.type && 0 === n.type ? this.W_ = this.W_.remove(t) : 1 === e.type && 2 === n.type ? this.W_ = this.W_.insert(t, {
        type: 1,
        doc: n.doc
      }) : 0 === e.type && 1 === n.type ? this.W_ = this.W_.insert(t, {
        type: 2,
        doc: e.doc
      }) : (
        // This includes these cases, which don't make sense:
        // Added->Added
        // Removed->Removed
        // Modified->Added
        // Removed->Modified
        // Metadata->Added
        // Removed->Metadata
        fail()
      )
    ) : this.W_ = this.W_.insert(t, e);
  }
  G_() {
    const e = [];
    return this.W_.inorderTraversal((t, n) => {
      e.push(n);
    }), e;
  }
}
class ViewSnapshot {
  constructor(e, t, n, r, i, s, o, _, a) {
    this.query = e, this.docs = t, this.oldDocs = n, this.docChanges = r, this.mutatedKeys = i, this.fromCache = s, this.syncStateChanged = o, this.excludesMetadataChanges = _, this.hasCachedResults = a;
  }
  /** Returns a view snapshot as if all documents in the snapshot were added. */
  static fromInitialDocuments(e, t, n, r, i) {
    const s = [];
    return t.forEach((e2) => {
      s.push({
        type: 0,
        doc: e2
      });
    }), new ViewSnapshot(
      e,
      t,
      DocumentSet.emptySet(t),
      s,
      n,
      r,
      /* syncStateChanged= */
      true,
      /* excludesMetadataChanges= */
      false,
      i
    );
  }
  get hasPendingWrites() {
    return !this.mutatedKeys.isEmpty();
  }
  isEqual(e) {
    if (!(this.fromCache === e.fromCache && this.hasCachedResults === e.hasCachedResults && this.syncStateChanged === e.syncStateChanged && this.mutatedKeys.isEqual(e.mutatedKeys) && __PRIVATE_queryEquals(this.query, e.query) && this.docs.isEqual(e.docs) && this.oldDocs.isEqual(e.oldDocs))) return false;
    const t = this.docChanges, n = e.docChanges;
    if (t.length !== n.length) return false;
    for (let e2 = 0; e2 < t.length; e2++) if (t[e2].type !== n[e2].type || !t[e2].doc.isEqual(n[e2].doc)) return false;
    return true;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_QueryListenersInfo {
  constructor() {
    this.z_ = void 0, this.j_ = [];
  }
  // Helper methods that checks if the query has listeners that listening to remote store
  H_() {
    return this.j_.some((e) => e.J_());
  }
}
class __PRIVATE_EventManagerImpl {
  constructor() {
    this.queries = __PRIVATE_newQueriesObjectMap(), this.onlineState = "Unknown", this.Y_ = /* @__PURE__ */ new Set();
  }
  terminate() {
    !function __PRIVATE_errorAllTargets(e, t) {
      const n = __PRIVATE_debugCast(e), r = n.queries;
      n.queries = __PRIVATE_newQueriesObjectMap(), r.forEach((e2, n2) => {
        for (const e3 of n2.j_) e3.onError(t);
      });
    }(this, new FirestoreError(D.ABORTED, "Firestore shutting down"));
  }
}
function __PRIVATE_newQueriesObjectMap() {
  return new ObjectMap((e) => __PRIVATE_canonifyQuery(e), __PRIVATE_queryEquals);
}
async function __PRIVATE_eventManagerListen(e, t) {
  const n = __PRIVATE_debugCast(e);
  let r = 3;
  const i = t.query;
  let s = n.queries.get(i);
  s ? !s.H_() && t.J_() && // Query has been listening to local cache, and tries to add a new listener sourced from watch.
  (r = 2) : (s = new __PRIVATE_QueryListenersInfo(), r = t.J_() ? 0 : 1);
  try {
    switch (r) {
      case 0:
        s.z_ = await n.onListen(
          i,
          /** enableRemoteListen= */
          true
        );
        break;
      case 1:
        s.z_ = await n.onListen(
          i,
          /** enableRemoteListen= */
          false
        );
        break;
      case 2:
        await n.onFirstRemoteStoreListen(i);
    }
  } catch (e2) {
    const n2 = __PRIVATE_wrapInUserErrorIfRecoverable(e2, `Initialization of query '${__PRIVATE_stringifyQuery(t.query)}' failed`);
    return void t.onError(n2);
  }
  if (n.queries.set(i, s), s.j_.push(t), // Run global snapshot listeners if a consistent snapshot has been emitted.
  t.Z_(n.onlineState), s.z_) {
    t.X_(s.z_) && __PRIVATE_raiseSnapshotsInSyncEvent(n);
  }
}
async function __PRIVATE_eventManagerUnlisten(e, t) {
  const n = __PRIVATE_debugCast(e), r = t.query;
  let i = 3;
  const s = n.queries.get(r);
  if (s) {
    const e2 = s.j_.indexOf(t);
    e2 >= 0 && (s.j_.splice(e2, 1), 0 === s.j_.length ? i = t.J_() ? 0 : 1 : !s.H_() && t.J_() && // The removed listener is the last one that sourced from watch.
    (i = 2));
  }
  switch (i) {
    case 0:
      return n.queries.delete(r), n.onUnlisten(
        r,
        /** disableRemoteListen= */
        true
      );
    case 1:
      return n.queries.delete(r), n.onUnlisten(
        r,
        /** disableRemoteListen= */
        false
      );
    case 2:
      return n.onLastRemoteStoreUnlisten(r);
    default:
      return;
  }
}
function __PRIVATE_eventManagerOnWatchChange(e, t) {
  const n = __PRIVATE_debugCast(e);
  let r = false;
  for (const e2 of t) {
    const t2 = e2.query, i = n.queries.get(t2);
    if (i) {
      for (const t3 of i.j_) t3.X_(e2) && (r = true);
      i.z_ = e2;
    }
  }
  r && __PRIVATE_raiseSnapshotsInSyncEvent(n);
}
function __PRIVATE_eventManagerOnWatchError(e, t, n) {
  const r = __PRIVATE_debugCast(e), i = r.queries.get(t);
  if (i) for (const e2 of i.j_) e2.onError(n);
  r.queries.delete(t);
}
function __PRIVATE_raiseSnapshotsInSyncEvent(e) {
  e.Y_.forEach((e2) => {
    e2.next();
  });
}
var pe, ye;
(ye = pe || (pe = {})).ea = "default", /** Listen to changes in cache only */
ye.Cache = "cache";
class __PRIVATE_QueryListener {
  constructor(e, t, n) {
    this.query = e, this.ta = t, /**
     * Initial snapshots (e.g. from cache) may not be propagated to the wrapped
     * observer. This flag is set to true once we've actually raised an event.
     */
    this.na = false, this.ra = null, this.onlineState = "Unknown", this.options = n || {};
  }
  /**
   * Applies the new ViewSnapshot to this listener, raising a user-facing event
   * if applicable (depending on what changed, whether the user has opted into
   * metadata-only changes, etc.). Returns true if a user-facing event was
   * indeed raised.
   */
  X_(e) {
    if (!this.options.includeMetadataChanges) {
      const t2 = [];
      for (const n of e.docChanges) 3 !== n.type && t2.push(n);
      e = new ViewSnapshot(
        e.query,
        e.docs,
        e.oldDocs,
        t2,
        e.mutatedKeys,
        e.fromCache,
        e.syncStateChanged,
        /* excludesMetadataChanges= */
        true,
        e.hasCachedResults
      );
    }
    let t = false;
    return this.na ? this.ia(e) && (this.ta.next(e), t = true) : this.sa(e, this.onlineState) && (this.oa(e), t = true), this.ra = e, t;
  }
  onError(e) {
    this.ta.error(e);
  }
  /** Returns whether a snapshot was raised. */
  Z_(e) {
    this.onlineState = e;
    let t = false;
    return this.ra && !this.na && this.sa(this.ra, e) && (this.oa(this.ra), t = true), t;
  }
  sa(e, t) {
    if (!e.fromCache) return true;
    if (!this.J_()) return true;
    const n = "Offline" !== t;
    return (!this.options._a || !n) && (!e.docs.isEmpty() || e.hasCachedResults || "Offline" === t);
  }
  ia(e) {
    if (e.docChanges.length > 0) return true;
    const t = this.ra && this.ra.hasPendingWrites !== e.hasPendingWrites;
    return !(!e.syncStateChanged && !t) && true === this.options.includeMetadataChanges;
  }
  oa(e) {
    e = ViewSnapshot.fromInitialDocuments(e.query, e.docs, e.mutatedKeys, e.fromCache, e.hasCachedResults), this.na = true, this.ta.next(e);
  }
  J_() {
    return this.options.source !== pe.Cache;
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_AddedLimboDocument {
  constructor(e) {
    this.key = e;
  }
}
class __PRIVATE_RemovedLimboDocument {
  constructor(e) {
    this.key = e;
  }
}
class __PRIVATE_View {
  constructor(e, t) {
    this.query = e, this.Ta = t, this.Ea = null, this.hasCachedResults = false, /**
     * A flag whether the view is current with the backend. A view is considered
     * current after it has seen the current flag from the backend and did not
     * lose consistency within the watch stream (e.g. because of an existence
     * filter mismatch).
     */
    this.current = false, /** Documents in the view but not in the remote target */
    this.da = __PRIVATE_documentKeySet(), /** Document Keys that have local changes */
    this.mutatedKeys = __PRIVATE_documentKeySet(), this.Aa = __PRIVATE_newQueryComparator(e), this.Ra = new DocumentSet(this.Aa);
  }
  /**
   * The set of remote documents that the server has told us belongs to the target associated with
   * this view.
   */
  get Va() {
    return this.Ta;
  }
  /**
   * Iterates over a set of doc changes, applies the query limit, and computes
   * what the new results should be, what the changes were, and whether we may
   * need to go back to the local cache for more results. Does not make any
   * changes to the view.
   * @param docChanges - The doc changes to apply to this view.
   * @param previousChanges - If this is being called with a refill, then start
   *        with this set of docs and changes instead of the current view.
   * @returns a new set of docs, changes, and refill flag.
   */
  ma(e, t) {
    const n = t ? t.fa : new __PRIVATE_DocumentChangeSet(), r = t ? t.Ra : this.Ra;
    let i = t ? t.mutatedKeys : this.mutatedKeys, s = r, o = false;
    const _ = "F" === this.query.limitType && r.size === this.query.limit ? r.last() : null, a = "L" === this.query.limitType && r.size === this.query.limit ? r.first() : null;
    if (e.inorderTraversal((e2, t2) => {
      const u = r.get(e2), c = __PRIVATE_queryMatches(this.query, t2) ? t2 : null, l = !!u && this.mutatedKeys.has(u.key), h = !!c && (c.hasLocalMutations || // We only consider committed mutations for documents that were
      // mutated during the lifetime of the view.
      this.mutatedKeys.has(c.key) && c.hasCommittedMutations);
      let P = false;
      if (u && c) {
        u.data.isEqual(c.data) ? l !== h && (n.track({
          type: 3,
          doc: c
        }), P = true) : this.ga(u, c) || (n.track({
          type: 2,
          doc: c
        }), P = true, (_ && this.Aa(c, _) > 0 || a && this.Aa(c, a) < 0) && // This doc moved from inside the limit to outside the limit.
        // That means there may be some other doc in the local cache
        // that should be included instead.
        (o = true));
      } else !u && c ? (n.track({
        type: 0,
        doc: c
      }), P = true) : u && !c && (n.track({
        type: 1,
        doc: u
      }), P = true, (_ || a) && // A doc was removed from a full limit query. We'll need to
      // requery from the local cache to see if we know about some other
      // doc that should be in the results.
      (o = true));
      P && (c ? (s = s.add(c), i = h ? i.add(e2) : i.delete(e2)) : (s = s.delete(e2), i = i.delete(e2)));
    }), null !== this.query.limit) for (; s.size > this.query.limit; ) {
      const e2 = "F" === this.query.limitType ? s.last() : s.first();
      s = s.delete(e2.key), i = i.delete(e2.key), n.track({
        type: 1,
        doc: e2
      });
    }
    return {
      Ra: s,
      fa: n,
      ns: o,
      mutatedKeys: i
    };
  }
  ga(e, t) {
    return e.hasLocalMutations && t.hasCommittedMutations && !t.hasLocalMutations;
  }
  /**
   * Updates the view with the given ViewDocumentChanges and optionally updates
   * limbo docs and sync state from the provided target change.
   * @param docChanges - The set of changes to make to the view's docs.
   * @param limboResolutionEnabled - Whether to update limbo documents based on
   *        this change.
   * @param targetChange - A target change to apply for computing limbo docs and
   *        sync state.
   * @param targetIsPendingReset - Whether the target is pending to reset due to
   *        existence filter mismatch. If not explicitly specified, it is treated
   *        equivalently to `false`.
   * @returns A new ViewChange with the given docs, changes, and sync state.
   */
  // PORTING NOTE: The iOS/Android clients always compute limbo document changes.
  applyChanges(e, t, n, r) {
    const i = this.Ra;
    this.Ra = e.Ra, this.mutatedKeys = e.mutatedKeys;
    const s = e.fa.G_();
    s.sort((e2, t2) => function __PRIVATE_compareChangeType(e3, t3) {
      const order = (e4) => {
        switch (e4) {
          case 0:
            return 1;
          case 2:
          case 3:
            return 2;
          case 1:
            return 0;
          default:
            return fail();
        }
      };
      return order(e3) - order(t3);
    }(e2.type, t2.type) || this.Aa(e2.doc, t2.doc)), this.pa(n), r = null != r && r;
    const o = t && !r ? this.ya() : [], _ = 0 === this.da.size && this.current && !r ? 1 : 0, a = _ !== this.Ea;
    if (this.Ea = _, 0 !== s.length || a) {
      return {
        snapshot: new ViewSnapshot(
          this.query,
          e.Ra,
          i,
          s,
          e.mutatedKeys,
          0 === _,
          a,
          /* excludesMetadataChanges= */
          false,
          !!n && n.resumeToken.approximateByteSize() > 0
        ),
        wa: o
      };
    }
    return {
      wa: o
    };
  }
  /**
   * Applies an OnlineState change to the view, potentially generating a
   * ViewChange if the view's syncState changes as a result.
   */
  Z_(e) {
    return this.current && "Offline" === e ? (
      // If we're offline, set `current` to false and then call applyChanges()
      // to refresh our syncState and generate a ViewChange as appropriate. We
      // are guaranteed to get a new TargetChange that sets `current` back to
      // true once the client is back online.
      (this.current = false, this.applyChanges(
        {
          Ra: this.Ra,
          fa: new __PRIVATE_DocumentChangeSet(),
          mutatedKeys: this.mutatedKeys,
          ns: false
        },
        /* limboResolutionEnabled= */
        false
      ))
    ) : {
      wa: []
    };
  }
  /**
   * Returns whether the doc for the given key should be in limbo.
   */
  Sa(e) {
    return !this.Ta.has(e) && // The local store doesn't think it's a result, so it shouldn't be in limbo.
    (!!this.Ra.has(e) && !this.Ra.get(e).hasLocalMutations);
  }
  /**
   * Updates syncedDocuments, current, and limbo docs based on the given change.
   * Returns the list of changes to which docs are in limbo.
   */
  pa(e) {
    e && (e.addedDocuments.forEach((e2) => this.Ta = this.Ta.add(e2)), e.modifiedDocuments.forEach((e2) => {
    }), e.removedDocuments.forEach((e2) => this.Ta = this.Ta.delete(e2)), this.current = e.current);
  }
  ya() {
    if (!this.current) return [];
    const e = this.da;
    this.da = __PRIVATE_documentKeySet(), this.Ra.forEach((e2) => {
      this.Sa(e2.key) && (this.da = this.da.add(e2.key));
    });
    const t = [];
    return e.forEach((e2) => {
      this.da.has(e2) || t.push(new __PRIVATE_RemovedLimboDocument(e2));
    }), this.da.forEach((n) => {
      e.has(n) || t.push(new __PRIVATE_AddedLimboDocument(n));
    }), t;
  }
  /**
   * Update the in-memory state of the current view with the state read from
   * persistence.
   *
   * We update the query view whenever a client's primary status changes:
   * - When a client transitions from primary to secondary, it can miss
   *   LocalStorage updates and its query views may temporarily not be
   *   synchronized with the state on disk.
   * - For secondary to primary transitions, the client needs to update the list
   *   of `syncedDocuments` since secondary clients update their query views
   *   based purely on synthesized RemoteEvents.
   *
   * @param queryResult.documents - The documents that match the query according
   * to the LocalStore.
   * @param queryResult.remoteKeys - The keys of the documents that match the
   * query according to the backend.
   *
   * @returns The ViewChange that resulted from this synchronization.
   */
  // PORTING NOTE: Multi-tab only.
  ba(e) {
    this.Ta = e.Ts, this.da = __PRIVATE_documentKeySet();
    const t = this.ma(e.documents);
    return this.applyChanges(
      t,
      /* limboResolutionEnabled= */
      true
    );
  }
  /**
   * Returns a view snapshot as if this query was just listened to. Contains
   * a document add for every existing document and the `fromCache` and
   * `hasPendingWrites` status of the already established view.
   */
  // PORTING NOTE: Multi-tab only.
  Da() {
    return ViewSnapshot.fromInitialDocuments(this.query, this.Ra, this.mutatedKeys, 0 === this.Ea, this.hasCachedResults);
  }
}
class __PRIVATE_QueryView {
  constructor(e, t, n) {
    this.query = e, this.targetId = t, this.view = n;
  }
}
class LimboResolution {
  constructor(e) {
    this.key = e, /**
     * Set to true once we've received a document. This is used in
     * getRemoteKeysForTarget() and ultimately used by WatchChangeAggregator to
     * decide whether it needs to manufacture a delete event for the target once
     * the target is CURRENT.
     */
    this.va = false;
  }
}
class __PRIVATE_SyncEngineImpl {
  constructor(e, t, n, r, i, s) {
    this.localStore = e, this.remoteStore = t, this.eventManager = n, this.sharedClientState = r, this.currentUser = i, this.maxConcurrentLimboResolutions = s, this.Ca = {}, this.Fa = new ObjectMap((e2) => __PRIVATE_canonifyQuery(e2), __PRIVATE_queryEquals), this.Ma = /* @__PURE__ */ new Map(), /**
     * The keys of documents that are in limbo for which we haven't yet started a
     * limbo resolution query. The strings in this set are the result of calling
     * `key.path.canonicalString()` where `key` is a `DocumentKey` object.
     *
     * The `Set` type was chosen because it provides efficient lookup and removal
     * of arbitrary elements and it also maintains insertion order, providing the
     * desired queue-like FIFO semantics.
     */
    this.xa = /* @__PURE__ */ new Set(), /**
     * Keeps track of the target ID for each document that is in limbo with an
     * active target.
     */
    this.Oa = new SortedMap(DocumentKey.comparator), /**
     * Keeps track of the information about an active limbo resolution for each
     * active target ID that was started for the purpose of limbo resolution.
     */
    this.Na = /* @__PURE__ */ new Map(), this.La = new __PRIVATE_ReferenceSet(), /** Stores user completion handlers, indexed by User and BatchId. */
    this.Ba = {}, /** Stores user callbacks waiting for all pending writes to be acknowledged. */
    this.ka = /* @__PURE__ */ new Map(), this.qa = __PRIVATE_TargetIdGenerator.kn(), this.onlineState = "Unknown", // The primary state is set to `true` or `false` immediately after Firestore
    // startup. In the interim, a client should only be considered primary if
    // `isPrimary` is true.
    this.Qa = void 0;
  }
  get isPrimaryClient() {
    return true === this.Qa;
  }
}
async function __PRIVATE_syncEngineListen(e, t, n = true) {
  const r = __PRIVATE_ensureWatchCallbacks(e);
  let i;
  const s = r.Fa.get(t);
  return s ? (
    // PORTING NOTE: With Multi-Tab Web, it is possible that a query view
    // already exists when EventManager calls us for the first time. This
    // happens when the primary tab is already listening to this query on
    // behalf of another tab and the user of the primary also starts listening
    // to the query. EventManager will not have an assigned target ID in this
    // case and calls `listen` to obtain this ID.
    (r.sharedClientState.addLocalQueryTarget(s.targetId), i = s.view.Da())
  ) : i = await __PRIVATE_allocateTargetAndMaybeListen(
    r,
    t,
    n,
    /** shouldInitializeView= */
    true
  ), i;
}
async function __PRIVATE_triggerRemoteStoreListen(e, t) {
  const n = __PRIVATE_ensureWatchCallbacks(e);
  await __PRIVATE_allocateTargetAndMaybeListen(
    n,
    t,
    /** shouldListenToRemote= */
    true,
    /** shouldInitializeView= */
    false
  );
}
async function __PRIVATE_allocateTargetAndMaybeListen(e, t, n, r) {
  const i = await __PRIVATE_localStoreAllocateTarget(e.localStore, __PRIVATE_queryToTarget(t)), s = i.targetId, o = e.sharedClientState.addLocalQueryTarget(s, n);
  let _;
  return r && (_ = await __PRIVATE_initializeViewAndComputeSnapshot(e, t, s, "current" === o, i.resumeToken)), e.isPrimaryClient && n && __PRIVATE_remoteStoreListen(e.remoteStore, i), _;
}
async function __PRIVATE_initializeViewAndComputeSnapshot(e, t, n, r, i) {
  e.Ka = (t2, n2, r2) => async function __PRIVATE_applyDocChanges(e2, t3, n3, r3) {
    let i2 = t3.view.ma(n3);
    i2.ns && // The query has a limit and some docs were removed, so we need
    // to re-run the query against the local store to make sure we
    // didn't lose any good docs that had been past the limit.
    (i2 = await __PRIVATE_localStoreExecuteQuery(
      e2.localStore,
      t3.query,
      /* usePreviousResults= */
      false
    ).then(({ documents: e3 }) => t3.view.ma(e3, i2)));
    const s2 = r3 && r3.targetChanges.get(t3.targetId), o2 = r3 && null != r3.targetMismatches.get(t3.targetId), _2 = t3.view.applyChanges(
      i2,
      /* limboResolutionEnabled= */
      e2.isPrimaryClient,
      s2,
      o2
    );
    return __PRIVATE_updateTrackedLimbos(e2, t3.targetId, _2.wa), _2.snapshot;
  }(e, t2, n2, r2);
  const s = await __PRIVATE_localStoreExecuteQuery(
    e.localStore,
    t,
    /* usePreviousResults= */
    true
  ), o = new __PRIVATE_View(t, s.Ts), _ = o.ma(s.documents), a = TargetChange.createSynthesizedTargetChangeForCurrentChange(n, r && "Offline" !== e.onlineState, i), u = o.applyChanges(
    _,
    /* limboResolutionEnabled= */
    e.isPrimaryClient,
    a
  );
  __PRIVATE_updateTrackedLimbos(e, n, u.wa);
  const c = new __PRIVATE_QueryView(t, n, o);
  return e.Fa.set(t, c), e.Ma.has(n) ? e.Ma.get(n).push(t) : e.Ma.set(n, [t]), u.snapshot;
}
async function __PRIVATE_syncEngineUnlisten(e, t, n) {
  const r = __PRIVATE_debugCast(e), i = r.Fa.get(t), s = r.Ma.get(i.targetId);
  if (s.length > 1) return r.Ma.set(i.targetId, s.filter((e2) => !__PRIVATE_queryEquals(e2, t))), void r.Fa.delete(t);
  if (r.isPrimaryClient) {
    r.sharedClientState.removeLocalQueryTarget(i.targetId);
    r.sharedClientState.isActiveQueryTarget(i.targetId) || await __PRIVATE_localStoreReleaseTarget(
      r.localStore,
      i.targetId,
      /*keepPersistedTargetData=*/
      false
    ).then(() => {
      r.sharedClientState.clearQueryState(i.targetId), n && __PRIVATE_remoteStoreUnlisten(r.remoteStore, i.targetId), __PRIVATE_removeAndCleanupTarget(r, i.targetId);
    }).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss);
  } else __PRIVATE_removeAndCleanupTarget(r, i.targetId), await __PRIVATE_localStoreReleaseTarget(
    r.localStore,
    i.targetId,
    /*keepPersistedTargetData=*/
    true
  );
}
async function __PRIVATE_triggerRemoteStoreUnlisten(e, t) {
  const n = __PRIVATE_debugCast(e), r = n.Fa.get(t), i = n.Ma.get(r.targetId);
  n.isPrimaryClient && 1 === i.length && // PORTING NOTE: Unregister the target ID with local Firestore client as
  // watch target.
  (n.sharedClientState.removeLocalQueryTarget(r.targetId), __PRIVATE_remoteStoreUnlisten(n.remoteStore, r.targetId));
}
async function __PRIVATE_syncEngineApplyRemoteEvent(e, t) {
  const n = __PRIVATE_debugCast(e);
  try {
    const e2 = await __PRIVATE_localStoreApplyRemoteEventToLocalCache(n.localStore, t);
    t.targetChanges.forEach((e3, t2) => {
      const r = n.Na.get(t2);
      r && // Since this is a limbo resolution lookup, it's for a single document
      // and it could be added, modified, or removed, but not a combination.
      (__PRIVATE_hardAssert(e3.addedDocuments.size + e3.modifiedDocuments.size + e3.removedDocuments.size <= 1), e3.addedDocuments.size > 0 ? r.va = true : e3.modifiedDocuments.size > 0 ? __PRIVATE_hardAssert(r.va) : e3.removedDocuments.size > 0 && (__PRIVATE_hardAssert(r.va), r.va = false));
    }), await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n, e2, t);
  } catch (e2) {
    await __PRIVATE_ignoreIfPrimaryLeaseLoss(e2);
  }
}
function __PRIVATE_syncEngineApplyOnlineStateChange(e, t, n) {
  const r = __PRIVATE_debugCast(e);
  if (r.isPrimaryClient && 0 === n || !r.isPrimaryClient && 1 === n) {
    const e2 = [];
    r.Fa.forEach((n2, r2) => {
      const i = r2.view.Z_(t);
      i.snapshot && e2.push(i.snapshot);
    }), function __PRIVATE_eventManagerOnOnlineStateChange(e3, t2) {
      const n2 = __PRIVATE_debugCast(e3);
      n2.onlineState = t2;
      let r2 = false;
      n2.queries.forEach((e4, n3) => {
        for (const e5 of n3.j_)
          e5.Z_(t2) && (r2 = true);
      }), r2 && __PRIVATE_raiseSnapshotsInSyncEvent(n2);
    }(r.eventManager, t), e2.length && r.Ca.d_(e2), r.onlineState = t, r.isPrimaryClient && r.sharedClientState.setOnlineState(t);
  }
}
async function __PRIVATE_syncEngineRejectListen(e, t, n) {
  const r = __PRIVATE_debugCast(e);
  r.sharedClientState.updateQueryState(t, "rejected", n);
  const i = r.Na.get(t), s = i && i.key;
  if (s) {
    let e2 = new SortedMap(DocumentKey.comparator);
    e2 = e2.insert(s, MutableDocument.newNoDocument(s, SnapshotVersion.min()));
    const n2 = __PRIVATE_documentKeySet().add(s), i2 = new RemoteEvent(
      SnapshotVersion.min(),
      /* targetChanges= */
      /* @__PURE__ */ new Map(),
      /* targetMismatches= */
      new SortedMap(__PRIVATE_primitiveComparator),
      e2,
      n2
    );
    await __PRIVATE_syncEngineApplyRemoteEvent(r, i2), // Since this query failed, we won't want to manually unlisten to it.
    // We only remove it from bookkeeping after we successfully applied the
    // RemoteEvent. If `applyRemoteEvent()` throws, we want to re-listen to
    // this query when the RemoteStore restarts the Watch stream, which should
    // re-trigger the target failure.
    r.Oa = r.Oa.remove(s), r.Na.delete(t), __PRIVATE_pumpEnqueuedLimboResolutions(r);
  } else await __PRIVATE_localStoreReleaseTarget(
    r.localStore,
    t,
    /* keepPersistedTargetData */
    false
  ).then(() => __PRIVATE_removeAndCleanupTarget(r, t, n)).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss);
}
function __PRIVATE_removeAndCleanupTarget(e, t, n = null) {
  e.sharedClientState.removeLocalQueryTarget(t);
  for (const r of e.Ma.get(t)) e.Fa.delete(r), n && e.Ca.$a(r, n);
  if (e.Ma.delete(t), e.isPrimaryClient) {
    e.La.gr(t).forEach((t2) => {
      e.La.containsKey(t2) || // We removed the last reference for this key
      __PRIVATE_removeLimboTarget(e, t2);
    });
  }
}
function __PRIVATE_removeLimboTarget(e, t) {
  e.xa.delete(t.path.canonicalString());
  const n = e.Oa.get(t);
  null !== n && (__PRIVATE_remoteStoreUnlisten(e.remoteStore, n), e.Oa = e.Oa.remove(t), e.Na.delete(n), __PRIVATE_pumpEnqueuedLimboResolutions(e));
}
function __PRIVATE_updateTrackedLimbos(e, t, n) {
  for (const r of n) if (r instanceof __PRIVATE_AddedLimboDocument) e.La.addReference(r.key, t), __PRIVATE_trackLimboChange(e, r);
  else if (r instanceof __PRIVATE_RemovedLimboDocument) {
    __PRIVATE_logDebug("SyncEngine", "Document no longer in limbo: " + r.key), e.La.removeReference(r.key, t);
    e.La.containsKey(r.key) || // We removed the last reference for this key
    __PRIVATE_removeLimboTarget(e, r.key);
  } else fail();
}
function __PRIVATE_trackLimboChange(e, t) {
  const n = t.key, r = n.path.canonicalString();
  e.Oa.get(n) || e.xa.has(r) || (__PRIVATE_logDebug("SyncEngine", "New document in limbo: " + n), e.xa.add(r), __PRIVATE_pumpEnqueuedLimboResolutions(e));
}
function __PRIVATE_pumpEnqueuedLimboResolutions(e) {
  for (; e.xa.size > 0 && e.Oa.size < e.maxConcurrentLimboResolutions; ) {
    const t = e.xa.values().next().value;
    e.xa.delete(t);
    const n = new DocumentKey(ResourcePath.fromString(t)), r = e.qa.next();
    e.Na.set(r, new LimboResolution(n)), e.Oa = e.Oa.insert(n, r), __PRIVATE_remoteStoreListen(e.remoteStore, new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(n.path)), r, "TargetPurposeLimboResolution", __PRIVATE_ListenSequence.oe));
  }
}
async function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(e, t, n) {
  const r = __PRIVATE_debugCast(e), i = [], s = [], o = [];
  r.Fa.isEmpty() || (r.Fa.forEach((e2, _) => {
    o.push(r.Ka(_, t, n).then((e3) => {
      var t2;
      if ((e3 || n) && r.isPrimaryClient) {
        const i2 = e3 ? !e3.fromCache : null === (t2 = null == n ? void 0 : n.targetChanges.get(_.targetId)) || void 0 === t2 ? void 0 : t2.current;
        r.sharedClientState.updateQueryState(_.targetId, i2 ? "current" : "not-current");
      }
      if (e3) {
        i.push(e3);
        const t3 = __PRIVATE_LocalViewChanges.Wi(_.targetId, e3);
        s.push(t3);
      }
    }));
  }), await Promise.all(o), r.Ca.d_(i), await async function __PRIVATE_localStoreNotifyLocalViewChanges(e2, t2) {
    const n2 = __PRIVATE_debugCast(e2);
    try {
      await n2.persistence.runTransaction("notifyLocalViewChanges", "readwrite", (e3) => PersistencePromise.forEach(t2, (t3) => PersistencePromise.forEach(t3.$i, (r2) => n2.persistence.referenceDelegate.addReference(e3, t3.targetId, r2)).next(() => PersistencePromise.forEach(t3.Ui, (r2) => n2.persistence.referenceDelegate.removeReference(e3, t3.targetId, r2)))));
    } catch (e3) {
      if (!__PRIVATE_isIndexedDbTransactionError(e3)) throw e3;
      __PRIVATE_logDebug("LocalStore", "Failed to update sequence numbers: " + e3);
    }
    for (const e3 of t2) {
      const t3 = e3.targetId;
      if (!e3.fromCache) {
        const e4 = n2.os.get(t3), r2 = e4.snapshotVersion, i2 = e4.withLastLimboFreeSnapshotVersion(r2);
        n2.os = n2.os.insert(t3, i2);
      }
    }
  }(r.localStore, s));
}
async function __PRIVATE_syncEngineHandleCredentialChange(e, t) {
  const n = __PRIVATE_debugCast(e);
  if (!n.currentUser.isEqual(t)) {
    __PRIVATE_logDebug("SyncEngine", "User change. New user:", t.toKey());
    const e2 = await __PRIVATE_localStoreHandleUserChange(n.localStore, t);
    n.currentUser = t, // Fails tasks waiting for pending writes requested by previous user.
    function __PRIVATE_rejectOutstandingPendingWritesCallbacks(e3, t2) {
      e3.ka.forEach((e4) => {
        e4.forEach((e5) => {
          e5.reject(new FirestoreError(D.CANCELLED, t2));
        });
      }), e3.ka.clear();
    }(n, "'waitForPendingWrites' promise is rejected due to a user change."), // TODO(b/114226417): Consider calling this only in the primary tab.
    n.sharedClientState.handleUserChange(t, e2.removedBatchIds, e2.addedBatchIds), await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n, e2.hs);
  }
}
function __PRIVATE_syncEngineGetRemoteKeysForTarget(e, t) {
  const n = __PRIVATE_debugCast(e), r = n.Na.get(t);
  if (r && r.va) return __PRIVATE_documentKeySet().add(r.key);
  {
    let e2 = __PRIVATE_documentKeySet();
    const r2 = n.Ma.get(t);
    if (!r2) return e2;
    for (const t2 of r2) {
      const r3 = n.Fa.get(t2);
      e2 = e2.unionWith(r3.view.Va);
    }
    return e2;
  }
}
function __PRIVATE_ensureWatchCallbacks(e) {
  const t = __PRIVATE_debugCast(e);
  return t.remoteStore.remoteSyncer.applyRemoteEvent = __PRIVATE_syncEngineApplyRemoteEvent.bind(null, t), t.remoteStore.remoteSyncer.getRemoteKeysForTarget = __PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null, t), t.remoteStore.remoteSyncer.rejectListen = __PRIVATE_syncEngineRejectListen.bind(null, t), t.Ca.d_ = __PRIVATE_eventManagerOnWatchChange.bind(null, t.eventManager), t.Ca.$a = __PRIVATE_eventManagerOnWatchError.bind(null, t.eventManager), t;
}
class __PRIVATE_MemoryOfflineComponentProvider {
  constructor() {
    this.kind = "memory", this.synchronizeTabs = false;
  }
  async initialize(e) {
    this.serializer = __PRIVATE_newSerializer(e.databaseInfo.databaseId), this.sharedClientState = this.Wa(e), this.persistence = this.Ga(e), await this.persistence.start(), this.localStore = this.za(e), this.gcScheduler = this.ja(e, this.localStore), this.indexBackfillerScheduler = this.Ha(e, this.localStore);
  }
  ja(e, t) {
    return null;
  }
  Ha(e, t) {
    return null;
  }
  za(e) {
    return __PRIVATE_newLocalStore(this.persistence, new __PRIVATE_QueryEngine(), e.initialUser, this.serializer);
  }
  Ga(e) {
    return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.Zr, this.serializer);
  }
  Wa(e) {
    return new __PRIVATE_MemorySharedClientState();
  }
  async terminate() {
    var e, t;
    null === (e = this.gcScheduler) || void 0 === e || e.stop(), null === (t = this.indexBackfillerScheduler) || void 0 === t || t.stop(), this.sharedClientState.shutdown(), await this.persistence.shutdown();
  }
}
__PRIVATE_MemoryOfflineComponentProvider.provider = {
  build: () => new __PRIVATE_MemoryOfflineComponentProvider()
};
class OnlineComponentProvider {
  async initialize(e, t) {
    this.localStore || (this.localStore = e.localStore, this.sharedClientState = e.sharedClientState, this.datastore = this.createDatastore(t), this.remoteStore = this.createRemoteStore(t), this.eventManager = this.createEventManager(t), this.syncEngine = this.createSyncEngine(
      t,
      /* startAsPrimary=*/
      !e.synchronizeTabs
    ), this.sharedClientState.onlineStateHandler = (e2) => __PRIVATE_syncEngineApplyOnlineStateChange(
      this.syncEngine,
      e2,
      1
      /* OnlineStateSource.SharedClientState */
    ), this.remoteStore.remoteSyncer.handleCredentialChange = __PRIVATE_syncEngineHandleCredentialChange.bind(null, this.syncEngine), await __PRIVATE_remoteStoreApplyPrimaryState(this.remoteStore, this.syncEngine.isPrimaryClient));
  }
  createEventManager(e) {
    return function __PRIVATE_newEventManager() {
      return new __PRIVATE_EventManagerImpl();
    }();
  }
  createDatastore(e) {
    const t = __PRIVATE_newSerializer(e.databaseInfo.databaseId), n = function __PRIVATE_newConnection(e2) {
      return new __PRIVATE_WebChannelConnection(e2);
    }(e.databaseInfo);
    return function __PRIVATE_newDatastore(e2, t2, n2, r) {
      return new __PRIVATE_DatastoreImpl(e2, t2, n2, r);
    }(e.authCredentials, e.appCheckCredentials, n, t);
  }
  createRemoteStore(e) {
    return function __PRIVATE_newRemoteStore(e2, t, n, r, i) {
      return new __PRIVATE_RemoteStoreImpl(e2, t, n, r, i);
    }(this.localStore, this.datastore, e.asyncQueue, (e2) => __PRIVATE_syncEngineApplyOnlineStateChange(
      this.syncEngine,
      e2,
      0
      /* OnlineStateSource.RemoteStore */
    ), function __PRIVATE_newConnectivityMonitor() {
      return __PRIVATE_BrowserConnectivityMonitor.D() ? new __PRIVATE_BrowserConnectivityMonitor() : new __PRIVATE_NoopConnectivityMonitor();
    }());
  }
  createSyncEngine(e, t) {
    return function __PRIVATE_newSyncEngine(e2, t2, n, r, i, s, o) {
      const _ = new __PRIVATE_SyncEngineImpl(e2, t2, n, r, i, s);
      return o && (_.Qa = true), _;
    }(this.localStore, this.remoteStore, this.eventManager, this.sharedClientState, e.initialUser, e.maxConcurrentLimboResolutions, t);
  }
  async terminate() {
    var e, t;
    await async function __PRIVATE_remoteStoreShutdown(e2) {
      const t2 = __PRIVATE_debugCast(e2);
      __PRIVATE_logDebug("RemoteStore", "RemoteStore shutting down."), t2.L_.add(
        5
        /* OfflineCause.Shutdown */
      ), await __PRIVATE_disableNetworkInternal(t2), t2.k_.shutdown(), // Set the OnlineState to Unknown (rather than Offline) to avoid potentially
      // triggering spurious listener events with cached data, etc.
      t2.q_.set(
        "Unknown"
        /* OnlineState.Unknown */
      );
    }(this.remoteStore), null === (e = this.datastore) || void 0 === e || e.terminate(), null === (t = this.eventManager) || void 0 === t || t.terminate();
  }
}
OnlineComponentProvider.provider = {
  build: () => new OnlineComponentProvider()
};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_AsyncObserver {
  constructor(e) {
    this.observer = e, /**
     * When set to true, will not raise future events. Necessary to deal with
     * async detachment of listener.
     */
    this.muted = false;
  }
  next(e) {
    this.muted || this.observer.next && this.Ya(this.observer.next, e);
  }
  error(e) {
    this.muted || (this.observer.error ? this.Ya(this.observer.error, e) : __PRIVATE_logError("Uncaught Error in snapshot listener:", e.toString()));
  }
  Za() {
    this.muted = true;
  }
  Ya(e, t) {
    setTimeout(() => {
      this.muted || e(t);
    }, 0);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FirestoreClient {
  constructor(e, t, n, r, i) {
    this.authCredentials = e, this.appCheckCredentials = t, this.asyncQueue = n, this.databaseInfo = r, this.user = User.UNAUTHENTICATED, this.clientId = __PRIVATE_AutoId.newId(), this.authCredentialListener = () => Promise.resolve(), this.appCheckCredentialListener = () => Promise.resolve(), this._uninitializedComponentsProvider = i, this.authCredentials.start(n, async (e2) => {
      __PRIVATE_logDebug("FirestoreClient", "Received user=", e2.uid), await this.authCredentialListener(e2), this.user = e2;
    }), this.appCheckCredentials.start(n, (e2) => (__PRIVATE_logDebug("FirestoreClient", "Received new app check token=", e2), this.appCheckCredentialListener(e2, this.user)));
  }
  get configuration() {
    return {
      asyncQueue: this.asyncQueue,
      databaseInfo: this.databaseInfo,
      clientId: this.clientId,
      authCredentials: this.authCredentials,
      appCheckCredentials: this.appCheckCredentials,
      initialUser: this.user,
      maxConcurrentLimboResolutions: 100
    };
  }
  setCredentialChangeListener(e) {
    this.authCredentialListener = e;
  }
  setAppCheckTokenChangeListener(e) {
    this.appCheckCredentialListener = e;
  }
  terminate() {
    this.asyncQueue.enterRestrictedMode();
    const e = new __PRIVATE_Deferred();
    return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async () => {
      try {
        this._onlineComponents && await this._onlineComponents.terminate(), this._offlineComponents && await this._offlineComponents.terminate(), // The credentials provider must be terminated after shutting down the
        // RemoteStore as it will prevent the RemoteStore from retrieving auth
        // tokens.
        this.authCredentials.shutdown(), this.appCheckCredentials.shutdown(), e.resolve();
      } catch (t) {
        const n = __PRIVATE_wrapInUserErrorIfRecoverable(t, "Failed to shutdown persistence");
        e.reject(n);
      }
    }), e.promise;
  }
}
async function __PRIVATE_setOfflineComponentProvider(e, t) {
  e.asyncQueue.verifyOperationInProgress(), __PRIVATE_logDebug("FirestoreClient", "Initializing OfflineComponentProvider");
  const n = e.configuration;
  await t.initialize(n);
  let r = n.initialUser;
  e.setCredentialChangeListener(async (e2) => {
    r.isEqual(e2) || (await __PRIVATE_localStoreHandleUserChange(t.localStore, e2), r = e2);
  }), // When a user calls clearPersistence() in one client, all other clients
  // need to be terminated to allow the delete to succeed.
  t.persistence.setDatabaseDeletedListener(() => e.terminate()), e._offlineComponents = t;
}
async function __PRIVATE_setOnlineComponentProvider(e, t) {
  e.asyncQueue.verifyOperationInProgress();
  const n = await __PRIVATE_ensureOfflineComponents(e);
  __PRIVATE_logDebug("FirestoreClient", "Initializing OnlineComponentProvider"), await t.initialize(n, e.configuration), // The CredentialChangeListener of the online component provider takes
  // precedence over the offline component provider.
  e.setCredentialChangeListener((e2) => __PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore, e2)), e.setAppCheckTokenChangeListener((e2, n2) => __PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore, n2)), e._onlineComponents = t;
}
async function __PRIVATE_ensureOfflineComponents(e) {
  if (!e._offlineComponents) if (e._uninitializedComponentsProvider) {
    __PRIVATE_logDebug("FirestoreClient", "Using user provided OfflineComponentProvider");
    try {
      await __PRIVATE_setOfflineComponentProvider(e, e._uninitializedComponentsProvider._offline);
    } catch (t) {
      const n = t;
      if (!function __PRIVATE_canFallbackFromIndexedDbError(e2) {
        return "FirebaseError" === e2.name ? e2.code === D.FAILED_PRECONDITION || e2.code === D.UNIMPLEMENTED : !("undefined" != typeof DOMException && e2 instanceof DOMException) || // When the browser is out of quota we could get either quota exceeded
        // or an aborted error depending on whether the error happened during
        // schema migration.
        22 === e2.code || 20 === e2.code || // Firefox Private Browsing mode disables IndexedDb and returns
        // INVALID_STATE for any usage.
        11 === e2.code;
      }(n)) throw n;
      __PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: " + n), await __PRIVATE_setOfflineComponentProvider(e, new __PRIVATE_MemoryOfflineComponentProvider());
    }
  } else __PRIVATE_logDebug("FirestoreClient", "Using default OfflineComponentProvider"), await __PRIVATE_setOfflineComponentProvider(e, new __PRIVATE_MemoryOfflineComponentProvider());
  return e._offlineComponents;
}
async function __PRIVATE_ensureOnlineComponents(e) {
  return e._onlineComponents || (e._uninitializedComponentsProvider ? (__PRIVATE_logDebug("FirestoreClient", "Using user provided OnlineComponentProvider"), await __PRIVATE_setOnlineComponentProvider(e, e._uninitializedComponentsProvider._online)) : (__PRIVATE_logDebug("FirestoreClient", "Using default OnlineComponentProvider"), await __PRIVATE_setOnlineComponentProvider(e, new OnlineComponentProvider()))), e._onlineComponents;
}
async function __PRIVATE_getEventManager(e) {
  const t = await __PRIVATE_ensureOnlineComponents(e), n = t.eventManager;
  return n.onListen = __PRIVATE_syncEngineListen.bind(null, t.syncEngine), n.onUnlisten = __PRIVATE_syncEngineUnlisten.bind(null, t.syncEngine), n.onFirstRemoteStoreListen = __PRIVATE_triggerRemoteStoreListen.bind(null, t.syncEngine), n.onLastRemoteStoreUnlisten = __PRIVATE_triggerRemoteStoreUnlisten.bind(null, t.syncEngine), n;
}
function __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(e, t, n = {}) {
  const r = new __PRIVATE_Deferred();
  return e.asyncQueue.enqueueAndForget(async () => function __PRIVATE_readDocumentViaSnapshotListener(e2, t2, n2, r2, i) {
    const s = new __PRIVATE_AsyncObserver({
      next: (_) => {
        s.Za(), t2.enqueueAndForget(() => __PRIVATE_eventManagerUnlisten(e2, o));
        const a = _.docs.has(n2);
        !a && _.fromCache ? (
          // TODO(dimond): If we're online and the document doesn't
          // exist then we resolve with a doc.exists set to false. If
          // we're offline however, we reject the Promise in this
          // case. Two options: 1) Cache the negative response from
          // the server so we can deliver that even when you're
          // offline 2) Actually reject the Promise in the online case
          // if the document doesn't exist.
          i.reject(new FirestoreError(D.UNAVAILABLE, "Failed to get document because the client is offline."))
        ) : a && _.fromCache && r2 && "server" === r2.source ? i.reject(new FirestoreError(D.UNAVAILABLE, 'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')) : i.resolve(_);
      },
      error: (e3) => i.reject(e3)
    }), o = new __PRIVATE_QueryListener(__PRIVATE_newQueryForPath(n2.path), s, {
      includeMetadataChanges: true,
      _a: true
    });
    return __PRIVATE_eventManagerListen(e2, o);
  }(await __PRIVATE_getEventManager(e), e.asyncQueue, t, n, r)), r.promise;
}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_cloneLongPollingOptions(e) {
  const t = {};
  return void 0 !== e.timeoutSeconds && (t.timeoutSeconds = e.timeoutSeconds), t;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const we = /* @__PURE__ */ new Map();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function __PRIVATE_validateNonEmptyArgument(e, t, n) {
  if (!n) throw new FirestoreError(D.INVALID_ARGUMENT, `Function ${e}() cannot be called with an empty ${t}.`);
}
function __PRIVATE_validateIsNotUsedTogether(e, t, n, r) {
  if (true === t && true === r) throw new FirestoreError(D.INVALID_ARGUMENT, `${e} and ${n} cannot be used together.`);
}
function __PRIVATE_validateDocumentPath(e) {
  if (!DocumentKey.isDocumentKey(e)) throw new FirestoreError(D.INVALID_ARGUMENT, `Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`);
}
function __PRIVATE_valueDescription(e) {
  if (void 0 === e) return "undefined";
  if (null === e) return "null";
  if ("string" == typeof e) return e.length > 20 && (e = `${e.substring(0, 20)}...`), JSON.stringify(e);
  if ("number" == typeof e || "boolean" == typeof e) return "" + e;
  if ("object" == typeof e) {
    if (e instanceof Array) return "an array";
    {
      const t = (
        /** try to get the constructor name for an object. */
        function __PRIVATE_tryGetCustomObjectType(e2) {
          if (e2.constructor) return e2.constructor.name;
          return null;
        }(e)
      );
      return t ? `a custom ${t} object` : "an object";
    }
  }
  return "function" == typeof e ? "a function" : fail();
}
function __PRIVATE_cast(e, t) {
  if ("_delegate" in e && // Unwrap Compat types
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  (e = e._delegate), !(e instanceof t)) {
    if (t.name === e.constructor.name) throw new FirestoreError(D.INVALID_ARGUMENT, "Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");
    {
      const n = __PRIVATE_valueDescription(e);
      throw new FirestoreError(D.INVALID_ARGUMENT, `Expected type '${t.name}', but it was: ${n}`);
    }
  }
  return e;
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FirestoreSettingsImpl {
  constructor(e) {
    var t, n;
    if (void 0 === e.host) {
      if (void 0 !== e.ssl) throw new FirestoreError(D.INVALID_ARGUMENT, "Can't provide ssl option if host option is not set");
      this.host = "firestore.googleapis.com", this.ssl = true;
    } else this.host = e.host, this.ssl = null === (t = e.ssl) || void 0 === t || t;
    if (this.credentials = e.credentials, this.ignoreUndefinedProperties = !!e.ignoreUndefinedProperties, this.localCache = e.localCache, void 0 === e.cacheSizeBytes) this.cacheSizeBytes = 41943040;
    else {
      if (-1 !== e.cacheSizeBytes && e.cacheSizeBytes < 1048576) throw new FirestoreError(D.INVALID_ARGUMENT, "cacheSizeBytes must be at least 1048576");
      this.cacheSizeBytes = e.cacheSizeBytes;
    }
    __PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling", e.experimentalForceLongPolling, "experimentalAutoDetectLongPolling", e.experimentalAutoDetectLongPolling), this.experimentalForceLongPolling = !!e.experimentalForceLongPolling, this.experimentalForceLongPolling ? this.experimentalAutoDetectLongPolling = false : void 0 === e.experimentalAutoDetectLongPolling ? this.experimentalAutoDetectLongPolling = true : (
      // For backwards compatibility, coerce the value to boolean even though
      // the TypeScript compiler has narrowed the type to boolean already.
      // noinspection PointlessBooleanExpressionJS
      this.experimentalAutoDetectLongPolling = !!e.experimentalAutoDetectLongPolling
    ), this.experimentalLongPollingOptions = __PRIVATE_cloneLongPollingOptions(null !== (n = e.experimentalLongPollingOptions) && void 0 !== n ? n : {}), function __PRIVATE_validateLongPollingOptions(e2) {
      if (void 0 !== e2.timeoutSeconds) {
        if (isNaN(e2.timeoutSeconds)) throw new FirestoreError(D.INVALID_ARGUMENT, `invalid long polling timeout: ${e2.timeoutSeconds} (must not be NaN)`);
        if (e2.timeoutSeconds < 5) throw new FirestoreError(D.INVALID_ARGUMENT, `invalid long polling timeout: ${e2.timeoutSeconds} (minimum allowed value is 5)`);
        if (e2.timeoutSeconds > 30) throw new FirestoreError(D.INVALID_ARGUMENT, `invalid long polling timeout: ${e2.timeoutSeconds} (maximum allowed value is 30)`);
      }
    }(this.experimentalLongPollingOptions), this.useFetchStreams = !!e.useFetchStreams;
  }
  isEqual(e) {
    return this.host === e.host && this.ssl === e.ssl && this.credentials === e.credentials && this.cacheSizeBytes === e.cacheSizeBytes && this.experimentalForceLongPolling === e.experimentalForceLongPolling && this.experimentalAutoDetectLongPolling === e.experimentalAutoDetectLongPolling && function __PRIVATE_longPollingOptionsEqual(e2, t) {
      return e2.timeoutSeconds === t.timeoutSeconds;
    }(this.experimentalLongPollingOptions, e.experimentalLongPollingOptions) && this.ignoreUndefinedProperties === e.ignoreUndefinedProperties && this.useFetchStreams === e.useFetchStreams;
  }
}
class Firestore$1 {
  /** @hideconstructor */
  constructor(e, t, n, r) {
    this._authCredentials = e, this._appCheckCredentials = t, this._databaseId = n, this._app = r, /**
     * Whether it's a Firestore or Firestore Lite instance.
     */
    this.type = "firestore-lite", this._persistenceKey = "(lite)", this._settings = new FirestoreSettingsImpl({}), this._settingsFrozen = false, // A task that is assigned when the terminate() is invoked and resolved when
    // all components have shut down. Otherwise, Firestore is not terminated,
    // which can mean either the FirestoreClient is in the process of starting,
    // or restarting.
    this._terminateTask = "notTerminated";
  }
  /**
   * The {@link @firebase/app#FirebaseApp} associated with this `Firestore` service
   * instance.
   */
  get app() {
    if (!this._app) throw new FirestoreError(D.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
    return this._app;
  }
  get _initialized() {
    return this._settingsFrozen;
  }
  get _terminated() {
    return "notTerminated" !== this._terminateTask;
  }
  _setSettings(e) {
    if (this._settingsFrozen) throw new FirestoreError(D.FAILED_PRECONDITION, "Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");
    this._settings = new FirestoreSettingsImpl(e), void 0 !== e.credentials && (this._authCredentials = function __PRIVATE_makeAuthCredentialsProvider(e2) {
      if (!e2) return new __PRIVATE_EmptyAuthCredentialsProvider();
      switch (e2.type) {
        case "firstParty":
          return new __PRIVATE_FirstPartyAuthCredentialsProvider(e2.sessionIndex || "0", e2.iamToken || null, e2.authTokenFactory || null);
        case "provider":
          return e2.client;
        default:
          throw new FirestoreError(D.INVALID_ARGUMENT, "makeAuthCredentialsProvider failed due to invalid credential type");
      }
    }(e.credentials));
  }
  _getSettings() {
    return this._settings;
  }
  _freezeSettings() {
    return this._settingsFrozen = true, this._settings;
  }
  _delete() {
    return "notTerminated" === this._terminateTask && (this._terminateTask = this._terminate()), this._terminateTask;
  }
  async _restart() {
    "notTerminated" === this._terminateTask ? await this._terminate() : this._terminateTask = "notTerminated";
  }
  /** Returns a JSON-serializable representation of this `Firestore` instance. */
  toJSON() {
    return {
      app: this._app,
      databaseId: this._databaseId,
      settings: this._settings
    };
  }
  /**
   * Terminates all components used by this client. Subclasses can override
   * this method to clean up their own dependencies, but must also call this
   * method.
   *
   * Only ever called once.
   */
  _terminate() {
    return function __PRIVATE_removeComponents(e) {
      const t = we.get(e);
      t && (__PRIVATE_logDebug("ComponentProvider", "Removing Datastore"), we.delete(e), t.terminate());
    }(this), Promise.resolve();
  }
}
function connectFirestoreEmulator(e, t, n, r = {}) {
  var i;
  const s = (e = __PRIVATE_cast(e, Firestore$1))._getSettings(), o = `${t}:${n}`;
  if ("firestore.googleapis.com" !== s.host && s.host !== o && __PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."), e._setSettings(Object.assign(Object.assign({}, s), {
    host: o,
    ssl: false
  })), r.mockUserToken) {
    let t2, n2;
    if ("string" == typeof r.mockUserToken) t2 = r.mockUserToken, n2 = User.MOCK_USER;
    else {
      t2 = createMockUserToken(r.mockUserToken, null === (i = e._app) || void 0 === i ? void 0 : i.options.projectId);
      const s2 = r.mockUserToken.sub || r.mockUserToken.user_id;
      if (!s2) throw new FirestoreError(D.INVALID_ARGUMENT, "mockUserToken must contain 'sub' or 'user_id' field!");
      n2 = new User(s2);
    }
    e._authCredentials = new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(t2, n2));
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Query {
  // This is the lite version of the Query class in the main SDK.
  /** @hideconstructor protected */
  constructor(e, t, n) {
    this.converter = t, this._query = n, /** The type of this Firestore reference. */
    this.type = "query", this.firestore = e;
  }
  withConverter(e) {
    return new Query(this.firestore, e, this._query);
  }
}
class DocumentReference {
  /** @hideconstructor */
  constructor(e, t, n) {
    this.converter = t, this._key = n, /** The type of this Firestore reference. */
    this.type = "document", this.firestore = e;
  }
  get _path() {
    return this._key.path;
  }
  /**
   * The document's identifier within its collection.
   */
  get id() {
    return this._key.path.lastSegment();
  }
  /**
   * A string representing the path of the referenced document (relative
   * to the root of the database).
   */
  get path() {
    return this._key.path.canonicalString();
  }
  /**
   * The collection this `DocumentReference` belongs to.
   */
  get parent() {
    return new CollectionReference(this.firestore, this.converter, this._key.path.popLast());
  }
  withConverter(e) {
    return new DocumentReference(this.firestore, e, this._key);
  }
}
class CollectionReference extends Query {
  /** @hideconstructor */
  constructor(e, t, n) {
    super(e, t, __PRIVATE_newQueryForPath(n)), this._path = n, /** The type of this Firestore reference. */
    this.type = "collection";
  }
  /** The collection's identifier. */
  get id() {
    return this._query.path.lastSegment();
  }
  /**
   * A string representing the path of the referenced collection (relative
   * to the root of the database).
   */
  get path() {
    return this._query.path.canonicalString();
  }
  /**
   * A reference to the containing `DocumentReference` if this is a
   * subcollection. If this isn't a subcollection, the reference is null.
   */
  get parent() {
    const e = this._path.popLast();
    return e.isEmpty() ? null : new DocumentReference(
      this.firestore,
      /* converter= */
      null,
      new DocumentKey(e)
    );
  }
  withConverter(e) {
    return new CollectionReference(this.firestore, e, this._path);
  }
}
function doc(e, t, ...n) {
  if (e = getModularInstance(e), // We allow omission of 'pathString' but explicitly prohibit passing in both
  // 'undefined' and 'null'.
  1 === arguments.length && (t = __PRIVATE_AutoId.newId()), __PRIVATE_validateNonEmptyArgument("doc", "path", t), e instanceof Firestore$1) {
    const r = ResourcePath.fromString(t, ...n);
    return __PRIVATE_validateDocumentPath(r), new DocumentReference(
      e,
      /* converter= */
      null,
      new DocumentKey(r)
    );
  }
  {
    if (!(e instanceof DocumentReference || e instanceof CollectionReference)) throw new FirestoreError(D.INVALID_ARGUMENT, "Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");
    const r = e._path.child(ResourcePath.fromString(t, ...n));
    return __PRIVATE_validateDocumentPath(r), new DocumentReference(e.firestore, e instanceof CollectionReference ? e.converter : null, new DocumentKey(r));
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class __PRIVATE_AsyncQueueImpl {
  constructor(e = Promise.resolve()) {
    this.Pu = [], // Is this AsyncQueue being shut down? Once it is set to true, it will not
    // be changed again.
    this.Iu = false, // Operations scheduled to be queued in the future. Operations are
    // automatically removed after they are run or canceled.
    this.Tu = [], // visible for testing
    this.Eu = null, // Flag set while there's an outstanding AsyncQueue operation, used for
    // assertion sanity-checks.
    this.du = false, // Enabled during shutdown on Safari to prevent future access to IndexedDB.
    this.Au = false, // List of TimerIds to fast-forward delays for.
    this.Ru = [], // Backoff timer used to schedule retries for retryable operations
    this.t_ = new __PRIVATE_ExponentialBackoff(
      this,
      "async_queue_retry"
      /* TimerId.AsyncQueueRetry */
    ), // Visibility handler that triggers an immediate retry of all retryable
    // operations. Meant to speed up recovery when we regain file system access
    // after page comes into foreground.
    this.Vu = () => {
      const e2 = getDocument();
      e2 && __PRIVATE_logDebug("AsyncQueue", "Visibility state changed to " + e2.visibilityState), this.t_.jo();
    }, this.mu = e;
    const t = getDocument();
    t && "function" == typeof t.addEventListener && t.addEventListener("visibilitychange", this.Vu);
  }
  get isShuttingDown() {
    return this.Iu;
  }
  /**
   * Adds a new operation to the queue without waiting for it to complete (i.e.
   * we ignore the Promise result).
   */
  enqueueAndForget(e) {
    this.enqueue(e);
  }
  enqueueAndForgetEvenWhileRestricted(e) {
    this.fu(), // eslint-disable-next-line @typescript-eslint/no-floating-promises
    this.gu(e);
  }
  enterRestrictedMode(e) {
    if (!this.Iu) {
      this.Iu = true, this.Au = e || false;
      const t = getDocument();
      t && "function" == typeof t.removeEventListener && t.removeEventListener("visibilitychange", this.Vu);
    }
  }
  enqueue(e) {
    if (this.fu(), this.Iu)
      return new Promise(() => {
      });
    const t = new __PRIVATE_Deferred();
    return this.gu(() => this.Iu && this.Au ? Promise.resolve() : (e().then(t.resolve, t.reject), t.promise)).then(() => t.promise);
  }
  enqueueRetryable(e) {
    this.enqueueAndForget(() => (this.Pu.push(e), this.pu()));
  }
  /**
   * Runs the next operation from the retryable queue. If the operation fails,
   * reschedules with backoff.
   */
  async pu() {
    if (0 !== this.Pu.length) {
      try {
        await this.Pu[0](), this.Pu.shift(), this.t_.reset();
      } catch (e) {
        if (!__PRIVATE_isIndexedDbTransactionError(e)) throw e;
        __PRIVATE_logDebug("AsyncQueue", "Operation failed with retryable error: " + e);
      }
      this.Pu.length > 0 && // If there are additional operations, we re-schedule `retryNextOp()`.
      // This is necessary to run retryable operations that failed during
      // their initial attempt since we don't know whether they are already
      // enqueued. If, for example, `op1`, `op2`, `op3` are enqueued and `op1`
      // needs to  be re-run, we will run `op1`, `op1`, `op2` using the
      // already enqueued calls to `retryNextOp()`. `op3()` will then run in the
      // call scheduled here.
      // Since `backoffAndRun()` cancels an existing backoff and schedules a
      // new backoff on every call, there is only ever a single additional
      // operation in the queue.
      this.t_.Go(() => this.pu());
    }
  }
  gu(e) {
    const t = this.mu.then(() => (this.du = true, e().catch((e2) => {
      this.Eu = e2, this.du = false;
      const t2 = (
        /**
        * Chrome includes Error.message in Error.stack. Other browsers do not.
        * This returns expected output of message + stack when available.
        * @param error - Error or FirestoreError
        */
        function __PRIVATE_getMessageOrStack(e3) {
          let t3 = e3.message || "";
          e3.stack && (t3 = e3.stack.includes(e3.message) ? e3.stack : e3.message + "\n" + e3.stack);
          return t3;
        }(e2)
      );
      throw __PRIVATE_logError("INTERNAL UNHANDLED ERROR: ", t2), e2;
    }).then((e2) => (this.du = false, e2))));
    return this.mu = t, t;
  }
  enqueueAfterDelay(e, t, n) {
    this.fu(), // Fast-forward delays for timerIds that have been overridden.
    this.Ru.indexOf(e) > -1 && (t = 0);
    const r = DelayedOperation.createAndSchedule(this, e, t, n, (e2) => this.yu(e2));
    return this.Tu.push(r), r;
  }
  fu() {
    this.Eu && fail();
  }
  verifyOperationInProgress() {
  }
  /**
   * Waits until all currently queued tasks are finished executing. Delayed
   * operations are not run.
   */
  async wu() {
    let e;
    do {
      e = this.mu, await e;
    } while (e !== this.mu);
  }
  /**
   * For Tests: Determine if a delayed operation with a particular TimerId
   * exists.
   */
  Su(e) {
    for (const t of this.Tu) if (t.timerId === e) return true;
    return false;
  }
  /**
   * For Tests: Runs some or all delayed operations early.
   *
   * @param lastTimerId - Delayed operations up to and including this TimerId
   * will be drained. Pass TimerId.All to run all delayed operations.
   * @returns a Promise that resolves once all operations have been run.
   */
  bu(e) {
    return this.wu().then(() => {
      this.Tu.sort((e2, t) => e2.targetTimeMs - t.targetTimeMs);
      for (const t of this.Tu) if (t.skipDelay(), "all" !== e && t.timerId === e) break;
      return this.wu();
    });
  }
  /**
   * For Tests: Skip all subsequent delays for a timer id.
   */
  Du(e) {
    this.Ru.push(e);
  }
  /** Called once a DelayedOperation is run or canceled. */
  yu(e) {
    const t = this.Tu.indexOf(e);
    this.Tu.splice(t, 1);
  }
}
class Firestore extends Firestore$1 {
  /** @hideconstructor */
  constructor(e, t, n, r) {
    super(e, t, n, r), /**
     * Whether it's a {@link Firestore} or Firestore Lite instance.
     */
    this.type = "firestore", this._queue = new __PRIVATE_AsyncQueueImpl(), this._persistenceKey = (null == r ? void 0 : r.name) || "[DEFAULT]";
  }
  async _terminate() {
    if (this._firestoreClient) {
      const e = this._firestoreClient.terminate();
      this._queue = new __PRIVATE_AsyncQueueImpl(e), this._firestoreClient = void 0, await e;
    }
  }
}
function getFirestore(t, n) {
  const r = "object" == typeof t ? t : getApp(), i = "string" == typeof t ? t : "(default)", s = _getProvider(r, "firestore").getImmediate({
    identifier: i
  });
  if (!s._initialized) {
    const e = getDefaultEmulatorHostnameAndPort("firestore");
    e && connectFirestoreEmulator(s, ...e);
  }
  return s;
}
function ensureFirestoreConfigured(e) {
  if (e._terminated) throw new FirestoreError(D.FAILED_PRECONDITION, "The client has already been terminated.");
  return e._firestoreClient || __PRIVATE_configureFirestore(e), e._firestoreClient;
}
function __PRIVATE_configureFirestore(e) {
  var t, n, r;
  const i = e._freezeSettings(), s = function __PRIVATE_makeDatabaseInfo(e2, t2, n2, r2) {
    return new DatabaseInfo(e2, t2, n2, r2.host, r2.ssl, r2.experimentalForceLongPolling, r2.experimentalAutoDetectLongPolling, __PRIVATE_cloneLongPollingOptions(r2.experimentalLongPollingOptions), r2.useFetchStreams);
  }(e._databaseId, (null === (t = e._app) || void 0 === t ? void 0 : t.options.appId) || "", e._persistenceKey, i);
  e._componentsProvider || (null === (n = i.localCache) || void 0 === n ? void 0 : n._offlineComponentProvider) && (null === (r = i.localCache) || void 0 === r ? void 0 : r._onlineComponentProvider) && (e._componentsProvider = {
    _offline: i.localCache._offlineComponentProvider,
    _online: i.localCache._onlineComponentProvider
  }), e._firestoreClient = new FirestoreClient(e._authCredentials, e._appCheckCredentials, e._queue, s, e._componentsProvider && function __PRIVATE_buildComponentProvider(e2) {
    const t2 = null == e2 ? void 0 : e2._online.build();
    return {
      _offline: null == e2 ? void 0 : e2._offline.build(t2),
      _online: t2
    };
  }(e._componentsProvider));
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Bytes {
  /** @hideconstructor */
  constructor(e) {
    this._byteString = e;
  }
  /**
   * Creates a new `Bytes` object from the given Base64 string, converting it to
   * bytes.
   *
   * @param base64 - The Base64 string used to create the `Bytes` object.
   */
  static fromBase64String(e) {
    try {
      return new Bytes(ByteString.fromBase64String(e));
    } catch (e2) {
      throw new FirestoreError(D.INVALID_ARGUMENT, "Failed to construct data from Base64 string: " + e2);
    }
  }
  /**
   * Creates a new `Bytes` object from the given Uint8Array.
   *
   * @param array - The Uint8Array used to create the `Bytes` object.
   */
  static fromUint8Array(e) {
    return new Bytes(ByteString.fromUint8Array(e));
  }
  /**
   * Returns the underlying bytes as a Base64-encoded string.
   *
   * @returns The Base64-encoded string created from the `Bytes` object.
   */
  toBase64() {
    return this._byteString.toBase64();
  }
  /**
   * Returns the underlying bytes in a new `Uint8Array`.
   *
   * @returns The Uint8Array created from the `Bytes` object.
   */
  toUint8Array() {
    return this._byteString.toUint8Array();
  }
  /**
   * Returns a string representation of the `Bytes` object.
   *
   * @returns A string representation of the `Bytes` object.
   */
  toString() {
    return "Bytes(base64: " + this.toBase64() + ")";
  }
  /**
   * Returns true if this `Bytes` object is equal to the provided one.
   *
   * @param other - The `Bytes` object to compare against.
   * @returns true if this `Bytes` object is equal to the provided one.
   */
  isEqual(e) {
    return this._byteString.isEqual(e._byteString);
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class FieldPath {
  /**
   * Creates a `FieldPath` from the provided field names. If more than one field
   * name is provided, the path will point to a nested field in a document.
   *
   * @param fieldNames - A list of field names.
   */
  constructor(...e) {
    for (let t = 0; t < e.length; ++t) if (0 === e[t].length) throw new FirestoreError(D.INVALID_ARGUMENT, "Invalid field name at argument $(i + 1). Field names must not be empty.");
    this._internalPath = new FieldPath$1(e);
  }
  /**
   * Returns true if this `FieldPath` is equal to the provided one.
   *
   * @param other - The `FieldPath` to compare against.
   * @returns true if this `FieldPath` is equal to the provided one.
   */
  isEqual(e) {
    return this._internalPath.isEqual(e._internalPath);
  }
}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class GeoPoint {
  /**
   * Creates a new immutable `GeoPoint` object with the provided latitude and
   * longitude values.
   * @param latitude - The latitude as number between -90 and 90.
   * @param longitude - The longitude as number between -180 and 180.
   */
  constructor(e, t) {
    if (!isFinite(e) || e < -90 || e > 90) throw new FirestoreError(D.INVALID_ARGUMENT, "Latitude must be a number between -90 and 90, but was: " + e);
    if (!isFinite(t) || t < -180 || t > 180) throw new FirestoreError(D.INVALID_ARGUMENT, "Longitude must be a number between -180 and 180, but was: " + t);
    this._lat = e, this._long = t;
  }
  /**
   * The latitude of this `GeoPoint` instance.
   */
  get latitude() {
    return this._lat;
  }
  /**
   * The longitude of this `GeoPoint` instance.
   */
  get longitude() {
    return this._long;
  }
  /**
   * Returns true if this `GeoPoint` is equal to the provided one.
   *
   * @param other - The `GeoPoint` to compare against.
   * @returns true if this `GeoPoint` is equal to the provided one.
   */
  isEqual(e) {
    return this._lat === e._lat && this._long === e._long;
  }
  /** Returns a JSON-serializable representation of this GeoPoint. */
  toJSON() {
    return {
      latitude: this._lat,
      longitude: this._long
    };
  }
  /**
   * Actually private to JS consumers of our API, so this function is prefixed
   * with an underscore.
   */
  _compareTo(e) {
    return __PRIVATE_primitiveComparator(this._lat, e._lat) || __PRIVATE_primitiveComparator(this._long, e._long);
  }
}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class VectorValue {
  /**
   * @private
   * @internal
   */
  constructor(e) {
    this._values = (e || []).map((e2) => e2);
  }
  /**
   * Returns a copy of the raw number array form of the vector.
   */
  toArray() {
    return this._values.map((e) => e);
  }
  /**
   * Returns `true` if the two VectorValue has the same raw number arrays, returns `false` otherwise.
   */
  isEqual(e) {
    return function __PRIVATE_isPrimitiveArrayEqual(e2, t) {
      if (e2.length !== t.length) return false;
      for (let n = 0; n < e2.length; ++n) if (e2[n] !== t[n]) return false;
      return true;
    }(this._values, e._values);
  }
}
const De = new RegExp("[~\\*/\\[\\]]");
function __PRIVATE_fieldPathFromDotSeparatedString(e, t, n) {
  if (t.search(De) >= 0) throw __PRIVATE_createError(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`, e);
  try {
    return new FieldPath(...t.split("."))._internalPath;
  } catch (r) {
    throw __PRIVATE_createError(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`, e);
  }
}
function __PRIVATE_createError(e, t, n, r, i) {
  let _ = `Function ${t}() called with invalid data`;
  _ += ". ";
  let a = "";
  return new FirestoreError(D.INVALID_ARGUMENT, _ + e + a);
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class DocumentSnapshot$1 {
  // Note: This class is stripped down version of the DocumentSnapshot in
  // the legacy SDK. The changes are:
  // - No support for SnapshotMetadata.
  // - No support for SnapshotOptions.
  /** @hideconstructor protected */
  constructor(e, t, n, r, i) {
    this._firestore = e, this._userDataWriter = t, this._key = n, this._document = r, this._converter = i;
  }
  /** Property of the `DocumentSnapshot` that provides the document's ID. */
  get id() {
    return this._key.path.lastSegment();
  }
  /**
   * The `DocumentReference` for the document included in the `DocumentSnapshot`.
   */
  get ref() {
    return new DocumentReference(this._firestore, this._converter, this._key);
  }
  /**
   * Signals whether or not the document at the snapshot's location exists.
   *
   * @returns true if the document exists.
   */
  exists() {
    return null !== this._document;
  }
  /**
   * Retrieves all fields in the document as an `Object`. Returns `undefined` if
   * the document doesn't exist.
   *
   * @returns An `Object` containing all fields in the document or `undefined`
   * if the document doesn't exist.
   */
  data() {
    if (this._document) {
      if (this._converter) {
        const e = new QueryDocumentSnapshot$1(
          this._firestore,
          this._userDataWriter,
          this._key,
          this._document,
          /* converter= */
          null
        );
        return this._converter.fromFirestore(e);
      }
      return this._userDataWriter.convertValue(this._document.data.value);
    }
  }
  /**
   * Retrieves the field specified by `fieldPath`. Returns `undefined` if the
   * document or field doesn't exist.
   *
   * @param fieldPath - The path (for example 'foo' or 'foo.bar') to a specific
   * field.
   * @returns The data at the specified field location or undefined if no such
   * field exists in the document.
   */
  // We are using `any` here to avoid an explicit cast by our users.
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  get(e) {
    if (this._document) {
      const t = this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get", e));
      if (null !== t) return this._userDataWriter.convertValue(t);
    }
  }
}
class QueryDocumentSnapshot$1 extends DocumentSnapshot$1 {
  /**
   * Retrieves all fields in the document as an `Object`.
   *
   * @override
   * @returns An `Object` containing all fields in the document.
   */
  data() {
    return super.data();
  }
}
function __PRIVATE_fieldPathFromArgument(e, t) {
  return "string" == typeof t ? __PRIVATE_fieldPathFromDotSeparatedString(e, t) : t instanceof FieldPath ? t._internalPath : t._delegate._internalPath;
}
class AbstractUserDataWriter {
  convertValue(e, t = "none") {
    switch (__PRIVATE_typeOrder(e)) {
      case 0:
        return null;
      case 1:
        return e.booleanValue;
      case 2:
        return __PRIVATE_normalizeNumber(e.integerValue || e.doubleValue);
      case 3:
        return this.convertTimestamp(e.timestampValue);
      case 4:
        return this.convertServerTimestamp(e, t);
      case 5:
        return e.stringValue;
      case 6:
        return this.convertBytes(__PRIVATE_normalizeByteString(e.bytesValue));
      case 7:
        return this.convertReference(e.referenceValue);
      case 8:
        return this.convertGeoPoint(e.geoPointValue);
      case 9:
        return this.convertArray(e.arrayValue, t);
      case 11:
        return this.convertObject(e.mapValue, t);
      case 10:
        return this.convertVectorValue(e.mapValue);
      default:
        throw fail();
    }
  }
  convertObject(e, t) {
    return this.convertObjectMap(e.fields, t);
  }
  /**
   * @internal
   */
  convertObjectMap(e, t = "none") {
    const n = {};
    return forEach(e, (e2, r) => {
      n[e2] = this.convertValue(r, t);
    }), n;
  }
  /**
   * @internal
   */
  convertVectorValue(e) {
    var t, n, r;
    const i = null === (r = null === (n = null === (t = e.fields) || void 0 === t ? void 0 : t.value.arrayValue) || void 0 === n ? void 0 : n.values) || void 0 === r ? void 0 : r.map((e2) => __PRIVATE_normalizeNumber(e2.doubleValue));
    return new VectorValue(i);
  }
  convertGeoPoint(e) {
    return new GeoPoint(__PRIVATE_normalizeNumber(e.latitude), __PRIVATE_normalizeNumber(e.longitude));
  }
  convertArray(e, t) {
    return (e.values || []).map((e2) => this.convertValue(e2, t));
  }
  convertServerTimestamp(e, t) {
    switch (t) {
      case "previous":
        const n = __PRIVATE_getPreviousValue(e);
        return null == n ? null : this.convertValue(n, t);
      case "estimate":
        return this.convertTimestamp(__PRIVATE_getLocalWriteTime(e));
      default:
        return null;
    }
  }
  convertTimestamp(e) {
    const t = __PRIVATE_normalizeTimestamp(e);
    return new Timestamp(t.seconds, t.nanos);
  }
  convertDocumentKey(e, t) {
    const n = ResourcePath.fromString(e);
    __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(n));
    const r = new DatabaseId(n.get(1), n.get(3)), i = new DocumentKey(n.popFirst(5));
    return r.isEqual(t) || // TODO(b/64130202): Somehow support foreign references.
    __PRIVATE_logError(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`), i;
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class SnapshotMetadata {
  /** @hideconstructor */
  constructor(e, t) {
    this.hasPendingWrites = e, this.fromCache = t;
  }
  /**
   * Returns true if this `SnapshotMetadata` is equal to the provided one.
   *
   * @param other - The `SnapshotMetadata` to compare against.
   * @returns true if this `SnapshotMetadata` is equal to the provided one.
   */
  isEqual(e) {
    return this.hasPendingWrites === e.hasPendingWrites && this.fromCache === e.fromCache;
  }
}
class DocumentSnapshot extends DocumentSnapshot$1 {
  /** @hideconstructor protected */
  constructor(e, t, n, r, i, s) {
    super(e, t, n, r, s), this._firestore = e, this._firestoreImpl = e, this.metadata = i;
  }
  /**
   * Returns whether or not the data exists. True if the document exists.
   */
  exists() {
    return super.exists();
  }
  /**
   * Retrieves all fields in the document as an `Object`. Returns `undefined` if
   * the document doesn't exist.
   *
   * By default, `serverTimestamp()` values that have not yet been
   * set to their final value will be returned as `null`. You can override
   * this by passing an options object.
   *
   * @param options - An options object to configure how data is retrieved from
   * the snapshot (for example the desired behavior for server timestamps that
   * have not yet been set to their final value).
   * @returns An `Object` containing all fields in the document or `undefined` if
   * the document doesn't exist.
   */
  data(e = {}) {
    if (this._document) {
      if (this._converter) {
        const t = new QueryDocumentSnapshot(
          this._firestore,
          this._userDataWriter,
          this._key,
          this._document,
          this.metadata,
          /* converter= */
          null
        );
        return this._converter.fromFirestore(t, e);
      }
      return this._userDataWriter.convertValue(this._document.data.value, e.serverTimestamps);
    }
  }
  /**
   * Retrieves the field specified by `fieldPath`. Returns `undefined` if the
   * document or field doesn't exist.
   *
   * By default, a `serverTimestamp()` that has not yet been set to
   * its final value will be returned as `null`. You can override this by
   * passing an options object.
   *
   * @param fieldPath - The path (for example 'foo' or 'foo.bar') to a specific
   * field.
   * @param options - An options object to configure how the field is retrieved
   * from the snapshot (for example the desired behavior for server timestamps
   * that have not yet been set to their final value).
   * @returns The data at the specified field location or undefined if no such
   * field exists in the document.
   */
  // We are using `any` here to avoid an explicit cast by our users.
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  get(e, t = {}) {
    if (this._document) {
      const n = this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get", e));
      if (null !== n) return this._userDataWriter.convertValue(n, t.serverTimestamps);
    }
  }
}
class QueryDocumentSnapshot extends DocumentSnapshot {
  /**
   * Retrieves all fields in the document as an `Object`.
   *
   * By default, `serverTimestamp()` values that have not yet been
   * set to their final value will be returned as `null`. You can override
   * this by passing an options object.
   *
   * @override
   * @param options - An options object to configure how data is retrieved from
   * the snapshot (for example the desired behavior for server timestamps that
   * have not yet been set to their final value).
   * @returns An `Object` containing all fields in the document.
   */
  data(e = {}) {
    return super.data(e);
  }
}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function getDoc(e) {
  e = __PRIVATE_cast(e, DocumentReference);
  const t = __PRIVATE_cast(e.firestore, Firestore);
  return __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(ensureFirestoreConfigured(t), e._key).then((n) => __PRIVATE_convertToDocSnapshot(t, e, n));
}
class __PRIVATE_ExpUserDataWriter extends AbstractUserDataWriter {
  constructor(e) {
    super(), this.firestore = e;
  }
  convertBytes(e) {
    return new Bytes(e);
  }
  convertReference(e) {
    const t = this.convertDocumentKey(e, this.firestore._databaseId);
    return new DocumentReference(
      this.firestore,
      /* converter= */
      null,
      t
    );
  }
}
function __PRIVATE_convertToDocSnapshot(e, t, n) {
  const r = n.docs.get(t._key), i = new __PRIVATE_ExpUserDataWriter(e);
  return new DocumentSnapshot(e, i, t._key, r, new SnapshotMetadata(n.hasPendingWrites, n.fromCache), t.converter);
}
!function __PRIVATE_registerFirestore(e, t = true) {
  !function __PRIVATE_setSDKVersion(e2) {
    S = e2;
  }(SDK_VERSION), _registerComponent(new Component("firestore", (e2, { instanceIdentifier: n, options: r }) => {
    const i = e2.getProvider("app").getImmediate(), s = new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(e2.getProvider("auth-internal")), new __PRIVATE_FirebaseAppCheckTokenProvider(e2.getProvider("app-check-internal")), function __PRIVATE_databaseIdFromApp(e3, t2) {
      if (!Object.prototype.hasOwnProperty.apply(e3.options, ["projectId"])) throw new FirestoreError(D.INVALID_ARGUMENT, '"projectId" not provided in firebase.initializeApp.');
      return new DatabaseId(e3.options.projectId, t2);
    }(i, n), i);
    return r = Object.assign({
      useFetchStreams: t
    }, r), s._setSettings(r), s;
  }, "PUBLIC").setMultipleInstances(true)), registerVersion(w, "4.7.3", e), // BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation
  registerVersion(w, "4.7.3", "esm2017");
}();
const index_esm = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  AbstractUserDataWriter,
  Bytes,
  CollectionReference,
  DocumentReference,
  DocumentSnapshot,
  FieldPath,
  Firestore,
  FirestoreError,
  GeoPoint,
  Query,
  QueryDocumentSnapshot,
  SnapshotMetadata,
  Timestamp,
  VectorValue,
  _AutoId: __PRIVATE_AutoId,
  _ByteString: ByteString,
  _DatabaseId: DatabaseId,
  _DocumentKey: DocumentKey,
  _EmptyAuthCredentialsProvider: __PRIVATE_EmptyAuthCredentialsProvider,
  _FieldPath: FieldPath$1,
  _cast: __PRIVATE_cast,
  _logWarn: __PRIVATE_logWarn,
  _validateIsNotUsedTogether: __PRIVATE_validateIsNotUsedTogether,
  connectFirestoreEmulator,
  doc,
  ensureFirestoreConfigured,
  getDoc,
  getFirestore
}, Symbol.toStringTag, { value: "Module" }));
const firebaseConfig = {
  apiKey: "AIzaSyAKkeWOnIF3FKDsvQV4OSC-wlKUSKa6dC4",
  authDomain: "fb-ads-analyzer.firebaseapp.com",
  projectId: "fb-ads-analyzer",
  storageBucket: "fb-ads-analyzer.firebasestorage.app",
  messagingSenderId: "987730250160",
  appId: "1:987730250160:web:47d3b99a8b97612c18ae75",
  measurementId: "G-ZWJKVW0W5X"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const firebaseConfig$1 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  auth,
  db
}, Symbol.toStringTag, { value: "Module" }));
console.log("[Popup] Loaded");
document.getElementById("authSection");
const loginForm = document.getElementById("loginForm");
const userProfile = document.getElementById("userProfile");
const userEmailSpan = document.getElementById("userEmail");
const emailInput = document.getElementById("emailInput");
const passwordInput = document.getElementById("passwordInput");
const authError = document.getElementById("authError");
const mainContent = document.getElementById("mainContent");
onAuthStateChanged(auth, (user) => {
  if (user) {
    showMainContent(user);
  } else {
    showAuthForm();
  }
});
function showMainContent(user) {
  loginForm.style.display = "none";
  userProfile.style.display = "block";
  userEmailSpan.textContent = user.email;
  mainContent.style.display = "block";
}
function showAuthForm() {
  loginForm.style.display = "block";
  userProfile.style.display = "none";
  mainContent.style.display = "none";
  emailInput.value = "";
  passwordInput.value = "";
  authError.textContent = "";
}
document.addEventListener("DOMContentLoaded", () => {
  setupEventListeners();
  setupAuthListeners();
});
function setupAuthListeners() {
  var _a, _b, _c;
  (_a = document.getElementById("loginBtn")) == null ? void 0 : _a.addEventListener("click", async () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch (error) {
      authError.textContent = error.message;
    }
  });
  (_b = document.getElementById("signupBtn")) == null ? void 0 : _b.addEventListener("click", async () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
    } catch (error) {
      authError.textContent = error.message;
    }
  });
  (_c = document.getElementById("logoutBtn")) == null ? void 0 : _c.addEventListener("click", async () => {
    try {
      await signOut(auth);
    } catch (error) {
      console.error("Logout failed:", error);
    }
  });
}
function setupEventListeners() {
  var _a, _b, _c, _d;
  (_a = document.getElementById("startBtn")) == null ? void 0 : _a.addEventListener("click", startAnalysis);
  (_b = document.getElementById("reopenBtn")) == null ? void 0 : _b.addEventListener("click", reopenAnalysis);
  (_c = document.getElementById("importBtn")) == null ? void 0 : _c.addEventListener("click", () => {
    document.getElementById("fileInput").click();
  });
  (_d = document.getElementById("fileInput")) == null ? void 0 : _d.addEventListener("change", importData);
}
async function checkIfOnFacebook() {
  var _a;
  try {
    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
    const startBtn = document.getElementById("startBtn");
    if ((_a = tab == null ? void 0 : tab.url) == null ? void 0 : _a.includes("facebook.com/ads/library")) {
      console.log("[Popup] On Facebook Ads Library page");
    } else {
      console.log("[Popup] Not on Ads Library");
      if (startBtn) {
        startBtn.textContent = " Go to Ads Library";
      }
    }
  } catch (error) {
    console.error("[Popup] Error checking tab:", error);
  }
}
async function checkForExistingAnalysis() {
  try {
    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
    chrome.tabs.sendMessage(tab.id, { action: "checkExisting" }, (response) => {
      if (chrome.runtime.lastError) {
        console.log("[Popup] No existing analysis found");
        return;
      }
      if (response && response.hasOverlay) {
        console.log("[Popup] Found existing analysis");
        const reopenBtn = document.getElementById("reopenBtn");
        const description = document.getElementById("description");
        const startBtn = document.getElementById("startBtn");
        reopenBtn.style.display = "block";
        description.textContent = "Last analysis available! Reopen or start fresh.";
        startBtn.classList.remove("btn-primary");
        startBtn.classList.add("btn-secondary");
        startBtn.innerHTML = " Start New Analysis";
      }
    });
  } catch (error) {
    console.error("[Popup] Error checking for existing analysis:", error);
  }
}
async function reopenAnalysis() {
  try {
    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
    showStatus(" Reopening analysis...", "success");
    chrome.tabs.sendMessage(tab.id, { action: "reopenOverlay" }, (response) => {
      if (chrome.runtime.lastError) {
        console.error("[Popup] Error:", chrome.runtime.lastError);
        showStatus(" Error: Could not reopen", "error");
        return;
      }
      console.log("[Popup] Overlay reopened:", response);
      setTimeout(() => {
        window.close();
      }, 500);
    });
  } catch (error) {
    console.error("[Popup] Error reopening analysis:", error);
    showStatus(" Error: " + error.message, "error");
  }
}
async function startAnalysis() {
  var _a;
  try {
    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
    if (!((_a = tab == null ? void 0 : tab.url) == null ? void 0 : _a.includes("facebook.com/ads/library"))) {
      chrome.tabs.create({ url: "https://www.facebook.com/ads/library" });
      window.close();
      return;
    }
    showStatus(" Analysis started! Check the Facebook page...", "success");
    const aiConfig = await fetchAIConfig();
    chrome.tabs.sendMessage(tab.id, {
      action: "startScraping",
      aiConfig
    }, (response) => {
      if (chrome.runtime.lastError) {
        console.error("[Popup] Error:", chrome.runtime.lastError);
        showStatus(" Error: Refresh the Facebook page and try again", "error");
        return;
      }
      console.log("[Popup] Scraping started:", response);
      setTimeout(() => {
        window.close();
      }, 1500);
    });
  } catch (error) {
    console.error("[Popup] Error starting analysis:", error);
    showStatus(" Error: " + error.message, "error");
  }
}
async function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = async (e) => {
    try {
      const json = JSON.parse(e.target.result);
      if (!json.campaigns) {
        showStatus(" Invalid file format (missing campaigns)", "error");
        return;
      }
      if (!json.campaigns) {
        showStatus(" Invalid file format (missing campaigns)", "error");
        return;
      }
      const aiConfig = await fetchAIConfig();
      const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
      if (!tab) return;
      chrome.tabs.sendMessage(tab.id, {
        action: "importData",
        data: json,
        aiConfig
      }, (response) => {
        if (chrome.runtime.lastError) {
          showStatus(" Error: Refresh the page and try again", "error");
          return;
        }
        console.log("[Popup] Data loaded:", response);
        setTimeout(() => {
          window.close();
        }, 1500);
      });
    } catch (err) {
      showStatus(" Failed to parse JSON: " + err.message, "error");
    }
  };
  reader.readAsText(file);
  event.target.value = "";
}
async function fetchAIConfig() {
  let aiConfig = null;
  try {
    console.log("[Popup] Fetching AI settings. Auth User:", auth.currentUser ? auth.currentUser.uid : "null");
    const { db: db2 } = await __vitePreload(async () => {
      const { db: db3 } = await Promise.resolve().then(() => firebaseConfig$1);
      return { db: db3 };
    }, true ? void 0 : void 0);
    const { doc: doc2, getDoc: getDoc2 } = await __vitePreload(async () => {
      const { doc: doc3, getDoc: getDoc3 } = await Promise.resolve().then(() => index_esm);
      return { doc: doc3, getDoc: getDoc3 };
    }, true ? void 0 : void 0);
    const docRef = doc2(db2, "settings", "config");
    const docSnap = await getDoc2(docRef);
    if (docSnap.exists()) {
      aiConfig = docSnap.data();
    } else {
      console.warn("[Popup]  No AI settings found.");
    }
  } catch (err) {
    console.error("[Popup]  Error fetching AI settings:", err);
  }
  return aiConfig;
}
function showStatus(text, type) {
  const status = document.getElementById("status");
  status.textContent = text;
  status.className = "status show " + type;
}
function initApp() {
  checkIfOnFacebook();
  checkForExistingAnalysis();
}
const originalShowMainContent = showMainContent;
showMainContent = function(user) {
  originalShowMainContent(user);
  initApp();
};


//# sourceMappingURL=data:application/json;base64,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QUFBQSxFQUFHO0FBQUMsSUFBRSxHQUFFLENBQUM7QUFBRSxJQUFFLFVBQVUsSUFBRSxXQUFVO0FBQUMsU0FBSyxFQUFFLENBQUMsSUFBRTtBQUFXLFNBQUssRUFBRSxDQUFDLElBQUU7QUFBVyxTQUFLLEVBQUUsQ0FBQyxJQUFFO0FBQVcsU0FBSyxFQUFFLENBQUMsSUFBRTtBQUFVLFNBQUssSUFBRSxLQUFLLElBQUU7QUFBQSxFQUFFO0FBQ3ZoQixXQUFTLEVBQUUsR0FBRSxHQUFFLEdBQUU7QUFBQyxVQUFJLElBQUU7QUFBRyxRQUFJLElBQUUsTUFBTSxFQUFFO0FBQUUsUUFBRyxhQUFXLE9BQU8sRUFBRSxVQUFRLElBQUUsR0FBRSxLQUFHLEdBQUUsRUFBRSxFQUFFLEdBQUUsQ0FBQyxJQUFFLEVBQUUsV0FBVyxHQUFHLElBQUUsRUFBRSxXQUFXLEdBQUcsS0FBRyxJQUFFLEVBQUUsV0FBVyxHQUFHLEtBQUcsS0FBRyxFQUFFLFdBQVcsR0FBRyxLQUFHO0FBQUEsUUFBUSxNQUFJLElBQUUsR0FBRSxLQUFHLEdBQUUsRUFBRSxFQUFFLEdBQUUsQ0FBQyxJQUFFLEVBQUUsR0FBRyxJQUFFLEVBQUUsR0FBRyxLQUFHLElBQUUsRUFBRSxHQUFHLEtBQUcsS0FBRyxFQUFFLEdBQUcsS0FBRztBQUFHLFFBQUUsRUFBRSxFQUFFLENBQUM7QUFBRSxRQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsUUFBRSxFQUFFLEVBQUUsQ0FBQztBQUFFLFFBQUksSUFBRSxFQUFFLEVBQUUsQ0FBQztBQUFFLFFBQUlBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxZQUFVO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUNsZixJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFDMWVBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUNuZixJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLFlBQVU7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLFdBQVM7QUFBVyxRQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFDbmYsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxZQUFVO0FBQVcsUUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQy9lLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFHLElBQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFDbGZBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBRyxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxFQUFFLElBQUUsWUFBVTtBQUFXLFFBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxDQUFDLElBQUUsV0FBUztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBRyxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxFQUFFLElBQ3RmLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsRUFBRSxJQUFFLFlBQVU7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUcsSUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUNsZjtBQUFXLFFBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUM5ZTtBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsUUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLElBQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxRQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksSUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxDQUFDLElBQUUsWUFBVTtBQUFXLFFBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxJQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsTUFBRSxFQUFFLENBQUMsSUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFFLElBQUU7QUFBVyxNQUFFLEVBQUUsQ0FBQyxJQUFFLEVBQUUsRUFBRSxDQUFDLEtBQUcsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUksT0FBSztBQUFXLE1BQUUsRUFBRSxDQUFDLElBQUUsRUFBRSxFQUFFLENBQUMsSUFBRSxJQUFFO0FBQVcsTUFBRSxFQUFFLENBQUMsSUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFFLElBQUU7QUFBQSxFQUFXO0FBQ2xiLElBQUUsVUFBVSxJQUFFLFNBQVMsR0FBRSxHQUFFO2VBQVUsTUFBSSxJQUFFLEVBQUU7QUFBUSxhQUFRLElBQUUsSUFBRSxLQUFLLFdBQVUsSUFBRSxLQUFLLEdBQUUsSUFBRSxLQUFLLEdBQUUsSUFBRSxHQUFFLElBQUUsS0FBRztBQUFDLFVBQUcsS0FBRyxFQUFFLFFBQUssS0FBRyxJQUFHLEdBQUUsTUFBSyxHQUFFLENBQUMsR0FBRSxLQUFHLEtBQUs7QUFBVSxVQUFHLGFBQVcsT0FBTyxFQUFFLFFBQUssSUFBRSxLQUFHO0FBQUMsWUFBRyxFQUFFLEdBQUcsSUFBRSxFQUFFLFdBQVcsR0FBRyxHQUFFLEtBQUcsS0FBSyxXQUFVO0FBQUMsWUFBRSxNQUFLLENBQUM7QUFBRSxjQUFFO0FBQUU7QUFBQSxRQUFLO0FBQUEsTUFBQztBQUFBLFVBQU0sUUFBSyxJQUFFLElBQUcsS0FBRyxFQUFFLEdBQUcsSUFBRSxFQUFFLEdBQUcsR0FBRSxLQUFHLEtBQUssV0FBVTtBQUFDLFVBQUUsTUFBSyxDQUFDO0FBQUUsWUFBRTtBQUFFO0FBQUEsTUFBSztBQUFBLElBQUM7QUFBQyxTQUFLLElBQUU7QUFBRSxTQUFLLEtBQUc7QUFBQSxFQUFFO0FBQzlWLElBQUUsVUFBVSxJQUFFLFdBQVU7QUFBQyxRQUFJLElBQUUsT0FBTyxLQUFHLEtBQUssSUFBRSxLQUFLLFlBQVUsSUFBRSxLQUFLLGFBQVcsS0FBSyxDQUFDO0FBQUUsTUFBRSxDQUFDLElBQUU7QUFBSSxhQUFRLElBQUUsR0FBRSxJQUFFLEVBQUUsU0FBTyxHQUFFLEVBQUUsRUFBRSxHQUFFLENBQUMsSUFBRTtBQUFFLFFBQUksSUFBRSxJQUFFLEtBQUs7QUFBRSxTQUFJLElBQUUsRUFBRSxTQUFPLEdBQUUsSUFBRSxFQUFFLFFBQU8sRUFBRSxFQUFFLEdBQUUsQ0FBQyxJQUFFLElBQUUsS0FBSSxLQUFHO0FBQUksU0FBSyxFQUFFLENBQUM7QUFBRSxRQUFFLE1BQU0sRUFBRTtBQUFFLFNBQUksSUFBRSxJQUFFLEdBQUUsSUFBRSxHQUFFLEVBQUUsRUFBRSxVQUFRLElBQUUsR0FBRSxLQUFHLEdBQUUsS0FBRyxFQUFFLEdBQUUsR0FBRyxJQUFFLEtBQUssRUFBRSxDQUFDLE1BQUksSUFBRTtBQUFJLFdBQU87QUFBQSxFQUFDO0FBQUUsV0FBUyxFQUFFLEdBQUUsR0FBRTtBQUFDLFFBQUksSUFBRTtBQUFFLFdBQU8sT0FBTyxVQUFVLGVBQWUsS0FBSyxHQUFFLENBQUMsSUFBRSxFQUFFLENBQUMsSUFBRSxFQUFFLENBQUMsSUFBRSxFQUFFLENBQUM7QUFBQSxFQUFDO0FBQUMsV0FBUyxFQUFFLEdBQUUsR0FBRTtBQUFDLFNBQUssSUFBRTtBQUFFLGFBQVEsSUFBRSxJQUFHLElBQUUsTUFBRyxJQUFFLEVBQUUsU0FBTyxHQUFFLEtBQUcsR0FBRSxLQUFJO0FBQUMsVUFBSSxJQUFFLEVBQUUsQ0FBQyxJQUFFO0FBQUUsV0FBRyxLQUFHLE1BQUksRUFBRSxDQUFDLElBQUUsR0FBRSxJQUFFO0FBQUEsSUFBSTtBQUFDLFNBQUssSUFBRTtBQUFBLEVBQUU7QUFBQyxNQUFJLElBQUU7QUFBRyxXQUFTLEVBQUUsR0FBRTtBQUFDLFdBQU8sUUFBTSxLQUFHLE1BQUksSUFBRSxFQUFFLEdBQUUsU0FBUyxHQUFFO0FBQUMsYUFBTyxJQUFJLEVBQUUsQ0FBQyxJQUFFLENBQUMsR0FBRSxJQUFFLElBQUUsS0FBRyxDQUFDO0FBQUEsSUFBQyxDQUFDLElBQUUsSUFBSSxFQUFFLENBQUMsSUFBRSxDQUFDLEdBQUUsSUFBRSxJQUFFLEtBQUcsQ0FBQztBQUFBLEVBQUM7QUFBQyxXQUFTbUIsR0FBRSxHQUFFO0FBQUMsUUFBRyxNQUFNLENBQUMsS0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLFFBQU9LO0FBQUUsUUFBRyxJQUFFLEVBQUUsUUFBTyxFQUFFTCxHQUFFLENBQUMsQ0FBQyxDQUFDO0FBQUUsYUFBUSxJQUFFLElBQUcsSUFBRSxHQUFFLElBQUUsR0FBRSxLQUFHLEdBQUUsSUFBSSxHQUFFLENBQUMsSUFBRSxJQUFFLElBQUUsR0FBRSxLQUFHO0FBQVcsV0FBTyxJQUFJLEVBQUUsR0FBRSxDQUFDO0FBQUEsRUFBQztBQUNudkIsV0FBUyxFQUFFLEdBQUUsR0FBRTtBQUFDLFFBQUcsS0FBRyxFQUFFLE9BQU8sT0FBTSxNQUFNLG1DQUFtQztBQUFFLFFBQUUsS0FBRztBQUFHLFFBQUcsSUFBRSxLQUFHLEtBQUcsRUFBRSxPQUFNLE1BQU0seUJBQXVCLENBQUM7QUFBRSxRQUFHLE9BQUssRUFBRSxPQUFPLENBQUMsRUFBRSxRQUFPLEVBQUUsRUFBRSxFQUFFLFVBQVUsQ0FBQyxHQUFFLENBQUMsQ0FBQztBQUFFLFFBQUcsS0FBRyxFQUFFLFFBQVEsR0FBRyxFQUFFLE9BQU0sTUFBTSw2Q0FBNkM7QUFBRSxhQUFRLElBQUVBLEdBQUUsS0FBSyxJQUFJLEdBQUUsQ0FBQyxDQUFDLEdBQUUsSUFBRUssSUFBRSxJQUFFLEdBQUUsSUFBRSxFQUFFLFFBQU8sS0FBRyxHQUFFO0FBQUMsVUFBSSxJQUFFLEtBQUssSUFBSSxHQUFFLEVBQUUsU0FBTyxDQUFDLEdBQUV4QixLQUFFLFNBQVMsRUFBRSxVQUFVLEdBQUUsSUFBRSxDQUFDLEdBQUUsQ0FBQztBQUFFLFVBQUUsS0FBRyxJQUFFbUIsR0FBRSxLQUFLLElBQUksR0FBRSxDQUFDLENBQUMsR0FBRSxJQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSUEsR0FBRW5CLEVBQUMsQ0FBQyxNQUFJLElBQUUsRUFBRSxFQUFFLENBQUMsR0FBRSxJQUFFLEVBQUUsSUFBSW1CLEdBQUVuQixFQUFDLENBQUM7QUFBQSxJQUFHO0FBQUMsV0FBTztBQUFBLEVBQUM7QUFBQyxNQUFJd0IsS0FBRSxFQUFFLENBQUMsR0FBRSxJQUFFLEVBQUUsQ0FBQyxHQUFFLElBQUUsRUFBRSxRQUFRO0FBQUUsTUFBRSxFQUFFO0FBQ2xmLElBQUUsSUFBRSxXQUFVO0FBQUMsUUFBRyxFQUFFLElBQUksRUFBRSxRQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBQztBQUFHLGFBQVEsSUFBRSxHQUFFLElBQUUsR0FBRSxJQUFFLEdBQUUsSUFBRSxLQUFLLEVBQUUsUUFBTyxLQUFJO0FBQUMsVUFBSSxJQUFFLEtBQUssRUFBRSxDQUFDO0FBQUUsWUFBSSxLQUFHLElBQUUsSUFBRSxhQUFXLEtBQUc7QUFBRSxXQUFHO0FBQUEsSUFBVztBQUFDLFdBQU87QUFBQSxFQUFDO0FBQUUsSUFBRSxXQUFTLFNBQVMsR0FBRTtBQUFDLFFBQUUsS0FBRztBQUFHLFFBQUcsSUFBRSxLQUFHLEtBQUcsRUFBRSxPQUFNLE1BQU0seUJBQXVCLENBQUM7QUFBRSxRQUFHQyxHQUFFLElBQUksRUFBRSxRQUFPO0FBQUksUUFBRyxFQUFFLElBQUksRUFBRSxRQUFPLE1BQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDO0FBQUUsYUFBUSxJQUFFTixHQUFFLEtBQUssSUFBSSxHQUFFLENBQUMsQ0FBQyxHQUFFLElBQUUsTUFBSyxJQUFFLFFBQUs7QUFBQyxVQUFJLElBQUVPLEdBQUUsR0FBRSxDQUFDLEVBQUU7QUFBRSxVQUFFLEVBQUUsR0FBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQUUsVUFBSSxNQUFJLElBQUUsRUFBRSxFQUFFLFNBQU8sRUFBRSxFQUFFLENBQUMsSUFBRSxFQUFFLE9BQUssR0FBRyxTQUFTLENBQUM7QUFBRSxVQUFFO0FBQUUsVUFBR0QsR0FBRSxDQUFDLEVBQUUsUUFBTyxJQUFFO0FBQUUsYUFBSyxJQUFFLEVBQUUsU0FBUSxLQUFFLE1BQUk7QUFBRSxVQUFFLElBQUU7QUFBQSxJQUFFO0FBQUEsRUFBQztBQUM3ZCxJQUFFLElBQUUsU0FBUyxHQUFFO0FBQUMsV0FBTyxJQUFFLElBQUUsSUFBRSxJQUFFLEtBQUssRUFBRSxTQUFPLEtBQUssRUFBRSxDQUFDLElBQUUsS0FBSztBQUFBLEVBQUM7QUFBRSxXQUFTQSxHQUFFLEdBQUU7QUFBQyxRQUFHLEtBQUcsRUFBRSxFQUFFLFFBQU87QUFBRyxhQUFRLElBQUUsR0FBRSxJQUFFLEVBQUUsRUFBRSxRQUFPLElBQUksS0FBRyxLQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBTztBQUFHLFdBQU87QUFBQSxFQUFFO0FBQUMsV0FBUyxFQUFFLEdBQUU7QUFBQyxXQUFPLE1BQUksRUFBRTtBQUFBLEVBQUM7QUFBQyxJQUFFLElBQUUsU0FBUyxHQUFFO0FBQUMsUUFBRSxFQUFFLE1BQUssQ0FBQztBQUFFLFdBQU8sRUFBRSxDQUFDLElBQUUsS0FBR0EsR0FBRSxDQUFDLElBQUUsSUFBRTtBQUFBLEVBQUM7QUFBRSxXQUFTLEVBQUUsR0FBRTtBQUFDLGFBQVEsSUFBRSxFQUFFLEVBQUUsUUFBTyxJQUFFLElBQUcsSUFBRSxHQUFFLElBQUUsR0FBRSxJQUFJLEdBQUUsQ0FBQyxJQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7QUFBRSxXQUFRLElBQUksRUFBRSxHQUFFLENBQUMsRUFBRSxDQUFDLEVBQUcsSUFBSSxDQUFDO0FBQUEsRUFBQztBQUFDLElBQUUsTUFBSSxXQUFVO0FBQUMsV0FBTyxFQUFFLElBQUksSUFBRSxFQUFFLElBQUksSUFBRTtBQUFBLEVBQUk7QUFDNVgsSUFBRSxNQUFJLFNBQVMsR0FBRTtBQUFDLGFBQVEsSUFBRSxLQUFLLElBQUksS0FBSyxFQUFFLFFBQU8sRUFBRSxFQUFFLE1BQU0sR0FBRSxJQUFFLElBQUcsSUFBRSxHQUFFLElBQUUsR0FBRSxLQUFHLEdBQUUsS0FBSTtBQUFDLFVBQUksSUFBRSxLQUFHLEtBQUssRUFBRSxDQUFDLElBQUUsVUFBUSxFQUFFLEVBQUUsQ0FBQyxJQUFFLFFBQU96QixNQUFHLE1BQUksT0FBSyxLQUFLLEVBQUUsQ0FBQyxNQUFJLE9BQUssRUFBRSxFQUFFLENBQUMsTUFBSTtBQUFJLFVBQUVBLE9BQUk7QUFBRyxXQUFHO0FBQU0sTUFBQUEsTUFBRztBQUFNLFFBQUUsQ0FBQyxJQUFFQSxNQUFHLEtBQUc7QUFBQSxJQUFFO0FBQUMsV0FBTyxJQUFJLEVBQUUsR0FBRSxFQUFFLEVBQUUsU0FBTyxDQUFDLElBQUUsY0FBWSxLQUFHLENBQUM7QUFBQSxFQUFDO0FBQUUsV0FBUyxFQUFFLEdBQUUsR0FBRTtBQUFDLFdBQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQUEsRUFBQztBQUNwUyxJQUFFLElBQUUsU0FBUyxHQUFFO0FBQUMsUUFBR3lCLEdBQUUsSUFBSSxLQUFHQSxHQUFFLENBQUMsRUFBRSxRQUFPRDtBQUFFLFFBQUcsRUFBRSxJQUFJLEVBQUUsUUFBTyxFQUFFLENBQUMsSUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztBQUFFLFFBQUcsRUFBRSxDQUFDLEVBQUUsUUFBTyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQUUsUUFBRyxJQUFFLEtBQUssRUFBRSxDQUFDLEtBQUcsSUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLFFBQU9MLEdBQUUsS0FBSyxFQUFDLElBQUcsRUFBRSxFQUFDLENBQUU7QUFBRSxhQUFRLElBQUUsS0FBSyxFQUFFLFNBQU8sRUFBRSxFQUFFLFFBQU8sSUFBRSxJQUFHLElBQUUsR0FBRSxJQUFFLElBQUUsR0FBRSxJQUFJLEdBQUUsQ0FBQyxJQUFFO0FBQUUsU0FBSSxJQUFFLEdBQUUsSUFBRSxLQUFLLEVBQUUsUUFBTyxJQUFJLFVBQVEsSUFBRSxHQUFFLElBQUUsRUFBRSxFQUFFLFFBQU8sS0FBSTtBQUFDLFVBQUksSUFBRSxLQUFLLEVBQUUsQ0FBQyxNQUFJLElBQUduQixLQUFFLEtBQUssRUFBRSxDQUFDLElBQUUsT0FBTSxJQUFFLEVBQUUsRUFBRSxDQUFDLE1BQUksSUFBRyxJQUFFLEVBQUUsRUFBRSxDQUFDLElBQUU7QUFBTSxRQUFFLElBQUUsSUFBRSxJQUFFLENBQUMsS0FBR0EsS0FBRTtBQUFFLFFBQUUsR0FBRSxJQUFFLElBQUUsSUFBRSxDQUFDO0FBQUUsUUFBRSxJQUFFLElBQUUsSUFBRSxJQUFFLENBQUMsS0FBRyxJQUFFO0FBQUUsUUFBRSxHQUFFLElBQUUsSUFBRSxJQUFFLElBQUUsQ0FBQztBQUFFLFFBQUUsSUFBRSxJQUFFLElBQUUsSUFBRSxDQUFDLEtBQUdBLEtBQUU7QUFBRSxRQUFFLEdBQUUsSUFBRSxJQUFFLElBQUUsSUFBRSxDQUFDO0FBQUUsUUFBRSxJQUFFLElBQUUsSUFBRSxJQUFFLENBQUMsS0FBRyxJQUFFO0FBQUUsUUFBRSxHQUFFLElBQUUsSUFBRSxJQUFFLElBQUUsQ0FBQztBQUFBLElBQUU7QUFBQyxTQUFJLElB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QVMsR0FBRTtBQUFDLFdBQU8wQixHQUFFLE1BQUssQ0FBQyxFQUFFO0FBQUEsRUFBQztBQUFFLElBQUUsTUFBSSxTQUFTLEdBQUU7QUFBQyxhQUFRLElBQUUsS0FBSyxJQUFJLEtBQUssRUFBRSxRQUFPLEVBQUUsRUFBRSxNQUFNLEdBQUUsSUFBRSxJQUFHLElBQUUsR0FBRSxJQUFFLEdBQUUsSUFBSSxHQUFFLENBQUMsSUFBRSxLQUFLLEVBQUUsQ0FBQyxJQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsV0FBTyxJQUFJLEVBQUUsR0FBRSxLQUFLLElBQUUsRUFBRSxDQUFDO0FBQUEsRUFBQztBQUFFLElBQUUsS0FBRyxTQUFTLEdBQUU7QUFBQyxhQUFRLElBQUUsS0FBSyxJQUFJLEtBQUssRUFBRSxRQUFPLEVBQUUsRUFBRSxNQUFNLEdBQUUsSUFBRSxJQUFHLElBQUUsR0FBRSxJQUFFLEdBQUUsSUFBSSxHQUFFLENBQUMsSUFBRSxLQUFLLEVBQUUsQ0FBQyxJQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsV0FBTyxJQUFJLEVBQUUsR0FBRSxLQUFLLElBQUUsRUFBRSxDQUFDO0FBQUEsRUFBQztBQUN0ZCxJQUFFLE1BQUksU0FBUyxHQUFFO0FBQUMsYUFBUSxJQUFFLEtBQUssSUFBSSxLQUFLLEVBQUUsUUFBTyxFQUFFLEVBQUUsTUFBTSxHQUFFLElBQUUsSUFBRyxJQUFFLEdBQUUsSUFBRSxHQUFFLElBQUksR0FBRSxDQUFDLElBQUUsS0FBSyxFQUFFLENBQUMsSUFBRSxFQUFFLEVBQUUsQ0FBQztBQUFFLFdBQU8sSUFBSSxFQUFFLEdBQUUsS0FBSyxJQUFFLEVBQUUsQ0FBQztBQUFBLEVBQUM7QUFBRSxXQUFTLEVBQUUsR0FBRTtBQUFDLGFBQVEsSUFBRSxFQUFFLEVBQUUsU0FBTyxHQUFFLElBQUUsSUFBRyxJQUFFLEdBQUUsSUFBRSxHQUFFLElBQUksR0FBRSxDQUFDLElBQUUsRUFBRSxFQUFFLENBQUMsS0FBRyxJQUFFLEVBQUUsRUFBRSxJQUFFLENBQUMsTUFBSTtBQUFHLFdBQU8sSUFBSSxFQUFF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QUUsTUFBSyxTQUFTO0FBQUEsRUFBQztBQUN2UyxXQUFTLEdBQUcsR0FBRUEsSUFBRSxHQUFFO0FBQUMsUUFBRyxDQUFDLEVBQUUsT0FBTSxNQUFLO0FBQUcsUUFBRyxJQUFFLFVBQVUsUUFBTztBQUFDLFVBQUksSUFBRSxNQUFNLFVBQVUsTUFBTSxLQUFLLFdBQVUsQ0FBQztBQUFFLGFBQU8sV0FBVTtBQUFDLFlBQUksSUFBRSxNQUFNLFVBQVUsTUFBTSxLQUFLLFNBQVM7QUFBRSxjQUFNLFVBQVUsUUFBUSxNQUFNLEdBQUUsQ0FBQztBQUFFLGVBQU8sRUFBRSxNQUFNQSxJQUFFLENBQUM7QUFBQSxNQUFDO0FBQUEsSUFBQztBQUFDLFdBQU8sV0FBVTtBQUFDLGFBQU8sRUFBRSxNQUFNQSxJQUFFLFNBQVM7QUFBQSxJQUFDO0FBQUEsRUFBQztBQUFDLFdBQVMsRUFBRSxHQUFFQSxJQUFFLEdBQUU7QUFBQyxRQUFFLFNBQVMsVUFBVSxRQUFNLE1BQUksU0FBUyxVQUFVLEtBQUssU0FBUSxFQUFHLFFBQVEsYUFBYSxJQUFFLEtBQUc7QUFBRyxXQUFPLEVBQUUsTUFBTSxNQUFLLFNBQVM7QUFBQSxFQUFDO0FBQ2hhLFdBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsUUFBSSxJQUFFLE1BQU0sVUFBVSxNQUFNLEtBQUssV0FBVSxDQUFDO0FBQUUsV0FBTyxXQUFVO0FBQUMsVUFBSSxJQUFFLEVBQUUsTUFBSztBQUFHLFFBQUUsS0FBSyxNQUFNLEdBQUUsU0FBUztBQUFFLGFBQU8sRUFBRSxNQUFNLE1BQUssQ0FBQztBQUFBLElBQUM7QUFBQSxFQUFDO0FBQUMsV0FBUyxFQUFFLEdBQUVBLElBQUU7QUFBQyxhQUFTLElBQUc7QUFBQSxJQUFDO0FBQUMsTUFBRSxZQUFVQSxHQUFFO0FBQVUsTUFBRSxLQUFHQSxHQUFFO0FBQVUsTUFBRSxZQUFVLElBQUk7QUFBRSxNQUFFLFVBQVUsY0FBWTtBQUFFLE1BQUUsS0FBRyxTQUFTLEdBQUUsR0FBRSxHQUFFO0FBQUMsZUFBUSxJQUFFLE1BQU0sVUFBVSxTQUFPLENBQUMsR0FBRSxJQUFFLEdBQUUsSUFBRSxVQUFVLFFBQU8sSUFBSSxHQUFFLElBQUUsQ0FBQyxJQUFFLFVBQVUsQ0FBQztBQUFFLGFBQU9BLEdBQUUsVUFBVSxDQUFDLEVBQUUsTUFBTSxHQUFFLENBQUM7QUFBQSxJQUFDO0FBQUEsRUFBRTtBQUFDLFdBQVMsR0FBRyxHQUFFO0FBQUMsVUFBTUEsS0FBRSxFQUFFO0FBQU8sUUFBRyxJQUFFQSxJQUFFO0FBQUMsWUFBTSxJQUFFLE1BQU1BLEVBQUM7QUFBRSxlQUFRLElBQUUsR0FBRSxJQUFFQSxJQUFFLElBQUksR0FBRSxDQUFDLElBQUUsRUFBRSxDQUFDO0FBQUUsYUFBTztBQUFBLElBQUM7QUFBQyxXQUFPO0FBQUEsRUFBRTtBQUFDLFdBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsYUFBUSxJQUFFLEdBQUUsSUFBRSxVQUFVLFFBQU8sS0FBSTtBQUFDLFlBQU0sSUFBRSxVQUFVLENBQUM7QUFBRSxVQUFHLEdBQUcsQ0FBQyxHQUFFO0FBQUMsY0FBTSxJQUFFLEVBQUUsVUFBUSxHQUFFLElBQUUsRUFBRSxVQUFRO0FBQUUsVUFBRSxTQUFPLElBQUU7QUFBRSxpQkFBUSxJQUFFLEdBQUUsSUFBRSxHQUFFLElBQUksR0FBRSxJQUFFLENBQUMsSUFBRSxFQUFFLENBQUM7QUFBQSxNQUFFLE1BQU0sR0FBRSxLQUFLLENBQUM7QUFBQSxJQUFFO0FBQUEsRUFBQztBQUFBLEVBQUMsTUFBTSxHQUFFO0FBQUEsSUFBQyxZQUFZLEdBQUVBLElBQUU7QUFBQyxXQUFLLElBQUU7QUFBRSxXQUFLLElBQUVBO0FBQUUsV0FBSyxJQUFFO0FBQUUsV0FBSyxJQUFFO0FBQUEsSUFBSztBQUFBLElBQUMsTUFBSztBQUFDLFVBQUk7QUFBRSxVQUFFLEtBQUssS0FBRyxLQUFLLEtBQUksSUFBRSxLQUFLLEdBQUUsS0FBSyxJQUFFLEVBQUUsTUFBSyxFQUFFLE9BQUssUUFBTSxJQUFFLEtBQUssRUFBQztBQUFHLGFBQU87QUFBQSxJQUFDO0FBQUEsRUFBQztBQUFDLFdBQVMsRUFBRSxHQUFFO0FBQUMsV0FBTyxjQUFjLEtBQUssQ0FBQztBQUFBLEVBQUM7QUFBQyxXQUFTLElBQUc7QUFBQyxRQUFJLElBQUUsRUFBRTtBQUFVLFdBQU8sTUFBSSxJQUFFLEVBQUUsYUFBVyxJQUFFO0FBQUEsRUFBRTtBQUFDLFdBQVMsR0FBRyxHQUFFO0FBQUMsT0FBRyxHQUFHLEVBQUUsQ0FBQztBQUFFLFdBQU87QUFBQSxFQUFDO0FBQUMsS0FBRyxHQUFHLElBQUUsV0FBVTtBQUFBLEVBQUM7QUFBRSxNQUFJLEtBQUcsTUFBSSxFQUFDLEVBQUcsUUFBUSxPQUFPLEtBQUcsRUFBRSxNQUFJLEVBQUMsRUFBRyxZQUFXLEVBQUcsUUFBUSxRQUFRLEtBQUcsTUFBSSxFQUFDLEVBQUcsUUFBUSxNQUFNLE1BQUksRUFBRSxNQUFJLEVBQUMsRUFBRyxRQUFRLFNBQVMsS0FBRyxNQUFJLEVBQUMsRUFBRyxRQUFRLE1BQU0sTUFBSSxNQUFJLEVBQUMsRUFBRyxRQUFRLE1BQU07QUFBRSxXQUFTLEdBQUcsR0FBRUEsSUFBRSxHQUFFO0FBQUMsZUFBVSxLQUFLLEVBQUUsQ0FBQUEsR0FBRSxLQUFLLEdBQUUsRUFBRSxDQUFDLEdBQUUsR0FBRSxDQUFDO0FBQUEsRUFBRTtBQUFDLFdBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsZUFBVSxLQUFLLEVBQUUsQ0FBQUEsR0FBRSxLQUFLLFFBQU8sRUFBRSxDQUFDLEdBQUUsR0FBRSxDQUFDO0FBQUEsRUFBRTtBQUFDLFdBQVMsR0FBRyxHQUFFO0FBQUMsVUFBTUEsS0FBRTtBQUFHLGVBQVUsS0FBSyxFQUFFLENBQUFBLEdBQUUsQ0FBQyxJQUFFLEVBQUUsQ0FBQztBQUFFLFdBQU9BO0FBQUEsRUFBQztBQUFDLFFBQU0sS0FBRyxnR0FBZ0csTUFBTSxHQUFHO0FBQUUsV0FBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxRQUFJLEdBQUU7QUFBRSxhQUFRLElBQUUsR0FBRSxJQUFFLFVBQVUsUUFBTyxLQUFJO0FBQUMsVUFBRSxVQUFVLENBQUM7QUFBRSxXQUFJLEtBQUssRUFBRSxHQUFFLENBQUMsSUFBRSxFQUFFLENBQUM7QUFBRSxlQUFRLElBQUUsR0FBRSxJQUFFLEdBQUcsUUFBTyxJQUFJLEtBQUUsR0FBRyxDQUFDLEdBQUUsT0FBTyxVQUFVLGVBQWUsS0FBSyxHQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxFQUFFLENBQUM7QUFBQSxJQUFHO0FBQUEsRUFBQztBQUFDLFdBQVMsR0FBRyxHQUFFO0FBQUMsUUFBSUEsS0FBRTtBQUFFLFFBQUUsRUFBRSxNQUFNLEdBQUc7QUFBRSxVQUFNLElBQUU7QUFBRyxXQUFLLElBQUVBLE1BQUcsRUFBRSxTQUFRLEdBQUUsS0FBSyxFQUFFLE9BQU8sR0FBRUE7QUFBSSxNQUFFLFVBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxHQUFHLENBQUM7QUFBRSxXQUFPO0FBQUEsRUFBQztBQUFDLFdBQVMsR0FBRyxHQUFFO0FBQUMsTUFBRSxXQUFXLE1BQUk7QUFBQyxZQUFNO0FBQUEsSUFBRSxHQUFFLENBQUM7QUFBQSxFQUFFO0FBQUMsV0FBUyxLQUFJO0FBQUMsUUFBSSxJQUFFO0FBQUcsUUFBSUEsS0FBRTtBQUFLLE1BQUUsTUFBSUEsS0FBRSxFQUFFLEdBQUUsRUFBRSxJQUFFLEVBQUUsRUFBRSxNQUFLLEVBQUUsTUFBSSxFQUFFLElBQUUsT0FBTUEsR0FBRSxPQUFLO0FBQU0sV0FBT0E7QUFBQSxFQUFDO0FBQUEsRUFBQyxNQUFNLEdBQUU7QUFBQSxJQUFDLGNBQWE7QUFBQyxXQUFLLElBQUUsS0FBSyxJQUFFO0FBQUEsSUFBSztBQUFBLElBQUMsSUFBSSxHQUFFQSxJQUFFO0FBQUMsWUFBTSxJQUFFLEdBQUcsSUFBRztBQUFHLFFBQUUsSUFBSSxHQUFFQSxFQUFDO0FBQUUsV0FBSyxJQUFFLEtBQUssRUFBRSxPQUFLLElBQUUsS0FBSyxJQUFFO0FBQUUsV0FBSyxJQUFFO0FBQUEsSUFBRTtBQUFBLEVBQUM7QUFBQyxNQUFJLEtBQUcsSUFBSSxHQUFHLE1BQUksSUFBSSxNQUFHLE9BQUcsRUFBRSxPQUFPO0FBQUEsRUFBRSxNQUFNLEdBQUU7QUFBQSxJQUFDLGNBQWE7QUFBQyxXQUFLLE9BQUssS0FBSyxJQUFFLEtBQUssSUFBRTtBQUFBLElBQUs7QUFBQSxJQUFDLElBQUksR0FBRUEsSUFBRTtBQUFDLFdBQUssSUFBRTtBQUFFLFdBQUssSUFBRUE7QUFBRSxXQUFLLE9BQUs7QUFBQSxJQUFLO0FBQUEsSUFBQyxRQUFPO0FBQUMsV0FBSyxPQUFLLEtBQUssSUFBRSxLQUFLLElBQUU7QUFBQSxJQUFLO0FBQUEsRUFBQztBQUFDLE1BQUksR0FBRSxJQUFFLE9BQUcsS0FBRyxJQUFJLE1BQUcsS0FBRyxNQUFJO0FBQUMsVUFBTSxJQUFFLEVBQUUsUUFBUSxRQUFRLE1BQU07QUFBRSxRQUFFLE1BQUk7QUFBQyxRQUFFLEtBQUssRUFBRTtBQUFBLElBQUU7QUFBQSxFQUFFO0FBQUUsTUFBSSxLQUFHLE1BQUk7QUFBQyxhQUFRLEdBQUUsSUFBRSxRQUFNO0FBQUMsVUFBRztBQUFDLFVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQztBQUFBLE1BQUUsU0FBTyxHQUFFO0FBQUMsV0FBRyxDQUFDO0FBQUEsTUFBRTtBQUFDLFVBQUlBLEtBQUU7QUFBRyxNQUFBQSxHQUFFLEVBQUUsQ0FBQztBQUFFLFlBQUlBLEdBQUUsTUFBSUEsR0FBRSxLQUFJLEVBQUUsT0FBS0EsR0FBRSxHQUFFQSxHQUFFLElBQUU7QUFBQSxJQUFHO0FBQUMsUUFBRTtBQUFBLEVBQUc7QUFBRSxXQUFTLElBQUc7QUFBQyxTQUFLLElBQUUsS0FBSztBQUFFLFNBQUssSUFBRSxLQUFLO0FBQUEsRUFBRTtBQUFDLElBQUUsVUFBVSxJQUFFO0FBQUcsSUFBRSxVQUFVLEtBQUcsV0FBVTtBQUFDLFNBQUssTUFBSSxLQUFLLElBQUUsTUFBRyxLQUFLLEVBQUM7QUFBQSxFQUFJO0FBQUUsSUFBRSxVQUFVLElBQUUsV0FBVTtBQUFDLFFBQUcsS0FBSyxFQUFFLFFBQUssS0FBSyxFQUFFLFNBQVEsTUFBSyxFQUFFLFFBQU87QUFBQSxFQUFHO0FBQUUsV0FBUyxFQUFFLEdBQUVBLElBQUU7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QUFFLFFBQU87QUFBRSxFQUFBQSxHQUFFLFVBQVUsSUFBRSxXQUFVO0FBQUMsSUFBQUEsR0FBRSxHQUFHLEVBQUUsS0FBSyxJQUFJO0FBQUUsUUFBSSxJQUFFLEtBQUs7QUFBRSxNQUFFLGlCQUFlLEVBQUUsZUFBYyxJQUFHLEVBQUUsY0FBWTtBQUFBLEVBQUc7QUFBRSxNQUFJQyxLQUFFLHlCQUF1QixNQUFJLEtBQUssT0FBTSxJQUFHO0FBQUcsTUFBSSxLQUFHO0FBQUUsV0FBUyxHQUFHLEdBQUUxQixJQUFFLEdBQUUsR0FBRSxHQUFFO0FBQUMsU0FBSyxXQUFTO0FBQUUsU0FBSyxRQUFNO0FBQUssU0FBSyxNQUFJQTtBQUFFLFNBQUssT0FBSztBQUFFLFNBQUssVUFBUSxDQUFDLENBQUM7QUFBRSxTQUFLLEtBQUc7QUFBRSxTQUFLLE1BQUksRUFBRTtBQUFHLFNBQUssS0FBRyxLQUFLLEtBQUc7QUFBQSxFQUFHO0FBQUMsV0FBUyxHQUFHLEdBQUU7QUFBQyxNQUFFLEtBQUc7QUFBRyxNQUFFLFdBQVM7QUFBSyxNQUFFLFFBQU07QUFBSyxNQUFFLE1BQUk7QUFBSyxNQUFFLEtBQUc7QUFBQSxFQUFLO0FBQUMsV0FBUyxHQUFHLEdBQUU7QUFBQyxTQUFLLE1BQUk7QUFBRSxTQUFLLElBQUU7QUFBRyxTQUFLLElBQUU7QUFBQSxFQUFFO0FBQUMsS0FBRyxVQUFVLE1BQUksU0FBUyxHQUFFQSxJQUFFLEdBQUUsR0FBRSxHQUFFO0FBQUMsUUFBSSxJQUFFLEVBQUUsU0FBUTtBQUFHLFFBQUUsS0FBSyxFQUFFLENBQUM7QUFBRSxVQUFJLElBQUUsS0FBSyxFQUFFLENBQUMsSUFBRSxJQUFHLEtBQUs7QUFBSyxRQUFJLElBQUUsR0FBRyxHQUFFQSxJQUFFLEdBQUUsQ0FBQztBQUFFLFNBQUcsS0FBR0EsS0FBRSxFQUFFLENBQUMsR0FBRSxNQUFJQSxHQUFFLEtBQUcsV0FBTUEsS0FBRSxJQUFJLEdBQUdBLElBQUUsS0FBSyxLQUFJLEdBQUUsQ0FBQyxDQUFDLEdBQUUsQ0FBQyxHQUFFQSxHQUFFLEtBQUcs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QUU7QUFBRyxJQUFFLFVBQVUsc0JBQW9CLFNBQVMsR0FBRTFCLElBQUUsR0FBRSxHQUFFO0FBQUMsT0FBRyxNQUFLLEdBQUVBLElBQUUsR0FBRSxDQUFDO0FBQUEsRUFBRTtBQUNoWSxXQUFTLEVBQUUsR0FBRUEsSUFBRTtBQUFDLFFBQUksR0FBRSxJQUFFLEVBQUU7QUFBRSxRQUFHLEVBQUUsTUFBSSxJQUFFLElBQUcsR0FBRSxJQUFFLEVBQUUsRUFBRSxHQUFFLEtBQUssQ0FBQztBQUFFLFFBQUUsRUFBRTtBQUFFLFFBQUVBLEdBQUUsUUFBTUE7QUFBRSxRQUFHLGFBQVcsT0FBT0EsR0FBRSxDQUFBQSxLQUFFLElBQUksRUFBRUEsSUFBRSxDQUFDO0FBQUEsYUFBVUEsY0FBYSxFQUFFLENBQUFBLEdBQUUsU0FBT0EsR0FBRSxVQUFRO0FBQUEsU0FBTztBQUFDLFVBQUksSUFBRUE7QUFBRSxNQUFBQSxLQUFFLElBQUksRUFBRSxHQUFFLENBQUM7QUFBRSxTQUFHQSxJQUFFLENBQUM7QUFBQSxJQUFFO0FBQUMsUUFBRTtBQUFHLFFBQUcsRUFBRSxVQUFRLElBQUUsRUFBRSxTQUFPLEdBQUUsS0FBRyxHQUFFLEtBQUk7QUFBQyxVQUFJLElBQUVBLEdBQUUsSUFBRSxFQUFFLENBQUM7QUFBRSxVQUFFLEdBQUcsR0FBRSxHQUFFLE1BQUdBLEVBQUMsS0FBRztBQUFBLElBQUU7QUFBQyxRQUFFQSxHQUFFLElBQUU7QUFBRSxRQUFFLEdBQUcsR0FBRSxHQUFFLE1BQUdBLEVBQUMsS0FBRztBQUFFLFFBQUUsR0FBRyxHQUFFLEdBQUUsT0FBR0EsRUFBQyxLQUFHO0FBQUUsUUFBRyxFQUFFLE1BQUksSUFBRSxHQUFFLElBQUUsRUFBRSxRQUFPLElBQUksS0FBRUEsR0FBRSxJQUFFLEVBQUUsQ0FBQyxHQUFFLElBQUUsR0FBRyxHQUFFLEdBQUUsT0FBR0EsRUFBQyxLQUFHO0FBQUEsRUFBRTtBQUNsWCxJQUFFLFVBQVUsSUFBRSxXQUFVO0FBQUMsTUFBRSxHQUFHLEVBQUUsS0FBSyxJQUFJO0FBQUUsUUFBRyxLQUFLLEdBQUU7QUFBQyxVQUFJLElBQUUsS0FBSyxHQUFFO0FBQUUsV0FBSSxLQUFLLEVBQUUsR0FBRTtBQUFDLGlCQUFRLElBQUUsRUFBRSxFQUFFLENBQUMsR0FBRSxJQUFFLEdBQUUsSUFBRSxFQUFFLFFBQU8sSUFBSSxJQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQUUsZUFBTyxFQUFFLEVBQUUsQ0FBQztBQUFFLFVBQUU7QUFBQSxNQUFJO0FBQUEsSUFBQztBQUFDLFNBQUssSUFBRTtBQUFBLEVBQUs7QUFBRSxJQUFFLFVBQVUsSUFBRSxTQUFTLEdBQUVBLElBQUUsR0FBRSxHQUFFO0FBQUMsV0FBTyxLQUFLLEVBQUUsSUFBSSxPQUFPLENBQUMsR0FBRUEsSUFBRSxPQUFHLEdBQUUsQ0FBQztBQUFBLEVBQUM7QUFBRSxJQUFFLFVBQVUsSUFBRSxTQUFTLEdBQUVBLElBQUUsR0FBRSxHQUFFO0FBQUMsV0FBTyxLQUFLLEVBQUUsSUFBSSxPQUFPLENBQUMsR0FBRUEsSUFBRSxNQUFHLEdBQUUsQ0FBQztBQUFBLEVBQUM7QUFDaFQsV0FBUyxHQUFHLEdBQUVBLElBQUUsR0FBRSxHQUFFO0FBQUMsSUFBQUEsS0FBRSxFQUFFLEVBQUUsRUFBRSxPQUFPQSxFQUFDLENBQUM7QUFBRSxRQUFHLENBQUNBLEdBQUUsUUFBTztBQUFHLElBQUFBLEtBQUVBLEdBQUUsT0FBTTtBQUFHLGFBQVEsSUFBRSxNQUFHLElBQUUsR0FBRSxJQUFFQSxHQUFFLFFBQU8sRUFBRSxHQUFFO0FBQUMsVUFBSSxJQUFFQSxHQUFFLENBQUM7QUFBRSxVQUFHLEtBQUcsQ0FBQyxFQUFFLE1BQUksRUFBRSxXQUFTLEdBQUU7QUFBQyxZQUFJLElBQUUsRUFBRSxVQUFTLElBQUUsRUFBRSxNQUFJLEVBQUU7QUFBSSxVQUFFLE1BQUksR0FBRyxFQUFFLEdBQUUsQ0FBQztBQUFFLFlBQUUsVUFBSyxFQUFFLEtBQUssR0FBRSxDQUFDLEtBQUc7QUFBQSxNQUFFO0FBQUEsSUFBQztBQUFDLFdBQU8sS0FBRyxDQUFDLEVBQUU7QUFBQSxFQUFnQjtBQUFDLFdBQVMsR0FBRyxHQUFFQSxJQUFFLEdBQUU7QUFBQyxRQUFHLGVBQWEsT0FBTyxFQUFFLE9BQUksSUFBRSxFQUFFLEdBQUUsQ0FBQztBQUFBLGFBQVcsS0FBRyxjQUFZLE9BQU8sRUFBRSxZQUFZLEtBQUUsRUFBRSxFQUFFLGFBQVksQ0FBQztBQUFBLFFBQU8sT0FBTSxNQUFNLDJCQUEyQjtBQUFFLFdBQU8sYUFBVyxPQUFPQSxFQUFDLElBQUUsS0FBRyxFQUFFLFdBQVcsR0FBRUEsTUFBRyxDQUFDO0FBQUEsRUFBQztBQUFDLFdBQVMsR0FBRyxHQUFFO0FBQUMsTUFBRSxJQUFFLEdBQUcsTUFBSTtBQUFDLFFBQUUsSUFBRTtBQUFLLFFBQUUsTUFBSSxFQUFFLElBQUUsT0FBRyxHQUFHLENBQUM7QUFBQSxJQUFHLEdBQUUsRUFBRSxDQUFDO0FBQUUsVUFBTUEsS0FBRSxFQUFFO0FBQUUsTUFBRSxJQUFFO0FBQUssTUFBRSxFQUFFLE1BQU0sTUFBS0EsRUFBQztBQUFBLEVBQUU7QUFBQSxFQUFDLE1BQU0sV0FBVyxFQUFDO0FBQUEsSUFBQyxZQUFZLEdBQUVBLElBQUU7QUFBQztBQUFRLFdBQUssSUFBRTtBQUFFLFdBQUssSUFBRUE7QUFBRSxXQUFLLElBQUU7QUFBSyxXQUFLLElBQUU7QUFBRyxXQUFLLElBQUU7QUFBQSxJQUFLO0FBQUEsSUFBQyxFQUFFLEdBQUU7QUFBQyxXQUFLLElBQUU7QUFBVSxXQUFLLElBQUUsS0FBSyxJQUFFLE9BQUcsR0FBRyxJQUFJO0FBQUEsSUFBRTtBQUFBLElBQUMsSUFBRztBQUFDLFlBQU0sRUFBQztBQUFHLFdBQUssTUFBSSxFQUFFLGFBQWEsS0FBSyxDQUFDLEdBQUUsS0FBSyxJQUFFLE1BQUssS0FBSyxJQUFFLE9BQUcsS0FBSyxJQUFFO0FBQUEsSUFBTTtBQUFBLEVBQUM7QUFBQyxXQUFTLEVBQUUsR0FBRTtBQUFDLE1BQUUsS0FBSyxJQUFJO0FBQUUsU0FBSyxJQUFFO0FBQUUsU0FBSyxJQUFFO0FBQUEsRUFBRztBQUFDLElBQUUsR0FBRSxDQUFDO0FBQUUsTUFBSSxLQUFHO0FBQUcsV0FBUyxHQUFHLEdBQUU7QUFBQyxPQUFHLEVBQUUsR0FBRSxTQUFTQSxJQUFFLEdBQUU7QUFBQyxXQUFLLEVBQUUsZUFBZSxDQUFDLEtBQUcsR0FBR0EsRUFBQztBQUFBLElBQUUsR0FBRSxDQUFDO0FBQUUsTUFBRSxJQUFFO0FBQUEsRUFBRztBQUFDLElBQUUsVUFBVSxJQUFFLFdBQVU7QUFBQyxNQUFFLEdBQUcsRUFBRSxLQUFLLElBQUk7QUFBRSxPQUFHLElBQUk7QUFBQSxFQUFFO0FBQUUsSUFBRSxVQUFVLGNBQVksV0FBVTtBQUFDLFVBQU0sTUFBTSwwQ0FBMEM7QUFBQSxFQUFFO0FBQUUsTUFBSSxLQUFHLEVBQUUsS0FBSztBQUFVLE1BQUksS0FBRyxFQUFFLEtBQUs7QUFBTSxNQUFJLEtBQUcsTUFBSztBQUFBLElBQUMsVUFBVSxHQUFFO0FBQUMsYUFBTyxFQUFFLEtBQUssVUFBVSxHQUFFLE1BQU07QUFBQSxJQUFDO0FBQUEsSUFBQyxNQUFNLEdBQUU7QUFBQyxhQUFPLEVBQUUsS0FBSyxNQUFNLEdBQUUsTUFBTTtBQUFBLElBQUM7QUFBQSxFQUFDO0FBQUUsV0FBUyxLQUFJO0FBQUEsRUFBQztBQUFDLEtBQUcsVUFBVSxJQUFFO0FBQUssV0FBUyxHQUFHLEdBQUU7QUFBQyxXQUFPLEVBQUUsTUFBSSxFQUFFLElBQUUsRUFBRSxFQUFDO0FBQUEsRUFBRztBQUFDLFdBQVMsS0FBSTtBQUFBLEVBQUM7QUFBQyxNQUFJLElBQUUsRUFBQyxNQUFLLEtBQUksSUFBRyxLQUFJLElBQUcsS0FBSSxJQUFHLElBQUc7QUFBRSxXQUFTLEtBQUk7QUFBQyxNQUFFLEtBQUssTUFBSyxHQUFHO0FBQUEsRUFBRTtBQUFDLElBQUUsSUFBRyxDQUFDO0FBQUUsV0FBUyxLQUFJO0FBQUMsTUFBRSxLQUFLLE1BQUssR0FBRztBQUFBLEVBQUU7QUFBQyxJQUFFLElBQUcsQ0FBQztBQUFFLE1BQUksSUFBRSxJQUFHLEtBQUc7QUFBSyxXQUFTLEtBQUk7QUFBQyxXQUFPLEtBQUcsTUFBSSxJQUFJO0FBQUEsRUFBQztBQUFDLElBQUUsS0FBRztBQUFxQixXQUFTLEdBQUcsR0FBRTtBQUFDLE1BQUUsS0FBSyxNQUFLLEVBQUUsSUFBRyxDQUFDO0FBQUEsRUFBRTtBQUFDLElBQUUsSUFBRyxDQUFDO0FBQUUsV0FBUyxFQUFFLEdBQUU7QUFBQyxVQUFNQSxLQUFFLEdBQUU7QUFBRyxNQUFFQSxJQUFFLElBQUksR0FBR0EsRUFBQyxDQUFDO0FBQUEsRUFBRTtBQUFDLElBQUUsYUFBVztBQUFZLFdBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsTUFBRSxLQUFLLE1BQUssRUFBRSxZQUFXLENBQUM7QUFBRSxTQUFLLE9BQUtBO0FBQUEsRUFBRTtBQUFDLElBQUUsSUFBRyxDQUFDO0FBQUUsV0FBUyxFQUFFLEdBQUU7QUFBQyxVQUFNQSxLQUFFLEdBQUU7QUFBRyxNQUFFQSxJQUFFLElBQUksR0FBR0EsSUFBRSxDQUFDLENBQUM7QUFBQSxFQUFFO0FBQUMsSUFBRSxLQUFHO0FBQWMsV0FBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxNQUFFLEtBQUssTUFBSyxFQUFFLElBQUcsQ0FBQztBQUFFLFNBQUssT0FBS0E7QUFBQSxFQUFFO0FBQUMsSUFBRSxJQUFHLENBQUM7QUFDcnhELFdBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsUUFBRyxlQUFhLE9BQU8sRUFBRSxPQUFNLE1BQU0sNENBQTRDO0FBQUUsV0FBTyxFQUFFLFdBQVcsV0FBVTtBQUFDLFFBQUM7QUFBQSxJQUFHLEdBQUVBLEVBQUM7QUFBQSxFQUFDO0FBQUMsV0FBUyxLQUFJO0FBQUMsU0FBSyxJQUFFO0FBQUEsRUFBRztBQUFDLEtBQUcsVUFBVSxLQUFHLFdBQVU7QUFBQyxTQUFLLElBQUU7QUFBQSxFQUFHO0FBQUUsV0FBUyxHQUFHLEdBQUVBLElBQUUsR0FBRSxHQUFFLEdBQUUsR0FBRTtBQUFDLE1BQUUsS0FBSyxXQUFVO0FBQUMsVUFBRyxFQUFFLEVBQUUsS0FBRyxHQUFFO0FBQUMsWUFBSSxJQUFFO0FBQUcsaUJBQVEsSUFBRSxFQUFF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QUFVO0FBQUMsV0FBTztBQUFBLEVBQUU7QUFBRSxPQUFHLElBQUk7QUFBRyxXQUFTLEVBQUUsR0FBRUEsSUFBRSxHQUFFLEdBQUU7QUFBQyxTQUFLLElBQUU7QUFBRSxTQUFLLElBQUVBO0FBQUUsU0FBSyxJQUFFO0FBQUUsU0FBSyxJQUFFLEtBQUc7QUFBRSxTQUFLLElBQUUsSUFBSSxFQUFFLElBQUk7QUFBRSxTQUFLLElBQUU7QUFBSyxTQUFLLElBQUU7QUFBSyxTQUFLLElBQUU7QUFBRyxTQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUU7QUFBSyxTQUFLLElBQUU7QUFBRyxTQUFLLElBQUU7QUFBSyxTQUFLLElBQUU7QUFBRSxTQUFLLElBQUUsS0FBSyxJQUFFO0FBQUssU0FBSyxJQUFFO0FBQUcsU0FBSyxJQUFFO0FBQUcsU0FBSyxJQUFFO0FBQUUsU0FBSyxJQUFFO0FBQUssU0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFO0FBQUcsU0FBSyxJQUFFLElBQUk7QUFBQSxFQUFHO0FBQUMsV0FBUyxLQUFJO0FBQUMsU0FBSyxJQUFFO0FBQUssU0FBSyxJQUFFO0FBQUcsU0FBSyxJQUFFO0FBQUEsRUFBRztBQUFDLE1BQUksS0FBRyxJQUFHLEtBQUc7QUFBRyxXQUFTLEdBQUcsR0FBRUEsSUFBRSxHQUFFO0FBQUMsTUFBRSxJQUFFO0FBQUUsTUFBRSxJQUFFLEdBQUcsRUFBRUEsRUFBQyxDQUFDO0FBQUUsTUFBRSxJQUFFO0FBQUUsTUFBRSxJQUFFO0FBQUcsT0FBRyxHQUFFLElBQUk7QUFBQSxFQUFFO0FBQ2huQyxXQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLE1BQUUsSUFBRSxLQUFLO0FBQU0sT0FBRyxDQUFDO0FBQUUsTUFBRSxJQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsUUFBSSxJQUFFLEVBQUUsR0FBRSxJQUFFLEVBQUU7QUFBRSxVQUFNLFFBQVEsQ0FBQyxNQUFJLElBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUFHLE9BQUcsRUFBRSxHQUFFLEtBQUksQ0FBQztBQUFFLE1BQUUsSUFBRTtBQUFFLFFBQUUsRUFBRSxFQUFFO0FBQUUsTUFBRSxJQUFFLElBQUk7QUFBRyxNQUFFLElBQUUsR0FBRyxFQUFFLEdBQUUsSUFBRUEsS0FBRSxNQUFLLENBQUMsRUFBRSxDQUFDO0FBQUUsUUFBRSxFQUFFLE1BQUksRUFBRSxJQUFFLElBQUksR0FBRyxFQUFFLEVBQUUsR0FBRSxHQUFFLEVBQUUsQ0FBQyxHQUFFLEVBQUUsQ0FBQztBQUFHLElBQUFBLEtBQUUsRUFBRTtBQUFFLFFBQUUsRUFBRTtBQUFFLFFBQUUsRUFBRTtBQUFHLFFBQUksSUFBRTtBQUFtQixVQUFNLFFBQVEsQ0FBQyxNQUFJLE1BQUksR0FBRyxDQUFDLElBQUUsRUFBRSxTQUFRLElBQUksSUFBRTtBQUFJLGFBQVEsSUFBRSxHQUFFLElBQUUsRUFBRSxRQUFPLEtBQUk7QUFBQyxVQUFJLElBQUUsR0FBRyxHQUFFLEVBQUUsQ0FBQyxHQUFFLEtBQUdBLEdBQUUsYUFBWSxPQUFHQSxHQUFFLEtBQUdBLEVBQUM7QUFBRSxVQUFHLENBQUMsRUFBRTtBQUFNLE1BQUFBLEdBQUUsRUFBRSxFQUFFLEdBQUcsSUFBRTtBQUFBLElBQUU7QUFBQyxJQUFBQSxLQUFFLEVBQUUsSUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFFO0FBQUcsTUFBRSxLQUFHLEVBQUUsTUFBSSxFQUFFLElBQUUsU0FBUUEsR0FBRSxjQUFjLElBQUUscUNBQW9DLEVBQUUsRUFBRTtBQUFBLE1BQUcsRUFBRTtBQUFBLE1BQUUsRUFBRTtBQUFBLE1BQ3BmLEVBQUU7QUFBQSxNQUFFQTtBQUFBLElBQUMsTUFBSSxFQUFFLElBQUUsT0FBTSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUUsRUFBRSxHQUFFLE1BQUtBLEVBQUM7QUFBRyxNQUFDO0FBQUcsT0FBRyxFQUFFLEdBQUUsRUFBRSxHQUFFLEVBQUUsR0FBRSxFQUFFLEdBQUUsRUFBRSxHQUFFLEVBQUUsQ0FBQztBQUFBLEVBQUU7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LEtBQUcsQ0FBQyxLQUFLLE1BQUksS0FBR0EsS0FBRSxHQUFHLEtBQUssR0FBRSxJQUFJLEtBQUcsS0FBSyxJQUFFLE9BQUcsR0FBRyxJQUFJO0FBQUEsVUFBSSxNQUFNLElBQUcsS0FBSyxDQUFDLEdBQUUsT0FBSyxLQUFHLElBQUUsRUFBRSxRQUFRLGFBQWEsS0FBRyxLQUFLLElBQUUsR0FBRSxFQUFFLEVBQUUsTUFBSSxLQUFLLElBQUUsR0FBRSxFQUFFLEVBQUUsSUFBRyxFQUFFLElBQUksR0FBRSxHQUFHLElBQUk7QUFBQSxRQUFFO0FBQUEsTUFBQztBQUFBLElBQUMsU0FBT0EsSUFBRTtBQUFBLElBQUMsVUFBQztBQUFBLElBQVE7QUFBQSxFQUFDO0FBQUUsV0FBUyxHQUFHLEdBQUU7QUFBQyxXQUFPLEVBQUUsSUFBRSxTQUFPLEVBQUUsS0FBRyxLQUFHLEVBQUUsS0FBRyxFQUFFLEVBQUUsS0FBRztBQUFBLEVBQUU7QUFDelUsV0FBUyxHQUFHLEdBQUV4QixJQUFFO0FBQUMsUUFBSSxJQUFFLEVBQUUsR0FBRSxJQUFFQSxHQUFFLFFBQVEsTUFBSyxDQUFDO0FBQUUsUUFBRyxNQUFJLEVBQUUsUUFBTztBQUFHLFFBQUUsT0FBT0EsR0FBRSxVQUFVLEdBQUUsQ0FBQyxDQUFDO0FBQUUsUUFBRyxNQUFNLENBQUMsRUFBRSxRQUFPO0FBQUcsU0FBRztBQUFFLFFBQUcsSUFBRSxJQUFFQSxHQUFFLE9BQU8sUUFBTztBQUFHLElBQUFBLEtBQUVBLEdBQUUsTUFBTSxHQUFFLElBQUUsQ0FBQztBQUFFLE1BQUUsSUFBRSxJQUFFO0FBQUUsV0FBT0E7QUFBQSxFQUFDO0FBQUMsSUFBRSxVQUFVLFNBQU8sV0FBVTtBQUFDLFNBQUssSUFBRTtBQUFHLE1BQUUsSUFBSTtBQUFBLEVBQUU7QUFBRSxXQUFTLEdBQUcsR0FBRTtBQUFDLE1BQUUsSUFBRSxLQUFLLElBQUcsSUFBRyxFQUFFO0FBQUUsT0FBRyxHQUFFLEVBQUUsQ0FBQztBQUFBLEVBQUU7QUFBQyxXQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFFBQUcsUUFBTSxFQUFFLEVBQUUsT0FBTSxNQUFNLHlCQUF5QjtBQUFFLE1BQUUsSUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFHLENBQUMsR0FBRUEsRUFBQztBQUFBLEVBQUU7QUFBQyxXQUFTLEdBQUcsR0FBRTtBQUFDLE1BQUUsTUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDLEdBQUUsRUFBRSxJQUFFO0FBQUEsRUFBTTtBQUNoYSxJQUFFLFVBQVUsS0FBRyxXQUFVO0FBQUMsU0FBSyxJQUFFO0FBQUssVUFBTSxJQUFFLEtBQUssSUFBRztBQUFHLFNBQUcsSUFBRSxLQUFLLEtBQUcsR0FBRyxLQUFLLEdBQUUsS0FBSyxDQUFDLEdBQUUsS0FBRyxLQUFLLE1BQUksRUFBQyxHQUFHLEVBQUUsRUFBRSxJQUFHLEVBQUUsSUFBSSxHQUFFLEtBQUssSUFBRSxHQUFFLEdBQUcsSUFBSSxLQUFHLEdBQUcsTUFBSyxLQUFLLElBQUUsQ0FBQztBQUFBLEVBQUU7QUFBRSxXQUFTLEdBQUcsR0FBRTtBQUFDLFNBQUcsRUFBRSxFQUFFLEtBQUcsRUFBRSxLQUFHLEdBQUcsRUFBRSxHQUFFLENBQUM7QUFBQSxFQUFFO0FBQUMsV0FBUyxFQUFFLEdBQUU7QUFBQyxPQUFHLENBQUM7QUFBRSxRQUFJQSxLQUFFLEVBQUU7QUFBRSxJQUFBQSxNQUFHLGNBQVksT0FBT0EsR0FBRSxNQUFJQSxHQUFFLEdBQUU7QUFBRyxNQUFFLElBQUU7QUFBSyxPQUFHLEVBQUUsQ0FBQztBQUFFLE1BQUUsTUFBSUEsS0FBRSxFQUFFLEdBQUUsRUFBRSxJQUFFLE1BQUtBLEdBQUUsU0FBUUEsR0FBRSxHQUFFO0FBQUEsRUFBSTtBQUNoVSxXQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFFBQUc7QUFBQyxVQUFJLElBQUUsRUFBRTtBQUFFLFVBQUcsS0FBRyxFQUFFLE1BQUksRUFBRSxLQUFHLEtBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQztBQUFHLFlBQUcsQ0FBQyxFQUFFLEtBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQyxLQUFHLEtBQUcsRUFBRSxHQUFF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RSxJQUFFLEVBQUUsUUFBTyxLQUFJO0FBQUMsWUFBSSxJQUFFLEVBQUUsQ0FBQyxFQUFFLFFBQVEsR0FBRyxHQUFFLElBQUU7QUFBSyxZQUFHLEtBQUcsR0FBRTtBQUFDLGNBQUksSUFBRSxFQUFFLENBQUMsRUFBRSxVQUFVLEdBQUUsQ0FBQztBQUFFLGNBQUUsRUFBRSxDQUFDLEVBQUUsVUFBVSxJQUFFLENBQUM7QUFBQSxRQUFFLE1BQU0sS0FBRSxFQUFFLENBQUM7QUFBRSxRQUFBQSxHQUFFLEdBQUUsSUFBRSxtQkFBbUIsRUFBRSxRQUFRLE9BQU0sR0FBRyxDQUFDLElBQUUsRUFBRTtBQUFBLE1BQUU7QUFBQSxJQUFDO0FBQUEsRUFBQztBQUFDLFdBQVMsRUFBRSxHQUFFO0FBQUMsU0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUU7QUFBRyxTQUFLLElBQUU7QUFBSyxTQUFLLElBQUUsS0FBSyxJQUFFO0FBQUcsU0FBSyxJQUFFO0FBQUcsUUFBRyxhQUFhLEdBQUU7QUFBQyxXQUFLLElBQUUsRUFBRTtBQUFFLFNBQUcsTUFBSyxFQUFFLENBQUM7QUFBRSxXQUFLLElBQUUsRUFBRTtBQUFFLFdBQUssSUFBRSxFQUFFO0FBQUUsU0FBRyxNQUFLLEVBQUUsQ0FBQztBQUFFLFdBQUssSUFBRSxFQUFFO0FBQUUsVUFBSUEsS0FBRSxFQUFFO0FBQUUsVUFBSSxJQUFFLElBQUk7QUFBRyxRQUFFLElBQUVBLEdBQUU7QUFBRSxNQUFBQSxHQUFFLE1BQUksRUFBRSxJQUFFLElBQUksSUFBSUEsR0FBRSxDQUFDLEdBQUUsRUFBRSxJQUFFQSxHQUFFO0FBQUcsU0FBRyxNQUFLLENBQUM7QUFBRSxXQUFLLElBQUUsRUFBRTtBQUFBLElBQUUsTUFBTSxPQUFJQSxLQUFFLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxNQUFJLEtBQUssSUFBRSxPQUFHLEdBQUcsTUFBS0EsR0FBRSxDQUFDLEtBQUcsSUFBRyxJQUFFLEdBQUUsS0FBSyxJQUFFLEdBQUdBLEdBQUUsQ0FBQyxLQUFHLEVBQUUsR0FBRSxLQUFLLElBQUUsR0FBR0EsR0FBRSxDQUFDLEtBQUcsSUFBRyxJQUFFLEdBQUUsR0FBRyxNQUFLQSxHQUFFLENBQUMsQ0FBQyxHQUFFLEtBQUssSUFBRSxHQUFHQSxHQUFFLENBQUMsS0FBRyxJQUFHLElBQUUsR0FBRSxHQUFHLE1BQUtBLEdBQUUsQ0FBQyxLQUFHLElBQUcsSUFBRSxHQUFFLEtBQUssSUFBRSxHQUFHQSxHQUFFLENBQUMsS0FBRyxFQUFFLE1BQUksS0FBSyxJQUFFLE9BQUcsS0FBSyxJQUFFLElBQUksR0FBRyxNQUFLLEtBQUssQ0FBQztBQUFBLEVBQUc7QUFDNWpDLElBQUUsVUFBVSxXQUFTLFdBQVU7QUFBQyxRQUFJLElBQUUsSUFBR0EsS0FBRSxLQUFLO0FBQUUsSUFBQUEsTUFBRyxFQUFFLEtBQUssR0FBR0EsSUFBRSxJQUFHLElBQUUsR0FBRSxHQUFHO0FBQUUsUUFBSSxJQUFFLEtBQUs7QUFBRSxRQUFHLEtBQUcsVUFBUUEsR0FBRSxHQUFFLEtBQUssSUFBSSxJQUFHQSxLQUFFLEtBQUssTUFBSSxFQUFFLEtBQUssR0FBR0EsSUFBRSxJQUFHLElBQUUsR0FBRSxHQUFHLEdBQUUsRUFBRSxLQUFLLG1CQUFtQixPQUFPLENBQUMsQ0FBQyxFQUFFLFFBQVEsd0JBQXVCLEtBQUssQ0FBQyxHQUFFLElBQUUsS0FBSyxHQUFFLFFBQU0sS0FBRyxFQUFFLEtBQUssS0FBSSxPQUFPLENBQUMsQ0FBQztBQUFFLFFBQUcsSUFBRSxLQUFLLEVBQUUsTUFBSyxLQUFHLE9BQUssRUFBRSxPQUFPLENBQUMsS0FBRyxFQUFFLEtBQUssR0FBRyxHQUFFLEVBQUUsS0FBSyxHQUFHLEdBQUUsT0FBSyxFQUFFLE9BQU8sQ0FBQyxJQUFFLEtBQUcsSUFBRyxJQUFFLENBQUM7QUFBRSxLQUFDLElBQUUsS0FBSyxFQUFFLFNBQVEsTUFBSyxFQUFFLEtBQUssS0FBSSxDQUFDO0FBQUUsS0FBQyxJQUFFLEtBQUssTUFBSSxFQUFFLEtBQUssS0FBSSxHQUFHLEdBQUUsRUFBRSxDQUFDO0FBQUUsV0FBTyxFQUFFLEtBQUss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STtBQUFFLFdBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsTUFBRSxDQUFDO0FBQUUsSUFBQUEsS0FBRSxFQUFFLEdBQUVBLEVBQUM7QUFBRSxNQUFFLEVBQUUsSUFBSUEsRUFBQyxNQUFJLEVBQUUsSUFBRSxNQUFLLEVBQUUsS0FBRyxFQUFFLEVBQUUsSUFBSUEsRUFBQyxFQUFFLFFBQU8sRUFBRSxFQUFFLE9BQU9BLEVBQUM7QUFBQSxFQUFHO0FBQUMsV0FBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxNQUFFLENBQUM7QUFBRSxJQUFBQSxLQUFFLEVBQUUsR0FBRUEsRUFBQztBQUFFLFdBQU8sRUFBRSxFQUFFLElBQUlBLEVBQUM7QUFBQSxFQUFDO0FBQ2paLElBQUUsVUFBUSxTQUFTLEdBQUVBLElBQUU7QUFBQyxNQUFFLElBQUk7QUFBRSxTQUFLLEVBQUUsUUFBUSxTQUFTLEdBQUUsR0FBRTtBQUFDLFFBQUUsUUFBUSxTQUFTLEdBQUU7QUFBQyxVQUFFLEtBQUtBLElBQUUsR0FBRSxHQUFFLElBQUk7QUFBQSxNQUFFLEdBQUUsSUFBSTtBQUFBLElBQUUsR0FBRSxJQUFJO0FBQUEsRUFBRTtBQUFFLElBQUUsS0FBRyxXQUFVO0FBQUMsTUFBRSxJQUFJO0FBQUUsVUFBTSxJQUFFLE1BQU0sS0FBSyxLQUFLLEVBQUUsT0FBTSxDQUFFLEdBQUVBLEtBQUUsTUFBTSxLQUFLLEtBQUssRUFBRSxLQUFJLENBQUUsR0FBRSxJQUFFO0FBQUcsYUFBUSxJQUFFLEdBQUUsSUFBRUEsR0FBRSxRQUFPLEtBQUk7QUFBQyxZQUFNLElBQUUsRUFBRSxDQUFDO0FBQUUsZUFBUSxJQUFFLEdBQUUsSUFBRSxFQUFFLFFBQU8sSUFBSSxHQUFFLEtBQUtBLEdBQUUsQ0FBQyxDQUFDO0FBQUEsSUFBRTtBQUFDLFdBQU87QUFBQSxFQUFDO0FBQUUsSUFBRSxJQUFFLFNBQVMsR0FBRTtBQUFDLE1BQUUsSUFBSTtBQUFFLFFBQUlBLEtBQUU7QUFBRyxRQUFHLGFBQVcsT0FBTyxFQUFFLElBQUcsTUFBSyxDQUFDLE1BQUlBLEtBQUVBLEdBQUUsT0FBTyxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQUssQ0FBQyxDQUFDLENBQUM7QUFBQSxTQUFRO0FBQUMsVUFBRSxNQUFNLEtBQUssS0FBSyxFQUFFLE9BQU0sQ0FBRTtBQUFFLGVBQVEsSUFBRSxHQUFFLElBQUUsRUFBRSxRQUFPLElBQUksQ0FBQUEsS0FBRUEsR0FBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO0FBQUEsSUFBRTtBQUFDLFdBQU9BO0FBQUEsRUFBQztBQUNsZixJQUFFLE1BQUksU0FBUyxHQUFFQSxJQUFFO0FBQUMsTUFBRSxJQUFJO0FBQUUsU0FBSyxJQUFFO0FBQUssUUFBRSxFQUFFLE1BQUssQ0FBQztBQUFFLE9BQUcsTUFBSyxDQUFDLE1BQUksS0FBSyxLQUFHLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRTtBQUFRLFNBQUssRUFBRSxJQUFJLEdBQUUsQ0FBQ0EsRUFBQyxDQUFDO0FBQUUsU0FBSyxLQUFHO0FBQUUsV0FBTztBQUFBLEVBQUk7QUFBRSxJQUFFLE1BQUksU0FBUyxHQUFFQSxJQUFFO0FBQUMsUUFBRyxDQUFDLEVBQUUsUUFBT0E7QUFBRSxRQUFFLEtBQUssRUFBRSxDQUFDO0FBQUUsV0FBTyxJQUFFLEVBQUUsU0FBTyxPQUFPLEVBQUUsQ0FBQyxDQUFDLElBQUVBO0FBQUEsRUFBQztBQUFFLFdBQVMsR0FBRyxHQUFFQSxJQUFFLEdBQUU7QUFBQyxPQUFHLEdBQUVBLEVBQUM7QUFBRSxRQUFFLEVBQUUsV0FBUyxFQUFFLElBQUUsTUFBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLEdBQUVBLEVBQUMsR0FBRSxHQUFHLENBQUMsQ0FBQyxHQUFFLEVBQUUsS0FBRyxFQUFFO0FBQUEsRUFBUTtBQUMvUyxJQUFFLFdBQVMsV0FBVTtBQUFDLFFBQUcsS0FBSyxFQUFFLFFBQU8sS0FBSztBQUFFLFFBQUcsQ0FBQyxLQUFLLEVBQUUsUUFBTztBQUFHLFVBQU0sSUFBRSxJQUFHQSxLQUFFLE1BQU0sS0FBSyxLQUFLLEVBQUUsS0FBSSxDQUFFO0FBQUUsYUFBUSxJQUFFLEdBQUUs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QztBQUFFLE1BQUUsRUFBRSxPQUFNO0FBQUcsTUFBRSxNQUFJLGFBQVcsT0FBTyxFQUFFLEtBQUcsRUFBRSxhQUFhLEVBQUUsQ0FBQyxHQUFFLEVBQUUsSUFBRTtBQUFBLEVBQU07QUFBQyxXQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFHLENBQUMsRUFBRSxHQUFFO0FBQUMsUUFBRSxJQUFFO0FBQUcsVUFBSUEsS0FBRSxFQUFFO0FBQUcsV0FBRyxHQUFFO0FBQUcsWUFBSSxFQUFDLEdBQUcsSUFBRTtBQUFJLFNBQUcsSUFBSUEsSUFBRSxDQUFDO0FBQUUsUUFBRSxJQUFFO0FBQUEsSUFBRTtBQUFBLEVBQUM7QUFBQyxXQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFFBQUcsR0FBRyxFQUFFLENBQUMsS0FBRyxFQUFFLEVBQUUsS0FBRyxFQUFFLElBQUUsSUFBRSxHQUFHLFFBQU87QUFBRyxRQUFHLEVBQUUsRUFBRSxRQUFPLEVBQUUsSUFBRUEsR0FBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEdBQUU7QUFBRyxRQUFHLEtBQUcsRUFBRSxLQUFHLEtBQUcsRUFBRSxLQUFHLEVBQUUsTUFBSSxFQUFFLEtBQUcsSUFBRSxFQUFFLElBQUksUUFBTztBQUFHLE1BQUUsSUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFHLEdBQUVBLEVBQUMsR0FBRSxHQUFHLEdBQUUsRUFBRSxDQUFDLENBQUM7QUFBRSxNQUFFO0FBQUksV0FBTztBQUFBLEVBQUU7QUFDL1osSUFBRSxLQUFHLFNBQVMsR0FBRTtBQUFDLFFBQUcsS0FBSyxFQUFFLEtBQUcsS0FBSyxJQUFFLE1BQUssS0FBRyxLQUFLLEdBQUU7QUFBQyxVQUFHLENBQUMsR0FBRTtBQUFDLGFBQUssSUFBRSxLQUFLLE1BQU0sTUFBSSxLQUFLLE9BQU0sQ0FBRTtBQUFFLFlBQUUsS0FBSztBQUFJLGNBQU0sSUFBRSxJQUFJLEVBQUUsTUFBSyxLQUFLLEdBQUUsQ0FBQztBQUFFLFlBQUksSUFBRSxLQUFLO0FBQUUsYUFBSyxNQUFJLEtBQUcsSUFBRSxHQUFHLENBQUMsR0FBRSxHQUFHLEdBQUUsS0FBSyxDQUFDLEtBQUcsSUFBRSxLQUFLO0FBQUcsaUJBQU8sS0FBSyxLQUFHLEtBQUssTUFBSSxFQUFFLElBQUUsR0FBRSxJQUFFO0FBQU0sWUFBRyxLQUFLLEVBQUUsSUFBRTtBQUFDLGNBQUlBLEtBQUU7QUFBRSxtQkFBUSxJQUFFLEdBQUUsSUFBRSxLQUFLLEVBQUUsUUFBTyxLQUFJO0FBQUMsZUFBRTtBQUFDLGtCQUFJLElBQUUsS0FBSyxFQUFFLENBQUM7QUFBRSxrQkFBRyxjQUFhLEVBQUUsUUFBTSxJQUFFLEVBQUUsSUFBSSxVQUFTLGFBQVcsT0FBTyxJQUFHO0FBQUMsb0JBQUUsRUFBRTtBQUFPLHNCQUFNO0FBQUEsY0FBQztBQUFDLGtCQUFFO0FBQUEsWUFBTztBQUFDLGdCQUFHLFdBQVMsRUFBRTtBQUFNLFlBQUFBLE1BQUc7QUFBRSxnQkFBRyxPQUFLQSxJQUFFO0FBQUMsY0FBQUEsS0FBRTtBQUFFLG9CQUFNO0FBQUEsWUFBQztBQUFDLGdCQUFHLFNBQU9BLE1BQUcsTUFBSSxLQUFLLEVBQUUsU0FBTyxHQUFFO0FBQUMsY0FBQUEsS0FBRSxJQUFFO0FBQUUsb0JBQU07QUFBQSxZQUFDO0FBQUEsVUFBQztBQUFDLFVBQUFBLEtBQUU7QUFBQSxRQUFJO0FBQUEsWUFBTSxDQUFBQSxLQUMxZjtBQUFJLFFBQUFBLEtBQUUsR0FBRyxNQUFLLEdBQUVBLEVBQUM7QUFBRSxZQUFFLEVBQUUsS0FBSyxDQUFDO0FBQUUsUUFBQTRCLEdBQUUsR0FBRSxPQUFNLENBQUM7QUFBRSxRQUFBQSxHQUFFLEdBQUUsUUFBTyxFQUFFO0FBQUUsYUFBSyxLQUFHQSxHQUFFLEdBQUUscUJBQW9CLEtBQUssQ0FBQztBQUFFLFdBQUcsTUFBSyxDQUFDO0FBQUUsY0FBSSxLQUFLLElBQUU1QixLQUFFLGFBQVcsbUJBQW1CLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFFLE1BQUlBLEtBQUUsS0FBSyxLQUFHLEdBQUcsR0FBRSxLQUFLLEdBQUUsQ0FBQztBQUFHLFdBQUcsS0FBSyxHQUFFLENBQUM7QUFBRSxhQUFLLE1BQUk0QixHQUFFLEdBQUUsUUFBTyxNQUFNO0FBQUUsYUFBSyxLQUFHQSxHQUFFLEdBQUUsUUFBTzVCLEVBQUMsR0FBRTRCLEdBQUUsR0FBRSxPQUFNLE1BQU0sR0FBRSxFQUFFLElBQUUsTUFBRyxHQUFHLEdBQUUsR0FBRSxJQUFJLEtBQUcsR0FBRyxHQUFFLEdBQUU1QixFQUFDO0FBQUUsYUFBSyxJQUFFO0FBQUEsTUFBRTtBQUFBLElBQUMsTUFBTSxNQUFHLEtBQUssTUFBSSxJQUFFLEdBQUcsTUFBSyxDQUFDLElBQUUsS0FBRyxLQUFLLEVBQUUsVUFBUSxHQUFHLEtBQUssQ0FBQyxLQUFHLEdBQUcsSUFBSTtBQUFBLEVBQUc7QUFDdlksV0FBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxRQUFJO0FBQUUsSUFBQUEsS0FBRSxJQUFFQSxHQUFFLElBQUUsSUFBRSxFQUFFO0FBQUksVUFBTSxJQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsSUFBQTRCLEdBQUUsR0FBRSxPQUFNLEVBQUUsQ0FBQztBQUFFLElBQUFBLEdBQUUsR0FBRSxPQUFNLENBQUM7QUFBRSxJQUFBQSxHQUFFLEdBQUUsT0FBTSxFQUFFLENBQUM7QUFBRSxPQUFHLEdBQUUsQ0FBQztBQUFFLE1BQUUsS0FBRyxFQUFFLEtBQUcsR0FBRyxHQUFFLEVBQUUsR0FBRSxFQUFFLENBQUM7QUFBRSxRQUFFLElBQUksRUFBRSxHQUFFLEVBQUUsR0FBRSxHQUFFLEVBQUUsSUFBRSxDQUFDO0FBQUUsYUFBTyxFQUFFLE1BQUksRUFBRSxJQUFFLEVBQUU7QUFBRyxJQUFBNUIsT0FBSSxFQUFFLElBQUVBLEdBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQztBQUFHLElBQUFBLEtBQUUsR0FBRyxHQUFFLEdBQUUsR0FBRztBQUFFLE1BQUUsSUFBRSxLQUFLLE1BQU0sTUFBRyxFQUFFLEVBQUUsSUFBRSxLQUFLLE1BQU0sTUFBRyxFQUFFLEtBQUcsS0FBSyxPQUFNLENBQUU7QUFBRSxPQUFHLEVBQUUsR0FBRSxDQUFDO0FBQUUsT0FBRyxHQUFFLEdBQUVBLEVBQUM7QUFBQSxFQUFFO0FBQUMsV0FBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxNQUFFLEtBQUcsR0FBRyxFQUFFLEdBQUUsU0FBUyxHQUFFLEdBQUU7QUFBQyxNQUFBNEIsR0FBRTVCLElBQUUsR0FBRSxDQUFDO0FBQUEsSUFBRSxDQUFDO0FBQUUsTUFBRSxLQUFHLEdBQUcsSUFBRyxTQUFTLEdBQUUsR0FBRTtBQUFDLE1BQUE0QixHQUFFNUIsSUFBRSxHQUFFLENBQUM7QUFBQSxJQUFFLENBQUM7QUFBQSxFQUFFO0FBQ2hZLFdBQVMsR0FBRyxHQUFFQSxJQUFFLEdBQUU7QUFBQyxRQUFFLEtBQUssSUFBSSxFQUFFLEVBQUUsUUFBTyxDQUFDO0FBQUUsUUFBSSxJQUFFLEVBQUUsSUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFHLEVBQUUsR0FBRSxDQUFDLElBQUU7QUFBSyxPQUFFO0FBQUMsVUFBSSxJQUFFLEVBQUU7QUFBRSxVQUFJLElBQUU7QUFBRyxpQkFBTztBQUFDLGNBQU0sSUFBRSxDQUFDLFdBQVMsQ0FBQztBQUFFLGNBQUksSUFBRSxJQUFFLEtBQUcsSUFBRSxFQUFFLENBQUMsRUFBRSxHQUFFLEVBQUUsS0FBSyxTQUFPLENBQUMsS0FBRyxJQUFFLElBQUUsRUFBRSxLQUFLLFNBQU8sQ0FBQztBQUFFLFlBQUksSUFBRTtBQUFHLGlCQUFRLElBQUUsR0FBRSxJQUFFLEdBQUUsS0FBSTtBQUFDLGNBQUksSUFBRSxFQUFFLENBQUMsRUFBRTtBQUFFLGdCQUFNbUIsS0FBRSxFQUFFLENBQUMsRUFBRTtBQUFJLGVBQUc7QUFBRSxjQUFHLElBQUUsRUFBRSxLQUFFLEtBQUssSUFBSSxHQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUUsR0FBRyxHQUFFLElBQUU7QUFBQSxjQUFRLEtBQUc7QUFBQyxlQUFHQSxJQUFFLEdBQUUsUUFBTSxJQUFFLEdBQUc7QUFBQSxVQUFFLFNBQU9LLElBQUU7QUFBQyxpQkFBRyxFQUFFTCxFQUFDO0FBQUEsVUFBRTtBQUFBLFFBQUM7QUFBQyxZQUFHLEdBQUU7QUFBQyxjQUFFLEVBQUUsS0FBSyxHQUFHO0FBQUUsZ0JBQU07QUFBQSxRQUFDO0FBQUEsTUFBQztBQUFBLElBQUM7QUFBQyxRQUFFLEVBQUUsRUFBRSxPQUFPLEdBQUUsQ0FBQztBQUFFLElBQUFuQixHQUFFLElBQUU7QUFBRSxXQUFPO0FBQUEsRUFBQztBQUFDLFdBQVMsR0FBRyxHQUFFO0FBQUMsUUFBRyxDQUFDLEVBQUUsS0FBRyxDQUFDLEVBQUUsR0FBRTtBQUFDLFFBQUUsSUFBRTtBQUFFLFVBQUlBLEtBQUUsRUFBRTtBQUFHLFdBQUcsR0FBRTtBQUFHLFlBQUksRUFBQyxHQUFHLElBQUU7QUFBSSxTQUFHLElBQUlBLElBQUUsQ0FBQztBQUFFLFFBQUUsSUFBRTtBQUFBLElBQUU7QUFBQSxFQUFDO0FBQ3ZlLFdBQVMsR0FBRyxHQUFFO0FBQUMsUUFBRyxFQUFFLEtBQUcsRUFBRSxLQUFHLEtBQUcsRUFBRSxFQUFFLFFBQU87QUFBRyxNQUFFO0FBQUksTUFBRSxJQUFFLEdBQUcsRUFBRSxFQUFFLElBQUcsQ0FBQyxHQUFFLEdBQUcsR0FBRSxFQUFFLENBQUMsQ0FBQztBQUFFLE1BQUU7QUFBSSxXQUFPO0FBQUEsRUFBRTtBQUFDLElBQUUsS0FBRyxXQUFVO0FBQUMsU0FBSyxJQUFFO0FBQUssT0FBRyxJQUFJO0FBQUUsUUFBRyxLQUFLLE1BQUksRUFBRSxLQUFLLEtBQUcsUUFBTSxLQUFLLEtBQUcsS0FBRyxLQUFLLElBQUc7QUFBQyxVQUFJLElBQUUsSUFBRSxLQUFLO0FBQUUsV0FBSyxFQUFFLEtBQUssaUNBQStCLENBQUM7QUFBRSxXQUFLLElBQUUsR0FBRyxFQUFFLEtBQUssSUFBRyxJQUFJLEdBQUUsQ0FBQztBQUFBLElBQUU7QUFBQSxFQUFDO0FBQUUsSUFBRSxLQUFHLFdBQVU7QUFBQyxTQUFLLE1BQUksS0FBSyxJQUFFLE1BQUssS0FBSyxFQUFFLEtBQUssK0JBQStCLEdBQUUsS0FBSyxFQUFFLEtBQUssc0RBQXNELEdBQUUsS0FBSyxJQUFFLE9BQUcsS0FBSyxJQUFFLE1BQUcsRUFBRSxFQUFFLEdBQUUsR0FBRyxJQUFJLEdBQUUsR0FBRyxJQUFJO0FBQUEsRUFBRztBQUNwZCxXQUFTLEdBQUcsR0FBRTtBQUFDLFlBQU0sRUFBRSxNQUFJLEVBQUUsYUFBYSxFQUFFLENBQUMsR0FBRSxFQUFFLElBQUU7QUFBQSxFQUFNO0FBQUMsV0FBUyxHQUFHLEdBQUU7QUFBQyxNQUFFLElBQUUsSUFBSSxFQUFFLEdBQUUsRUFBRSxHQUFFLE9BQU0sRUFBRSxDQUFDO0FBQUUsYUFBTyxFQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsRUFBRTtBQUFHLE1BQUUsRUFBRSxJQUFFO0FBQUUsUUFBSUEsS0FBRSxFQUFFLEVBQUUsRUFBRTtBQUFFLElBQUE0QixHQUFFNUIsSUFBRSxPQUFNLEtBQUs7QUFBRSxJQUFBNEIsR0FBRTVCLElBQUUsT0FBTSxFQUFFLENBQUM7QUFBRSxJQUFBNEIsR0FBRTVCLElBQUUsT0FBTSxFQUFFLENBQUM7QUFBRSxJQUFBNEIsR0FBRTVCLElBQUUsTUFBSyxFQUFFLElBQUUsTUFBSSxHQUFHO0FBQUUsS0FBQyxFQUFFLEtBQUcsRUFBRSxNQUFJNEIsR0FBRTVCLElBQUUsTUFBSyxFQUFFLEVBQUU7QUFBRSxJQUFBNEIsR0FBRTVCLElBQUUsUUFBTyxTQUFTO0FBQUUsT0FBRyxHQUFFQSxFQUFDO0FBQUUsTUFBRSxLQUFHLEVBQUUsS0FBRyxHQUFHQSxJQUFFLEVBQUUsR0FBRSxFQUFFLENBQUM7QUFBRSxNQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsRUFBRTtBQUFHLFFBQUksSUFBRSxFQUFFO0FBQUUsUUFBRSxFQUFFO0FBQUcsTUFBRSxJQUFFO0FBQUUsTUFBRSxJQUFFLEdBQUcsRUFBRUEsRUFBQyxDQUFDO0FBQUUsTUFBRSxJQUFFO0FBQUssTUFBRSxJQUFFO0FBQUcsT0FBRyxHQUFFLENBQUM7QUFBQSxFQUFFO0FBQUMsSUFBRSxLQUFHLFdBQVU7QUFBQyxZQUFNLEtBQUssTUFBSSxLQUFLLElBQUUsTUFBSyxHQUFHLElBQUksR0FBRSxHQUFHLElBQUksR0FBRSxFQUFFLEVBQUU7QUFBQSxFQUFHO0FBQUUsV0FBUyxHQUFHLEdBQUU7QUFBQyxZQUFNLEVBQUUsTUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDLEdBQUUsRUFBRSxJQUFFO0FBQUEsRUFBTTtBQUNyZixXQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFFBQUksSUFBRTtBQUFLLFFBQUcsRUFBRSxLQUFHQSxJQUFFO0FBQUMsU0FBRyxDQUFDO0FBQUUsU0FBRyxDQUFDO0FBQUUsUUFBRSxJQUFFO0FBQUssVUFBSSxJQUFFO0FBQUEsSUFBRSxXQUFTLEdBQUcsRUFBRSxHQUFFQSxFQUFDLEVBQUUsS0FBRUEsR0FBRSxHQUFFLEdBQUcsRUFBRSxHQUFFQSxFQUFDLEdBQUUsSUFBRTtBQUFBLFFBQU87QUFBTyxRQUFHLEtBQUcsRUFBRTtBQUFFLFVBQUdBLEdBQUUsRUFBRSxLQUFHLEtBQUcsR0FBRTtBQUFDLFlBQUVBLEdBQUUsSUFBRUEsR0FBRSxFQUFFLFNBQU87QUFBRSxRQUFBQSxLQUFFLEtBQUssSUFBRyxJQUFHQSxHQUFFO0FBQUUsWUFBSSxJQUFFLEVBQUU7QUFBRSxZQUFFLEdBQUU7QUFBRyxVQUFFLEdBQUUsSUFBSSxHQUFHLEdBQUUsQ0FBQyxDQUFDO0FBQUUsV0FBRyxDQUFDO0FBQUEsTUFBRSxNQUFNLElBQUcsQ0FBQztBQUFBLGVBQVUsSUFBRUEsR0FBRSxHQUFFLEtBQUcsS0FBRyxLQUFHLEtBQUcsSUFBRUEsR0FBRSxLQUFHLEVBQUUsS0FBRyxLQUFHLEdBQUcsR0FBRUEsRUFBQyxLQUFHLEtBQUcsS0FBRyxHQUFHLENBQUMsR0FBRyxTQUFPLEtBQUcsSUFBRSxFQUFFLFdBQVNBLEtBQUUsRUFBRSxHQUFFQSxHQUFFLElBQUVBLEdBQUUsRUFBRSxPQUFPLENBQUMsSUFBRyxHQUFDO0FBQUEsUUFBRSxLQUFLO0FBQUUsWUFBRSxHQUFFLENBQUM7QUFBRTtBQUFBLFFBQU0sS0FBSztBQUFFLFlBQUUsR0FBRSxFQUFFO0FBQUU7QUFBQSxRQUFNLEtBQUs7QUFBRSxZQUFFLEdBQUUsQ0FBQztBQUFFO0FBQUEsUUFBTTtBQUFRLFlBQUUsR0FBRSxDQUFDO0FBQUEsTUFBRTtBQUFBO0FBQUEsRUFBQztBQUN4YSxXQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFFBQUksSUFBRSxFQUFFLEtBQUcsS0FBSyxNQUFNLEtBQUssT0FBTSxJQUFHLEVBQUUsRUFBRTtBQUFFLE1BQUUsU0FBUSxNQUFLLEtBQUc7QUFBRyxXQUFPLElBQUVBO0FBQUEsRUFBQztBQUFDLFdBQVMsRUFBRSxHQUFFQSxJQUFFO0FBQUMsTUFBRSxFQUFFLEtBQUssZ0JBQWNBLEVBQUM7QUFBRSxRQUFHLEtBQUdBLElBQUU7QUFBQyxVQUFJLElBQUUsRUFBRSxFQUFFLElBQUcsQ0FBQyxHQUFFLElBQUUsRUFBRTtBQUFHLFlBQU0sSUFBRSxDQUFDO0FBQUUsVUFBRSxJQUFJLEVBQUUsS0FBRyxzQ0FBc0M7QUFBRSxRQUFFLFlBQVUsVUFBUSxFQUFFLFNBQVMsWUFBVSxHQUFHLEdBQUUsT0FBTztBQUFFLFNBQUcsQ0FBQztBQUFFLFVBQUUsR0FBRyxFQUFFLFlBQVcsQ0FBQyxJQUFFLEdBQUcsRUFBRSxTQUFRLEdBQUcsQ0FBQztBQUFBLElBQUUsTUFBTSxHQUFFLENBQUM7QUFBRSxNQUFFLElBQUU7QUFBRSxNQUFFLEtBQUcsRUFBRSxFQUFFLEdBQUdBLEVBQUM7QUFBRSxPQUFHLENBQUM7QUFBRSxPQUFHLENBQUM7QUFBQSxFQUFFO0FBQUMsSUFBRSxLQUFHLFNBQVMsR0FBRTtBQUFDLFNBQUcsS0FBSyxFQUFFLEtBQUssZ0NBQWdDLEdBQUUsRUFBRSxDQUFDLE1BQUksS0FBSyxFQUFFLEtBQUssMkJBQTJCLEdBQUUsRUFBRSxDQUFDO0FBQUEsRUFBRztBQUM3ZSxXQUFTLEdBQUcsR0FBRTtBQUFDLE1BQUUsSUFBRTtBQUFFLE1BQUUsS0FBRztBQUFHLFFBQUcsRUFBRSxHQUFFO0FBQUMsWUFBTUEsS0FBRSxHQUFHLEVBQUUsQ0FBQztBQUFFLFVBQUcsS0FBR0EsR0FBRSxVQUFRLEtBQUcsRUFBRSxF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QUFNLEVBQUUsS0FBQWtDLE1BQUssUUFBQUMsWUFBVzttREFBTTtBQUEyQixvQkFBQUQsTUFBQSxRQUFBQyxRQUFBO0FBQUE7QUFDekQsVUFBTSxTQUFTRCxLQUFJbEMsS0FBSSxZQUFZLFFBQVE7QUFDM0MsVUFBTSxVQUFVLE1BQU1tQyxRQUFPLE1BQU07QUFFbkMsUUFBSSxRQUFRLFVBQVU7QUFDbEIsaUJBQVcsUUFBUTtJQUN2QixPQUFPO0FBQ0gsY0FBUSxLQUFLLGtDQUFrQztBQUFBLElBQ25EO0FBQUEsRUFDSixTQUFTLEtBQUs7QUFDVixZQUFRLE1BQU0seUNBQXlDLEdBQUc7QUFBQSxFQUM5RDtBQUNBLFNBQU87QUFDWDtBQUVBLFNBQVMsV0FBVyxNQUFNLE1BQU07QUFDNUIsUUFBTSxTQUFTLFNBQVMsZUFBZSxRQUFRO0FBQy9DLFNBQU8sY0FBYztBQUNyQixTQUFPLFlBQVksaUJBQWlCO0FBQ3hDO0FBR0EsU0FBUyxVQUFVO0FBQ2Y7QUFDQTtBQUNKO0FBR0EsTUFBTSwwQkFBMEI7QUFDaEMsa0JBQWtCLFNBQVUsTUFBTTtBQUM5QiwwQkFBd0IsSUFBSTtBQUM1QjtBQUNKIiwibmFtZXMiOlsibmFtZSIsImlzRW1wdHkiLCJiIiwicXVlcnlzdHJpbmciLCJERUZBVUxUX0VOVFJZX05BTUUiLCJMb2dMZXZlbCIsInZlcnNpb24iLCJkYiIsInRhcmdldCIsInZlcnNpb24kMSIsIm5hbWUkMSIsImFwcCIsIkRCX05BTUUiLCJEQl9WRVJTSU9OIiwiYXV0aCIsImF1dGhFcnJvciIsInJlbG9hZCIsIl9lIiwicmUiLCJrZXkiLCJzdG9yZWRWYWx1ZSIsInYiLCJnYXBpIiwid2luZG93IiwicHJvbWlzZSIsImNvbW1vbmpzR2xvYmFsIiwidyIsIkMiLCJEIiwiRXZlbnQiLCJTIiwiZSIsInQiLCJuIiwicHJvY2VzcyIsInIiLCJpIiwibyIsInMiLCJfIiwiYSIsImRvYyIsImdldERvYyJdLCJpZ25vcmVMaXN0IjpbMCwxLDIsMyw0LDUsNiw3LDgsOSwxMCwxMV0sInNvdXJjZXMiOlsiLi4vLi4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL2Rpc3QvaW5kZXguZXNtMjAxNy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvY29tcG9uZW50L2Rpc3QvZXNtL2luZGV4LmVzbTIwMTcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2xvZ2dlci9kaXN0L2VzbS9pbmRleC5lc20yMDE3LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC93cmFwLWlkYi12YWx1ZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy9pZGIvYnVpbGQvaW5kZXguanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2FwcC9kaXN0L2VzbS9pbmRleC5lc20yMDE3LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzL2ZpcmViYXNlL2FwcC9kaXN0L2VzbS9pbmRleC5lc20uanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2Lm1qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvYXV0aC9kaXN0L2VzbTIwMTcvaW5kZXgtNjg2MDJkMjQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9kaXN0L2Jsb29tLWJsb2IvZXNtL2Jsb29tX2Jsb2JfZXMyMDE4LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvZGlzdC93ZWJjaGFubmVsLWJsb2IvZXNtL3dlYmNoYW5uZWxfYmxvYl9lczIwMTguanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2ZpcmVzdG9yZS9kaXN0L2luZGV4LmVzbTIwMTcuanMiLCIuLi8uLi9zcmMvZmlyZWJhc2VDb25maWcuanMiLCIuLi8uLi9zcmMvcG9wdXAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEBmaWxlb3ZlcnZpZXcgRmlyZWJhc2UgY29uc3RhbnRzLiAgU29tZSBvZiB0aGVzZSAoQGRlZmluZXMpIGNhbiBiZSBvdmVycmlkZGVuIGF0IGNvbXBpbGUtdGltZS5cclxuICovXHJcbmNvbnN0IENPTlNUQU5UUyA9IHtcclxuICAgIC8qKlxyXG4gICAgICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGlzIHRoZSBjbGllbnQgTm9kZS5qcyBTREsuXHJcbiAgICAgKi9cclxuICAgIE5PREVfQ0xJRU5UOiBmYWxzZSxcclxuICAgIC8qKlxyXG4gICAgICogQGRlZmluZSB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGlzIHRoZSBBZG1pbiBOb2RlLmpzIFNESy5cclxuICAgICAqL1xyXG4gICAgTk9ERV9BRE1JTjogZmFsc2UsXHJcbiAgICAvKipcclxuICAgICAqIEZpcmViYXNlIFNESyBWZXJzaW9uXHJcbiAgICAgKi9cclxuICAgIFNES19WRVJTSU9OOiAnJHtKU0NPUkVfVkVSU0lPTn0nXHJcbn07XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaHJvd3MgYW4gZXJyb3IgaWYgdGhlIHByb3ZpZGVkIGFzc2VydGlvbiBpcyBmYWxzeVxyXG4gKi9cclxuY29uc3QgYXNzZXJ0ID0gZnVuY3Rpb24gKGFzc2VydGlvbiwgbWVzc2FnZSkge1xyXG4gICAgaWYgKCFhc3NlcnRpb24pIHtcclxuICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcihtZXNzYWdlKTtcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIFJldHVybnMgYW4gRXJyb3Igb2JqZWN0IHN1aXRhYmxlIGZvciB0aHJvd2luZy5cclxuICovXHJcbmNvbnN0IGFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgIHJldHVybiBuZXcgRXJyb3IoJ0ZpcmViYXNlIERhdGFiYXNlICgnICtcclxuICAgICAgICBDT05TVEFOVFMuU0RLX1ZFUlNJT04gK1xyXG4gICAgICAgICcpIElOVEVSTkFMIEFTU0VSVCBGQUlMRUQ6ICcgK1xyXG4gICAgICAgIG1lc3NhZ2UpO1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBzdHJpbmdUb0J5dGVBcnJheSQxID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgLy8gVE9ETyh1c2VyKTogVXNlIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbnMgaWYvd2hlbiBhdmFpbGFibGVcclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgbGV0IHAgPSAwO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBsZXQgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIGlmIChjIDwgMTI4KSB7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gYztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYyA8IDIwNDgpIHtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiA2KSB8IDE5MjtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoKGMgJiAweGZjMDApID09PSAweGQ4MDAgJiZcclxuICAgICAgICAgICAgaSArIDEgPCBzdHIubGVuZ3RoICYmXHJcbiAgICAgICAgICAgIChzdHIuY2hhckNvZGVBdChpICsgMSkgJiAweGZjMDApID09PSAweGRjMDApIHtcclxuICAgICAgICAgICAgLy8gU3Vycm9nYXRlIFBhaXJcclxuICAgICAgICAgICAgYyA9IDB4MTAwMDAgKyAoKGMgJiAweDAzZmYpIDw8IDEwKSArIChzdHIuY2hhckNvZGVBdCgrK2kpICYgMHgwM2ZmKTtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiAxOCkgfCAyNDA7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDEyKSAmIDYzKSB8IDEyODtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dDtcclxufTtcclxuLyoqXHJcbiAqIFR1cm5zIGFuIGFycmF5IG9mIG51bWJlcnMgaW50byB0aGUgc3RyaW5nIGdpdmVuIGJ5IHRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZVxyXG4gKiBjaGFyYWN0ZXJzIHRvIHdoaWNoIHRoZSBudW1iZXJzIGNvcnJlc3BvbmQuXHJcbiAqIEBwYXJhbSBieXRlcyBBcnJheSBvZiBudW1iZXJzIHJlcHJlc2VudGluZyBjaGFyYWN0ZXJzLlxyXG4gKiBAcmV0dXJuIFN0cmluZ2lmaWNhdGlvbiBvZiB0aGUgYXJyYXkuXHJcbiAqL1xyXG5jb25zdCBieXRlQXJyYXlUb1N0cmluZyA9IGZ1bmN0aW9uIChieXRlcykge1xyXG4gICAgLy8gVE9ETyh1c2VyKTogVXNlIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbnMgaWYvd2hlbiBhdmFpbGFibGVcclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgbGV0IHBvcyA9IDAsIGMgPSAwO1xyXG4gICAgd2hpbGUgKHBvcyA8IGJ5dGVzLmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IGMxID0gYnl0ZXNbcG9zKytdO1xyXG4gICAgICAgIGlmIChjMSA8IDEyOCkge1xyXG4gICAgICAgICAgICBvdXRbYysrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYzEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjMSA+IDE5MSAmJiBjMSA8IDIyNCkge1xyXG4gICAgICAgICAgICBjb25zdCBjMiA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYzEgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjMSA+IDIzOSAmJiBjMSA8IDM2NSkge1xyXG4gICAgICAgICAgICAvLyBTdXJyb2dhdGUgUGFpclxyXG4gICAgICAgICAgICBjb25zdCBjMiA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgY29uc3QgYzMgPSBieXRlc1twb3MrK107XHJcbiAgICAgICAgICAgIGNvbnN0IGM0ID0gYnl0ZXNbcG9zKytdO1xyXG4gICAgICAgICAgICBjb25zdCB1ID0gKCgoYzEgJiA3KSA8PCAxOCkgfCAoKGMyICYgNjMpIDw8IDEyKSB8ICgoYzMgJiA2MykgPDwgNikgfCAoYzQgJiA2MykpIC1cclxuICAgICAgICAgICAgICAgIDB4MTAwMDA7XHJcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGQ4MDAgKyAodSA+PiAxMCkpO1xyXG4gICAgICAgICAgICBvdXRbYysrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhkYzAwICsgKHUgJiAxMDIzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBjMiA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgY29uc3QgYzMgPSBieXRlc1twb3MrK107XHJcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMxICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBvdXQuam9pbignJyk7XHJcbn07XHJcbi8vIFdlIGRlZmluZSBpdCBhcyBhbiBvYmplY3QgbGl0ZXJhbCBpbnN0ZWFkIG9mIGEgY2xhc3MgYmVjYXVzZSBhIGNsYXNzIGNvbXBpbGVkIGRvd24gdG8gZXM1IGNhbid0XHJcbi8vIGJlIHRyZWVzaGFrZWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9yb2xsdXAvcm9sbHVwL2lzc3Vlcy8xNjkxXHJcbi8vIFN0YXRpYyBsb29rdXAgbWFwcywgbGF6aWx5IHBvcHVsYXRlZCBieSBpbml0XygpXHJcbmNvbnN0IGJhc2U2NCA9IHtcclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBieXRlcyB0byBjaGFyYWN0ZXJzLlxyXG4gICAgICovXHJcbiAgICBieXRlVG9DaGFyTWFwXzogbnVsbCxcclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBjaGFyYWN0ZXJzIHRvIGJ5dGVzLlxyXG4gICAgICovXHJcbiAgICBjaGFyVG9CeXRlTWFwXzogbnVsbCxcclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBieXRlcyB0byB3ZWJzYWZlIGNoYXJhY3RlcnMuXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBieXRlVG9DaGFyTWFwV2ViU2FmZV86IG51bGwsXHJcbiAgICAvKipcclxuICAgICAqIE1hcHMgd2Vic2FmZSBjaGFyYWN0ZXJzIHRvIGJ5dGVzLlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqL1xyXG4gICAgY2hhclRvQnl0ZU1hcFdlYlNhZmVfOiBudWxsLFxyXG4gICAgLyoqXHJcbiAgICAgKiBPdXIgZGVmYXVsdCBhbHBoYWJldCwgc2hhcmVkIGJldHdlZW5cclxuICAgICAqIEVOQ09ERURfVkFMUyBhbmQgRU5DT0RFRF9WQUxTX1dFQlNBRkVcclxuICAgICAqL1xyXG4gICAgRU5DT0RFRF9WQUxTX0JBU0U6ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWicgKyAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonICsgJzAxMjM0NTY3ODknLFxyXG4gICAgLyoqXHJcbiAgICAgKiBPdXIgZGVmYXVsdCBhbHBoYWJldC4gVmFsdWUgNjQgKD0pIGlzIHNwZWNpYWw7IGl0IG1lYW5zIFwibm90aGluZy5cIlxyXG4gICAgICovXHJcbiAgICBnZXQgRU5DT0RFRF9WQUxTKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJysvPSc7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBPdXIgd2Vic2FmZSBhbHBoYWJldC5cclxuICAgICAqL1xyXG4gICAgZ2V0IEVOQ09ERURfVkFMU19XRUJTQUZFKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJy1fLic7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBXaGV0aGVyIHRoaXMgYnJvd3NlciBzdXBwb3J0cyB0aGUgYXRvYiBhbmQgYnRvYSBmdW5jdGlvbnMuIFRoaXMgZXh0ZW5zaW9uXHJcbiAgICAgKiBzdGFydGVkIGF0IE1vemlsbGEgYnV0IGlzIG5vdyBpbXBsZW1lbnRlZCBieSBtYW55IGJyb3dzZXJzLiBXZSB1c2UgdGhlXHJcbiAgICAgKiBBU1NVTUVfKiB2YXJpYWJsZXMgdG8gYXZvaWQgcHVsbGluZyBpbiB0aGUgZnVsbCB1c2VyYWdlbnQgZGV0ZWN0aW9uIGxpYnJhcnlcclxuICAgICAqIGJ1dCBzdGlsbCBhbGxvd2luZyB0aGUgc3RhbmRhcmQgcGVyLWJyb3dzZXIgY29tcGlsYXRpb25zLlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgSEFTX05BVElWRV9TVVBQT1JUOiB0eXBlb2YgYXRvYiA9PT0gJ2Z1bmN0aW9uJyxcclxuICAgIC8qKlxyXG4gICAgICogQmFzZTY0LWVuY29kZSBhbiBhcnJheSBvZiBieXRlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaW5wdXQgQW4gYXJyYXkgb2YgYnl0ZXMgKG51bWJlcnMgd2l0aFxyXG4gICAgICogICAgIHZhbHVlIGluIFswLCAyNTVdKSB0byBlbmNvZGUuXHJcbiAgICAgKiBAcGFyYW0gd2ViU2FmZSBCb29sZWFuIGluZGljYXRpbmcgd2Ugc2hvdWxkIHVzZSB0aGVcclxuICAgICAqICAgICBhbHRlcm5hdGl2ZSBhbHBoYWJldC5cclxuICAgICAqIEByZXR1cm4gVGhlIGJhc2U2NCBlbmNvZGVkIHN0cmluZy5cclxuICAgICAqL1xyXG4gICAgZW5jb2RlQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGlucHV0KSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignZW5jb2RlQnl0ZUFycmF5IHRha2VzIGFuIGFycmF5IGFzIGEgcGFyYW1ldGVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5pdF8oKTtcclxuICAgICAgICBjb25zdCBieXRlVG9DaGFyTWFwID0gd2ViU2FmZVxyXG4gICAgICAgICAgICA/IHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfXHJcbiAgICAgICAgICAgIDogdGhpcy5ieXRlVG9DaGFyTWFwXztcclxuICAgICAgICBjb25zdCBvdXRwdXQgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSArPSAzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUxID0gaW5wdXRbaV07XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgKyAxIDwgaW5wdXQubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlMiA9IGhhdmVCeXRlMiA/IGlucHV0W2kgKyAxXSA6IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMyA9IGkgKyAyIDwgaW5wdXQubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGlucHV0W2kgKyAyXSA6IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUxID0gYnl0ZTEgPj4gMjtcclxuICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTIgPSAoKGJ5dGUxICYgMHgwMykgPDwgNCkgfCAoYnl0ZTIgPj4gNCk7XHJcbiAgICAgICAgICAgIGxldCBvdXRCeXRlMyA9ICgoYnl0ZTIgJiAweDBmKSA8PCAyKSB8IChieXRlMyA+PiA2KTtcclxuICAgICAgICAgICAgbGV0IG91dEJ5dGU0ID0gYnl0ZTMgJiAweDNmO1xyXG4gICAgICAgICAgICBpZiAoIWhhdmVCeXRlMykge1xyXG4gICAgICAgICAgICAgICAgb3V0Qnl0ZTQgPSA2NDtcclxuICAgICAgICAgICAgICAgIGlmICghaGF2ZUJ5dGUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0Qnl0ZTMgPSA2NDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvdXRwdXQucHVzaChieXRlVG9DaGFyTWFwW291dEJ5dGUxXSwgYnl0ZVRvQ2hhck1hcFtvdXRCeXRlMl0sIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTNdLCBieXRlVG9DaGFyTWFwW291dEJ5dGU0XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvdXRwdXQuam9pbignJyk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBCYXNlNjQtZW5jb2RlIGEgc3RyaW5nLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbnB1dCBBIHN0cmluZyB0byBlbmNvZGUuXHJcbiAgICAgKiBAcGFyYW0gd2ViU2FmZSBJZiB0cnVlLCB3ZSBzaG91bGQgdXNlIHRoZVxyXG4gICAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxyXG4gICAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLlxyXG4gICAgICovXHJcbiAgICBlbmNvZGVTdHJpbmcoaW5wdXQsIHdlYlNhZmUpIHtcclxuICAgICAgICAvLyBTaG9ydGN1dCBmb3IgTW96aWxsYSBicm93c2VycyB0aGF0IGltcGxlbWVudFxyXG4gICAgICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mIFwiYnRvYS9hdG9iXCJcclxuICAgICAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGJ0b2EoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVCeXRlQXJyYXkoc3RyaW5nVG9CeXRlQXJyYXkkMShpbnB1dCksIHdlYlNhZmUpO1xyXG4gICAgfSxcclxuICAgIC8qKlxyXG4gICAgICogQmFzZTY0LWRlY29kZSBhIHN0cmluZy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaW5wdXQgdG8gZGVjb2RlLlxyXG4gICAgICogQHBhcmFtIHdlYlNhZmUgVHJ1ZSBpZiB3ZSBzaG91bGQgdXNlIHRoZVxyXG4gICAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxyXG4gICAgICogQHJldHVybiBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBkZWNvZGVkIHZhbHVlLlxyXG4gICAgICovXHJcbiAgICBkZWNvZGVTdHJpbmcoaW5wdXQsIHdlYlNhZmUpIHtcclxuICAgICAgICAvLyBTaG9ydGN1dCBmb3IgTW96aWxsYSBicm93c2VycyB0aGF0IGltcGxlbWVudFxyXG4gICAgICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mIFwiYnRvYS9hdG9iXCJcclxuICAgICAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF0b2IoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYnl0ZUFycmF5VG9TdHJpbmcodGhpcy5kZWNvZGVTdHJpbmdUb0J5dGVBcnJheShpbnB1dCwgd2ViU2FmZSkpO1xyXG4gICAgfSxcclxuICAgIC8qKlxyXG4gICAgICogQmFzZTY0LWRlY29kZSBhIHN0cmluZy5cclxuICAgICAqXHJcbiAgICAgKiBJbiBiYXNlLTY0IGRlY29kaW5nLCBncm91cHMgb2YgZm91ciBjaGFyYWN0ZXJzIGFyZSBjb252ZXJ0ZWQgaW50byB0aHJlZVxyXG4gICAgICogYnl0ZXMuICBJZiB0aGUgZW5jb2RlciBkaWQgbm90IGFwcGx5IHBhZGRpbmcsIHRoZSBpbnB1dCBsZW5ndGggbWF5IG5vdFxyXG4gICAgICogYmUgYSBtdWx0aXBsZSBvZiA0LlxyXG4gICAgICpcclxuICAgICAqIEluIHRoaXMgY2FzZSwgdGhlIGxhc3QgZ3JvdXAgd2lsbCBoYXZlIGZld2VyIHRoYW4gNCBjaGFyYWN0ZXJzLCBhbmRcclxuICAgICAqIHBhZGRpbmcgd2lsbCBiZSBpbmZlcnJlZC4gIElmIHRoZSBncm91cCBoYXMgb25lIG9yIHR3byBjaGFyYWN0ZXJzLCBpdCBkZWNvZGVzXHJcbiAgICAgKiB0byBvbmUgYnl0ZS4gIElmIHRoZSBncm91cCBoYXMgdGhyZWUgY2hhcmFjdGVycywgaXQgZGVjb2RlcyB0byB0d28gYnl0ZXMuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlucHV0IElucHV0IHRvIGRlY29kZS5cclxuICAgICAqIEBwYXJhbSB3ZWJTYWZlIFRydWUgaWYgd2Ugc2hvdWxkIHVzZSB0aGUgd2ViLXNhZmUgYWxwaGFiZXQuXHJcbiAgICAgKiBAcmV0dXJuIGJ5dGVzIHJlcHJlc2VudGluZyB0aGUgZGVjb2RlZCB2YWx1ZS5cclxuICAgICAqL1xyXG4gICAgZGVjb2RlU3RyaW5nVG9CeXRlQXJyYXkoaW5wdXQsIHdlYlNhZmUpIHtcclxuICAgICAgICB0aGlzLmluaXRfKCk7XHJcbiAgICAgICAgY29uc3QgY2hhclRvQnl0ZU1hcCA9IHdlYlNhZmVcclxuICAgICAgICAgICAgPyB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1xyXG4gICAgICAgICAgICA6IHRoaXMuY2hhclRvQnl0ZU1hcF87XHJcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUxID0gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSsrKV07XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgPCBpbnB1dC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUyID0gaGF2ZUJ5dGUyID8gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSldIDogMDtcclxuICAgICAgICAgICAgKytpO1xyXG4gICAgICAgICAgICBjb25zdCBoYXZlQnl0ZTMgPSBpIDwgaW5wdXQubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDY0O1xyXG4gICAgICAgICAgICArK2k7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlNCA9IGkgPCBpbnB1dC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGU0ID0gaGF2ZUJ5dGU0ID8gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSldIDogNjQ7XHJcbiAgICAgICAgICAgICsraTtcclxuICAgICAgICAgICAgaWYgKGJ5dGUxID09IG51bGwgfHwgYnl0ZTIgPT0gbnVsbCB8fCBieXRlMyA9PSBudWxsIHx8IGJ5dGU0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVCYXNlNjRTdHJpbmdFcnJvcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUxID0gKGJ5dGUxIDw8IDIpIHwgKGJ5dGUyID4+IDQpO1xyXG4gICAgICAgICAgICBvdXRwdXQucHVzaChvdXRCeXRlMSk7XHJcbiAgICAgICAgICAgIGlmIChieXRlMyAhPT0gNjQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUyID0gKChieXRlMiA8PCA0KSAmIDB4ZjApIHwgKGJ5dGUzID4+IDIpO1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJ5dGU0ICE9PSA2NCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUzID0gKChieXRlMyA8PCA2KSAmIDB4YzApIHwgYnl0ZTQ7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBMYXp5IHN0YXRpYyBpbml0aWFsaXphdGlvbiBmdW5jdGlvbi4gQ2FsbGVkIGJlZm9yZVxyXG4gICAgICogYWNjZXNzaW5nIGFueSBvZiB0aGUgc3RhdGljIG1hcCB2YXJpYWJsZXMuXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBpbml0XygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuYnl0ZVRvQ2hhck1hcF8pIHtcclxuICAgICAgICAgICAgdGhpcy5ieXRlVG9DaGFyTWFwXyA9IHt9O1xyXG4gICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfID0ge307XHJcbiAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfID0ge307XHJcbiAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfID0ge307XHJcbiAgICAgICAgICAgIC8vIFdlIHdhbnQgcXVpY2sgbWFwcGluZ3MgYmFjayBhbmQgZm9ydGgsIHNvIHdlIHByZWNvbXB1dGUgdHdvIG1hcHMuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5FTkNPREVEX1ZBTFMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcF9baV0gPSB0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfW3RoaXMuYnl0ZVRvQ2hhck1hcF9baV1dID0gaTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfW2ldID0gdGhpcy5FTkNPREVEX1ZBTFNfV0VCU0FGRS5jaGFyQXQoaSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlX1tpXV0gPSBpO1xyXG4gICAgICAgICAgICAgICAgLy8gQmUgZm9yZ2l2aW5nIHdoZW4gZGVjb2RpbmcgYW5kIGNvcnJlY3RseSBkZWNvZGUgYm90aCBlbmNvZGluZ3MuXHJcbiAgICAgICAgICAgICAgICBpZiAoaSA+PSB0aGlzLkVOQ09ERURfVkFMU19CQVNFLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcF9bdGhpcy5FTkNPREVEX1ZBTFNfV0VCU0FGRS5jaGFyQXQoaSldID0gaTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSldID0gaTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIEFuIGVycm9yIGVuY291bnRlcmVkIHdoaWxlIGRlY29kaW5nIGJhc2U2NCBzdHJpbmcuXHJcbiAqL1xyXG5jbGFzcyBEZWNvZGVCYXNlNjRTdHJpbmdFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gJ0RlY29kZUJhc2U2NFN0cmluZ0Vycm9yJztcclxuICAgIH1cclxufVxyXG4vKipcclxuICogVVJMLXNhZmUgYmFzZTY0IGVuY29kaW5nXHJcbiAqL1xyXG5jb25zdCBiYXNlNjRFbmNvZGUgPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICBjb25zdCB1dGY4Qnl0ZXMgPSBzdHJpbmdUb0J5dGVBcnJheSQxKHN0cik7XHJcbiAgICByZXR1cm4gYmFzZTY0LmVuY29kZUJ5dGVBcnJheSh1dGY4Qnl0ZXMsIHRydWUpO1xyXG59O1xyXG4vKipcclxuICogVVJMLXNhZmUgYmFzZTY0IGVuY29kaW5nICh3aXRob3V0IFwiLlwiIHBhZGRpbmcgaW4gdGhlIGVuZCkuXHJcbiAqIGUuZy4gVXNlZCBpbiBKU09OIFdlYiBUb2tlbiAoSldUKSBwYXJ0cy5cclxuICovXHJcbmNvbnN0IGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgLy8gVXNlIGJhc2U2NHVybCBlbmNvZGluZyBhbmQgcmVtb3ZlIHBhZGRpbmcgaW4gdGhlIGVuZCAoZG90IGNoYXJhY3RlcnMpLlxyXG4gICAgcmV0dXJuIGJhc2U2NEVuY29kZShzdHIpLnJlcGxhY2UoL1xcLi9nLCAnJyk7XHJcbn07XHJcbi8qKlxyXG4gKiBVUkwtc2FmZSBiYXNlNjQgZGVjb2RpbmdcclxuICpcclxuICogTk9URTogRE8gTk9UIHVzZSB0aGUgZ2xvYmFsIGF0b2IoKSBmdW5jdGlvbiAtIGl0IGRvZXMgTk9UIHN1cHBvcnQgdGhlXHJcbiAqIGJhc2U2NFVybCB2YXJpYW50IGVuY29kaW5nLlxyXG4gKlxyXG4gKiBAcGFyYW0gc3RyIFRvIGJlIGRlY29kZWRcclxuICogQHJldHVybiBEZWNvZGVkIHJlc3VsdCwgaWYgcG9zc2libGVcclxuICovXHJcbmNvbnN0IGJhc2U2NERlY29kZSA9IGZ1bmN0aW9uIChzdHIpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIGJhc2U2NC5kZWNvZGVTdHJpbmcoc3RyLCB0cnVlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignYmFzZTY0RGVjb2RlIGZhaWxlZDogJywgZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIERvIGEgZGVlcC1jb3B5IG9mIGJhc2ljIEphdmFTY3JpcHQgT2JqZWN0cyBvciBBcnJheXMuXHJcbiAqL1xyXG5mdW5jdGlvbiBkZWVwQ29weSh2YWx1ZSkge1xyXG4gICAgcmV0dXJuIGRlZXBFeHRlbmQodW5kZWZpbmVkLCB2YWx1ZSk7XHJcbn1cclxuLyoqXHJcbiAqIENvcHkgcHJvcGVydGllcyBmcm9tIHNvdXJjZSB0byB0YXJnZXQgKHJlY3Vyc2l2ZWx5IGFsbG93cyBleHRlbnNpb25cclxuICogb2YgT2JqZWN0cyBhbmQgQXJyYXlzKS4gIFNjYWxhciB2YWx1ZXMgaW4gdGhlIHRhcmdldCBhcmUgb3Zlci13cml0dGVuLlxyXG4gKiBJZiB0YXJnZXQgaXMgdW5kZWZpbmVkLCBhbiBvYmplY3Qgb2YgdGhlIGFwcHJvcHJpYXRlIHR5cGUgd2lsbCBiZSBjcmVhdGVkXHJcbiAqIChhbmQgcmV0dXJuZWQpLlxyXG4gKlxyXG4gKiBXZSByZWN1cnNpdmVseSBjb3B5IGFsbCBjaGlsZCBwcm9wZXJ0aWVzIG9mIHBsYWluIE9iamVjdHMgaW4gdGhlIHNvdXJjZS0gc29cclxuICogdGhhdCBuYW1lc3BhY2UtIGxpa2UgZGljdGlvbmFyaWVzIGFyZSBtZXJnZWQuXHJcbiAqXHJcbiAqIE5vdGUgdGhhdCB0aGUgdGFyZ2V0IGNhbiBiZSBhIGZ1bmN0aW9uLCBpbiB3aGljaCBjYXNlIHRoZSBwcm9wZXJ0aWVzIGluXHJcbiAqIHRoZSBzb3VyY2UgT2JqZWN0IGFyZSBjb3BpZWQgb250byBpdCBhcyBzdGF0aWMgcHJvcGVydGllcyBvZiB0aGUgRnVuY3Rpb24uXHJcbiAqXHJcbiAqIE5vdGU6IHdlIGRvbid0IG1lcmdlIF9fcHJvdG9fXyB0byBwcmV2ZW50IHByb3RvdHlwZSBwb2xsdXRpb25cclxuICovXHJcbmZ1bmN0aW9uIGRlZXBFeHRlbmQodGFyZ2V0LCBzb3VyY2UpIHtcclxuICAgIGlmICghKHNvdXJjZSBpbnN0YW5jZW9mIE9iamVjdCkpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlO1xyXG4gICAgfVxyXG4gICAgc3dpdGNoIChzb3VyY2UuY29uc3RydWN0b3IpIHtcclxuICAgICAgICBjYXNlIERhdGU6XHJcbiAgICAgICAgICAgIC8vIFRyZWF0IERhdGVzIGxpa2Ugc2NhbGFyczsgaWYgdGhlIHRhcmdldCBkYXRlIG9iamVjdCBoYWQgYW55IGNoaWxkXHJcbiAgICAgICAgICAgIC8vIHByb3BlcnRpZXMgLSB0aGV5IHdpbGwgYmUgbG9zdCFcclxuICAgICAgICAgICAgY29uc3QgZGF0ZVZhbHVlID0gc291cmNlO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZVZhbHVlLmdldFRpbWUoKSk7XHJcbiAgICAgICAgY2FzZSBPYmplY3Q6XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0ge307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBBcnJheTpcclxuICAgICAgICAgICAgLy8gQWx3YXlzIGNvcHkgdGhlIGFycmF5IHNvdXJjZSBhbmQgb3ZlcndyaXRlIHRoZSB0YXJnZXQuXHJcbiAgICAgICAgICAgIHRhcmdldCA9IFtdO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAvLyBOb3QgYSBwbGFpbiBPYmplY3QgLSB0cmVhdCBpdCBhcyBhIHNjYWxhci5cclxuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgcHJvcCBpbiBzb3VyY2UpIHtcclxuICAgICAgICAvLyB1c2UgaXNWYWxpZEtleSB0byBndWFyZCBhZ2FpbnN0IHByb3RvdHlwZSBwb2xsdXRpb24uIFNlZSBodHRwczovL3NueWsuaW8vdnVsbi9TTllLLUpTLUxPREFTSC00NTAyMDJcclxuICAgICAgICBpZiAoIXNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSB8fCAhaXNWYWxpZEtleShwcm9wKSkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFyZ2V0W3Byb3BdID0gZGVlcEV4dGVuZCh0YXJnZXRbcHJvcF0sIHNvdXJjZVtwcm9wXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGFyZ2V0O1xyXG59XHJcbmZ1bmN0aW9uIGlzVmFsaWRLZXkoa2V5KSB7XHJcbiAgICByZXR1cm4ga2V5ICE9PSAnX19wcm90b19fJztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUG9seWZpbGwgZm9yIGBnbG9iYWxUaGlzYCBvYmplY3QuXHJcbiAqIEByZXR1cm5zIHRoZSBgZ2xvYmFsVGhpc2Agb2JqZWN0IGZvciB0aGUgZ2l2ZW4gZW52aXJvbm1lbnQuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEdsb2JhbCgpIHtcclxuICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybiB3aW5kb3c7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICByZXR1cm4gZ2xvYmFsO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gbG9jYXRlIGdsb2JhbCBvYmplY3QuJyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgZ2V0RGVmYXVsdHNGcm9tR2xvYmFsID0gKCkgPT4gZ2V0R2xvYmFsKCkuX19GSVJFQkFTRV9ERUZBVUxUU19fO1xyXG4vKipcclxuICogQXR0ZW1wdCB0byByZWFkIGRlZmF1bHRzIGZyb20gYSBKU09OIHN0cmluZyBwcm92aWRlZCB0b1xyXG4gKiBwcm9jZXNzKC4pZW52KC4pX19GSVJFQkFTRV9ERUZBVUxUU19fIG9yIGEgSlNPTiBmaWxlIHdob3NlIHBhdGggaXMgaW5cclxuICogcHJvY2VzcyguKWVudiguKV9fRklSRUJBU0VfREVGQVVMVFNfUEFUSF9fXHJcbiAqIFRoZSBkb3RzIGFyZSBpbiBwYXJlbnMgYmVjYXVzZSBjZXJ0YWluIGNvbXBpbGVycyAoVml0ZT8pIGNhbm5vdFxyXG4gKiBoYW5kbGUgc2VlaW5nIHRoYXQgdmFyaWFibGUgaW4gY29tbWVudHMuXHJcbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy82ODM4XHJcbiAqL1xyXG5jb25zdCBnZXREZWZhdWx0c0Zyb21FbnZWYXJpYWJsZSA9ICgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHByb2Nlc3MuZW52ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGRlZmF1bHRzSnNvblN0cmluZyA9IHByb2Nlc3MuZW52Ll9fRklSRUJBU0VfREVGQVVMVFNfXztcclxuICAgIGlmIChkZWZhdWx0c0pzb25TdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkZWZhdWx0c0pzb25TdHJpbmcpO1xyXG4gICAgfVxyXG59O1xyXG5jb25zdCBnZXREZWZhdWx0c0Zyb21Db29raWUgPSAoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBtYXRjaDtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgbWF0Y2ggPSBkb2N1bWVudC5jb29raWUubWF0Y2goL19fRklSRUJBU0VfREVGQVVMVFNfXz0oW147XSspLyk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vIFNvbWUgZW52aXJvbm1lbnRzIHN1Y2ggYXMgQW5ndWxhciBVbml2ZXJzYWwgU1NSIGhhdmUgYVxyXG4gICAgICAgIC8vIGBkb2N1bWVudGAgb2JqZWN0IGJ1dCBlcnJvciBvbiBhY2Nlc3NpbmcgYGRvY3VtZW50LmNvb2tpZWAuXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGVjb2RlZCA9IG1hdGNoICYmIGJhc2U2NERlY29kZShtYXRjaFsxXSk7XHJcbiAgICByZXR1cm4gZGVjb2RlZCAmJiBKU09OLnBhcnNlKGRlY29kZWQpO1xyXG59O1xyXG4vKipcclxuICogR2V0IHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0LiBJdCBjaGVja3MgaW4gb3JkZXI6XHJcbiAqICgxKSBpZiBzdWNoIGFuIG9iamVjdCBleGlzdHMgYXMgYSBwcm9wZXJ0eSBvZiBgZ2xvYmFsVGhpc2BcclxuICogKDIpIGlmIHN1Y2ggYW4gb2JqZWN0IHdhcyBwcm92aWRlZCBvbiBhIHNoZWxsIGVudmlyb25tZW50IHZhcmlhYmxlXHJcbiAqICgzKSBpZiBzdWNoIGFuIG9iamVjdCBleGlzdHMgaW4gYSBjb29raWVcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgZ2V0RGVmYXVsdHMgPSAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiAoZ2V0RGVmYXVsdHNGcm9tR2xvYmFsKCkgfHxcclxuICAgICAgICAgICAgZ2V0RGVmYXVsdHNGcm9tRW52VmFyaWFibGUoKSB8fFxyXG4gICAgICAgICAgICBnZXREZWZhdWx0c0Zyb21Db29raWUoKSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENhdGNoLWFsbCBmb3IgYmVpbmcgdW5hYmxlIHRvIGdldCBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gZHVlXHJcbiAgICAgICAgICogdG8gYW55IGVudmlyb25tZW50IGNhc2Ugd2UgaGF2ZSBub3QgYWNjb3VudGVkIGZvci4gTG9nIHRvXHJcbiAgICAgICAgICogaW5mbyBpbnN0ZWFkIG9mIHN3YWxsb3dpbmcgc28gd2UgY2FuIGZpbmQgdGhlc2UgdW5rbm93biBjYXNlc1xyXG4gICAgICAgICAqIGFuZCBhZGQgcGF0aHMgZm9yIHRoZW0gaWYgbmVlZGVkLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbyhgVW5hYmxlIHRvIGdldCBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gZHVlIHRvOiAke2V9YCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICogUmV0dXJucyBlbXVsYXRvciBob3N0IHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdFxyXG4gKiBmb3IgdGhlIGdpdmVuIHByb2R1Y3QuXHJcbiAqIEByZXR1cm5zIGEgVVJMIGhvc3QgZm9ybWF0dGVkIGxpa2UgYDEyNy4wLjAuMTo5OTk5YCBvciBgWzo6MV06NDAwMGAgaWYgYXZhaWxhYmxlXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGdldERlZmF1bHRFbXVsYXRvckhvc3QgPSAocHJvZHVjdE5hbWUpID0+IHsgdmFyIF9hLCBfYjsgcmV0dXJuIChfYiA9IChfYSA9IGdldERlZmF1bHRzKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lbXVsYXRvckhvc3RzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbcHJvZHVjdE5hbWVdOyB9O1xyXG4vKipcclxuICogUmV0dXJucyBlbXVsYXRvciBob3N0bmFtZSBhbmQgcG9ydCBzdG9yZWQgaW4gdGhlIF9fRklSRUJBU0VfREVGQVVMVFNfXyBvYmplY3RcclxuICogZm9yIHRoZSBnaXZlbiBwcm9kdWN0LlxyXG4gKiBAcmV0dXJucyBhIHBhaXIgb2YgaG9zdG5hbWUgYW5kIHBvcnQgbGlrZSBgW1wiOjoxXCIsIDQwMDBdYCBpZiBhdmFpbGFibGVcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0ID0gKHByb2R1Y3ROYW1lKSA9PiB7XHJcbiAgICBjb25zdCBob3N0ID0gZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdChwcm9kdWN0TmFtZSk7XHJcbiAgICBpZiAoIWhvc3QpIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc2VwYXJhdG9ySW5kZXggPSBob3N0Lmxhc3RJbmRleE9mKCc6Jyk7IC8vIEZpbmRpbmcgdGhlIGxhc3Qgc2luY2UgSVB2NiBhZGRyIGFsc28gaGFzIGNvbG9ucy5cclxuICAgIGlmIChzZXBhcmF0b3JJbmRleCA8PSAwIHx8IHNlcGFyYXRvckluZGV4ICsgMSA9PT0gaG9zdC5sZW5ndGgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgaG9zdCAke2hvc3R9IHdpdGggbm8gc2VwYXJhdGUgaG9zdG5hbWUgYW5kIHBvcnQhYCk7XHJcbiAgICB9XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXHJcbiAgICBjb25zdCBwb3J0ID0gcGFyc2VJbnQoaG9zdC5zdWJzdHJpbmcoc2VwYXJhdG9ySW5kZXggKyAxKSwgMTApO1xyXG4gICAgaWYgKGhvc3RbMF0gPT09ICdbJykge1xyXG4gICAgICAgIC8vIEJyYWNrZXQtcXVvdGVkIGBbaXB2NmFkZHJdOnBvcnRgID0+IHJldHVybiBcImlwdjZhZGRyXCIgKHdpdGhvdXQgYnJhY2tldHMpLlxyXG4gICAgICAgIHJldHVybiBbaG9zdC5zdWJzdHJpbmcoMSwgc2VwYXJhdG9ySW5kZXggLSAxKSwgcG9ydF07XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gW2hvc3Quc3Vic3RyaW5nKDAsIHNlcGFyYXRvckluZGV4KSwgcG9ydF07XHJcbiAgICB9XHJcbn07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIEZpcmViYXNlIGFwcCBjb25maWcgc3RvcmVkIGluIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0LlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBnZXREZWZhdWx0QXBwQ29uZmlnID0gKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBnZXREZWZhdWx0cygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29uZmlnOyB9O1xyXG4vKipcclxuICogUmV0dXJucyBhbiBleHBlcmltZW50YWwgc2V0dGluZyBvbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdCAocHJvcGVydGllc1xyXG4gKiBwcmVmaXhlZCBieSBcIl9cIilcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgZ2V0RXhwZXJpbWVudGFsU2V0dGluZyA9IChuYW1lKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IGdldERlZmF1bHRzKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtgXyR7bmFtZX1gXTsgfTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgRGVmZXJyZWQge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5yZWplY3QgPSAoKSA9PiB7IH07XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlID0gKCkgPT4geyB9O1xyXG4gICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZXNvbHZlID0gcmVzb2x2ZTtcclxuICAgICAgICAgICAgdGhpcy5yZWplY3QgPSByZWplY3Q7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE91ciBBUEkgaW50ZXJuYWxzIGFyZSBub3QgcHJvbWlzaWZpZWQgYW5kIGNhbm5vdCBiZWNhdXNlIG91ciBjYWxsYmFjayBBUElzIGhhdmUgc3VidGxlIGV4cGVjdGF0aW9ucyBhcm91bmRcclxuICAgICAqIGludm9raW5nIHByb21pc2VzIGlubGluZSwgd2hpY2ggUHJvbWlzZXMgYXJlIGZvcmJpZGRlbiB0byBkby4gVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBvcHRpb25hbCBub2RlLXN0eWxlIGNhbGxiYWNrXHJcbiAgICAgKiBhbmQgcmV0dXJucyBhIG5vZGUtc3R5bGUgY2FsbGJhY2sgd2hpY2ggd2lsbCByZXNvbHZlIG9yIHJlamVjdCB0aGUgRGVmZXJyZWQncyBwcm9taXNlLlxyXG4gICAgICovXHJcbiAgICB3cmFwQ2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgICAgICByZXR1cm4gKGVycm9yLCB2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgLy8gQXR0YWNoaW5nIG5vb3AgaGFuZGxlciBqdXN0IGluIGNhc2UgZGV2ZWxvcGVyIHdhc24ndCBleHBlY3RpbmdcclxuICAgICAgICAgICAgICAgIC8vIHByb21pc2VzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb21pc2UuY2F0Y2goKCkgPT4geyB9KTtcclxuICAgICAgICAgICAgICAgIC8vIFNvbWUgb2Ygb3VyIGNhbGxiYWNrcyBkb24ndCBleHBlY3QgYSB2YWx1ZSBhbmQgb3VyIG93biB0ZXN0c1xyXG4gICAgICAgICAgICAgICAgLy8gYXNzZXJ0IHRoYXQgdGhlIHBhcmFtZXRlciBsZW5ndGggaXMgMVxyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZU1vY2tVc2VyVG9rZW4odG9rZW4sIHByb2plY3RJZCkge1xyXG4gICAgaWYgKHRva2VuLnVpZCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIFwidWlkXCIgZmllbGQgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCBieSBtb2NrVXNlclRva2VuLiBQbGVhc2UgdXNlIFwic3ViXCIgaW5zdGVhZCBmb3IgRmlyZWJhc2UgQXV0aCBVc2VyIElELicpO1xyXG4gICAgfVxyXG4gICAgLy8gVW5zZWN1cmVkIEpXVHMgdXNlIFwibm9uZVwiIGFzIHRoZSBhbGdvcml0aG0uXHJcbiAgICBjb25zdCBoZWFkZXIgPSB7XHJcbiAgICAgICAgYWxnOiAnbm9uZScsXHJcbiAgICAgICAgdHlwZTogJ0pXVCdcclxuICAgIH07XHJcbiAgICBjb25zdCBwcm9qZWN0ID0gcHJvamVjdElkIHx8ICdkZW1vLXByb2plY3QnO1xyXG4gICAgY29uc3QgaWF0ID0gdG9rZW4uaWF0IHx8IDA7XHJcbiAgICBjb25zdCBzdWIgPSB0b2tlbi5zdWIgfHwgdG9rZW4udXNlcl9pZDtcclxuICAgIGlmICghc3ViKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkIVwiKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKHsgXHJcbiAgICAgICAgLy8gU2V0IGFsbCByZXF1aXJlZCBmaWVsZHMgdG8gZGVjZW50IGRlZmF1bHRzXHJcbiAgICAgICAgaXNzOiBgaHR0cHM6Ly9zZWN1cmV0b2tlbi5nb29nbGUuY29tLyR7cHJvamVjdH1gLCBhdWQ6IHByb2plY3QsIGlhdCwgZXhwOiBpYXQgKyAzNjAwLCBhdXRoX3RpbWU6IGlhdCwgc3ViLCB1c2VyX2lkOiBzdWIsIGZpcmViYXNlOiB7XHJcbiAgICAgICAgICAgIHNpZ25faW5fcHJvdmlkZXI6ICdjdXN0b20nLFxyXG4gICAgICAgICAgICBpZGVudGl0aWVzOiB7fVxyXG4gICAgICAgIH0gfSwgdG9rZW4pO1xyXG4gICAgLy8gVW5zZWN1cmVkIEpXVHMgdXNlIHRoZSBlbXB0eSBzdHJpbmcgYXMgYSBzaWduYXR1cmUuXHJcbiAgICBjb25zdCBzaWduYXR1cmUgPSAnJztcclxuICAgIHJldHVybiBbXHJcbiAgICAgICAgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoSlNPTi5zdHJpbmdpZnkoaGVhZGVyKSksXHJcbiAgICAgICAgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpLFxyXG4gICAgICAgIHNpZ25hdHVyZVxyXG4gICAgXS5qb2luKCcuJyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFJldHVybnMgbmF2aWdhdG9yLnVzZXJBZ2VudCBzdHJpbmcgb3IgJycgaWYgaXQncyBub3QgZGVmaW5lZC5cclxuICogQHJldHVybiB1c2VyIGFnZW50IHN0cmluZ1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0VUEoKSB7XHJcbiAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgICB0eXBlb2YgbmF2aWdhdG9yWyd1c2VyQWdlbnQnXSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICByZXR1cm4gbmF2aWdhdG9yWyd1c2VyQWdlbnQnXTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxyXG4vKipcclxuICogRGV0ZWN0IENvcmRvdmEgLyBQaG9uZUdhcCAvIElvbmljIGZyYW1ld29ya3Mgb24gYSBtb2JpbGUgZGV2aWNlLlxyXG4gKlxyXG4gKiBEZWxpYmVyYXRlbHkgZG9lcyBub3QgcmVseSBvbiBjaGVja2luZyBgZmlsZTovL2AgVVJMcyAoYXMgdGhpcyBmYWlscyBQaG9uZUdhcFxyXG4gKiBpbiB0aGUgUmlwcGxlIGVtdWxhdG9yKSBub3IgQ29yZG92YSBgb25EZXZpY2VSZWFkeWAsIHdoaWNoIHdvdWxkIG5vcm1hbGx5XHJcbiAqIHdhaXQgZm9yIGEgY2FsbGJhY2suXHJcbiAqL1xyXG5mdW5jdGlvbiBpc01vYmlsZUNvcmRvdmEoKSB7XHJcbiAgICByZXR1cm4gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmXHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZSBTZXR0aW5nIHVwIGFuIGJyb2FkbHkgYXBwbGljYWJsZSBpbmRleCBzaWduYXR1cmUgZm9yIFdpbmRvd1xyXG4gICAgICAgIC8vIGp1c3QgdG8gZGVhbCB3aXRoIHRoaXMgY2FzZSB3b3VsZCBwcm9iYWJseSBiZSBhIGJhZCBpZGVhLlxyXG4gICAgICAgICEhKHdpbmRvd1snY29yZG92YSddIHx8IHdpbmRvd1sncGhvbmVnYXAnXSB8fCB3aW5kb3dbJ1Bob25lR2FwJ10pICYmXHJcbiAgICAgICAgL2lvc3xpcGhvbmV8aXBvZHxpcGFkfGFuZHJvaWR8YmxhY2tiZXJyeXxpZW1vYmlsZS9pLnRlc3QoZ2V0VUEoKSkpO1xyXG59XHJcbi8qKlxyXG4gKiBEZXRlY3QgTm9kZS5qcy5cclxuICpcclxuICogQHJldHVybiB0cnVlIGlmIE5vZGUuanMgZW52aXJvbm1lbnQgaXMgZGV0ZWN0ZWQgb3Igc3BlY2lmaWVkLlxyXG4gKi9cclxuLy8gTm9kZSBkZXRlY3Rpb24gbG9naWMgZnJvbTogaHR0cHM6Ly9naXRodWIuY29tL2lsaWFrYW4vZGV0ZWN0LW5vZGUvXHJcbmZ1bmN0aW9uIGlzTm9kZSgpIHtcclxuICAgIHZhciBfYTtcclxuICAgIGNvbnN0IGZvcmNlRW52aXJvbm1lbnQgPSAoX2EgPSBnZXREZWZhdWx0cygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yY2VFbnZpcm9ubWVudDtcclxuICAgIGlmIChmb3JjZUVudmlyb25tZW50ID09PSAnbm9kZScpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZvcmNlRW52aXJvbm1lbnQgPT09ICdicm93c2VyJykge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZ2xvYmFsLnByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXScpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIERldGVjdCBCcm93c2VyIEVudmlyb25tZW50LlxyXG4gKiBOb3RlOiBUaGlzIHdpbGwgcmV0dXJuIHRydWUgZm9yIGNlcnRhaW4gdGVzdCBmcmFtZXdvcmtzIHRoYXQgYXJlIGluY29tcGxldGVseVxyXG4gKiBtaW1pY2tpbmcgYSBicm93c2VyLCBhbmQgc2hvdWxkIG5vdCBsZWFkIHRvIGFzc3VtaW5nIGFsbCBicm93c2VyIEFQSXMgYXJlXHJcbiAqIGF2YWlsYWJsZS5cclxuICovXHJcbmZ1bmN0aW9uIGlzQnJvd3NlcigpIHtcclxuICAgIHJldHVybiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyB8fCBpc1dlYldvcmtlcigpO1xyXG59XHJcbi8qKlxyXG4gKiBEZXRlY3QgV2ViIFdvcmtlciBjb250ZXh0LlxyXG4gKi9cclxuZnVuY3Rpb24gaXNXZWJXb3JrZXIoKSB7XHJcbiAgICByZXR1cm4gKHR5cGVvZiBXb3JrZXJHbG9iYWxTY29wZSAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgICB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgICBzZWxmIGluc3RhbmNlb2YgV29ya2VyR2xvYmFsU2NvcGUpO1xyXG59XHJcbi8qKlxyXG4gKiBEZXRlY3QgQ2xvdWRmbGFyZSBXb3JrZXIgY29udGV4dC5cclxuICovXHJcbmZ1bmN0aW9uIGlzQ2xvdWRmbGFyZVdvcmtlcigpIHtcclxuICAgIHJldHVybiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgICBuYXZpZ2F0b3IudXNlckFnZW50ID09PSAnQ2xvdWRmbGFyZS1Xb3JrZXJzJyk7XHJcbn1cclxuZnVuY3Rpb24gaXNCcm93c2VyRXh0ZW5zaW9uKCkge1xyXG4gICAgY29uc3QgcnVudGltZSA9IHR5cGVvZiBjaHJvbWUgPT09ICdvYmplY3QnXHJcbiAgICAgICAgPyBjaHJvbWUucnVudGltZVxyXG4gICAgICAgIDogdHlwZW9mIGJyb3dzZXIgPT09ICdvYmplY3QnXHJcbiAgICAgICAgICAgID8gYnJvd3Nlci5ydW50aW1lXHJcbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xyXG4gICAgcmV0dXJuIHR5cGVvZiBydW50aW1lID09PSAnb2JqZWN0JyAmJiBydW50aW1lLmlkICE9PSB1bmRlZmluZWQ7XHJcbn1cclxuLyoqXHJcbiAqIERldGVjdCBSZWFjdCBOYXRpdmUuXHJcbiAqXHJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBSZWFjdE5hdGl2ZSBlbnZpcm9ubWVudCBpcyBkZXRlY3RlZC5cclxuICovXHJcbmZ1bmN0aW9uIGlzUmVhY3ROYXRpdmUoKSB7XHJcbiAgICByZXR1cm4gKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICdvYmplY3QnICYmIG5hdmlnYXRvclsncHJvZHVjdCddID09PSAnUmVhY3ROYXRpdmUnKTtcclxufVxyXG4vKiogRGV0ZWN0cyBFbGVjdHJvbiBhcHBzLiAqL1xyXG5mdW5jdGlvbiBpc0VsZWN0cm9uKCkge1xyXG4gICAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignRWxlY3Ryb24vJykgPj0gMDtcclxufVxyXG4vKiogRGV0ZWN0cyBJbnRlcm5ldCBFeHBsb3Jlci4gKi9cclxuZnVuY3Rpb24gaXNJRSgpIHtcclxuICAgIGNvbnN0IHVhID0gZ2V0VUEoKTtcclxuICAgIHJldHVybiB1YS5pbmRleE9mKCdNU0lFICcpID49IDAgfHwgdWEuaW5kZXhPZignVHJpZGVudC8nKSA+PSAwO1xyXG59XHJcbi8qKiBEZXRlY3RzIFVuaXZlcnNhbCBXaW5kb3dzIFBsYXRmb3JtIGFwcHMuICovXHJcbmZ1bmN0aW9uIGlzVVdQKCkge1xyXG4gICAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignTVNBcHBIb3N0LycpID49IDA7XHJcbn1cclxuLyoqXHJcbiAqIERldGVjdCB3aGV0aGVyIHRoZSBjdXJyZW50IFNESyBidWlsZCBpcyB0aGUgTm9kZSB2ZXJzaW9uLlxyXG4gKlxyXG4gKiBAcmV0dXJuIHRydWUgaWYgaXQncyB0aGUgTm9kZSBTREsgYnVpbGQuXHJcbiAqL1xyXG5mdW5jdGlvbiBpc05vZGVTZGsoKSB7XHJcbiAgICByZXR1cm4gQ09OU1RBTlRTLk5PREVfQ0xJRU5UID09PSB0cnVlIHx8IENPTlNUQU5UUy5OT0RFX0FETUlOID09PSB0cnVlO1xyXG59XHJcbi8qKiBSZXR1cm5zIHRydWUgaWYgd2UgYXJlIHJ1bm5pbmcgaW4gU2FmYXJpLiAqL1xyXG5mdW5jdGlvbiBpc1NhZmFyaSgpIHtcclxuICAgIHJldHVybiAoIWlzTm9kZSgpICYmXHJcbiAgICAgICAgISFuYXZpZ2F0b3IudXNlckFnZW50ICYmXHJcbiAgICAgICAgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcygnU2FmYXJpJykgJiZcclxuICAgICAgICAhbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcygnQ2hyb21lJykpO1xyXG59XHJcbi8qKlxyXG4gKiBUaGlzIG1ldGhvZCBjaGVja3MgaWYgaW5kZXhlZERCIGlzIHN1cHBvcnRlZCBieSBjdXJyZW50IGJyb3dzZXIvc2VydmljZSB3b3JrZXIgY29udGV4dFxyXG4gKiBAcmV0dXJuIHRydWUgaWYgaW5kZXhlZERCIGlzIHN1cHBvcnRlZCBieSBjdXJyZW50IGJyb3dzZXIvc2VydmljZSB3b3JrZXIgY29udGV4dFxyXG4gKi9cclxuZnVuY3Rpb24gaXNJbmRleGVkREJBdmFpbGFibGUoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiB0eXBlb2YgaW5kZXhlZERCID09PSAnb2JqZWN0JztcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBUaGlzIG1ldGhvZCB2YWxpZGF0ZXMgYnJvd3Nlci9zdyBjb250ZXh0IGZvciBpbmRleGVkREIgYnkgb3BlbmluZyBhIGR1bW15IGluZGV4ZWREQiBkYXRhYmFzZSBhbmQgcmVqZWN0XHJcbiAqIGlmIGVycm9ycyBvY2N1ciBkdXJpbmcgdGhlIGRhdGFiYXNlIG9wZW4gb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAdGhyb3dzIGV4Y2VwdGlvbiBpZiBjdXJyZW50IGJyb3dzZXIvc3cgY29udGV4dCBjYW4ndCBydW4gaWRiLm9wZW4gKGV4OiBTYWZhcmkgaWZyYW1lLCBGaXJlZm94XHJcbiAqIHByaXZhdGUgYnJvd3NpbmcpXHJcbiAqL1xyXG5mdW5jdGlvbiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBsZXQgcHJlRXhpc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICBjb25zdCBEQl9DSEVDS19OQU1FID0gJ3ZhbGlkYXRlLWJyb3dzZXItY29udGV4dC1mb3ItaW5kZXhlZGRiLWFuYWx5dGljcy1tb2R1bGUnO1xyXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihEQl9DSEVDS19OQU1FKTtcclxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnJlc3VsdC5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gZGVsZXRlIGRhdGFiYXNlIG9ubHkgd2hlbiBpdCBkb2Vzbid0IHByZS1leGlzdFxyXG4gICAgICAgICAgICAgICAgaWYgKCFwcmVFeGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKERCX0NIRUNLX05BTUUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBwcmVFeGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoKChfYSA9IHJlcXVlc3QuZXJyb3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tZXNzYWdlKSB8fCAnJyk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBjaGVja3Mgd2hldGhlciBjb29raWUgaXMgZW5hYmxlZCB3aXRoaW4gY3VycmVudCBicm93c2VyXHJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBjb29raWUgaXMgZW5hYmxlZCB3aXRoaW4gY3VycmVudCBicm93c2VyXHJcbiAqL1xyXG5mdW5jdGlvbiBhcmVDb29raWVzRW5hYmxlZCgpIHtcclxuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yID09PSAndW5kZWZpbmVkJyB8fCAhbmF2aWdhdG9yLmNvb2tpZUVuYWJsZWQpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQGZpbGVvdmVydmlldyBTdGFuZGFyZGl6ZWQgRmlyZWJhc2UgRXJyb3IuXHJcbiAqXHJcbiAqIFVzYWdlOlxyXG4gKlxyXG4gKiAgIC8vIFR5cGVTY3JpcHQgc3RyaW5nIGxpdGVyYWxzIGZvciB0eXBlLXNhZmUgY29kZXNcclxuICogICB0eXBlIEVyciA9XHJcbiAqICAgICAndW5rbm93bicgfFxyXG4gKiAgICAgJ29iamVjdC1ub3QtZm91bmQnXHJcbiAqICAgICA7XHJcbiAqXHJcbiAqICAgLy8gQ2xvc3VyZSBlbnVtIGZvciB0eXBlLXNhZmUgZXJyb3IgY29kZXNcclxuICogICAvLyBhdC1lbnVtIHtzdHJpbmd9XHJcbiAqICAgdmFyIEVyciA9IHtcclxuICogICAgIFVOS05PV046ICd1bmtub3duJyxcclxuICogICAgIE9CSkVDVF9OT1RfRk9VTkQ6ICdvYmplY3Qtbm90LWZvdW5kJyxcclxuICogICB9XHJcbiAqXHJcbiAqICAgbGV0IGVycm9yczogTWFwPEVyciwgc3RyaW5nPiA9IHtcclxuICogICAgICdnZW5lcmljLWVycm9yJzogXCJVbmtub3duIGVycm9yXCIsXHJcbiAqICAgICAnZmlsZS1ub3QtZm91bmQnOiBcIkNvdWxkIG5vdCBmaW5kIGZpbGU6IHskZmlsZX1cIixcclxuICogICB9O1xyXG4gKlxyXG4gKiAgIC8vIFR5cGUtc2FmZSBmdW5jdGlvbiAtIG11c3QgcGFzcyBhIHZhbGlkIGVycm9yIGNvZGUgYXMgcGFyYW0uXHJcbiAqICAgbGV0IGVycm9yID0gbmV3IEVycm9yRmFjdG9yeTxFcnI+KCdzZXJ2aWNlJywgJ1NlcnZpY2UnLCBlcnJvcnMpO1xyXG4gKlxyXG4gKiAgIC4uLlxyXG4gKiAgIHRocm93IGVycm9yLmNyZWF0ZShFcnIuR0VORVJJQyk7XHJcbiAqICAgLi4uXHJcbiAqICAgdGhyb3cgZXJyb3IuY3JlYXRlKEVyci5GSUxFX05PVF9GT1VORCwgeydmaWxlJzogZmlsZU5hbWV9KTtcclxuICogICAuLi5cclxuICogICAvLyBTZXJ2aWNlOiBDb3VsZCBub3QgZmlsZSBmaWxlOiBmb28udHh0IChzZXJ2aWNlL2ZpbGUtbm90LWZvdW5kKS5cclxuICpcclxuICogICBjYXRjaCAoZSkge1xyXG4gKiAgICAgYXNzZXJ0KGUubWVzc2FnZSA9PT0gXCJDb3VsZCBub3QgZmluZCBmaWxlOiBmb28udHh0LlwiKTtcclxuICogICAgIGlmICgoZSBhcyBGaXJlYmFzZUVycm9yKT8uY29kZSA9PT0gJ3NlcnZpY2UvZmlsZS1ub3QtZm91bmQnKSB7XHJcbiAqICAgICAgIGNvbnNvbGUubG9nKFwiQ291bGQgbm90IHJlYWQgZmlsZTogXCIgKyBlWydmaWxlJ10pO1xyXG4gKiAgICAgfVxyXG4gKiAgIH1cclxuICovXHJcbmNvbnN0IEVSUk9SX05BTUUgPSAnRmlyZWJhc2VFcnJvcic7XHJcbi8vIEJhc2VkIG9uIGNvZGUgZnJvbTpcclxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRXJyb3IjQ3VzdG9tX0Vycm9yX1R5cGVzXHJcbmNsYXNzIEZpcmViYXNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgIC8qKiBUaGUgZXJyb3IgY29kZSBmb3IgdGhpcyBlcnJvci4gKi9cclxuICAgIGNvZGUsIG1lc3NhZ2UsIFxyXG4gICAgLyoqIEN1c3RvbSBkYXRhIGZvciB0aGlzIGVycm9yLiAqL1xyXG4gICAgY3VzdG9tRGF0YSkge1xyXG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xyXG4gICAgICAgIHRoaXMuY29kZSA9IGNvZGU7XHJcbiAgICAgICAgdGhpcy5jdXN0b21EYXRhID0gY3VzdG9tRGF0YTtcclxuICAgICAgICAvKiogVGhlIGN1c3RvbSBuYW1lIGZvciBhbGwgRmlyZWJhc2VFcnJvcnMuICovXHJcbiAgICAgICAgdGhpcy5uYW1lID0gRVJST1JfTkFNRTtcclxuICAgICAgICAvLyBGaXggRm9yIEVTNVxyXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC13aWtpL2Jsb2IvbWFzdGVyL0JyZWFraW5nLUNoYW5nZXMubWQjZXh0ZW5kaW5nLWJ1aWx0LWlucy1saWtlLWVycm9yLWFycmF5LWFuZC1tYXAtbWF5LW5vLWxvbmdlci13b3JrXHJcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIEZpcmViYXNlRXJyb3IucHJvdG90eXBlKTtcclxuICAgICAgICAvLyBNYWludGFpbnMgcHJvcGVyIHN0YWNrIHRyYWNlIGZvciB3aGVyZSBvdXIgZXJyb3Igd2FzIHRocm93bi5cclxuICAgICAgICAvLyBPbmx5IGF2YWlsYWJsZSBvbiBWOC5cclxuICAgICAgICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcclxuICAgICAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgRXJyb3JGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5jbGFzcyBFcnJvckZhY3Rvcnkge1xyXG4gICAgY29uc3RydWN0b3Ioc2VydmljZSwgc2VydmljZU5hbWUsIGVycm9ycykge1xyXG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlTmFtZSA9IHNlcnZpY2VOYW1lO1xyXG4gICAgICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlKGNvZGUsIC4uLmRhdGEpIHtcclxuICAgICAgICBjb25zdCBjdXN0b21EYXRhID0gZGF0YVswXSB8fCB7fTtcclxuICAgICAgICBjb25zdCBmdWxsQ29kZSA9IGAke3RoaXMuc2VydmljZX0vJHtjb2RlfWA7XHJcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLmVycm9yc1tjb2RlXTtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gdGVtcGxhdGUgPyByZXBsYWNlVGVtcGxhdGUodGVtcGxhdGUsIGN1c3RvbURhdGEpIDogJ0Vycm9yJztcclxuICAgICAgICAvLyBTZXJ2aWNlIE5hbWU6IEVycm9yIG1lc3NhZ2UgKHNlcnZpY2UvY29kZSkuXHJcbiAgICAgICAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgJHt0aGlzLnNlcnZpY2VOYW1lfTogJHttZXNzYWdlfSAoJHtmdWxsQ29kZX0pLmA7XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRmlyZWJhc2VFcnJvcihmdWxsQ29kZSwgZnVsbE1lc3NhZ2UsIGN1c3RvbURhdGEpO1xyXG4gICAgICAgIHJldHVybiBlcnJvcjtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXBsYWNlVGVtcGxhdGUodGVtcGxhdGUsIGRhdGEpIHtcclxuICAgIHJldHVybiB0ZW1wbGF0ZS5yZXBsYWNlKFBBVFRFUk4sIChfLCBrZXkpID0+IHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGRhdGFba2V5XTtcclxuICAgICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCA/IFN0cmluZyh2YWx1ZSkgOiBgPCR7a2V5fT8+YDtcclxuICAgIH0pO1xyXG59XHJcbmNvbnN0IFBBVFRFUk4gPSAvXFx7XFwkKFtefV0rKX0vZztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEV2YWx1YXRlcyBhIEpTT04gc3RyaW5nIGludG8gYSBqYXZhc2NyaXB0IG9iamVjdC5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBBIHN0cmluZyBjb250YWluaW5nIEpTT04uXHJcbiAqIEByZXR1cm4geyp9IFRoZSBqYXZhc2NyaXB0IG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNwZWNpZmllZCBKU09OLlxyXG4gKi9cclxuZnVuY3Rpb24ganNvbkV2YWwoc3RyKSB7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShzdHIpO1xyXG59XHJcbi8qKlxyXG4gKiBSZXR1cm5zIEpTT04gcmVwcmVzZW50aW5nIGEgamF2YXNjcmlwdCBvYmplY3QuXHJcbiAqIEBwYXJhbSB7Kn0gZGF0YSBKYXZhU2NyaXB0IG9iamVjdCB0byBiZSBzdHJpbmdpZmllZC5cclxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgSlNPTiBjb250ZW50cyBvZiB0aGUgb2JqZWN0LlxyXG4gKi9cclxuZnVuY3Rpb24gc3RyaW5naWZ5KGRhdGEpIHtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRGVjb2RlcyBhIEZpcmViYXNlIGF1dGguIHRva2VuIGludG8gY29uc3RpdHVlbnQgcGFydHMuXHJcbiAqXHJcbiAqIE5vdGVzOlxyXG4gKiAtIE1heSByZXR1cm4gd2l0aCBpbnZhbGlkIC8gaW5jb21wbGV0ZSBjbGFpbXMgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXHJcbiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuXHJcbiAqL1xyXG5jb25zdCBkZWNvZGUgPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgIGxldCBoZWFkZXIgPSB7fSwgY2xhaW1zID0ge30sIGRhdGEgPSB7fSwgc2lnbmF0dXJlID0gJyc7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gdG9rZW4uc3BsaXQoJy4nKTtcclxuICAgICAgICBoZWFkZXIgPSBqc29uRXZhbChiYXNlNjREZWNvZGUocGFydHNbMF0pIHx8ICcnKTtcclxuICAgICAgICBjbGFpbXMgPSBqc29uRXZhbChiYXNlNjREZWNvZGUocGFydHNbMV0pIHx8ICcnKTtcclxuICAgICAgICBzaWduYXR1cmUgPSBwYXJ0c1syXTtcclxuICAgICAgICBkYXRhID0gY2xhaW1zWydkJ10gfHwge307XHJcbiAgICAgICAgZGVsZXRlIGNsYWltc1snZCddO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHsgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBoZWFkZXIsXHJcbiAgICAgICAgY2xhaW1zLFxyXG4gICAgICAgIGRhdGEsXHJcbiAgICAgICAgc2lnbmF0dXJlXHJcbiAgICB9O1xyXG59O1xyXG4vKipcclxuICogRGVjb2RlcyBhIEZpcmViYXNlIGF1dGguIHRva2VuIGFuZCBjaGVja3MgdGhlIHZhbGlkaXR5IG9mIGl0cyB0aW1lLWJhc2VkIGNsYWltcy4gV2lsbCByZXR1cm4gdHJ1ZSBpZiB0aGVcclxuICogdG9rZW4gaXMgd2l0aGluIHRoZSB0aW1lIHdpbmRvdyBhdXRob3JpemVkIGJ5IHRoZSAnbmJmJyAobm90LWJlZm9yZSkgYW5kICdpYXQnIChpc3N1ZWQtYXQpIGNsYWltcy5cclxuICpcclxuICogTm90ZXM6XHJcbiAqIC0gTWF5IHJldHVybiBhIGZhbHNlIG5lZ2F0aXZlIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxyXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxyXG4gKi9cclxuY29uc3QgaXNWYWxpZFRpbWVzdGFtcCA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgY29uc3QgY2xhaW1zID0gZGVjb2RlKHRva2VuKS5jbGFpbXM7XHJcbiAgICBjb25zdCBub3cgPSBNYXRoLmZsb29yKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XHJcbiAgICBsZXQgdmFsaWRTaW5jZSA9IDAsIHZhbGlkVW50aWwgPSAwO1xyXG4gICAgaWYgKHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgaWYgKGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnbmJmJykpIHtcclxuICAgICAgICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snbmJmJ107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnaWF0JykpIHtcclxuICAgICAgICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snaWF0J107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2V4cCcpKSB7XHJcbiAgICAgICAgICAgIHZhbGlkVW50aWwgPSBjbGFpbXNbJ2V4cCddO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gdG9rZW4gd2lsbCBleHBpcmUgYWZ0ZXIgMjRoIGJ5IGRlZmF1bHRcclxuICAgICAgICAgICAgdmFsaWRVbnRpbCA9IHZhbGlkU2luY2UgKyA4NjQwMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCEhbm93ICYmXHJcbiAgICAgICAgISF2YWxpZFNpbmNlICYmXHJcbiAgICAgICAgISF2YWxpZFVudGlsICYmXHJcbiAgICAgICAgbm93ID49IHZhbGlkU2luY2UgJiZcclxuICAgICAgICBub3cgPD0gdmFsaWRVbnRpbCk7XHJcbn07XHJcbi8qKlxyXG4gKiBEZWNvZGVzIGEgRmlyZWJhc2UgYXV0aC4gdG9rZW4gYW5kIHJldHVybnMgaXRzIGlzc3VlZCBhdCB0aW1lIGlmIHZhbGlkLCBudWxsIG90aGVyd2lzZS5cclxuICpcclxuICogTm90ZXM6XHJcbiAqIC0gTWF5IHJldHVybiBudWxsIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxyXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxyXG4gKi9cclxuY29uc3QgaXNzdWVkQXRUaW1lID0gZnVuY3Rpb24gKHRva2VuKSB7XHJcbiAgICBjb25zdCBjbGFpbXMgPSBkZWNvZGUodG9rZW4pLmNsYWltcztcclxuICAgIGlmICh0eXBlb2YgY2xhaW1zID09PSAnb2JqZWN0JyAmJiBjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2lhdCcpKSB7XHJcbiAgICAgICAgcmV0dXJuIGNsYWltc1snaWF0J107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcclxuLyoqXHJcbiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgY2hlY2tzIHRoZSB2YWxpZGl0eSBvZiBpdHMgZm9ybWF0LiBFeHBlY3RzIGEgdmFsaWQgaXNzdWVkLWF0IHRpbWUuXHJcbiAqXHJcbiAqIE5vdGVzOlxyXG4gKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC5cclxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cclxuICovXHJcbmNvbnN0IGlzVmFsaWRGb3JtYXQgPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGUodG9rZW4pLCBjbGFpbXMgPSBkZWNvZGVkLmNsYWltcztcclxuICAgIHJldHVybiAhIWNsYWltcyAmJiB0eXBlb2YgY2xhaW1zID09PSAnb2JqZWN0JyAmJiBjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2lhdCcpO1xyXG59O1xyXG4vKipcclxuICogQXR0ZW1wdHMgdG8gcGVlciBpbnRvIGFuIGF1dGggdG9rZW4gYW5kIGRldGVybWluZSBpZiBpdCdzIGFuIGFkbWluIGF1dGggdG9rZW4gYnkgbG9va2luZyBhdCB0aGUgY2xhaW1zIHBvcnRpb24uXHJcbiAqXHJcbiAqIE5vdGVzOlxyXG4gKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC5cclxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cclxuICovXHJcbmNvbnN0IGlzQWRtaW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgIGNvbnN0IGNsYWltcyA9IGRlY29kZSh0b2tlbikuY2xhaW1zO1xyXG4gICAgcmV0dXJuIHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnICYmIGNsYWltc1snYWRtaW4nXSA9PT0gdHJ1ZTtcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gY29udGFpbnMob2JqLCBrZXkpIHtcclxuICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpO1xyXG59XHJcbmZ1bmN0aW9uIHNhZmVHZXQob2JqLCBrZXkpIHtcclxuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ialtrZXldO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBpc0VtcHR5KG9iaikge1xyXG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XHJcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIG1hcChvYmosIGZuLCBjb250ZXh0T2JqKSB7XHJcbiAgICBjb25zdCByZXMgPSB7fTtcclxuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xyXG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7XHJcbiAgICAgICAgICAgIHJlc1trZXldID0gZm4uY2FsbChjb250ZXh0T2JqLCBvYmpba2V5XSwga2V5LCBvYmopO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuLyoqXHJcbiAqIERlZXAgZXF1YWwgdHdvIG9iamVjdHMuIFN1cHBvcnQgQXJyYXlzIGFuZCBPYmplY3RzLlxyXG4gKi9cclxuZnVuY3Rpb24gZGVlcEVxdWFsKGEsIGIpIHtcclxuICAgIGlmIChhID09PSBiKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhS2V5cyA9IE9iamVjdC5rZXlzKGEpO1xyXG4gICAgY29uc3QgYktleXMgPSBPYmplY3Qua2V5cyhiKTtcclxuICAgIGZvciAoY29uc3QgayBvZiBhS2V5cykge1xyXG4gICAgICAgIGlmICghYktleXMuaW5jbHVkZXMoaykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBhUHJvcCA9IGFba107XHJcbiAgICAgICAgY29uc3QgYlByb3AgPSBiW2tdO1xyXG4gICAgICAgIGlmIChpc09iamVjdChhUHJvcCkgJiYgaXNPYmplY3QoYlByb3ApKSB7XHJcbiAgICAgICAgICAgIGlmICghZGVlcEVxdWFsKGFQcm9wLCBiUHJvcCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChhUHJvcCAhPT0gYlByb3ApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgayBvZiBiS2V5cykge1xyXG4gICAgICAgIGlmICghYUtleXMuaW5jbHVkZXMoaykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIGlzT2JqZWN0KHRoaW5nKSB7XHJcbiAgICByZXR1cm4gdGhpbmcgIT09IG51bGwgJiYgdHlwZW9mIHRoaW5nID09PSAnb2JqZWN0JztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUmVqZWN0cyBpZiB0aGUgZ2l2ZW4gcHJvbWlzZSBkb2Vzbid0IHJlc29sdmUgaW4gdGltZUluTVMgbWlsbGlzZWNvbmRzLlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIHByb21pc2VXaXRoVGltZW91dChwcm9taXNlLCB0aW1lSW5NUyA9IDIwMDApIHtcclxuICAgIGNvbnN0IGRlZmVycmVkUHJvbWlzZSA9IG5ldyBEZWZlcnJlZCgpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiBkZWZlcnJlZFByb21pc2UucmVqZWN0KCd0aW1lb3V0IScpLCB0aW1lSW5NUyk7XHJcbiAgICBwcm9taXNlLnRoZW4oZGVmZXJyZWRQcm9taXNlLnJlc29sdmUsIGRlZmVycmVkUHJvbWlzZS5yZWplY3QpO1xyXG4gICAgcmV0dXJuIGRlZmVycmVkUHJvbWlzZS5wcm9taXNlO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcXVlcnlzdHJpbmctZm9ybWF0dGVkIHN0cmluZyAoZS5nLiAmYXJnPXZhbCZhcmcyPXZhbDIpIGZyb20gYVxyXG4gKiBwYXJhbXMgb2JqZWN0IChlLmcuIHthcmc6ICd2YWwnLCBhcmcyOiAndmFsMid9KVxyXG4gKiBOb3RlOiBZb3UgbXVzdCBwcmVwZW5kIGl0IHdpdGggPyB3aGVuIGFkZGluZyBpdCB0byBhIFVSTC5cclxuICovXHJcbmZ1bmN0aW9uIHF1ZXJ5c3RyaW5nKHF1ZXJ5c3RyaW5nUGFyYW1zKSB7XHJcbiAgICBjb25zdCBwYXJhbXMgPSBbXTtcclxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHF1ZXJ5c3RyaW5nUGFyYW1zKSkge1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICB2YWx1ZS5mb3JFYWNoKGFycmF5VmFsID0+IHtcclxuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFycmF5VmFsKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcGFyYW1zLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGFyYW1zLmxlbmd0aCA/ICcmJyArIHBhcmFtcy5qb2luKCcmJykgOiAnJztcclxufVxyXG4vKipcclxuICogRGVjb2RlcyBhIHF1ZXJ5c3RyaW5nIChlLmcuID9hcmc9dmFsJmFyZzI9dmFsMikgaW50byBhIHBhcmFtcyBvYmplY3RcclxuICogKGUuZy4ge2FyZzogJ3ZhbCcsIGFyZzI6ICd2YWwyJ30pXHJcbiAqL1xyXG5mdW5jdGlvbiBxdWVyeXN0cmluZ0RlY29kZShxdWVyeXN0cmluZykge1xyXG4gICAgY29uc3Qgb2JqID0ge307XHJcbiAgICBjb25zdCB0b2tlbnMgPSBxdWVyeXN0cmluZy5yZXBsYWNlKC9eXFw/LywgJycpLnNwbGl0KCcmJyk7XHJcbiAgICB0b2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7XHJcbiAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IHRva2VuLnNwbGl0KCc9Jyk7XHJcbiAgICAgICAgICAgIG9ialtkZWNvZGVVUklDb21wb25lbnQoa2V5KV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG9iajtcclxufVxyXG4vKipcclxuICogRXh0cmFjdCB0aGUgcXVlcnkgc3RyaW5nIHBhcnQgb2YgYSBVUkwsIGluY2x1ZGluZyB0aGUgbGVhZGluZyBxdWVzdGlvbiBtYXJrIChpZiBwcmVzZW50KS5cclxuICovXHJcbmZ1bmN0aW9uIGV4dHJhY3RRdWVyeXN0cmluZyh1cmwpIHtcclxuICAgIGNvbnN0IHF1ZXJ5U3RhcnQgPSB1cmwuaW5kZXhPZignPycpO1xyXG4gICAgaWYgKCFxdWVyeVN0YXJ0KSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZnJhZ21lbnRTdGFydCA9IHVybC5pbmRleE9mKCcjJywgcXVlcnlTdGFydCk7XHJcbiAgICByZXR1cm4gdXJsLnN1YnN0cmluZyhxdWVyeVN0YXJ0LCBmcmFnbWVudFN0YXJ0ID4gMCA/IGZyYWdtZW50U3RhcnQgOiB1bmRlZmluZWQpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBAZmlsZW92ZXJ2aWV3IFNIQS0xIGNyeXB0b2dyYXBoaWMgaGFzaC5cclxuICogVmFyaWFibGUgbmFtZXMgZm9sbG93IHRoZSBub3RhdGlvbiBpbiBGSVBTIFBVQiAxODAtMzpcclxuICogaHR0cDovL2NzcmMubmlzdC5nb3YvcHVibGljYXRpb25zL2ZpcHMvZmlwczE4MC0zL2ZpcHMxODAtM19maW5hbC5wZGYuXHJcbiAqXHJcbiAqIFVzYWdlOlxyXG4gKiAgIHZhciBzaGExID0gbmV3IHNoYTEoKTtcclxuICogICBzaGExLnVwZGF0ZShieXRlcyk7XHJcbiAqICAgdmFyIGhhc2ggPSBzaGExLmRpZ2VzdCgpO1xyXG4gKlxyXG4gKiBQZXJmb3JtYW5jZTpcclxuICogICBDaHJvbWUgMjM6ICAgfjQwMCBNYml0L3NcclxuICogICBGaXJlZm94IDE2OiAgfjI1MCBNYml0L3NcclxuICpcclxuICovXHJcbi8qKlxyXG4gKiBTSEEtMSBjcnlwdG9ncmFwaGljIGhhc2ggY29uc3RydWN0b3IuXHJcbiAqXHJcbiAqIFRoZSBwcm9wZXJ0aWVzIGRlY2xhcmVkIGhlcmUgYXJlIGRpc2N1c3NlZCBpbiB0aGUgYWJvdmUgYWxnb3JpdGhtIGRvY3VtZW50LlxyXG4gKiBAY29uc3RydWN0b3JcclxuICogQGZpbmFsXHJcbiAqIEBzdHJ1Y3RcclxuICovXHJcbmNsYXNzIFNoYTEge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSG9sZHMgdGhlIHByZXZpb3VzIHZhbHVlcyBvZiBhY2N1bXVsYXRlZCB2YXJpYWJsZXMgYS1lIGluIHRoZSBjb21wcmVzc19cclxuICAgICAgICAgKiBmdW5jdGlvbi5cclxuICAgICAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuY2hhaW5fID0gW107XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQSBidWZmZXIgaG9sZGluZyB0aGUgcGFydGlhbGx5IGNvbXB1dGVkIGhhc2ggcmVzdWx0LlxyXG4gICAgICAgICAqIEBwcml2YXRlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5idWZfID0gW107XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQW4gYXJyYXkgb2YgODAgYnl0ZXMsIGVhY2ggYSBwYXJ0IG9mIHRoZSBtZXNzYWdlIHRvIGJlIGhhc2hlZC4gIFJlZmVycmVkIHRvXHJcbiAgICAgICAgICogYXMgdGhlIG1lc3NhZ2Ugc2NoZWR1bGUgaW4gdGhlIGRvY3MuXHJcbiAgICAgICAgICogQHByaXZhdGVcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLldfID0gW107XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ29udGFpbnMgZGF0YSBuZWVkZWQgdG8gcGFkIG1lc3NhZ2VzIGxlc3MgdGhhbiA2NCBieXRlcy5cclxuICAgICAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMucGFkXyA9IFtdO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcml2YXRlIHtudW1iZXJ9XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcml2YXRlIHtudW1iZXJ9XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy50b3RhbF8gPSAwO1xyXG4gICAgICAgIHRoaXMuYmxvY2tTaXplID0gNTEyIC8gODtcclxuICAgICAgICB0aGlzLnBhZF9bMF0gPSAxMjg7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLmJsb2NrU2l6ZTsgKytpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFkX1tpXSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgIH1cclxuICAgIHJlc2V0KCkge1xyXG4gICAgICAgIHRoaXMuY2hhaW5fWzBdID0gMHg2NzQ1MjMwMTtcclxuICAgICAgICB0aGlzLmNoYWluX1sxXSA9IDB4ZWZjZGFiODk7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMl0gPSAweDk4YmFkY2ZlO1xyXG4gICAgICAgIHRoaXMuY2hhaW5fWzNdID0gMHgxMDMyNTQ3NjtcclxuICAgICAgICB0aGlzLmNoYWluX1s0XSA9IDB4YzNkMmUxZjA7XHJcbiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwO1xyXG4gICAgICAgIHRoaXMudG90YWxfID0gMDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSW50ZXJuYWwgY29tcHJlc3MgaGVscGVyIGZ1bmN0aW9uLlxyXG4gICAgICogQHBhcmFtIGJ1ZiBCbG9jayB0byBjb21wcmVzcy5cclxuICAgICAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IG9mIHRoZSBibG9jayBpbiB0aGUgYnVmZmVyLlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqL1xyXG4gICAgY29tcHJlc3NfKGJ1Ziwgb2Zmc2V0KSB7XHJcbiAgICAgICAgaWYgKCFvZmZzZXQpIHtcclxuICAgICAgICAgICAgb2Zmc2V0ID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgVyA9IHRoaXMuV187XHJcbiAgICAgICAgLy8gZ2V0IDE2IGJpZyBlbmRpYW4gd29yZHNcclxuICAgICAgICBpZiAodHlwZW9mIGJ1ZiA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPKHVzZXIpOiBbYnVnIDgxNDAxMjJdIFJlY2VudCB2ZXJzaW9ucyBvZiBTYWZhcmkgZm9yIE1hYyBPUyBhbmQgaU9TXHJcbiAgICAgICAgICAgICAgICAvLyBoYXZlIGEgYnVnIHRoYXQgdHVybnMgdGhlIHBvc3QtaW5jcmVtZW50ICsrIG9wZXJhdG9yIGludG8gcHJlLWluY3JlbWVudFxyXG4gICAgICAgICAgICAgICAgLy8gZHVyaW5nIEpJVCBjb21waWxhdGlvbi4gIFdlIGhhdmUgY29kZSB0aGF0IGRlcGVuZHMgaGVhdmlseSBvbiBTSEEtMSBmb3JcclxuICAgICAgICAgICAgICAgIC8vIGNvcnJlY3RuZXNzIGFuZCB3aGljaCBpcyBhZmZlY3RlZCBieSB0aGlzIGJ1Zywgc28gSSd2ZSByZW1vdmVkIGFsbCB1c2VzXHJcbiAgICAgICAgICAgICAgICAvLyBvZiBwb3N0LWluY3JlbWVudCArKyBpbiB3aGljaCB0aGUgcmVzdWx0IHZhbHVlIGlzIHVzZWQuICBXZSBjYW4gcmV2ZXJ0XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGNoYW5nZSBvbmNlIHRoZSBTYWZhcmkgYnVnXHJcbiAgICAgICAgICAgICAgICAvLyAoaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEwOTAzNikgaGFzIGJlZW4gZml4ZWQgYW5kXHJcbiAgICAgICAgICAgICAgICAvLyBtb3N0IGNsaWVudHMgaGF2ZSBiZWVuIHVwZGF0ZWQuXHJcbiAgICAgICAgICAgICAgICBXW2ldID1cclxuICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0KSA8PCAyNCkgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgPDwgMTYpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGJ1Zi5jaGFyQ29kZUF0KG9mZnNldCArIDIpIDw8IDgpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMyk7XHJcbiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gNDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBXW2ldID1cclxuICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldF0gPDwgMjQpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGJ1ZltvZmZzZXQgKyAxXSA8PCAxNikgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldCArIDJdIDw8IDgpIHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnVmW29mZnNldCArIDNdO1xyXG4gICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZXhwYW5kIHRvIDgwIHdvcmRzXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE2OyBpIDwgODA7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCB0ID0gV1tpIC0gM10gXiBXW2kgLSA4XSBeIFdbaSAtIDE0XSBeIFdbaSAtIDE2XTtcclxuICAgICAgICAgICAgV1tpXSA9ICgodCA8PCAxKSB8ICh0ID4+PiAzMSkpICYgMHhmZmZmZmZmZjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGEgPSB0aGlzLmNoYWluX1swXTtcclxuICAgICAgICBsZXQgYiA9IHRoaXMuY2hhaW5fWzFdO1xyXG4gICAgICAgIGxldCBjID0gdGhpcy5jaGFpbl9bMl07XHJcbiAgICAgICAgbGV0IGQgPSB0aGlzLmNoYWluX1szXTtcclxuICAgICAgICBsZXQgZSA9IHRoaXMuY2hhaW5fWzRdO1xyXG4gICAgICAgIGxldCBmLCBrO1xyXG4gICAgICAgIC8vIFRPRE8odXNlcik6IFRyeSB0byB1bnJvbGwgdGhpcyBsb29wIHRvIHNwZWVkIHVwIHRoZSBjb21wdXRhdGlvbi5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDgwOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGkgPCA0MCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGkgPCAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGYgPSBkIF4gKGIgJiAoYyBeIGQpKTtcclxuICAgICAgICAgICAgICAgICAgICBrID0gMHg1YTgyNzk5OTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGYgPSBiIF4gYyBeIGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgayA9IDB4NmVkOWViYTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA8IDYwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZiA9IChiICYgYykgfCAoZCAmIChiIHwgYykpO1xyXG4gICAgICAgICAgICAgICAgICAgIGsgPSAweDhmMWJiY2RjO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDtcclxuICAgICAgICAgICAgICAgICAgICBrID0gMHhjYTYyYzFkNjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0ID0gKCgoYSA8PCA1KSB8IChhID4+PiAyNykpICsgZiArIGUgKyBrICsgV1tpXSkgJiAweGZmZmZmZmZmO1xyXG4gICAgICAgICAgICBlID0gZDtcclxuICAgICAgICAgICAgZCA9IGM7XHJcbiAgICAgICAgICAgIGMgPSAoKGIgPDwgMzApIHwgKGIgPj4+IDIpKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgICAgIGIgPSBhO1xyXG4gICAgICAgICAgICBhID0gdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMF0gPSAodGhpcy5jaGFpbl9bMF0gKyBhKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMV0gPSAodGhpcy5jaGFpbl9bMV0gKyBiKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMl0gPSAodGhpcy5jaGFpbl9bMl0gKyBjKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bM10gPSAodGhpcy5jaGFpbl9bM10gKyBkKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bNF0gPSAodGhpcy5jaGFpbl9bNF0gKyBlKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICB9XHJcbiAgICB1cGRhdGUoYnl0ZXMsIGxlbmd0aCkge1xyXG4gICAgICAgIC8vIFRPRE8oam9obmxlbnopOiB0aWdodGVuIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kIHJlbW92ZSB0aGlzIGNoZWNrXHJcbiAgICAgICAgaWYgKGJ5dGVzID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbGVuZ3RoID0gYnl0ZXMubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBsZW5ndGhNaW51c0Jsb2NrID0gbGVuZ3RoIC0gdGhpcy5ibG9ja1NpemU7XHJcbiAgICAgICAgbGV0IG4gPSAwO1xyXG4gICAgICAgIC8vIFVzaW5nIGxvY2FsIGluc3RlYWQgb2YgbWVtYmVyIHZhcmlhYmxlcyBnaXZlcyB+NSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2LlxyXG4gICAgICAgIGNvbnN0IGJ1ZiA9IHRoaXMuYnVmXztcclxuICAgICAgICBsZXQgaW5idWYgPSB0aGlzLmluYnVmXztcclxuICAgICAgICAvLyBUaGUgb3V0ZXIgd2hpbGUgbG9vcCBzaG91bGQgZXhlY3V0ZSBhdCBtb3N0IHR3aWNlLlxyXG4gICAgICAgIHdoaWxlIChuIDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgaGF2ZSBubyBkYXRhIGluIHRoZSBibG9jayB0byB0b3AgdXAsIHdlIGNhbiBkaXJlY3RseSBwcm9jZXNzIHRoZVxyXG4gICAgICAgICAgICAvLyBpbnB1dCBidWZmZXIgKGFzc3VtaW5nIGl0IGNvbnRhaW5zIHN1ZmZpY2llbnQgZGF0YSkuIFRoaXMgZ2l2ZXMgfjI1JVxyXG4gICAgICAgICAgICAvLyBzcGVlZHVwIG9uIENocm9tZSAyMyBhbmQgfjE1JSBzcGVlZHVwIG9uIEZpcmVmb3ggMTYsIGJ1dCByZXF1aXJlcyB0aGF0XHJcbiAgICAgICAgICAgIC8vIHRoZSBkYXRhIGlzIHByb3ZpZGVkIGluIGxhcmdlIGNodW5rcyAob3IgaW4gbXVsdGlwbGVzIG9mIDY0IGJ5dGVzKS5cclxuICAgICAgICAgICAgaWYgKGluYnVmID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAobiA8PSBsZW5ndGhNaW51c0Jsb2NrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wcmVzc18oYnl0ZXMsIG4pO1xyXG4gICAgICAgICAgICAgICAgICAgIG4gKz0gdGhpcy5ibG9ja1NpemU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBieXRlcyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChuIDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmW2luYnVmXSA9IGJ5dGVzLmNoYXJDb2RlQXQobik7XHJcbiAgICAgICAgICAgICAgICAgICAgKytpbmJ1ZjtcclxuICAgICAgICAgICAgICAgICAgICArK247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluYnVmID09PSB0aGlzLmJsb2NrU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmJ1ZiA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1bXAgdG8gdGhlIG91dGVyIGxvb3Agc28gd2UgdXNlIHRoZSBmdWxsLWJsb2NrIG9wdGltaXphdGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKG4gPCBsZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXNbbl07XHJcbiAgICAgICAgICAgICAgICAgICAgKytpbmJ1ZjtcclxuICAgICAgICAgICAgICAgICAgICArK247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluYnVmID09PSB0aGlzLmJsb2NrU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmJ1ZiA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1bXAgdG8gdGhlIG91dGVyIGxvb3Agc28gd2UgdXNlIHRoZSBmdWxsLWJsb2NrIG9wdGltaXphdGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5idWZfID0gaW5idWY7XHJcbiAgICAgICAgdGhpcy50b3RhbF8gKz0gbGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgLyoqIEBvdmVycmlkZSAqL1xyXG4gICAgZGlnZXN0KCkge1xyXG4gICAgICAgIGNvbnN0IGRpZ2VzdCA9IFtdO1xyXG4gICAgICAgIGxldCB0b3RhbEJpdHMgPSB0aGlzLnRvdGFsXyAqIDg7XHJcbiAgICAgICAgLy8gQWRkIHBhZCAweDgwIDB4MDAqLlxyXG4gICAgICAgIGlmICh0aGlzLmluYnVmXyA8IDU2KSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgNTYgLSB0aGlzLmluYnVmXyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLnBhZF8sIHRoaXMuYmxvY2tTaXplIC0gKHRoaXMuaW5idWZfIC0gNTYpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQWRkICMgYml0cy5cclxuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5ibG9ja1NpemUgLSAxOyBpID49IDU2OyBpLS0pIHtcclxuICAgICAgICAgICAgdGhpcy5idWZfW2ldID0gdG90YWxCaXRzICYgMjU1O1xyXG4gICAgICAgICAgICB0b3RhbEJpdHMgLz0gMjU2OyAvLyBEb24ndCB1c2UgYml0LXNoaWZ0aW5nIGhlcmUhXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29tcHJlc3NfKHRoaXMuYnVmXyk7XHJcbiAgICAgICAgbGV0IG4gPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAyNDsgaiA+PSAwOyBqIC09IDgpIHtcclxuICAgICAgICAgICAgICAgIGRpZ2VzdFtuXSA9ICh0aGlzLmNoYWluX1tpXSA+PiBqKSAmIDI1NTtcclxuICAgICAgICAgICAgICAgICsrbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGlnZXN0O1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBIZWxwZXIgdG8gbWFrZSBhIFN1YnNjcmliZSBmdW5jdGlvbiAoanVzdCBsaWtlIFByb21pc2UgaGVscHMgbWFrZSBhXHJcbiAqIFRoZW5hYmxlKS5cclxuICpcclxuICogQHBhcmFtIGV4ZWN1dG9yIEZ1bmN0aW9uIHdoaWNoIGNhbiBtYWtlIGNhbGxzIHRvIGEgc2luZ2xlIE9ic2VydmVyXHJcbiAqICAgICBhcyBhIHByb3h5LlxyXG4gKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVTdWJzY3JpYmUoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpIHtcclxuICAgIGNvbnN0IHByb3h5ID0gbmV3IE9ic2VydmVyUHJveHkoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpO1xyXG4gICAgcmV0dXJuIHByb3h5LnN1YnNjcmliZS5iaW5kKHByb3h5KTtcclxufVxyXG4vKipcclxuICogSW1wbGVtZW50IGZhbi1vdXQgZm9yIGFueSBudW1iZXIgb2YgT2JzZXJ2ZXJzIGF0dGFjaGVkIHZpYSBhIHN1YnNjcmliZVxyXG4gKiBmdW5jdGlvbi5cclxuICovXHJcbmNsYXNzIE9ic2VydmVyUHJveHkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gZXhlY3V0b3IgRnVuY3Rpb24gd2hpY2ggY2FuIG1ha2UgY2FsbHMgdG8gYSBzaW5nbGUgT2JzZXJ2ZXJcclxuICAgICAqICAgICBhcyBhIHByb3h5LlxyXG4gICAgICogQHBhcmFtIG9uTm9PYnNlcnZlcnMgQ2FsbGJhY2sgd2hlbiBjb3VudCBvZiBPYnNlcnZlcnMgZ29lcyB0byB6ZXJvLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihleGVjdXRvciwgb25Ob09ic2VydmVycykge1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XHJcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZXMgPSBbXTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyQ291bnQgPSAwO1xyXG4gICAgICAgIC8vIE1pY3JvLXRhc2sgc2NoZWR1bGluZyBieSBjYWxsaW5nIHRhc2sudGhlbigpLlxyXG4gICAgICAgIHRoaXMudGFzayA9IFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICAgIHRoaXMuZmluYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzID0gb25Ob09ic2VydmVycztcclxuICAgICAgICAvLyBDYWxsIHRoZSBleGVjdXRvciBhc3luY2hyb25vdXNseSBzbyBzdWJzY3JpYmVycyB0aGF0IGFyZSBjYWxsZWRcclxuICAgICAgICAvLyBzeW5jaHJvbm91c2x5IGFmdGVyIHRoZSBjcmVhdGlvbiBvZiB0aGUgc3Vic2NyaWJlIGZ1bmN0aW9uXHJcbiAgICAgICAgLy8gY2FuIHN0aWxsIHJlY2VpdmUgdGhlIHZlcnkgZmlyc3QgdmFsdWUgZ2VuZXJhdGVkIGluIHRoZSBleGVjdXRvci5cclxuICAgICAgICB0aGlzLnRhc2tcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBleGVjdXRvcih0aGlzKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3IoZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBuZXh0KHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQodmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICB0aGlzLmZvckVhY2hPYnNlcnZlcigob2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2xvc2UoZXJyb3IpO1xyXG4gICAgfVxyXG4gICAgY29tcGxldGUoKSB7XHJcbiAgICAgICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJzY3JpYmUgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBhZGQgYW4gT2JzZXJ2ZXIgdG8gdGhlIGZhbi1vdXQgbGlzdC5cclxuICAgICAqXHJcbiAgICAgKiAtIFdlIHJlcXVpcmUgdGhhdCBubyBldmVudCBpcyBzZW50IHRvIGEgc3Vic2NyaWJlciBzeW5jaHJvbm91c2x5IHRvIHRoZWlyXHJcbiAgICAgKiAgIGNhbGwgdG8gc3Vic2NyaWJlKCkuXHJcbiAgICAgKi9cclxuICAgIHN1YnNjcmliZShuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlKSB7XHJcbiAgICAgICAgbGV0IG9ic2VydmVyO1xyXG4gICAgICAgIGlmIChuZXh0T3JPYnNlcnZlciA9PT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgIGVycm9yID09PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgY29tcGxldGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgT2JzZXJ2ZXIuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEFzc2VtYmxlIGFuIE9ic2VydmVyIG9iamVjdCB3aGVuIHBhc3NlZCBhcyBjYWxsYmFjayBmdW5jdGlvbnMuXHJcbiAgICAgICAgaWYgKGltcGxlbWVudHNBbnlNZXRob2RzKG5leHRPck9ic2VydmVyLCBbXHJcbiAgICAgICAgICAgICduZXh0JyxcclxuICAgICAgICAgICAgJ2Vycm9yJyxcclxuICAgICAgICAgICAgJ2NvbXBsZXRlJ1xyXG4gICAgICAgIF0pKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyID0gbmV4dE9yT2JzZXJ2ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBvYnNlcnZlciA9IHtcclxuICAgICAgICAgICAgICAgIG5leHQ6IG5leHRPck9ic2VydmVyLFxyXG4gICAgICAgICAgICAgICAgZXJyb3IsXHJcbiAgICAgICAgICAgICAgICBjb21wbGV0ZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob2JzZXJ2ZXIubmV4dCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQgPSBub29wO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob2JzZXJ2ZXIuZXJyb3IgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvciA9IG5vb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvYnNlcnZlci5jb21wbGV0ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlID0gbm9vcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdW5zdWIgPSB0aGlzLnVuc3Vic2NyaWJlT25lLmJpbmQodGhpcywgdGhpcy5vYnNlcnZlcnMubGVuZ3RoKTtcclxuICAgICAgICAvLyBBdHRlbXB0IHRvIHN1YnNjcmliZSB0byBhIHRlcm1pbmF0ZWQgT2JzZXJ2YWJsZSAtIHdlXHJcbiAgICAgICAgLy8ganVzdCByZXNwb25kIHRvIHRoZSBPYnNlcnZlciB3aXRoIHRoZSBmaW5hbCBlcnJvciBvciBjb21wbGV0ZVxyXG4gICAgICAgIC8vIGV2ZW50LlxyXG4gICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCkge1xyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXHJcbiAgICAgICAgICAgIHRoaXMudGFzay50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmluYWxFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5lcnJvcih0aGlzLmZpbmFsRXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vdGhpbmdcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gob2JzZXJ2ZXIpO1xyXG4gICAgICAgIHJldHVybiB1bnN1YjtcclxuICAgIH1cclxuICAgIC8vIFVuc3Vic2NyaWJlIGlzIHN5bmNocm9ub3VzIC0gd2UgZ3VhcmFudGVlIHRoYXQgbm8gZXZlbnRzIGFyZSBzZW50IHRvXHJcbiAgICAvLyBhbnkgdW5zdWJzY3JpYmVkIE9ic2VydmVyLlxyXG4gICAgdW5zdWJzY3JpYmVPbmUoaSkge1xyXG4gICAgICAgIGlmICh0aGlzLm9ic2VydmVycyA9PT0gdW5kZWZpbmVkIHx8IHRoaXMub2JzZXJ2ZXJzW2ldID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZWxldGUgdGhpcy5vYnNlcnZlcnNbaV07XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlckNvdW50IC09IDE7XHJcbiAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJDb3VudCA9PT0gMCAmJiB0aGlzLm9uTm9PYnNlcnZlcnMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLm9uTm9PYnNlcnZlcnModGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yRWFjaE9ic2VydmVyKGZuKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkKSB7XHJcbiAgICAgICAgICAgIC8vIEFscmVhZHkgY2xvc2VkIGJ5IHByZXZpb3VzIGV2ZW50Li4uLmp1c3QgZWF0IHRoZSBhZGRpdGlvbmFsIHZhbHVlcy5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBTaW5jZSBzZW5kT25lIGNhbGxzIGFzeW5jaHJvbm91c2x5IC0gdGhlcmUgaXMgbm8gY2hhbmNlIHRoYXRcclxuICAgICAgICAvLyB0aGlzLm9ic2VydmVycyB3aWxsIGJlY29tZSB1bmRlZmluZWQuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm9ic2VydmVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLnNlbmRPbmUoaSwgZm4pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIENhbGwgdGhlIE9ic2VydmVyIHZpYSBvbmUgb2YgaXQncyBjYWxsYmFjayBmdW5jdGlvbi4gV2UgYXJlIGNhcmVmdWwgdG9cclxuICAgIC8vIGNvbmZpcm0gdGhhdCB0aGUgb2JzZXJ2ZSBoYXMgbm90IGJlZW4gdW5zdWJzY3JpYmVkIHNpbmNlIHRoaXMgYXN5bmNocm9ub3VzXHJcbiAgICAvLyBmdW5jdGlvbiBoYWQgYmVlbiBxdWV1ZWQuXHJcbiAgICBzZW5kT25lKGksIGZuKSB7XHJcbiAgICAgICAgLy8gRXhlY3V0ZSB0aGUgY2FsbGJhY2sgYXN5bmNocm9ub3VzbHlcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXHJcbiAgICAgICAgdGhpcy50YXNrLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5vYnNlcnZlcnMgIT09IHVuZGVmaW5lZCAmJiB0aGlzLm9ic2VydmVyc1tpXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZuKHRoaXMub2JzZXJ2ZXJzW2ldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGV4Y2VwdGlvbnMgcmFpc2VkIGluIE9ic2VydmVycyBvciBtaXNzaW5nIG1ldGhvZHMgb2YgYW5cclxuICAgICAgICAgICAgICAgICAgICAvLyBPYnNlcnZlci5cclxuICAgICAgICAgICAgICAgICAgICAvLyBMb2cgZXJyb3IgdG8gY29uc29sZS4gYi8zMTQwNDgwNlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY2xvc2UoZXJyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5maW5hbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmIChlcnIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpbmFsRXJyb3IgPSBlcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFByb3h5IGlzIG5vIGxvbmdlciBuZWVkZWQgLSBnYXJiYWdlIGNvbGxlY3QgcmVmZXJlbmNlc1xyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcclxuICAgICAgICB0aGlzLnRhc2sudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB0aGlzLm9uTm9PYnNlcnZlcnMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuLyoqIFR1cm4gc3luY2hyb25vdXMgZnVuY3Rpb24gaW50byBvbmUgY2FsbGVkIGFzeW5jaHJvbm91c2x5LiAqL1xyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xyXG5mdW5jdGlvbiBhc3luYyhmbiwgb25FcnJvcikge1xyXG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XHJcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHRydWUpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgZm4oLi4uYXJncyk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICBpZiAob25FcnJvcikge1xyXG4gICAgICAgICAgICAgICAgb25FcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybiB0cnVlIGlmIHRoZSBvYmplY3QgcGFzc2VkIGluIGltcGxlbWVudHMgYW55IG9mIHRoZSBuYW1lZCBtZXRob2RzLlxyXG4gKi9cclxuZnVuY3Rpb24gaW1wbGVtZW50c0FueU1ldGhvZHMob2JqLCBtZXRob2RzKSB7XHJcbiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgZm9yIChjb25zdCBtZXRob2Qgb2YgbWV0aG9kcykge1xyXG4gICAgICAgIGlmIChtZXRob2QgaW4gb2JqICYmIHR5cGVvZiBvYmpbbWV0aG9kXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuZnVuY3Rpb24gbm9vcCgpIHtcclxuICAgIC8vIGRvIG5vdGhpbmdcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQ2hlY2sgdG8gbWFrZSBzdXJlIHRoZSBhcHByb3ByaWF0ZSBudW1iZXIgb2YgYXJndW1lbnRzIGFyZSBwcm92aWRlZCBmb3IgYSBwdWJsaWMgZnVuY3Rpb24uXHJcbiAqIFRocm93cyBhbiBlcnJvciBpZiBpdCBmYWlscy5cclxuICpcclxuICogQHBhcmFtIGZuTmFtZSBUaGUgZnVuY3Rpb24gbmFtZVxyXG4gKiBAcGFyYW0gbWluQ291bnQgVGhlIG1pbmltdW0gbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBhbGxvdyBmb3IgdGhlIGZ1bmN0aW9uIGNhbGxcclxuICogQHBhcmFtIG1heENvdW50IFRoZSBtYXhpbXVtIG51bWJlciBvZiBhcmd1bWVudCB0byBhbGxvdyBmb3IgdGhlIGZ1bmN0aW9uIGNhbGxcclxuICogQHBhcmFtIGFyZ0NvdW50IFRoZSBhY3R1YWwgbnVtYmVyIG9mIGFyZ3VtZW50cyBwcm92aWRlZC5cclxuICovXHJcbmNvbnN0IHZhbGlkYXRlQXJnQ291bnQgPSBmdW5jdGlvbiAoZm5OYW1lLCBtaW5Db3VudCwgbWF4Q291bnQsIGFyZ0NvdW50KSB7XHJcbiAgICBsZXQgYXJnRXJyb3I7XHJcbiAgICBpZiAoYXJnQ291bnQgPCBtaW5Db3VudCkge1xyXG4gICAgICAgIGFyZ0Vycm9yID0gJ2F0IGxlYXN0ICcgKyBtaW5Db3VudDtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGFyZ0NvdW50ID4gbWF4Q291bnQpIHtcclxuICAgICAgICBhcmdFcnJvciA9IG1heENvdW50ID09PSAwID8gJ25vbmUnIDogJ25vIG1vcmUgdGhhbiAnICsgbWF4Q291bnQ7XHJcbiAgICB9XHJcbiAgICBpZiAoYXJnRXJyb3IpIHtcclxuICAgICAgICBjb25zdCBlcnJvciA9IGZuTmFtZSArXHJcbiAgICAgICAgICAgICcgZmFpbGVkOiBXYXMgY2FsbGVkIHdpdGggJyArXHJcbiAgICAgICAgICAgIGFyZ0NvdW50ICtcclxuICAgICAgICAgICAgKGFyZ0NvdW50ID09PSAxID8gJyBhcmd1bWVudC4nIDogJyBhcmd1bWVudHMuJykgK1xyXG4gICAgICAgICAgICAnIEV4cGVjdHMgJyArXHJcbiAgICAgICAgICAgIGFyZ0Vycm9yICtcclxuICAgICAgICAgICAgJy4nO1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvcik7XHJcbiAgICB9XHJcbn07XHJcbi8qKlxyXG4gKiBHZW5lcmF0ZXMgYSBzdHJpbmcgdG8gcHJlZml4IGFuIGVycm9yIG1lc3NhZ2UgYWJvdXQgZmFpbGVkIGFyZ3VtZW50IHZhbGlkYXRpb25cclxuICpcclxuICogQHBhcmFtIGZuTmFtZSBUaGUgZnVuY3Rpb24gbmFtZVxyXG4gKiBAcGFyYW0gYXJnTmFtZSBUaGUgbmFtZSBvZiB0aGUgYXJndW1lbnRcclxuICogQHJldHVybiBUaGUgcHJlZml4IHRvIGFkZCB0byB0aGUgZXJyb3IgdGhyb3duIGZvciB2YWxpZGF0aW9uLlxyXG4gKi9cclxuZnVuY3Rpb24gZXJyb3JQcmVmaXgoZm5OYW1lLCBhcmdOYW1lKSB7XHJcbiAgICByZXR1cm4gYCR7Zm5OYW1lfSBmYWlsZWQ6ICR7YXJnTmFtZX0gYXJndW1lbnQgYDtcclxufVxyXG4vKipcclxuICogQHBhcmFtIGZuTmFtZVxyXG4gKiBAcGFyYW0gYXJndW1lbnROdW1iZXJcclxuICogQHBhcmFtIG5hbWVzcGFjZVxyXG4gKiBAcGFyYW0gb3B0aW9uYWxcclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlTmFtZXNwYWNlKGZuTmFtZSwgbmFtZXNwYWNlLCBvcHRpb25hbCkge1xyXG4gICAgaWYgKG9wdGlvbmFsICYmICFuYW1lc3BhY2UpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG5hbWVzcGFjZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAvL1RPRE86IEkgc2hvdWxkIGRvIG1vcmUgdmFsaWRhdGlvbiBoZXJlLiBXZSBvbmx5IGFsbG93IGNlcnRhaW4gY2hhcnMgaW4gbmFtZXNwYWNlcy5cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCAnbmFtZXNwYWNlJykgKyAnbXVzdCBiZSBhIHZhbGlkIGZpcmViYXNlIG5hbWVzcGFjZS4nKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB2YWxpZGF0ZUNhbGxiYWNrKGZuTmFtZSwgYXJndW1lbnROYW1lLCBcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHlwZXNcclxuY2FsbGJhY2ssIG9wdGlvbmFsKSB7XHJcbiAgICBpZiAob3B0aW9uYWwgJiYgIWNhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsIGFyZ3VtZW50TmFtZSkgKyAnbXVzdCBiZSBhIHZhbGlkIGZ1bmN0aW9uLicpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHZhbGlkYXRlQ29udGV4dE9iamVjdChmbk5hbWUsIGFyZ3VtZW50TmFtZSwgY29udGV4dCwgb3B0aW9uYWwpIHtcclxuICAgIGlmIChvcHRpb25hbCAmJiAhY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgY29udGV4dCAhPT0gJ29iamVjdCcgfHwgY29udGV4dCA9PT0gbnVsbCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsIGFyZ3VtZW50TmFtZSkgKyAnbXVzdCBiZSBhIHZhbGlkIGNvbnRleHQgb2JqZWN0LicpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8vIENvZGUgb3JpZ2luYWxseSBjYW1lIGZyb20gZ29vZy5jcnlwdC5zdHJpbmdUb1V0ZjhCeXRlQXJyYXksIGJ1dCBmb3Igc29tZSByZWFzb24gdGhleVxyXG4vLyBhdXRvbWF0aWNhbGx5IHJlcGxhY2VkICdcXHJcXG4nIHdpdGggJ1xcbicsIGFuZCB0aGV5IGRpZG4ndCBoYW5kbGUgc3Vycm9nYXRlIHBhaXJzLFxyXG4vLyBzbyBpdCdzIGJlZW4gbW9kaWZpZWQuXHJcbi8vIE5vdGUgdGhhdCBub3QgYWxsIFVuaWNvZGUgY2hhcmFjdGVycyBhcHBlYXIgYXMgc2luZ2xlIGNoYXJhY3RlcnMgaW4gSmF2YVNjcmlwdCBzdHJpbmdzLlxyXG4vLyBmcm9tQ2hhckNvZGUgcmV0dXJucyB0aGUgVVRGLTE2IGVuY29kaW5nIG9mIGEgY2hhcmFjdGVyIC0gc28gc29tZSBVbmljb2RlIGNoYXJhY3RlcnNcclxuLy8gdXNlIDIgY2hhcmFjdGVycyBpbiBKYXZhU2NyaXB0LiAgQWxsIDQtYnl0ZSBVVEYtOCBjaGFyYWN0ZXJzIGJlZ2luIHdpdGggYSBmaXJzdFxyXG4vLyBjaGFyYWN0ZXIgaW4gdGhlIHJhbmdlIDB4RDgwMCAtIDB4REJGRiAodGhlIGZpcnN0IGNoYXJhY3RlciBvZiBhIHNvLWNhbGxlZCBzdXJyb2dhdGVcclxuLy8gcGFpcikuXHJcbi8vIFNlZSBodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNS4xLyNzZWMtMTUuMS4zXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyXHJcbiAqIEByZXR1cm4ge0FycmF5fVxyXG4gKi9cclxuY29uc3Qgc3RyaW5nVG9CeXRlQXJyYXkgPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICBjb25zdCBvdXQgPSBbXTtcclxuICAgIGxldCBwID0gMDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgbGV0IGMgPSBzdHIuY2hhckNvZGVBdChpKTtcclxuICAgICAgICAvLyBJcyB0aGlzIHRoZSBsZWFkIHN1cnJvZ2F0ZSBpbiBhIHN1cnJvZ2F0ZSBwYWlyP1xyXG4gICAgICAgIGlmIChjID49IDB4ZDgwMCAmJiBjIDw9IDB4ZGJmZikge1xyXG4gICAgICAgICAgICBjb25zdCBoaWdoID0gYyAtIDB4ZDgwMDsgLy8gdGhlIGhpZ2ggMTAgYml0cy5cclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICBhc3NlcnQoaSA8IHN0ci5sZW5ndGgsICdTdXJyb2dhdGUgcGFpciBtaXNzaW5nIHRyYWlsIHN1cnJvZ2F0ZS4nKTtcclxuICAgICAgICAgICAgY29uc3QgbG93ID0gc3RyLmNoYXJDb2RlQXQoaSkgLSAweGRjMDA7IC8vIHRoZSBsb3cgMTAgYml0cy5cclxuICAgICAgICAgICAgYyA9IDB4MTAwMDAgKyAoaGlnaCA8PCAxMCkgKyBsb3c7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjIDwgMTI4KSB7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gYztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYyA8IDIwNDgpIHtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiA2KSB8IDE5MjtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYyA8IDY1NTM2KSB7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gMTIpIHwgMjI0O1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gMTgpIHwgMjQwO1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiAxMikgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4O1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBvdXQ7XHJcbn07XHJcbi8qKlxyXG4gKiBDYWxjdWxhdGUgbGVuZ3RoIHdpdGhvdXQgYWN0dWFsbHkgY29udmVydGluZzsgdXNlZnVsIGZvciBkb2luZyBjaGVhcGVyIHZhbGlkYXRpb24uXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcclxuICogQHJldHVybiB7bnVtYmVyfVxyXG4gKi9cclxuY29uc3Qgc3RyaW5nTGVuZ3RoID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgbGV0IHAgPSAwO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb25zdCBjID0gc3RyLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgICAgaWYgKGMgPCAxMjgpIHtcclxuICAgICAgICAgICAgcCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjIDwgMjA0OCkge1xyXG4gICAgICAgICAgICBwICs9IDI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGMgPj0gMHhkODAwICYmIGMgPD0gMHhkYmZmKSB7XHJcbiAgICAgICAgICAgIC8vIExlYWQgc3Vycm9nYXRlIG9mIGEgc3Vycm9nYXRlIHBhaXIuICBUaGUgcGFpciB0b2dldGhlciB3aWxsIHRha2UgNCBieXRlcyB0byByZXByZXNlbnQuXHJcbiAgICAgICAgICAgIHAgKz0gNDtcclxuICAgICAgICAgICAgaSsrOyAvLyBza2lwIHRyYWlsIHN1cnJvZ2F0ZS5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHAgKz0gMztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcDtcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIENvcGllZCBmcm9tIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yMTE3NTIzXHJcbiAqIEdlbmVyYXRlcyBhIG5ldyB1dWlkLlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCB1dWlkdjQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBjID0+IHtcclxuICAgICAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAxNikgfCAwLCB2ID0gYyA9PT0gJ3gnID8gciA6IChyICYgMHgzKSB8IDB4ODtcclxuICAgICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XHJcbiAgICB9KTtcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFRoZSBhbW91bnQgb2YgbWlsbGlzZWNvbmRzIHRvIGV4cG9uZW50aWFsbHkgaW5jcmVhc2UuXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX0lOVEVSVkFMX01JTExJUyA9IDEwMDA7XHJcbi8qKlxyXG4gKiBUaGUgZmFjdG9yIHRvIGJhY2tvZmYgYnkuXHJcbiAqIFNob3VsZCBiZSBhIG51bWJlciBncmVhdGVyIHRoYW4gMS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfQkFDS09GRl9GQUNUT1IgPSAyO1xyXG4vKipcclxuICogVGhlIG1heGltdW0gbWlsbGlzZWNvbmRzIHRvIGluY3JlYXNlIHRvLlxyXG4gKlxyXG4gKiA8cD5WaXNpYmxlIGZvciB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBNQVhfVkFMVUVfTUlMTElTID0gNCAqIDYwICogNjAgKiAxMDAwOyAvLyBGb3VyIGhvdXJzLCBsaWtlIGlPUyBhbmQgQW5kcm9pZC5cclxuLyoqXHJcbiAqIFRoZSBwZXJjZW50YWdlIG9mIGJhY2tvZmYgdGltZSB0byByYW5kb21pemUgYnkuXHJcbiAqIFNlZVxyXG4gKiBodHRwOi8vZ28vc2FmZS1jbGllbnQtYmVoYXZpb3Ijc3RlcC0xLWRldGVybWluZS10aGUtYXBwcm9wcmlhdGUtcmV0cnktaW50ZXJ2YWwtdG8taGFuZGxlLXNwaWtlLXRyYWZmaWNcclxuICogZm9yIGNvbnRleHQuXHJcbiAqXHJcbiAqIDxwPlZpc2libGUgZm9yIHRlc3RpbmdcclxuICovXHJcbmNvbnN0IFJBTkRPTV9GQUNUT1IgPSAwLjU7XHJcbi8qKlxyXG4gKiBCYXNlZCBvbiB0aGUgYmFja29mZiBtZXRob2QgZnJvbVxyXG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Nsb3N1cmUtbGlicmFyeS9ibG9iL21hc3Rlci9jbG9zdXJlL2dvb2cvbWF0aC9leHBvbmVudGlhbGJhY2tvZmYuanMuXHJcbiAqIEV4dHJhY3RlZCBoZXJlIHNvIHdlIGRvbid0IG5lZWQgdG8gcGFzcyBtZXRhZGF0YSBhbmQgYSBzdGF0ZWZ1bCBFeHBvbmVudGlhbEJhY2tvZmYgb2JqZWN0IGFyb3VuZC5cclxuICovXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZUJhY2tvZmZNaWxsaXMoYmFja29mZkNvdW50LCBpbnRlcnZhbE1pbGxpcyA9IERFRkFVTFRfSU5URVJWQUxfTUlMTElTLCBiYWNrb2ZmRmFjdG9yID0gREVGQVVMVF9CQUNLT0ZGX0ZBQ1RPUikge1xyXG4gICAgLy8gQ2FsY3VsYXRlcyBhbiBleHBvbmVudGlhbGx5IGluY3JlYXNpbmcgdmFsdWUuXHJcbiAgICAvLyBEZXZpYXRpb246IGNhbGN1bGF0ZXMgdmFsdWUgZnJvbSBjb3VudCBhbmQgYSBjb25zdGFudCBpbnRlcnZhbCwgc28gd2Ugb25seSBuZWVkIHRvIHNhdmUgdmFsdWVcclxuICAgIC8vIGFuZCBjb3VudCB0byByZXN0b3JlIHN0YXRlLlxyXG4gICAgY29uc3QgY3VyckJhc2VWYWx1ZSA9IGludGVydmFsTWlsbGlzICogTWF0aC5wb3coYmFja29mZkZhY3RvciwgYmFja29mZkNvdW50KTtcclxuICAgIC8vIEEgcmFuZG9tIFwiZnV6elwiIHRvIGF2b2lkIHdhdmVzIG9mIHJldHJpZXMuXHJcbiAgICAvLyBEZXZpYXRpb246IHJhbmRvbUZhY3RvciBpcyByZXF1aXJlZC5cclxuICAgIGNvbnN0IHJhbmRvbVdhaXQgPSBNYXRoLnJvdW5kKFxyXG4gICAgLy8gQSBmcmFjdGlvbiBvZiB0aGUgYmFja29mZiB2YWx1ZSB0byBhZGQvc3VidHJhY3QuXHJcbiAgICAvLyBEZXZpYXRpb246IGNoYW5nZXMgbXVsdGlwbGljYXRpb24gb3JkZXIgdG8gaW1wcm92ZSByZWFkYWJpbGl0eS5cclxuICAgIFJBTkRPTV9GQUNUT1IgKlxyXG4gICAgICAgIGN1cnJCYXNlVmFsdWUgKlxyXG4gICAgICAgIC8vIEEgcmFuZG9tIGZsb2F0IChyb3VuZGVkIHRvIGludCBieSBNYXRoLnJvdW5kIGFib3ZlKSBpbiB0aGUgcmFuZ2UgWy0xLCAxXS4gRGV0ZXJtaW5lc1xyXG4gICAgICAgIC8vIGlmIHdlIGFkZCBvciBzdWJ0cmFjdC5cclxuICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKlxyXG4gICAgICAgIDIpO1xyXG4gICAgLy8gTGltaXRzIGJhY2tvZmYgdG8gbWF4IHRvIGF2b2lkIGVmZmVjdGl2ZWx5IHBlcm1hbmVudCBiYWNrb2ZmLlxyXG4gICAgcmV0dXJuIE1hdGgubWluKE1BWF9WQUxVRV9NSUxMSVMsIGN1cnJCYXNlVmFsdWUgKyByYW5kb21XYWl0KTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZSBFbmdsaXNoIG9yZGluYWwgbGV0dGVycyBhZnRlciBhIG51bWJlclxyXG4gKi9cclxuZnVuY3Rpb24gb3JkaW5hbChpKSB7XHJcbiAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShpKSkge1xyXG4gICAgICAgIHJldHVybiBgJHtpfWA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaSArIGluZGljYXRvcihpKTtcclxufVxyXG5mdW5jdGlvbiBpbmRpY2F0b3IoaSkge1xyXG4gICAgaSA9IE1hdGguYWJzKGkpO1xyXG4gICAgY29uc3QgY2VudCA9IGkgJSAxMDA7XHJcbiAgICBpZiAoY2VudCA+PSAxMCAmJiBjZW50IDw9IDIwKSB7XHJcbiAgICAgICAgcmV0dXJuICd0aCc7XHJcbiAgICB9XHJcbiAgICBjb25zdCBkZWMgPSBpICUgMTA7XHJcbiAgICBpZiAoZGVjID09PSAxKSB7XHJcbiAgICAgICAgcmV0dXJuICdzdCc7XHJcbiAgICB9XHJcbiAgICBpZiAoZGVjID09PSAyKSB7XHJcbiAgICAgICAgcmV0dXJuICduZCc7XHJcbiAgICB9XHJcbiAgICBpZiAoZGVjID09PSAzKSB7XHJcbiAgICAgICAgcmV0dXJuICdyZCc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJ3RoJztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRNb2R1bGFySW5zdGFuY2Uoc2VydmljZSkge1xyXG4gICAgaWYgKHNlcnZpY2UgJiYgc2VydmljZS5fZGVsZWdhdGUpIHtcclxuICAgICAgICByZXR1cm4gc2VydmljZS5fZGVsZWdhdGU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgIH1cclxufVxuXG5leHBvcnQgeyBDT05TVEFOVFMsIERlY29kZUJhc2U2NFN0cmluZ0Vycm9yLCBEZWZlcnJlZCwgRXJyb3JGYWN0b3J5LCBGaXJlYmFzZUVycm9yLCBNQVhfVkFMVUVfTUlMTElTLCBSQU5ET01fRkFDVE9SLCBTaGExLCBhcmVDb29raWVzRW5hYmxlZCwgYXNzZXJ0LCBhc3NlcnRpb25FcnJvciwgYXN5bmMsIGJhc2U2NCwgYmFzZTY0RGVjb2RlLCBiYXNlNjRFbmNvZGUsIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nLCBjYWxjdWxhdGVCYWNrb2ZmTWlsbGlzLCBjb250YWlucywgY3JlYXRlTW9ja1VzZXJUb2tlbiwgY3JlYXRlU3Vic2NyaWJlLCBkZWNvZGUsIGRlZXBDb3B5LCBkZWVwRXF1YWwsIGRlZXBFeHRlbmQsIGVycm9yUHJlZml4LCBleHRyYWN0UXVlcnlzdHJpbmcsIGdldERlZmF1bHRBcHBDb25maWcsIGdldERlZmF1bHRFbXVsYXRvckhvc3QsIGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCwgZ2V0RGVmYXVsdHMsIGdldEV4cGVyaW1lbnRhbFNldHRpbmcsIGdldEdsb2JhbCwgZ2V0TW9kdWxhckluc3RhbmNlLCBnZXRVQSwgaXNBZG1pbiwgaXNCcm93c2VyLCBpc0Jyb3dzZXJFeHRlbnNpb24sIGlzQ2xvdWRmbGFyZVdvcmtlciwgaXNFbGVjdHJvbiwgaXNFbXB0eSwgaXNJRSwgaXNJbmRleGVkREJBdmFpbGFibGUsIGlzTW9iaWxlQ29yZG92YSwgaXNOb2RlLCBpc05vZGVTZGssIGlzUmVhY3ROYXRpdmUsIGlzU2FmYXJpLCBpc1VXUCwgaXNWYWxpZEZvcm1hdCwgaXNWYWxpZFRpbWVzdGFtcCwgaXNXZWJXb3JrZXIsIGlzc3VlZEF0VGltZSwganNvbkV2YWwsIG1hcCwgb3JkaW5hbCwgcHJvbWlzZVdpdGhUaW1lb3V0LCBxdWVyeXN0cmluZywgcXVlcnlzdHJpbmdEZWNvZGUsIHNhZmVHZXQsIHN0cmluZ0xlbmd0aCwgc3RyaW5nVG9CeXRlQXJyYXksIHN0cmluZ2lmeSwgdXVpZHY0LCB2YWxpZGF0ZUFyZ0NvdW50LCB2YWxpZGF0ZUNhbGxiYWNrLCB2YWxpZGF0ZUNvbnRleHRPYmplY3QsIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUsIHZhbGlkYXRlTmFtZXNwYWNlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgRGVmZXJyZWQgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5cbi8qKlxyXG4gKiBDb21wb25lbnQgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuIGBhdXRoYCwgYGF1dGgtaW50ZXJuYWxgXHJcbiAqL1xyXG5jbGFzcyBDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIHB1YmxpYyBzZXJ2aWNlIG5hbWUsIGUuZy4gYXBwLCBhdXRoLCBmaXJlc3RvcmUsIGRhdGFiYXNlXHJcbiAgICAgKiBAcGFyYW0gaW5zdGFuY2VGYWN0b3J5IFNlcnZpY2UgZmFjdG9yeSByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlIHB1YmxpYyBpbnRlcmZhY2VcclxuICAgICAqIEBwYXJhbSB0eXBlIHdoZXRoZXIgdGhlIHNlcnZpY2UgcHJvdmlkZWQgYnkgdGhlIGNvbXBvbmVudCBpcyBwdWJsaWMgb3IgcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBpbnN0YW5jZUZhY3RvcnksIHR5cGUpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VGYWN0b3J5ID0gaW5zdGFuY2VGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyA9IGZhbHNlO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFByb3BlcnRpZXMgdG8gYmUgYWRkZWQgdG8gdGhlIHNlcnZpY2UgbmFtZXNwYWNlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlUHJvcHMgPSB7fTtcclxuICAgICAgICB0aGlzLmluc3RhbnRpYXRpb25Nb2RlID0gXCJMQVpZXCIgLyogSW5zdGFudGlhdGlvbk1vZGUuTEFaWSAqLztcclxuICAgICAgICB0aGlzLm9uSW5zdGFuY2VDcmVhdGVkID0gbnVsbDtcclxuICAgIH1cclxuICAgIHNldEluc3RhbnRpYXRpb25Nb2RlKG1vZGUpIHtcclxuICAgICAgICB0aGlzLmluc3RhbnRpYXRpb25Nb2RlID0gbW9kZTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNldE11bHRpcGxlSW5zdGFuY2VzKG11bHRpcGxlSW5zdGFuY2VzKSB7XHJcbiAgICAgICAgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyA9IG11bHRpcGxlSW5zdGFuY2VzO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2V0U2VydmljZVByb3BzKHByb3BzKSB7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlUHJvcHMgPSBwcm9wcztcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNldEluc3RhbmNlQ3JlYXRlZENhbGxiYWNrKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdGhpcy5vbkluc3RhbmNlQ3JlYXRlZCA9IGNhbGxiYWNrO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfRU5UUllfTkFNRSA9ICdbREVGQVVMVF0nO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGluc3RhbmNlIGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiAnYXV0aCcsICdhdXRoLWludGVybmFsJ1xyXG4gKiBOYW1lU2VydmljZU1hcHBpbmdbVF0gaXMgYW4gYWxpYXMgZm9yIHRoZSB0eXBlIG9mIHRoZSBpbnN0YW5jZVxyXG4gKi9cclxuY2xhc3MgUHJvdmlkZXIge1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5vbkluaXRDYWxsYmFja3MgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBpZGVudGlmaWVyIEEgcHJvdmlkZXIgY2FuIHByb3ZpZGUgbXVsdGlwbGUgaW5zdGFuY2VzIG9mIGEgc2VydmljZVxyXG4gICAgICogaWYgdGhpcy5jb21wb25lbnQubXVsdGlwbGVJbnN0YW5jZXMgaXMgdHJ1ZS5cclxuICAgICAqL1xyXG4gICAgZ2V0KGlkZW50aWZpZXIpIHtcclxuICAgICAgICAvLyBpZiBtdWx0aXBsZUluc3RhbmNlcyBpcyBub3Qgc3VwcG9ydGVkLCB1c2UgdGhlIGRlZmF1bHQgbmFtZVxyXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllcik7XHJcbiAgICAgICAgaWYgKCF0aGlzLmluc3RhbmNlc0RlZmVycmVkLmhhcyhub3JtYWxpemVkSWRlbnRpZmllcikpIHtcclxuICAgICAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5zZXQobm9ybWFsaXplZElkZW50aWZpZXIsIGRlZmVycmVkKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHxcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvdWxkQXV0b0luaXRpYWxpemUoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgc2VydmljZSBpZiBpdCBjYW4gYmUgYXV0by1pbml0aWFsaXplZFxyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IHRocm93cyBhbiBleGNlcHRpb24gZHVyaW5nIGdldCgpLCBpdCBzaG91bGQgbm90IGNhdXNlXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYSBmYXRhbCBlcnJvci4gV2UganVzdCByZXR1cm4gdGhlIHVucmVzb2x2ZWQgcHJvbWlzZSBpbiB0aGlzIGNhc2UuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKS5wcm9taXNlO1xyXG4gICAgfVxyXG4gICAgZ2V0SW1tZWRpYXRlKG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgLy8gaWYgbXVsdGlwbGVJbnN0YW5jZXMgaXMgbm90IHN1cHBvcnRlZCwgdXNlIHRoZSBkZWZhdWx0IG5hbWVcclxuICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5pZGVudGlmaWVyKTtcclxuICAgICAgICBjb25zdCBvcHRpb25hbCA9IChfYSA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5vcHRpb25hbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHxcclxuICAgICAgICAgICAgdGhpcy5zaG91bGRBdXRvSW5pdGlhbGl6ZSgpKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZWRJZGVudGlmaWVyXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBJbiBjYXNlIGEgY29tcG9uZW50IGlzIG5vdCBpbml0aWFsaXplZCBhbmQgc2hvdWxkL2Nhbm5vdCBiZSBhdXRvLWluaXRpYWxpemVkIGF0IHRoZSBtb21lbnQsIHJldHVybiBudWxsIGlmIHRoZSBvcHRpb25hbCBmbGFnIGlzIHNldCwgb3IgdGhyb3dcclxuICAgICAgICAgICAgaWYgKG9wdGlvbmFsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKGBTZXJ2aWNlICR7dGhpcy5uYW1lfSBpcyBub3QgYXZhaWxhYmxlYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRDb21wb25lbnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50O1xyXG4gICAgfVxyXG4gICAgc2V0Q29tcG9uZW50KGNvbXBvbmVudCkge1xyXG4gICAgICAgIGlmIChjb21wb25lbnQubmFtZSAhPT0gdGhpcy5uYW1lKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBNaXNtYXRjaGluZyBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gZm9yIFByb3ZpZGVyICR7dGhpcy5uYW1lfS5gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBDb21wb25lbnQgZm9yICR7dGhpcy5uYW1lfSBoYXMgYWxyZWFkeSBiZWVuIHByb3ZpZGVkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29tcG9uZW50ID0gY29tcG9uZW50O1xyXG4gICAgICAgIC8vIHJldHVybiBlYXJseSB3aXRob3V0IGF0dGVtcHRpbmcgdG8gaW5pdGlhbGl6ZSB0aGUgY29tcG9uZW50IGlmIHRoZSBjb21wb25lbnQgcmVxdWlyZXMgZXhwbGljaXQgaW5pdGlhbGl6YXRpb24gKGNhbGxpbmcgYFByb3ZpZGVyLmluaXRpYWxpemUoKWApXHJcbiAgICAgICAgaWYgKCF0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiB0aGUgc2VydmljZSBpcyBlYWdlciwgaW5pdGlhbGl6ZSB0aGUgZGVmYXVsdCBpbnN0YW5jZVxyXG4gICAgICAgIGlmIChpc0NvbXBvbmVudEVhZ2VyKGNvbXBvbmVudCkpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7IGluc3RhbmNlSWRlbnRpZmllcjogREVGQVVMVF9FTlRSWV9OQU1FIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IGZvciBhbiBlYWdlciBDb21wb25lbnQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBkdXJpbmcgdGhlIGVhZ2VyXHJcbiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZSBhIGZhdGFsIGVycm9yLlxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogSW52ZXN0aWdhdGUgaWYgd2UgbmVlZCB0byBtYWtlIGl0IGNvbmZpZ3VyYWJsZSwgYmVjYXVzZSBzb21lIGNvbXBvbmVudCBtYXkgd2FudCB0byBjYXVzZVxyXG4gICAgICAgICAgICAgICAgLy8gYSBmYXRhbCBlcnJvciBpbiB0aGlzIGNhc2U/XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ3JlYXRlIHNlcnZpY2UgaW5zdGFuY2VzIGZvciB0aGUgcGVuZGluZyBwcm9taXNlcyBhbmQgcmVzb2x2ZSB0aGVtXHJcbiAgICAgICAgLy8gTk9URTogaWYgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyBpcyBmYWxzZSwgb25seSB0aGUgZGVmYXVsdCBpbnN0YW5jZSB3aWxsIGJlIGNyZWF0ZWRcclxuICAgICAgICAvLyBhbmQgYWxsIHByb21pc2VzIHdpdGggcmVzb2x2ZSB3aXRoIGl0IHJlZ2FyZGxlc3Mgb2YgdGhlIGlkZW50aWZpZXIuXHJcbiAgICAgICAgZm9yIChjb25zdCBbaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZURlZmVycmVkXSBvZiB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmVudHJpZXMoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGluc3RhbmNlSWRlbnRpZmllcik7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAvLyBgZ2V0T3JJbml0aWFsaXplU2VydmljZSgpYCBzaG91bGQgYWx3YXlzIHJldHVybiBhIHZhbGlkIGluc3RhbmNlIHNpbmNlIGEgY29tcG9uZW50IGlzIGd1YXJhbnRlZWQuIHVzZSAhIHRvIG1ha2UgdHlwZXNjcmlwdCBoYXBweS5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZWRJZGVudGlmaWVyXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIGluc3RhbmNlIGZhY3RvcnkgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZVxyXG4gICAgICAgICAgICAgICAgLy8gYSBmYXRhbCBlcnJvci4gV2UganVzdCBsZWF2ZSB0aGUgcHJvbWlzZSB1bnJlc29sdmVkLlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2xlYXJJbnN0YW5jZShpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5kZWxldGUoaWRlbnRpZmllcik7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXNPcHRpb25zLmRlbGV0ZShpZGVudGlmaWVyKTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlcy5kZWxldGUoaWRlbnRpZmllcik7XHJcbiAgICB9XHJcbiAgICAvLyBhcHAuZGVsZXRlKCkgd2lsbCBjYWxsIHRoaXMgbWV0aG9kIG9uIGV2ZXJ5IHByb3ZpZGVyIHRvIGRlbGV0ZSB0aGUgc2VydmljZXNcclxuICAgIC8vIFRPRE86IHNob3VsZCB3ZSBtYXJrIHRoZSBwcm92aWRlciBhcyBkZWxldGVkP1xyXG4gICAgYXN5bmMgZGVsZXRlKCkge1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2VzID0gQXJyYXkuZnJvbSh0aGlzLmluc3RhbmNlcy52YWx1ZXMoKSk7XHJcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgICAuLi5zZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdJTlRFUk5BTCcgaW4gc2VydmljZSkgLy8gbGVnYWN5IHNlcnZpY2VzXHJcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgICAgICAgICAgICAgLm1hcChzZXJ2aWNlID0+IHNlcnZpY2UuSU5URVJOQUwuZGVsZXRlKCkpLFxyXG4gICAgICAgICAgICAuLi5zZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdfZGVsZXRlJyBpbiBzZXJ2aWNlKSAvLyBtb2R1bGFyaXplZCBzZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICAgICAgICAgIC5tYXAoc2VydmljZSA9PiBzZXJ2aWNlLl9kZWxldGUoKSlcclxuICAgICAgICBdKTtcclxuICAgIH1cclxuICAgIGlzQ29tcG9uZW50U2V0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudCAhPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaXNJbml0aWFsaXplZChpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzLmhhcyhpZGVudGlmaWVyKTtcclxuICAgIH1cclxuICAgIGdldE9wdGlvbnMoaWRlbnRpZmllciA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlc09wdGlvbnMuZ2V0KGlkZW50aWZpZXIpIHx8IHt9O1xyXG4gICAgfVxyXG4gICAgaW5pdGlhbGl6ZShvcHRzID0ge30pIHtcclxuICAgICAgICBjb25zdCB7IG9wdGlvbnMgPSB7fSB9ID0gb3B0cztcclxuICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKG9wdHMuaW5zdGFuY2VJZGVudGlmaWVyKTtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKG5vcm1hbGl6ZWRJZGVudGlmaWVyKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgJHt0aGlzLm5hbWV9KCR7bm9ybWFsaXplZElkZW50aWZpZXJ9KSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpemVkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5pc0NvbXBvbmVudFNldCgpKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBDb21wb25lbnQgJHt0aGlzLm5hbWV9IGhhcyBub3QgYmVlbiByZWdpc3RlcmVkIHlldGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XHJcbiAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXIsXHJcbiAgICAgICAgICAgIG9wdGlvbnNcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyByZXNvbHZlIGFueSBwZW5kaW5nIHByb21pc2Ugd2FpdGluZyBmb3IgdGhlIHNlcnZpY2UgaW5zdGFuY2VcclxuICAgICAgICBmb3IgKGNvbnN0IFtpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlRGVmZXJyZWRdIG9mIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZW50cmllcygpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWREZWZlcnJlZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpbnN0YW5jZUlkZW50aWZpZXIpO1xyXG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZElkZW50aWZpZXIgPT09IG5vcm1hbGl6ZWREZWZlcnJlZElkZW50aWZpZXIpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIC0gYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgaW52b2tlZCAgYWZ0ZXIgdGhlIHByb3ZpZGVyIGhhcyBiZWVuIGluaXRpYWxpemVkIGJ5IGNhbGxpbmcgcHJvdmlkZXIuaW5pdGlhbGl6ZSgpLlxyXG4gICAgICogVGhlIGZ1bmN0aW9uIGlzIGludm9rZWQgU1lOQ0hST05PVVNMWSwgc28gaXQgc2hvdWxkIG5vdCBleGVjdXRlIGFueSBsb25ncnVubmluZyB0YXNrcyBpbiBvcmRlciB0byBub3QgYmxvY2sgdGhlIHByb2dyYW0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkZW50aWZpZXIgQW4gb3B0aW9uYWwgaW5zdGFuY2UgaWRlbnRpZmllclxyXG4gICAgICogQHJldHVybnMgYSBmdW5jdGlvbiB0byB1bnJlZ2lzdGVyIHRoZSBjYWxsYmFja1xyXG4gICAgICovXHJcbiAgICBvbkluaXQoY2FsbGJhY2ssIGlkZW50aWZpZXIpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTtcclxuICAgICAgICBjb25zdCBleGlzdGluZ0NhbGxiYWNrcyA9IChfYSA9IHRoaXMub25Jbml0Q2FsbGJhY2tzLmdldChub3JtYWxpemVkSWRlbnRpZmllcikpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG5ldyBTZXQoKTtcclxuICAgICAgICBleGlzdGluZ0NhbGxiYWNrcy5hZGQoY2FsbGJhY2spO1xyXG4gICAgICAgIHRoaXMub25Jbml0Q2FsbGJhY2tzLnNldChub3JtYWxpemVkSWRlbnRpZmllciwgZXhpc3RpbmdDYWxsYmFja3MpO1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nSW5zdGFuY2UgPSB0aGlzLmluc3RhbmNlcy5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpO1xyXG4gICAgICAgIGlmIChleGlzdGluZ0luc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGV4aXN0aW5nSW5zdGFuY2UsIG5vcm1hbGl6ZWRJZGVudGlmaWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgZXhpc3RpbmdDYWxsYmFja3MuZGVsZXRlKGNhbGxiYWNrKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnZva2Ugb25Jbml0IGNhbGxiYWNrcyBzeW5jaHJvbm91c2x5XHJcbiAgICAgKiBAcGFyYW0gaW5zdGFuY2UgdGhlIHNlcnZpY2UgaW5zdGFuY2VgXHJcbiAgICAgKi9cclxuICAgIGludm9rZU9uSW5pdENhbGxiYWNrcyhpbnN0YW5jZSwgaWRlbnRpZmllcikge1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMub25Jbml0Q2FsbGJhY2tzLmdldChpZGVudGlmaWVyKTtcclxuICAgICAgICBpZiAoIWNhbGxiYWNrcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2sgb2YgY2FsbGJhY2tzKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhpbnN0YW5jZSwgaWRlbnRpZmllcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGluIHRoZSBvbkluaXQgY2FsbGJhY2tcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoeyBpbnN0YW5jZUlkZW50aWZpZXIsIG9wdGlvbnMgPSB7fSB9KSB7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlID0gdGhpcy5pbnN0YW5jZXMuZ2V0KGluc3RhbmNlSWRlbnRpZmllcik7XHJcbiAgICAgICAgaWYgKCFpbnN0YW5jZSAmJiB0aGlzLmNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZSA9IHRoaXMuY29tcG9uZW50Lmluc3RhbmNlRmFjdG9yeSh0aGlzLmNvbnRhaW5lciwge1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVJZGVudGlmaWVyRm9yRmFjdG9yeShpbnN0YW5jZUlkZW50aWZpZXIpLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uc1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZXMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBJbnZva2Ugb25Jbml0IGxpc3RlbmVycy5cclxuICAgICAgICAgICAgICogTm90ZSB0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCBpcyBkaWZmZXJlbnQsIHdoaWNoIGlzIHVzZWQgYnkgdGhlIGNvbXBvbmVudCBjcmVhdG9yLFxyXG4gICAgICAgICAgICAgKiB3aGlsZSBvbkluaXQgbGlzdGVuZXJzIGFyZSByZWdpc3RlcmVkIGJ5IGNvbnN1bWVycyBvZiB0aGUgcHJvdmlkZXIuXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICB0aGlzLmludm9rZU9uSW5pdENhbGxiYWNrcyhpbnN0YW5jZSwgaW5zdGFuY2VJZGVudGlmaWVyKTtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIE9yZGVyIGlzIGltcG9ydGFudFxyXG4gICAgICAgICAgICAgKiBvbkluc3RhbmNlQ3JlYXRlZCgpIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgdGhpcy5pbnN0YW5jZXMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpOyB3aGljaFxyXG4gICAgICAgICAgICAgKiBtYWtlcyBgaXNJbml0aWFsaXplZCgpYCByZXR1cm4gdHJ1ZS5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCh0aGlzLmNvbnRhaW5lciwgaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGluIHRoZSBvbkluc3RhbmNlQ3JlYXRlZENhbGxiYWNrXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllciA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnQubXVsdGlwbGVJbnN0YW5jZXMgPyBpZGVudGlmaWVyIDogREVGQVVMVF9FTlRSWV9OQU1FO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlkZW50aWZpZXI7IC8vIGFzc3VtZSBtdWx0aXBsZSBpbnN0YW5jZXMgYXJlIHN1cHBvcnRlZCBiZWZvcmUgdGhlIGNvbXBvbmVudCBpcyBwcm92aWRlZC5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzaG91bGRBdXRvSW5pdGlhbGl6ZSgpIHtcclxuICAgICAgICByZXR1cm4gKCEhdGhpcy5jb21wb25lbnQgJiZcclxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQuaW5zdGFudGlhdGlvbk1vZGUgIT09IFwiRVhQTElDSVRcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLyk7XHJcbiAgICB9XHJcbn1cclxuLy8gdW5kZWZpbmVkIHNob3VsZCBiZSBwYXNzZWQgdG8gdGhlIHNlcnZpY2UgZmFjdG9yeSBmb3IgdGhlIGRlZmF1bHQgaW5zdGFuY2VcclxuZnVuY3Rpb24gbm9ybWFsaXplSWRlbnRpZmllckZvckZhY3RvcnkoaWRlbnRpZmllcikge1xyXG4gICAgcmV0dXJuIGlkZW50aWZpZXIgPT09IERFRkFVTFRfRU5UUllfTkFNRSA/IHVuZGVmaW5lZCA6IGlkZW50aWZpZXI7XHJcbn1cclxuZnVuY3Rpb24gaXNDb21wb25lbnRFYWdlcihjb21wb25lbnQpIHtcclxuICAgIHJldHVybiBjb21wb25lbnQuaW5zdGFudGlhdGlvbk1vZGUgPT09IFwiRUFHRVJcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FQUdFUiAqLztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQ29tcG9uZW50Q29udGFpbmVyIHRoYXQgcHJvdmlkZXMgUHJvdmlkZXJzIGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiBgYXV0aGAsIGBhdXRoLWludGVybmFsYFxyXG4gKi9cclxuY2xhc3MgQ29tcG9uZW50Q29udGFpbmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJzID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbXBvbmVudCBDb21wb25lbnQgYmVpbmcgYWRkZWRcclxuICAgICAqIEBwYXJhbSBvdmVyd3JpdGUgV2hlbiBhIGNvbXBvbmVudCB3aXRoIHRoZSBzYW1lIG5hbWUgaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkLFxyXG4gICAgICogaWYgb3ZlcndyaXRlIGlzIHRydWU6IG92ZXJ3cml0ZSB0aGUgZXhpc3RpbmcgY29tcG9uZW50IHdpdGggdGhlIG5ldyBjb21wb25lbnQgYW5kIGNyZWF0ZSBhIG5ld1xyXG4gICAgICogcHJvdmlkZXIgd2l0aCB0aGUgbmV3IGNvbXBvbmVudC4gSXQgY2FuIGJlIHVzZWZ1bCBpbiB0ZXN0cyB3aGVyZSB5b3Ugd2FudCB0byB1c2UgZGlmZmVyZW50IG1vY2tzXHJcbiAgICAgKiBmb3IgZGlmZmVyZW50IHRlc3RzLlxyXG4gICAgICogaWYgb3ZlcndyaXRlIGlzIGZhbHNlOiB0aHJvdyBhbiBleGNlcHRpb25cclxuICAgICAqL1xyXG4gICAgYWRkQ29tcG9uZW50KGNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5nZXRQcm92aWRlcihjb21wb25lbnQubmFtZSk7XHJcbiAgICAgICAgaWYgKHByb3ZpZGVyLmlzQ29tcG9uZW50U2V0KCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkIHdpdGggJHt0aGlzLm5hbWV9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3ZpZGVyLnNldENvbXBvbmVudChjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgYWRkT3JPdmVyd3JpdGVDb21wb25lbnQoY29tcG9uZW50KSB7XHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmdldFByb3ZpZGVyKGNvbXBvbmVudC5uYW1lKTtcclxuICAgICAgICBpZiAocHJvdmlkZXIuaXNDb21wb25lbnRTZXQoKSkge1xyXG4gICAgICAgICAgICAvLyBkZWxldGUgdGhlIGV4aXN0aW5nIHByb3ZpZGVyIGZyb20gdGhlIGNvbnRhaW5lciwgc28gd2UgY2FuIHJlZ2lzdGVyIHRoZSBuZXcgY29tcG9uZW50XHJcbiAgICAgICAgICAgIHRoaXMucHJvdmlkZXJzLmRlbGV0ZShjb21wb25lbnQubmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWRkQ29tcG9uZW50KGNvbXBvbmVudCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGdldFByb3ZpZGVyIHByb3ZpZGVzIGEgdHlwZSBzYWZlIGludGVyZmFjZSB3aGVyZSBpdCBjYW4gb25seSBiZSBjYWxsZWQgd2l0aCBhIGZpZWxkIG5hbWVcclxuICAgICAqIHByZXNlbnQgaW4gTmFtZVNlcnZpY2VNYXBwaW5nIGludGVyZmFjZS5cclxuICAgICAqXHJcbiAgICAgKiBGaXJlYmFzZSBTREtzIHByb3ZpZGluZyBzZXJ2aWNlcyBzaG91bGQgZXh0ZW5kIE5hbWVTZXJ2aWNlTWFwcGluZyBpbnRlcmZhY2UgdG8gcmVnaXN0ZXJcclxuICAgICAqIHRoZW1zZWx2ZXMuXHJcbiAgICAgKi9cclxuICAgIGdldFByb3ZpZGVyKG5hbWUpIHtcclxuICAgICAgICBpZiAodGhpcy5wcm92aWRlcnMuaGFzKG5hbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3ZpZGVycy5nZXQobmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNyZWF0ZSBhIFByb3ZpZGVyIGZvciBhIHNlcnZpY2UgdGhhdCBoYXNuJ3QgcmVnaXN0ZXJlZCB3aXRoIEZpcmViYXNlXHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgUHJvdmlkZXIobmFtZSwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcnMuc2V0KG5hbWUsIHByb3ZpZGVyKTtcclxuICAgICAgICByZXR1cm4gcHJvdmlkZXI7XHJcbiAgICB9XHJcbiAgICBnZXRQcm92aWRlcnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5wcm92aWRlcnMudmFsdWVzKCkpO1xyXG4gICAgfVxyXG59XG5cbmV4cG9ydCB7IENvbXBvbmVudCwgQ29tcG9uZW50Q29udGFpbmVyLCBQcm92aWRlciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtMjAxNy5qcy5tYXBcbiIsIi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBBIGNvbnRhaW5lciBmb3IgYWxsIG9mIHRoZSBMb2dnZXIgaW5zdGFuY2VzXHJcbiAqL1xyXG5jb25zdCBpbnN0YW5jZXMgPSBbXTtcclxuLyoqXHJcbiAqIFRoZSBKUyBTREsgc3VwcG9ydHMgNSBsb2cgbGV2ZWxzIGFuZCBhbHNvIGFsbG93cyBhIHVzZXIgdGhlIGFiaWxpdHkgdG9cclxuICogc2lsZW5jZSB0aGUgbG9ncyBhbHRvZ2V0aGVyLlxyXG4gKlxyXG4gKiBUaGUgb3JkZXIgaXMgYSBmb2xsb3dzOlxyXG4gKiBERUJVRyA8IFZFUkJPU0UgPCBJTkZPIDwgV0FSTiA8IEVSUk9SXHJcbiAqXHJcbiAqIEFsbCBvZiB0aGUgbG9nIHR5cGVzIGFib3ZlIHRoZSBjdXJyZW50IGxvZyBsZXZlbCB3aWxsIGJlIGNhcHR1cmVkIChpLmUuIGlmXHJcbiAqIHlvdSBzZXQgdGhlIGxvZyBsZXZlbCB0byBgSU5GT2AsIGVycm9ycyB3aWxsIHN0aWxsIGJlIGxvZ2dlZCwgYnV0IGBERUJVR2AgYW5kXHJcbiAqIGBWRVJCT1NFYCBsb2dzIHdpbGwgbm90KVxyXG4gKi9cclxudmFyIExvZ0xldmVsO1xyXG4oZnVuY3Rpb24gKExvZ0xldmVsKSB7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkRFQlVHXCJdID0gMF0gPSBcIkRFQlVHXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIlZFUkJPU0VcIl0gPSAxXSA9IFwiVkVSQk9TRVwiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJJTkZPXCJdID0gMl0gPSBcIklORk9cIjtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiV0FSTlwiXSA9IDNdID0gXCJXQVJOXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkVSUk9SXCJdID0gNF0gPSBcIkVSUk9SXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIlNJTEVOVFwiXSA9IDVdID0gXCJTSUxFTlRcIjtcclxufSkoTG9nTGV2ZWwgfHwgKExvZ0xldmVsID0ge30pKTtcclxuY29uc3QgbGV2ZWxTdHJpbmdUb0VudW0gPSB7XHJcbiAgICAnZGVidWcnOiBMb2dMZXZlbC5ERUJVRyxcclxuICAgICd2ZXJib3NlJzogTG9nTGV2ZWwuVkVSQk9TRSxcclxuICAgICdpbmZvJzogTG9nTGV2ZWwuSU5GTyxcclxuICAgICd3YXJuJzogTG9nTGV2ZWwuV0FSTixcclxuICAgICdlcnJvcic6IExvZ0xldmVsLkVSUk9SLFxyXG4gICAgJ3NpbGVudCc6IExvZ0xldmVsLlNJTEVOVFxyXG59O1xyXG4vKipcclxuICogVGhlIGRlZmF1bHQgbG9nIGxldmVsXHJcbiAqL1xyXG5jb25zdCBkZWZhdWx0TG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPO1xyXG4vKipcclxuICogQnkgZGVmYXVsdCwgYGNvbnNvbGUuZGVidWdgIGlzIG5vdCBkaXNwbGF5ZWQgaW4gdGhlIGRldmVsb3BlciBjb25zb2xlIChpblxyXG4gKiBjaHJvbWUpLiBUbyBhdm9pZCBmb3JjaW5nIHVzZXJzIHRvIGhhdmUgdG8gb3B0LWluIHRvIHRoZXNlIGxvZ3MgdHdpY2VcclxuICogKGkuZS4gb25jZSBmb3IgZmlyZWJhc2UsIGFuZCBvbmNlIGluIHRoZSBjb25zb2xlKSwgd2UgYXJlIHNlbmRpbmcgYERFQlVHYFxyXG4gKiBsb2dzIHRvIHRoZSBgY29uc29sZS5sb2dgIGZ1bmN0aW9uLlxyXG4gKi9cclxuY29uc3QgQ29uc29sZU1ldGhvZCA9IHtcclxuICAgIFtMb2dMZXZlbC5ERUJVR106ICdsb2cnLFxyXG4gICAgW0xvZ0xldmVsLlZFUkJPU0VdOiAnbG9nJyxcclxuICAgIFtMb2dMZXZlbC5JTkZPXTogJ2luZm8nLFxyXG4gICAgW0xvZ0xldmVsLldBUk5dOiAnd2FybicsXHJcbiAgICBbTG9nTGV2ZWwuRVJST1JdOiAnZXJyb3InXHJcbn07XHJcbi8qKlxyXG4gKiBUaGUgZGVmYXVsdCBsb2cgaGFuZGxlciB3aWxsIGZvcndhcmQgREVCVUcsIFZFUkJPU0UsIElORk8sIFdBUk4sIGFuZCBFUlJPUlxyXG4gKiBtZXNzYWdlcyBvbiB0byB0aGVpciBjb3JyZXNwb25kaW5nIGNvbnNvbGUgY291bnRlcnBhcnRzIChpZiB0aGUgbG9nIG1ldGhvZFxyXG4gKiBpcyBzdXBwb3J0ZWQgYnkgdGhlIGN1cnJlbnQgbG9nIGxldmVsKVxyXG4gKi9cclxuY29uc3QgZGVmYXVsdExvZ0hhbmRsZXIgPSAoaW5zdGFuY2UsIGxvZ1R5cGUsIC4uLmFyZ3MpID0+IHtcclxuICAgIGlmIChsb2dUeXBlIDwgaW5zdGFuY2UubG9nTGV2ZWwpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XHJcbiAgICBjb25zdCBtZXRob2QgPSBDb25zb2xlTWV0aG9kW2xvZ1R5cGVdO1xyXG4gICAgaWYgKG1ldGhvZCkge1xyXG4gICAgICAgIGNvbnNvbGVbbWV0aG9kXShgWyR7bm93fV0gICR7aW5zdGFuY2UubmFtZX06YCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEF0dGVtcHRlZCB0byBsb2cgYSBtZXNzYWdlIHdpdGggYW4gaW52YWxpZCBsb2dUeXBlICh2YWx1ZTogJHtsb2dUeXBlfSlgKTtcclxuICAgIH1cclxufTtcclxuY2xhc3MgTG9nZ2VyIHtcclxuICAgIC8qKlxyXG4gICAgICogR2l2ZXMgeW91IGFuIGluc3RhbmNlIG9mIGEgTG9nZ2VyIHRvIGNhcHR1cmUgbWVzc2FnZXMgYWNjb3JkaW5nIHRvXHJcbiAgICAgKiBGaXJlYmFzZSdzIGxvZ2dpbmcgc2NoZW1lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHRoYXQgdGhlIGxvZ3Mgd2lsbCBiZSBhc3NvY2lhdGVkIHdpdGhcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IobmFtZSkge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIGxvZyBsZXZlbCBvZiB0aGUgZ2l2ZW4gTG9nZ2VyIGluc3RhbmNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX2xvZ0xldmVsID0gZGVmYXVsdExvZ0xldmVsO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSBtYWluIChpbnRlcm5hbCkgbG9nIGhhbmRsZXIgZm9yIHRoZSBMb2dnZXIgaW5zdGFuY2UuXHJcbiAgICAgICAgICogQ2FuIGJlIHNldCB0byBhIG5ldyBmdW5jdGlvbiBpbiBpbnRlcm5hbCBwYWNrYWdlIGNvZGUgYnV0IG5vdCBieSB1c2VyLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIgPSBkZWZhdWx0TG9nSGFuZGxlcjtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUaGUgb3B0aW9uYWwsIGFkZGl0aW9uYWwsIHVzZXItZGVmaW5lZCBsb2cgaGFuZGxlciBmb3IgdGhlIExvZ2dlciBpbnN0YW5jZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ2FwdHVyZSB0aGUgY3VycmVudCBpbnN0YW5jZSBmb3IgbGF0ZXIgdXNlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgaW5zdGFuY2VzLnB1c2godGhpcyk7XHJcbiAgICB9XHJcbiAgICBnZXQgbG9nTGV2ZWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvZ0xldmVsO1xyXG4gICAgfVxyXG4gICAgc2V0IGxvZ0xldmVsKHZhbCkge1xyXG4gICAgICAgIGlmICghKHZhbCBpbiBMb2dMZXZlbCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgSW52YWxpZCB2YWx1ZSBcIiR7dmFsfVwiIGFzc2lnbmVkIHRvIFxcYGxvZ0xldmVsXFxgYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2xvZ0xldmVsID0gdmFsO1xyXG4gICAgfVxyXG4gICAgLy8gV29ya2Fyb3VuZCBmb3Igc2V0dGVyL2dldHRlciBoYXZpbmcgdG8gYmUgdGhlIHNhbWUgdHlwZS5cclxuICAgIHNldExvZ0xldmVsKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2xvZ0xldmVsID0gdHlwZW9mIHZhbCA9PT0gJ3N0cmluZycgPyBsZXZlbFN0cmluZ1RvRW51bVt2YWxdIDogdmFsO1xyXG4gICAgfVxyXG4gICAgZ2V0IGxvZ0hhbmRsZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvZ0hhbmRsZXI7XHJcbiAgICB9XHJcbiAgICBzZXQgbG9nSGFuZGxlcih2YWwpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdWYWx1ZSBhc3NpZ25lZCB0byBgbG9nSGFuZGxlcmAgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIgPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXQgdXNlckxvZ0hhbmRsZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJMb2dIYW5kbGVyO1xyXG4gICAgfVxyXG4gICAgc2V0IHVzZXJMb2dIYW5kbGVyKHZhbCkge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyID0gdmFsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgZnVuY3Rpb25zIGJlbG93IGFyZSBhbGwgYmFzZWQgb24gdGhlIGBjb25zb2xlYCBpbnRlcmZhY2VcclxuICAgICAqL1xyXG4gICAgZGVidWcoLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkRFQlVHLCAuLi5hcmdzKTtcclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkRFQlVHLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIGxvZyguLi5hcmdzKSB7XHJcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiZcclxuICAgICAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuVkVSQk9TRSwgLi4uYXJncyk7XHJcbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5WRVJCT1NFLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIGluZm8oLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLklORk8sIC4uLmFyZ3MpO1xyXG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICB3YXJuKC4uLmFyZ3MpIHtcclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTtcclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLldBUk4sIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgZXJyb3IoLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkVSUk9SLCAuLi5hcmdzKTtcclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkVSUk9SLCAuLi5hcmdzKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBzZXRMb2dMZXZlbChsZXZlbCkge1xyXG4gICAgaW5zdGFuY2VzLmZvckVhY2goaW5zdCA9PiB7XHJcbiAgICAgICAgaW5zdC5zZXRMb2dMZXZlbChsZXZlbCk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBzZXRVc2VyTG9nSGFuZGxlcihsb2dDYWxsYmFjaywgb3B0aW9ucykge1xyXG4gICAgZm9yIChjb25zdCBpbnN0YW5jZSBvZiBpbnN0YW5jZXMpIHtcclxuICAgICAgICBsZXQgY3VzdG9tTG9nTGV2ZWwgPSBudWxsO1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMubGV2ZWwpIHtcclxuICAgICAgICAgICAgY3VzdG9tTG9nTGV2ZWwgPSBsZXZlbFN0cmluZ1RvRW51bVtvcHRpb25zLmxldmVsXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxvZ0NhbGxiYWNrID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnVzZXJMb2dIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnVzZXJMb2dIYW5kbGVyID0gKGluc3RhbmNlLCBsZXZlbCwgLi4uYXJncykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGFyZ3NcclxuICAgICAgICAgICAgICAgICAgICAubWFwKGFyZyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgYXJnID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgYXJnID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgYXJnID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyZy50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFyZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGlnbm9yZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGFyZyA9PiBhcmcpXHJcbiAgICAgICAgICAgICAgICAgICAgLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgIGlmIChsZXZlbCA+PSAoY3VzdG9tTG9nTGV2ZWwgIT09IG51bGwgJiYgY3VzdG9tTG9nTGV2ZWwgIT09IHZvaWQgMCA/IGN1c3RvbUxvZ0xldmVsIDogaW5zdGFuY2UubG9nTGV2ZWwpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nQ2FsbGJhY2soe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogTG9nTGV2ZWxbbGV2ZWxdLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGluc3RhbmNlLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuZXhwb3J0IHsgTG9nTGV2ZWwsIExvZ2dlciwgc2V0TG9nTGV2ZWwsIHNldFVzZXJMb2dIYW5kbGVyIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiY29uc3QgaW5zdGFuY2VPZkFueSA9IChvYmplY3QsIGNvbnN0cnVjdG9ycykgPT4gY29uc3RydWN0b3JzLnNvbWUoKGMpID0+IG9iamVjdCBpbnN0YW5jZW9mIGMpO1xuXG5sZXQgaWRiUHJveHlhYmxlVHlwZXM7XG5sZXQgY3Vyc29yQWR2YW5jZU1ldGhvZHM7XG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cbmZ1bmN0aW9uIGdldElkYlByb3h5YWJsZVR5cGVzKCkge1xuICAgIHJldHVybiAoaWRiUHJveHlhYmxlVHlwZXMgfHxcbiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gW1xuICAgICAgICAgICAgSURCRGF0YWJhc2UsXG4gICAgICAgICAgICBJREJPYmplY3RTdG9yZSxcbiAgICAgICAgICAgIElEQkluZGV4LFxuICAgICAgICAgICAgSURCQ3Vyc29yLFxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24sXG4gICAgICAgIF0pKTtcbn1cbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxuZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7XG4gICAgcmV0dXJuIChjdXJzb3JBZHZhbmNlTWV0aG9kcyB8fFxuICAgICAgICAoY3Vyc29yQWR2YW5jZU1ldGhvZHMgPSBbXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlLFxuICAgICAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZVByaW1hcnlLZXksXG4gICAgICAgIF0pKTtcbn1cbmNvbnN0IGN1cnNvclJlcXVlc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xuY29uc3QgdHJhbnNhY3Rpb25Eb25lTWFwID0gbmV3IFdlYWtNYXAoKTtcbmNvbnN0IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCB0cmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKHdyYXAocmVxdWVzdC5yZXN1bHQpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICAgICAgdW5saXN0ZW4oKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgfSk7XG4gICAgcHJvbWlzZVxuICAgICAgICAudGhlbigodmFsdWUpID0+IHtcbiAgICAgICAgLy8gU2luY2UgY3Vyc29yaW5nIHJldXNlcyB0aGUgSURCUmVxdWVzdCAoKnNpZ2gqKSwgd2UgY2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbFxuICAgICAgICAvLyAoc2VlIHdyYXBGdW5jdGlvbikuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQkN1cnNvcikge1xuICAgICAgICAgICAgY3Vyc29yUmVxdWVzdE1hcC5zZXQodmFsdWUsIHJlcXVlc3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhdGNoaW5nIHRvIGF2b2lkIFwiVW5jYXVnaHQgUHJvbWlzZSBleGNlcHRpb25zXCJcbiAgICB9KVxuICAgICAgICAuY2F0Y2goKCkgPT4geyB9KTtcbiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzXG4gICAgLy8gaXMgYmVjYXVzZSB3ZSBjcmVhdGUgbWFueSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QuXG4gICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChwcm9taXNlLCByZXF1ZXN0KTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbn1cbmZ1bmN0aW9uIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih0eCkge1xuICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLlxuICAgIGlmICh0cmFuc2FjdGlvbkRvbmVNYXAuaGFzKHR4KSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHR4LmVycm9yIHx8IG5ldyBET01FeGNlcHRpb24oJ0Fib3J0RXJyb3InLCAnQWJvcnRFcnJvcicpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XG4gICAgfSk7XG4gICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC5cbiAgICB0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHR4LCBkb25lKTtcbn1cbmxldCBpZGJQcm94eVRyYXBzID0ge1xuICAgIGdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbikge1xuICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnZG9uZScpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uRG9uZU1hcC5nZXQodGFyZ2V0KTtcbiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnb2JqZWN0U3RvcmVOYW1lcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0Lm9iamVjdFN0b3JlTmFtZXMgfHwgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLmdldCh0YXJnZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTWFrZSB0eC5zdG9yZSByZXR1cm4gdGhlIG9ubHkgc3RvcmUgaW4gdGhlIHRyYW5zYWN0aW9uLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG1hbnkuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ3N0b3JlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdXG4gICAgICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogcmVjZWl2ZXIub2JqZWN0U3RvcmUocmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRWxzZSB0cmFuc2Zvcm0gd2hhdGV2ZXIgd2UgZ2V0IGJhY2suXG4gICAgICAgIHJldHVybiB3cmFwKHRhcmdldFtwcm9wXSk7XG4gICAgfSxcbiAgICBzZXQodGFyZ2V0LCBwcm9wLCB2YWx1ZSkge1xuICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBoYXModGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbiAmJlxuICAgICAgICAgICAgKHByb3AgPT09ICdkb25lJyB8fCBwcm9wID09PSAnc3RvcmUnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0O1xuICAgIH0sXG59O1xuZnVuY3Rpb24gcmVwbGFjZVRyYXBzKGNhbGxiYWNrKSB7XG4gICAgaWRiUHJveHlUcmFwcyA9IGNhbGxiYWNrKGlkYlByb3h5VHJhcHMpO1xufVxuZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAvLyBEdWUgdG8gZXhwZWN0ZWQgb2JqZWN0IGVxdWFsaXR5ICh3aGljaCBpcyBlbmZvcmNlZCBieSB0aGUgY2FjaGluZyBpbiBgd3JhcGApLCB3ZVxuICAgIC8vIG9ubHkgY3JlYXRlIG9uZSBuZXcgZnVuYyBwZXIgZnVuYy5cbiAgICAvLyBFZGdlIGRvZXNuJ3Qgc3VwcG9ydCBvYmplY3RTdG9yZU5hbWVzIChib29vKSwgc28gd2UgcG9seWZpbGwgaXQgaGVyZS5cbiAgICBpZiAoZnVuYyA9PT0gSURCRGF0YWJhc2UucHJvdG90eXBlLnRyYW5zYWN0aW9uICYmXG4gICAgICAgICEoJ29iamVjdFN0b3JlTmFtZXMnIGluIElEQlRyYW5zYWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdG9yZU5hbWVzLCAuLi5hcmdzKSB7XG4gICAgICAgICAgICBjb25zdCB0eCA9IGZ1bmMuY2FsbCh1bndyYXAodGhpcyksIHN0b3JlTmFtZXMsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLnNldCh0eCwgc3RvcmVOYW1lcy5zb3J0ID8gc3RvcmVOYW1lcy5zb3J0KCkgOiBbc3RvcmVOYW1lc10pO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAodHgpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBDdXJzb3IgbWV0aG9kcyBhcmUgc3BlY2lhbCwgYXMgdGhlIGJlaGF2aW91ciBpcyBhIGxpdHRsZSBtb3JlIGRpZmZlcmVudCB0byBzdGFuZGFyZCBJREIuIEluXG4gICAgLy8gSURCLCB5b3UgYWR2YW5jZSB0aGUgY3Vyc29yIGFuZCB3YWl0IGZvciBhIG5ldyAnc3VjY2Vzcycgb24gdGhlIElEQlJlcXVlc3QgdGhhdCBnYXZlIHlvdSB0aGVcbiAgICAvLyBjdXJzb3IuIEl0J3Mga2luZGEgbGlrZSBhIHByb21pc2UgdGhhdCBjYW4gcmVzb2x2ZSB3aXRoIG1hbnkgdmFsdWVzLiBUaGF0IGRvZXNuJ3QgbWFrZSBzZW5zZVxuICAgIC8vIHdpdGggcmVhbCBwcm9taXNlcywgc28gZWFjaCBhZHZhbmNlIG1ldGhvZHMgcmV0dXJucyBhIG5ldyBwcm9taXNlIGZvciB0aGUgY3Vyc29yIG9iamVjdCwgb3JcbiAgICAvLyB1bmRlZmluZWQgaWYgdGhlIGVuZCBvZiB0aGUgY3Vyc29yIGhhcyBiZWVuIHJlYWNoZWQuXG4gICAgaWYgKGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkuaW5jbHVkZXMoZnVuYykpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICAgICAgZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAoY3Vyc29yUmVxdWVzdE1hcC5nZXQodGhpcykpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxuICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICByZXR1cm4gd3JhcChmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncykpO1xuICAgIH07XG59XG5mdW5jdGlvbiB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgcmV0dXJuIHdyYXBGdW5jdGlvbih2YWx1ZSk7XG4gICAgLy8gVGhpcyBkb2Vzbid0IHJldHVybiwgaXQganVzdCBjcmVhdGVzIGEgJ2RvbmUnIHByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbixcbiAgICAvLyB3aGljaCBpcyBsYXRlciByZXR1cm5lZCBmb3IgdHJhbnNhY3Rpb24uZG9uZSAoc2VlIGlkYk9iamVjdEhhbmRsZXIpLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKVxuICAgICAgICBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odmFsdWUpO1xuICAgIGlmIChpbnN0YW5jZU9mQW55KHZhbHVlLCBnZXRJZGJQcm94eWFibGVUeXBlcygpKSlcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh2YWx1ZSwgaWRiUHJveHlUcmFwcyk7XG4gICAgLy8gUmV0dXJuIHRoZSBzYW1lIHZhbHVlIGJhY2sgaWYgd2UncmUgbm90IGdvaW5nIHRvIHRyYW5zZm9ybSBpdC5cbiAgICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiB3cmFwKHZhbHVlKSB7XG4gICAgLy8gV2Ugc29tZXRpbWVzIGdlbmVyYXRlIG11bHRpcGxlIHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdCAoZWcgd2hlbiBjdXJzb3JpbmcpLCBiZWNhdXNlXG4gICAgLy8gSURCIGlzIHdlaXJkIGFuZCBhIHNpbmdsZSBJREJSZXF1ZXN0IGNhbiB5aWVsZCBtYW55IHJlc3BvbnNlcywgc28gdGhlc2UgY2FuJ3QgYmUgY2FjaGVkLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlJlcXVlc3QpXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KHZhbHVlKTtcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHRyYW5zZm9ybWVkIHRoaXMgdmFsdWUgYmVmb3JlLCByZXVzZSB0aGUgdHJhbnNmb3JtZWQgdmFsdWUuXG4gICAgLy8gVGhpcyBpcyBmYXN0ZXIsIGJ1dCBpdCBhbHNvIHByb3ZpZGVzIG9iamVjdCBlcXVhbGl0eS5cbiAgICBpZiAodHJhbnNmb3JtQ2FjaGUuaGFzKHZhbHVlKSlcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG4gICAgY29uc3QgbmV3VmFsdWUgPSB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKTtcbiAgICAvLyBOb3QgYWxsIHR5cGVzIGFyZSB0cmFuc2Zvcm1lZC5cbiAgICAvLyBUaGVzZSBtYXkgYmUgcHJpbWl0aXZlIHR5cGVzLCBzbyB0aGV5IGNhbid0IGJlIFdlYWtNYXAga2V5cy5cbiAgICBpZiAobmV3VmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIHRyYW5zZm9ybUNhY2hlLnNldCh2YWx1ZSwgbmV3VmFsdWUpO1xuICAgICAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KG5ld1ZhbHVlLCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdWYWx1ZTtcbn1cbmNvbnN0IHVud3JhcCA9ICh2YWx1ZSkgPT4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG5cbmV4cG9ydCB7IHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBhcyBhLCBpbnN0YW5jZU9mQW55IGFzIGksIHJlcGxhY2VUcmFwcyBhcyByLCB1bndyYXAgYXMgdSwgd3JhcCBhcyB3IH07XG4iLCJpbXBvcnQgeyB3IGFzIHdyYXAsIHIgYXMgcmVwbGFjZVRyYXBzIH0gZnJvbSAnLi93cmFwLWlkYi12YWx1ZS5qcyc7XG5leHBvcnQgeyB1IGFzIHVud3JhcCwgdyBhcyB3cmFwIH0gZnJvbSAnLi93cmFwLWlkYi12YWx1ZS5qcyc7XG5cbi8qKlxuICogT3BlbiBhIGRhdGFiYXNlLlxuICpcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxuICogQHBhcmFtIHZlcnNpb24gU2NoZW1hIHZlcnNpb24uXG4gKiBAcGFyYW0gY2FsbGJhY2tzIEFkZGl0aW9uYWwgY2FsbGJhY2tzLlxuICovXG5mdW5jdGlvbiBvcGVuREIobmFtZSwgdmVyc2lvbiwgeyBibG9ja2VkLCB1cGdyYWRlLCBibG9ja2luZywgdGVybWluYXRlZCB9ID0ge30pIHtcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4obmFtZSwgdmVyc2lvbik7XG4gICAgY29uc3Qgb3BlblByb21pc2UgPSB3cmFwKHJlcXVlc3QpO1xuICAgIGlmICh1cGdyYWRlKSB7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdXBncmFkZSh3cmFwKHJlcXVlc3QucmVzdWx0KSwgZXZlbnQub2xkVmVyc2lvbiwgZXZlbnQubmV3VmVyc2lvbiwgd3JhcChyZXF1ZXN0LnRyYW5zYWN0aW9uKSwgZXZlbnQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJsb2NrZWQpIHtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKFxuICAgICAgICAvLyBDYXN0aW5nIGR1ZSB0byBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQtRE9NLWxpYi1nZW5lcmF0b3IvcHVsbC8xNDA1XG4gICAgICAgIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIGV2ZW50KSk7XG4gICAgfVxuICAgIG9wZW5Qcm9taXNlXG4gICAgICAgIC50aGVuKChkYikgPT4ge1xuICAgICAgICBpZiAodGVybWluYXRlZClcbiAgICAgICAgICAgIGRiLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgKCkgPT4gdGVybWluYXRlZCgpKTtcbiAgICAgICAgaWYgKGJsb2NraW5nKSB7XG4gICAgICAgICAgICBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgKGV2ZW50KSA9PiBibG9ja2luZyhldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCBldmVudCkpO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7XG4gICAgcmV0dXJuIG9wZW5Qcm9taXNlO1xufVxuLyoqXG4gKiBEZWxldGUgYSBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqL1xuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XG4gICAgaWYgKGJsb2NrZWQpIHtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKFxuICAgICAgICAvLyBDYXN0aW5nIGR1ZSB0byBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQtRE9NLWxpYi1nZW5lcmF0b3IvcHVsbC8xNDA1XG4gICAgICAgIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50KSk7XG4gICAgfVxuICAgIHJldHVybiB3cmFwKHJlcXVlc3QpLnRoZW4oKCkgPT4gdW5kZWZpbmVkKTtcbn1cblxuY29uc3QgcmVhZE1ldGhvZHMgPSBbJ2dldCcsICdnZXRLZXknLCAnZ2V0QWxsJywgJ2dldEFsbEtleXMnLCAnY291bnQnXTtcbmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTtcbmNvbnN0IGNhY2hlZE1ldGhvZHMgPSBuZXcgTWFwKCk7XG5mdW5jdGlvbiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB7XG4gICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiZcbiAgICAgICAgIShwcm9wIGluIHRhcmdldCkgJiZcbiAgICAgICAgdHlwZW9mIHByb3AgPT09ICdzdHJpbmcnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjYWNoZWRNZXRob2RzLmdldChwcm9wKSlcbiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApO1xuICAgIGNvbnN0IHRhcmdldEZ1bmNOYW1lID0gcHJvcC5yZXBsYWNlKC9Gcm9tSW5kZXgkLywgJycpO1xuICAgIGNvbnN0IHVzZUluZGV4ID0gcHJvcCAhPT0gdGFyZ2V0RnVuY05hbWU7XG4gICAgY29uc3QgaXNXcml0ZSA9IHdyaXRlTWV0aG9kcy5pbmNsdWRlcyh0YXJnZXRGdW5jTmFtZSk7XG4gICAgaWYgKFxuICAgIC8vIEJhaWwgaWYgdGhlIHRhcmdldCBkb2Vzbid0IGV4aXN0IG9uIHRoZSB0YXJnZXQuIEVnLCBnZXRBbGwgaXNuJ3QgaW4gRWRnZS5cbiAgICAhKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkgfHxcbiAgICAgICAgIShpc1dyaXRlIHx8IHJlYWRNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtZXRob2QgPSBhc3luYyBmdW5jdGlvbiAoc3RvcmVOYW1lLCAuLi5hcmdzKSB7XG4gICAgICAgIC8vIGlzV3JpdGUgPyAncmVhZHdyaXRlJyA6IHVuZGVmaW5lZCBnemlwcHMgYmV0dGVyLCBidXQgZmFpbHMgaW4gRWRnZSA6KFxuICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBpc1dyaXRlID8gJ3JlYWR3cml0ZScgOiAncmVhZG9ubHknKTtcbiAgICAgICAgbGV0IHRhcmdldCA9IHR4LnN0b3JlO1xuICAgICAgICBpZiAodXNlSW5kZXgpXG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTtcbiAgICAgICAgLy8gTXVzdCByZWplY3QgaWYgb3AgcmVqZWN0cy5cbiAgICAgICAgLy8gSWYgaXQncyBhIHdyaXRlIG9wZXJhdGlvbiwgbXVzdCByZWplY3QgaWYgdHguZG9uZSByZWplY3RzLlxuICAgICAgICAvLyBNdXN0IHJlamVjdCB3aXRoIG9wIHJlamVjdGlvbiBmaXJzdC5cbiAgICAgICAgLy8gTXVzdCByZXNvbHZlIHdpdGggb3AgdmFsdWUuXG4gICAgICAgIC8vIE11c3QgaGFuZGxlIGJvdGggcHJvbWlzZXMgKG5vIHVuaGFuZGxlZCByZWplY3Rpb25zKVxuICAgICAgICByZXR1cm4gKGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIHRhcmdldFt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyksXG4gICAgICAgICAgICBpc1dyaXRlICYmIHR4LmRvbmUsXG4gICAgICAgIF0pKVswXTtcbiAgICB9O1xuICAgIGNhY2hlZE1ldGhvZHMuc2V0KHByb3AsIG1ldGhvZCk7XG4gICAgcmV0dXJuIG1ldGhvZDtcbn1cbnJlcGxhY2VUcmFwcygob2xkVHJhcHMpID0+ICh7XG4gICAgLi4ub2xkVHJhcHMsXG4gICAgZ2V0OiAodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikgPT4gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpLFxuICAgIGhhczogKHRhcmdldCwgcHJvcCkgPT4gISFnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5oYXModGFyZ2V0LCBwcm9wKSxcbn0pKTtcblxuZXhwb3J0IHsgZGVsZXRlREIsIG9wZW5EQiB9O1xuIiwiaW1wb3J0IHsgQ29tcG9uZW50LCBDb21wb25lbnRDb250YWluZXIgfSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCB7IExvZ2dlciwgc2V0VXNlckxvZ0hhbmRsZXIsIHNldExvZ0xldmVsIGFzIHNldExvZ0xldmVsJDEgfSBmcm9tICdAZmlyZWJhc2UvbG9nZ2VyJztcbmltcG9ydCB7IEVycm9yRmFjdG9yeSwgZ2V0RGVmYXVsdEFwcENvbmZpZywgZGVlcEVxdWFsLCBpc0Jyb3dzZXIsIGlzV2ViV29ya2VyLCBGaXJlYmFzZUVycm9yLCBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZywgaXNJbmRleGVkREJBdmFpbGFibGUsIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5leHBvcnQgeyBGaXJlYmFzZUVycm9yIH0gZnJvbSAnQGZpcmViYXNlL3V0aWwnO1xuaW1wb3J0IHsgb3BlbkRCIH0gZnJvbSAnaWRiJztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgUGxhdGZvcm1Mb2dnZXJTZXJ2aWNlSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgIH1cclxuICAgIC8vIEluIGluaXRpYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd2lsbCBiZSBjYWxsZWQgYnkgaW5zdGFsbGF0aW9ucyBvblxyXG4gICAgLy8gYXV0aCB0b2tlbiByZWZyZXNoLCBhbmQgaW5zdGFsbGF0aW9ucyB3aWxsIHNlbmQgdGhpcyBzdHJpbmcuXHJcbiAgICBnZXRQbGF0Zm9ybUluZm9TdHJpbmcoKSB7XHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXJzID0gdGhpcy5jb250YWluZXIuZ2V0UHJvdmlkZXJzKCk7XHJcbiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIHByb3ZpZGVycyBhbmQgZ2V0IGxpYnJhcnkvdmVyc2lvbiBwYWlycyBmcm9tIGFueSB0aGF0IGFyZVxyXG4gICAgICAgIC8vIHZlcnNpb24gY29tcG9uZW50cy5cclxuICAgICAgICByZXR1cm4gcHJvdmlkZXJzXHJcbiAgICAgICAgICAgIC5tYXAocHJvdmlkZXIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNWZXJzaW9uU2VydmljZVByb3ZpZGVyKHByb3ZpZGVyKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VydmljZSA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3NlcnZpY2UubGlicmFyeX0vJHtzZXJ2aWNlLnZlcnNpb259YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZpbHRlcihsb2dTdHJpbmcgPT4gbG9nU3RyaW5nKVxyXG4gICAgICAgICAgICAuam9pbignICcpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgY2hlY2sgaWYgdGhpcyBwcm92aWRlciBwcm92aWRlcyBhIFZlcnNpb25TZXJ2aWNlXHJcbiAqXHJcbiAqIE5PVEU6IFVzaW5nIFByb3ZpZGVyPCdhcHAtdmVyc2lvbic+IGlzIGEgaGFjayB0byBpbmRpY2F0ZSB0aGF0IHRoZSBwcm92aWRlclxyXG4gKiBwcm92aWRlcyBWZXJzaW9uU2VydmljZS4gVGhlIHByb3ZpZGVyIGlzIG5vdCBuZWNlc3NhcmlseSBhICdhcHAtdmVyc2lvbidcclxuICogcHJvdmlkZXIuXHJcbiAqL1xyXG5mdW5jdGlvbiBpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIocHJvdmlkZXIpIHtcclxuICAgIGNvbnN0IGNvbXBvbmVudCA9IHByb3ZpZGVyLmdldENvbXBvbmVudCgpO1xyXG4gICAgcmV0dXJuIChjb21wb25lbnQgPT09IG51bGwgfHwgY29tcG9uZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb21wb25lbnQudHlwZSkgPT09IFwiVkVSU0lPTlwiIC8qIENvbXBvbmVudFR5cGUuVkVSU0lPTiAqLztcclxufVxuXG5jb25zdCBuYW1lJHEgPSBcIkBmaXJlYmFzZS9hcHBcIjtcbmNvbnN0IHZlcnNpb24kMSA9IFwiMC4xMC4xM1wiO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdAZmlyZWJhc2UvYXBwJyk7XG5cbmNvbnN0IG5hbWUkcCA9IFwiQGZpcmViYXNlL2FwcC1jb21wYXRcIjtcblxuY29uc3QgbmFtZSRvID0gXCJAZmlyZWJhc2UvYW5hbHl0aWNzLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJG4gPSBcIkBmaXJlYmFzZS9hbmFseXRpY3NcIjtcblxuY29uc3QgbmFtZSRtID0gXCJAZmlyZWJhc2UvYXBwLWNoZWNrLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGwgPSBcIkBmaXJlYmFzZS9hcHAtY2hlY2tcIjtcblxuY29uc3QgbmFtZSRrID0gXCJAZmlyZWJhc2UvYXV0aFwiO1xuXG5jb25zdCBuYW1lJGogPSBcIkBmaXJlYmFzZS9hdXRoLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGkgPSBcIkBmaXJlYmFzZS9kYXRhYmFzZVwiO1xuXG5jb25zdCBuYW1lJGggPSBcIkBmaXJlYmFzZS9kYXRhLWNvbm5lY3RcIjtcblxuY29uc3QgbmFtZSRnID0gXCJAZmlyZWJhc2UvZGF0YWJhc2UtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkZiA9IFwiQGZpcmViYXNlL2Z1bmN0aW9uc1wiO1xuXG5jb25zdCBuYW1lJGUgPSBcIkBmaXJlYmFzZS9mdW5jdGlvbnMtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkZCA9IFwiQGZpcmViYXNlL2luc3RhbGxhdGlvbnNcIjtcblxuY29uc3QgbmFtZSRjID0gXCJAZmlyZWJhc2UvaW5zdGFsbGF0aW9ucy1jb21wYXRcIjtcblxuY29uc3QgbmFtZSRiID0gXCJAZmlyZWJhc2UvbWVzc2FnaW5nXCI7XG5cbmNvbnN0IG5hbWUkYSA9IFwiQGZpcmViYXNlL21lc3NhZ2luZy1jb21wYXRcIjtcblxuY29uc3QgbmFtZSQ5ID0gXCJAZmlyZWJhc2UvcGVyZm9ybWFuY2VcIjtcblxuY29uc3QgbmFtZSQ4ID0gXCJAZmlyZWJhc2UvcGVyZm9ybWFuY2UtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkNyA9IFwiQGZpcmViYXNlL3JlbW90ZS1jb25maWdcIjtcblxuY29uc3QgbmFtZSQ2ID0gXCJAZmlyZWJhc2UvcmVtb3RlLWNvbmZpZy1jb21wYXRcIjtcblxuY29uc3QgbmFtZSQ1ID0gXCJAZmlyZWJhc2Uvc3RvcmFnZVwiO1xuXG5jb25zdCBuYW1lJDQgPSBcIkBmaXJlYmFzZS9zdG9yYWdlLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJDMgPSBcIkBmaXJlYmFzZS9maXJlc3RvcmVcIjtcblxuY29uc3QgbmFtZSQyID0gXCJAZmlyZWJhc2UvdmVydGV4YWktcHJldmlld1wiO1xuXG5jb25zdCBuYW1lJDEgPSBcIkBmaXJlYmFzZS9maXJlc3RvcmUtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUgPSBcImZpcmViYXNlXCI7XG5jb25zdCB2ZXJzaW9uID0gXCIxMC4xNC4xXCI7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaGUgZGVmYXVsdCBhcHAgbmFtZVxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IERFRkFVTFRfRU5UUllfTkFNRSA9ICdbREVGQVVMVF0nO1xyXG5jb25zdCBQTEFURk9STV9MT0dfU1RSSU5HID0ge1xyXG4gICAgW25hbWUkcV06ICdmaXJlLWNvcmUnLFxyXG4gICAgW25hbWUkcF06ICdmaXJlLWNvcmUtY29tcGF0JyxcclxuICAgIFtuYW1lJG5dOiAnZmlyZS1hbmFseXRpY3MnLFxyXG4gICAgW25hbWUkb106ICdmaXJlLWFuYWx5dGljcy1jb21wYXQnLFxyXG4gICAgW25hbWUkbF06ICdmaXJlLWFwcC1jaGVjaycsXHJcbiAgICBbbmFtZSRtXTogJ2ZpcmUtYXBwLWNoZWNrLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRrXTogJ2ZpcmUtYXV0aCcsXHJcbiAgICBbbmFtZSRqXTogJ2ZpcmUtYXV0aC1jb21wYXQnLFxyXG4gICAgW25hbWUkaV06ICdmaXJlLXJ0ZGInLFxyXG4gICAgW25hbWUkaF06ICdmaXJlLWRhdGEtY29ubmVjdCcsXHJcbiAgICBbbmFtZSRnXTogJ2ZpcmUtcnRkYi1jb21wYXQnLFxyXG4gICAgW25hbWUkZl06ICdmaXJlLWZuJyxcclxuICAgIFtuYW1lJGVdOiAnZmlyZS1mbi1jb21wYXQnLFxyXG4gICAgW25hbWUkZF06ICdmaXJlLWlpZCcsXHJcbiAgICBbbmFtZSRjXTogJ2ZpcmUtaWlkLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRiXTogJ2ZpcmUtZmNtJyxcclxuICAgIFtuYW1lJGFdOiAnZmlyZS1mY20tY29tcGF0JyxcclxuICAgIFtuYW1lJDldOiAnZmlyZS1wZXJmJyxcclxuICAgIFtuYW1lJDhdOiAnZmlyZS1wZXJmLWNvbXBhdCcsXHJcbiAgICBbbmFtZSQ3XTogJ2ZpcmUtcmMnLFxyXG4gICAgW25hbWUkNl06ICdmaXJlLXJjLWNvbXBhdCcsXHJcbiAgICBbbmFtZSQ1XTogJ2ZpcmUtZ2NzJyxcclxuICAgIFtuYW1lJDRdOiAnZmlyZS1nY3MtY29tcGF0JyxcclxuICAgIFtuYW1lJDNdOiAnZmlyZS1mc3QnLFxyXG4gICAgW25hbWUkMV06ICdmaXJlLWZzdC1jb21wYXQnLFxyXG4gICAgW25hbWUkMl06ICdmaXJlLXZlcnRleCcsXHJcbiAgICAnZmlyZS1qcyc6ICdmaXJlLWpzJyxcclxuICAgIFtuYW1lXTogJ2ZpcmUtanMtYWxsJ1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jb25zdCBfYXBwcyA9IG5ldyBNYXAoKTtcclxuLyoqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgX3NlcnZlckFwcHMgPSBuZXcgTWFwKCk7XHJcbi8qKlxyXG4gKiBSZWdpc3RlcmVkIGNvbXBvbmVudHMuXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuY29uc3QgX2NvbXBvbmVudHMgPSBuZXcgTWFwKCk7XHJcbi8qKlxyXG4gKiBAcGFyYW0gY29tcG9uZW50IC0gdGhlIGNvbXBvbmVudCBiZWluZyBhZGRlZCB0byB0aGlzIGFwcCdzIGNvbnRhaW5lclxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9hZGRDb21wb25lbnQoYXBwLCBjb21wb25lbnQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgYXBwLmNvbnRhaW5lci5hZGRDb21wb25lbnQoY29tcG9uZW50KTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gZmFpbGVkIHRvIHJlZ2lzdGVyIHdpdGggRmlyZWJhc2VBcHAgJHthcHAubmFtZX1gLCBlKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5mdW5jdGlvbiBfYWRkT3JPdmVyd3JpdGVDb21wb25lbnQoYXBwLCBjb21wb25lbnQpIHtcclxuICAgIGFwcC5jb250YWluZXIuYWRkT3JPdmVyd3JpdGVDb21wb25lbnQoY29tcG9uZW50KTtcclxufVxyXG4vKipcclxuICpcclxuICogQHBhcmFtIGNvbXBvbmVudCAtIHRoZSBjb21wb25lbnQgdG8gcmVnaXN0ZXJcclxuICogQHJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGNvbXBvbmVudCBpcyByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseVxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9yZWdpc3RlckNvbXBvbmVudChjb21wb25lbnQpIHtcclxuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSBjb21wb25lbnQubmFtZTtcclxuICAgIGlmIChfY29tcG9uZW50cy5oYXMoY29tcG9uZW50TmFtZSkpIHtcclxuICAgICAgICBsb2dnZXIuZGVidWcoYFRoZXJlIHdlcmUgbXVsdGlwbGUgYXR0ZW1wdHMgdG8gcmVnaXN0ZXIgY29tcG9uZW50ICR7Y29tcG9uZW50TmFtZX0uYCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgX2NvbXBvbmVudHMuc2V0KGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudCk7XHJcbiAgICAvLyBhZGQgdGhlIGNvbXBvbmVudCB0byBleGlzdGluZyBhcHAgaW5zdGFuY2VzXHJcbiAgICBmb3IgKGNvbnN0IGFwcCBvZiBfYXBwcy52YWx1ZXMoKSkge1xyXG4gICAgICAgIF9hZGRDb21wb25lbnQoYXBwLCBjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgZm9yIChjb25zdCBzZXJ2ZXJBcHAgb2YgX3NlcnZlckFwcHMudmFsdWVzKCkpIHtcclxuICAgICAgICBfYWRkQ29tcG9uZW50KHNlcnZlckFwcCwgY29tcG9uZW50KTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gYXBwIC0gRmlyZWJhc2VBcHAgaW5zdGFuY2VcclxuICogQHBhcmFtIG5hbWUgLSBzZXJ2aWNlIG5hbWVcclxuICpcclxuICogQHJldHVybnMgdGhlIHByb3ZpZGVyIGZvciB0aGUgc2VydmljZSB3aXRoIHRoZSBtYXRjaGluZyBuYW1lXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gX2dldFByb3ZpZGVyKGFwcCwgbmFtZSkge1xyXG4gICAgY29uc3QgaGVhcnRiZWF0Q29udHJvbGxlciA9IGFwcC5jb250YWluZXJcclxuICAgICAgICAuZ2V0UHJvdmlkZXIoJ2hlYXJ0YmVhdCcpXHJcbiAgICAgICAgLmdldEltbWVkaWF0ZSh7IG9wdGlvbmFsOiB0cnVlIH0pO1xyXG4gICAgaWYgKGhlYXJ0YmVhdENvbnRyb2xsZXIpIHtcclxuICAgICAgICB2b2lkIGhlYXJ0YmVhdENvbnRyb2xsZXIudHJpZ2dlckhlYXJ0YmVhdCgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFwcC5jb250YWluZXIuZ2V0UHJvdmlkZXIobmFtZSk7XHJcbn1cclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSBhcHAgLSBGaXJlYmFzZUFwcCBpbnN0YW5jZVxyXG4gKiBAcGFyYW0gbmFtZSAtIHNlcnZpY2UgbmFtZVxyXG4gKiBAcGFyYW0gaW5zdGFuY2VJZGVudGlmaWVyIC0gc2VydmljZSBpbnN0YW5jZSBpZGVudGlmaWVyIGluIGNhc2UgdGhlIHNlcnZpY2Ugc3VwcG9ydHMgbXVsdGlwbGUgaW5zdGFuY2VzXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gX3JlbW92ZVNlcnZpY2VJbnN0YW5jZShhcHAsIG5hbWUsIGluc3RhbmNlSWRlbnRpZmllciA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgX2dldFByb3ZpZGVyKGFwcCwgbmFtZSkuY2xlYXJJbnN0YW5jZShpbnN0YW5jZUlkZW50aWZpZXIpO1xyXG59XHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gb2JqIC0gYW4gb2JqZWN0IG9mIHR5cGUgRmlyZWJhc2VBcHAgb3IgRmlyZWJhc2VPcHRpb25zLlxyXG4gKlxyXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlIG9iamVjdCBpcyBvZiB0eXBlIEZpcmViYXNlQXBwLlxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9pc0ZpcmViYXNlQXBwKG9iaikge1xyXG4gICAgcmV0dXJuIG9iai5vcHRpb25zICE9PSB1bmRlZmluZWQ7XHJcbn1cclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSBvYmogLSBhbiBvYmplY3Qgb2YgdHlwZSBGaXJlYmFzZUFwcC5cclxuICpcclxuICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgb2JqZWN0IGlzIG9mIHR5cGUgRmlyZWJhc2VTZXJ2ZXJBcHBJbXBsLlxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9pc0ZpcmViYXNlU2VydmVyQXBwKG9iaikge1xyXG4gICAgcmV0dXJuIG9iai5zZXR0aW5ncyAhPT0gdW5kZWZpbmVkO1xyXG59XHJcbi8qKlxyXG4gKiBUZXN0IG9ubHlcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5mdW5jdGlvbiBfY2xlYXJDb21wb25lbnRzKCkge1xyXG4gICAgX2NvbXBvbmVudHMuY2xlYXIoKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBFUlJPUlMgPSB7XHJcbiAgICBbXCJuby1hcHBcIiAvKiBBcHBFcnJvci5OT19BUFAgKi9dOiBcIk5vIEZpcmViYXNlIEFwcCAneyRhcHBOYW1lfScgaGFzIGJlZW4gY3JlYXRlZCAtIFwiICtcclxuICAgICAgICAnY2FsbCBpbml0aWFsaXplQXBwKCkgZmlyc3QnLFxyXG4gICAgW1wiYmFkLWFwcC1uYW1lXCIgLyogQXBwRXJyb3IuQkFEX0FQUF9OQU1FICovXTogXCJJbGxlZ2FsIEFwcCBuYW1lOiAneyRhcHBOYW1lfSdcIixcclxuICAgIFtcImR1cGxpY2F0ZS1hcHBcIiAvKiBBcHBFcnJvci5EVVBMSUNBVEVfQVBQICovXTogXCJGaXJlYmFzZSBBcHAgbmFtZWQgJ3skYXBwTmFtZX0nIGFscmVhZHkgZXhpc3RzIHdpdGggZGlmZmVyZW50IG9wdGlvbnMgb3IgY29uZmlnXCIsXHJcbiAgICBbXCJhcHAtZGVsZXRlZFwiIC8qIEFwcEVycm9yLkFQUF9ERUxFVEVEICovXTogXCJGaXJlYmFzZSBBcHAgbmFtZWQgJ3skYXBwTmFtZX0nIGFscmVhZHkgZGVsZXRlZFwiLFxyXG4gICAgW1wic2VydmVyLWFwcC1kZWxldGVkXCIgLyogQXBwRXJyb3IuU0VSVkVSX0FQUF9ERUxFVEVEICovXTogJ0ZpcmViYXNlIFNlcnZlciBBcHAgaGFzIGJlZW4gZGVsZXRlZCcsXHJcbiAgICBbXCJuby1vcHRpb25zXCIgLyogQXBwRXJyb3IuTk9fT1BUSU9OUyAqL106ICdOZWVkIHRvIHByb3ZpZGUgb3B0aW9ucywgd2hlbiBub3QgYmVpbmcgZGVwbG95ZWQgdG8gaG9zdGluZyB2aWEgc291cmNlLicsXHJcbiAgICBbXCJpbnZhbGlkLWFwcC1hcmd1bWVudFwiIC8qIEFwcEVycm9yLklOVkFMSURfQVBQX0FSR1VNRU5UICovXTogJ2ZpcmViYXNlLnskYXBwTmFtZX0oKSB0YWtlcyBlaXRoZXIgbm8gYXJndW1lbnQgb3IgYSAnICtcclxuICAgICAgICAnRmlyZWJhc2UgQXBwIGluc3RhbmNlLicsXHJcbiAgICBbXCJpbnZhbGlkLWxvZy1hcmd1bWVudFwiIC8qIEFwcEVycm9yLklOVkFMSURfTE9HX0FSR1VNRU5UICovXTogJ0ZpcnN0IGFyZ3VtZW50IHRvIGBvbkxvZ2AgbXVzdCBiZSBudWxsIG9yIGEgZnVuY3Rpb24uJyxcclxuICAgIFtcImlkYi1vcGVuXCIgLyogQXBwRXJyb3IuSURCX09QRU4gKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gb3BlbmluZyBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nLFxyXG4gICAgW1wiaWRiLWdldFwiIC8qIEFwcEVycm9yLklEQl9HRVQgKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gcmVhZGluZyBmcm9tIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsXHJcbiAgICBbXCJpZGItc2V0XCIgLyogQXBwRXJyb3IuSURCX1dSSVRFICovXTogJ0Vycm9yIHRocm93biB3aGVuIHdyaXRpbmcgdG8gSW5kZXhlZERCLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJyxcclxuICAgIFtcImlkYi1kZWxldGVcIiAvKiBBcHBFcnJvci5JREJfREVMRVRFICovXTogJ0Vycm9yIHRocm93biB3aGVuIGRlbGV0aW5nIGZyb20gSW5kZXhlZERCLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJyxcclxuICAgIFtcImZpbmFsaXphdGlvbi1yZWdpc3RyeS1ub3Qtc3VwcG9ydGVkXCIgLyogQXBwRXJyb3IuRklOQUxJWkFUSU9OX1JFR0lTVFJZX05PVF9TVVBQT1JURUQgKi9dOiAnRmlyZWJhc2VTZXJ2ZXJBcHAgZGVsZXRlT25EZXJlZiBmaWVsZCBkZWZpbmVkIGJ1dCB0aGUgSlMgcnVudGltZSBkb2VzIG5vdCBzdXBwb3J0IEZpbmFsaXphdGlvblJlZ2lzdHJ5LicsXHJcbiAgICBbXCJpbnZhbGlkLXNlcnZlci1hcHAtZW52aXJvbm1lbnRcIiAvKiBBcHBFcnJvci5JTlZBTElEX1NFUlZFUl9BUFBfRU5WSVJPTk1FTlQgKi9dOiAnRmlyZWJhc2VTZXJ2ZXJBcHAgaXMgbm90IGZvciB1c2UgaW4gYnJvd3NlciBlbnZpcm9ubWVudHMuJ1xyXG59O1xyXG5jb25zdCBFUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeSgnYXBwJywgJ0ZpcmViYXNlJywgRVJST1JTKTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgRmlyZWJhc2VBcHBJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5faXNEZWxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyk7XHJcbiAgICAgICAgdGhpcy5fbmFtZSA9IGNvbmZpZy5uYW1lO1xyXG4gICAgICAgIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCA9XHJcbiAgICAgICAgICAgIGNvbmZpZy5hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFkZENvbXBvbmVudChuZXcgQ29tcG9uZW50KCdhcHAnLCAoKSA9PiB0aGlzLCBcIlBVQkxJQ1wiIC8qIENvbXBvbmVudFR5cGUuUFVCTElDICovKSk7XHJcbiAgICB9XHJcbiAgICBnZXQgYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkO1xyXG4gICAgfVxyXG4gICAgc2V0IGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCh2YWwpIHtcclxuICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XHJcbiAgICAgICAgdGhpcy5fYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkID0gdmFsO1xyXG4gICAgfVxyXG4gICAgZ2V0IG5hbWUoKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xyXG4gICAgfVxyXG4gICAgZ2V0IG9wdGlvbnMoKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xyXG4gICAgfVxyXG4gICAgZ2V0IGNvbmZpZygpIHtcclxuICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcclxuICAgIH1cclxuICAgIGdldCBjb250YWluZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjtcclxuICAgIH1cclxuICAgIGdldCBpc0RlbGV0ZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRGVsZXRlZDtcclxuICAgIH1cclxuICAgIHNldCBpc0RlbGV0ZWQodmFsKSB7XHJcbiAgICAgICAgdGhpcy5faXNEZWxldGVkID0gdmFsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYW4gRXJyb3IgaWYgdGhlIEFwcCBoYXMgYWxyZWFkeSBiZWVuIGRlbGV0ZWQgLVxyXG4gICAgICogdXNlIGJlZm9yZSBwZXJmb3JtaW5nIEFQSSBhY3Rpb25zIG9uIHRoZSBBcHAuXHJcbiAgICAgKi9cclxuICAgIGNoZWNrRGVzdHJveWVkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzRGVsZXRlZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImFwcC1kZWxldGVkXCIgLyogQXBwRXJyb3IuQVBQX0RFTEVURUQgKi8sIHsgYXBwTmFtZTogdGhpcy5fbmFtZSB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgRmlyZWJhc2VTZXJ2ZXJBcHBJbXBsIGV4dGVuZHMgRmlyZWJhc2VBcHBJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMsIHNlcnZlckNvbmZpZywgbmFtZSwgY29udGFpbmVyKSB7XHJcbiAgICAgICAgLy8gQnVpbGQgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzIGZvciB0aGUgRmlyZWJhc2VBcHBJbXBsIGJhc2UgY2xhc3MuXHJcbiAgICAgICAgY29uc3QgYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkID0gc2VydmVyQ29uZmlnLmF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgID8gc2VydmVyQ29uZmlnLmF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZFxyXG4gICAgICAgICAgICA6IGZhbHNlO1xyXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgRmlyZWJhc2VBcHBTZXR0aW5ncyBvYmplY3QgZm9yIHRoZSBGaXJlYmFzZUFwcEltcCBjb25zdHJ1Y3Rvci5cclxuICAgICAgICBjb25zdCBjb25maWcgPSB7XHJcbiAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgIGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuYXBpS2V5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgLy8gQ29uc3RydWN0IHRoZSBwYXJlbnQgRmlyZWJhc2VBcHBJbXAgb2JqZWN0LlxyXG4gICAgICAgICAgICBzdXBlcihvcHRpb25zLCBjb25maWcsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBhcHBJbXBsID0gb3B0aW9ucztcclxuICAgICAgICAgICAgc3VwZXIoYXBwSW1wbC5vcHRpb25zLCBjb25maWcsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIE5vdyBjb25zdHJ1Y3QgdGhlIGRhdGEgZm9yIHRoZSBGaXJlYmFzZVNlcnZlckFwcEltcGwuXHJcbiAgICAgICAgdGhpcy5fc2VydmVyQ29uZmlnID0gT2JqZWN0LmFzc2lnbih7IGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCB9LCBzZXJ2ZXJDb25maWcpO1xyXG4gICAgICAgIHRoaXMuX2ZpbmFsaXphdGlvblJlZ2lzdHJ5ID0gbnVsbDtcclxuICAgICAgICBpZiAodHlwZW9mIEZpbmFsaXphdGlvblJlZ2lzdHJ5ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICB0aGlzLl9maW5hbGl6YXRpb25SZWdpc3RyeSA9IG5ldyBGaW5hbGl6YXRpb25SZWdpc3RyeSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF1dG9tYXRpY0NsZWFudXAoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3JlZkNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLmluY1JlZkNvdW50KHRoaXMuX3NlcnZlckNvbmZpZy5yZWxlYXNlT25EZXJlZik7XHJcbiAgICAgICAgLy8gRG8gbm90IHJldGFpbiBhIGhhcmQgcmVmZXJlbmNlIHRvIHRoZSBkcmVmIG9iamVjdCwgb3RoZXJ3aXNlIHRoZSBGaW5hbGl6YXRpb25SZWdpc3RyeVxyXG4gICAgICAgIC8vIHdpbGwgbmV2ZXIgdHJpZ2dlci5cclxuICAgICAgICB0aGlzLl9zZXJ2ZXJDb25maWcucmVsZWFzZU9uRGVyZWYgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgc2VydmVyQ29uZmlnLnJlbGVhc2VPbkRlcmVmID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lJHEsIHZlcnNpb24kMSwgJ3NlcnZlcmFwcCcpO1xyXG4gICAgfVxyXG4gICAgdG9KU09OKCkge1xyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICBnZXQgcmVmQ291bnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlZkNvdW50O1xyXG4gICAgfVxyXG4gICAgLy8gSW5jcmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQgb2YgdGhpcyBzZXJ2ZXIgYXBwLiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQsIHJlZ2lzdGVyIGl0XHJcbiAgICAvLyB3aXRoIHRoZSBmaW5hbGl6YXRpb24gcmVnaXN0cnkuXHJcbiAgICBpbmNSZWZDb3VudChvYmopIHtcclxuICAgICAgICBpZiAodGhpcy5pc0RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9yZWZDb3VudCsrO1xyXG4gICAgICAgIGlmIChvYmogIT09IHVuZGVmaW5lZCAmJiB0aGlzLl9maW5hbGl6YXRpb25SZWdpc3RyeSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9maW5hbGl6YXRpb25SZWdpc3RyeS5yZWdpc3RlcihvYmosIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIERlY3JlbWVudCB0aGUgcmVmZXJlbmNlIGNvdW50LlxyXG4gICAgZGVjUmVmQ291bnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNEZWxldGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gLS10aGlzLl9yZWZDb3VudDtcclxuICAgIH1cclxuICAgIC8vIEludm9rZWQgYnkgdGhlIEZpbmFsaXphdGlvblJlZ2lzdHJ5IGNhbGxiYWNrIHRvIG5vdGUgdGhhdCB0aGlzIGFwcCBzaG91bGQgZ28gdGhyb3VnaCBpdHNcclxuICAgIC8vIHJlZmVyZW5jZSBjb3VudHMgYW5kIGRlbGV0ZSBpdHNlbGYgaWYgbm8gcmVmZXJlbmNlIGNvdW50IHJlbWFpbi4gVGhlIGNvb3JkaW5hdGluZyBsb2dpYyB0aGF0XHJcbiAgICAvLyBoYW5kbGVzIHRoaXMgaXMgaW4gZGVsZXRlQXBwKC4uLikuXHJcbiAgICBhdXRvbWF0aWNDbGVhbnVwKCkge1xyXG4gICAgICAgIHZvaWQgZGVsZXRlQXBwKHRoaXMpO1xyXG4gICAgfVxyXG4gICAgZ2V0IHNldHRpbmdzKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VydmVyQ29uZmlnO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYW4gRXJyb3IgaWYgdGhlIEFwcCBoYXMgYWxyZWFkeSBiZWVuIGRlbGV0ZWQgLVxyXG4gICAgICogdXNlIGJlZm9yZSBwZXJmb3JtaW5nIEFQSSBhY3Rpb25zIG9uIHRoZSBBcHAuXHJcbiAgICAgKi9cclxuICAgIGNoZWNrRGVzdHJveWVkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzRGVsZXRlZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcInNlcnZlci1hcHAtZGVsZXRlZFwiIC8qIEFwcEVycm9yLlNFUlZFUl9BUFBfREVMRVRFRCAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaGUgY3VycmVudCBTREsgdmVyc2lvbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgU0RLX1ZFUlNJT04gPSB2ZXJzaW9uO1xyXG5mdW5jdGlvbiBpbml0aWFsaXplQXBwKF9vcHRpb25zLCByYXdDb25maWcgPSB7fSkge1xyXG4gICAgbGV0IG9wdGlvbnMgPSBfb3B0aW9ucztcclxuICAgIGlmICh0eXBlb2YgcmF3Q29uZmlnICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIGNvbnN0IG5hbWUgPSByYXdDb25maWc7XHJcbiAgICAgICAgcmF3Q29uZmlnID0geyBuYW1lIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb25maWcgPSBPYmplY3QuYXNzaWduKHsgbmFtZTogREVGQVVMVF9FTlRSWV9OQU1FLCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sIHJhd0NvbmZpZyk7XHJcbiAgICBjb25zdCBuYW1lID0gY29uZmlnLm5hbWU7XHJcbiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnIHx8ICFuYW1lKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJiYWQtYXBwLW5hbWVcIiAvKiBBcHBFcnJvci5CQURfQVBQX05BTUUgKi8sIHtcclxuICAgICAgICAgICAgYXBwTmFtZTogU3RyaW5nKG5hbWUpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0gZ2V0RGVmYXVsdEFwcENvbmZpZygpKTtcclxuICAgIGlmICghb3B0aW9ucykge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwibm8tb3B0aW9uc1wiIC8qIEFwcEVycm9yLk5PX09QVElPTlMgKi8pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZXhpc3RpbmdBcHAgPSBfYXBwcy5nZXQobmFtZSk7XHJcbiAgICBpZiAoZXhpc3RpbmdBcHApIHtcclxuICAgICAgICAvLyByZXR1cm4gdGhlIGV4aXN0aW5nIGFwcCBpZiBvcHRpb25zIGFuZCBjb25maWcgZGVlcCBlcXVhbCB0aGUgb25lcyBpbiB0aGUgZXhpc3RpbmcgYXBwLlxyXG4gICAgICAgIGlmIChkZWVwRXF1YWwob3B0aW9ucywgZXhpc3RpbmdBcHAub3B0aW9ucykgJiZcclxuICAgICAgICAgICAgZGVlcEVxdWFsKGNvbmZpZywgZXhpc3RpbmdBcHAuY29uZmlnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdBcHA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImR1cGxpY2F0ZS1hcHBcIiAvKiBBcHBFcnJvci5EVVBMSUNBVEVfQVBQICovLCB7IGFwcE5hbWU6IG5hbWUgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgY29udGFpbmVyID0gbmV3IENvbXBvbmVudENvbnRhaW5lcihuYW1lKTtcclxuICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIF9jb21wb25lbnRzLnZhbHVlcygpKSB7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZENvbXBvbmVudChjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbmV3QXBwID0gbmV3IEZpcmViYXNlQXBwSW1wbChvcHRpb25zLCBjb25maWcsIGNvbnRhaW5lcik7XHJcbiAgICBfYXBwcy5zZXQobmFtZSwgbmV3QXBwKTtcclxuICAgIHJldHVybiBuZXdBcHA7XHJcbn1cclxuZnVuY3Rpb24gaW5pdGlhbGl6ZVNlcnZlckFwcChfb3B0aW9ucywgX3NlcnZlckFwcENvbmZpZykge1xyXG4gICAgaWYgKGlzQnJvd3NlcigpICYmICFpc1dlYldvcmtlcigpKSB7XHJcbiAgICAgICAgLy8gRmlyZWJhc2VTZXJ2ZXJBcHAgaXNuJ3QgZGVzaWduZWQgdG8gYmUgcnVuIGluIGJyb3dzZXJzLlxyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaW52YWxpZC1zZXJ2ZXItYXBwLWVudmlyb25tZW50XCIgLyogQXBwRXJyb3IuSU5WQUxJRF9TRVJWRVJfQVBQX0VOVklST05NRU5UICovKTtcclxuICAgIH1cclxuICAgIGlmIChfc2VydmVyQXBwQ29uZmlnLmF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgX3NlcnZlckFwcENvbmZpZy5hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGxldCBhcHBPcHRpb25zO1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlQXBwKF9vcHRpb25zKSkge1xyXG4gICAgICAgIGFwcE9wdGlvbnMgPSBfb3B0aW9ucy5vcHRpb25zO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgYXBwT3B0aW9ucyA9IF9vcHRpb25zO1xyXG4gICAgfVxyXG4gICAgLy8gQnVpbGQgYW4gYXBwIG5hbWUgYmFzZWQgb24gYSBoYXNoIG9mIHRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMuXHJcbiAgICBjb25zdCBuYW1lT2JqID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBfc2VydmVyQXBwQ29uZmlnKSwgYXBwT3B0aW9ucyk7XHJcbiAgICAvLyBIb3dldmVyLCBEbyBub3QgbWFuZ2xlIHRoZSBuYW1lIGJhc2VkIG9uIHJlbGVhc2VPbkRlcmVmLCBzaW5jZSBpdCB3aWxsIHZhcnkgYmV0d2VlbiB0aGVcclxuICAgIC8vIGNvbnN0cnVjdGlvbiBvZiBGaXJlYmFzZVNlcnZlckFwcCBpbnN0YW5jZXMuIEZvciBleGFtcGxlLCBpZiB0aGUgb2JqZWN0IGlzIHRoZSByZXF1ZXN0IGhlYWRlcnMuXHJcbiAgICBpZiAobmFtZU9iai5yZWxlYXNlT25EZXJlZiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZGVsZXRlIG5hbWVPYmoucmVsZWFzZU9uRGVyZWY7XHJcbiAgICB9XHJcbiAgICBjb25zdCBoYXNoQ29kZSA9IChzKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIFsuLi5zXS5yZWR1Y2UoKGhhc2gsIGMpID0+IChNYXRoLmltdWwoMzEsIGhhc2gpICsgYy5jaGFyQ29kZUF0KDApKSB8IDAsIDApO1xyXG4gICAgfTtcclxuICAgIGlmIChfc2VydmVyQXBwQ29uZmlnLnJlbGVhc2VPbkRlcmVmICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBpZiAodHlwZW9mIEZpbmFsaXphdGlvblJlZ2lzdHJ5ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImZpbmFsaXphdGlvbi1yZWdpc3RyeS1ub3Qtc3VwcG9ydGVkXCIgLyogQXBwRXJyb3IuRklOQUxJWkFUSU9OX1JFR0lTVFJZX05PVF9TVVBQT1JURUQgKi8sIHt9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBuYW1lU3RyaW5nID0gJycgKyBoYXNoQ29kZShKU09OLnN0cmluZ2lmeShuYW1lT2JqKSk7XHJcbiAgICBjb25zdCBleGlzdGluZ0FwcCA9IF9zZXJ2ZXJBcHBzLmdldChuYW1lU3RyaW5nKTtcclxuICAgIGlmIChleGlzdGluZ0FwcCkge1xyXG4gICAgICAgIGV4aXN0aW5nQXBwLmluY1JlZkNvdW50KF9zZXJ2ZXJBcHBDb25maWcucmVsZWFzZU9uRGVyZWYpO1xyXG4gICAgICAgIHJldHVybiBleGlzdGluZ0FwcDtcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IG5ldyBDb21wb25lbnRDb250YWluZXIobmFtZVN0cmluZyk7XHJcbiAgICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBfY29tcG9uZW50cy52YWx1ZXMoKSkge1xyXG4gICAgICAgIGNvbnRhaW5lci5hZGRDb21wb25lbnQoY29tcG9uZW50KTtcclxuICAgIH1cclxuICAgIGNvbnN0IG5ld0FwcCA9IG5ldyBGaXJlYmFzZVNlcnZlckFwcEltcGwoYXBwT3B0aW9ucywgX3NlcnZlckFwcENvbmZpZywgbmFtZVN0cmluZywgY29udGFpbmVyKTtcclxuICAgIF9zZXJ2ZXJBcHBzLnNldChuYW1lU3RyaW5nLCBuZXdBcHApO1xyXG4gICAgcmV0dXJuIG5ld0FwcDtcclxufVxyXG4vKipcclxuICogUmV0cmlldmVzIGEge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IGluc3RhbmNlLlxyXG4gKlxyXG4gKiBXaGVuIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50cywgdGhlIGRlZmF1bHQgYXBwIGlzIHJldHVybmVkLiBXaGVuIGFuIGFwcCBuYW1lXHJcbiAqIGlzIHByb3ZpZGVkLCB0aGUgYXBwIGNvcnJlc3BvbmRpbmcgdG8gdGhhdCBuYW1lIGlzIHJldHVybmVkLlxyXG4gKlxyXG4gKiBBbiBleGNlcHRpb24gaXMgdGhyb3duIGlmIHRoZSBhcHAgYmVpbmcgcmV0cmlldmVkIGhhcyBub3QgeWV0IGJlZW5cclxuICogaW5pdGlhbGl6ZWQuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gUmV0dXJuIHRoZSBkZWZhdWx0IGFwcFxyXG4gKiBjb25zdCBhcHAgPSBnZXRBcHAoKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gUmV0dXJuIGEgbmFtZWQgYXBwXHJcbiAqIGNvbnN0IG90aGVyQXBwID0gZ2V0QXBwKFwib3RoZXJBcHBcIik7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZSAtIE9wdGlvbmFsIG5hbWUgb2YgdGhlIGFwcCB0byByZXR1cm4uIElmIG5vIG5hbWUgaXNcclxuICogICBwcm92aWRlZCwgdGhlIGRlZmF1bHQgaXMgYFwiW0RFRkFVTFRdXCJgLlxyXG4gKlxyXG4gKiBAcmV0dXJucyBUaGUgYXBwIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3ZpZGVkIGFwcCBuYW1lLlxyXG4gKiAgIElmIG5vIGFwcCBuYW1lIGlzIHByb3ZpZGVkLCB0aGUgZGVmYXVsdCBhcHAgaXMgcmV0dXJuZWQuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEFwcChuYW1lID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XHJcbiAgICBjb25zdCBhcHAgPSBfYXBwcy5nZXQobmFtZSk7XHJcbiAgICBpZiAoIWFwcCAmJiBuYW1lID09PSBERUZBVUxUX0VOVFJZX05BTUUgJiYgZ2V0RGVmYXVsdEFwcENvbmZpZygpKSB7XHJcbiAgICAgICAgcmV0dXJuIGluaXRpYWxpemVBcHAoKTtcclxuICAgIH1cclxuICAgIGlmICghYXBwKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJuby1hcHBcIiAvKiBBcHBFcnJvci5OT19BUFAgKi8sIHsgYXBwTmFtZTogbmFtZSB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBhcHA7XHJcbn1cclxuLyoqXHJcbiAqIEEgKHJlYWQtb25seSkgYXJyYXkgb2YgYWxsIGluaXRpYWxpemVkIGFwcHMuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEFwcHMoKSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShfYXBwcy52YWx1ZXMoKSk7XHJcbn1cclxuLyoqXHJcbiAqIFJlbmRlcnMgdGhpcyBhcHAgdW51c2FibGUgYW5kIGZyZWVzIHRoZSByZXNvdXJjZXMgb2YgYWxsIGFzc29jaWF0ZWRcclxuICogc2VydmljZXMuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogZGVsZXRlQXBwKGFwcClcclxuICogICAudGhlbihmdW5jdGlvbigpIHtcclxuICogICAgIGNvbnNvbGUubG9nKFwiQXBwIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5XCIpO1xyXG4gKiAgIH0pXHJcbiAqICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAqICAgICBjb25zb2xlLmxvZyhcIkVycm9yIGRlbGV0aW5nIGFwcDpcIiwgZXJyb3IpO1xyXG4gKiAgIH0pO1xyXG4gKiBgYGBcclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlQXBwKGFwcCkge1xyXG4gICAgbGV0IGNsZWFudXBQcm92aWRlcnMgPSBmYWxzZTtcclxuICAgIGNvbnN0IG5hbWUgPSBhcHAubmFtZTtcclxuICAgIGlmIChfYXBwcy5oYXMobmFtZSkpIHtcclxuICAgICAgICBjbGVhbnVwUHJvdmlkZXJzID0gdHJ1ZTtcclxuICAgICAgICBfYXBwcy5kZWxldGUobmFtZSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChfc2VydmVyQXBwcy5oYXMobmFtZSkpIHtcclxuICAgICAgICBjb25zdCBmaXJlYmFzZVNlcnZlckFwcCA9IGFwcDtcclxuICAgICAgICBpZiAoZmlyZWJhc2VTZXJ2ZXJBcHAuZGVjUmVmQ291bnQoKSA8PSAwKSB7XHJcbiAgICAgICAgICAgIF9zZXJ2ZXJBcHBzLmRlbGV0ZShuYW1lKTtcclxuICAgICAgICAgICAgY2xlYW51cFByb3ZpZGVycyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNsZWFudXBQcm92aWRlcnMpIHtcclxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChhcHAuY29udGFpbmVyXHJcbiAgICAgICAgICAgIC5nZXRQcm92aWRlcnMoKVxyXG4gICAgICAgICAgICAubWFwKHByb3ZpZGVyID0+IHByb3ZpZGVyLmRlbGV0ZSgpKSk7XHJcbiAgICAgICAgYXBwLmlzRGVsZXRlZCA9IHRydWU7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFJlZ2lzdGVycyBhIGxpYnJhcnkncyBuYW1lIGFuZCB2ZXJzaW9uIGZvciBwbGF0Zm9ybSBsb2dnaW5nIHB1cnBvc2VzLlxyXG4gKiBAcGFyYW0gbGlicmFyeSAtIE5hbWUgb2YgMXAgb3IgM3AgbGlicmFyeSAoZS5nLiBmaXJlc3RvcmUsIGFuZ3VsYXJmaXJlKVxyXG4gKiBAcGFyYW0gdmVyc2lvbiAtIEN1cnJlbnQgdmVyc2lvbiBvZiB0aGF0IGxpYnJhcnkuXHJcbiAqIEBwYXJhbSB2YXJpYW50IC0gQnVuZGxlIHZhcmlhbnQsIGUuZy4sIG5vZGUsIHJuLCBldGMuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyVmVyc2lvbihsaWJyYXJ5S2V5T3JOYW1lLCB2ZXJzaW9uLCB2YXJpYW50KSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICAvLyBUT0RPOiBXZSBjYW4gdXNlIHRoaXMgY2hlY2sgdG8gd2hpdGVsaXN0IHN0cmluZ3Mgd2hlbi9pZiB3ZSBzZXQgdXBcclxuICAgIC8vIGEgZ29vZCB3aGl0ZWxpc3Qgc3lzdGVtLlxyXG4gICAgbGV0IGxpYnJhcnkgPSAoX2EgPSBQTEFURk9STV9MT0dfU1RSSU5HW2xpYnJhcnlLZXlPck5hbWVdKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBsaWJyYXJ5S2V5T3JOYW1lO1xyXG4gICAgaWYgKHZhcmlhbnQpIHtcclxuICAgICAgICBsaWJyYXJ5ICs9IGAtJHt2YXJpYW50fWA7XHJcbiAgICB9XHJcbiAgICBjb25zdCBsaWJyYXJ5TWlzbWF0Y2ggPSBsaWJyYXJ5Lm1hdGNoKC9cXHN8XFwvLyk7XHJcbiAgICBjb25zdCB2ZXJzaW9uTWlzbWF0Y2ggPSB2ZXJzaW9uLm1hdGNoKC9cXHN8XFwvLyk7XHJcbiAgICBpZiAobGlicmFyeU1pc21hdGNoIHx8IHZlcnNpb25NaXNtYXRjaCkge1xyXG4gICAgICAgIGNvbnN0IHdhcm5pbmcgPSBbXHJcbiAgICAgICAgICAgIGBVbmFibGUgdG8gcmVnaXN0ZXIgbGlicmFyeSBcIiR7bGlicmFyeX1cIiB3aXRoIHZlcnNpb24gXCIke3ZlcnNpb259XCI6YFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgaWYgKGxpYnJhcnlNaXNtYXRjaCkge1xyXG4gICAgICAgICAgICB3YXJuaW5nLnB1c2goYGxpYnJhcnkgbmFtZSBcIiR7bGlicmFyeX1cIiBjb250YWlucyBpbGxlZ2FsIGNoYXJhY3RlcnMgKHdoaXRlc3BhY2Ugb3IgXCIvXCIpYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChsaWJyYXJ5TWlzbWF0Y2ggJiYgdmVyc2lvbk1pc21hdGNoKSB7XHJcbiAgICAgICAgICAgIHdhcm5pbmcucHVzaCgnYW5kJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2ZXJzaW9uTWlzbWF0Y2gpIHtcclxuICAgICAgICAgICAgd2FybmluZy5wdXNoKGB2ZXJzaW9uIG5hbWUgXCIke3ZlcnNpb259XCIgY29udGFpbnMgaWxsZWdhbCBjaGFyYWN0ZXJzICh3aGl0ZXNwYWNlIG9yIFwiL1wiKWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsb2dnZXIud2Fybih3YXJuaW5nLmpvaW4oJyAnKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoYCR7bGlicmFyeX0tdmVyc2lvbmAsICgpID0+ICh7IGxpYnJhcnksIHZlcnNpb24gfSksIFwiVkVSU0lPTlwiIC8qIENvbXBvbmVudFR5cGUuVkVSU0lPTiAqLykpO1xyXG59XHJcbi8qKlxyXG4gKiBTZXRzIGxvZyBoYW5kbGVyIGZvciBhbGwgRmlyZWJhc2UgU0RLcy5cclxuICogQHBhcmFtIGxvZ0NhbGxiYWNrIC0gQW4gb3B0aW9uYWwgY3VzdG9tIGxvZyBoYW5kbGVyIHRoYXQgZXhlY3V0ZXMgdXNlciBjb2RlIHdoZW5ldmVyXHJcbiAqIHRoZSBGaXJlYmFzZSBTREsgbWFrZXMgYSBsb2dnaW5nIGNhbGwuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIG9uTG9nKGxvZ0NhbGxiYWNrLCBvcHRpb25zKSB7XHJcbiAgICBpZiAobG9nQ2FsbGJhY2sgIT09IG51bGwgJiYgdHlwZW9mIGxvZ0NhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJpbnZhbGlkLWxvZy1hcmd1bWVudFwiIC8qIEFwcEVycm9yLklOVkFMSURfTE9HX0FSR1VNRU5UICovKTtcclxuICAgIH1cclxuICAgIHNldFVzZXJMb2dIYW5kbGVyKGxvZ0NhbGxiYWNrLCBvcHRpb25zKTtcclxufVxyXG4vKipcclxuICogU2V0cyBsb2cgbGV2ZWwgZm9yIGFsbCBGaXJlYmFzZSBTREtzLlxyXG4gKlxyXG4gKiBBbGwgb2YgdGhlIGxvZyB0eXBlcyBhYm92ZSB0aGUgY3VycmVudCBsb2cgbGV2ZWwgYXJlIGNhcHR1cmVkIChpLmUuIGlmXHJcbiAqIHlvdSBzZXQgdGhlIGxvZyBsZXZlbCB0byBgaW5mb2AsIGVycm9ycyBhcmUgbG9nZ2VkLCBidXQgYGRlYnVnYCBhbmRcclxuICogYHZlcmJvc2VgIGxvZ3MgYXJlIG5vdCkuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHNldExvZ0xldmVsKGxvZ0xldmVsKSB7XHJcbiAgICBzZXRMb2dMZXZlbCQxKGxvZ0xldmVsKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBEQl9OQU1FID0gJ2ZpcmViYXNlLWhlYXJ0YmVhdC1kYXRhYmFzZSc7XHJcbmNvbnN0IERCX1ZFUlNJT04gPSAxO1xyXG5jb25zdCBTVE9SRV9OQU1FID0gJ2ZpcmViYXNlLWhlYXJ0YmVhdC1zdG9yZSc7XHJcbmxldCBkYlByb21pc2UgPSBudWxsO1xyXG5mdW5jdGlvbiBnZXREYlByb21pc2UoKSB7XHJcbiAgICBpZiAoIWRiUHJvbWlzZSkge1xyXG4gICAgICAgIGRiUHJvbWlzZSA9IG9wZW5EQihEQl9OQU1FLCBEQl9WRVJTSU9OLCB7XHJcbiAgICAgICAgICAgIHVwZ3JhZGU6IChkYiwgb2xkVmVyc2lvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3QgdXNlICdicmVhaycgaW4gdGhpcyBzd2l0Y2ggc3RhdGVtZW50LCB0aGUgZmFsbC10aHJvdWdoXHJcbiAgICAgICAgICAgICAgICAvLyBiZWhhdmlvciBpcyB3aGF0IHdlIHdhbnQsIGJlY2F1c2UgaWYgdGhlcmUgYXJlIG11bHRpcGxlIHZlcnNpb25zIGJldHdlZW5cclxuICAgICAgICAgICAgICAgIC8vIHRoZSBvbGQgdmVyc2lvbiBhbmQgdGhlIGN1cnJlbnQgdmVyc2lvbiwgd2Ugd2FudCBBTEwgdGhlIG1pZ3JhdGlvbnNcclxuICAgICAgICAgICAgICAgIC8vIHRoYXQgY29ycmVzcG9uZCB0byB0aG9zZSB2ZXJzaW9ucyB0byBydW4sIG5vdCBvbmx5IHRoZSBsYXN0IG9uZS5cclxuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZWZhdWx0LWNhc2VcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAob2xkVmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKFNUT1JFX05BTUUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTYWZhcmkvaU9TIGJyb3dzZXJzIHRocm93IG9jY2FzaW9uYWwgZXhjZXB0aW9ucyBvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGIuY3JlYXRlT2JqZWN0U3RvcmUoKSB0aGF0IG1heSBiZSBhIGJ1Zy4gQXZvaWQgYmxvY2tpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSByZXN0IG9mIHRoZSBhcHAgZnVuY3Rpb25hbGl0eS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkuY2F0Y2goZSA9PiB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaWRiLW9wZW5cIiAvKiBBcHBFcnJvci5JREJfT1BFTiAqLywge1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvck1lc3NhZ2U6IGUubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBkYlByb21pc2U7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gcmVhZEhlYXJ0YmVhdHNGcm9tSW5kZXhlZERCKGFwcCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpO1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdHgub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSkuZ2V0KGNvbXB1dGVLZXkoYXBwKSk7XHJcbiAgICAgICAgLy8gV2UgYWxyZWFkeSBoYXZlIHRoZSB2YWx1ZSBidXQgdHguZG9uZSBjYW4gdGhyb3csXHJcbiAgICAgICAgLy8gc28gd2UgbmVlZCB0byBhd2FpdCBpdCBoZXJlIHRvIGNhdGNoIGVycm9yc1xyXG4gICAgICAgIGF3YWl0IHR4LmRvbmU7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBGaXJlYmFzZUVycm9yKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGUubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBpZGJHZXRFcnJvciA9IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaWRiLWdldFwiIC8qIEFwcEVycm9yLklEQl9HRVQgKi8sIHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbG9nZ2VyLndhcm4oaWRiR2V0RXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKGFwcCwgaGVhcnRiZWF0T2JqZWN0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGJQcm9taXNlKCk7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihTVE9SRV9OQU1FLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0eC5vYmplY3RTdG9yZShTVE9SRV9OQU1FKTtcclxuICAgICAgICBhd2FpdCBvYmplY3RTdG9yZS5wdXQoaGVhcnRiZWF0T2JqZWN0LCBjb21wdXRlS2V5KGFwcCkpO1xyXG4gICAgICAgIGF3YWl0IHR4LmRvbmU7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvcikge1xyXG4gICAgICAgICAgICBsb2dnZXIud2FybihlLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaWRiR2V0RXJyb3IgPSBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImlkYi1zZXRcIiAvKiBBcHBFcnJvci5JREJfV1JJVEUgKi8sIHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbG9nZ2VyLndhcm4oaWRiR2V0RXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGNvbXB1dGVLZXkoYXBwKSB7XHJcbiAgICByZXR1cm4gYCR7YXBwLm5hbWV9ISR7YXBwLm9wdGlvbnMuYXBwSWR9YDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBNQVhfSEVBREVSX0JZVEVTID0gMTAyNDtcclxuLy8gMzAgZGF5c1xyXG5jb25zdCBTVE9SRURfSEVBUlRCRUFUX1JFVEVOVElPTl9NQVhfTUlMTElTID0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwO1xyXG5jbGFzcyBIZWFydGJlYXRTZXJ2aWNlSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbi1tZW1vcnkgY2FjaGUgZm9yIGhlYXJ0YmVhdHMsIHVzZWQgYnkgZ2V0SGVhcnRiZWF0c0hlYWRlcigpIHRvIGdlbmVyYXRlXHJcbiAgICAgICAgICogdGhlIGhlYWRlciBzdHJpbmcuXHJcbiAgICAgICAgICogU3RvcmVzIG9uZSByZWNvcmQgcGVyIGRhdGUuIFRoaXMgd2lsbCBiZSBjb25zb2xpZGF0ZWQgaW50byB0aGUgc3RhbmRhcmRcclxuICAgICAgICAgKiBmb3JtYXQgb2Ygb25lIHJlY29yZCBwZXIgdXNlciBhZ2VudCBzdHJpbmcgYmVmb3JlIGJlaW5nIHNlbnQgYXMgYSBoZWFkZXIuXHJcbiAgICAgICAgICogUG9wdWxhdGVkIGZyb20gaW5kZXhlZERCIHdoZW4gdGhlIGNvbnRyb2xsZXIgaXMgaW5zdGFudGlhdGVkIGFuZCBzaG91bGRcclxuICAgICAgICAgKiBiZSBrZXB0IGluIHN5bmMgd2l0aCBpbmRleGVkREIuXHJcbiAgICAgICAgICogTGVhdmUgcHVibGljIGZvciBlYXNpZXIgdGVzdGluZy5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPSBudWxsO1xyXG4gICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTtcclxuICAgICAgICB0aGlzLl9zdG9yYWdlID0gbmV3IEhlYXJ0YmVhdFN0b3JhZ2VJbXBsKGFwcCk7XHJcbiAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlUHJvbWlzZSA9IHRoaXMuX3N0b3JhZ2UucmVhZCgpLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gcmVzdWx0O1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgdG8gcmVwb3J0IGEgaGVhcnRiZWF0LiBUaGUgZnVuY3Rpb24gd2lsbCBnZW5lcmF0ZVxyXG4gICAgICogYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgb2JqZWN0LCB1cGRhdGUgaGVhcnRiZWF0c0NhY2hlLCBhbmQgcGVyc2lzdCBpdFxyXG4gICAgICogdG8gSW5kZXhlZERCLlxyXG4gICAgICogTm90ZSB0aGF0IHdlIG9ubHkgc3RvcmUgb25lIGhlYXJ0YmVhdCBwZXIgZGF5LiBTbyBpZiBhIGhlYXJ0YmVhdCBmb3IgdG9kYXkgaXNcclxuICAgICAqIGFscmVhZHkgbG9nZ2VkLCBzdWJzZXF1ZW50IGNhbGxzIHRvIHRoaXMgZnVuY3Rpb24gaW4gdGhlIHNhbWUgZGF5IHdpbGwgYmUgaWdub3JlZC5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgdHJpZ2dlckhlYXJ0YmVhdCgpIHtcclxuICAgICAgICB2YXIgX2EsIF9iO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBsYXRmb3JtTG9nZ2VyID0gdGhpcy5jb250YWluZXJcclxuICAgICAgICAgICAgICAgIC5nZXRQcm92aWRlcigncGxhdGZvcm0tbG9nZ2VyJylcclxuICAgICAgICAgICAgICAgIC5nZXRJbW1lZGlhdGUoKTtcclxuICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgXCJGaXJlYmFzZSB1c2VyIGFnZW50XCIgc3RyaW5nIGZyb20gdGhlIHBsYXRmb3JtIGxvZ2dlclxyXG4gICAgICAgICAgICAvLyBzZXJ2aWNlLCBub3QgdGhlIGJyb3dzZXIgdXNlciBhZ2VudC5cclxuICAgICAgICAgICAgY29uc3QgYWdlbnQgPSBwbGF0Zm9ybUxvZ2dlci5nZXRQbGF0Zm9ybUluZm9TdHJpbmcoKTtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZSA9IGdldFVUQ0RhdGVTdHJpbmcoKTtcclxuICAgICAgICAgICAgaWYgKCgoX2EgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5oZWFydGJlYXRzKSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPSBhd2FpdCB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgZmFpbGVkIHRvIGNvbnN0cnVjdCBhIGhlYXJ0YmVhdHMgY2FjaGUsIHRoZW4gcmV0dXJuIGltbWVkaWF0ZWx5LlxyXG4gICAgICAgICAgICAgICAgaWYgKCgoX2IgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5oZWFydGJlYXRzKSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIERvIG5vdCBzdG9yZSBhIGhlYXJ0YmVhdCBpZiBvbmUgaXMgYWxyZWFkeSBzdG9yZWQgZm9yIHRoaXMgZGF5XHJcbiAgICAgICAgICAgIC8vIG9yIGlmIGEgaGVhZGVyIGhhcyBhbHJlYWR5IGJlZW4gc2VudCB0b2RheS5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5sYXN0U2VudEhlYXJ0YmVhdERhdGUgPT09IGRhdGUgfHxcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLnNvbWUoc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiBzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGUgPT09IGRhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUaGVyZSBpcyBubyBlbnRyeSBmb3IgdGhpcyBkYXRlLiBDcmVhdGUgb25lLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMucHVzaCh7IGRhdGUsIGFnZW50IH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSBlbnRyaWVzIG9sZGVyIHRoYW4gMzAgZGF5cy5cclxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPVxyXG4gICAgICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMuZmlsdGVyKHNpbmdsZURhdGVIZWFydGJlYXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGhiVGltZXN0YW1wID0gbmV3IERhdGUoc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlKS52YWx1ZU9mKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm93IC0gaGJUaW1lc3RhbXAgPD0gU1RPUkVEX0hFQVJUQkVBVF9SRVRFTlRJT05fTUFYX01JTExJUztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmFnZS5vdmVyd3JpdGUodGhpcy5faGVhcnRiZWF0c0NhY2hlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLndhcm4oZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgYmFzZTY0IGVuY29kZWQgc3RyaW5nIHdoaWNoIGNhbiBiZSBhdHRhY2hlZCB0byB0aGUgaGVhcnRiZWF0LXNwZWNpZmljIGhlYWRlciBkaXJlY3RseS5cclxuICAgICAqIEl0IGFsc28gY2xlYXJzIGFsbCBoZWFydGJlYXRzIGZyb20gbWVtb3J5IGFzIHdlbGwgYXMgaW4gSW5kZXhlZERCLlxyXG4gICAgICpcclxuICAgICAqIE5PVEU6IENvbnN1bWluZyBwcm9kdWN0IFNES3Mgc2hvdWxkIG5vdCBzZW5kIHRoZSBoZWFkZXIgaWYgdGhpcyBtZXRob2RcclxuICAgICAqIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLlxyXG4gICAgICovXHJcbiAgICBhc3luYyBnZXRIZWFydGJlYXRzSGVhZGVyKCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIElmIGl0J3Mgc3RpbGwgbnVsbCBvciB0aGUgYXJyYXkgaXMgZW1wdHksIHRoZXJlIGlzIG5vIGRhdGEgdG8gc2VuZC5cclxuICAgICAgICAgICAgaWYgKCgoX2EgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5oZWFydGJlYXRzKSA9PSBudWxsIHx8XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpO1xyXG4gICAgICAgICAgICAvLyBFeHRyYWN0IGFzIG1hbnkgaGVhcnRiZWF0cyBmcm9tIHRoZSBjYWNoZSBhcyB3aWxsIGZpdCB1bmRlciB0aGUgc2l6ZSBsaW1pdC5cclxuICAgICAgICAgICAgY29uc3QgeyBoZWFydGJlYXRzVG9TZW5kLCB1bnNlbnRFbnRyaWVzIH0gPSBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcih0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlclN0cmluZyA9IGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KHsgdmVyc2lvbjogMiwgaGVhcnRiZWF0czogaGVhcnRiZWF0c1RvU2VuZCB9KSk7XHJcbiAgICAgICAgICAgIC8vIFN0b3JlIGxhc3Qgc2VudCBkYXRlIHRvIHByZXZlbnQgYW5vdGhlciBiZWluZyBsb2dnZWQvc2VudCBmb3IgdGhlIHNhbWUgZGF5LlxyXG4gICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUubGFzdFNlbnRIZWFydGJlYXREYXRlID0gZGF0ZTtcclxuICAgICAgICAgICAgaWYgKHVuc2VudEVudHJpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gU3RvcmUgYW55IHVuc2VudCBlbnRyaWVzIGlmIHRoZXkgZXhpc3QuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyA9IHVuc2VudEVudHJpZXM7XHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHNlZW1zIG1vcmUgbGlrZWx5IHRoYW4gZW1wdHlpbmcgdGhlIGFycmF5IChiZWxvdykgdG8gbGVhZCB0byBzb21lIG9kZCBzdGF0ZVxyXG4gICAgICAgICAgICAgICAgLy8gc2luY2UgdGhlIGNhY2hlIGlzbid0IGVtcHR5IGFuZCB0aGlzIHdpbGwgYmUgY2FsbGVkIGFnYWluIG9uIHRoZSBuZXh0IHJlcXVlc3QsXHJcbiAgICAgICAgICAgICAgICAvLyBhbmQgaXMgcHJvYmFibHkgc2FmZXN0IGlmIHdlIGF3YWl0IGl0LlxyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3RvcmFnZS5vdmVyd3JpdGUodGhpcy5faGVhcnRiZWF0c0NhY2hlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzID0gW107XHJcbiAgICAgICAgICAgICAgICAvLyBEbyBub3Qgd2FpdCBmb3IgdGhpcywgdG8gcmVkdWNlIGxhdGVuY3kuXHJcbiAgICAgICAgICAgICAgICB2b2lkIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGhlYWRlclN0cmluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLndhcm4oZSk7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0VVRDRGF0ZVN0cmluZygpIHtcclxuICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgIC8vIFJldHVybnMgZGF0ZSBmb3JtYXQgJ1lZWVktTU0tREQnXHJcbiAgICByZXR1cm4gdG9kYXkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgMTApO1xyXG59XHJcbmZ1bmN0aW9uIGV4dHJhY3RIZWFydGJlYXRzRm9ySGVhZGVyKGhlYXJ0YmVhdHNDYWNoZSwgbWF4U2l6ZSA9IE1BWF9IRUFERVJfQllURVMpIHtcclxuICAgIC8vIEhlYXJ0YmVhdHMgZ3JvdXBlZCBieSB1c2VyIGFnZW50IGluIHRoZSBzdGFuZGFyZCBmb3JtYXQgdG8gYmUgc2VudCBpblxyXG4gICAgLy8gdGhlIGhlYWRlci5cclxuICAgIGNvbnN0IGhlYXJ0YmVhdHNUb1NlbmQgPSBbXTtcclxuICAgIC8vIFNpbmdsZSBkYXRlIGZvcm1hdCBoZWFydGJlYXRzIHRoYXQgYXJlIG5vdCBzZW50LlxyXG4gICAgbGV0IHVuc2VudEVudHJpZXMgPSBoZWFydGJlYXRzQ2FjaGUuc2xpY2UoKTtcclxuICAgIGZvciAoY29uc3Qgc2luZ2xlRGF0ZUhlYXJ0YmVhdCBvZiBoZWFydGJlYXRzQ2FjaGUpIHtcclxuICAgICAgICAvLyBMb29rIGZvciBhbiBleGlzdGluZyBlbnRyeSB3aXRoIHRoZSBzYW1lIHVzZXIgYWdlbnQuXHJcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0RW50cnkgPSBoZWFydGJlYXRzVG9TZW5kLmZpbmQoaGIgPT4gaGIuYWdlbnQgPT09IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQpO1xyXG4gICAgICAgIGlmICghaGVhcnRiZWF0RW50cnkpIHtcclxuICAgICAgICAgICAgLy8gSWYgbm8gZW50cnkgZm9yIHRoaXMgdXNlciBhZ2VudCBleGlzdHMsIGNyZWF0ZSBvbmUuXHJcbiAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBhZ2VudDogc2luZ2xlRGF0ZUhlYXJ0YmVhdC5hZ2VudCxcclxuICAgICAgICAgICAgICAgIGRhdGVzOiBbc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGNvdW50Qnl0ZXMoaGVhcnRiZWF0c1RvU2VuZCkgPiBtYXhTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgaGVhZGVyIHdvdWxkIGV4Y2VlZCBtYXggc2l6ZSwgcmVtb3ZlIHRoZSBhZGRlZCBoZWFydGJlYXRcclxuICAgICAgICAgICAgICAgIC8vIGVudHJ5IGFuZCBzdG9wIGFkZGluZyB0byB0aGUgaGVhZGVyLlxyXG4gICAgICAgICAgICAgICAgaGVhcnRiZWF0c1RvU2VuZC5wb3AoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBoZWFydGJlYXRFbnRyeS5kYXRlcy5wdXNoKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSk7XHJcbiAgICAgICAgICAgIC8vIElmIHRoZSBoZWFkZXIgd291bGQgZXhjZWVkIG1heCBzaXplLCByZW1vdmUgdGhlIGFkZGVkIGRhdGVcclxuICAgICAgICAgICAgLy8gYW5kIHN0b3AgYWRkaW5nIHRvIHRoZSBoZWFkZXIuXHJcbiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgaGVhcnRiZWF0RW50cnkuZGF0ZXMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBQb3AgdW5zZW50IGVudHJ5IGZyb20gcXVldWUuIChTa2lwcGVkIGlmIGFkZGluZyB0aGUgZW50cnkgZXhjZWVkZWRcclxuICAgICAgICAvLyBxdW90YSBhbmQgdGhlIGxvb3AgYnJlYWtzIGVhcmx5LilcclxuICAgICAgICB1bnNlbnRFbnRyaWVzID0gdW5zZW50RW50cmllcy5zbGljZSgxKTtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaGVhcnRiZWF0c1RvU2VuZCxcclxuICAgICAgICB1bnNlbnRFbnRyaWVzXHJcbiAgICB9O1xyXG59XHJcbmNsYXNzIEhlYXJ0YmVhdFN0b3JhZ2VJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xyXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xyXG4gICAgICAgIHRoaXMuX2NhblVzZUluZGV4ZWREQlByb21pc2UgPSB0aGlzLnJ1bkluZGV4ZWREQkVudmlyb25tZW50Q2hlY2soKTtcclxuICAgIH1cclxuICAgIGFzeW5jIHJ1bkluZGV4ZWREQkVudmlyb25tZW50Q2hlY2soKSB7XHJcbiAgICAgICAgaWYgKCFpc0luZGV4ZWREQkF2YWlsYWJsZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKClcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRydWUpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4gZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVhZCBhbGwgaGVhcnRiZWF0cy5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgcmVhZCgpIHtcclxuICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xyXG4gICAgICAgIGlmICghY2FuVXNlSW5kZXhlZERCKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGhlYXJ0YmVhdHM6IFtdIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBpZGJIZWFydGJlYXRPYmplY3QgPSBhd2FpdCByZWFkSGVhcnRiZWF0c0Zyb21JbmRleGVkREIodGhpcy5hcHApO1xyXG4gICAgICAgICAgICBpZiAoaWRiSGVhcnRiZWF0T2JqZWN0ID09PSBudWxsIHx8IGlkYkhlYXJ0YmVhdE9iamVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWRiSGVhcnRiZWF0T2JqZWN0LmhlYXJ0YmVhdHMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpZGJIZWFydGJlYXRPYmplY3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geyBoZWFydGJlYXRzOiBbXSB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gb3ZlcndyaXRlIHRoZSBzdG9yYWdlIHdpdGggdGhlIHByb3ZpZGVkIGhlYXJ0YmVhdHNcclxuICAgIGFzeW5jIG92ZXJ3cml0ZShoZWFydGJlYXRzT2JqZWN0KSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIGNvbnN0IGNhblVzZUluZGV4ZWREQiA9IGF3YWl0IHRoaXMuX2NhblVzZUluZGV4ZWREQlByb21pc2U7XHJcbiAgICAgICAgaWYgKCFjYW5Vc2VJbmRleGVkREIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0ID0gYXdhaXQgdGhpcy5yZWFkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQih0aGlzLmFwcCwge1xyXG4gICAgICAgICAgICAgICAgbGFzdFNlbnRIZWFydGJlYXREYXRlOiAoX2EgPSBoZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSxcclxuICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHM6IGhlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0c1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBhZGQgaGVhcnRiZWF0c1xyXG4gICAgYXN5bmMgYWRkKGhlYXJ0YmVhdHNPYmplY3QpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3QgY2FuVXNlSW5kZXhlZERCID0gYXdhaXQgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZTtcclxuICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QgPSBhd2FpdCB0aGlzLnJlYWQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKHRoaXMuYXBwLCB7XHJcbiAgICAgICAgICAgICAgICBsYXN0U2VudEhlYXJ0YmVhdERhdGU6IChfYSA9IGhlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBleGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlLFxyXG4gICAgICAgICAgICAgICAgaGVhcnRiZWF0czogW1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLmV4aXN0aW5nSGVhcnRiZWF0c09iamVjdC5oZWFydGJlYXRzLFxyXG4gICAgICAgICAgICAgICAgICAgIC4uLmhlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0c1xyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIENhbGN1bGF0ZSBieXRlcyBvZiBhIEhlYXJ0YmVhdHNCeVVzZXJBZ2VudCBhcnJheSBhZnRlciBiZWluZyB3cmFwcGVkXHJcbiAqIGluIGEgcGxhdGZvcm0gbG9nZ2luZyBoZWFkZXIgSlNPTiBvYmplY3QsIHN0cmluZ2lmaWVkLCBhbmQgY29udmVydGVkXHJcbiAqIHRvIGJhc2UgNjQuXHJcbiAqL1xyXG5mdW5jdGlvbiBjb3VudEJ5dGVzKGhlYXJ0YmVhdHNDYWNoZSkge1xyXG4gICAgLy8gYmFzZTY0IGhhcyBhIHJlc3RyaWN0ZWQgc2V0IG9mIGNoYXJhY3RlcnMsIGFsbCBvZiB3aGljaCBzaG91bGQgYmUgMSBieXRlLlxyXG4gICAgcmV0dXJuIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKFxyXG4gICAgLy8gaGVhcnRiZWF0c0NhY2hlIHdyYXBwZXIgcHJvcGVydGllc1xyXG4gICAgSlNPTi5zdHJpbmdpZnkoeyB2ZXJzaW9uOiAyLCBoZWFydGJlYXRzOiBoZWFydGJlYXRzQ2FjaGUgfSkpLmxlbmd0aDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiByZWdpc3RlckNvcmVDb21wb25lbnRzKHZhcmlhbnQpIHtcclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdwbGF0Zm9ybS1sb2dnZXInLCBjb250YWluZXIgPT4gbmV3IFBsYXRmb3JtTG9nZ2VyU2VydmljZUltcGwoY29udGFpbmVyKSwgXCJQUklWQVRFXCIgLyogQ29tcG9uZW50VHlwZS5QUklWQVRFICovKSk7XHJcbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgnaGVhcnRiZWF0JywgY29udGFpbmVyID0+IG5ldyBIZWFydGJlYXRTZXJ2aWNlSW1wbChjb250YWluZXIpLCBcIlBSSVZBVEVcIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pKTtcclxuICAgIC8vIFJlZ2lzdGVyIGBhcHBgIHBhY2thZ2UuXHJcbiAgICByZWdpc3RlclZlcnNpb24obmFtZSRxLCB2ZXJzaW9uJDEsIHZhcmlhbnQpO1xyXG4gICAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtNSwgZXNtMjAxNywgY2pzNSwgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb25cclxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lJHEsIHZlcnNpb24kMSwgJ2VzbTIwMTcnKTtcclxuICAgIC8vIFJlZ2lzdGVyIHBsYXRmb3JtIFNESyBpZGVudGlmaWVyIChubyB2ZXJzaW9uKS5cclxuICAgIHJlZ2lzdGVyVmVyc2lvbignZmlyZS1qcycsICcnKTtcclxufVxuXG4vKipcclxuICogRmlyZWJhc2UgQXBwXHJcbiAqXHJcbiAqIEByZW1hcmtzIFRoaXMgcGFja2FnZSBjb29yZGluYXRlcyB0aGUgY29tbXVuaWNhdGlvbiBiZXR3ZWVuIHRoZSBkaWZmZXJlbnQgRmlyZWJhc2UgY29tcG9uZW50c1xyXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cclxuICovXHJcbnJlZ2lzdGVyQ29yZUNvbXBvbmVudHMoJycpO1xuXG5leHBvcnQgeyBTREtfVkVSU0lPTiwgREVGQVVMVF9FTlRSWV9OQU1FIGFzIF9ERUZBVUxUX0VOVFJZX05BTUUsIF9hZGRDb21wb25lbnQsIF9hZGRPck92ZXJ3cml0ZUNvbXBvbmVudCwgX2FwcHMsIF9jbGVhckNvbXBvbmVudHMsIF9jb21wb25lbnRzLCBfZ2V0UHJvdmlkZXIsIF9pc0ZpcmViYXNlQXBwLCBfaXNGaXJlYmFzZVNlcnZlckFwcCwgX3JlZ2lzdGVyQ29tcG9uZW50LCBfcmVtb3ZlU2VydmljZUluc3RhbmNlLCBfc2VydmVyQXBwcywgZGVsZXRlQXBwLCBnZXRBcHAsIGdldEFwcHMsIGluaXRpYWxpemVBcHAsIGluaXRpYWxpemVTZXJ2ZXJBcHAsIG9uTG9nLCByZWdpc3RlclZlcnNpb24sIHNldExvZ0xldmVsIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgcmVnaXN0ZXJWZXJzaW9uIH0gZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5leHBvcnQgKiBmcm9tICdAZmlyZWJhc2UvYXBwJztcblxudmFyIG5hbWUgPSBcImZpcmViYXNlXCI7XG52YXIgdmVyc2lvbiA9IFwiMTAuMTQuMVwiO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5yZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2FwcCcpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtLmpzLm1hcFxuIiwiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXG5cblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcbkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCxcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1Jcbk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1JcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UsIFN1cHByZXNzZWRFcnJvciwgU3ltYm9sLCBJdGVyYXRvciAqL1xuXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcbiAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcbiAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcbiAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcbiAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn1cblxuZXhwb3J0IHZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uKCkge1xuICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xuICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHQ7XG4gIH1cbiAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xuICB2YXIgdCA9IHt9O1xuICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcbiAgICAgIHRbcF0gPSBzW3BdO1xuICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXG4gICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxuICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcbiAgICAgIH1cbiAgcmV0dXJuIHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XG4gIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fZXNEZWNvcmF0ZShjdG9yLCBkZXNjcmlwdG9ySW4sIGRlY29yYXRvcnMsIGNvbnRleHRJbiwgaW5pdGlhbGl6ZXJzLCBleHRyYUluaXRpYWxpemVycykge1xuICBmdW5jdGlvbiBhY2NlcHQoZikgeyBpZiAoZiAhPT0gdm9pZCAwICYmIHR5cGVvZiBmICE9PSBcImZ1bmN0aW9uXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJGdW5jdGlvbiBleHBlY3RlZFwiKTsgcmV0dXJuIGY7IH1cbiAgdmFyIGtpbmQgPSBjb250ZXh0SW4ua2luZCwga2V5ID0ga2luZCA9PT0gXCJnZXR0ZXJcIiA/IFwiZ2V0XCIgOiBraW5kID09PSBcInNldHRlclwiID8gXCJzZXRcIiA6IFwidmFsdWVcIjtcbiAgdmFyIHRhcmdldCA9ICFkZXNjcmlwdG9ySW4gJiYgY3RvciA/IGNvbnRleHRJbltcInN0YXRpY1wiXSA/IGN0b3IgOiBjdG9yLnByb3RvdHlwZSA6IG51bGw7XG4gIHZhciBkZXNjcmlwdG9yID0gZGVzY3JpcHRvckluIHx8ICh0YXJnZXQgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwgY29udGV4dEluLm5hbWUpIDoge30pO1xuICB2YXIgXywgZG9uZSA9IGZhbHNlO1xuICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgdmFyIGNvbnRleHQgPSB7fTtcbiAgICAgIGZvciAodmFyIHAgaW4gY29udGV4dEluKSBjb250ZXh0W3BdID0gcCA9PT0gXCJhY2Nlc3NcIiA/IHt9IDogY29udGV4dEluW3BdO1xuICAgICAgZm9yICh2YXIgcCBpbiBjb250ZXh0SW4uYWNjZXNzKSBjb250ZXh0LmFjY2Vzc1twXSA9IGNvbnRleHRJbi5hY2Nlc3NbcF07XG4gICAgICBjb250ZXh0LmFkZEluaXRpYWxpemVyID0gZnVuY3Rpb24gKGYpIHsgaWYgKGRvbmUpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgYWRkIGluaXRpYWxpemVycyBhZnRlciBkZWNvcmF0aW9uIGhhcyBjb21wbGV0ZWRcIik7IGV4dHJhSW5pdGlhbGl6ZXJzLnB1c2goYWNjZXB0KGYgfHwgbnVsbCkpOyB9O1xuICAgICAgdmFyIHJlc3VsdCA9ICgwLCBkZWNvcmF0b3JzW2ldKShraW5kID09PSBcImFjY2Vzc29yXCIgPyB7IGdldDogZGVzY3JpcHRvci5nZXQsIHNldDogZGVzY3JpcHRvci5zZXQgfSA6IGRlc2NyaXB0b3Jba2V5XSwgY29udGV4dCk7XG4gICAgICBpZiAoa2luZCA9PT0gXCJhY2Nlc3NvclwiKSB7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSBjb250aW51ZTtcbiAgICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsIHx8IHR5cGVvZiByZXN1bHQgIT09IFwib2JqZWN0XCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJPYmplY3QgZXhwZWN0ZWRcIik7XG4gICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmdldCkpIGRlc2NyaXB0b3IuZ2V0ID0gXztcbiAgICAgICAgICBpZiAoXyA9IGFjY2VwdChyZXN1bHQuc2V0KSkgZGVzY3JpcHRvci5zZXQgPSBfO1xuICAgICAgICAgIGlmIChfID0gYWNjZXB0KHJlc3VsdC5pbml0KSkgaW5pdGlhbGl6ZXJzLnVuc2hpZnQoXyk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChfID0gYWNjZXB0KHJlc3VsdCkpIHtcbiAgICAgICAgICBpZiAoa2luZCA9PT0gXCJmaWVsZFwiKSBpbml0aWFsaXplcnMudW5zaGlmdChfKTtcbiAgICAgICAgICBlbHNlIGRlc2NyaXB0b3Jba2V5XSA9IF87XG4gICAgICB9XG4gIH1cbiAgaWYgKHRhcmdldCkgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgY29udGV4dEluLm5hbWUsIGRlc2NyaXB0b3IpO1xuICBkb25lID0gdHJ1ZTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3J1bkluaXRpYWxpemVycyh0aGlzQXJnLCBpbml0aWFsaXplcnMsIHZhbHVlKSB7XG4gIHZhciB1c2VWYWx1ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGluaXRpYWxpemVycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFsdWUgPSB1c2VWYWx1ZSA/IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcsIHZhbHVlKSA6IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcpO1xuICB9XG4gIHJldHVybiB1c2VWYWx1ZSA/IHZhbHVlIDogdm9pZCAwO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIF9fcHJvcEtleSh4KSB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJzeW1ib2xcIiA/IHggOiBcIlwiLmNvbmNhdCh4KTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3NldEZ1bmN0aW9uTmFtZShmLCBuYW1lLCBwcmVmaXgpIHtcbiAgaWYgKHR5cGVvZiBuYW1lID09PSBcInN5bWJvbFwiKSBuYW1lID0gbmFtZS5kZXNjcmlwdGlvbiA/IFwiW1wiLmNvbmNhdChuYW1lLmRlc2NyaXB0aW9uLCBcIl1cIikgOiBcIlwiO1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGYsIFwibmFtZVwiLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHByZWZpeCA/IFwiXCIuY29uY2F0KHByZWZpeCwgXCIgXCIsIG5hbWUpIDogbmFtZSB9KTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XG4gIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XG4gIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGcgPSBPYmplY3QuY3JlYXRlKCh0eXBlb2YgSXRlcmF0b3IgPT09IFwiZnVuY3Rpb25cIiA/IEl0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpO1xuICByZXR1cm4gZy5uZXh0ID0gdmVyYigwKSwgZ1tcInRocm93XCJdID0gdmVyYigxKSwgZ1tcInJldHVyblwiXSA9IHZlcmIoMiksIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gIGZ1bmN0aW9uIHN0ZXAob3ApIHtcbiAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcbiAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7XG4gICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcbiAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XG4gICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XG4gICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxuICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XG4gICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcbiAgfVxufVxuXG5leHBvcnQgdmFyIF9fY3JlYXRlQmluZGluZyA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG0sIGspO1xuICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkge1xuICAgICAgZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfTtcbiAgfVxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgb1trMl0gPSBtW2tdO1xufSk7XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2V4cG9ydFN0YXIobSwgbykge1xuICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSBcImRlZmF1bHRcIiAmJiAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIHApKSBfX2NyZWF0ZUJpbmRpbmcobywgbSwgcCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XG4gIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XG4gIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pO1xuICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09IFwibnVtYmVyXCIpIHJldHVybiB7XG4gICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcbiAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XG4gICAgICB9XG4gIH07XG4gIHRocm93IG5ldyBUeXBlRXJyb3IocyA/IFwiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS5cIiA6IFwiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XG4gIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcbiAgaWYgKCFtKSByZXR1cm4gbztcbiAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XG4gIHRyeSB7XG4gICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcbiAgfVxuICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cbiAgZmluYWxseSB7XG4gICAgICB0cnkge1xuICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xuICAgICAgfVxuICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XG4gIH1cbiAgcmV0dXJuIGFyO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgKi9cbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcbiAgZm9yICh2YXIgYXIgPSBbXSwgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspXG4gICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XG4gIHJldHVybiBhcjtcbn1cblxuLyoqIEBkZXByZWNhdGVkICovXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheXMoKSB7XG4gIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICByW2tdID0gYVtqXTtcbiAgcmV0dXJuIHI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5KHRvLCBmcm9tLCBwYWNrKSB7XG4gIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XG4gICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XG4gICAgICAgICAgaWYgKCFhcikgYXIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tLCAwLCBpKTtcbiAgICAgICAgICBhcltpXSA9IGZyb21baV07XG4gICAgICB9XG4gIH1cbiAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0KHYpIHtcbiAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xuICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xuICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xuICByZXR1cm4gaSA9IE9iamVjdC5jcmVhdGUoKHR5cGVvZiBBc3luY0l0ZXJhdG9yID09PSBcImZ1bmN0aW9uXCIgPyBBc3luY0l0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpLCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIsIGF3YWl0UmV0dXJuKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xuICBmdW5jdGlvbiBhd2FpdFJldHVybihmKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZiwgcmVqZWN0KTsgfTsgfVxuICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaWYgKGdbbl0pIHsgaVtuXSA9IGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoYSwgYikgeyBxLnB1c2goW24sIHYsIGEsIGJdKSA+IDEgfHwgcmVzdW1lKG4sIHYpOyB9KTsgfTsgaWYgKGYpIGlbbl0gPSBmKGlbbl0pOyB9IH1cbiAgZnVuY3Rpb24gcmVzdW1lKG4sIHYpIHsgdHJ5IHsgc3RlcChnW25dKHYpKTsgfSBjYXRjaCAoZSkgeyBzZXR0bGUocVswXVszXSwgZSk7IH0gfVxuICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cbiAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxuICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKFwidGhyb3dcIiwgdmFsdWUpOyB9XG4gIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNEZWxlZ2F0b3Iobykge1xuICB2YXIgaSwgcDtcbiAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiLCBmdW5jdGlvbiAoZSkgeyB0aHJvdyBlOyB9KSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcbiAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlbbl0gPSBvW25dID8gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIChwID0gIXApID8geyB2YWx1ZTogX19hd2FpdChvW25dKHYpKSwgZG9uZTogZmFsc2UgfSA6IGYgPyBmKHYpIDogdjsgfSA6IGY7IH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNWYWx1ZXMobykge1xuICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xuICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xuICByZXR1cm4gbSA/IG0uY2FsbChvKSA6IChvID0gdHlwZW9mIF9fdmFsdWVzID09PSBcImZ1bmN0aW9uXCIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7XG4gIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cbiAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcbiAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoY29va2VkLCBcInJhd1wiLCB7IHZhbHVlOiByYXcgfSk7IH0gZWxzZSB7IGNvb2tlZC5yYXcgPSByYXc7IH1cbiAgcmV0dXJuIGNvb2tlZDtcbn07XG5cbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gIG9bXCJkZWZhdWx0XCJdID0gdjtcbn07XG5cbnZhciBvd25LZXlzID0gZnVuY3Rpb24obykge1xuICBvd25LZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24gKG8pIHtcbiAgICB2YXIgYXIgPSBbXTtcbiAgICBmb3IgKHZhciBrIGluIG8pIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgaykpIGFyW2FyLmxlbmd0aF0gPSBrO1xuICAgIHJldHVybiBhcjtcbiAgfTtcbiAgcmV0dXJuIG93bktleXMobyk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xuICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICB2YXIgcmVzdWx0ID0ge307XG4gIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayA9IG93bktleXMobW9kKSwgaSA9IDA7IGkgPCBrLmxlbmd0aDsgaSsrKSBpZiAoa1tpXSAhPT0gXCJkZWZhdWx0XCIpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwga1tpXSk7XG4gIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XG4gIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgZGVmYXVsdDogbW9kIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHJlY2VpdmVyLCBzdGF0ZSwga2luZCwgZikge1xuICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBnZXR0ZXJcIik7XG4gIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xuICByZXR1cm4ga2luZCA9PT0gXCJtXCIgPyBmIDoga2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIpIDogZiA/IGYudmFsdWUgOiBzdGF0ZS5nZXQocmVjZWl2ZXIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7XG4gIGlmIChraW5kID09PSBcIm1cIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgbWV0aG9kIGlzIG5vdCB3cml0YWJsZVwiKTtcbiAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xuICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCB3cml0ZSBwcml2YXRlIG1lbWJlciB0byBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xuICByZXR1cm4gKGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyLCB2YWx1ZSkgOiBmID8gZi52YWx1ZSA9IHZhbHVlIDogc3RhdGUuc2V0KHJlY2VpdmVyLCB2YWx1ZSkpLCB2YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRJbihzdGF0ZSwgcmVjZWl2ZXIpIHtcbiAgaWYgKHJlY2VpdmVyID09PSBudWxsIHx8ICh0eXBlb2YgcmVjZWl2ZXIgIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHJlY2VpdmVyICE9PSBcImZ1bmN0aW9uXCIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHVzZSAnaW4nIG9wZXJhdG9yIG9uIG5vbi1vYmplY3RcIik7XG4gIHJldHVybiB0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyID09PSBzdGF0ZSA6IHN0YXRlLmhhcyhyZWNlaXZlcik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2FkZERpc3Bvc2FibGVSZXNvdXJjZShlbnYsIHZhbHVlLCBhc3luYykge1xuICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHZvaWQgMCkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHZhbHVlICE9PSBcImZ1bmN0aW9uXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJPYmplY3QgZXhwZWN0ZWQuXCIpO1xuICAgIHZhciBkaXNwb3NlLCBpbm5lcjtcbiAgICBpZiAoYXN5bmMpIHtcbiAgICAgIGlmICghU3ltYm9sLmFzeW5jRGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0Rpc3Bvc2UgaXMgbm90IGRlZmluZWQuXCIpO1xuICAgICAgZGlzcG9zZSA9IHZhbHVlW1N5bWJvbC5hc3luY0Rpc3Bvc2VdO1xuICAgIH1cbiAgICBpZiAoZGlzcG9zZSA9PT0gdm9pZCAwKSB7XG4gICAgICBpZiAoIVN5bWJvbC5kaXNwb3NlKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmRpc3Bvc2UgaXMgbm90IGRlZmluZWQuXCIpO1xuICAgICAgZGlzcG9zZSA9IHZhbHVlW1N5bWJvbC5kaXNwb3NlXTtcbiAgICAgIGlmIChhc3luYykgaW5uZXIgPSBkaXNwb3NlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGRpc3Bvc2UgIT09IFwiZnVuY3Rpb25cIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIk9iamVjdCBub3QgZGlzcG9zYWJsZS5cIik7XG4gICAgaWYgKGlubmVyKSBkaXNwb3NlID0gZnVuY3Rpb24oKSB7IHRyeSB7IGlubmVyLmNhbGwodGhpcyk7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpOyB9IH07XG4gICAgZW52LnN0YWNrLnB1c2goeyB2YWx1ZTogdmFsdWUsIGRpc3Bvc2U6IGRpc3Bvc2UsIGFzeW5jOiBhc3luYyB9KTtcbiAgfVxuICBlbHNlIGlmIChhc3luYykge1xuICAgIGVudi5zdGFjay5wdXNoKHsgYXN5bmM6IHRydWUgfSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG52YXIgX1N1cHByZXNzZWRFcnJvciA9IHR5cGVvZiBTdXBwcmVzc2VkRXJyb3IgPT09IFwiZnVuY3Rpb25cIiA/IFN1cHByZXNzZWRFcnJvciA6IGZ1bmN0aW9uIChlcnJvciwgc3VwcHJlc3NlZCwgbWVzc2FnZSkge1xuICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgcmV0dXJuIGUubmFtZSA9IFwiU3VwcHJlc3NlZEVycm9yXCIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2Rpc3Bvc2VSZXNvdXJjZXMoZW52KSB7XG4gIGZ1bmN0aW9uIGZhaWwoZSkge1xuICAgIGVudi5lcnJvciA9IGVudi5oYXNFcnJvciA/IG5ldyBfU3VwcHJlc3NlZEVycm9yKGUsIGVudi5lcnJvciwgXCJBbiBlcnJvciB3YXMgc3VwcHJlc3NlZCBkdXJpbmcgZGlzcG9zYWwuXCIpIDogZTtcbiAgICBlbnYuaGFzRXJyb3IgPSB0cnVlO1xuICB9XG4gIHZhciByLCBzID0gMDtcbiAgZnVuY3Rpb24gbmV4dCgpIHtcbiAgICB3aGlsZSAociA9IGVudi5zdGFjay5wb3AoKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCFyLmFzeW5jICYmIHMgPT09IDEpIHJldHVybiBzID0gMCwgZW52LnN0YWNrLnB1c2gociksIFByb21pc2UucmVzb2x2ZSgpLnRoZW4obmV4dCk7XG4gICAgICAgIGlmIChyLmRpc3Bvc2UpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gci5kaXNwb3NlLmNhbGwoci52YWx1ZSk7XG4gICAgICAgICAgaWYgKHIuYXN5bmMpIHJldHVybiBzIHw9IDIsIFByb21pc2UucmVzb2x2ZShyZXN1bHQpLnRoZW4obmV4dCwgZnVuY3Rpb24oZSkgeyBmYWlsKGUpOyByZXR1cm4gbmV4dCgpOyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHMgfD0gMTtcbiAgICAgIH1cbiAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGZhaWwoZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzID09PSAxKSByZXR1cm4gZW52Lmhhc0Vycm9yID8gUHJvbWlzZS5yZWplY3QoZW52LmVycm9yKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgIGlmIChlbnYuaGFzRXJyb3IpIHRocm93IGVudi5lcnJvcjtcbiAgfVxuICByZXR1cm4gbmV4dCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19yZXdyaXRlUmVsYXRpdmVJbXBvcnRFeHRlbnNpb24ocGF0aCwgcHJlc2VydmVKc3gpIHtcbiAgaWYgKHR5cGVvZiBwYXRoID09PSBcInN0cmluZ1wiICYmIC9eXFwuXFwuP1xcLy8udGVzdChwYXRoKSkge1xuICAgICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXFwuKHRzeCkkfCgoPzpcXC5kKT8pKCg/OlxcLlteLi9dKz8pPylcXC4oW2NtXT8pdHMkL2ksIGZ1bmN0aW9uIChtLCB0c3gsIGQsIGV4dCwgY20pIHtcbiAgICAgICAgICByZXR1cm4gdHN4ID8gcHJlc2VydmVKc3ggPyBcIi5qc3hcIiA6IFwiLmpzXCIgOiBkICYmICghZXh0IHx8ICFjbSkgPyBtIDogKGQgKyBleHQgKyBcIi5cIiArIGNtLnRvTG93ZXJDYXNlKCkgKyBcImpzXCIpO1xuICAgICAgfSk7XG4gIH1cbiAgcmV0dXJuIHBhdGg7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgX19leHRlbmRzLFxuICBfX2Fzc2lnbixcbiAgX19yZXN0LFxuICBfX2RlY29yYXRlLFxuICBfX3BhcmFtLFxuICBfX2VzRGVjb3JhdGUsXG4gIF9fcnVuSW5pdGlhbGl6ZXJzLFxuICBfX3Byb3BLZXksXG4gIF9fc2V0RnVuY3Rpb25OYW1lLFxuICBfX21ldGFkYXRhLFxuICBfX2F3YWl0ZXIsXG4gIF9fZ2VuZXJhdG9yLFxuICBfX2NyZWF0ZUJpbmRpbmcsXG4gIF9fZXhwb3J0U3RhcixcbiAgX192YWx1ZXMsXG4gIF9fcmVhZCxcbiAgX19zcHJlYWQsXG4gIF9fc3ByZWFkQXJyYXlzLFxuICBfX3NwcmVhZEFycmF5LFxuICBfX2F3YWl0LFxuICBfX2FzeW5jR2VuZXJhdG9yLFxuICBfX2FzeW5jRGVsZWdhdG9yLFxuICBfX2FzeW5jVmFsdWVzLFxuICBfX21ha2VUZW1wbGF0ZU9iamVjdCxcbiAgX19pbXBvcnRTdGFyLFxuICBfX2ltcG9ydERlZmF1bHQsXG4gIF9fY2xhc3NQcml2YXRlRmllbGRHZXQsXG4gIF9fY2xhc3NQcml2YXRlRmllbGRTZXQsXG4gIF9fY2xhc3NQcml2YXRlRmllbGRJbixcbiAgX19hZGREaXNwb3NhYmxlUmVzb3VyY2UsXG4gIF9fZGlzcG9zZVJlc291cmNlcyxcbiAgX19yZXdyaXRlUmVsYXRpdmVJbXBvcnRFeHRlbnNpb24sXG59O1xuIiwiaW1wb3J0IHsgU0RLX1ZFUlNJT04sIF9pc0ZpcmViYXNlU2VydmVyQXBwLCBfZ2V0UHJvdmlkZXIsIF9yZWdpc3RlckNvbXBvbmVudCwgcmVnaXN0ZXJWZXJzaW9uLCBnZXRBcHAgfSBmcm9tICdAZmlyZWJhc2UvYXBwJztcbmltcG9ydCB7IEVycm9yRmFjdG9yeSwgaXNCcm93c2VyRXh0ZW5zaW9uLCBpc01vYmlsZUNvcmRvdmEsIGlzUmVhY3ROYXRpdmUsIEZpcmViYXNlRXJyb3IsIHF1ZXJ5c3RyaW5nLCBpc0Nsb3VkZmxhcmVXb3JrZXIsIGdldE1vZHVsYXJJbnN0YW5jZSwgYmFzZTY0RGVjb2RlLCBnZXRVQSwgaXNJRSwgY3JlYXRlU3Vic2NyaWJlLCBkZWVwRXF1YWwsIHF1ZXJ5c3RyaW5nRGVjb2RlLCBleHRyYWN0UXVlcnlzdHJpbmcsIGlzRW1wdHksIGdldEV4cGVyaW1lbnRhbFNldHRpbmcsIGdldERlZmF1bHRFbXVsYXRvckhvc3QgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBMb2dnZXIsIExvZ0xldmVsIH0gZnJvbSAnQGZpcmViYXNlL2xvZ2dlcic7XG5pbXBvcnQgeyBfX3Jlc3QgfSBmcm9tICd0c2xpYic7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEFuIGVudW0gb2YgZmFjdG9ycyB0aGF0IG1heSBiZSB1c2VkIGZvciBtdWx0aWZhY3RvciBhdXRoZW50aWNhdGlvbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgRmFjdG9ySWQgPSB7XHJcbiAgICAvKiogUGhvbmUgYXMgc2Vjb25kIGZhY3RvciAqL1xyXG4gICAgUEhPTkU6ICdwaG9uZScsXHJcbiAgICBUT1RQOiAndG90cCdcclxufTtcclxuLyoqXHJcbiAqIEVudW1lcmF0aW9uIG9mIHN1cHBvcnRlZCBwcm92aWRlcnMuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IFByb3ZpZGVySWQgPSB7XHJcbiAgICAvKiogRmFjZWJvb2sgcHJvdmlkZXIgSUQgKi9cclxuICAgIEZBQ0VCT09LOiAnZmFjZWJvb2suY29tJyxcclxuICAgIC8qKiBHaXRIdWIgcHJvdmlkZXIgSUQgKi9cclxuICAgIEdJVEhVQjogJ2dpdGh1Yi5jb20nLFxyXG4gICAgLyoqIEdvb2dsZSBwcm92aWRlciBJRCAqL1xyXG4gICAgR09PR0xFOiAnZ29vZ2xlLmNvbScsXHJcbiAgICAvKiogUGFzc3dvcmQgcHJvdmlkZXIgKi9cclxuICAgIFBBU1NXT1JEOiAncGFzc3dvcmQnLFxyXG4gICAgLyoqIFBob25lIHByb3ZpZGVyICovXHJcbiAgICBQSE9ORTogJ3Bob25lJyxcclxuICAgIC8qKiBUd2l0dGVyIHByb3ZpZGVyIElEICovXHJcbiAgICBUV0lUVEVSOiAndHdpdHRlci5jb20nXHJcbn07XHJcbi8qKlxyXG4gKiBFbnVtZXJhdGlvbiBvZiBzdXBwb3J0ZWQgc2lnbi1pbiBtZXRob2RzLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBTaWduSW5NZXRob2QgPSB7XHJcbiAgICAvKiogRW1haWwgbGluayBzaWduIGluIG1ldGhvZCAqL1xyXG4gICAgRU1BSUxfTElOSzogJ2VtYWlsTGluaycsXHJcbiAgICAvKiogRW1haWwvcGFzc3dvcmQgc2lnbiBpbiBtZXRob2QgKi9cclxuICAgIEVNQUlMX1BBU1NXT1JEOiAncGFzc3dvcmQnLFxyXG4gICAgLyoqIEZhY2Vib29rIHNpZ24gaW4gbWV0aG9kICovXHJcbiAgICBGQUNFQk9PSzogJ2ZhY2Vib29rLmNvbScsXHJcbiAgICAvKiogR2l0SHViIHNpZ24gaW4gbWV0aG9kICovXHJcbiAgICBHSVRIVUI6ICdnaXRodWIuY29tJyxcclxuICAgIC8qKiBHb29nbGUgc2lnbiBpbiBtZXRob2QgKi9cclxuICAgIEdPT0dMRTogJ2dvb2dsZS5jb20nLFxyXG4gICAgLyoqIFBob25lIHNpZ24gaW4gbWV0aG9kICovXHJcbiAgICBQSE9ORTogJ3Bob25lJyxcclxuICAgIC8qKiBUd2l0dGVyIHNpZ24gaW4gbWV0aG9kICovXHJcbiAgICBUV0lUVEVSOiAndHdpdHRlci5jb20nXHJcbn07XHJcbi8qKlxyXG4gKiBFbnVtZXJhdGlvbiBvZiBzdXBwb3J0ZWQgb3BlcmF0aW9uIHR5cGVzLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBPcGVyYXRpb25UeXBlID0ge1xyXG4gICAgLyoqIE9wZXJhdGlvbiBpbnZvbHZpbmcgbGlua2luZyBhbiBhZGRpdGlvbmFsIHByb3ZpZGVyIHRvIGFuIGFscmVhZHkgc2lnbmVkLWluIHVzZXIuICovXHJcbiAgICBMSU5LOiAnbGluaycsXHJcbiAgICAvKiogT3BlcmF0aW9uIGludm9sdmluZyB1c2luZyBhIHByb3ZpZGVyIHRvIHJlYXV0aGVudGljYXRlIGFuIGFscmVhZHkgc2lnbmVkLWluIHVzZXIuICovXHJcbiAgICBSRUFVVEhFTlRJQ0FURTogJ3JlYXV0aGVudGljYXRlJyxcclxuICAgIC8qKiBPcGVyYXRpb24gaW52b2x2aW5nIHNpZ25pbmcgaW4gYSB1c2VyLiAqL1xyXG4gICAgU0lHTl9JTjogJ3NpZ25JbidcclxufTtcclxuLyoqXHJcbiAqIEFuIGVudW1lcmF0aW9uIG9mIHRoZSBwb3NzaWJsZSBlbWFpbCBhY3Rpb24gdHlwZXMuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IEFjdGlvbkNvZGVPcGVyYXRpb24gPSB7XHJcbiAgICAvKiogVGhlIGVtYWlsIGxpbmsgc2lnbi1pbiBhY3Rpb24uICovXHJcbiAgICBFTUFJTF9TSUdOSU46ICdFTUFJTF9TSUdOSU4nLFxyXG4gICAgLyoqIFRoZSBwYXNzd29yZCByZXNldCBhY3Rpb24uICovXHJcbiAgICBQQVNTV09SRF9SRVNFVDogJ1BBU1NXT1JEX1JFU0VUJyxcclxuICAgIC8qKiBUaGUgZW1haWwgcmV2b2NhdGlvbiBhY3Rpb24uICovXHJcbiAgICBSRUNPVkVSX0VNQUlMOiAnUkVDT1ZFUl9FTUFJTCcsXHJcbiAgICAvKiogVGhlIHJldmVydCBzZWNvbmQgZmFjdG9yIGFkZGl0aW9uIGVtYWlsIGFjdGlvbi4gKi9cclxuICAgIFJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OOiAnUkVWRVJUX1NFQ09ORF9GQUNUT1JfQURESVRJT04nLFxyXG4gICAgLyoqIFRoZSByZXZlcnQgc2Vjb25kIGZhY3RvciBhZGRpdGlvbiBlbWFpbCBhY3Rpb24uICovXHJcbiAgICBWRVJJRllfQU5EX0NIQU5HRV9FTUFJTDogJ1ZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMJyxcclxuICAgIC8qKiBUaGUgZW1haWwgdmVyaWZpY2F0aW9uIGFjdGlvbi4gKi9cclxuICAgIFZFUklGWV9FTUFJTDogJ1ZFUklGWV9FTUFJTCdcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX2RlYnVnRXJyb3JNYXAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIFtcImFkbWluLXJlc3RyaWN0ZWQtb3BlcmF0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5BRE1JTl9PTkxZX09QRVJBVElPTiAqL106ICdUaGlzIG9wZXJhdGlvbiBpcyByZXN0cmljdGVkIHRvIGFkbWluaXN0cmF0b3JzIG9ubHkuJyxcclxuICAgICAgICBbXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi9dOiAnJyxcclxuICAgICAgICBbXCJhcHAtbm90LWF1dGhvcml6ZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkFQUF9OT1RfQVVUSE9SSVpFRCAqL106IFwiVGhpcyBhcHAsIGlkZW50aWZpZWQgYnkgdGhlIGRvbWFpbiB3aGVyZSBpdCdzIGhvc3RlZCwgaXMgbm90IFwiICtcclxuICAgICAgICAgICAgJ2F1dGhvcml6ZWQgdG8gdXNlIEZpcmViYXNlIEF1dGhlbnRpY2F0aW9uIHdpdGggdGhlIHByb3ZpZGVkIEFQSSBrZXkuICcgK1xyXG4gICAgICAgICAgICAnUmV2aWV3IHlvdXIga2V5IGNvbmZpZ3VyYXRpb24gaW4gdGhlIEdvb2dsZSBBUEkgY29uc29sZS4nLFxyXG4gICAgICAgIFtcImFwcC1ub3QtaW5zdGFsbGVkXCIgLyogQXV0aEVycm9yQ29kZS5BUFBfTk9UX0lOU1RBTExFRCAqL106ICdUaGUgcmVxdWVzdGVkIG1vYmlsZSBhcHBsaWNhdGlvbiBjb3JyZXNwb25kaW5nIHRvIHRoZSBpZGVudGlmaWVyICgnICtcclxuICAgICAgICAgICAgJ0FuZHJvaWQgcGFja2FnZSBuYW1lIG9yIGlPUyBidW5kbGUgSUQpIHByb3ZpZGVkIGlzIG5vdCBpbnN0YWxsZWQgb24gJyArXHJcbiAgICAgICAgICAgICd0aGlzIGRldmljZS4nLFxyXG4gICAgICAgIFtcImNhcHRjaGEtY2hlY2stZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5DQVBUQ0hBX0NIRUNLX0ZBSUxFRCAqL106ICdUaGUgcmVDQVBUQ0hBIHJlc3BvbnNlIHRva2VuIHByb3ZpZGVkIGlzIGVpdGhlciBpbnZhbGlkLCBleHBpcmVkLCAnICtcclxuICAgICAgICAgICAgJ2FscmVhZHkgdXNlZCBvciB0aGUgZG9tYWluIGFzc29jaWF0ZWQgd2l0aCBpdCBkb2VzIG5vdCBtYXRjaCB0aGUgbGlzdCAnICtcclxuICAgICAgICAgICAgJ29mIHdoaXRlbGlzdGVkIGRvbWFpbnMuJyxcclxuICAgICAgICBbXCJjb2RlLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkNPREVfRVhQSVJFRCAqL106ICdUaGUgU01TIGNvZGUgaGFzIGV4cGlyZWQuIFBsZWFzZSByZS1zZW5kIHRoZSB2ZXJpZmljYXRpb24gY29kZSB0byB0cnkgJyArXHJcbiAgICAgICAgICAgICdhZ2Fpbi4nLFxyXG4gICAgICAgIFtcImNvcmRvdmEtbm90LXJlYWR5XCIgLyogQXV0aEVycm9yQ29kZS5DT1JET1ZBX05PVF9SRUFEWSAqL106ICdDb3Jkb3ZhIGZyYW1ld29yayBpcyBub3QgcmVhZHkuJyxcclxuICAgICAgICBbXCJjb3JzLXVuc3VwcG9ydGVkXCIgLyogQXV0aEVycm9yQ29kZS5DT1JTX1VOU1VQUE9SVEVEICovXTogJ1RoaXMgYnJvd3NlciBpcyBub3Qgc3VwcG9ydGVkLicsXHJcbiAgICAgICAgW1wiY3JlZGVudGlhbC1hbHJlYWR5LWluLXVzZVwiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9BTFJFQURZX0lOX1VTRSAqL106ICdUaGlzIGNyZWRlbnRpYWwgaXMgYWxyZWFkeSBhc3NvY2lhdGVkIHdpdGggYSBkaWZmZXJlbnQgdXNlciBhY2NvdW50LicsXHJcbiAgICAgICAgW1wiY3VzdG9tLXRva2VuLW1pc21hdGNoXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX01JU01BVENIICovXTogJ1RoZSBjdXN0b20gdG9rZW4gY29ycmVzcG9uZHMgdG8gYSBkaWZmZXJlbnQgYXVkaWVuY2UuJyxcclxuICAgICAgICBbXCJyZXF1aXJlcy1yZWNlbnQtbG9naW5cIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfVE9PX09MRF9MT0dJTl9BR0FJTiAqL106ICdUaGlzIG9wZXJhdGlvbiBpcyBzZW5zaXRpdmUgYW5kIHJlcXVpcmVzIHJlY2VudCBhdXRoZW50aWNhdGlvbi4gTG9nIGluICcgK1xyXG4gICAgICAgICAgICAnYWdhaW4gYmVmb3JlIHJldHJ5aW5nIHRoaXMgcmVxdWVzdC4nLFxyXG4gICAgICAgIFtcImRlcGVuZGVudC1zZGstaW5pdGlhbGl6ZWQtYmVmb3JlLWF1dGhcIiAvKiBBdXRoRXJyb3JDb2RlLkRFUEVOREVOVF9TREtfSU5JVF9CRUZPUkVfQVVUSCAqL106ICdBbm90aGVyIEZpcmViYXNlIFNESyB3YXMgaW5pdGlhbGl6ZWQgYW5kIGlzIHRyeWluZyB0byB1c2UgQXV0aCBiZWZvcmUgQXV0aCBpcyAnICtcclxuICAgICAgICAgICAgJ2luaXRpYWxpemVkLiBQbGVhc2UgYmUgc3VyZSB0byBjYWxsIGBpbml0aWFsaXplQXV0aGAgb3IgYGdldEF1dGhgIGJlZm9yZSAnICtcclxuICAgICAgICAgICAgJ3N0YXJ0aW5nIGFueSBvdGhlciBGaXJlYmFzZSBTREsuJyxcclxuICAgICAgICBbXCJkeW5hbWljLWxpbmstbm90LWFjdGl2YXRlZFwiIC8qIEF1dGhFcnJvckNvZGUuRFlOQU1JQ19MSU5LX05PVF9BQ1RJVkFURUQgKi9dOiAnUGxlYXNlIGFjdGl2YXRlIER5bmFtaWMgTGlua3MgaW4gdGhlIEZpcmViYXNlIENvbnNvbGUgYW5kIGFncmVlIHRvIHRoZSB0ZXJtcyBhbmQgJyArXHJcbiAgICAgICAgICAgICdjb25kaXRpb25zLicsXHJcbiAgICAgICAgW1wiZW1haWwtY2hhbmdlLW5lZWRzLXZlcmlmaWNhdGlvblwiIC8qIEF1dGhFcnJvckNvZGUuRU1BSUxfQ0hBTkdFX05FRURTX1ZFUklGSUNBVElPTiAqL106ICdNdWx0aS1mYWN0b3IgdXNlcnMgbXVzdCBhbHdheXMgaGF2ZSBhIHZlcmlmaWVkIGVtYWlsLicsXHJcbiAgICAgICAgW1wiZW1haWwtYWxyZWFkeS1pbi11c2VcIiAvKiBBdXRoRXJyb3JDb2RlLkVNQUlMX0VYSVNUUyAqL106ICdUaGUgZW1haWwgYWRkcmVzcyBpcyBhbHJlYWR5IGluIHVzZSBieSBhbm90aGVyIGFjY291bnQuJyxcclxuICAgICAgICBbXCJlbXVsYXRvci1jb25maWctZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5FTVVMQVRPUl9DT05GSUdfRkFJTEVEICovXTogJ0F1dGggaW5zdGFuY2UgaGFzIGFscmVhZHkgYmVlbiB1c2VkIHRvIG1ha2UgYSBuZXR3b3JrIGNhbGwuIEF1dGggY2FuICcgK1xyXG4gICAgICAgICAgICAnbm8gbG9uZ2VyIGJlIGNvbmZpZ3VyZWQgdG8gdXNlIHRoZSBlbXVsYXRvci4gVHJ5IGNhbGxpbmcgJyArXHJcbiAgICAgICAgICAgICdcImNvbm5lY3RBdXRoRW11bGF0b3IoKVwiIHNvb25lci4nLFxyXG4gICAgICAgIFtcImV4cGlyZWQtYWN0aW9uLWNvZGVcIiAvKiBBdXRoRXJyb3JDb2RlLkVYUElSRURfT09CX0NPREUgKi9dOiAnVGhlIGFjdGlvbiBjb2RlIGhhcyBleHBpcmVkLicsXHJcbiAgICAgICAgW1wiY2FuY2VsbGVkLXBvcHVwLXJlcXVlc3RcIiAvKiBBdXRoRXJyb3JDb2RlLkVYUElSRURfUE9QVVBfUkVRVUVTVCAqL106ICdUaGlzIG9wZXJhdGlvbiBoYXMgYmVlbiBjYW5jZWxsZWQgZHVlIHRvIGFub3RoZXIgY29uZmxpY3RpbmcgcG9wdXAgYmVpbmcgb3BlbmVkLicsXHJcbiAgICAgICAgW1wiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovXTogJ0FuIGludGVybmFsIEF1dGhFcnJvciBoYXMgb2NjdXJyZWQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWFwcC1jcmVkZW50aWFsXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FQUF9DUkVERU5USUFMICovXTogJ1RoZSBwaG9uZSB2ZXJpZmljYXRpb24gcmVxdWVzdCBjb250YWlucyBhbiBpbnZhbGlkIGFwcGxpY2F0aW9uIHZlcmlmaWVyLicgK1xyXG4gICAgICAgICAgICAnIFRoZSByZUNBUFRDSEEgdG9rZW4gcmVzcG9uc2UgaXMgZWl0aGVyIGludmFsaWQgb3IgZXhwaXJlZC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtYXBwLWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FQUF9JRCAqL106ICdUaGUgbW9iaWxlIGFwcCBpZGVudGlmaWVyIGlzIG5vdCByZWdpc3RlcmVkIGZvciB0aGUgY3VycmVudCBwcm9qZWN0LicsXHJcbiAgICAgICAgW1wiaW52YWxpZC11c2VyLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FVVEggKi9dOiBcIlRoaXMgdXNlcidzIGNyZWRlbnRpYWwgaXNuJ3QgdmFsaWQgZm9yIHRoaXMgcHJvamVjdC4gVGhpcyBjYW4gaGFwcGVuIFwiICtcclxuICAgICAgICAgICAgXCJpZiB0aGUgdXNlcidzIHRva2VuIGhhcyBiZWVuIHRhbXBlcmVkIHdpdGgsIG9yIGlmIHRoZSB1c2VyIGlzbid0IGZvciBcIiArXHJcbiAgICAgICAgICAgICd0aGUgcHJvamVjdCBhc3NvY2lhdGVkIHdpdGggdGhpcyBBUEkga2V5LicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1hdXRoLWV2ZW50XCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FVVEhfRVZFTlQgKi9dOiAnQW4gaW50ZXJuYWwgQXV0aEVycm9yIGhhcyBvY2N1cnJlZC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtdmVyaWZpY2F0aW9uLWNvZGVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ09ERSAqL106ICdUaGUgU01TIHZlcmlmaWNhdGlvbiBjb2RlIHVzZWQgdG8gY3JlYXRlIHRoZSBwaG9uZSBhdXRoIGNyZWRlbnRpYWwgaXMgJyArXHJcbiAgICAgICAgICAgICdpbnZhbGlkLiBQbGVhc2UgcmVzZW5kIHRoZSB2ZXJpZmljYXRpb24gY29kZSBzbXMgYW5kIGJlIHN1cmUgdG8gdXNlIHRoZSAnICtcclxuICAgICAgICAgICAgJ3ZlcmlmaWNhdGlvbiBjb2RlIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1jb250aW51ZS11cmlcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ09OVElOVUVfVVJJICovXTogJ1RoZSBjb250aW51ZSBVUkwgcHJvdmlkZWQgaW4gdGhlIHJlcXVlc3QgaXMgaW52YWxpZC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtY29yZG92YS1jb25maWd1cmF0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0NPUkRPVkFfQ09ORklHVVJBVElPTiAqL106ICdUaGUgZm9sbG93aW5nIENvcmRvdmEgcGx1Z2lucyBtdXN0IGJlIGluc3RhbGxlZCB0byBlbmFibGUgT0F1dGggc2lnbi1pbjogJyArXHJcbiAgICAgICAgICAgICdjb3Jkb3ZhLXBsdWdpbi1idWlsZGluZm8sIGNvcmRvdmEtdW5pdmVyc2FsLWxpbmtzLXBsdWdpbiwgJyArXHJcbiAgICAgICAgICAgICdjb3Jkb3ZhLXBsdWdpbi1icm93c2VydGFiLCBjb3Jkb3ZhLXBsdWdpbi1pbmFwcGJyb3dzZXIgYW5kICcgK1xyXG4gICAgICAgICAgICAnY29yZG92YS1wbHVnaW4tY3VzdG9tdXJsc2NoZW1lLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1jdXN0b20tdG9rZW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ1VTVE9NX1RPS0VOICovXTogJ1RoZSBjdXN0b20gdG9rZW4gZm9ybWF0IGlzIGluY29ycmVjdC4gUGxlYXNlIGNoZWNrIHRoZSBkb2N1bWVudGF0aW9uLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1keW5hbWljLWxpbmstZG9tYWluXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0RZTkFNSUNfTElOS19ET01BSU4gKi9dOiAnVGhlIHByb3ZpZGVkIGR5bmFtaWMgbGluayBkb21haW4gaXMgbm90IGNvbmZpZ3VyZWQgb3IgYXV0aG9yaXplZCBmb3IgdGhlIGN1cnJlbnQgcHJvamVjdC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtZW1haWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRU1BSUwgKi9dOiAnVGhlIGVtYWlsIGFkZHJlc3MgaXMgYmFkbHkgZm9ybWF0dGVkLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1lbXVsYXRvci1zY2hlbWVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRU1VTEFUT1JfU0NIRU1FICovXTogJ0VtdWxhdG9yIFVSTCBtdXN0IHN0YXJ0IHdpdGggYSB2YWxpZCBzY2hlbWUgKGh0dHA6Ly8gb3IgaHR0cHM6Ly8pLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1hcGkta2V5XCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FQSV9LRVkgKi9dOiAnWW91ciBBUEkga2V5IGlzIGludmFsaWQsIHBsZWFzZSBjaGVjayB5b3UgaGF2ZSBjb3BpZWQgaXQgY29ycmVjdGx5LicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1jZXJ0LWhhc2hcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ0VSVF9IQVNIICovXTogJ1RoZSBTSEEtMSBjZXJ0aWZpY2F0ZSBoYXNoIHByb3ZpZGVkIGlzIGludmFsaWQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ1JFREVOVElBTCAqL106ICdUaGUgc3VwcGxpZWQgYXV0aCBjcmVkZW50aWFsIGlzIGluY29ycmVjdCwgbWFsZm9ybWVkIG9yIGhhcyBleHBpcmVkLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1tZXNzYWdlLXBheWxvYWRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfTUVTU0FHRV9QQVlMT0FEICovXTogJ1RoZSBlbWFpbCB0ZW1wbGF0ZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgYWN0aW9uIGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVycyBpbiBpdHMgbWVzc2FnZS4gJyArXHJcbiAgICAgICAgICAgICdQbGVhc2UgZml4IGJ5IGdvaW5nIHRvIHRoZSBBdXRoIGVtYWlsIHRlbXBsYXRlcyBzZWN0aW9uIGluIHRoZSBGaXJlYmFzZSBDb25zb2xlLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1tdWx0aS1mYWN0b3Itc2Vzc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9NRkFfU0VTU0lPTiAqL106ICdUaGUgcmVxdWVzdCBkb2VzIG5vdCBjb250YWluIGEgdmFsaWQgcHJvb2Ygb2YgZmlyc3QgZmFjdG9yIHN1Y2Nlc3NmdWwgc2lnbi1pbi4nLFxyXG4gICAgICAgIFtcImludmFsaWQtb2F1dGgtcHJvdmlkZXJcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT0FVVEhfUFJPVklERVIgKi9dOiAnRW1haWxBdXRoUHJvdmlkZXIgaXMgbm90IHN1cHBvcnRlZCBmb3IgdGhpcyBvcGVyYXRpb24uIFRoaXMgb3BlcmF0aW9uICcgK1xyXG4gICAgICAgICAgICAnb25seSBzdXBwb3J0cyBPQXV0aCBwcm92aWRlcnMuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLW9hdXRoLWNsaWVudC1pZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PQVVUSF9DTElFTlRfSUQgKi9dOiAnVGhlIE9BdXRoIGNsaWVudCBJRCBwcm92aWRlZCBpcyBlaXRoZXIgaW52YWxpZCBvciBkb2VzIG5vdCBtYXRjaCB0aGUgJyArXHJcbiAgICAgICAgICAgICdzcGVjaWZpZWQgQVBJIGtleS4nLFxyXG4gICAgICAgIFtcInVuYXV0aG9yaXplZC1kb21haW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT1JJR0lOICovXTogJ1RoaXMgZG9tYWluIGlzIG5vdCBhdXRob3JpemVkIGZvciBPQXV0aCBvcGVyYXRpb25zIGZvciB5b3VyIEZpcmViYXNlICcgK1xyXG4gICAgICAgICAgICAncHJvamVjdC4gRWRpdCB0aGUgbGlzdCBvZiBhdXRob3JpemVkIGRvbWFpbnMgZnJvbSB0aGUgRmlyZWJhc2UgY29uc29sZS4nLFxyXG4gICAgICAgIFtcImludmFsaWQtYWN0aW9uLWNvZGVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT09CX0NPREUgKi9dOiAnVGhlIGFjdGlvbiBjb2RlIGlzIGludmFsaWQuIFRoaXMgY2FuIGhhcHBlbiBpZiB0aGUgY29kZSBpcyBtYWxmb3JtZWQsICcgK1xyXG4gICAgICAgICAgICAnZXhwaXJlZCwgb3IgaGFzIGFscmVhZHkgYmVlbiB1c2VkLicsXHJcbiAgICAgICAgW1wid3JvbmctcGFzc3dvcmRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEFTU1dPUkQgKi9dOiAnVGhlIHBhc3N3b3JkIGlzIGludmFsaWQgb3IgdGhlIHVzZXIgZG9lcyBub3QgaGF2ZSBhIHBhc3N3b3JkLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1wZXJzaXN0ZW5jZS10eXBlXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1BFUlNJU1RFTkNFICovXTogJ1RoZSBzcGVjaWZpZWQgcGVyc2lzdGVuY2UgdHlwZSBpcyBpbnZhbGlkLiBJdCBjYW4gb25seSBiZSBsb2NhbCwgc2Vzc2lvbiBvciBub25lLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1waG9uZS1udW1iZXJcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEhPTkVfTlVNQkVSICovXTogJ1RoZSBmb3JtYXQgb2YgdGhlIHBob25lIG51bWJlciBwcm92aWRlZCBpcyBpbmNvcnJlY3QuIFBsZWFzZSBlbnRlciB0aGUgJyArXHJcbiAgICAgICAgICAgICdwaG9uZSBudW1iZXIgaW4gYSBmb3JtYXQgdGhhdCBjYW4gYmUgcGFyc2VkIGludG8gRS4xNjQgZm9ybWF0LiBFLjE2NCAnICtcclxuICAgICAgICAgICAgJ3Bob25lIG51bWJlcnMgYXJlIHdyaXR0ZW4gaW4gdGhlIGZvcm1hdCBbK11bY291bnRyeSBjb2RlXVtzdWJzY3JpYmVyICcgK1xyXG4gICAgICAgICAgICAnbnVtYmVyIGluY2x1ZGluZyBhcmVhIGNvZGVdLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1wcm92aWRlci1pZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9QUk9WSURFUl9JRCAqL106ICdUaGUgc3BlY2lmaWVkIHByb3ZpZGVyIElEIGlzIGludmFsaWQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXJlY2lwaWVudC1lbWFpbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRUNJUElFTlRfRU1BSUwgKi9dOiAnVGhlIGVtYWlsIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBhY3Rpb24gZmFpbGVkIHRvIHNlbmQgYXMgdGhlIHByb3ZpZGVkICcgK1xyXG4gICAgICAgICAgICAncmVjaXBpZW50IGVtYWlsIGFkZHJlc3MgaXMgaW52YWxpZC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtc2VuZGVyXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1NFTkRFUiAqL106ICdUaGUgZW1haWwgdGVtcGxhdGUgY29ycmVzcG9uZGluZyB0byB0aGlzIGFjdGlvbiBjb250YWlucyBhbiBpbnZhbGlkIHNlbmRlciBlbWFpbCBvciBuYW1lLiAnICtcclxuICAgICAgICAgICAgJ1BsZWFzZSBmaXggYnkgZ29pbmcgdG8gdGhlIEF1dGggZW1haWwgdGVtcGxhdGVzIHNlY3Rpb24gaW4gdGhlIEZpcmViYXNlIENvbnNvbGUuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXZlcmlmaWNhdGlvbi1pZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9TRVNTSU9OX0lORk8gKi9dOiAnVGhlIHZlcmlmaWNhdGlvbiBJRCB1c2VkIHRvIGNyZWF0ZSB0aGUgcGhvbmUgYXV0aCBjcmVkZW50aWFsIGlzIGludmFsaWQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXRlbmFudC1pZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9URU5BTlRfSUQgKi9dOiBcIlRoZSBBdXRoIGluc3RhbmNlJ3MgdGVuYW50IElEIGlzIGludmFsaWQuXCIsXHJcbiAgICAgICAgW1wibG9naW4tYmxvY2tlZFwiIC8qIEF1dGhFcnJvckNvZGUuTE9HSU5fQkxPQ0tFRCAqL106ICdMb2dpbiBibG9ja2VkIGJ5IHVzZXItcHJvdmlkZWQgbWV0aG9kOiB7JG9yaWdpbmFsTWVzc2FnZX0nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctYW5kcm9pZC1wa2ctbmFtZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSAqL106ICdBbiBBbmRyb2lkIFBhY2thZ2UgTmFtZSBtdXN0IGJlIHByb3ZpZGVkIGlmIHRoZSBBbmRyb2lkIEFwcCBpcyByZXF1aXJlZCB0byBiZSBpbnN0YWxsZWQuJyxcclxuICAgICAgICBbXCJhdXRoLWRvbWFpbi1jb25maWctcmVxdWlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQVVUSF9ET01BSU4gKi9dOiAnQmUgc3VyZSB0byBpbmNsdWRlIGF1dGhEb21haW4gd2hlbiBjYWxsaW5nIGZpcmViYXNlLmluaXRpYWxpemVBcHAoKSwgJyArXHJcbiAgICAgICAgICAgICdieSBmb2xsb3dpbmcgdGhlIGluc3RydWN0aW9ucyBpbiB0aGUgRmlyZWJhc2UgY29uc29sZS4nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctYXBwLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQVBQX0NSRURFTlRJQUwgKi9dOiAnVGhlIHBob25lIHZlcmlmaWNhdGlvbiByZXF1ZXN0IGlzIG1pc3NpbmcgYW4gYXBwbGljYXRpb24gdmVyaWZpZXIgJyArXHJcbiAgICAgICAgICAgICdhc3NlcnRpb24uIEEgcmVDQVBUQ0hBIHJlc3BvbnNlIHRva2VuIG5lZWRzIHRvIGJlIHByb3ZpZGVkLicsXHJcbiAgICAgICAgW1wibWlzc2luZy12ZXJpZmljYXRpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19DT0RFICovXTogJ1RoZSBwaG9uZSBhdXRoIGNyZWRlbnRpYWwgd2FzIGNyZWF0ZWQgd2l0aCBhbiBlbXB0eSBTTVMgdmVyaWZpY2F0aW9uIGNvZGUuJyxcclxuICAgICAgICBbXCJtaXNzaW5nLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19DT05USU5VRV9VUkkgKi9dOiAnQSBjb250aW51ZSBVUkwgbXVzdCBiZSBwcm92aWRlZCBpbiB0aGUgcmVxdWVzdC4nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctaWZyYW1lLXN0YXJ0XCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0lGUkFNRV9TVEFSVCAqL106ICdBbiBpbnRlcm5hbCBBdXRoRXJyb3IgaGFzIG9jY3VycmVkLicsXHJcbiAgICAgICAgW1wibWlzc2luZy1pb3MtYnVuZGxlLWlkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0lPU19CVU5ETEVfSUQgKi9dOiAnQW4gaU9TIEJ1bmRsZSBJRCBtdXN0IGJlIHByb3ZpZGVkIGlmIGFuIEFwcCBTdG9yZSBJRCBpcyBwcm92aWRlZC4nLFxyXG4gICAgICAgIFtcIm1pc3Npbmctb3ItaW52YWxpZC1ub25jZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19PUl9JTlZBTElEX05PTkNFICovXTogJ1RoZSByZXF1ZXN0IGRvZXMgbm90IGNvbnRhaW4gYSB2YWxpZCBub25jZS4gVGhpcyBjYW4gb2NjdXIgaWYgdGhlICcgK1xyXG4gICAgICAgICAgICAnU0hBLTI1NiBoYXNoIG9mIHRoZSBwcm92aWRlZCByYXcgbm9uY2UgZG9lcyBub3QgbWF0Y2ggdGhlIGhhc2hlZCBub25jZSAnICtcclxuICAgICAgICAgICAgJ2luIHRoZSBJRCB0b2tlbiBwYXlsb2FkLicsXHJcbiAgICAgICAgW1wibWlzc2luZy1wYXNzd29yZFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19QQVNTV09SRCAqL106ICdBIG5vbi1lbXB0eSBwYXNzd29yZCBtdXN0IGJlIHByb3ZpZGVkJyxcclxuICAgICAgICBbXCJtaXNzaW5nLW11bHRpLWZhY3Rvci1pbmZvXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX01GQV9JTkZPICovXTogJ05vIHNlY29uZCBmYWN0b3IgaWRlbnRpZmllciBpcyBwcm92aWRlZC4nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctbXVsdGktZmFjdG9yLXNlc3Npb25cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX1NFU1NJT04gKi9dOiAnVGhlIHJlcXVlc3QgaXMgbWlzc2luZyBwcm9vZiBvZiBmaXJzdCBmYWN0b3Igc3VjY2Vzc2Z1bCBzaWduLWluLicsXHJcbiAgICAgICAgW1wibWlzc2luZy1waG9uZS1udW1iZXJcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUEhPTkVfTlVNQkVSICovXTogJ1RvIHNlbmQgdmVyaWZpY2F0aW9uIGNvZGVzLCBwcm92aWRlIGEgcGhvbmUgbnVtYmVyIGZvciB0aGUgcmVjaXBpZW50LicsXHJcbiAgICAgICAgW1wibWlzc2luZy12ZXJpZmljYXRpb24taWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfU0VTU0lPTl9JTkZPICovXTogJ1RoZSBwaG9uZSBhdXRoIGNyZWRlbnRpYWwgd2FzIGNyZWF0ZWQgd2l0aCBhbiBlbXB0eSB2ZXJpZmljYXRpb24gSUQuJyxcclxuICAgICAgICBbXCJhcHAtZGVsZXRlZFwiIC8qIEF1dGhFcnJvckNvZGUuTU9EVUxFX0RFU1RST1lFRCAqL106ICdUaGlzIGluc3RhbmNlIG9mIEZpcmViYXNlQXBwIGhhcyBiZWVuIGRlbGV0ZWQuJyxcclxuICAgICAgICBbXCJtdWx0aS1mYWN0b3ItaW5mby1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLk1GQV9JTkZPX05PVF9GT1VORCAqL106ICdUaGUgdXNlciBkb2VzIG5vdCBoYXZlIGEgc2Vjb25kIGZhY3RvciBtYXRjaGluZyB0aGUgaWRlbnRpZmllciBwcm92aWRlZC4nLFxyXG4gICAgICAgIFtcIm11bHRpLWZhY3Rvci1hdXRoLXJlcXVpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5NRkFfUkVRVUlSRUQgKi9dOiAnUHJvb2Ygb2Ygb3duZXJzaGlwIG9mIGEgc2Vjb25kIGZhY3RvciBpcyByZXF1aXJlZCB0byBjb21wbGV0ZSBzaWduLWluLicsXHJcbiAgICAgICAgW1wiYWNjb3VudC1leGlzdHMtd2l0aC1kaWZmZXJlbnQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuTkVFRF9DT05GSVJNQVRJT04gKi9dOiAnQW4gYWNjb3VudCBhbHJlYWR5IGV4aXN0cyB3aXRoIHRoZSBzYW1lIGVtYWlsIGFkZHJlc3MgYnV0IGRpZmZlcmVudCAnICtcclxuICAgICAgICAgICAgJ3NpZ24taW4gY3JlZGVudGlhbHMuIFNpZ24gaW4gdXNpbmcgYSBwcm92aWRlciBhc3NvY2lhdGVkIHdpdGggdGhpcyAnICtcclxuICAgICAgICAgICAgJ2VtYWlsIGFkZHJlc3MuJyxcclxuICAgICAgICBbXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovXTogJ0EgbmV0d29yayBBdXRoRXJyb3IgKHN1Y2ggYXMgdGltZW91dCwgaW50ZXJydXB0ZWQgY29ubmVjdGlvbiBvciB1bnJlYWNoYWJsZSBob3N0KSBoYXMgb2NjdXJyZWQuJyxcclxuICAgICAgICBbXCJuby1hdXRoLWV2ZW50XCIgLyogQXV0aEVycm9yQ29kZS5OT19BVVRIX0VWRU5UICovXTogJ0FuIGludGVybmFsIEF1dGhFcnJvciBoYXMgb2NjdXJyZWQuJyxcclxuICAgICAgICBbXCJuby1zdWNoLXByb3ZpZGVyXCIgLyogQXV0aEVycm9yQ29kZS5OT19TVUNIX1BST1ZJREVSICovXTogJ1VzZXIgd2FzIG5vdCBsaW5rZWQgdG8gYW4gYWNjb3VudCB3aXRoIHRoZSBnaXZlbiBwcm92aWRlci4nLFxyXG4gICAgICAgIFtcIm51bGwtdXNlclwiIC8qIEF1dGhFcnJvckNvZGUuTlVMTF9VU0VSICovXTogJ0EgbnVsbCB1c2VyIG9iamVjdCB3YXMgcHJvdmlkZWQgYXMgdGhlIGFyZ3VtZW50IGZvciBhbiBvcGVyYXRpb24gd2hpY2ggJyArXHJcbiAgICAgICAgICAgICdyZXF1aXJlcyBhIG5vbi1udWxsIHVzZXIgb2JqZWN0LicsXHJcbiAgICAgICAgW1wib3BlcmF0aW9uLW5vdC1hbGxvd2VkXCIgLyogQXV0aEVycm9yQ29kZS5PUEVSQVRJT05fTk9UX0FMTE9XRUQgKi9dOiAnVGhlIGdpdmVuIHNpZ24taW4gcHJvdmlkZXIgaXMgZGlzYWJsZWQgZm9yIHRoaXMgRmlyZWJhc2UgcHJvamVjdC4gJyArXHJcbiAgICAgICAgICAgICdFbmFibGUgaXQgaW4gdGhlIEZpcmViYXNlIGNvbnNvbGUsIHVuZGVyIHRoZSBzaWduLWluIG1ldGhvZCB0YWIgb2YgdGhlICcgK1xyXG4gICAgICAgICAgICAnQXV0aCBzZWN0aW9uLicsXHJcbiAgICAgICAgW1wib3BlcmF0aW9uLW5vdC1zdXBwb3J0ZWQtaW4tdGhpcy1lbnZpcm9ubWVudFwiIC8qIEF1dGhFcnJvckNvZGUuT1BFUkFUSU9OX05PVF9TVVBQT1JURUQgKi9dOiAnVGhpcyBvcGVyYXRpb24gaXMgbm90IHN1cHBvcnRlZCBpbiB0aGUgZW52aXJvbm1lbnQgdGhpcyBhcHBsaWNhdGlvbiBpcyAnICtcclxuICAgICAgICAgICAgJ3J1bm5pbmcgb24uIFwibG9jYXRpb24ucHJvdG9jb2xcIiBtdXN0IGJlIGh0dHAsIGh0dHBzIG9yIGNocm9tZS1leHRlbnNpb24nICtcclxuICAgICAgICAgICAgJyBhbmQgd2ViIHN0b3JhZ2UgbXVzdCBiZSBlbmFibGVkLicsXHJcbiAgICAgICAgW1wicG9wdXAtYmxvY2tlZFwiIC8qIEF1dGhFcnJvckNvZGUuUE9QVVBfQkxPQ0tFRCAqL106ICdVbmFibGUgdG8gZXN0YWJsaXNoIGEgY29ubmVjdGlvbiB3aXRoIHRoZSBwb3B1cC4gSXQgbWF5IGhhdmUgYmVlbiBibG9ja2VkIGJ5IHRoZSBicm93c2VyLicsXHJcbiAgICAgICAgW1wicG9wdXAtY2xvc2VkLWJ5LXVzZXJcIiAvKiBBdXRoRXJyb3JDb2RlLlBPUFVQX0NMT1NFRF9CWV9VU0VSICovXTogJ1RoZSBwb3B1cCBoYXMgYmVlbiBjbG9zZWQgYnkgdGhlIHVzZXIgYmVmb3JlIGZpbmFsaXppbmcgdGhlIG9wZXJhdGlvbi4nLFxyXG4gICAgICAgIFtcInByb3ZpZGVyLWFscmVhZHktbGlua2VkXCIgLyogQXV0aEVycm9yQ29kZS5QUk9WSURFUl9BTFJFQURZX0xJTktFRCAqL106ICdVc2VyIGNhbiBvbmx5IGJlIGxpbmtlZCB0byBvbmUgaWRlbnRpdHkgZm9yIHRoZSBnaXZlbiBwcm92aWRlci4nLFxyXG4gICAgICAgIFtcInF1b3RhLWV4Y2VlZGVkXCIgLyogQXV0aEVycm9yQ29kZS5RVU9UQV9FWENFRURFRCAqL106IFwiVGhlIHByb2plY3QncyBxdW90YSBmb3IgdGhpcyBvcGVyYXRpb24gaGFzIGJlZW4gZXhjZWVkZWQuXCIsXHJcbiAgICAgICAgW1wicmVkaXJlY3QtY2FuY2VsbGVkLWJ5LXVzZXJcIiAvKiBBdXRoRXJyb3JDb2RlLlJFRElSRUNUX0NBTkNFTExFRF9CWV9VU0VSICovXTogJ1RoZSByZWRpcmVjdCBvcGVyYXRpb24gaGFzIGJlZW4gY2FuY2VsbGVkIGJ5IHRoZSB1c2VyIGJlZm9yZSBmaW5hbGl6aW5nLicsXHJcbiAgICAgICAgW1wicmVkaXJlY3Qtb3BlcmF0aW9uLXBlbmRpbmdcIiAvKiBBdXRoRXJyb3JDb2RlLlJFRElSRUNUX09QRVJBVElPTl9QRU5ESU5HICovXTogJ0EgcmVkaXJlY3Qgc2lnbi1pbiBvcGVyYXRpb24gaXMgYWxyZWFkeSBwZW5kaW5nLicsXHJcbiAgICAgICAgW1wicmVqZWN0ZWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuUkVKRUNURURfQ1JFREVOVElBTCAqL106ICdUaGUgcmVxdWVzdCBjb250YWlucyBtYWxmb3JtZWQgb3IgbWlzbWF0Y2hpbmcgY3JlZGVudGlhbHMuJyxcclxuICAgICAgICBbXCJzZWNvbmQtZmFjdG9yLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5TRUNPTkRfRkFDVE9SX0FMUkVBRFlfRU5ST0xMRUQgKi9dOiAnVGhlIHNlY29uZCBmYWN0b3IgaXMgYWxyZWFkeSBlbnJvbGxlZCBvbiB0aGlzIGFjY291bnQuJyxcclxuICAgICAgICBbXCJtYXhpbXVtLXNlY29uZC1mYWN0b3ItY291bnQtZXhjZWVkZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQgKi9dOiAnVGhlIG1heGltdW0gYWxsb3dlZCBudW1iZXIgb2Ygc2Vjb25kIGZhY3RvcnMgb24gYSB1c2VyIGhhcyBiZWVuIGV4Y2VlZGVkLicsXHJcbiAgICAgICAgW1widGVuYW50LWlkLW1pc21hdGNoXCIgLyogQXV0aEVycm9yQ29kZS5URU5BTlRfSURfTUlTTUFUQ0ggKi9dOiBcIlRoZSBwcm92aWRlZCB0ZW5hbnQgSUQgZG9lcyBub3QgbWF0Y2ggdGhlIEF1dGggaW5zdGFuY2UncyB0ZW5hbnQgSURcIixcclxuICAgICAgICBbXCJ0aW1lb3V0XCIgLyogQXV0aEVycm9yQ29kZS5USU1FT1VUICovXTogJ1RoZSBvcGVyYXRpb24gaGFzIHRpbWVkIG91dC4nLFxyXG4gICAgICAgIFtcInVzZXItdG9rZW4tZXhwaXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqL106IFwiVGhlIHVzZXIncyBjcmVkZW50aWFsIGlzIG5vIGxvbmdlciB2YWxpZC4gVGhlIHVzZXIgbXVzdCBzaWduIGluIGFnYWluLlwiLFxyXG4gICAgICAgIFtcInRvby1tYW55LXJlcXVlc3RzXCIgLyogQXV0aEVycm9yQ29kZS5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi9dOiAnV2UgaGF2ZSBibG9ja2VkIGFsbCByZXF1ZXN0cyBmcm9tIHRoaXMgZGV2aWNlIGR1ZSB0byB1bnVzdWFsIGFjdGl2aXR5LiAnICtcclxuICAgICAgICAgICAgJ1RyeSBhZ2FpbiBsYXRlci4nLFxyXG4gICAgICAgIFtcInVuYXV0aG9yaXplZC1jb250aW51ZS11cmlcIiAvKiBBdXRoRXJyb3JDb2RlLlVOQVVUSE9SSVpFRF9ET01BSU4gKi9dOiAnVGhlIGRvbWFpbiBvZiB0aGUgY29udGludWUgVVJMIGlzIG5vdCB3aGl0ZWxpc3RlZC4gIFBsZWFzZSB3aGl0ZWxpc3QgJyArXHJcbiAgICAgICAgICAgICd0aGUgZG9tYWluIGluIHRoZSBGaXJlYmFzZSBjb25zb2xlLicsXHJcbiAgICAgICAgW1widW5zdXBwb3J0ZWQtZmlyc3QtZmFjdG9yXCIgLyogQXV0aEVycm9yQ29kZS5VTlNVUFBPUlRFRF9GSVJTVF9GQUNUT1IgKi9dOiAnRW5yb2xsaW5nIGEgc2Vjb25kIGZhY3RvciBvciBzaWduaW5nIGluIHdpdGggYSBtdWx0aS1mYWN0b3IgYWNjb3VudCByZXF1aXJlcyBzaWduLWluIHdpdGggYSBzdXBwb3J0ZWQgZmlyc3QgZmFjdG9yLicsXHJcbiAgICAgICAgW1widW5zdXBwb3J0ZWQtcGVyc2lzdGVuY2UtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuVU5TVVBQT1JURURfUEVSU0lTVEVOQ0UgKi9dOiAnVGhlIGN1cnJlbnQgZW52aXJvbm1lbnQgZG9lcyBub3Qgc3VwcG9ydCB0aGUgc3BlY2lmaWVkIHBlcnNpc3RlbmNlIHR5cGUuJyxcclxuICAgICAgICBbXCJ1bnN1cHBvcnRlZC10ZW5hbnQtb3BlcmF0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5VTlNVUFBPUlRFRF9URU5BTlRfT1BFUkFUSU9OICovXTogJ1RoaXMgb3BlcmF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYSBtdWx0aS10ZW5hbnQgY29udGV4dC4nLFxyXG4gICAgICAgIFtcInVudmVyaWZpZWQtZW1haWxcIiAvKiBBdXRoRXJyb3JDb2RlLlVOVkVSSUZJRURfRU1BSUwgKi9dOiAnVGhlIG9wZXJhdGlvbiByZXF1aXJlcyBhIHZlcmlmaWVkIGVtYWlsLicsXHJcbiAgICAgICAgW1widXNlci1jYW5jZWxsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfQ0FOQ0VMTEVEICovXTogJ1RoZSB1c2VyIGRpZCBub3QgZ3JhbnQgeW91ciBhcHBsaWNhdGlvbiB0aGUgcGVybWlzc2lvbnMgaXQgcmVxdWVzdGVkLicsXHJcbiAgICAgICAgW1widXNlci1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfREVMRVRFRCAqL106ICdUaGVyZSBpcyBubyB1c2VyIHJlY29yZCBjb3JyZXNwb25kaW5nIHRvIHRoaXMgaWRlbnRpZmllci4gVGhlIHVzZXIgbWF5ICcgK1xyXG4gICAgICAgICAgICAnaGF2ZSBiZWVuIGRlbGV0ZWQuJyxcclxuICAgICAgICBbXCJ1c2VyLWRpc2FibGVkXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RJU0FCTEVEICovXTogJ1RoZSB1c2VyIGFjY291bnQgaGFzIGJlZW4gZGlzYWJsZWQgYnkgYW4gYWRtaW5pc3RyYXRvci4nLFxyXG4gICAgICAgIFtcInVzZXItbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfTUlTTUFUQ0ggKi9dOiAnVGhlIHN1cHBsaWVkIGNyZWRlbnRpYWxzIGRvIG5vdCBjb3JyZXNwb25kIHRvIHRoZSBwcmV2aW91c2x5IHNpZ25lZCBpbiB1c2VyLicsXHJcbiAgICAgICAgW1widXNlci1zaWduZWQtb3V0XCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX1NJR05FRF9PVVQgKi9dOiAnJyxcclxuICAgICAgICBbXCJ3ZWFrLXBhc3N3b3JkXCIgLyogQXV0aEVycm9yQ29kZS5XRUFLX1BBU1NXT1JEICovXTogJ1RoZSBwYXNzd29yZCBtdXN0IGJlIDYgY2hhcmFjdGVycyBsb25nIG9yIG1vcmUuJyxcclxuICAgICAgICBbXCJ3ZWItc3RvcmFnZS11bnN1cHBvcnRlZFwiIC8qIEF1dGhFcnJvckNvZGUuV0VCX1NUT1JBR0VfVU5TVVBQT1JURUQgKi9dOiAnVGhpcyBicm93c2VyIGlzIG5vdCBzdXBwb3J0ZWQgb3IgM3JkIHBhcnR5IGNvb2tpZXMgYW5kIGRhdGEgbWF5IGJlIGRpc2FibGVkLicsXHJcbiAgICAgICAgW1wiYWxyZWFkeS1pbml0aWFsaXplZFwiIC8qIEF1dGhFcnJvckNvZGUuQUxSRUFEWV9JTklUSUFMSVpFRCAqL106ICdpbml0aWFsaXplQXV0aCgpIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkIHdpdGggJyArXHJcbiAgICAgICAgICAgICdkaWZmZXJlbnQgb3B0aW9ucy4gVG8gYXZvaWQgdGhpcyBlcnJvciwgY2FsbCBpbml0aWFsaXplQXV0aCgpIHdpdGggdGhlICcgK1xyXG4gICAgICAgICAgICAnc2FtZSBvcHRpb25zIGFzIHdoZW4gaXQgd2FzIG9yaWdpbmFsbHkgY2FsbGVkLCBvciBjYWxsIGdldEF1dGgoKSB0byByZXR1cm4gdGhlJyArXHJcbiAgICAgICAgICAgICcgYWxyZWFkeSBpbml0aWFsaXplZCBpbnN0YW5jZS4nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctcmVjYXB0Y2hhLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqL106ICdUaGUgcmVDQVBUQ0hBIHRva2VuIGlzIG1pc3Npbmcgd2hlbiBzZW5kaW5nIHJlcXVlc3QgdG8gdGhlIGJhY2tlbmQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXJlY2FwdGNoYS10b2tlblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRUNBUFRDSEFfVE9LRU4gKi9dOiAnVGhlIHJlQ0FQVENIQSB0b2tlbiBpcyBpbnZhbGlkIHdoZW4gc2VuZGluZyByZXF1ZXN0IHRvIHRoZSBiYWNrZW5kLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1yZWNhcHRjaGEtYWN0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0FQVENIQV9BQ1RJT04gKi9dOiAnVGhlIHJlQ0FQVENIQSBhY3Rpb24gaXMgaW52YWxpZCB3aGVuIHNlbmRpbmcgcmVxdWVzdCB0byB0aGUgYmFja2VuZC4nLFxyXG4gICAgICAgIFtcInJlY2FwdGNoYS1ub3QtZW5hYmxlZFwiIC8qIEF1dGhFcnJvckNvZGUuUkVDQVBUQ0hBX05PVF9FTkFCTEVEICovXTogJ3JlQ0FQVENIQSBFbnRlcnByaXNlIGludGVncmF0aW9uIGlzIG5vdCBlbmFibGVkIGZvciB0aGlzIHByb2plY3QuJyxcclxuICAgICAgICBbXCJtaXNzaW5nLWNsaWVudC10eXBlXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0NMSUVOVF9UWVBFICovXTogJ1RoZSByZUNBUFRDSEEgY2xpZW50IHR5cGUgaXMgbWlzc2luZyB3aGVuIHNlbmRpbmcgcmVxdWVzdCB0byB0aGUgYmFja2VuZC4nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctcmVjYXB0Y2hhLXZlcnNpb25cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUkVDQVBUQ0hBX1ZFUlNJT04gKi9dOiAnVGhlIHJlQ0FQVENIQSB2ZXJzaW9uIGlzIG1pc3Npbmcgd2hlbiBzZW5kaW5nIHJlcXVlc3QgdG8gdGhlIGJhY2tlbmQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXJlcS10eXBlXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFUV9UWVBFICovXTogJ0ludmFsaWQgcmVxdWVzdCBwYXJhbWV0ZXJzLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1yZWNhcHRjaGEtdmVyc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRUNBUFRDSEFfVkVSU0lPTiAqL106ICdUaGUgcmVDQVBUQ0hBIHZlcnNpb24gaXMgaW52YWxpZCB3aGVuIHNlbmRpbmcgcmVxdWVzdCB0byB0aGUgYmFja2VuZC4nLFxyXG4gICAgICAgIFtcInVuc3VwcG9ydGVkLXBhc3N3b3JkLXBvbGljeS1zY2hlbWEtdmVyc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuVU5TVVBQT1JURURfUEFTU1dPUkRfUE9MSUNZX1NDSEVNQV9WRVJTSU9OICovXTogJ1RoZSBwYXNzd29yZCBwb2xpY3kgcmVjZWl2ZWQgZnJvbSB0aGUgYmFja2VuZCB1c2VzIGEgc2NoZW1hIHZlcnNpb24gdGhhdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgdmVyc2lvbiBvZiB0aGUgRmlyZWJhc2UgU0RLLicsXHJcbiAgICAgICAgW1wicGFzc3dvcmQtZG9lcy1ub3QtbWVldC1yZXF1aXJlbWVudHNcIiAvKiBBdXRoRXJyb3JDb2RlLlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTICovXTogJ1RoZSBwYXNzd29yZCBkb2VzIG5vdCBtZWV0IHRoZSByZXF1aXJlbWVudHMuJ1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBfcHJvZEVycm9yTWFwKCkge1xyXG4gICAgLy8gV2Ugd2lsbCBpbmNsdWRlIHRoaXMgb25lIG1lc3NhZ2UgaW4gdGhlIHByb2QgZXJyb3IgbWFwIHNpbmNlIGJ5IHRoZSB2ZXJ5XHJcbiAgICAvLyBuYXR1cmUgb2YgdGhpcyBlcnJvciwgZGV2ZWxvcGVycyB3aWxsIG5ldmVyIGJlIGFibGUgdG8gc2VlIHRoZSBtZXNzYWdlXHJcbiAgICAvLyB1c2luZyB0aGUgZGVidWdFcnJvck1hcCAod2hpY2ggaXMgaW5zdGFsbGVkIGR1cmluZyBhdXRoIGluaXRpYWxpemF0aW9uKS5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgW1wiZGVwZW5kZW50LXNkay1pbml0aWFsaXplZC1iZWZvcmUtYXV0aFwiIC8qIEF1dGhFcnJvckNvZGUuREVQRU5ERU5UX1NES19JTklUX0JFRk9SRV9BVVRIICovXTogJ0Fub3RoZXIgRmlyZWJhc2UgU0RLIHdhcyBpbml0aWFsaXplZCBhbmQgaXMgdHJ5aW5nIHRvIHVzZSBBdXRoIGJlZm9yZSBBdXRoIGlzICcgK1xyXG4gICAgICAgICAgICAnaW5pdGlhbGl6ZWQuIFBsZWFzZSBiZSBzdXJlIHRvIGNhbGwgYGluaXRpYWxpemVBdXRoYCBvciBgZ2V0QXV0aGAgYmVmb3JlICcgK1xyXG4gICAgICAgICAgICAnc3RhcnRpbmcgYW55IG90aGVyIEZpcmViYXNlIFNESy4nXHJcbiAgICB9O1xyXG59XHJcbi8qKlxyXG4gKiBBIHZlcmJvc2UgZXJyb3IgbWFwIHdpdGggZGV0YWlsZWQgZGVzY3JpcHRpb25zIGZvciBtb3N0IGVycm9yIGNvZGVzLlxyXG4gKlxyXG4gKiBTZWUgZGlzY3Vzc2lvbiBhdCB7QGxpbmsgQXV0aEVycm9yTWFwfVxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBkZWJ1Z0Vycm9yTWFwID0gX2RlYnVnRXJyb3JNYXA7XHJcbi8qKlxyXG4gKiBBIG1pbmltYWwgZXJyb3IgbWFwIHdpdGggYWxsIHZlcmJvc2UgZXJyb3IgbWVzc2FnZXMgc3RyaXBwZWQuXHJcbiAqXHJcbiAqIFNlZSBkaXNjdXNzaW9uIGF0IHtAbGluayBBdXRoRXJyb3JNYXB9XHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IHByb2RFcnJvck1hcCA9IF9wcm9kRXJyb3JNYXA7XHJcbmNvbnN0IF9ERUZBVUxUX0FVVEhfRVJST1JfRkFDVE9SWSA9IG5ldyBFcnJvckZhY3RvcnkoJ2F1dGgnLCAnRmlyZWJhc2UnLCBfcHJvZEVycm9yTWFwKCkpO1xyXG4vKipcclxuICogQSBtYXAgb2YgcG90ZW50aWFsIGBBdXRoYCBlcnJvciBjb2RlcywgZm9yIGVhc2llciBjb21wYXJpc29uIHdpdGggZXJyb3JzXHJcbiAqIHRocm93biBieSB0aGUgU0RLLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBOb3RlIHRoYXQgeW91IGNhbid0IHRyZWUtc2hha2UgaW5kaXZpZHVhbCBrZXlzXHJcbiAqIGluIHRoZSBtYXAsIHNvIGJ5IHVzaW5nIHRoZSBtYXAgeW91IG1pZ2h0IHN1YnN0YW50aWFsbHkgaW5jcmVhc2UgeW91clxyXG4gKiBidW5kbGUgc2l6ZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgQVVUSF9FUlJPUl9DT0RFU19NQVBfRE9fTk9UX1VTRV9JTlRFUk5BTExZID0ge1xyXG4gICAgQURNSU5fT05MWV9PUEVSQVRJT046ICdhdXRoL2FkbWluLXJlc3RyaWN0ZWQtb3BlcmF0aW9uJyxcclxuICAgIEFSR1VNRU5UX0VSUk9SOiAnYXV0aC9hcmd1bWVudC1lcnJvcicsXHJcbiAgICBBUFBfTk9UX0FVVEhPUklaRUQ6ICdhdXRoL2FwcC1ub3QtYXV0aG9yaXplZCcsXHJcbiAgICBBUFBfTk9UX0lOU1RBTExFRDogJ2F1dGgvYXBwLW5vdC1pbnN0YWxsZWQnLFxyXG4gICAgQ0FQVENIQV9DSEVDS19GQUlMRUQ6ICdhdXRoL2NhcHRjaGEtY2hlY2stZmFpbGVkJyxcclxuICAgIENPREVfRVhQSVJFRDogJ2F1dGgvY29kZS1leHBpcmVkJyxcclxuICAgIENPUkRPVkFfTk9UX1JFQURZOiAnYXV0aC9jb3Jkb3ZhLW5vdC1yZWFkeScsXHJcbiAgICBDT1JTX1VOU1VQUE9SVEVEOiAnYXV0aC9jb3JzLXVuc3VwcG9ydGVkJyxcclxuICAgIENSRURFTlRJQUxfQUxSRUFEWV9JTl9VU0U6ICdhdXRoL2NyZWRlbnRpYWwtYWxyZWFkeS1pbi11c2UnLFxyXG4gICAgQ1JFREVOVElBTF9NSVNNQVRDSDogJ2F1dGgvY3VzdG9tLXRva2VuLW1pc21hdGNoJyxcclxuICAgIENSRURFTlRJQUxfVE9PX09MRF9MT0dJTl9BR0FJTjogJ2F1dGgvcmVxdWlyZXMtcmVjZW50LWxvZ2luJyxcclxuICAgIERFUEVOREVOVF9TREtfSU5JVF9CRUZPUkVfQVVUSDogJ2F1dGgvZGVwZW5kZW50LXNkay1pbml0aWFsaXplZC1iZWZvcmUtYXV0aCcsXHJcbiAgICBEWU5BTUlDX0xJTktfTk9UX0FDVElWQVRFRDogJ2F1dGgvZHluYW1pYy1saW5rLW5vdC1hY3RpdmF0ZWQnLFxyXG4gICAgRU1BSUxfQ0hBTkdFX05FRURTX1ZFUklGSUNBVElPTjogJ2F1dGgvZW1haWwtY2hhbmdlLW5lZWRzLXZlcmlmaWNhdGlvbicsXHJcbiAgICBFTUFJTF9FWElTVFM6ICdhdXRoL2VtYWlsLWFscmVhZHktaW4tdXNlJyxcclxuICAgIEVNVUxBVE9SX0NPTkZJR19GQUlMRUQ6ICdhdXRoL2VtdWxhdG9yLWNvbmZpZy1mYWlsZWQnLFxyXG4gICAgRVhQSVJFRF9PT0JfQ09ERTogJ2F1dGgvZXhwaXJlZC1hY3Rpb24tY29kZScsXHJcbiAgICBFWFBJUkVEX1BPUFVQX1JFUVVFU1Q6ICdhdXRoL2NhbmNlbGxlZC1wb3B1cC1yZXF1ZXN0JyxcclxuICAgIElOVEVSTkFMX0VSUk9SOiAnYXV0aC9pbnRlcm5hbC1lcnJvcicsXHJcbiAgICBJTlZBTElEX0FQSV9LRVk6ICdhdXRoL2ludmFsaWQtYXBpLWtleScsXHJcbiAgICBJTlZBTElEX0FQUF9DUkVERU5USUFMOiAnYXV0aC9pbnZhbGlkLWFwcC1jcmVkZW50aWFsJyxcclxuICAgIElOVkFMSURfQVBQX0lEOiAnYXV0aC9pbnZhbGlkLWFwcC1pZCcsXHJcbiAgICBJTlZBTElEX0FVVEg6ICdhdXRoL2ludmFsaWQtdXNlci10b2tlbicsXHJcbiAgICBJTlZBTElEX0FVVEhfRVZFTlQ6ICdhdXRoL2ludmFsaWQtYXV0aC1ldmVudCcsXHJcbiAgICBJTlZBTElEX0NFUlRfSEFTSDogJ2F1dGgvaW52YWxpZC1jZXJ0LWhhc2gnLFxyXG4gICAgSU5WQUxJRF9DT0RFOiAnYXV0aC9pbnZhbGlkLXZlcmlmaWNhdGlvbi1jb2RlJyxcclxuICAgIElOVkFMSURfQ09OVElOVUVfVVJJOiAnYXV0aC9pbnZhbGlkLWNvbnRpbnVlLXVyaScsXHJcbiAgICBJTlZBTElEX0NPUkRPVkFfQ09ORklHVVJBVElPTjogJ2F1dGgvaW52YWxpZC1jb3Jkb3ZhLWNvbmZpZ3VyYXRpb24nLFxyXG4gICAgSU5WQUxJRF9DVVNUT01fVE9LRU46ICdhdXRoL2ludmFsaWQtY3VzdG9tLXRva2VuJyxcclxuICAgIElOVkFMSURfRFlOQU1JQ19MSU5LX0RPTUFJTjogJ2F1dGgvaW52YWxpZC1keW5hbWljLWxpbmstZG9tYWluJyxcclxuICAgIElOVkFMSURfRU1BSUw6ICdhdXRoL2ludmFsaWQtZW1haWwnLFxyXG4gICAgSU5WQUxJRF9FTVVMQVRPUl9TQ0hFTUU6ICdhdXRoL2ludmFsaWQtZW11bGF0b3Itc2NoZW1lJyxcclxuICAgIElOVkFMSURfSURQX1JFU1BPTlNFOiAnYXV0aC9pbnZhbGlkLWNyZWRlbnRpYWwnLFxyXG4gICAgSU5WQUxJRF9MT0dJTl9DUkVERU5USUFMUzogJ2F1dGgvaW52YWxpZC1jcmVkZW50aWFsJyxcclxuICAgIElOVkFMSURfTUVTU0FHRV9QQVlMT0FEOiAnYXV0aC9pbnZhbGlkLW1lc3NhZ2UtcGF5bG9hZCcsXHJcbiAgICBJTlZBTElEX01GQV9TRVNTSU9OOiAnYXV0aC9pbnZhbGlkLW11bHRpLWZhY3Rvci1zZXNzaW9uJyxcclxuICAgIElOVkFMSURfT0FVVEhfQ0xJRU5UX0lEOiAnYXV0aC9pbnZhbGlkLW9hdXRoLWNsaWVudC1pZCcsXHJcbiAgICBJTlZBTElEX09BVVRIX1BST1ZJREVSOiAnYXV0aC9pbnZhbGlkLW9hdXRoLXByb3ZpZGVyJyxcclxuICAgIElOVkFMSURfT09CX0NPREU6ICdhdXRoL2ludmFsaWQtYWN0aW9uLWNvZGUnLFxyXG4gICAgSU5WQUxJRF9PUklHSU46ICdhdXRoL3VuYXV0aG9yaXplZC1kb21haW4nLFxyXG4gICAgSU5WQUxJRF9QQVNTV09SRDogJ2F1dGgvd3JvbmctcGFzc3dvcmQnLFxyXG4gICAgSU5WQUxJRF9QRVJTSVNURU5DRTogJ2F1dGgvaW52YWxpZC1wZXJzaXN0ZW5jZS10eXBlJyxcclxuICAgIElOVkFMSURfUEhPTkVfTlVNQkVSOiAnYXV0aC9pbnZhbGlkLXBob25lLW51bWJlcicsXHJcbiAgICBJTlZBTElEX1BST1ZJREVSX0lEOiAnYXV0aC9pbnZhbGlkLXByb3ZpZGVyLWlkJyxcclxuICAgIElOVkFMSURfUkVDSVBJRU5UX0VNQUlMOiAnYXV0aC9pbnZhbGlkLXJlY2lwaWVudC1lbWFpbCcsXHJcbiAgICBJTlZBTElEX1NFTkRFUjogJ2F1dGgvaW52YWxpZC1zZW5kZXInLFxyXG4gICAgSU5WQUxJRF9TRVNTSU9OX0lORk86ICdhdXRoL2ludmFsaWQtdmVyaWZpY2F0aW9uLWlkJyxcclxuICAgIElOVkFMSURfVEVOQU5UX0lEOiAnYXV0aC9pbnZhbGlkLXRlbmFudC1pZCcsXHJcbiAgICBNRkFfSU5GT19OT1RfRk9VTkQ6ICdhdXRoL211bHRpLWZhY3Rvci1pbmZvLW5vdC1mb3VuZCcsXHJcbiAgICBNRkFfUkVRVUlSRUQ6ICdhdXRoL211bHRpLWZhY3Rvci1hdXRoLXJlcXVpcmVkJyxcclxuICAgIE1JU1NJTkdfQU5EUk9JRF9QQUNLQUdFX05BTUU6ICdhdXRoL21pc3NpbmctYW5kcm9pZC1wa2ctbmFtZScsXHJcbiAgICBNSVNTSU5HX0FQUF9DUkVERU5USUFMOiAnYXV0aC9taXNzaW5nLWFwcC1jcmVkZW50aWFsJyxcclxuICAgIE1JU1NJTkdfQVVUSF9ET01BSU46ICdhdXRoL2F1dGgtZG9tYWluLWNvbmZpZy1yZXF1aXJlZCcsXHJcbiAgICBNSVNTSU5HX0NPREU6ICdhdXRoL21pc3NpbmctdmVyaWZpY2F0aW9uLWNvZGUnLFxyXG4gICAgTUlTU0lOR19DT05USU5VRV9VUkk6ICdhdXRoL21pc3NpbmctY29udGludWUtdXJpJyxcclxuICAgIE1JU1NJTkdfSUZSQU1FX1NUQVJUOiAnYXV0aC9taXNzaW5nLWlmcmFtZS1zdGFydCcsXHJcbiAgICBNSVNTSU5HX0lPU19CVU5ETEVfSUQ6ICdhdXRoL21pc3NpbmctaW9zLWJ1bmRsZS1pZCcsXHJcbiAgICBNSVNTSU5HX09SX0lOVkFMSURfTk9OQ0U6ICdhdXRoL21pc3Npbmctb3ItaW52YWxpZC1ub25jZScsXHJcbiAgICBNSVNTSU5HX01GQV9JTkZPOiAnYXV0aC9taXNzaW5nLW11bHRpLWZhY3Rvci1pbmZvJyxcclxuICAgIE1JU1NJTkdfTUZBX1NFU1NJT046ICdhdXRoL21pc3NpbmctbXVsdGktZmFjdG9yLXNlc3Npb24nLFxyXG4gICAgTUlTU0lOR19QSE9ORV9OVU1CRVI6ICdhdXRoL21pc3NpbmctcGhvbmUtbnVtYmVyJyxcclxuICAgIE1JU1NJTkdfU0VTU0lPTl9JTkZPOiAnYXV0aC9taXNzaW5nLXZlcmlmaWNhdGlvbi1pZCcsXHJcbiAgICBNT0RVTEVfREVTVFJPWUVEOiAnYXV0aC9hcHAtZGVsZXRlZCcsXHJcbiAgICBORUVEX0NPTkZJUk1BVElPTjogJ2F1dGgvYWNjb3VudC1leGlzdHMtd2l0aC1kaWZmZXJlbnQtY3JlZGVudGlhbCcsXHJcbiAgICBORVRXT1JLX1JFUVVFU1RfRkFJTEVEOiAnYXV0aC9uZXR3b3JrLXJlcXVlc3QtZmFpbGVkJyxcclxuICAgIE5VTExfVVNFUjogJ2F1dGgvbnVsbC11c2VyJyxcclxuICAgIE5PX0FVVEhfRVZFTlQ6ICdhdXRoL25vLWF1dGgtZXZlbnQnLFxyXG4gICAgTk9fU1VDSF9QUk9WSURFUjogJ2F1dGgvbm8tc3VjaC1wcm92aWRlcicsXHJcbiAgICBPUEVSQVRJT05fTk9UX0FMTE9XRUQ6ICdhdXRoL29wZXJhdGlvbi1ub3QtYWxsb3dlZCcsXHJcbiAgICBPUEVSQVRJT05fTk9UX1NVUFBPUlRFRDogJ2F1dGgvb3BlcmF0aW9uLW5vdC1zdXBwb3J0ZWQtaW4tdGhpcy1lbnZpcm9ubWVudCcsXHJcbiAgICBQT1BVUF9CTE9DS0VEOiAnYXV0aC9wb3B1cC1ibG9ja2VkJyxcclxuICAgIFBPUFVQX0NMT1NFRF9CWV9VU0VSOiAnYXV0aC9wb3B1cC1jbG9zZWQtYnktdXNlcicsXHJcbiAgICBQUk9WSURFUl9BTFJFQURZX0xJTktFRDogJ2F1dGgvcHJvdmlkZXItYWxyZWFkeS1saW5rZWQnLFxyXG4gICAgUVVPVEFfRVhDRUVERUQ6ICdhdXRoL3F1b3RhLWV4Y2VlZGVkJyxcclxuICAgIFJFRElSRUNUX0NBTkNFTExFRF9CWV9VU0VSOiAnYXV0aC9yZWRpcmVjdC1jYW5jZWxsZWQtYnktdXNlcicsXHJcbiAgICBSRURJUkVDVF9PUEVSQVRJT05fUEVORElORzogJ2F1dGgvcmVkaXJlY3Qtb3BlcmF0aW9uLXBlbmRpbmcnLFxyXG4gICAgUkVKRUNURURfQ1JFREVOVElBTDogJ2F1dGgvcmVqZWN0ZWQtY3JlZGVudGlhbCcsXHJcbiAgICBTRUNPTkRfRkFDVE9SX0FMUkVBRFlfRU5ST0xMRUQ6ICdhdXRoL3NlY29uZC1mYWN0b3ItYWxyZWFkeS1pbi11c2UnLFxyXG4gICAgU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRDogJ2F1dGgvbWF4aW11bS1zZWNvbmQtZmFjdG9yLWNvdW50LWV4Y2VlZGVkJyxcclxuICAgIFRFTkFOVF9JRF9NSVNNQVRDSDogJ2F1dGgvdGVuYW50LWlkLW1pc21hdGNoJyxcclxuICAgIFRJTUVPVVQ6ICdhdXRoL3RpbWVvdXQnLFxyXG4gICAgVE9LRU5fRVhQSVJFRDogJ2F1dGgvdXNlci10b2tlbi1leHBpcmVkJyxcclxuICAgIFRPT19NQU5ZX0FUVEVNUFRTX1RSWV9MQVRFUjogJ2F1dGgvdG9vLW1hbnktcmVxdWVzdHMnLFxyXG4gICAgVU5BVVRIT1JJWkVEX0RPTUFJTjogJ2F1dGgvdW5hdXRob3JpemVkLWNvbnRpbnVlLXVyaScsXHJcbiAgICBVTlNVUFBPUlRFRF9GSVJTVF9GQUNUT1I6ICdhdXRoL3Vuc3VwcG9ydGVkLWZpcnN0LWZhY3RvcicsXHJcbiAgICBVTlNVUFBPUlRFRF9QRVJTSVNURU5DRTogJ2F1dGgvdW5zdXBwb3J0ZWQtcGVyc2lzdGVuY2UtdHlwZScsXHJcbiAgICBVTlNVUFBPUlRFRF9URU5BTlRfT1BFUkFUSU9OOiAnYXV0aC91bnN1cHBvcnRlZC10ZW5hbnQtb3BlcmF0aW9uJyxcclxuICAgIFVOVkVSSUZJRURfRU1BSUw6ICdhdXRoL3VudmVyaWZpZWQtZW1haWwnLFxyXG4gICAgVVNFUl9DQU5DRUxMRUQ6ICdhdXRoL3VzZXItY2FuY2VsbGVkJyxcclxuICAgIFVTRVJfREVMRVRFRDogJ2F1dGgvdXNlci1ub3QtZm91bmQnLFxyXG4gICAgVVNFUl9ESVNBQkxFRDogJ2F1dGgvdXNlci1kaXNhYmxlZCcsXHJcbiAgICBVU0VSX01JU01BVENIOiAnYXV0aC91c2VyLW1pc21hdGNoJyxcclxuICAgIFVTRVJfU0lHTkVEX09VVDogJ2F1dGgvdXNlci1zaWduZWQtb3V0JyxcclxuICAgIFdFQUtfUEFTU1dPUkQ6ICdhdXRoL3dlYWstcGFzc3dvcmQnLFxyXG4gICAgV0VCX1NUT1JBR0VfVU5TVVBQT1JURUQ6ICdhdXRoL3dlYi1zdG9yYWdlLXVuc3VwcG9ydGVkJyxcclxuICAgIEFMUkVBRFlfSU5JVElBTElaRUQ6ICdhdXRoL2FscmVhZHktaW5pdGlhbGl6ZWQnLFxyXG4gICAgUkVDQVBUQ0hBX05PVF9FTkFCTEVEOiAnYXV0aC9yZWNhcHRjaGEtbm90LWVuYWJsZWQnLFxyXG4gICAgTUlTU0lOR19SRUNBUFRDSEFfVE9LRU46ICdhdXRoL21pc3NpbmctcmVjYXB0Y2hhLXRva2VuJyxcclxuICAgIElOVkFMSURfUkVDQVBUQ0hBX1RPS0VOOiAnYXV0aC9pbnZhbGlkLXJlY2FwdGNoYS10b2tlbicsXHJcbiAgICBJTlZBTElEX1JFQ0FQVENIQV9BQ1RJT046ICdhdXRoL2ludmFsaWQtcmVjYXB0Y2hhLWFjdGlvbicsXHJcbiAgICBNSVNTSU5HX0NMSUVOVF9UWVBFOiAnYXV0aC9taXNzaW5nLWNsaWVudC10eXBlJyxcclxuICAgIE1JU1NJTkdfUkVDQVBUQ0hBX1ZFUlNJT046ICdhdXRoL21pc3NpbmctcmVjYXB0Y2hhLXZlcnNpb24nLFxyXG4gICAgSU5WQUxJRF9SRUNBUFRDSEFfVkVSU0lPTjogJ2F1dGgvaW52YWxpZC1yZWNhcHRjaGEtdmVyc2lvbicsXHJcbiAgICBJTlZBTElEX1JFUV9UWVBFOiAnYXV0aC9pbnZhbGlkLXJlcS10eXBlJ1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBsb2dDbGllbnQgPSBuZXcgTG9nZ2VyKCdAZmlyZWJhc2UvYXV0aCcpO1xyXG5mdW5jdGlvbiBfbG9nV2Fybihtc2csIC4uLmFyZ3MpIHtcclxuICAgIGlmIChsb2dDbGllbnQubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuV0FSTikge1xyXG4gICAgICAgIGxvZ0NsaWVudC53YXJuKGBBdXRoICgke1NES19WRVJTSU9OfSk6ICR7bXNnfWAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF9sb2dFcnJvcihtc2csIC4uLmFyZ3MpIHtcclxuICAgIGlmIChsb2dDbGllbnQubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuRVJST1IpIHtcclxuICAgICAgICBsb2dDbGllbnQuZXJyb3IoYEF1dGggKCR7U0RLX1ZFUlNJT059KTogJHttc2d9YCwgLi4uYXJncyk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX2ZhaWwoYXV0aE9yQ29kZSwgLi4ucmVzdCkge1xyXG4gICAgdGhyb3cgY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KTtcclxufVxyXG5mdW5jdGlvbiBfY3JlYXRlRXJyb3IoYXV0aE9yQ29kZSwgLi4ucmVzdCkge1xyXG4gICAgcmV0dXJuIGNyZWF0ZUVycm9ySW50ZXJuYWwoYXV0aE9yQ29kZSwgLi4ucmVzdCk7XHJcbn1cclxuZnVuY3Rpb24gX2Vycm9yV2l0aEN1c3RvbU1lc3NhZ2UoYXV0aCwgY29kZSwgbWVzc2FnZSkge1xyXG4gICAgY29uc3QgZXJyb3JNYXAgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHByb2RFcnJvck1hcCgpKSwgeyBbY29kZV06IG1lc3NhZ2UgfSk7XHJcbiAgICBjb25zdCBmYWN0b3J5ID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIGVycm9yTWFwKTtcclxuICAgIHJldHVybiBmYWN0b3J5LmNyZWF0ZShjb2RlLCB7XHJcbiAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvcihhdXRoKSB7XHJcbiAgICByZXR1cm4gX2Vycm9yV2l0aEN1c3RvbU1lc3NhZ2UoYXV0aCwgXCJvcGVyYXRpb24tbm90LXN1cHBvcnRlZC1pbi10aGlzLWVudmlyb25tZW50XCIgLyogQXV0aEVycm9yQ29kZS5PUEVSQVRJT05fTk9UX1NVUFBPUlRFRCAqLywgJ09wZXJhdGlvbnMgdGhhdCBhbHRlciB0aGUgY3VycmVudCB1c2VyIGFyZSBub3Qgc3VwcG9ydGVkIGluIGNvbmp1bmN0aW9uIHdpdGggRmlyZWJhc2VTZXJ2ZXJBcHAnKTtcclxufVxyXG5mdW5jdGlvbiBfYXNzZXJ0SW5zdGFuY2VPZihhdXRoLCBvYmplY3QsIGluc3RhbmNlKSB7XHJcbiAgICBjb25zdCBjb25zdHJ1Y3Rvckluc3RhbmNlID0gaW5zdGFuY2U7XHJcbiAgICBpZiAoIShvYmplY3QgaW5zdGFuY2VvZiBjb25zdHJ1Y3Rvckluc3RhbmNlKSkge1xyXG4gICAgICAgIGlmIChjb25zdHJ1Y3Rvckluc3RhbmNlLm5hbWUgIT09IG9iamVjdC5jb25zdHJ1Y3Rvci5uYW1lKSB7XHJcbiAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgX2Vycm9yV2l0aEN1c3RvbU1lc3NhZ2UoYXV0aCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8sIGBUeXBlIG9mICR7b2JqZWN0LmNvbnN0cnVjdG9yLm5hbWV9IGRvZXMgbm90IG1hdGNoIGV4cGVjdGVkIGluc3RhbmNlLmAgK1xyXG4gICAgICAgICAgICBgRGlkIHlvdSBwYXNzIGEgcmVmZXJlbmNlIGZyb20gYSBkaWZmZXJlbnQgQXV0aCBTREs/YCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KSB7XHJcbiAgICBpZiAodHlwZW9mIGF1dGhPckNvZGUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgY29uc3QgY29kZSA9IHJlc3RbMF07XHJcbiAgICAgICAgY29uc3QgZnVsbFBhcmFtcyA9IFsuLi5yZXN0LnNsaWNlKDEpXTtcclxuICAgICAgICBpZiAoZnVsbFBhcmFtc1swXSkge1xyXG4gICAgICAgICAgICBmdWxsUGFyYW1zWzBdLmFwcE5hbWUgPSBhdXRoT3JDb2RlLm5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhdXRoT3JDb2RlLl9lcnJvckZhY3RvcnkuY3JlYXRlKGNvZGUsIC4uLmZ1bGxQYXJhbXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9ERUZBVUxUX0FVVEhfRVJST1JfRkFDVE9SWS5jcmVhdGUoYXV0aE9yQ29kZSwgLi4ucmVzdCk7XHJcbn1cclxuZnVuY3Rpb24gX2Fzc2VydChhc3NlcnRpb24sIGF1dGhPckNvZGUsIC4uLnJlc3QpIHtcclxuICAgIGlmICghYXNzZXJ0aW9uKSB7XHJcbiAgICAgICAgdGhyb3cgY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogVW5jb25kaXRpb25hbGx5IGZhaWxzLCB0aHJvd2luZyBhbiBpbnRlcm5hbCBlcnJvciB3aXRoIHRoZSBnaXZlbiBtZXNzYWdlLlxyXG4gKlxyXG4gKiBAcGFyYW0gZmFpbHVyZSB0eXBlIG9mIGZhaWx1cmUgZW5jb3VudGVyZWRcclxuICogQHRocm93cyBFcnJvclxyXG4gKi9cclxuZnVuY3Rpb24gZGVidWdGYWlsKGZhaWx1cmUpIHtcclxuICAgIC8vIExvZyB0aGUgZmFpbHVyZSBpbiBhZGRpdGlvbiB0byB0aHJvdyBhbiBleGNlcHRpb24sIGp1c3QgaW4gY2FzZSB0aGVcclxuICAgIC8vIGV4Y2VwdGlvbiBpcyBzd2FsbG93ZWQuXHJcbiAgICBjb25zdCBtZXNzYWdlID0gYElOVEVSTkFMIEFTU0VSVElPTiBGQUlMRUQ6IGAgKyBmYWlsdXJlO1xyXG4gICAgX2xvZ0Vycm9yKG1lc3NhZ2UpO1xyXG4gICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIEZpcmViYXNlRXJyb3IgaGVyZSBiZWNhdXNlIHRoZXNlIGFyZSBpbnRlcm5hbCBmYWlsdXJlc1xyXG4gICAgLy8gdGhhdCBjYW5ub3QgYmUgaGFuZGxlZCBieSB0aGUgdXNlci4gKEFsc28gaXQgd291bGQgY3JlYXRlIGEgY2lyY3VsYXJcclxuICAgIC8vIGRlcGVuZGVuY3kgYmV0d2VlbiB0aGUgZXJyb3IgYW5kIGFzc2VydCBtb2R1bGVzIHdoaWNoIGRvZXNuJ3Qgd29yay4pXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XHJcbn1cclxuLyoqXHJcbiAqIEZhaWxzIGlmIHRoZSBnaXZlbiBhc3NlcnRpb24gY29uZGl0aW9uIGlzIGZhbHNlLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZVxyXG4gKiBnaXZlbiBtZXNzYWdlIGlmIGl0IGRpZC5cclxuICpcclxuICogQHBhcmFtIGFzc2VydGlvblxyXG4gKiBAcGFyYW0gbWVzc2FnZVxyXG4gKi9cclxuZnVuY3Rpb24gZGVidWdBc3NlcnQoYXNzZXJ0aW9uLCBtZXNzYWdlKSB7XHJcbiAgICBpZiAoIWFzc2VydGlvbikge1xyXG4gICAgICAgIGRlYnVnRmFpbChtZXNzYWdlKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBfZ2V0Q3VycmVudFVybCgpIHtcclxuICAgIHZhciBfYTtcclxuICAgIHJldHVybiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmICgoX2EgPSBzZWxmLmxvY2F0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaHJlZikpIHx8ICcnO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0h0dHBPckh0dHBzKCkge1xyXG4gICAgcmV0dXJuIF9nZXRDdXJyZW50U2NoZW1lKCkgPT09ICdodHRwOicgfHwgX2dldEN1cnJlbnRTY2hlbWUoKSA9PT0gJ2h0dHBzOic7XHJcbn1cclxuZnVuY3Rpb24gX2dldEN1cnJlbnRTY2hlbWUoKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICByZXR1cm4gKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAoKF9hID0gc2VsZi5sb2NhdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByb3RvY29sKSkgfHwgbnVsbDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGJyb3dzZXIgaXMgd29ya2luZyBvbmxpbmVcclxuICovXHJcbmZ1bmN0aW9uIF9pc09ubGluZSgpIHtcclxuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJlxyXG4gICAgICAgIG5hdmlnYXRvciAmJlxyXG4gICAgICAgICdvbkxpbmUnIGluIG5hdmlnYXRvciAmJlxyXG4gICAgICAgIHR5cGVvZiBuYXZpZ2F0b3Iub25MaW5lID09PSAnYm9vbGVhbicgJiZcclxuICAgICAgICAvLyBBcHBseSBvbmx5IGZvciB0cmFkaXRpb25hbCB3ZWIgYXBwcyBhbmQgQ2hyb21lIGV4dGVuc2lvbnMuXHJcbiAgICAgICAgLy8gVGhpcyBpcyBlc3BlY2lhbGx5IHRydWUgZm9yIENvcmRvdmEgYXBwcyB3aGljaCBoYXZlIHVucmVsaWFibGVcclxuICAgICAgICAvLyBuYXZpZ2F0b3Iub25MaW5lIGJlaGF2aW9yIHVubGVzcyBjb3Jkb3ZhLXBsdWdpbi1uZXR3b3JrLWluZm9ybWF0aW9uIGlzXHJcbiAgICAgICAgLy8gaW5zdGFsbGVkIHdoaWNoIG92ZXJ3cml0ZXMgdGhlIG5hdGl2ZSBuYXZpZ2F0b3Iub25MaW5lIHZhbHVlIGFuZFxyXG4gICAgICAgIC8vIGRlZmluZXMgbmF2aWdhdG9yLmNvbm5lY3Rpb24uXHJcbiAgICAgICAgKF9pc0h0dHBPckh0dHBzKCkgfHwgaXNCcm93c2VyRXh0ZW5zaW9uKCkgfHwgJ2Nvbm5lY3Rpb24nIGluIG5hdmlnYXRvcikpIHtcclxuICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm9uTGluZTtcclxuICAgIH1cclxuICAgIC8vIElmIHdlIGNhbid0IGRldGVybWluZSB0aGUgc3RhdGUsIGFzc3VtZSBpdCBpcyBvbmxpbmUuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxyXG5mdW5jdGlvbiBfZ2V0VXNlckxhbmd1YWdlKCkge1xyXG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBuYXZpZ2F0b3JMYW5ndWFnZSA9IG5hdmlnYXRvcjtcclxuICAgIHJldHVybiAoXHJcbiAgICAvLyBNb3N0IHJlbGlhYmxlLCBidXQgb25seSBzdXBwb3J0ZWQgaW4gQ2hyb21lL0ZpcmVmb3guXHJcbiAgICAobmF2aWdhdG9yTGFuZ3VhZ2UubGFuZ3VhZ2VzICYmIG5hdmlnYXRvckxhbmd1YWdlLmxhbmd1YWdlc1swXSkgfHxcclxuICAgICAgICAvLyBTdXBwb3J0ZWQgaW4gbW9zdCBicm93c2VycywgYnV0IHJldHVybnMgdGhlIGxhbmd1YWdlIG9mIHRoZSBicm93c2VyXHJcbiAgICAgICAgLy8gVUksIG5vdCB0aGUgbGFuZ3VhZ2Ugc2V0IGluIGJyb3dzZXIgc2V0dGluZ3MuXHJcbiAgICAgICAgbmF2aWdhdG9yTGFuZ3VhZ2UubGFuZ3VhZ2UgfHxcclxuICAgICAgICAvLyBDb3VsZG4ndCBkZXRlcm1pbmUgbGFuZ3VhZ2UuXHJcbiAgICAgICAgbnVsbCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEEgc3RydWN0dXJlIHRvIGhlbHAgcGljayBiZXR3ZWVuIGEgcmFuZ2Ugb2YgbG9uZyBhbmQgc2hvcnQgZGVsYXkgZHVyYXRpb25zXHJcbiAqIGRlcGVuZGluZyBvbiB0aGUgY3VycmVudCBlbnZpcm9ubWVudC4gSW4gZ2VuZXJhbCwgdGhlIGxvbmcgZGVsYXkgaXMgdXNlZCBmb3JcclxuICogbW9iaWxlIGVudmlyb25tZW50cyB3aGVyZWFzIHNob3J0IGRlbGF5cyBhcmUgdXNlZCBmb3IgZGVza3RvcCBlbnZpcm9ubWVudHMuXHJcbiAqL1xyXG5jbGFzcyBEZWxheSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzaG9ydERlbGF5LCBsb25nRGVsYXkpIHtcclxuICAgICAgICB0aGlzLnNob3J0RGVsYXkgPSBzaG9ydERlbGF5O1xyXG4gICAgICAgIHRoaXMubG9uZ0RlbGF5ID0gbG9uZ0RlbGF5O1xyXG4gICAgICAgIC8vIEludGVybmFsIGVycm9yIHdoZW4gaW1wcm9wZXJseSBpbml0aWFsaXplZC5cclxuICAgICAgICBkZWJ1Z0Fzc2VydChsb25nRGVsYXkgPiBzaG9ydERlbGF5LCAnU2hvcnQgZGVsYXkgc2hvdWxkIGJlIGxlc3MgdGhhbiBsb25nIGRlbGF5IScpO1xyXG4gICAgICAgIHRoaXMuaXNNb2JpbGUgPSBpc01vYmlsZUNvcmRvdmEoKSB8fCBpc1JlYWN0TmF0aXZlKCk7XHJcbiAgICB9XHJcbiAgICBnZXQoKSB7XHJcbiAgICAgICAgaWYgKCFfaXNPbmxpbmUoKSkge1xyXG4gICAgICAgICAgICAvLyBQaWNrIHRoZSBzaG9ydGVyIHRpbWVvdXQuXHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbig1MDAwIC8qIERlbGF5TWluLk9GRkxJTkUgKi8sIHRoaXMuc2hvcnREZWxheSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIElmIHJ1bm5pbmcgaW4gYSBtb2JpbGUgZW52aXJvbm1lbnQsIHJldHVybiB0aGUgbG9uZyBkZWxheSwgb3RoZXJ3aXNlXHJcbiAgICAgICAgLy8gcmV0dXJuIHRoZSBzaG9ydCBkZWxheS5cclxuICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIGltcHJvdmVkIGluIHRoZSBmdXR1cmUgdG8gZHluYW1pY2FsbHkgY2hhbmdlIGJhc2VkIG9uIG90aGVyXHJcbiAgICAgICAgLy8gdmFyaWFibGVzIGluc3RlYWQgb2YganVzdCByZWFkaW5nIHRoZSBjdXJyZW50IGVudmlyb25tZW50LlxyXG4gICAgICAgIHJldHVybiB0aGlzLmlzTW9iaWxlID8gdGhpcy5sb25nRGVsYXkgOiB0aGlzLnNob3J0RGVsYXk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX2VtdWxhdG9yVXJsKGNvbmZpZywgcGF0aCkge1xyXG4gICAgZGVidWdBc3NlcnQoY29uZmlnLmVtdWxhdG9yLCAnRW11bGF0b3Igc2hvdWxkIGFsd2F5cyBiZSBzZXQgaGVyZScpO1xyXG4gICAgY29uc3QgeyB1cmwgfSA9IGNvbmZpZy5lbXVsYXRvcjtcclxuICAgIGlmICghcGF0aCkge1xyXG4gICAgICAgIHJldHVybiB1cmw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYCR7dXJsfSR7cGF0aC5zdGFydHNXaXRoKCcvJykgPyBwYXRoLnNsaWNlKDEpIDogcGF0aH1gO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIEZldGNoUHJvdmlkZXIge1xyXG4gICAgc3RhdGljIGluaXRpYWxpemUoZmV0Y2hJbXBsLCBoZWFkZXJzSW1wbCwgcmVzcG9uc2VJbXBsKSB7XHJcbiAgICAgICAgdGhpcy5mZXRjaEltcGwgPSBmZXRjaEltcGw7XHJcbiAgICAgICAgaWYgKGhlYWRlcnNJbXBsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGVhZGVyc0ltcGwgPSBoZWFkZXJzSW1wbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlSW1wbCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlSW1wbCA9IHJlc3BvbnNlSW1wbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZmV0Y2goKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZmV0Y2hJbXBsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoSW1wbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAnZmV0Y2gnIGluIHNlbGYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZmV0Y2g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2xvYmFsVGhpcy5mZXRjaCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2xvYmFsVGhpcy5mZXRjaDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBmZXRjaCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZldGNoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZWJ1Z0ZhaWwoJ0NvdWxkIG5vdCBmaW5kIGZldGNoIGltcGxlbWVudGF0aW9uLCBtYWtlIHN1cmUgeW91IGNhbGwgRmV0Y2hQcm92aWRlci5pbml0aWFsaXplKCkgd2l0aCBhbiBhcHByb3ByaWF0ZSBwb2x5ZmlsbCcpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGhlYWRlcnMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaGVhZGVyc0ltcGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGVhZGVyc0ltcGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgJ0hlYWRlcnMnIGluIHNlbGYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuSGVhZGVycztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyAmJiBnbG9iYWxUaGlzLkhlYWRlcnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdsb2JhbFRoaXMuSGVhZGVycztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBIZWFkZXJzICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICByZXR1cm4gSGVhZGVycztcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVidWdGYWlsKCdDb3VsZCBub3QgZmluZCBIZWFkZXJzIGltcGxlbWVudGF0aW9uLCBtYWtlIHN1cmUgeW91IGNhbGwgRmV0Y2hQcm92aWRlci5pbml0aWFsaXplKCkgd2l0aCBhbiBhcHByb3ByaWF0ZSBwb2x5ZmlsbCcpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIHJlc3BvbnNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJlc3BvbnNlSW1wbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXNwb25zZUltcGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgJ1Jlc3BvbnNlJyBpbiBzZWxmKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZWxmLlJlc3BvbnNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbFRoaXMuUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdsb2JhbFRoaXMuUmVzcG9uc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBSZXNwb25zZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVidWdGYWlsKCdDb3VsZCBub3QgZmluZCBSZXNwb25zZSBpbXBsZW1lbnRhdGlvbiwgbWFrZSBzdXJlIHlvdSBjYWxsIEZldGNoUHJvdmlkZXIuaW5pdGlhbGl6ZSgpIHdpdGggYW4gYXBwcm9wcmlhdGUgcG9seWZpbGwnKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogTWFwIGZyb20gZXJyb3JzIHJldHVybmVkIGJ5IHRoZSBzZXJ2ZXIgdG8gZXJyb3JzIHRvIGRldmVsb3BlciB2aXNpYmxlIGVycm9yc1xyXG4gKi9cclxuY29uc3QgU0VSVkVSX0VSUk9SX01BUCA9IHtcclxuICAgIC8vIEN1c3RvbSB0b2tlbiBlcnJvcnMuXHJcbiAgICBbXCJDUkVERU5USUFMX01JU01BVENIXCIgLyogU2VydmVyRXJyb3IuQ1JFREVOVElBTF9NSVNNQVRDSCAqL106IFwiY3VzdG9tLXRva2VuLW1pc21hdGNoXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX01JU01BVENIICovLFxyXG4gICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0LlxyXG4gICAgW1wiTUlTU0lOR19DVVNUT01fVE9LRU5cIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0NVU1RPTV9UT0tFTiAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLFxyXG4gICAgLy8gQ3JlYXRlIEF1dGggVVJJIGVycm9ycy5cclxuICAgIFtcIklOVkFMSURfSURFTlRJRklFUlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfSURFTlRJRklFUiAqL106IFwiaW52YWxpZC1lbWFpbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9FTUFJTCAqLyxcclxuICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC5cclxuICAgIFtcIk1JU1NJTkdfQ09OVElOVUVfVVJJXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DT05USU5VRV9VUkkgKi9dOiBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyxcclxuICAgIC8vIFNpZ24gaW4gd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQgZXJyb3JzIChzb21lIGFwcGx5IHRvIHNpZ24gdXAgdG9vKS5cclxuICAgIFtcIklOVkFMSURfUEFTU1dPUkRcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1BBU1NXT1JEICovXTogXCJ3cm9uZy1wYXNzd29yZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9QQVNTV09SRCAqLyxcclxuICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC5cclxuICAgIFtcIk1JU1NJTkdfUEFTU1dPUkRcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1BBU1NXT1JEICovXTogXCJtaXNzaW5nLXBhc3N3b3JkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1BBU1NXT1JEICovLFxyXG4gICAgLy8gVGhyb3duIGlmIEVtYWlsIEVudW1lcmF0aW9uIFByb3RlY3Rpb24gaXMgZW5hYmxlZCBpbiB0aGUgcHJvamVjdCBhbmQgdGhlIGVtYWlsIG9yIHBhc3N3b3JkIGlzXHJcbiAgICAvLyBpbnZhbGlkLlxyXG4gICAgW1wiSU5WQUxJRF9MT0dJTl9DUkVERU5USUFMU1wiIC8qIFNlcnZlckVycm9yLklOVkFMSURfTE9HSU5fQ1JFREVOVElBTFMgKi9dOiBcImludmFsaWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DUkVERU5USUFMICovLFxyXG4gICAgLy8gU2lnbiB1cCB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZCBlcnJvcnMuXHJcbiAgICBbXCJFTUFJTF9FWElTVFNcIiAvKiBTZXJ2ZXJFcnJvci5FTUFJTF9FWElTVFMgKi9dOiBcImVtYWlsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5FTUFJTF9FWElTVFMgKi8sXHJcbiAgICBbXCJQQVNTV09SRF9MT0dJTl9ESVNBQkxFRFwiIC8qIFNlcnZlckVycm9yLlBBU1NXT1JEX0xPR0lOX0RJU0FCTEVEICovXTogXCJvcGVyYXRpb24tbm90LWFsbG93ZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk9QRVJBVElPTl9OT1RfQUxMT1dFRCAqLyxcclxuICAgIC8vIFZlcmlmeSBhc3NlcnRpb24gZm9yIHNpZ24gaW4gd2l0aCBjcmVkZW50aWFsIGVycm9yczpcclxuICAgIFtcIklOVkFMSURfSURQX1JFU1BPTlNFXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9JRFBfUkVTUE9OU0UgKi9dOiBcImludmFsaWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DUkVERU5USUFMICovLFxyXG4gICAgW1wiSU5WQUxJRF9QRU5ESU5HX1RPS0VOXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9QRU5ESU5HX1RPS0VOICovXTogXCJpbnZhbGlkLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ1JFREVOVElBTCAqLyxcclxuICAgIFtcIkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEXCIgLyogU2VydmVyRXJyb3IuRkVERVJBVEVEX1VTRVJfSURfQUxSRUFEWV9MSU5LRUQgKi9dOiBcImNyZWRlbnRpYWwtYWxyZWFkeS1pbi11c2VcIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfQUxSRUFEWV9JTl9VU0UgKi8sXHJcbiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuXHJcbiAgICBbXCJNSVNTSU5HX1JFUV9UWVBFXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19SRVFfVFlQRSAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLFxyXG4gICAgLy8gU2VuZCBQYXNzd29yZCByZXNldCBlbWFpbCBlcnJvcnM6XHJcbiAgICBbXCJFTUFJTF9OT1RfRk9VTkRcIiAvKiBTZXJ2ZXJFcnJvci5FTUFJTF9OT1RfRk9VTkQgKi9dOiBcInVzZXItbm90LWZvdW5kXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RFTEVURUQgKi8sXHJcbiAgICBbXCJSRVNFVF9QQVNTV09SRF9FWENFRURfTElNSVRcIiAvKiBTZXJ2ZXJFcnJvci5SRVNFVF9QQVNTV09SRF9FWENFRURfTElNSVQgKi9dOiBcInRvby1tYW55LXJlcXVlc3RzXCIgLyogQXV0aEVycm9yQ29kZS5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi8sXHJcbiAgICBbXCJFWFBJUkVEX09PQl9DT0RFXCIgLyogU2VydmVyRXJyb3IuRVhQSVJFRF9PT0JfQ09ERSAqL106IFwiZXhwaXJlZC1hY3Rpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuRVhQSVJFRF9PT0JfQ09ERSAqLyxcclxuICAgIFtcIklOVkFMSURfT09CX0NPREVcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX09PQl9DT0RFICovXTogXCJpbnZhbGlkLWFjdGlvbi1jb2RlXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX09PQl9DT0RFICovLFxyXG4gICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0LlxyXG4gICAgW1wiTUlTU0lOR19PT0JfQ09ERVwiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfT09CX0NPREUgKi9dOiBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyxcclxuICAgIC8vIE9wZXJhdGlvbnMgdGhhdCByZXF1aXJlIElEIHRva2VuIGluIHJlcXVlc3Q6XHJcbiAgICBbXCJDUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU5cIiAvKiBTZXJ2ZXJFcnJvci5DUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU4gKi9dOiBcInJlcXVpcmVzLXJlY2VudC1sb2dpblwiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOICovLFxyXG4gICAgW1wiSU5WQUxJRF9JRF9UT0tFTlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfSURfVE9LRU4gKi9dOiBcImludmFsaWQtdXNlci10b2tlblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BVVRIICovLFxyXG4gICAgW1wiVE9LRU5fRVhQSVJFRFwiIC8qIFNlcnZlckVycm9yLlRPS0VOX0VYUElSRUQgKi9dOiBcInVzZXItdG9rZW4tZXhwaXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqLyxcclxuICAgIFtcIlVTRVJfTk9UX0ZPVU5EXCIgLyogU2VydmVyRXJyb3IuVVNFUl9OT1RfRk9VTkQgKi9dOiBcInVzZXItdG9rZW4tZXhwaXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqLyxcclxuICAgIC8vIE90aGVyIGVycm9ycy5cclxuICAgIFtcIlRPT19NQU5ZX0FUVEVNUFRTX1RSWV9MQVRFUlwiIC8qIFNlcnZlckVycm9yLlRPT19NQU5ZX0FUVEVNUFRTX1RSWV9MQVRFUiAqL106IFwidG9vLW1hbnktcmVxdWVzdHNcIiAvKiBBdXRoRXJyb3JDb2RlLlRPT19NQU5ZX0FUVEVNUFRTX1RSWV9MQVRFUiAqLyxcclxuICAgIFtcIlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTXCIgLyogU2VydmVyRXJyb3IuUEFTU1dPUkRfRE9FU19OT1RfTUVFVF9SRVFVSVJFTUVOVFMgKi9dOiBcInBhc3N3b3JkLWRvZXMtbm90LW1lZXQtcmVxdWlyZW1lbnRzXCIgLyogQXV0aEVycm9yQ29kZS5QQVNTV09SRF9ET0VTX05PVF9NRUVUX1JFUVVJUkVNRU5UUyAqLyxcclxuICAgIC8vIFBob25lIEF1dGggcmVsYXRlZCBlcnJvcnMuXHJcbiAgICBbXCJJTlZBTElEX0NPREVcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX0NPREUgKi9dOiBcImludmFsaWQtdmVyaWZpY2F0aW9uLWNvZGVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ09ERSAqLyxcclxuICAgIFtcIklOVkFMSURfU0VTU0lPTl9JTkZPXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9TRVNTSU9OX0lORk8gKi9dOiBcImludmFsaWQtdmVyaWZpY2F0aW9uLWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1NFU1NJT05fSU5GTyAqLyxcclxuICAgIFtcIklOVkFMSURfVEVNUE9SQVJZX1BST09GXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9URU1QT1JBUllfUFJPT0YgKi9dOiBcImludmFsaWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DUkVERU5USUFMICovLFxyXG4gICAgW1wiTUlTU0lOR19TRVNTSU9OX0lORk9cIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1NFU1NJT05fSU5GTyAqL106IFwibWlzc2luZy12ZXJpZmljYXRpb24taWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfU0VTU0lPTl9JTkZPICovLFxyXG4gICAgW1wiU0VTU0lPTl9FWFBJUkVEXCIgLyogU2VydmVyRXJyb3IuU0VTU0lPTl9FWFBJUkVEICovXTogXCJjb2RlLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkNPREVfRVhQSVJFRCAqLyxcclxuICAgIC8vIE90aGVyIGFjdGlvbiBjb2RlIGVycm9ycyB3aGVuIGFkZGl0aW9uYWwgc2V0dGluZ3MgcGFzc2VkLlxyXG4gICAgLy8gTUlTU0lOR19DT05USU5VRV9VUkkgaXMgZ2V0dGluZyBtYXBwZWQgdG8gSU5URVJOQUxfRVJST1IgYWJvdmUuXHJcbiAgICAvLyBUaGlzIGlzIE9LIGFzIHRoaXMgZXJyb3Igd2lsbCBiZSBjYXVnaHQgYnkgY2xpZW50IHNpZGUgdmFsaWRhdGlvbi5cclxuICAgIFtcIk1JU1NJTkdfQU5EUk9JRF9QQUNLQUdFX05BTUVcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FICovXTogXCJtaXNzaW5nLWFuZHJvaWQtcGtnLW5hbWVcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQU5EUk9JRF9QQUNLQUdFX05BTUUgKi8sXHJcbiAgICBbXCJVTkFVVEhPUklaRURfRE9NQUlOXCIgLyogU2VydmVyRXJyb3IuVU5BVVRIT1JJWkVEX0RPTUFJTiAqL106IFwidW5hdXRob3JpemVkLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuVU5BVVRIT1JJWkVEX0RPTUFJTiAqLyxcclxuICAgIC8vIGdldFByb2plY3RDb25maWcgZXJyb3JzIHdoZW4gY2xpZW50SWQgaXMgcGFzc2VkLlxyXG4gICAgW1wiSU5WQUxJRF9PQVVUSF9DTElFTlRfSURcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX09BVVRIX0NMSUVOVF9JRCAqL106IFwiaW52YWxpZC1vYXV0aC1jbGllbnQtaWRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT0FVVEhfQ0xJRU5UX0lEICovLFxyXG4gICAgLy8gVXNlciBhY3Rpb25zIChzaWduLXVwIG9yIGRlbGV0aW9uKSBkaXNhYmxlZCBlcnJvcnMuXHJcbiAgICBbXCJBRE1JTl9PTkxZX09QRVJBVElPTlwiIC8qIFNlcnZlckVycm9yLkFETUlOX09OTFlfT1BFUkFUSU9OICovXTogXCJhZG1pbi1yZXN0cmljdGVkLW9wZXJhdGlvblwiIC8qIEF1dGhFcnJvckNvZGUuQURNSU5fT05MWV9PUEVSQVRJT04gKi8sXHJcbiAgICAvLyBNdWx0aSBmYWN0b3IgcmVsYXRlZCBlcnJvcnMuXHJcbiAgICBbXCJJTlZBTElEX01GQV9QRU5ESU5HX0NSRURFTlRJQUxcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX01GQV9QRU5ESU5HX0NSRURFTlRJQUwgKi9dOiBcImludmFsaWQtbXVsdGktZmFjdG9yLXNlc3Npb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfTUZBX1NFU1NJT04gKi8sXHJcbiAgICBbXCJNRkFfRU5ST0xMTUVOVF9OT1RfRk9VTkRcIiAvKiBTZXJ2ZXJFcnJvci5NRkFfRU5ST0xMTUVOVF9OT1RfRk9VTkQgKi9dOiBcIm11bHRpLWZhY3Rvci1pbmZvLW5vdC1mb3VuZFwiIC8qIEF1dGhFcnJvckNvZGUuTUZBX0lORk9fTk9UX0ZPVU5EICovLFxyXG4gICAgW1wiTUlTU0lOR19NRkFfRU5ST0xMTUVOVF9JRFwiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfTUZBX0VOUk9MTE1FTlRfSUQgKi9dOiBcIm1pc3NpbmctbXVsdGktZmFjdG9yLWluZm9cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX0lORk8gKi8sXHJcbiAgICBbXCJNSVNTSU5HX01GQV9QRU5ESU5HX0NSRURFTlRJQUxcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX01GQV9QRU5ESU5HX0NSRURFTlRJQUwgKi9dOiBcIm1pc3NpbmctbXVsdGktZmFjdG9yLXNlc3Npb25cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX1NFU1NJT04gKi8sXHJcbiAgICBbXCJTRUNPTkRfRkFDVE9SX0VYSVNUU1wiIC8qIFNlcnZlckVycm9yLlNFQ09ORF9GQUNUT1JfRVhJU1RTICovXTogXCJzZWNvbmQtZmFjdG9yLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5TRUNPTkRfRkFDVE9SX0FMUkVBRFlfRU5ST0xMRUQgKi8sXHJcbiAgICBbXCJTRUNPTkRfRkFDVE9SX0xJTUlUX0VYQ0VFREVEXCIgLyogU2VydmVyRXJyb3IuU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRCAqL106IFwibWF4aW11bS1zZWNvbmQtZmFjdG9yLWNvdW50LWV4Y2VlZGVkXCIgLyogQXV0aEVycm9yQ29kZS5TRUNPTkRfRkFDVE9SX0xJTUlUX0VYQ0VFREVEICovLFxyXG4gICAgLy8gQmxvY2tpbmcgZnVuY3Rpb25zIHJlbGF0ZWQgZXJyb3JzLlxyXG4gICAgW1wiQkxPQ0tJTkdfRlVOQ1RJT05fRVJST1JfUkVTUE9OU0VcIiAvKiBTZXJ2ZXJFcnJvci5CTE9DS0lOR19GVU5DVElPTl9FUlJPUl9SRVNQT05TRSAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLFxyXG4gICAgLy8gUmVjYXB0Y2hhIHJlbGF0ZWQgZXJyb3JzLlxyXG4gICAgW1wiUkVDQVBUQ0hBX05PVF9FTkFCTEVEXCIgLyogU2VydmVyRXJyb3IuUkVDQVBUQ0hBX05PVF9FTkFCTEVEICovXTogXCJyZWNhcHRjaGEtbm90LWVuYWJsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlJFQ0FQVENIQV9OT1RfRU5BQkxFRCAqLyxcclxuICAgIFtcIk1JU1NJTkdfUkVDQVBUQ0hBX1RPS0VOXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19SRUNBUFRDSEFfVE9LRU4gKi9dOiBcIm1pc3NpbmctcmVjYXB0Y2hhLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqLyxcclxuICAgIFtcIklOVkFMSURfUkVDQVBUQ0hBX1RPS0VOXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRUNBUFRDSEFfVE9LRU4gKi9dOiBcImludmFsaWQtcmVjYXB0Y2hhLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0FQVENIQV9UT0tFTiAqLyxcclxuICAgIFtcIklOVkFMSURfUkVDQVBUQ0hBX0FDVElPTlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfUkVDQVBUQ0hBX0FDVElPTiAqL106IFwiaW52YWxpZC1yZWNhcHRjaGEtYWN0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0FQVENIQV9BQ1RJT04gKi8sXHJcbiAgICBbXCJNSVNTSU5HX0NMSUVOVF9UWVBFXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DTElFTlRfVFlQRSAqL106IFwibWlzc2luZy1jbGllbnQtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19DTElFTlRfVFlQRSAqLyxcclxuICAgIFtcIk1JU1NJTkdfUkVDQVBUQ0hBX1ZFUlNJT05cIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1JFQ0FQVENIQV9WRVJTSU9OICovXTogXCJtaXNzaW5nLXJlY2FwdGNoYS12ZXJzaW9uXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9WRVJTSU9OICovLFxyXG4gICAgW1wiSU5WQUxJRF9SRUNBUFRDSEFfVkVSU0lPTlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfUkVDQVBUQ0hBX1ZFUlNJT04gKi9dOiBcImludmFsaWQtcmVjYXB0Y2hhLXZlcnNpb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUkVDQVBUQ0hBX1ZFUlNJT04gKi8sXHJcbiAgICBbXCJJTlZBTElEX1JFUV9UWVBFXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRVFfVFlQRSAqL106IFwiaW52YWxpZC1yZXEtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRVFfVFlQRSAqL1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX0FQSV9USU1FT1VUX01TID0gbmV3IERlbGF5KDMwMDAwLCA2MDAwMCk7XHJcbmZ1bmN0aW9uIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICBpZiAoYXV0aC50ZW5hbnRJZCAmJiAhcmVxdWVzdC50ZW5hbnRJZCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlcXVlc3QpLCB7IHRlbmFudElkOiBhdXRoLnRlbmFudElkIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlcXVlc3Q7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIG1ldGhvZCwgcGF0aCwgcmVxdWVzdCwgY3VzdG9tRXJyb3JNYXAgPSB7fSkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtRmV0Y2hXaXRoRXJyb3JIYW5kbGluZyhhdXRoLCBjdXN0b21FcnJvck1hcCwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGxldCBib2R5ID0ge307XHJcbiAgICAgICAgbGV0IHBhcmFtcyA9IHt9O1xyXG4gICAgICAgIGlmIChyZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgIGlmIChtZXRob2QgPT09IFwiR0VUXCIgLyogSHR0cE1ldGhvZC5HRVQgKi8pIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHJlcXVlc3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBib2R5ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gcXVlcnlzdHJpbmcoT2JqZWN0LmFzc2lnbih7IGtleTogYXV0aC5jb25maWcuYXBpS2V5IH0sIHBhcmFtcykpLnNsaWNlKDEpO1xyXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSBhd2FpdCBhdXRoLl9nZXRBZGRpdGlvbmFsSGVhZGVycygpO1xyXG4gICAgICAgIGhlYWRlcnNbXCJDb250ZW50LVR5cGVcIiAvKiBIdHRwSGVhZGVyLkNPTlRFTlRfVFlQRSAqL10gPSAnYXBwbGljYXRpb24vanNvbic7XHJcbiAgICAgICAgaWYgKGF1dGgubGFuZ3VhZ2VDb2RlKSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnNbXCJYLUZpcmViYXNlLUxvY2FsZVwiIC8qIEh0dHBIZWFkZXIuWF9GSVJFQkFTRV9MT0NBTEUgKi9dID0gYXV0aC5sYW5ndWFnZUNvZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGZldGNoQXJncyA9IE9iamVjdC5hc3NpZ24oeyBtZXRob2QsXHJcbiAgICAgICAgICAgIGhlYWRlcnMgfSwgYm9keSk7XHJcbiAgICAgICAgLyogU2VjdXJpdHktY29uc2Npb3VzIHNlcnZlci1zaWRlIGZyYW1ld29ya3MgdGVuZCB0byBoYXZlIGJ1aWx0IGluIG1pdGlnYXRpb25zIGZvciByZWZlcnJlclxyXG4gICAgICAgICAgIHByb2JsZW1zXCIuIFNlZSB0aGUgQ2xvdWRmbGFyZSBHaXRIdWIgaXNzdWUgIzQ4NzogRXJyb3I6IFRoZSAncmVmZXJyZXJQb2xpY3knIGZpZWxkIG9uXHJcbiAgICAgICAgICAgJ1JlcXVlc3RJbml0aWFsaXplckRpY3QnIGlzIG5vdCBpbXBsZW1lbnRlZC5cIlxyXG4gICAgICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9jbG91ZGZsYXJlL25leHQtb24tcGFnZXMvaXNzdWVzLzQ4NyAqL1xyXG4gICAgICAgIGlmICghaXNDbG91ZGZsYXJlV29ya2VyKCkpIHtcclxuICAgICAgICAgICAgZmV0Y2hBcmdzLnJlZmVycmVyUG9saWN5ID0gJ25vLXJlZmVycmVyJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIEZldGNoUHJvdmlkZXIuZmV0Y2goKShfZ2V0RmluYWxUYXJnZXQoYXV0aCwgYXV0aC5jb25maWcuYXBpSG9zdCwgcGF0aCwgcXVlcnkpLCBmZXRjaEFyZ3MpO1xyXG4gICAgfSk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIGN1c3RvbUVycm9yTWFwLCBmZXRjaEZuKSB7XHJcbiAgICBhdXRoLl9jYW5Jbml0RW11bGF0b3IgPSBmYWxzZTtcclxuICAgIGNvbnN0IGVycm9yTWFwID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBTRVJWRVJfRVJST1JfTUFQKSwgY3VzdG9tRXJyb3JNYXApO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBuZXR3b3JrVGltZW91dCA9IG5ldyBOZXR3b3JrVGltZW91dChhdXRoKTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFByb21pc2UucmFjZShbXHJcbiAgICAgICAgICAgIGZldGNoRm4oKSxcclxuICAgICAgICAgICAgbmV0d29ya1RpbWVvdXQucHJvbWlzZVxyXG4gICAgICAgIF0pO1xyXG4gICAgICAgIC8vIElmIHdlJ3ZlIHJlYWNoZWQgdGhpcyBwb2ludCwgdGhlIGZldGNoIHN1Y2NlZWRlZCBhbmQgdGhlIG5ldHdvcmtUaW1lb3V0XHJcbiAgICAgICAgLy8gZGlkbid0IHRocm93OyBjbGVhciB0aGUgbmV0d29yayB0aW1lb3V0IGRlbGF5IHNvIHRoYXQgTm9kZSB3b24ndCBoYW5nXHJcbiAgICAgICAgbmV0d29ya1RpbWVvdXQuY2xlYXJOZXR3b3JrVGltZW91dCgpO1xyXG4gICAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgaWYgKCduZWVkQ29uZmlybWF0aW9uJyBpbiBqc29uKSB7XHJcbiAgICAgICAgICAgIHRocm93IF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgXCJhY2NvdW50LWV4aXN0cy13aXRoLWRpZmZlcmVudC1jcmVkZW50aWFsXCIgLyogQXV0aEVycm9yQ29kZS5ORUVEX0NPTkZJUk1BVElPTiAqLywganNvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNwb25zZS5vayAmJiAhKCdlcnJvck1lc3NhZ2UnIGluIGpzb24pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBqc29uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gcmVzcG9uc2Uub2sgPyBqc29uLmVycm9yTWVzc2FnZSA6IGpzb24uZXJyb3IubWVzc2FnZTtcclxuICAgICAgICAgICAgY29uc3QgW3NlcnZlckVycm9yQ29kZSwgc2VydmVyRXJyb3JNZXNzYWdlXSA9IGVycm9yTWVzc2FnZS5zcGxpdCgnIDogJyk7XHJcbiAgICAgICAgICAgIGlmIChzZXJ2ZXJFcnJvckNvZGUgPT09IFwiRkVERVJBVEVEX1VTRVJfSURfQUxSRUFEWV9MSU5LRURcIiAvKiBTZXJ2ZXJFcnJvci5GRURFUkFURURfVVNFUl9JRF9BTFJFQURZX0xJTktFRCAqLykge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCBcImNyZWRlbnRpYWwtYWxyZWFkeS1pbi11c2VcIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfQUxSRUFEWV9JTl9VU0UgKi8sIGpzb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlckVycm9yQ29kZSA9PT0gXCJFTUFJTF9FWElTVFNcIiAvKiBTZXJ2ZXJFcnJvci5FTUFJTF9FWElTVFMgKi8pIHtcclxuICAgICAgICAgICAgICAgIHRocm93IF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgXCJlbWFpbC1hbHJlYWR5LWluLXVzZVwiIC8qIEF1dGhFcnJvckNvZGUuRU1BSUxfRVhJU1RTICovLCBqc29uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChzZXJ2ZXJFcnJvckNvZGUgPT09IFwiVVNFUl9ESVNBQkxFRFwiIC8qIFNlcnZlckVycm9yLlVTRVJfRElTQUJMRUQgKi8pIHtcclxuICAgICAgICAgICAgICAgIHRocm93IF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgXCJ1c2VyLWRpc2FibGVkXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RJU0FCTEVEICovLCBqc29uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBhdXRoRXJyb3IgPSBlcnJvck1hcFtzZXJ2ZXJFcnJvckNvZGVdIHx8XHJcbiAgICAgICAgICAgICAgICBzZXJ2ZXJFcnJvckNvZGVcclxuICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bX1xcc10rL2csICctJyk7XHJcbiAgICAgICAgICAgIGlmIChzZXJ2ZXJFcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IF9lcnJvcldpdGhDdXN0b21NZXNzYWdlKGF1dGgsIGF1dGhFcnJvciwgc2VydmVyRXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9mYWlsKGF1dGgsIGF1dGhFcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvcikge1xyXG4gICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDaGFuZ2luZyB0aGlzIHRvIGEgZGlmZmVyZW50IGVycm9yIGNvZGUgd2lsbCBsb2cgdXNlciBvdXQgd2hlbiB0aGVyZSBpcyBhIG5ldHdvcmsgZXJyb3JcclxuICAgICAgICAvLyBiZWNhdXNlIHdlIHRyZWF0IGFueSBlcnJvciBvdGhlciB0aGFuIE5FVFdPUktfUkVRVUVTVF9GQUlMRUQgYXMgdG9rZW4gaXMgaW52YWxpZC5cclxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2Jsb2IvNGZiYzczNjEwZDcwYmU0ZTA4NTJlN2RlNjNhMzljYjc4OTdlODU0Ni9wYWNrYWdlcy9hdXRoL3NyYy9jb3JlL2F1dGgvYXV0aF9pbXBsLnRzI0wzMDktTDMxNlxyXG4gICAgICAgIF9mYWlsKGF1dGgsIFwibmV0d29yay1yZXF1ZXN0LWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLywgeyAnbWVzc2FnZSc6IFN0cmluZyhlKSB9KTtcclxuICAgIH1cclxufVxyXG5hc3luYyBmdW5jdGlvbiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgbWV0aG9kLCBwYXRoLCByZXF1ZXN0LCBjdXN0b21FcnJvck1hcCA9IHt9KSB7XHJcbiAgICBjb25zdCBzZXJ2ZXJSZXNwb25zZSA9IChhd2FpdCBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgbWV0aG9kLCBwYXRoLCByZXF1ZXN0LCBjdXN0b21FcnJvck1hcCkpO1xyXG4gICAgaWYgKCdtZmFQZW5kaW5nQ3JlZGVudGlhbCcgaW4gc2VydmVyUmVzcG9uc2UpIHtcclxuICAgICAgICBfZmFpbChhdXRoLCBcIm11bHRpLWZhY3Rvci1hdXRoLXJlcXVpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5NRkFfUkVRVUlSRUQgKi8sIHtcclxuICAgICAgICAgICAgX3NlcnZlclJlc3BvbnNlOiBzZXJ2ZXJSZXNwb25zZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNlcnZlclJlc3BvbnNlO1xyXG59XHJcbmZ1bmN0aW9uIF9nZXRGaW5hbFRhcmdldChhdXRoLCBob3N0LCBwYXRoLCBxdWVyeSkge1xyXG4gICAgY29uc3QgYmFzZSA9IGAke2hvc3R9JHtwYXRofT8ke3F1ZXJ5fWA7XHJcbiAgICBpZiAoIWF1dGguY29uZmlnLmVtdWxhdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIGAke2F1dGguY29uZmlnLmFwaVNjaGVtZX06Ly8ke2Jhc2V9YDtcclxuICAgIH1cclxuICAgIHJldHVybiBfZW11bGF0b3JVcmwoYXV0aC5jb25maWcsIGJhc2UpO1xyXG59XHJcbmZ1bmN0aW9uIF9wYXJzZUVuZm9yY2VtZW50U3RhdGUoZW5mb3JjZW1lbnRTdGF0ZVN0cikge1xyXG4gICAgc3dpdGNoIChlbmZvcmNlbWVudFN0YXRlU3RyKSB7XHJcbiAgICAgICAgY2FzZSAnRU5GT1JDRSc6XHJcbiAgICAgICAgICAgIHJldHVybiBcIkVORk9SQ0VcIiAvKiBFbmZvcmNlbWVudFN0YXRlLkVORk9SQ0UgKi87XHJcbiAgICAgICAgY2FzZSAnQVVESVQnOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJBVURJVFwiIC8qIEVuZm9yY2VtZW50U3RhdGUuQVVESVQgKi87XHJcbiAgICAgICAgY2FzZSAnT0ZGJzpcclxuICAgICAgICAgICAgcmV0dXJuIFwiT0ZGXCIgLyogRW5mb3JjZW1lbnRTdGF0ZS5PRkYgKi87XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgcmV0dXJuIFwiRU5GT1JDRU1FTlRfU1RBVEVfVU5TUEVDSUZJRURcIiAvKiBFbmZvcmNlbWVudFN0YXRlLkVORk9SQ0VNRU5UX1NUQVRFX1VOU1BFQ0lGSUVEICovO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIE5ldHdvcmtUaW1lb3V0IHtcclxuICAgIGNvbnN0cnVjdG9yKGF1dGgpIHtcclxuICAgICAgICB0aGlzLmF1dGggPSBhdXRoO1xyXG4gICAgICAgIC8vIE5vZGUgdGltZXJzIGFuZCBicm93c2VyIHRpbWVycyBhcmUgZnVuZGFtZW50YWxseSBpbmNvbXBhdGlibGUsIGJ1dCB3ZVxyXG4gICAgICAgIC8vIGRvbid0IGNhcmUgYWJvdXQgdGhlIHZhbHVlIGhlcmVcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgICAgIHRoaXMudGltZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChfY3JlYXRlRXJyb3IodGhpcy5hdXRoLCBcIm5ldHdvcmstcmVxdWVzdC1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi8pKTtcclxuICAgICAgICAgICAgfSwgREVGQVVMVF9BUElfVElNRU9VVF9NUy5nZXQoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBjbGVhck5ldHdvcmtUaW1lb3V0KCkge1xyXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfbWFrZVRhZ2dlZEVycm9yKGF1dGgsIGNvZGUsIHJlc3BvbnNlKSB7XHJcbiAgICBjb25zdCBlcnJvclBhcmFtcyA9IHtcclxuICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWVcclxuICAgIH07XHJcbiAgICBpZiAocmVzcG9uc2UuZW1haWwpIHtcclxuICAgICAgICBlcnJvclBhcmFtcy5lbWFpbCA9IHJlc3BvbnNlLmVtYWlsO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlc3BvbnNlLnBob25lTnVtYmVyKSB7XHJcbiAgICAgICAgZXJyb3JQYXJhbXMucGhvbmVOdW1iZXIgPSByZXNwb25zZS5waG9uZU51bWJlcjtcclxuICAgIH1cclxuICAgIGNvbnN0IGVycm9yID0gX2NyZWF0ZUVycm9yKGF1dGgsIGNvZGUsIGVycm9yUGFyYW1zKTtcclxuICAgIC8vIFdlIGtub3cgY3VzdG9tRGF0YSBpcyBkZWZpbmVkIG9uIGVycm9yIGJlY2F1c2UgZXJyb3JQYXJhbXMgaXMgZGVmaW5lZFxyXG4gICAgZXJyb3IuY3VzdG9tRGF0YS5fdG9rZW5SZXNwb25zZSA9IHJlc3BvbnNlO1xyXG4gICAgcmV0dXJuIGVycm9yO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGlzVjIoZ3JlY2FwdGNoYSkge1xyXG4gICAgcmV0dXJuIChncmVjYXB0Y2hhICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICBncmVjYXB0Y2hhLmdldFJlc3BvbnNlICE9PSB1bmRlZmluZWQpO1xyXG59XHJcbmZ1bmN0aW9uIGlzRW50ZXJwcmlzZShncmVjYXB0Y2hhKSB7XHJcbiAgICByZXR1cm4gKGdyZWNhcHRjaGEgIT09IHVuZGVmaW5lZCAmJlxyXG4gICAgICAgIGdyZWNhcHRjaGEuZW50ZXJwcmlzZSAhPT0gdW5kZWZpbmVkKTtcclxufVxyXG5jbGFzcyBSZWNhcHRjaGFDb25maWcge1xyXG4gICAgY29uc3RydWN0b3IocmVzcG9uc2UpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUaGUgcmVDQVBUQ0hBIHNpdGUga2V5LlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuc2l0ZUtleSA9ICcnO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSBsaXN0IG9mIHByb3ZpZGVycyBhbmQgdGhlaXIgZW5hYmxlbWVudCBzdGF0dXMgZm9yIHJlQ0FQVENIQSBFbnRlcnByaXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMucmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZSA9IFtdO1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5yZWNhcHRjaGFLZXkgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlY2FwdGNoYUtleSB1bmRlZmluZWQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRXhhbXBsZSByZXNwb25zZS5yZWNhcHRjaGFLZXk6IFwicHJvamVjdHMvcHJvajEyMy9rZXlzL3NpdGVrZXkxMjNcIlxyXG4gICAgICAgIHRoaXMuc2l0ZUtleSA9IHJlc3BvbnNlLnJlY2FwdGNoYUtleS5zcGxpdCgnLycpWzNdO1xyXG4gICAgICAgIHRoaXMucmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZSA9IHJlc3BvbnNlLnJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGU7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHJlQ0FQVENIQSBFbnRlcnByaXNlIGVuZm9yY2VtZW50IHN0YXRlIGZvciB0aGUgZ2l2ZW4gcHJvdmlkZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHByb3ZpZGVyU3RyIC0gVGhlIHByb3ZpZGVyIHdob3NlIGVuZm9yY2VtZW50IHN0YXRlIGlzIHRvIGJlIHJldHVybmVkLlxyXG4gICAgICogQHJldHVybnMgVGhlIHJlQ0FQVENIQSBFbnRlcnByaXNlIGVuZm9yY2VtZW50IHN0YXRlIGZvciB0aGUgZ2l2ZW4gcHJvdmlkZXIuXHJcbiAgICAgKi9cclxuICAgIGdldFByb3ZpZGVyRW5mb3JjZW1lbnRTdGF0ZShwcm92aWRlclN0cikge1xyXG4gICAgICAgIGlmICghdGhpcy5yZWNhcHRjaGFFbmZvcmNlbWVudFN0YXRlIHx8XHJcbiAgICAgICAgICAgIHRoaXMucmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3QgcmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZSBvZiB0aGlzLnJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGUpIHtcclxuICAgICAgICAgICAgaWYgKHJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGUucHJvdmlkZXIgJiZcclxuICAgICAgICAgICAgICAgIHJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGUucHJvdmlkZXIgPT09IHByb3ZpZGVyU3RyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3BhcnNlRW5mb3JjZW1lbnRTdGF0ZShyZWNhcHRjaGFFbmZvcmNlbWVudFN0YXRlLmVuZm9yY2VtZW50U3RhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHJlQ0FQVENIQSBFbnRlcnByaXNlIGVuZm9yY2VtZW50IHN0YXRlIGZvciB0aGUgcHJvdmlkZXIgaXMgc2V0IHRvIEVORk9SQ0Ugb3IgQVVESVQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHByb3ZpZGVyU3RyIC0gVGhlIHByb3ZpZGVyIHdob3NlIGVuYWJsZW1lbnQgc3RhdGUgaXMgdG8gYmUgcmV0dXJuZWQuXHJcbiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIG9yIG5vdCByZUNBUFRDSEEgRW50ZXJwcmlzZSBwcm90ZWN0aW9uIGlzIGVuYWJsZWQgZm9yIHRoZSBnaXZlbiBwcm92aWRlci5cclxuICAgICAqL1xyXG4gICAgaXNQcm92aWRlckVuYWJsZWQocHJvdmlkZXJTdHIpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuZ2V0UHJvdmlkZXJFbmZvcmNlbWVudFN0YXRlKHByb3ZpZGVyU3RyKSA9PT1cclxuICAgICAgICAgICAgXCJFTkZPUkNFXCIgLyogRW5mb3JjZW1lbnRTdGF0ZS5FTkZPUkNFICovIHx8XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0UHJvdmlkZXJFbmZvcmNlbWVudFN0YXRlKHByb3ZpZGVyU3RyKSA9PT0gXCJBVURJVFwiIC8qIEVuZm9yY2VtZW50U3RhdGUuQVVESVQgKi8pO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdldFJlY2FwdGNoYVBhcmFtcyhhdXRoKSB7XHJcbiAgICByZXR1cm4gKChhd2FpdCBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJHRVRcIiAvKiBIdHRwTWV0aG9kLkdFVCAqLywgXCIvdjEvcmVjYXB0Y2hhUGFyYW1zXCIgLyogRW5kcG9pbnQuR0VUX1JFQ0FQVENIQV9QQVJBTSAqLykpLnJlY2FwdGNoYVNpdGVLZXkgfHwgJycpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGdldFJlY2FwdGNoYUNvbmZpZyhhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiR0VUXCIgLyogSHR0cE1ldGhvZC5HRVQgKi8sIFwiL3YyL3JlY2FwdGNoYUNvbmZpZ1wiIC8qIEVuZHBvaW50LkdFVF9SRUNBUFRDSEFfQ09ORklHICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUFjY291bnQoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOmRlbGV0ZVwiIC8qIEVuZHBvaW50LkRFTEVURV9BQ0NPVU5UICovLCByZXF1ZXN0KTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBkZWxldGVMaW5rZWRBY2NvdW50cyhhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6dXBkYXRlXCIgLyogRW5kcG9pbnQuU0VUX0FDQ09VTlRfSU5GTyAqLywgcmVxdWVzdCk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gZ2V0QWNjb3VudEluZm8oYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOmxvb2t1cFwiIC8qIEVuZHBvaW50LkdFVF9BQ0NPVU5UX0lORk8gKi8sIHJlcXVlc3QpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyh1dGNUaW1lc3RhbXApIHtcclxuICAgIGlmICghdXRjVGltZXN0YW1wKSB7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gQ29udmVydCB0byBkYXRlIG9iamVjdC5cclxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoTnVtYmVyKHV0Y1RpbWVzdGFtcCkpO1xyXG4gICAgICAgIC8vIFRlc3QgZGF0ZSBpcyB2YWxpZC5cclxuICAgICAgICBpZiAoIWlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IHRvIFVUQyBkYXRlIHN0cmluZy5cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9VVENTdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vIERvIG5vdGhpbmcuIHVuZGVmaW5lZCB3aWxsIGJlIHJldHVybmVkLlxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUmV0dXJucyBhIEpTT04gV2ViIFRva2VuIChKV1QpIHVzZWQgdG8gaWRlbnRpZnkgdGhlIHVzZXIgdG8gYSBGaXJlYmFzZSBzZXJ2aWNlLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBSZXR1cm5zIHRoZSBjdXJyZW50IHRva2VuIGlmIGl0IGhhcyBub3QgZXhwaXJlZCBvciBpZiBpdCB3aWxsIG5vdCBleHBpcmUgaW4gdGhlIG5leHQgZml2ZVxyXG4gKiBtaW51dGVzLiBPdGhlcndpc2UsIHRoaXMgd2lsbCByZWZyZXNoIHRoZSB0b2tlbiBhbmQgcmV0dXJuIGEgbmV3IG9uZS5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIGZvcmNlUmVmcmVzaCAtIEZvcmNlIHJlZnJlc2ggcmVnYXJkbGVzcyBvZiB0b2tlbiBleHBpcmF0aW9uLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRJZFRva2VuKHVzZXIsIGZvcmNlUmVmcmVzaCA9IGZhbHNlKSB7XHJcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpLmdldElkVG9rZW4oZm9yY2VSZWZyZXNoKTtcclxufVxyXG4vKipcclxuICogUmV0dXJucyBhIGRlc2VyaWFsaXplZCBKU09OIFdlYiBUb2tlbiAoSldUKSB1c2VkIHRvIGlkZW50aWZ5IHRoZSB1c2VyIHRvIGEgRmlyZWJhc2Ugc2VydmljZS5cclxuICpcclxuICogQHJlbWFya3NcclxuICogUmV0dXJucyB0aGUgY3VycmVudCB0b2tlbiBpZiBpdCBoYXMgbm90IGV4cGlyZWQgb3IgaWYgaXQgd2lsbCBub3QgZXhwaXJlIGluIHRoZSBuZXh0IGZpdmVcclxuICogbWludXRlcy4gT3RoZXJ3aXNlLCB0aGlzIHdpbGwgcmVmcmVzaCB0aGUgdG9rZW4gYW5kIHJldHVybiBhIG5ldyBvbmUuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBmb3JjZVJlZnJlc2ggLSBGb3JjZSByZWZyZXNoIHJlZ2FyZGxlc3Mgb2YgdG9rZW4gZXhwaXJhdGlvbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0SWRUb2tlblJlc3VsdCh1c2VyLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgY29uc3QgdG9rZW4gPSBhd2FpdCB1c2VySW50ZXJuYWwuZ2V0SWRUb2tlbihmb3JjZVJlZnJlc2gpO1xyXG4gICAgY29uc3QgY2xhaW1zID0gX3BhcnNlVG9rZW4odG9rZW4pO1xyXG4gICAgX2Fzc2VydChjbGFpbXMgJiYgY2xhaW1zLmV4cCAmJiBjbGFpbXMuYXV0aF90aW1lICYmIGNsYWltcy5pYXQsIHVzZXJJbnRlcm5hbC5hdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICBjb25zdCBmaXJlYmFzZSA9IHR5cGVvZiBjbGFpbXMuZmlyZWJhc2UgPT09ICdvYmplY3QnID8gY2xhaW1zLmZpcmViYXNlIDogdW5kZWZpbmVkO1xyXG4gICAgY29uc3Qgc2lnbkluUHJvdmlkZXIgPSBmaXJlYmFzZSA9PT0gbnVsbCB8fCBmaXJlYmFzZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlyZWJhc2VbJ3NpZ25faW5fcHJvdmlkZXInXTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgY2xhaW1zLFxyXG4gICAgICAgIHRva2VuLFxyXG4gICAgICAgIGF1dGhUaW1lOiB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcoc2Vjb25kc1N0cmluZ1RvTWlsbGlzZWNvbmRzKGNsYWltcy5hdXRoX3RpbWUpKSxcclxuICAgICAgICBpc3N1ZWRBdFRpbWU6IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyhzZWNvbmRzU3RyaW5nVG9NaWxsaXNlY29uZHMoY2xhaW1zLmlhdCkpLFxyXG4gICAgICAgIGV4cGlyYXRpb25UaW1lOiB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcoc2Vjb25kc1N0cmluZ1RvTWlsbGlzZWNvbmRzKGNsYWltcy5leHApKSxcclxuICAgICAgICBzaWduSW5Qcm92aWRlcjogc2lnbkluUHJvdmlkZXIgfHwgbnVsbCxcclxuICAgICAgICBzaWduSW5TZWNvbmRGYWN0b3I6IChmaXJlYmFzZSA9PT0gbnVsbCB8fCBmaXJlYmFzZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlyZWJhc2VbJ3NpZ25faW5fc2Vjb25kX2ZhY3RvciddKSB8fCBudWxsXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhzZWNvbmRzKSB7XHJcbiAgICByZXR1cm4gTnVtYmVyKHNlY29uZHMpICogMTAwMDtcclxufVxyXG5mdW5jdGlvbiBfcGFyc2VUb2tlbih0b2tlbikge1xyXG4gICAgY29uc3QgW2FsZ29yaXRobSwgcGF5bG9hZCwgc2lnbmF0dXJlXSA9IHRva2VuLnNwbGl0KCcuJyk7XHJcbiAgICBpZiAoYWxnb3JpdGhtID09PSB1bmRlZmluZWQgfHxcclxuICAgICAgICBwYXlsb2FkID09PSB1bmRlZmluZWQgfHxcclxuICAgICAgICBzaWduYXR1cmUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIF9sb2dFcnJvcignSldUIG1hbGZvcm1lZCwgY29udGFpbmVkIGZld2VyIHRoYW4gMyBzZWN0aW9ucycpO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBkZWNvZGVkID0gYmFzZTY0RGVjb2RlKHBheWxvYWQpO1xyXG4gICAgICAgIGlmICghZGVjb2RlZCkge1xyXG4gICAgICAgICAgICBfbG9nRXJyb3IoJ0ZhaWxlZCB0byBkZWNvZGUgYmFzZTY0IEpXVCBwYXlsb2FkJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkZWNvZGVkKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgX2xvZ0Vycm9yKCdDYXVnaHQgZXJyb3IgcGFyc2luZyBKV1QgcGF5bG9hZCBhcyBKU09OJywgZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBFeHRyYWN0IGV4cGlyZXNJbiBUVEwgZnJvbSBhIHRva2VuIGJ5IHN1YnRyYWN0aW5nIHRoZSBleHBpcmF0aW9uIGZyb20gdGhlIGlzc3VhbmNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX3Rva2VuRXhwaXJlc0luKHRva2VuKSB7XHJcbiAgICBjb25zdCBwYXJzZWRUb2tlbiA9IF9wYXJzZVRva2VuKHRva2VuKTtcclxuICAgIF9hc3NlcnQocGFyc2VkVG9rZW4sIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIF9hc3NlcnQodHlwZW9mIHBhcnNlZFRva2VuLmV4cCAhPT0gJ3VuZGVmaW5lZCcsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIF9hc3NlcnQodHlwZW9mIHBhcnNlZFRva2VuLmlhdCAhPT0gJ3VuZGVmaW5lZCcsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIHJldHVybiBOdW1iZXIocGFyc2VkVG9rZW4uZXhwKSAtIE51bWJlcihwYXJzZWRUb2tlbi5pYXQpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXIsIHByb21pc2UsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7XHJcbiAgICBpZiAoYnlwYXNzQXV0aFN0YXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiBhd2FpdCBwcm9taXNlO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IgJiYgaXNVc2VySW52YWxpZGF0ZWQoZSkpIHtcclxuICAgICAgICAgICAgaWYgKHVzZXIuYXV0aC5jdXJyZW50VXNlciA9PT0gdXNlcikge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdXNlci5hdXRoLnNpZ25PdXQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGlzVXNlckludmFsaWRhdGVkKHsgY29kZSB9KSB7XHJcbiAgICByZXR1cm4gKGNvZGUgPT09IGBhdXRoLyR7XCJ1c2VyLWRpc2FibGVkXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RJU0FCTEVEICovfWAgfHxcclxuICAgICAgICBjb2RlID09PSBgYXV0aC8ke1widXNlci10b2tlbi1leHBpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5UT0tFTl9FWFBJUkVEICovfWApO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIFByb2FjdGl2ZVJlZnJlc2gge1xyXG4gICAgY29uc3RydWN0b3IodXNlcikge1xyXG4gICAgICAgIHRoaXMudXNlciA9IHVzZXI7XHJcbiAgICAgICAgdGhpcy5pc1J1bm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAvLyBOb2RlIHRpbWVycyBhbmQgYnJvd3NlciB0aW1lcnMgcmV0dXJuIGZ1bmRhbWVudGFsbHkgZGlmZmVyZW50IHR5cGVzLlxyXG4gICAgICAgIC8vIFdlIGRvbid0IGFjdHVhbGx5IGNhcmUgd2hhdCB0aGUgdmFsdWUgaXMgYnV0IFRTIHdvbid0IGFjY2VwdCB1bmtub3duIGFuZFxyXG4gICAgICAgIC8vIHdlIGNhbid0IGNhc3QgcHJvcGVybHkgaW4gYm90aCBlbnZpcm9ubWVudHMuXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICB0aGlzLnRpbWVySWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXJyb3JCYWNrb2ZmID0gMzAwMDAgLyogRHVyYXRpb24uUkVUUllfQkFDS09GRl9NSU4gKi87XHJcbiAgICB9XHJcbiAgICBfc3RhcnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNSdW5uaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc1J1bm5pbmcgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2NoZWR1bGUoKTtcclxuICAgIH1cclxuICAgIF9zdG9wKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0SW50ZXJ2YWwod2FzRXJyb3IpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgaWYgKHdhc0Vycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludGVydmFsID0gdGhpcy5lcnJvckJhY2tvZmY7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JCYWNrb2ZmID0gTWF0aC5taW4odGhpcy5lcnJvckJhY2tvZmYgKiAyLCA5NjAwMDAgLyogRHVyYXRpb24uUkVUUllfQkFDS09GRl9NQVggKi8pO1xyXG4gICAgICAgICAgICByZXR1cm4gaW50ZXJ2YWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBSZXNldCB0aGUgZXJyb3IgYmFja29mZlxyXG4gICAgICAgICAgICB0aGlzLmVycm9yQmFja29mZiA9IDMwMDAwIC8qIER1cmF0aW9uLlJFVFJZX0JBQ0tPRkZfTUlOICovO1xyXG4gICAgICAgICAgICBjb25zdCBleHBUaW1lID0gKF9hID0gdGhpcy51c2VyLnN0c1Rva2VuTWFuYWdlci5leHBpcmF0aW9uVGltZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDtcclxuICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBleHBUaW1lIC0gRGF0ZS5ub3coKSAtIDMwMDAwMCAvKiBEdXJhdGlvbi5PRkZTRVQgKi87XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCgwLCBpbnRlcnZhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2NoZWR1bGUod2FzRXJyb3IgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHtcclxuICAgICAgICAgICAgLy8gSnVzdCBpbiBjYXNlLi4uXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSB0aGlzLmdldEludGVydmFsKHdhc0Vycm9yKTtcclxuICAgICAgICB0aGlzLnRpbWVySWQgPSBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5pdGVyYXRpb24oKTtcclxuICAgICAgICB9LCBpbnRlcnZhbCk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBpdGVyYXRpb24oKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy51c2VyLmdldElkVG9rZW4odHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIC8vIE9ubHkgcmV0cnkgb24gbmV0d29yayBlcnJvcnNcclxuICAgICAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgPT09XHJcbiAgICAgICAgICAgICAgICBgYXV0aC8ke1wibmV0d29yay1yZXF1ZXN0LWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqL31gKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlKC8qIHdhc0Vycm9yICovIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZSgpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIFVzZXJNZXRhZGF0YSB7XHJcbiAgICBjb25zdHJ1Y3RvcihjcmVhdGVkQXQsIGxhc3RMb2dpbkF0KSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVkQXQgPSBjcmVhdGVkQXQ7XHJcbiAgICAgICAgdGhpcy5sYXN0TG9naW5BdCA9IGxhc3RMb2dpbkF0O1xyXG4gICAgICAgIHRoaXMuX2luaXRpYWxpemVUaW1lKCk7XHJcbiAgICB9XHJcbiAgICBfaW5pdGlhbGl6ZVRpbWUoKSB7XHJcbiAgICAgICAgdGhpcy5sYXN0U2lnbkluVGltZSA9IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyh0aGlzLmxhc3RMb2dpbkF0KTtcclxuICAgICAgICB0aGlzLmNyZWF0aW9uVGltZSA9IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyh0aGlzLmNyZWF0ZWRBdCk7XHJcbiAgICB9XHJcbiAgICBfY29weShtZXRhZGF0YSkge1xyXG4gICAgICAgIHRoaXMuY3JlYXRlZEF0ID0gbWV0YWRhdGEuY3JlYXRlZEF0O1xyXG4gICAgICAgIHRoaXMubGFzdExvZ2luQXQgPSBtZXRhZGF0YS5sYXN0TG9naW5BdDtcclxuICAgICAgICB0aGlzLl9pbml0aWFsaXplVGltZSgpO1xyXG4gICAgfVxyXG4gICAgdG9KU09OKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogdGhpcy5jcmVhdGVkQXQsXHJcbiAgICAgICAgICAgIGxhc3RMb2dpbkF0OiB0aGlzLmxhc3RMb2dpbkF0XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBfcmVsb2FkV2l0aG91dFNhdmluZyh1c2VyKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICBjb25zdCBhdXRoID0gdXNlci5hdXRoO1xyXG4gICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCBnZXRBY2NvdW50SW5mbyhhdXRoLCB7IGlkVG9rZW4gfSkpO1xyXG4gICAgX2Fzc2VydChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UudXNlcnMubGVuZ3RoLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICBjb25zdCBjb3JlQWNjb3VudCA9IHJlc3BvbnNlLnVzZXJzWzBdO1xyXG4gICAgdXNlci5fbm90aWZ5UmVsb2FkTGlzdGVuZXIoY29yZUFjY291bnQpO1xyXG4gICAgY29uc3QgbmV3UHJvdmlkZXJEYXRhID0gKChfYSA9IGNvcmVBY2NvdW50LnByb3ZpZGVyVXNlckluZm8pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpXHJcbiAgICAgICAgPyBleHRyYWN0UHJvdmlkZXJEYXRhKGNvcmVBY2NvdW50LnByb3ZpZGVyVXNlckluZm8pXHJcbiAgICAgICAgOiBbXTtcclxuICAgIGNvbnN0IHByb3ZpZGVyRGF0YSA9IG1lcmdlUHJvdmlkZXJEYXRhKHVzZXIucHJvdmlkZXJEYXRhLCBuZXdQcm92aWRlckRhdGEpO1xyXG4gICAgLy8gUHJlc2VydmVzIHRoZSBub24tbm9ueW1vdXMgc3RhdHVzIG9mIHRoZSBzdG9yZWQgdXNlciwgZXZlbiBpZiBubyBtb3JlXHJcbiAgICAvLyBjcmVkZW50aWFscyAoZmVkZXJhdGVkIG9yIGVtYWlsL3Bhc3N3b3JkKSBhcmUgbGlua2VkIHRvIHRoZSB1c2VyLiBJZlxyXG4gICAgLy8gdGhlIHVzZXIgd2FzIHByZXZpb3VzbHkgYW5vbnltb3VzLCB0aGVuIHVzZSBwcm92aWRlciBkYXRhIHRvIHVwZGF0ZS5cclxuICAgIC8vIE9uIHRoZSBvdGhlciBoYW5kLCBpZiBpdCB3YXMgbm90IGFub255bW91cyBiZWZvcmUsIGl0IHNob3VsZCBuZXZlciBiZVxyXG4gICAgLy8gY29uc2lkZXJlZCBhbm9ueW1vdXMgbm93LlxyXG4gICAgY29uc3Qgb2xkSXNBbm9ueW1vdXMgPSB1c2VyLmlzQW5vbnltb3VzO1xyXG4gICAgY29uc3QgbmV3SXNBbm9ueW1vdXMgPSAhKHVzZXIuZW1haWwgJiYgY29yZUFjY291bnQucGFzc3dvcmRIYXNoKSAmJiAhKHByb3ZpZGVyRGF0YSA9PT0gbnVsbCB8fCBwcm92aWRlckRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb3ZpZGVyRGF0YS5sZW5ndGgpO1xyXG4gICAgY29uc3QgaXNBbm9ueW1vdXMgPSAhb2xkSXNBbm9ueW1vdXMgPyBmYWxzZSA6IG5ld0lzQW5vbnltb3VzO1xyXG4gICAgY29uc3QgdXBkYXRlcyA9IHtcclxuICAgICAgICB1aWQ6IGNvcmVBY2NvdW50LmxvY2FsSWQsXHJcbiAgICAgICAgZGlzcGxheU5hbWU6IGNvcmVBY2NvdW50LmRpc3BsYXlOYW1lIHx8IG51bGwsXHJcbiAgICAgICAgcGhvdG9VUkw6IGNvcmVBY2NvdW50LnBob3RvVXJsIHx8IG51bGwsXHJcbiAgICAgICAgZW1haWw6IGNvcmVBY2NvdW50LmVtYWlsIHx8IG51bGwsXHJcbiAgICAgICAgZW1haWxWZXJpZmllZDogY29yZUFjY291bnQuZW1haWxWZXJpZmllZCB8fCBmYWxzZSxcclxuICAgICAgICBwaG9uZU51bWJlcjogY29yZUFjY291bnQucGhvbmVOdW1iZXIgfHwgbnVsbCxcclxuICAgICAgICB0ZW5hbnRJZDogY29yZUFjY291bnQudGVuYW50SWQgfHwgbnVsbCxcclxuICAgICAgICBwcm92aWRlckRhdGEsXHJcbiAgICAgICAgbWV0YWRhdGE6IG5ldyBVc2VyTWV0YWRhdGEoY29yZUFjY291bnQuY3JlYXRlZEF0LCBjb3JlQWNjb3VudC5sYXN0TG9naW5BdCksXHJcbiAgICAgICAgaXNBbm9ueW1vdXNcclxuICAgIH07XHJcbiAgICBPYmplY3QuYXNzaWduKHVzZXIsIHVwZGF0ZXMpO1xyXG59XHJcbi8qKlxyXG4gKiBSZWxvYWRzIHVzZXIgYWNjb3VudCBkYXRhLCBpZiBzaWduZWQgaW4uXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlbG9hZCh1c2VyKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBhd2FpdCBfcmVsb2FkV2l0aG91dFNhdmluZyh1c2VySW50ZXJuYWwpO1xyXG4gICAgLy8gRXZlbiB0aG91Z2ggdGhlIGN1cnJlbnQgdXNlciBoYXNuJ3QgY2hhbmdlZCwgdXBkYXRlXHJcbiAgICAvLyBjdXJyZW50IHVzZXIgd2lsbCB0cmlnZ2VyIGEgcGVyc2lzdGVuY2UgdXBkYXRlIHcvIHRoZVxyXG4gICAgLy8gbmV3IGluZm8uXHJcbiAgICBhd2FpdCB1c2VySW50ZXJuYWwuYXV0aC5fcGVyc2lzdFVzZXJJZkN1cnJlbnQodXNlckludGVybmFsKTtcclxuICAgIHVzZXJJbnRlcm5hbC5hdXRoLl9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodXNlckludGVybmFsKTtcclxufVxyXG5mdW5jdGlvbiBtZXJnZVByb3ZpZGVyRGF0YShvcmlnaW5hbCwgbmV3RGF0YSkge1xyXG4gICAgY29uc3QgZGVkdXBlZCA9IG9yaWdpbmFsLmZpbHRlcihvID0+ICFuZXdEYXRhLnNvbWUobiA9PiBuLnByb3ZpZGVySWQgPT09IG8ucHJvdmlkZXJJZCkpO1xyXG4gICAgcmV0dXJuIFsuLi5kZWR1cGVkLCAuLi5uZXdEYXRhXTtcclxufVxyXG5mdW5jdGlvbiBleHRyYWN0UHJvdmlkZXJEYXRhKHByb3ZpZGVycykge1xyXG4gICAgcmV0dXJuIHByb3ZpZGVycy5tYXAoKF9hKSA9PiB7XHJcbiAgICAgICAgdmFyIHsgcHJvdmlkZXJJZCB9ID0gX2EsIHByb3ZpZGVyID0gX19yZXN0KF9hLCBbXCJwcm92aWRlcklkXCJdKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwcm92aWRlcklkLFxyXG4gICAgICAgICAgICB1aWQ6IHByb3ZpZGVyLnJhd0lkIHx8ICcnLFxyXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogcHJvdmlkZXIuZGlzcGxheU5hbWUgfHwgbnVsbCxcclxuICAgICAgICAgICAgZW1haWw6IHByb3ZpZGVyLmVtYWlsIHx8IG51bGwsXHJcbiAgICAgICAgICAgIHBob25lTnVtYmVyOiBwcm92aWRlci5waG9uZU51bWJlciB8fCBudWxsLFxyXG4gICAgICAgICAgICBwaG90b1VSTDogcHJvdmlkZXIucGhvdG9VcmwgfHwgbnVsbFxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiByZXF1ZXN0U3RzVG9rZW4oYXV0aCwgcmVmcmVzaFRva2VuKSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wZXJmb3JtRmV0Y2hXaXRoRXJyb3JIYW5kbGluZyhhdXRoLCB7fSwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBxdWVyeXN0cmluZyh7XHJcbiAgICAgICAgICAgICdncmFudF90eXBlJzogJ3JlZnJlc2hfdG9rZW4nLFxyXG4gICAgICAgICAgICAncmVmcmVzaF90b2tlbic6IHJlZnJlc2hUb2tlblxyXG4gICAgICAgIH0pLnNsaWNlKDEpO1xyXG4gICAgICAgIGNvbnN0IHsgdG9rZW5BcGlIb3N0LCBhcGlLZXkgfSA9IGF1dGguY29uZmlnO1xyXG4gICAgICAgIGNvbnN0IHVybCA9IF9nZXRGaW5hbFRhcmdldChhdXRoLCB0b2tlbkFwaUhvc3QsIFwiL3YxL3Rva2VuXCIgLyogRW5kcG9pbnQuVE9LRU4gKi8sIGBrZXk9JHthcGlLZXl9YCk7XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IGF3YWl0IGF1dGguX2dldEFkZGl0aW9uYWxIZWFkZXJzKCk7XHJcbiAgICAgICAgaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiIC8qIEh0dHBIZWFkZXIuQ09OVEVOVF9UWVBFICovXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnO1xyXG4gICAgICAgIHJldHVybiBGZXRjaFByb3ZpZGVyLmZldGNoKCkodXJsLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLFxyXG4gICAgICAgICAgICBoZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIC8vIFRoZSByZXNwb25zZSBjb21lcyBiYWNrIGluIHNuYWtlX2Nhc2UuIENvbnZlcnQgdG8gY2FtZWw6XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGFjY2Vzc1Rva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgZXhwaXJlc0luOiByZXNwb25zZS5leHBpcmVzX2luLFxyXG4gICAgICAgIHJlZnJlc2hUb2tlbjogcmVzcG9uc2UucmVmcmVzaF90b2tlblxyXG4gICAgfTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiByZXZva2VUb2tlbihhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHM6cmV2b2tlVG9rZW5cIiAvKiBFbmRwb2ludC5SRVZPS0VfVE9LRU4gKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFdlIG5lZWQgdG8gbWFyayB0aGlzIGNsYXNzIGFzIGludGVybmFsIGV4cGxpY2l0bHkgdG8gZXhjbHVkZSBpdCBpbiB0aGUgcHVibGljIHR5cGluZ3MsIGJlY2F1c2VcclxuICogaXQgcmVmZXJlbmNlcyBBdXRoSW50ZXJuYWwgd2hpY2ggaGFzIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSB3aXRoIFVzZXJJbnRlcm5hbC5cclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jbGFzcyBTdHNUb2tlbk1hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXhwaXJhdGlvblRpbWUgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgZ2V0IGlzRXhwaXJlZCgpIHtcclxuICAgICAgICByZXR1cm4gKCF0aGlzLmV4cGlyYXRpb25UaW1lIHx8XHJcbiAgICAgICAgICAgIERhdGUubm93KCkgPiB0aGlzLmV4cGlyYXRpb25UaW1lIC0gMzAwMDAgLyogQnVmZmVyLlRPS0VOX1JFRlJFU0ggKi8pO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlRnJvbVNlcnZlclJlc3BvbnNlKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgX2Fzc2VydChyZXNwb25zZS5pZFRva2VuLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgcmVzcG9uc2UuaWRUb2tlbiAhPT0gJ3VuZGVmaW5lZCcsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICBfYXNzZXJ0KHR5cGVvZiByZXNwb25zZS5yZWZyZXNoVG9rZW4gIT09ICd1bmRlZmluZWQnLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgY29uc3QgZXhwaXJlc0luID0gJ2V4cGlyZXNJbicgaW4gcmVzcG9uc2UgJiYgdHlwZW9mIHJlc3BvbnNlLmV4cGlyZXNJbiAhPT0gJ3VuZGVmaW5lZCdcclxuICAgICAgICAgICAgPyBOdW1iZXIocmVzcG9uc2UuZXhwaXJlc0luKVxyXG4gICAgICAgICAgICA6IF90b2tlbkV4cGlyZXNJbihyZXNwb25zZS5pZFRva2VuKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24ocmVzcG9uc2UuaWRUb2tlbiwgcmVzcG9uc2UucmVmcmVzaFRva2VuLCBleHBpcmVzSW4pO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlRnJvbUlkVG9rZW4oaWRUb2tlbikge1xyXG4gICAgICAgIF9hc3NlcnQoaWRUb2tlbi5sZW5ndGggIT09IDAsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICBjb25zdCBleHBpcmVzSW4gPSBfdG9rZW5FeHBpcmVzSW4oaWRUb2tlbik7XHJcbiAgICAgICAgdGhpcy51cGRhdGVUb2tlbnNBbmRFeHBpcmF0aW9uKGlkVG9rZW4sIG51bGwsIGV4cGlyZXNJbik7XHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRUb2tlbihhdXRoLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghZm9yY2VSZWZyZXNoICYmIHRoaXMuYWNjZXNzVG9rZW4gJiYgIXRoaXMuaXNFeHBpcmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfYXNzZXJ0KHRoaXMucmVmcmVzaFRva2VuLCBhdXRoLCBcInVzZXItdG9rZW4tZXhwaXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqLyk7XHJcbiAgICAgICAgaWYgKHRoaXMucmVmcmVzaFRva2VuKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucmVmcmVzaChhdXRoLCB0aGlzLnJlZnJlc2hUb2tlbik7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNsZWFyUmVmcmVzaFRva2VuKCkge1xyXG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gbnVsbDtcclxuICAgIH1cclxuICAgIGFzeW5jIHJlZnJlc2goYXV0aCwgb2xkVG9rZW4pIHtcclxuICAgICAgICBjb25zdCB7IGFjY2Vzc1Rva2VuLCByZWZyZXNoVG9rZW4sIGV4cGlyZXNJbiB9ID0gYXdhaXQgcmVxdWVzdFN0c1Rva2VuKGF1dGgsIG9sZFRva2VuKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24oYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgTnVtYmVyKGV4cGlyZXNJbikpO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlVG9rZW5zQW5kRXhwaXJhdGlvbihhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuLCBleHBpcmVzSW5TZWMpIHtcclxuICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IHJlZnJlc2hUb2tlbiB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbiB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuZXhwaXJhdGlvblRpbWUgPSBEYXRlLm5vdygpICsgZXhwaXJlc0luU2VjICogMTAwMDtcclxuICAgIH1cclxuICAgIHN0YXRpYyBmcm9tSlNPTihhcHBOYW1lLCBvYmplY3QpIHtcclxuICAgICAgICBjb25zdCB7IHJlZnJlc2hUb2tlbiwgYWNjZXNzVG9rZW4sIGV4cGlyYXRpb25UaW1lIH0gPSBvYmplY3Q7XHJcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IG5ldyBTdHNUb2tlbk1hbmFnZXIoKTtcclxuICAgICAgICBpZiAocmVmcmVzaFRva2VuKSB7XHJcbiAgICAgICAgICAgIF9hc3NlcnQodHlwZW9mIHJlZnJlc2hUb2tlbiA9PT0gJ3N0cmluZycsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLCB7XHJcbiAgICAgICAgICAgICAgICBhcHBOYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtYW5hZ2VyLnJlZnJlc2hUb2tlbiA9IHJlZnJlc2hUb2tlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgIF9hc3NlcnQodHlwZW9mIGFjY2Vzc1Rva2VuID09PSAnc3RyaW5nJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sIHtcclxuICAgICAgICAgICAgICAgIGFwcE5hbWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1hbmFnZXIuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV4cGlyYXRpb25UaW1lKSB7XHJcbiAgICAgICAgICAgIF9hc3NlcnQodHlwZW9mIGV4cGlyYXRpb25UaW1lID09PSAnbnVtYmVyJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sIHtcclxuICAgICAgICAgICAgICAgIGFwcE5hbWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1hbmFnZXIuZXhwaXJhdGlvblRpbWUgPSBleHBpcmF0aW9uVGltZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG1hbmFnZXI7XHJcbiAgICB9XHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVmcmVzaFRva2VuOiB0aGlzLnJlZnJlc2hUb2tlbixcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW46IHRoaXMuYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lOiB0aGlzLmV4cGlyYXRpb25UaW1lXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIF9hc3NpZ24oc3RzVG9rZW5NYW5hZ2VyKSB7XHJcbiAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IHN0c1Rva2VuTWFuYWdlci5hY2Nlc3NUb2tlbjtcclxuICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IHN0c1Rva2VuTWFuYWdlci5yZWZyZXNoVG9rZW47XHJcbiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IHN0c1Rva2VuTWFuYWdlci5leHBpcmF0aW9uVGltZTtcclxuICAgIH1cclxuICAgIF9jbG9uZSgpIHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgU3RzVG9rZW5NYW5hZ2VyKCksIHRoaXMudG9KU09OKCkpO1xyXG4gICAgfVxyXG4gICAgX3BlcmZvcm1SZWZyZXNoKCkge1xyXG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGFzc2VydGlvbiwgYXBwTmFtZSkge1xyXG4gICAgX2Fzc2VydCh0eXBlb2YgYXNzZXJ0aW9uID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgYXNzZXJ0aW9uID09PSAndW5kZWZpbmVkJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sIHsgYXBwTmFtZSB9KTtcclxufVxyXG5jbGFzcyBVc2VySW1wbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihfYSkge1xyXG4gICAgICAgIHZhciB7IHVpZCwgYXV0aCwgc3RzVG9rZW5NYW5hZ2VyIH0gPSBfYSwgb3B0ID0gX19yZXN0KF9hLCBbXCJ1aWRcIiwgXCJhdXRoXCIsIFwic3RzVG9rZW5NYW5hZ2VyXCJdKTtcclxuICAgICAgICAvLyBGb3IgdGhlIHVzZXIgb2JqZWN0LCBwcm92aWRlciBpcyBhbHdheXMgRmlyZWJhc2UuXHJcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gXCJmaXJlYmFzZVwiIC8qIFByb3ZpZGVySWQuRklSRUJBU0UgKi87XHJcbiAgICAgICAgdGhpcy5wcm9hY3RpdmVSZWZyZXNoID0gbmV3IFByb2FjdGl2ZVJlZnJlc2godGhpcyk7XHJcbiAgICAgICAgdGhpcy5yZWxvYWRVc2VySW5mbyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5yZWxvYWRMaXN0ZW5lciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy51aWQgPSB1aWQ7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlciA9IHN0c1Rva2VuTWFuYWdlcjtcclxuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gc3RzVG9rZW5NYW5hZ2VyLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSBvcHQuZGlzcGxheU5hbWUgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLmVtYWlsID0gb3B0LmVtYWlsIHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5lbWFpbFZlcmlmaWVkID0gb3B0LmVtYWlsVmVyaWZpZWQgfHwgZmFsc2U7XHJcbiAgICAgICAgdGhpcy5waG9uZU51bWJlciA9IG9wdC5waG9uZU51bWJlciB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMucGhvdG9VUkwgPSBvcHQucGhvdG9VUkwgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLmlzQW5vbnltb3VzID0gb3B0LmlzQW5vbnltb3VzIHx8IGZhbHNlO1xyXG4gICAgICAgIHRoaXMudGVuYW50SWQgPSBvcHQudGVuYW50SWQgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLnByb3ZpZGVyRGF0YSA9IG9wdC5wcm92aWRlckRhdGEgPyBbLi4ub3B0LnByb3ZpZGVyRGF0YV0gOiBbXTtcclxuICAgICAgICB0aGlzLm1ldGFkYXRhID0gbmV3IFVzZXJNZXRhZGF0YShvcHQuY3JlYXRlZEF0IHx8IHVuZGVmaW5lZCwgb3B0Lmxhc3RMb2dpbkF0IHx8IHVuZGVmaW5lZCk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRJZFRva2VuKGZvcmNlUmVmcmVzaCkge1xyXG4gICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodGhpcywgdGhpcy5zdHNUb2tlbk1hbmFnZXIuZ2V0VG9rZW4odGhpcy5hdXRoLCBmb3JjZVJlZnJlc2gpKTtcclxuICAgICAgICBfYXNzZXJ0KGFjY2Vzc1Rva2VuLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICBpZiAodGhpcy5hY2Nlc3NUb2tlbiAhPT0gYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IGFjY2Vzc1Rva2VuO1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLmF1dGguX25vdGlmeUxpc3RlbmVyc0lmQ3VycmVudCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFjY2Vzc1Rva2VuO1xyXG4gICAgfVxyXG4gICAgZ2V0SWRUb2tlblJlc3VsdChmb3JjZVJlZnJlc2gpIHtcclxuICAgICAgICByZXR1cm4gZ2V0SWRUb2tlblJlc3VsdCh0aGlzLCBmb3JjZVJlZnJlc2gpO1xyXG4gICAgfVxyXG4gICAgcmVsb2FkKCkge1xyXG4gICAgICAgIHJldHVybiByZWxvYWQodGhpcyk7XHJcbiAgICB9XHJcbiAgICBfYXNzaWduKHVzZXIpIHtcclxuICAgICAgICBpZiAodGhpcyA9PT0gdXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF9hc3NlcnQodGhpcy51aWQgPT09IHVzZXIudWlkLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICB0aGlzLmRpc3BsYXlOYW1lID0gdXNlci5kaXNwbGF5TmFtZTtcclxuICAgICAgICB0aGlzLnBob3RvVVJMID0gdXNlci5waG90b1VSTDtcclxuICAgICAgICB0aGlzLmVtYWlsID0gdXNlci5lbWFpbDtcclxuICAgICAgICB0aGlzLmVtYWlsVmVyaWZpZWQgPSB1c2VyLmVtYWlsVmVyaWZpZWQ7XHJcbiAgICAgICAgdGhpcy5waG9uZU51bWJlciA9IHVzZXIucGhvbmVOdW1iZXI7XHJcbiAgICAgICAgdGhpcy5pc0Fub255bW91cyA9IHVzZXIuaXNBbm9ueW1vdXM7XHJcbiAgICAgICAgdGhpcy50ZW5hbnRJZCA9IHVzZXIudGVuYW50SWQ7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlckRhdGEgPSB1c2VyLnByb3ZpZGVyRGF0YS5tYXAodXNlckluZm8gPT4gKE9iamVjdC5hc3NpZ24oe30sIHVzZXJJbmZvKSkpO1xyXG4gICAgICAgIHRoaXMubWV0YWRhdGEuX2NvcHkodXNlci5tZXRhZGF0YSk7XHJcbiAgICAgICAgdGhpcy5zdHNUb2tlbk1hbmFnZXIuX2Fzc2lnbih1c2VyLnN0c1Rva2VuTWFuYWdlcik7XHJcbiAgICB9XHJcbiAgICBfY2xvbmUoYXV0aCkge1xyXG4gICAgICAgIGNvbnN0IG5ld1VzZXIgPSBuZXcgVXNlckltcGwoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzKSwgeyBhdXRoLCBzdHNUb2tlbk1hbmFnZXI6IHRoaXMuc3RzVG9rZW5NYW5hZ2VyLl9jbG9uZSgpIH0pKTtcclxuICAgICAgICBuZXdVc2VyLm1ldGFkYXRhLl9jb3B5KHRoaXMubWV0YWRhdGEpO1xyXG4gICAgICAgIHJldHVybiBuZXdVc2VyO1xyXG4gICAgfVxyXG4gICAgX29uUmVsb2FkKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgLy8gVGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUgbGlzdGVuZXIsIGFuZCB0aGF0IGlzIGEgc2luZ2xlIGluc3RhbmNlIG9mIE11bHRpRmFjdG9yVXNlclxyXG4gICAgICAgIF9hc3NlcnQoIXRoaXMucmVsb2FkTGlzdGVuZXIsIHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIHRoaXMucmVsb2FkTGlzdGVuZXIgPSBjYWxsYmFjaztcclxuICAgICAgICBpZiAodGhpcy5yZWxvYWRVc2VySW5mbykge1xyXG4gICAgICAgICAgICB0aGlzLl9ub3RpZnlSZWxvYWRMaXN0ZW5lcih0aGlzLnJlbG9hZFVzZXJJbmZvKTtcclxuICAgICAgICAgICAgdGhpcy5yZWxvYWRVc2VySW5mbyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX25vdGlmeVJlbG9hZExpc3RlbmVyKHVzZXJJbmZvKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVsb2FkTGlzdGVuZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWxvYWRMaXN0ZW5lcih1c2VySW5mbyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBJZiBubyBsaXN0ZW5lciBpcyBzdWJzY3JpYmVkIHlldCwgc2F2ZSB0aGUgcmVzdWx0IHNvIGl0J3MgYXZhaWxhYmxlIHdoZW4gdGhleSBkbyBzdWJzY3JpYmVcclxuICAgICAgICAgICAgdGhpcy5yZWxvYWRVc2VySW5mbyA9IHVzZXJJbmZvO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIF9zdGFydFByb2FjdGl2ZVJlZnJlc2goKSB7XHJcbiAgICAgICAgdGhpcy5wcm9hY3RpdmVSZWZyZXNoLl9zdGFydCgpO1xyXG4gICAgfVxyXG4gICAgX3N0b3BQcm9hY3RpdmVSZWZyZXNoKCkge1xyXG4gICAgICAgIHRoaXMucHJvYWN0aXZlUmVmcmVzaC5fc3RvcCgpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3VwZGF0ZVRva2Vuc0lmTmVjZXNzYXJ5KHJlc3BvbnNlLCByZWxvYWQgPSBmYWxzZSkge1xyXG4gICAgICAgIGxldCB0b2tlbnNSZWZyZXNoZWQgPSBmYWxzZTtcclxuICAgICAgICBpZiAocmVzcG9uc2UuaWRUb2tlbiAmJlxyXG4gICAgICAgICAgICByZXNwb25zZS5pZFRva2VuICE9PSB0aGlzLnN0c1Rva2VuTWFuYWdlci5hY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci51cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB0b2tlbnNSZWZyZXNoZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVsb2FkKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhd2FpdCB0aGlzLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHRoaXMpO1xyXG4gICAgICAgIGlmICh0b2tlbnNSZWZyZXNoZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5hdXRoLl9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXN5bmMgZGVsZXRlKCkge1xyXG4gICAgICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcCh0aGlzLmF1dGguYXBwKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IodGhpcy5hdXRoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLmdldElkVG9rZW4oKTtcclxuICAgICAgICBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLCBkZWxldGVBY2NvdW50KHRoaXMuYXV0aCwgeyBpZFRva2VuIH0pKTtcclxuICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci5jbGVhclJlZnJlc2hUb2tlbigpO1xyXG4gICAgICAgIC8vIFRPRE86IERldGVybWluZSBpZiBjYW5jZWxsYWJsZS1wcm9taXNlcyBhcmUgbmVjZXNzYXJ5IHRvIHVzZSBpbiB0aGlzIGNsYXNzIHNvIHRoYXQgZGVsZXRlKClcclxuICAgICAgICAvLyAgICAgICBjYW5jZWxzIHBlbmRpbmcgYWN0aW9ucy4uLlxyXG4gICAgICAgIHJldHVybiB0aGlzLmF1dGguc2lnbk91dCgpO1xyXG4gICAgfVxyXG4gICAgdG9KU09OKCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oeyB1aWQ6IHRoaXMudWlkLCBlbWFpbDogdGhpcy5lbWFpbCB8fCB1bmRlZmluZWQsIGVtYWlsVmVyaWZpZWQ6IHRoaXMuZW1haWxWZXJpZmllZCwgZGlzcGxheU5hbWU6IHRoaXMuZGlzcGxheU5hbWUgfHwgdW5kZWZpbmVkLCBpc0Fub255bW91czogdGhpcy5pc0Fub255bW91cywgcGhvdG9VUkw6IHRoaXMucGhvdG9VUkwgfHwgdW5kZWZpbmVkLCBwaG9uZU51bWJlcjogdGhpcy5waG9uZU51bWJlciB8fCB1bmRlZmluZWQsIHRlbmFudElkOiB0aGlzLnRlbmFudElkIHx8IHVuZGVmaW5lZCwgcHJvdmlkZXJEYXRhOiB0aGlzLnByb3ZpZGVyRGF0YS5tYXAodXNlckluZm8gPT4gKE9iamVjdC5hc3NpZ24oe30sIHVzZXJJbmZvKSkpLCBzdHNUb2tlbk1hbmFnZXI6IHRoaXMuc3RzVG9rZW5NYW5hZ2VyLnRvSlNPTigpLCBcclxuICAgICAgICAgICAgLy8gUmVkaXJlY3QgZXZlbnQgSUQgbXVzdCBiZSBtYWludGFpbmVkIGluIGNhc2UgdGhlcmUgaXMgYSBwZW5kaW5nXHJcbiAgICAgICAgICAgIC8vIHJlZGlyZWN0IGV2ZW50LlxyXG4gICAgICAgICAgICBfcmVkaXJlY3RFdmVudElkOiB0aGlzLl9yZWRpcmVjdEV2ZW50SWQgfSwgdGhpcy5tZXRhZGF0YS50b0pTT04oKSksIHsgXHJcbiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBjb21wYXRpYmlsaXR5IHdpdGggdGhlIGxlZ2FjeSBTREsgKGdvL2ZpcmViYXNlLWF1dGgtc2RrLXBlcnNpc3RlbmNlLXBhcnNpbmcpOlxyXG4gICAgICAgICAgICBhcGlLZXk6IHRoaXMuYXV0aC5jb25maWcuYXBpS2V5LCBhcHBOYW1lOiB0aGlzLmF1dGgubmFtZSB9KTtcclxuICAgIH1cclxuICAgIGdldCByZWZyZXNoVG9rZW4oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLnJlZnJlc2hUb2tlbiB8fCAnJztcclxuICAgIH1cclxuICAgIHN0YXRpYyBfZnJvbUpTT04oYXV0aCwgb2JqZWN0KSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaDtcclxuICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IChfYSA9IG9iamVjdC5kaXNwbGF5TmFtZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGNvbnN0IGVtYWlsID0gKF9iID0gb2JqZWN0LmVtYWlsKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgcGhvbmVOdW1iZXIgPSAoX2MgPSBvYmplY3QucGhvbmVOdW1iZXIpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IHVuZGVmaW5lZDtcclxuICAgICAgICBjb25zdCBwaG90b1VSTCA9IChfZCA9IG9iamVjdC5waG90b1VSTCkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGNvbnN0IHRlbmFudElkID0gKF9lID0gb2JqZWN0LnRlbmFudElkKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgX3JlZGlyZWN0RXZlbnRJZCA9IChfZiA9IG9iamVjdC5fcmVkaXJlY3RFdmVudElkKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgY3JlYXRlZEF0ID0gKF9nID0gb2JqZWN0LmNyZWF0ZWRBdCkgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGNvbnN0IGxhc3RMb2dpbkF0ID0gKF9oID0gb2JqZWN0Lmxhc3RMb2dpbkF0KSAhPT0gbnVsbCAmJiBfaCAhPT0gdm9pZCAwID8gX2ggOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgeyB1aWQsIGVtYWlsVmVyaWZpZWQsIGlzQW5vbnltb3VzLCBwcm92aWRlckRhdGEsIHN0c1Rva2VuTWFuYWdlcjogcGxhaW5PYmplY3RUb2tlbk1hbmFnZXIgfSA9IG9iamVjdDtcclxuICAgICAgICBfYXNzZXJ0KHVpZCAmJiBwbGFpbk9iamVjdFRva2VuTWFuYWdlciwgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGNvbnN0IHN0c1Rva2VuTWFuYWdlciA9IFN0c1Rva2VuTWFuYWdlci5mcm9tSlNPTih0aGlzLm5hbWUsIHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyKTtcclxuICAgICAgICBfYXNzZXJ0KHR5cGVvZiB1aWQgPT09ICdzdHJpbmcnLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoZGlzcGxheU5hbWUsIGF1dGgubmFtZSk7XHJcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoZW1haWwsIGF1dGgubmFtZSk7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgZW1haWxWZXJpZmllZCA9PT0gJ2Jvb2xlYW4nLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgaXNBbm9ueW1vdXMgPT09ICdib29sZWFuJywgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHBob25lTnVtYmVyLCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHBob3RvVVJMLCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHRlbmFudElkLCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKF9yZWRpcmVjdEV2ZW50SWQsIGF1dGgubmFtZSk7XHJcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoY3JlYXRlZEF0LCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGxhc3RMb2dpbkF0LCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlckltcGwoe1xyXG4gICAgICAgICAgICB1aWQsXHJcbiAgICAgICAgICAgIGF1dGgsXHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkLFxyXG4gICAgICAgICAgICBkaXNwbGF5TmFtZSxcclxuICAgICAgICAgICAgaXNBbm9ueW1vdXMsXHJcbiAgICAgICAgICAgIHBob3RvVVJMLFxyXG4gICAgICAgICAgICBwaG9uZU51bWJlcixcclxuICAgICAgICAgICAgdGVuYW50SWQsXHJcbiAgICAgICAgICAgIHN0c1Rva2VuTWFuYWdlcixcclxuICAgICAgICAgICAgY3JlYXRlZEF0LFxyXG4gICAgICAgICAgICBsYXN0TG9naW5BdFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChwcm92aWRlckRhdGEgJiYgQXJyYXkuaXNBcnJheShwcm92aWRlckRhdGEpKSB7XHJcbiAgICAgICAgICAgIHVzZXIucHJvdmlkZXJEYXRhID0gcHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfcmVkaXJlY3RFdmVudElkKSB7XHJcbiAgICAgICAgICAgIHVzZXIuX3JlZGlyZWN0RXZlbnRJZCA9IF9yZWRpcmVjdEV2ZW50SWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsaXplIGEgVXNlciBmcm9tIGFuIGlkVG9rZW4gc2VydmVyIHJlc3BvbnNlXHJcbiAgICAgKiBAcGFyYW0gYXV0aFxyXG4gICAgICogQHBhcmFtIGlkVG9rZW5SZXNwb25zZVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXN5bmMgX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3Qgc3RzVG9rZW5NYW5hZ2VyID0gbmV3IFN0c1Rva2VuTWFuYWdlcigpO1xyXG4gICAgICAgIHN0c1Rva2VuTWFuYWdlci51cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UoaWRUb2tlblJlc3BvbnNlKTtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBGaXJlYmFzZSBBdXRoIHVzZXIuXHJcbiAgICAgICAgY29uc3QgdXNlciA9IG5ldyBVc2VySW1wbCh7XHJcbiAgICAgICAgICAgIHVpZDogaWRUb2tlblJlc3BvbnNlLmxvY2FsSWQsXHJcbiAgICAgICAgICAgIGF1dGgsXHJcbiAgICAgICAgICAgIHN0c1Rva2VuTWFuYWdlcixcclxuICAgICAgICAgICAgaXNBbm9ueW1vdXNcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBVcGRhdGVzIHRoZSB1c2VyIGluZm8gYW5kIGRhdGEgYW5kIHJlc29sdmVzIHdpdGggYSB1c2VyIGluc3RhbmNlLlxyXG4gICAgICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXIpO1xyXG4gICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsaXplIGEgVXNlciBmcm9tIGFuIGlkVG9rZW4gc2VydmVyIHJlc3BvbnNlXHJcbiAgICAgKiBAcGFyYW0gYXV0aFxyXG4gICAgICogQHBhcmFtIGlkVG9rZW5SZXNwb25zZVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXN5bmMgX2Zyb21HZXRBY2NvdW50SW5mb1Jlc3BvbnNlKGF1dGgsIHJlc3BvbnNlLCBpZFRva2VuKSB7XHJcbiAgICAgICAgY29uc3QgY29yZUFjY291bnQgPSByZXNwb25zZS51c2Vyc1swXTtcclxuICAgICAgICBfYXNzZXJ0KGNvcmVBY2NvdW50LmxvY2FsSWQgIT09IHVuZGVmaW5lZCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyRGF0YSA9IGNvcmVBY2NvdW50LnByb3ZpZGVyVXNlckluZm8gIT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICA/IGV4dHJhY3RQcm92aWRlckRhdGEoY29yZUFjY291bnQucHJvdmlkZXJVc2VySW5mbylcclxuICAgICAgICAgICAgOiBbXTtcclxuICAgICAgICBjb25zdCBpc0Fub255bW91cyA9ICEoY29yZUFjY291bnQuZW1haWwgJiYgY29yZUFjY291bnQucGFzc3dvcmRIYXNoKSAmJiAhKHByb3ZpZGVyRGF0YSA9PT0gbnVsbCB8fCBwcm92aWRlckRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb3ZpZGVyRGF0YS5sZW5ndGgpO1xyXG4gICAgICAgIGNvbnN0IHN0c1Rva2VuTWFuYWdlciA9IG5ldyBTdHNUb2tlbk1hbmFnZXIoKTtcclxuICAgICAgICBzdHNUb2tlbk1hbmFnZXIudXBkYXRlRnJvbUlkVG9rZW4oaWRUb2tlbik7XHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgRmlyZWJhc2UgQXV0aCB1c2VyLlxyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlckltcGwoe1xyXG4gICAgICAgICAgICB1aWQ6IGNvcmVBY2NvdW50LmxvY2FsSWQsXHJcbiAgICAgICAgICAgIGF1dGgsXHJcbiAgICAgICAgICAgIHN0c1Rva2VuTWFuYWdlcixcclxuICAgICAgICAgICAgaXNBbm9ueW1vdXNcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyB1cGRhdGUgdGhlIHVzZXIgd2l0aCBkYXRhIGZyb20gdGhlIEdldEFjY291bnRJbmZvIHJlc3BvbnNlLlxyXG4gICAgICAgIGNvbnN0IHVwZGF0ZXMgPSB7XHJcbiAgICAgICAgICAgIHVpZDogY29yZUFjY291bnQubG9jYWxJZCxcclxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IGNvcmVBY2NvdW50LmRpc3BsYXlOYW1lIHx8IG51bGwsXHJcbiAgICAgICAgICAgIHBob3RvVVJMOiBjb3JlQWNjb3VudC5waG90b1VybCB8fCBudWxsLFxyXG4gICAgICAgICAgICBlbWFpbDogY29yZUFjY291bnQuZW1haWwgfHwgbnVsbCxcclxuICAgICAgICAgICAgZW1haWxWZXJpZmllZDogY29yZUFjY291bnQuZW1haWxWZXJpZmllZCB8fCBmYWxzZSxcclxuICAgICAgICAgICAgcGhvbmVOdW1iZXI6IGNvcmVBY2NvdW50LnBob25lTnVtYmVyIHx8IG51bGwsXHJcbiAgICAgICAgICAgIHRlbmFudElkOiBjb3JlQWNjb3VudC50ZW5hbnRJZCB8fCBudWxsLFxyXG4gICAgICAgICAgICBwcm92aWRlckRhdGEsXHJcbiAgICAgICAgICAgIG1ldGFkYXRhOiBuZXcgVXNlck1ldGFkYXRhKGNvcmVBY2NvdW50LmNyZWF0ZWRBdCwgY29yZUFjY291bnQubGFzdExvZ2luQXQpLFxyXG4gICAgICAgICAgICBpc0Fub255bW91czogIShjb3JlQWNjb3VudC5lbWFpbCAmJiBjb3JlQWNjb3VudC5wYXNzd29yZEhhc2gpICYmXHJcbiAgICAgICAgICAgICAgICAhKHByb3ZpZGVyRGF0YSA9PT0gbnVsbCB8fCBwcm92aWRlckRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb3ZpZGVyRGF0YS5sZW5ndGgpXHJcbiAgICAgICAgfTtcclxuICAgICAgICBPYmplY3QuYXNzaWduKHVzZXIsIHVwZGF0ZXMpO1xyXG4gICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IGluc3RhbmNlQ2FjaGUgPSBuZXcgTWFwKCk7XHJcbmZ1bmN0aW9uIF9nZXRJbnN0YW5jZShjbHMpIHtcclxuICAgIGRlYnVnQXNzZXJ0KGNscyBpbnN0YW5jZW9mIEZ1bmN0aW9uLCAnRXhwZWN0ZWQgYSBjbGFzcyBkZWZpbml0aW9uJyk7XHJcbiAgICBsZXQgaW5zdGFuY2UgPSBpbnN0YW5jZUNhY2hlLmdldChjbHMpO1xyXG4gICAgaWYgKGluc3RhbmNlKSB7XHJcbiAgICAgICAgZGVidWdBc3NlcnQoaW5zdGFuY2UgaW5zdGFuY2VvZiBjbHMsICdJbnN0YW5jZSBzdG9yZWQgaW4gY2FjaGUgbWlzbWF0Y2hlZCB3aXRoIGNsYXNzJyk7XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xyXG4gICAgfVxyXG4gICAgaW5zdGFuY2UgPSBuZXcgY2xzKCk7XHJcbiAgICBpbnN0YW5jZUNhY2hlLnNldChjbHMsIGluc3RhbmNlKTtcclxuICAgIHJldHVybiBpbnN0YW5jZTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBJbk1lbW9yeVBlcnNpc3RlbmNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IFwiTk9ORVwiIC8qIFBlcnNpc3RlbmNlVHlwZS5OT05FICovO1xyXG4gICAgICAgIHRoaXMuc3RvcmFnZSA9IHt9O1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX2lzQXZhaWxhYmxlKCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3NldChrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yYWdlW2tleV0gPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIGFzeW5jIF9nZXQoa2V5KSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnN0b3JhZ2Vba2V5XTtcclxuICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB2YWx1ZTtcclxuICAgIH1cclxuICAgIGFzeW5jIF9yZW1vdmUoa2V5KSB7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuc3RvcmFnZVtrZXldO1xyXG4gICAgfVxyXG4gICAgX2FkZExpc3RlbmVyKF9rZXksIF9saXN0ZW5lcikge1xyXG4gICAgICAgIC8vIExpc3RlbmVycyBhcmUgbm90IHN1cHBvcnRlZCBmb3IgaW4tbWVtb3J5IHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cy93b3JrZXJzXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgX3JlbW92ZUxpc3RlbmVyKF9rZXksIF9saXN0ZW5lcikge1xyXG4gICAgICAgIC8vIExpc3RlbmVycyBhcmUgbm90IHN1cHBvcnRlZCBmb3IgaW4tbWVtb3J5IHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cy93b3JrZXJzXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG59XHJcbkluTWVtb3J5UGVyc2lzdGVuY2UudHlwZSA9ICdOT05FJztcclxuLyoqXHJcbiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQZXJzaXN0ZW5jZX0gb2YgdHlwZSAnTk9ORScuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGluTWVtb3J5UGVyc2lzdGVuY2UgPSBJbk1lbW9yeVBlcnNpc3RlbmNlO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBfcGVyc2lzdGVuY2VLZXlOYW1lKGtleSwgYXBpS2V5LCBhcHBOYW1lKSB7XHJcbiAgICByZXR1cm4gYCR7XCJmaXJlYmFzZVwiIC8qIE5hbWVzcGFjZS5QRVJTSVNURU5DRSAqL306JHtrZXl9OiR7YXBpS2V5fToke2FwcE5hbWV9YDtcclxufVxyXG5jbGFzcyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKHBlcnNpc3RlbmNlLCBhdXRoLCB1c2VyS2V5KSB7XHJcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IHBlcnNpc3RlbmNlO1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XHJcbiAgICAgICAgdGhpcy51c2VyS2V5ID0gdXNlcktleTtcclxuICAgICAgICBjb25zdCB7IGNvbmZpZywgbmFtZSB9ID0gdGhpcy5hdXRoO1xyXG4gICAgICAgIHRoaXMuZnVsbFVzZXJLZXkgPSBfcGVyc2lzdGVuY2VLZXlOYW1lKHRoaXMudXNlcktleSwgY29uZmlnLmFwaUtleSwgbmFtZSk7XHJcbiAgICAgICAgdGhpcy5mdWxsUGVyc2lzdGVuY2VLZXkgPSBfcGVyc2lzdGVuY2VLZXlOYW1lKFwicGVyc2lzdGVuY2VcIiAvKiBLZXlOYW1lLlBFUlNJU1RFTkNFX1VTRVIgKi8sIGNvbmZpZy5hcGlLZXksIG5hbWUpO1xyXG4gICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXIgPSBhdXRoLl9vblN0b3JhZ2VFdmVudC5iaW5kKGF1dGgpO1xyXG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UuX2FkZExpc3RlbmVyKHRoaXMuZnVsbFVzZXJLZXksIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpO1xyXG4gICAgfVxyXG4gICAgc2V0Q3VycmVudFVzZXIodXNlcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLl9zZXQodGhpcy5mdWxsVXNlcktleSwgdXNlci50b0pTT04oKSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRDdXJyZW50VXNlcigpIHtcclxuICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5fZ2V0KHRoaXMuZnVsbFVzZXJLZXkpO1xyXG4gICAgICAgIHJldHVybiBibG9iID8gVXNlckltcGwuX2Zyb21KU09OKHRoaXMuYXV0aCwgYmxvYikgOiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmVtb3ZlQ3VycmVudFVzZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuX3JlbW92ZSh0aGlzLmZ1bGxVc2VyS2V5KTtcclxuICAgIH1cclxuICAgIHNhdmVQZXJzaXN0ZW5jZUZvclJlZGlyZWN0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLl9zZXQodGhpcy5mdWxsUGVyc2lzdGVuY2VLZXksIHRoaXMucGVyc2lzdGVuY2UudHlwZSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBzZXRQZXJzaXN0ZW5jZShuZXdQZXJzaXN0ZW5jZSkge1xyXG4gICAgICAgIGlmICh0aGlzLnBlcnNpc3RlbmNlID09PSBuZXdQZXJzaXN0ZW5jZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcigpO1xyXG4gICAgICAgIGF3YWl0IHRoaXMucmVtb3ZlQ3VycmVudFVzZXIoKTtcclxuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gbmV3UGVyc2lzdGVuY2U7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldEN1cnJlbnRVc2VyKGN1cnJlbnRVc2VyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBkZWxldGUoKSB7XHJcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZS5fcmVtb3ZlTGlzdGVuZXIodGhpcy5mdWxsVXNlcktleSwgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcik7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgYXN5bmMgY3JlYXRlKGF1dGgsIHBlcnNpc3RlbmNlSGllcmFyY2h5LCB1c2VyS2V5ID0gXCJhdXRoVXNlclwiIC8qIEtleU5hbWUuQVVUSF9VU0VSICovKSB7XHJcbiAgICAgICAgaWYgKCFwZXJzaXN0ZW5jZUhpZXJhcmNoeS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyKF9nZXRJbnN0YW5jZShpbk1lbW9yeVBlcnNpc3RlbmNlKSwgYXV0aCwgdXNlcktleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEVsaW1pbmF0ZSBhbnkgcGVyc2lzdGVuY2VzIHRoYXQgYXJlIG5vdCBhdmFpbGFibGVcclxuICAgICAgICBjb25zdCBhdmFpbGFibGVQZXJzaXN0ZW5jZXMgPSAoYXdhaXQgUHJvbWlzZS5hbGwocGVyc2lzdGVuY2VIaWVyYXJjaHkubWFwKGFzeW5jIChwZXJzaXN0ZW5jZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYXdhaXQgcGVyc2lzdGVuY2UuX2lzQXZhaWxhYmxlKCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwZXJzaXN0ZW5jZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0pKSkuZmlsdGVyKHBlcnNpc3RlbmNlID0+IHBlcnNpc3RlbmNlKTtcclxuICAgICAgICAvLyBGYWxsIGJhY2sgdG8gdGhlIGZpcnN0IHBlcnNpc3RlbmNlIGxpc3RlZCwgb3IgaW4gbWVtb3J5IGlmIG5vbmUgYXZhaWxhYmxlXHJcbiAgICAgICAgbGV0IHNlbGVjdGVkUGVyc2lzdGVuY2UgPSBhdmFpbGFibGVQZXJzaXN0ZW5jZXNbMF0gfHxcclxuICAgICAgICAgICAgX2dldEluc3RhbmNlKGluTWVtb3J5UGVyc2lzdGVuY2UpO1xyXG4gICAgICAgIGNvbnN0IGtleSA9IF9wZXJzaXN0ZW5jZUtleU5hbWUodXNlcktleSwgYXV0aC5jb25maWcuYXBpS2V5LCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIC8vIFB1bGwgb3V0IHRoZSBleGlzdGluZyB1c2VyLCBzZXR0aW5nIHRoZSBjaG9zZW4gcGVyc2lzdGVuY2UgdG8gdGhhdFxyXG4gICAgICAgIC8vIHBlcnNpc3RlbmNlIGlmIHRoZSB1c2VyIGV4aXN0cy5cclxuICAgICAgICBsZXQgdXNlclRvTWlncmF0ZSA9IG51bGw7XHJcbiAgICAgICAgLy8gTm90ZSwgaGVyZSB3ZSBjaGVjayBmb3IgYSB1c2VyIGluIF9hbGxfIHBlcnNpc3RlbmNlcywgbm90IGp1c3QgdGhlXHJcbiAgICAgICAgLy8gb25lcyBkZWVtZWQgYXZhaWxhYmxlLiBJZiB3ZSBjYW4gbWlncmF0ZSBhIHVzZXIgb3V0IG9mIGEgYnJva2VuXHJcbiAgICAgICAgLy8gcGVyc2lzdGVuY2UsIHdlIHdpbGwgKGJ1dCBvbmx5IGlmIHRoYXQgcGVyc2lzdGVuY2Ugc3VwcG9ydHMgbWlncmF0aW9uKS5cclxuICAgICAgICBmb3IgKGNvbnN0IHBlcnNpc3RlbmNlIG9mIHBlcnNpc3RlbmNlSGllcmFyY2h5KSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgcGVyc2lzdGVuY2UuX2dldChrZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJsb2IpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyID0gVXNlckltcGwuX2Zyb21KU09OKGF1dGgsIGJsb2IpOyAvLyB0aHJvd3MgZm9yIHVucGFyc2FibGUgYmxvYiAod3JvbmcgZm9ybWF0KVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwZXJzaXN0ZW5jZSAhPT0gc2VsZWN0ZWRQZXJzaXN0ZW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyVG9NaWdyYXRlID0gdXNlcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IHBlcnNpc3RlbmNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChfYSkgeyB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIElmIHdlIGZpbmQgdGhlIHVzZXIgaW4gYSBwZXJzaXN0ZW5jZSB0aGF0IGRvZXMgc3VwcG9ydCBtaWdyYXRpb24sIHVzZVxyXG4gICAgICAgIC8vIHRoYXQgbWlncmF0aW9uIHBhdGggKG9mIG9ubHkgcGVyc2lzdGVuY2VzIHRoYXQgc3VwcG9ydCBtaWdyYXRpb24pXHJcbiAgICAgICAgY29uc3QgbWlncmF0aW9uSGllcmFyY2h5ID0gYXZhaWxhYmxlUGVyc2lzdGVuY2VzLmZpbHRlcihwID0+IHAuX3Nob3VsZEFsbG93TWlncmF0aW9uKTtcclxuICAgICAgICAvLyBJZiB0aGUgcGVyc2lzdGVuY2UgZG9lcyBfbm90XyBhbGxvdyBtaWdyYXRpb24sIGp1c3QgZmluaXNoIG9mZiBoZXJlXHJcbiAgICAgICAgaWYgKCFzZWxlY3RlZFBlcnNpc3RlbmNlLl9zaG91bGRBbGxvd01pZ3JhdGlvbiB8fFxyXG4gICAgICAgICAgICAhbWlncmF0aW9uSGllcmFyY2h5Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIoc2VsZWN0ZWRQZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlbGVjdGVkUGVyc2lzdGVuY2UgPSBtaWdyYXRpb25IaWVyYXJjaHlbMF07XHJcbiAgICAgICAgaWYgKHVzZXJUb01pZ3JhdGUpIHtcclxuICAgICAgICAgICAgLy8gVGhpcyBub3JtYWxseSBzaG91bGRuJ3QgdGhyb3cgc2luY2UgY2hvc2VuUGVyc2lzdGVuY2UuaXNBdmFpbGFibGUoKSBpcyB0cnVlLCBidXQgaWYgaXQgZG9lc1xyXG4gICAgICAgICAgICAvLyB3ZSdsbCBqdXN0IGxldCBpdCBidWJibGUgdG8gc3VyZmFjZSB0aGUgZXJyb3IuXHJcbiAgICAgICAgICAgIGF3YWl0IHNlbGVjdGVkUGVyc2lzdGVuY2UuX3NldChrZXksIHVzZXJUb01pZ3JhdGUudG9KU09OKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBBdHRlbXB0IHRvIGNsZWFyIHRoZSBrZXkgaW4gb3RoZXIgcGVyc2lzdGVuY2VzIGJ1dCBpZ25vcmUgZXJyb3JzLiBUaGlzIGhlbHBzIHByZXZlbnQgaXNzdWVzXHJcbiAgICAgICAgLy8gc3VjaCBhcyB1c2VycyBnZXR0aW5nIHN0dWNrIHdpdGggYSBwcmV2aW91cyBhY2NvdW50IGFmdGVyIHNpZ25pbmcgb3V0IGFuZCByZWZyZXNoaW5nIHRoZSB0YWIuXHJcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocGVyc2lzdGVuY2VIaWVyYXJjaHkubWFwKGFzeW5jIChwZXJzaXN0ZW5jZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocGVyc2lzdGVuY2UgIT09IHNlbGVjdGVkUGVyc2lzdGVuY2UpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcGVyc2lzdGVuY2UuX3JlbW92ZShrZXkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7IH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIoc2VsZWN0ZWRQZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIERldGVybWluZSB0aGUgYnJvd3NlciBmb3IgdGhlIHB1cnBvc2VzIG9mIHJlcG9ydGluZyB1c2FnZSB0byB0aGUgQVBJXHJcbiAqL1xyXG5mdW5jdGlvbiBfZ2V0QnJvd3Nlck5hbWUodXNlckFnZW50KSB7XHJcbiAgICBjb25zdCB1YSA9IHVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKHVhLmluY2x1ZGVzKCdvcGVyYS8nKSB8fCB1YS5pbmNsdWRlcygnb3ByLycpIHx8IHVhLmluY2x1ZGVzKCdvcGlvcy8nKSkge1xyXG4gICAgICAgIHJldHVybiBcIk9wZXJhXCIgLyogQnJvd3Nlck5hbWUuT1BFUkEgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChfaXNJRU1vYmlsZSh1YSkpIHtcclxuICAgICAgICAvLyBXaW5kb3dzIHBob25lIElFTW9iaWxlIGJyb3dzZXIuXHJcbiAgICAgICAgcmV0dXJuIFwiSUVNb2JpbGVcIiAvKiBCcm93c2VyTmFtZS5JRU1PQklMRSAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdtc2llJykgfHwgdWEuaW5jbHVkZXMoJ3RyaWRlbnQvJykpIHtcclxuICAgICAgICByZXR1cm4gXCJJRVwiIC8qIEJyb3dzZXJOYW1lLklFICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAodWEuaW5jbHVkZXMoJ2VkZ2UvJykpIHtcclxuICAgICAgICByZXR1cm4gXCJFZGdlXCIgLyogQnJvd3Nlck5hbWUuRURHRSAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKF9pc0ZpcmVmb3godWEpKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiRmlyZWZveFwiIC8qIEJyb3dzZXJOYW1lLkZJUkVGT1ggKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh1YS5pbmNsdWRlcygnc2lsay8nKSkge1xyXG4gICAgICAgIHJldHVybiBcIlNpbGtcIiAvKiBCcm93c2VyTmFtZS5TSUxLICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoX2lzQmxhY2tCZXJyeSh1YSkpIHtcclxuICAgICAgICAvLyBCbGFja2JlcnJ5IGJyb3dzZXIuXHJcbiAgICAgICAgcmV0dXJuIFwiQmxhY2tiZXJyeVwiIC8qIEJyb3dzZXJOYW1lLkJMQUNLQkVSUlkgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChfaXNXZWJPUyh1YSkpIHtcclxuICAgICAgICAvLyBXZWJPUyBkZWZhdWx0IGJyb3dzZXIuXHJcbiAgICAgICAgcmV0dXJuIFwiV2Vib3NcIiAvKiBCcm93c2VyTmFtZS5XRUJPUyAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKF9pc1NhZmFyaSh1YSkpIHtcclxuICAgICAgICByZXR1cm4gXCJTYWZhcmlcIiAvKiBCcm93c2VyTmFtZS5TQUZBUkkgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICgodWEuaW5jbHVkZXMoJ2Nocm9tZS8nKSB8fCBfaXNDaHJvbWVJT1ModWEpKSAmJlxyXG4gICAgICAgICF1YS5pbmNsdWRlcygnZWRnZS8nKSkge1xyXG4gICAgICAgIHJldHVybiBcIkNocm9tZVwiIC8qIEJyb3dzZXJOYW1lLkNIUk9NRSAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKF9pc0FuZHJvaWQodWEpKSB7XHJcbiAgICAgICAgLy8gQW5kcm9pZCBzdG9jayBicm93c2VyLlxyXG4gICAgICAgIHJldHVybiBcIkFuZHJvaWRcIiAvKiBCcm93c2VyTmFtZS5BTkRST0lEICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgLy8gTW9zdCBtb2Rlcm4gYnJvd3NlcnMgaGF2ZSBuYW1lL3ZlcnNpb24gYXQgZW5kIG9mIHVzZXIgYWdlbnQgc3RyaW5nLlxyXG4gICAgICAgIGNvbnN0IHJlID0gLyhbYS16QS1aXFxkXFwuXSspXFwvW2EtekEtWlxcZFxcLl0qJC87XHJcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHVzZXJBZ2VudC5tYXRjaChyZSk7XHJcbiAgICAgICAgaWYgKChtYXRjaGVzID09PSBudWxsIHx8IG1hdGNoZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoZXMubGVuZ3RoKSA9PT0gMikge1xyXG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlc1sxXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gXCJPdGhlclwiIC8qIEJyb3dzZXJOYW1lLk9USEVSICovO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0ZpcmVmb3godWEgPSBnZXRVQSgpKSB7XHJcbiAgICByZXR1cm4gL2ZpcmVmb3hcXC8vaS50ZXN0KHVhKTtcclxufVxyXG5mdW5jdGlvbiBfaXNTYWZhcmkodXNlckFnZW50ID0gZ2V0VUEoKSkge1xyXG4gICAgY29uc3QgdWEgPSB1c2VyQWdlbnQudG9Mb3dlckNhc2UoKTtcclxuICAgIHJldHVybiAodWEuaW5jbHVkZXMoJ3NhZmFyaS8nKSAmJlxyXG4gICAgICAgICF1YS5pbmNsdWRlcygnY2hyb21lLycpICYmXHJcbiAgICAgICAgIXVhLmluY2x1ZGVzKCdjcmlvcy8nKSAmJlxyXG4gICAgICAgICF1YS5pbmNsdWRlcygnYW5kcm9pZCcpKTtcclxufVxyXG5mdW5jdGlvbiBfaXNDaHJvbWVJT1ModWEgPSBnZXRVQSgpKSB7XHJcbiAgICByZXR1cm4gL2NyaW9zXFwvL2kudGVzdCh1YSk7XHJcbn1cclxuZnVuY3Rpb24gX2lzSUVNb2JpbGUodWEgPSBnZXRVQSgpKSB7XHJcbiAgICByZXR1cm4gL2llbW9iaWxlL2kudGVzdCh1YSk7XHJcbn1cclxuZnVuY3Rpb24gX2lzQW5kcm9pZCh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAvYW5kcm9pZC9pLnRlc3QodWEpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0JsYWNrQmVycnkodWEgPSBnZXRVQSgpKSB7XHJcbiAgICByZXR1cm4gL2JsYWNrYmVycnkvaS50ZXN0KHVhKTtcclxufVxyXG5mdW5jdGlvbiBfaXNXZWJPUyh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAvd2Vib3MvaS50ZXN0KHVhKTtcclxufVxyXG5mdW5jdGlvbiBfaXNJT1ModWEgPSBnZXRVQSgpKSB7XHJcbiAgICByZXR1cm4gKC9pcGhvbmV8aXBhZHxpcG9kL2kudGVzdCh1YSkgfHxcclxuICAgICAgICAoL21hY2ludG9zaC9pLnRlc3QodWEpICYmIC9tb2JpbGUvaS50ZXN0KHVhKSkpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0lPUzdPcjgodWEgPSBnZXRVQSgpKSB7XHJcbiAgICByZXR1cm4gKC8oaVBhZHxpUGhvbmV8aVBvZCkuKk9TIDdfXFxkL2kudGVzdCh1YSkgfHxcclxuICAgICAgICAvKGlQYWR8aVBob25lfGlQb2QpLipPUyA4X1xcZC9pLnRlc3QodWEpKTtcclxufVxyXG5mdW5jdGlvbiBfaXNJT1NTdGFuZGFsb25lKHVhID0gZ2V0VUEoKSkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgcmV0dXJuIF9pc0lPUyh1YSkgJiYgISEoKF9hID0gd2luZG93Lm5hdmlnYXRvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0YW5kYWxvbmUpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0lFMTAoKSB7XHJcbiAgICByZXR1cm4gaXNJRSgpICYmIGRvY3VtZW50LmRvY3VtZW50TW9kZSA9PT0gMTA7XHJcbn1cclxuZnVuY3Rpb24gX2lzTW9iaWxlQnJvd3Nlcih1YSA9IGdldFVBKCkpIHtcclxuICAgIC8vIFRPRE86IGltcGxlbWVudCBnZXRCcm93c2VyTmFtZSBlcXVpdmFsZW50IGZvciBPUy5cclxuICAgIHJldHVybiAoX2lzSU9TKHVhKSB8fFxyXG4gICAgICAgIF9pc0FuZHJvaWQodWEpIHx8XHJcbiAgICAgICAgX2lzV2ViT1ModWEpIHx8XHJcbiAgICAgICAgX2lzQmxhY2tCZXJyeSh1YSkgfHxcclxuICAgICAgICAvd2luZG93cyBwaG9uZS9pLnRlc3QodWEpIHx8XHJcbiAgICAgICAgX2lzSUVNb2JpbGUodWEpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKlxyXG4gKiBEZXRlcm1pbmUgdGhlIFNESyB2ZXJzaW9uIHN0cmluZ1xyXG4gKi9cclxuZnVuY3Rpb24gX2dldENsaWVudFZlcnNpb24oY2xpZW50UGxhdGZvcm0sIGZyYW1ld29ya3MgPSBbXSkge1xyXG4gICAgbGV0IHJlcG9ydGVkUGxhdGZvcm07XHJcbiAgICBzd2l0Y2ggKGNsaWVudFBsYXRmb3JtKSB7XHJcbiAgICAgICAgY2FzZSBcIkJyb3dzZXJcIiAvKiBDbGllbnRQbGF0Zm9ybS5CUk9XU0VSICovOlxyXG4gICAgICAgICAgICAvLyBJbiBhIGJyb3dzZXIgZW52aXJvbm1lbnQsIHJlcG9ydCB0aGUgYnJvd3NlciBuYW1lLlxyXG4gICAgICAgICAgICByZXBvcnRlZFBsYXRmb3JtID0gX2dldEJyb3dzZXJOYW1lKGdldFVBKCkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiV29ya2VyXCIgLyogQ2xpZW50UGxhdGZvcm0uV09SS0VSICovOlxyXG4gICAgICAgICAgICAvLyBUZWNobmljYWxseSBhIHdvcmtlciBydW5zIGZyb20gYSBicm93c2VyIGJ1dCB3ZSBuZWVkIHRvIGRpZmZlcmVudGlhdGUgYVxyXG4gICAgICAgICAgICAvLyB3b3JrZXIgZnJvbSBhIGJyb3dzZXIuXHJcbiAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBDaHJvbWUtV29ya2VyL0pzQ29yZS80LjkuMS9GaXJlYmFzZUNvcmUtd2ViLlxyXG4gICAgICAgICAgICByZXBvcnRlZFBsYXRmb3JtID0gYCR7X2dldEJyb3dzZXJOYW1lKGdldFVBKCkpfS0ke2NsaWVudFBsYXRmb3JtfWA7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJlcG9ydGVkUGxhdGZvcm0gPSBjbGllbnRQbGF0Zm9ybTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcG9ydGVkRnJhbWV3b3JrcyA9IGZyYW1ld29ya3MubGVuZ3RoXHJcbiAgICAgICAgPyBmcmFtZXdvcmtzLmpvaW4oJywnKVxyXG4gICAgICAgIDogJ0ZpcmViYXNlQ29yZS13ZWInOyAvKiBkZWZhdWx0IHZhbHVlIGlmIG5vIG90aGVyIGZyYW1ld29yayBpcyB1c2VkICovXHJcbiAgICByZXR1cm4gYCR7cmVwb3J0ZWRQbGF0Zm9ybX0vJHtcIkpzQ29yZVwiIC8qIENsaWVudEltcGxlbWVudGF0aW9uLkNPUkUgKi99LyR7U0RLX1ZFUlNJT059LyR7cmVwb3J0ZWRGcmFtZXdvcmtzfWA7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgQXV0aE1pZGRsZXdhcmVRdWV1ZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLnF1ZXVlID0gW107XHJcbiAgICB9XHJcbiAgICBwdXNoQ2FsbGJhY2soY2FsbGJhY2ssIG9uQWJvcnQpIHtcclxuICAgICAgICAvLyBUaGUgY2FsbGJhY2sgY291bGQgYmUgc3luYyBvciBhc3luYy4gV3JhcCBpdCBpbnRvIGFcclxuICAgICAgICAvLyBmdW5jdGlvbiB0aGF0IGlzIGFsd2F5cyBhc3luYy5cclxuICAgICAgICBjb25zdCB3cmFwcGVkQ2FsbGJhY2sgPSAodXNlcikgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2FsbGJhY2sodXNlcik7XHJcbiAgICAgICAgICAgICAgICAvLyBFaXRoZXIgcmVzb2x2ZSB3aXRoIGV4aXN0aW5nIHByb21pc2Ugb3Igd3JhcCBhIG5vbi1wcm9taXNlXHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gdmFsdWUgaW50byBhIHByb21pc2UuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIFN5bmMgY2FsbGJhY2sgdGhyb3dzLlxyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gQXR0YWNoIHRoZSBvbkFib3J0IGlmIHByZXNlbnRcclxuICAgICAgICB3cmFwcGVkQ2FsbGJhY2sub25BYm9ydCA9IG9uQWJvcnQ7XHJcbiAgICAgICAgdGhpcy5xdWV1ZS5wdXNoKHdyYXBwZWRDYWxsYmFjayk7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnF1ZXVlLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgLy8gVW5zdWJzY3JpYmUuIFJlcGxhY2Ugd2l0aCBuby1vcC4gRG8gbm90IHJlbW92ZSBmcm9tIGFycmF5LCBvciBpdCB3aWxsIGRpc3R1cmJcclxuICAgICAgICAgICAgLy8gaW5kZXhpbmcgb2Ygb3RoZXIgZWxlbWVudHMuXHJcbiAgICAgICAgICAgIHRoaXMucXVldWVbaW5kZXhdID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGFzeW5jIHJ1bk1pZGRsZXdhcmUobmV4dFVzZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5hdXRoLmN1cnJlbnRVc2VyID09PSBuZXh0VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFdoaWxlIHJ1bm5pbmcgdGhlIG1pZGRsZXdhcmUsIGJ1aWxkIGEgdGVtcG9yYXJ5IHN0YWNrIG9mIG9uQWJvcnRcclxuICAgICAgICAvLyBjYWxsYmFja3MgdG8gY2FsbCBpZiBvbmUgbWlkZGxld2FyZSBjYWxsYmFjayByZWplY3RzLlxyXG4gICAgICAgIGNvbnN0IG9uQWJvcnRTdGFjayA9IFtdO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgYmVmb3JlU3RhdGVDYWxsYmFjayBvZiB0aGlzLnF1ZXVlKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBiZWZvcmVTdGF0ZUNhbGxiYWNrKG5leHRVc2VyKTtcclxuICAgICAgICAgICAgICAgIC8vIE9ubHkgcHVzaCB0aGUgb25BYm9ydCBpZiB0aGUgY2FsbGJhY2sgc3VjY2VlZHNcclxuICAgICAgICAgICAgICAgIGlmIChiZWZvcmVTdGF0ZUNhbGxiYWNrLm9uQWJvcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvbkFib3J0U3RhY2sucHVzaChiZWZvcmVTdGF0ZUNhbGxiYWNrLm9uQWJvcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIC8vIFJ1biBhbGwgb25BYm9ydCwgd2l0aCBzZXBhcmF0ZSB0cnkvY2F0Y2ggdG8gaWdub3JlIGFueSBlcnJvcnMgYW5kXHJcbiAgICAgICAgICAgIC8vIGNvbnRpbnVlXHJcbiAgICAgICAgICAgIG9uQWJvcnRTdGFjay5yZXZlcnNlKCk7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qgb25BYm9ydCBvZiBvbkFib3J0U3RhY2spIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25BYm9ydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKF8pIHtcclxuICAgICAgICAgICAgICAgICAgICAvKiBzd2FsbG93IGVycm9yICovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhyb3cgdGhpcy5hdXRoLl9lcnJvckZhY3RvcnkuY3JlYXRlKFwibG9naW4tYmxvY2tlZFwiIC8qIEF1dGhFcnJvckNvZGUuTE9HSU5fQkxPQ0tFRCAqLywge1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEZldGNoZXMgdGhlIHBhc3N3b3JkIHBvbGljeSBmb3IgdGhlIGN1cnJlbnRseSBzZXQgdGVuYW50IG9yIHRoZSBwcm9qZWN0IGlmIG5vIHRlbmFudCBpcyBzZXQuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIEF1dGggb2JqZWN0LlxyXG4gKiBAcGFyYW0gcmVxdWVzdCBQYXNzd29yZCBwb2xpY3kgcmVxdWVzdC5cclxuICogQHJldHVybnMgUGFzc3dvcmQgcG9saWN5IHJlc3BvbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gX2dldFBhc3N3b3JkUG9saWN5KGF1dGgsIHJlcXVlc3QgPSB7fSkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIkdFVFwiIC8qIEh0dHBNZXRob2QuR0VUICovLCBcIi92Mi9wYXNzd29yZFBvbGljeVwiIC8qIEVuZHBvaW50LkdFVF9QQVNTV09SRF9QT0xJQ1kgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLy8gTWluaW11bSBtaW4gcGFzc3dvcmQgbGVuZ3RoIGVuZm9yY2VkIGJ5IHRoZSBiYWNrZW5kLCBldmVuIGlmIG5vIG1pbmltdW0gbGVuZ3RoIGlzIHNldC5cclxuY29uc3QgTUlOSU1VTV9NSU5fUEFTU1dPUkRfTEVOR1RIID0gNjtcclxuLyoqXHJcbiAqIFN0b3JlcyBwYXNzd29yZCBwb2xpY3kgcmVxdWlyZW1lbnRzIGFuZCBwcm92aWRlcyBwYXNzd29yZCB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIHBvbGljeS5cclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jbGFzcyBQYXNzd29yZFBvbGljeUltcGwge1xyXG4gICAgY29uc3RydWN0b3IocmVzcG9uc2UpIHtcclxuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XHJcbiAgICAgICAgLy8gT25seSBpbmNsdWRlIGN1c3RvbSBzdHJlbmd0aCBvcHRpb25zIGRlZmluZWQgaW4gdGhlIHJlc3BvbnNlLlxyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlT3B0aW9ucyA9IHJlc3BvbnNlLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucztcclxuICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIC8vIFRPRE86IFJlbW92ZSBvbmNlIHRoZSBiYWNrZW5kIGlzIHVwZGF0ZWQgdG8gaW5jbHVkZSB0aGUgbWluaW11bSBtaW4gcGFzc3dvcmQgbGVuZ3RoIGluc3RlYWQgb2YgdW5kZWZpbmVkIHdoZW4gdGhlcmUgaXMgbm8gbWluaW11bSBsZW5ndGggc2V0LlxyXG4gICAgICAgIHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLm1pblBhc3N3b3JkTGVuZ3RoID1cclxuICAgICAgICAgICAgKF9hID0gcmVzcG9uc2VPcHRpb25zLm1pblBhc3N3b3JkTGVuZ3RoKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBNSU5JTVVNX01JTl9QQVNTV09SRF9MRU5HVEg7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlT3B0aW9ucy5tYXhQYXNzd29yZExlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5tYXhQYXNzd29yZExlbmd0aCA9XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZU9wdGlvbnMubWF4UGFzc3dvcmRMZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNwb25zZU9wdGlvbnMuY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc0xvd2VyY2FzZUxldHRlciA9XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZU9wdGlvbnMuY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNwb25zZU9wdGlvbnMuY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc1VwcGVyY2FzZUxldHRlciA9XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZU9wdGlvbnMuY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNwb25zZU9wdGlvbnMuY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMuY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyID1cclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlT3B0aW9ucy5jb250YWluc051bWVyaWNDaGFyYWN0ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNwb25zZU9wdGlvbnMuY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3RlciA9XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZU9wdGlvbnMuY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZW5mb3JjZW1lbnRTdGF0ZSA9IHJlc3BvbnNlLmVuZm9yY2VtZW50U3RhdGU7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5mb3JjZW1lbnRTdGF0ZSA9PT0gJ0VORk9SQ0VNRU5UX1NUQVRFX1VOU1BFQ0lGSUVEJykge1xyXG4gICAgICAgICAgICB0aGlzLmVuZm9yY2VtZW50U3RhdGUgPSAnT0ZGJztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVXNlIGFuIGVtcHR5IHN0cmluZyBpZiBubyBub24tYWxwaGFudW1lcmljIGNoYXJhY3RlcnMgYXJlIHNwZWNpZmllZCBpbiB0aGUgcmVzcG9uc2UuXHJcbiAgICAgICAgdGhpcy5hbGxvd2VkTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVycyA9XHJcbiAgICAgICAgICAgIChfYyA9IChfYiA9IHJlc3BvbnNlLmFsbG93ZWROb25BbHBoYW51bWVyaWNDaGFyYWN0ZXJzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuam9pbignJykpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6ICcnO1xyXG4gICAgICAgIHRoaXMuZm9yY2VVcGdyYWRlT25TaWduaW4gPSAoX2QgPSByZXNwb25zZS5mb3JjZVVwZ3JhZGVPblNpZ25pbikgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zY2hlbWFWZXJzaW9uID0gcmVzcG9uc2Uuc2NoZW1hVmVyc2lvbjtcclxuICAgIH1cclxuICAgIHZhbGlkYXRlUGFzc3dvcmQocGFzc3dvcmQpIHtcclxuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSB7XHJcbiAgICAgICAgICAgIGlzVmFsaWQ6IHRydWUsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkUG9saWN5OiB0aGlzXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyBDaGVjayB0aGUgcGFzc3dvcmQgbGVuZ3RoIGFuZCBjaGFyYWN0ZXIgb3B0aW9ucy5cclxuICAgICAgICB0aGlzLnZhbGlkYXRlUGFzc3dvcmRMZW5ndGhPcHRpb25zKHBhc3N3b3JkLCBzdGF0dXMpO1xyXG4gICAgICAgIHRoaXMudmFsaWRhdGVQYXNzd29yZENoYXJhY3Rlck9wdGlvbnMocGFzc3dvcmQsIHN0YXR1cyk7XHJcbiAgICAgICAgLy8gQ29tYmluZSB0aGUgc3RhdHVzIGludG8gc2luZ2xlIGlzVmFsaWQgcHJvcGVydHkuXHJcbiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9hID0gc3RhdHVzLm1lZXRzTWluUGFzc3dvcmRMZW5ndGgpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHRydWUpO1xyXG4gICAgICAgIHN0YXR1cy5pc1ZhbGlkICYmIChzdGF0dXMuaXNWYWxpZCA9IChfYiA9IHN0YXR1cy5tZWV0c01heFBhc3N3b3JkTGVuZ3RoKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiB0cnVlKTtcclxuICAgICAgICBzdGF0dXMuaXNWYWxpZCAmJiAoc3RhdHVzLmlzVmFsaWQgPSAoX2MgPSBzdGF0dXMuY29udGFpbnNMb3dlcmNhc2VMZXR0ZXIpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IHRydWUpO1xyXG4gICAgICAgIHN0YXR1cy5pc1ZhbGlkICYmIChzdGF0dXMuaXNWYWxpZCA9IChfZCA9IHN0YXR1cy5jb250YWluc1VwcGVyY2FzZUxldHRlcikgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogdHJ1ZSk7XHJcbiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9lID0gc3RhdHVzLmNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlcikgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogdHJ1ZSk7XHJcbiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9mID0gc3RhdHVzLmNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiB0cnVlKTtcclxuICAgICAgICByZXR1cm4gc3RhdHVzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBWYWxpZGF0ZXMgdGhhdCB0aGUgcGFzc3dvcmQgbWVldHMgdGhlIGxlbmd0aCBvcHRpb25zIGZvciB0aGUgcG9saWN5LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwYXNzd29yZCBQYXNzd29yZCB0byB2YWxpZGF0ZS5cclxuICAgICAqIEBwYXJhbSBzdGF0dXMgVmFsaWRhdGlvbiBzdGF0dXMuXHJcbiAgICAgKi9cclxuICAgIHZhbGlkYXRlUGFzc3dvcmRMZW5ndGhPcHRpb25zKHBhc3N3b3JkLCBzdGF0dXMpIHtcclxuICAgICAgICBjb25zdCBtaW5QYXNzd29yZExlbmd0aCA9IHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLm1pblBhc3N3b3JkTGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IG1heFBhc3N3b3JkTGVuZ3RoID0gdGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMubWF4UGFzc3dvcmRMZW5ndGg7XHJcbiAgICAgICAgaWYgKG1pblBhc3N3b3JkTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHN0YXR1cy5tZWV0c01pblBhc3N3b3JkTGVuZ3RoID0gcGFzc3dvcmQubGVuZ3RoID49IG1pblBhc3N3b3JkTGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWF4UGFzc3dvcmRMZW5ndGgpIHtcclxuICAgICAgICAgICAgc3RhdHVzLm1lZXRzTWF4UGFzc3dvcmRMZW5ndGggPSBwYXNzd29yZC5sZW5ndGggPD0gbWF4UGFzc3dvcmRMZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBWYWxpZGF0ZXMgdGhhdCB0aGUgcGFzc3dvcmQgbWVldHMgdGhlIGNoYXJhY3RlciBvcHRpb25zIGZvciB0aGUgcG9saWN5LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwYXNzd29yZCBQYXNzd29yZCB0byB2YWxpZGF0ZS5cclxuICAgICAqIEBwYXJhbSBzdGF0dXMgVmFsaWRhdGlvbiBzdGF0dXMuXHJcbiAgICAgKi9cclxuICAgIHZhbGlkYXRlUGFzc3dvcmRDaGFyYWN0ZXJPcHRpb25zKHBhc3N3b3JkLCBzdGF0dXMpIHtcclxuICAgICAgICAvLyBBc3NpZ24gc3RhdHVzZXMgZm9yIHJlcXVpcmVtZW50cyBldmVuIGlmIHRoZSBwYXNzd29yZCBpcyBhbiBlbXB0eSBzdHJpbmcuXHJcbiAgICAgICAgdGhpcy51cGRhdGVQYXNzd29yZENoYXJhY3Rlck9wdGlvbnNTdGF0dXNlcyhzdGF0dXMsIFxyXG4gICAgICAgIC8qIGNvbnRhaW5zTG93ZXJjYXNlQ2hhcmFjdGVyPSAqLyBmYWxzZSwgXHJcbiAgICAgICAgLyogY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXI9ICovIGZhbHNlLCBcclxuICAgICAgICAvKiBjb250YWluc051bWVyaWNDaGFyYWN0ZXI9ICovIGZhbHNlLCBcclxuICAgICAgICAvKiBjb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3Rlcj0gKi8gZmFsc2UpO1xyXG4gICAgICAgIGxldCBwYXNzd29yZENoYXI7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXNzd29yZC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBwYXNzd29yZENoYXIgPSBwYXNzd29yZC5jaGFyQXQoaSk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUGFzc3dvcmRDaGFyYWN0ZXJPcHRpb25zU3RhdHVzZXMoc3RhdHVzLCBcclxuICAgICAgICAgICAgLyogY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXI9ICovIHBhc3N3b3JkQ2hhciA+PSAnYScgJiZcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkQ2hhciA8PSAneicsIFxyXG4gICAgICAgICAgICAvKiBjb250YWluc1VwcGVyY2FzZUNoYXJhY3Rlcj0gKi8gcGFzc3dvcmRDaGFyID49ICdBJyAmJlxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRDaGFyIDw9ICdaJywgXHJcbiAgICAgICAgICAgIC8qIGNvbnRhaW5zTnVtZXJpY0NoYXJhY3Rlcj0gKi8gcGFzc3dvcmRDaGFyID49ICcwJyAmJlxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRDaGFyIDw9ICc5JywgXHJcbiAgICAgICAgICAgIC8qIGNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyPSAqLyB0aGlzLmFsbG93ZWROb25BbHBoYW51bWVyaWNDaGFyYWN0ZXJzLmluY2x1ZGVzKHBhc3N3b3JkQ2hhcikpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXBkYXRlcyB0aGUgcnVubmluZyB2YWxpZGF0aW9uIHN0YXR1cyB3aXRoIHRoZSBzdGF0dXNlcyBmb3IgdGhlIGNoYXJhY3RlciBvcHRpb25zLlxyXG4gICAgICogRXhwZWN0ZWQgdG8gYmUgY2FsbGVkIGVhY2ggdGltZSBhIGNoYXJhY3RlciBpcyBwcm9jZXNzZWQgdG8gdXBkYXRlIGVhY2ggb3B0aW9uIHN0YXR1c1xyXG4gICAgICogYmFzZWQgb24gdGhlIGN1cnJlbnQgY2hhcmFjdGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzdGF0dXMgVmFsaWRhdGlvbiBzdGF0dXMuXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXIgV2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgbG93ZXJjYXNlIGxldHRlci5cclxuICAgICAqIEBwYXJhbSBjb250YWluc1VwcGVyY2FzZUNoYXJhY3RlciBXaGV0aGVyIHRoZSBjaGFyYWN0ZXIgaXMgYW4gdXBwZXJjYXNlIGxldHRlci5cclxuICAgICAqIEBwYXJhbSBjb250YWluc051bWVyaWNDaGFyYWN0ZXIgV2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgbnVtZXJpYyBjaGFyYWN0ZXIuXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIgV2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgbm9uLWFscGhhbnVtZXJpYyBjaGFyYWN0ZXIuXHJcbiAgICAgKi9cclxuICAgIHVwZGF0ZVBhc3N3b3JkQ2hhcmFjdGVyT3B0aW9uc1N0YXR1c2VzKHN0YXR1cywgY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXIsIGNvbnRhaW5zVXBwZXJjYXNlQ2hhcmFjdGVyLCBjb250YWluc051bWVyaWNDaGFyYWN0ZXIsIGNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLmNvbnRhaW5zTG93ZXJjYXNlTGV0dGVyKSB7XHJcbiAgICAgICAgICAgIHN0YXR1cy5jb250YWluc0xvd2VyY2FzZUxldHRlciB8fCAoc3RhdHVzLmNvbnRhaW5zTG93ZXJjYXNlTGV0dGVyID0gY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMuY29udGFpbnNVcHBlcmNhc2VMZXR0ZXIpIHtcclxuICAgICAgICAgICAgc3RhdHVzLmNvbnRhaW5zVXBwZXJjYXNlTGV0dGVyIHx8IChzdGF0dXMuY29udGFpbnNVcHBlcmNhc2VMZXR0ZXIgPSBjb250YWluc1VwcGVyY2FzZUNoYXJhY3Rlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc051bWVyaWNDaGFyYWN0ZXIpIHtcclxuICAgICAgICAgICAgc3RhdHVzLmNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlciB8fCAoc3RhdHVzLmNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlciA9IGNvbnRhaW5zTnVtZXJpY0NoYXJhY3Rlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3Rlcikge1xyXG4gICAgICAgICAgICBzdGF0dXMuY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIgfHwgKHN0YXR1cy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3RlciA9IGNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgQXV0aEltcGwge1xyXG4gICAgY29uc3RydWN0b3IoYXBwLCBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIsIGFwcENoZWNrU2VydmljZVByb3ZpZGVyLCBjb25maWcpIHtcclxuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcclxuICAgICAgICB0aGlzLmhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlciA9IGhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlcjtcclxuICAgICAgICB0aGlzLmFwcENoZWNrU2VydmljZVByb3ZpZGVyID0gYXBwQ2hlY2tTZXJ2aWNlUHJvdmlkZXI7XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5lbXVsYXRvckNvbmZpZyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25zID0gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgdGhpcy5hdXRoU3RhdGVTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuaWRUb2tlblN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24odGhpcyk7XHJcbiAgICAgICAgdGhpcy5iZWZvcmVTdGF0ZVF1ZXVlID0gbmV3IEF1dGhNaWRkbGV3YXJlUXVldWUodGhpcyk7XHJcbiAgICAgICAgdGhpcy5yZWRpcmVjdFVzZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuRVhQRUNURURfUEFTU1dPUkRfUE9MSUNZX1NDSEVNQV9WRVJTSU9OID0gMTtcclxuICAgICAgICAvLyBBbnkgbmV0d29yayBjYWxscyB3aWxsIHNldCB0aGlzIHRvIHRydWUgYW5kIHByZXZlbnQgc3Vic2VxdWVudCBlbXVsYXRvclxyXG4gICAgICAgIC8vIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgdGhpcy5fY2FuSW5pdEVtdWxhdG9yID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl9pc0luaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fZGVsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9lcnJvckZhY3RvcnkgPSBfREVGQVVMVF9BVVRIX0VSUk9SX0ZBQ1RPUlk7XHJcbiAgICAgICAgdGhpcy5fYWdlbnRSZWNhcHRjaGFDb25maWcgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3MgPSB7fTtcclxuICAgICAgICB0aGlzLl9wcm9qZWN0UGFzc3dvcmRQb2xpY3kgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3RlbmFudFBhc3N3b3JkUG9saWNpZXMgPSB7fTtcclxuICAgICAgICAvLyBUcmFja3MgdGhlIGxhc3Qgbm90aWZpZWQgVUlEIGZvciBzdGF0ZSBjaGFuZ2UgbGlzdGVuZXJzIHRvIHByZXZlbnRcclxuICAgICAgICAvLyByZXBlYXRlZCBjYWxscyB0byB0aGUgY2FsbGJhY2tzLiBVbmRlZmluZWQgbWVhbnMgaXQncyBuZXZlciBiZWVuXHJcbiAgICAgICAgLy8gY2FsbGVkLCB3aGVyZWFzIG51bGwgbWVhbnMgaXQncyBiZWVuIGNhbGxlZCB3aXRoIGEgc2lnbmVkIG91dCB1c2VyXHJcbiAgICAgICAgdGhpcy5sYXN0Tm90aWZpZWRVaWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudGVuYW50SWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSB7IGFwcFZlcmlmaWNhdGlvbkRpc2FibGVkRm9yVGVzdGluZzogZmFsc2UgfTtcclxuICAgICAgICB0aGlzLmZyYW1ld29ya3MgPSBbXTtcclxuICAgICAgICB0aGlzLm5hbWUgPSBhcHAubmFtZTtcclxuICAgICAgICB0aGlzLmNsaWVudFZlcnNpb24gPSBjb25maWcuc2RrQ2xpZW50VmVyc2lvbjtcclxuICAgIH1cclxuICAgIF9pbml0aWFsaXplV2l0aFBlcnNpc3RlbmNlKHBlcnNpc3RlbmNlSGllcmFyY2h5LCBwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHtcclxuICAgICAgICBpZiAocG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlciA9IF9nZXRJbnN0YW5jZShwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBIYXZlIHRvIGNoZWNrIGZvciBhcHAgZGVsZXRpb24gdGhyb3VnaG91dCBpbml0aWFsaXphdGlvbiAoYWZ0ZXIgZWFjaFxyXG4gICAgICAgIC8vIHByb21pc2UgcmVzb2x1dGlvbilcclxuICAgICAgICB0aGlzLl9pbml0aWFsaXphdGlvblByb21pc2UgPSB0aGlzLnF1ZXVlKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnBlcnNpc3RlbmNlTWFuYWdlciA9IGF3YWl0IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIuY3JlYXRlKHRoaXMsIHBlcnNpc3RlbmNlSGllcmFyY2h5KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSByZXNvbHZlciBlYXJseSBpZiBuZWNlc3NhcnkgKG9ubHkgYXBwbGljYWJsZSB0byB3ZWI6XHJcbiAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBjYXVzZSB0aGUgaWZyYW1lIHRvIGxvYWQgaW1tZWRpYXRlbHkgaW4gY2VydGFpbiBjYXNlcylcclxuICAgICAgICAgICAgaWYgKChfYSA9IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLl9zaG91bGRJbml0UHJvYWN0aXZlbHkpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgZmFpbHMsIGRvbid0IGhhbHQgYXV0aCBsb2FkaW5nXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlci5faW5pdGlhbGl6ZSh0aGlzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLyogSWdub3JlIHRoZSBlcnJvciAqL1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZUN1cnJlbnRVc2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcik7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gKChfYiA9IHRoaXMuY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi51aWQpIHx8IG51bGw7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5faXNJbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSWYgdGhlIHBlcnNpc3RlbmNlIGlzIGNoYW5nZWQgaW4gYW5vdGhlciB3aW5kb3csIHRoZSB1c2VyIG1hbmFnZXIgd2lsbCBsZXQgdXMga25vd1xyXG4gICAgICovXHJcbiAgICBhc3luYyBfb25TdG9yYWdlRXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLmdldEN1cnJlbnRVc2VyKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRVc2VyICYmICF1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vIE5vIGNoYW5nZSwgZG8gbm90aGluZyAod2FzIHNpZ25lZCBvdXQgYW5kIHJlbWFpbmVkIHNpZ25lZCBvdXQpLlxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIElmIHRoZSBzYW1lIHVzZXIgaXMgdG8gYmUgc3luY2hyb25pemVkLlxyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyICYmIHVzZXIgJiYgdGhpcy5jdXJyZW50VXNlci51aWQgPT09IHVzZXIudWlkKSB7XHJcbiAgICAgICAgICAgIC8vIERhdGEgdXBkYXRlLCBzaW1wbHkgY29weSBkYXRhIGNoYW5nZXMuXHJcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRVc2VyLl9hc3NpZ24odXNlcik7XHJcbiAgICAgICAgICAgIC8vIElmIHRva2VucyBjaGFuZ2VkIGZyb20gcHJldmlvdXMgdXNlciB0b2tlbnMsIHRoaXMgd2lsbCB0cmlnZ2VyXHJcbiAgICAgICAgICAgIC8vIG5vdGlmeUF1dGhMaXN0ZW5lcnNfLlxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmN1cnJlbnRVc2VyLmdldElkVG9rZW4oKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBVcGRhdGUgY3VycmVudCBBdXRoIHN0YXRlLiBFaXRoZXIgYSBuZXcgbG9naW4gb3IgbG9nb3V0LlxyXG4gICAgICAgIC8vIFNraXAgYmxvY2tpbmcgY2FsbGJhY2tzLCB0aGV5IHNob3VsZCBub3QgYXBwbHkgdG8gYSBjaGFuZ2UgaW4gYW5vdGhlciB0YWIuXHJcbiAgICAgICAgYXdhaXQgdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIodXNlciwgLyogc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzICovIHRydWUpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgaW5pdGlhbGl6ZUN1cnJlbnRVc2VyRnJvbUlkVG9rZW4oaWRUb2tlbikge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0QWNjb3VudEluZm8odGhpcywgeyBpZFRva2VuIH0pO1xyXG4gICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlckltcGwuX2Zyb21HZXRBY2NvdW50SW5mb1Jlc3BvbnNlKHRoaXMsIHJlc3BvbnNlLCBpZFRva2VuKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRmlyZWJhc2VTZXJ2ZXJBcHAgY291bGQgbm90IGxvZ2luIHVzZXIgd2l0aCBwcm92aWRlZCBhdXRoSWRUb2tlbjogJywgZXJyKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIGluaXRpYWxpemVDdXJyZW50VXNlcihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKHRoaXMuYXBwKSkge1xyXG4gICAgICAgICAgICBjb25zdCBpZFRva2VuID0gdGhpcy5hcHAuc2V0dGluZ3MuYXV0aElkVG9rZW47XHJcbiAgICAgICAgICAgIGlmIChpZFRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTdGFydCB0aGUgYXV0aCBvcGVyYXRpb24gaW4gdGhlIG5leHQgdGljayB0byBhbGxvdyBhIG1vbWVudCBmb3IgdGhlIGN1c3RvbWVyJ3MgYXBwIHRvXHJcbiAgICAgICAgICAgICAgICAvLyBhdHRhY2ggYW4gZW11bGF0b3IsIGlmIGRlc2lyZWQuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmluaXRpYWxpemVDdXJyZW50VXNlckZyb21JZFRva2VuKGlkVG9rZW4pLnRoZW4ocmVzb2x2ZSwgcmVzb2x2ZSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEZpcnN0IGNoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcGVuZGluZyByZWRpcmVjdCBldmVudC5cclxuICAgICAgICBjb25zdCBwcmV2aW91c2x5U3RvcmVkVXNlciA9IChhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2UuZ2V0Q3VycmVudFVzZXIoKSk7XHJcbiAgICAgICAgbGV0IGZ1dHVyZUN1cnJlbnRVc2VyID0gcHJldmlvdXNseVN0b3JlZFVzZXI7XHJcbiAgICAgICAgbGV0IG5lZWRzVG9jaGVja01pZGRsZXdhcmUgPSBmYWxzZTtcclxuICAgICAgICBpZiAocG9wdXBSZWRpcmVjdFJlc29sdmVyICYmIHRoaXMuY29uZmlnLmF1dGhEb21haW4pIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRPckluaXRSZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlcigpO1xyXG4gICAgICAgICAgICBjb25zdCByZWRpcmVjdFVzZXJFdmVudElkID0gKF9hID0gdGhpcy5yZWRpcmVjdFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5fcmVkaXJlY3RFdmVudElkO1xyXG4gICAgICAgICAgICBjb25zdCBzdG9yZWRVc2VyRXZlbnRJZCA9IGZ1dHVyZUN1cnJlbnRVc2VyID09PSBudWxsIHx8IGZ1dHVyZUN1cnJlbnRVc2VyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmdXR1cmVDdXJyZW50VXNlci5fcmVkaXJlY3RFdmVudElkO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnRyeVJlZGlyZWN0U2lnbkluKHBvcHVwUmVkaXJlY3RSZXNvbHZlcik7XHJcbiAgICAgICAgICAgIC8vIElmIHRoZSBzdG9yZWQgdXNlciAoaS5lLiB0aGUgb2xkIFwiY3VycmVudFVzZXJcIikgaGFzIGEgcmVkaXJlY3RJZCB0aGF0XHJcbiAgICAgICAgICAgIC8vIG1hdGNoZXMgdGhlIHJlZGlyZWN0IHVzZXIsIHRoZW4gd2Ugd2FudCB0byBpbml0aWFsbHkgc2lnbiBpbiB3aXRoIHRoZVxyXG4gICAgICAgICAgICAvLyBuZXcgdXNlciBvYmplY3QgZnJvbSByZXN1bHQuXHJcbiAgICAgICAgICAgIC8vIFRPRE8oc2FtZ2hvKTogTW9yZSB0aG9yb3VnaGx5IHRlc3QgYWxsIG9mIHRoaXNcclxuICAgICAgICAgICAgaWYgKCghcmVkaXJlY3RVc2VyRXZlbnRJZCB8fCByZWRpcmVjdFVzZXJFdmVudElkID09PSBzdG9yZWRVc2VyRXZlbnRJZCkgJiZcclxuICAgICAgICAgICAgICAgIChyZXN1bHQgPT09IG51bGwgfHwgcmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXN1bHQudXNlcikpIHtcclxuICAgICAgICAgICAgICAgIGZ1dHVyZUN1cnJlbnRVc2VyID0gcmVzdWx0LnVzZXI7XHJcbiAgICAgICAgICAgICAgICBuZWVkc1RvY2hlY2tNaWRkbGV3YXJlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiBubyB1c2VyIGluIHBlcnNpc3RlbmNlLCB0aGVyZSBpcyBubyBjdXJyZW50IHVzZXIuIFNldCB0byBudWxsLlxyXG4gICAgICAgIGlmICghZnV0dXJlQ3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFmdXR1cmVDdXJyZW50VXNlci5fcmVkaXJlY3RFdmVudElkKSB7XHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXNuJ3QgYSByZWRpcmVjdCBsaW5rIG9wZXJhdGlvbiwgd2UgY2FuIHJlbG9hZCBhbmQgYmFpbC5cclxuICAgICAgICAgICAgLy8gRmlyc3QgdGhvdWdoLCBlbnN1cmUgdGhhdCB3ZSBjaGVjayB0aGUgbWlkZGxld2FyZSBpcyBoYXBweS5cclxuICAgICAgICAgICAgaWYgKG5lZWRzVG9jaGVja01pZGRsZXdhcmUpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5iZWZvcmVTdGF0ZVF1ZXVlLnJ1bk1pZGRsZXdhcmUoZnV0dXJlQ3VycmVudFVzZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBmdXR1cmVDdXJyZW50VXNlciA9IHByZXZpb3VzbHlTdG9yZWRVc2VyO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGtub3cgdGhpcyBpcyBhdmFpbGFibGUgc2luY2UgdGhlIGJpdCBpcyBvbmx5IHNldCB3aGVuIHRoZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc29sdmVyIGlzIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlci5fb3ZlcnJpZGVSZWRpcmVjdFJlc3VsdCh0aGlzLCAoKSA9PiBQcm9taXNlLnJlamVjdChlKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGZ1dHVyZUN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWxvYWRBbmRTZXRDdXJyZW50VXNlck9yQ2xlYXIoZnV0dXJlQ3VycmVudFVzZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBfYXNzZXJ0KHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlciwgdGhpcywgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIGF3YWl0IHRoaXMuZ2V0T3JJbml0UmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIoKTtcclxuICAgICAgICAvLyBJZiB0aGUgcmVkaXJlY3QgdXNlcidzIGV2ZW50IElEIG1hdGNoZXMgdGhlIGN1cnJlbnQgdXNlcidzIGV2ZW50IElELFxyXG4gICAgICAgIC8vIERPIE5PVCByZWxvYWQgdGhlIGN1cnJlbnQgdXNlciwgb3RoZXJ3aXNlIHRoZXknbGwgYmUgY2xlYXJlZCBmcm9tIHN0b3JhZ2UuXHJcbiAgICAgICAgLy8gVGhpcyBpcyBpbXBvcnRhbnQgZm9yIHRoZSByZWF1dGhlbnRpY2F0ZVdpdGhSZWRpcmVjdCgpIGZsb3cuXHJcbiAgICAgICAgaWYgKHRoaXMucmVkaXJlY3RVc2VyICYmXHJcbiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RVc2VyLl9yZWRpcmVjdEV2ZW50SWQgPT09IGZ1dHVyZUN1cnJlbnRVc2VyLl9yZWRpcmVjdEV2ZW50SWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihmdXR1cmVDdXJyZW50VXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnJlbG9hZEFuZFNldEN1cnJlbnRVc2VyT3JDbGVhcihmdXR1cmVDdXJyZW50VXNlcik7XHJcbiAgICB9XHJcbiAgICBhc3luYyB0cnlSZWRpcmVjdFNpZ25JbihyZWRpcmVjdFJlc29sdmVyKSB7XHJcbiAgICAgICAgLy8gVGhlIHJlZGlyZWN0IHVzZXIgbmVlZHMgdG8gYmUgY2hlY2tlZCAoYW5kIHNpZ25lZCBpbiBpZiBhdmFpbGFibGUpXHJcbiAgICAgICAgLy8gZHVyaW5nIGF1dGggaW5pdGlhbGl6YXRpb24uIEFsbCBvZiB0aGUgbm9ybWFsIHNpZ24gaW4gYW5kIGxpbmsvcmVhdXRoXHJcbiAgICAgICAgLy8gZmxvd3MgY2FsbCBiYWNrIGludG8gYXV0aCBhbmQgcHVzaCB0aGluZ3Mgb250byB0aGUgcHJvbWlzZSBxdWV1ZS4gV2VcclxuICAgICAgICAvLyBuZWVkIHRvIGF3YWl0IHRoZSByZXN1bHQgb2YgdGhlIHJlZGlyZWN0IHNpZ24gaW4gKmluc2lkZSB0aGUgcHJvbWlzZVxyXG4gICAgICAgIC8vIHF1ZXVlKi4gVGhpcyBwcmVzZW50cyBhIHByb2JsZW06IHdlIHJ1biBpbnRvIGRlYWRsb2NrLiBTZWU6XHJcbiAgICAgICAgLy8gICAg4pSMPiBbSW5pdGlhbGl6YXRpb25dIOKUgOKUgOKUgOKUgOKUgOKUkFxyXG4gICAgICAgIC8vICAgIOKUjD4gWzxvdGhlciBxdWV1ZSB0YXNrcz5dIOKUglxyXG4gICAgICAgIC8vICAgIOKUlOKUgCBbZ2V0UmVkaXJlY3RSZXN1bHRdIDzilIDilJhcclxuICAgICAgICAvLyAgICB3aGVyZSBbXSBhcmUgdGFza3Mgb24gdGhlIHF1ZXVlIGFuZCBhcnJvd3MgZGVub3RlIGF3YWl0c1xyXG4gICAgICAgIC8vIEluaXRpYWxpemF0aW9uIHdpbGwgbmV2ZXIgY29tcGxldGUgYmVjYXVzZSBpdCdzIHdhaXRpbmcgb24gc29tZXRoaW5nXHJcbiAgICAgICAgLy8gdGhhdCdzIHdhaXRpbmcgZm9yIGluaXRpYWxpemF0aW9uIHRvIGNvbXBsZXRlIVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gSW5zdGVhZCwgdGhpcyBtZXRob2QgY2FsbHMgZ2V0UmVkaXJlY3RSZXN1bHQoKSAoc3RvcmVkIGluXHJcbiAgICAgICAgLy8gX2NvbXBsZXRlUmVkaXJlY3RGbikgd2l0aCBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgdGhhdCBpbnN0cnVjdHMgYWxsIG9mXHJcbiAgICAgICAgLy8gdGhlIHVuZGVybHlpbmcgYXV0aCBvcGVyYXRpb25zIHRvIHNraXAgYW55dGhpbmcgdGhhdCBtdXRhdGVzIGF1dGggc3RhdGUuXHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IG51bGw7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gV2Uga25vdyB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIgaXMgc2V0IHNpbmNlIHJlZGlyZWN0UmVzb2x2ZXJcclxuICAgICAgICAgICAgLy8gaXMgcGFzc2VkIGluLiBUaGUgX2NvbXBsZXRlUmVkaXJlY3RGbiBleHBlY3RzIHRoZSB1bndyYXBwZWQgZXh0ZXJuLlxyXG4gICAgICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIuX2NvbXBsZXRlUmVkaXJlY3RGbih0aGlzLCByZWRpcmVjdFJlc29sdmVyLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gU3dhbGxvdyBhbnkgZXJyb3JzIGhlcmU7IHRoZSBjb2RlIGNhbiByZXRyaWV2ZSB0aGVtIGluXHJcbiAgICAgICAgICAgIC8vIGdldFJlZGlyZWN0UmVzdWx0KCkuXHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3NldFJlZGlyZWN0VXNlcihudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIGFzeW5jIHJlbG9hZEFuZFNldEN1cnJlbnRVc2VyT3JDbGVhcih1c2VyKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGlmICgoZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLmNvZGUpICE9PVxyXG4gICAgICAgICAgICAgICAgYGF1dGgvJHtcIm5ldHdvcmstcmVxdWVzdC1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi99YCkge1xyXG4gICAgICAgICAgICAgICAgLy8gU29tZXRoaW5nJ3Mgd3Jvbmcgd2l0aCB0aGUgdXNlcidzIHRva2VuLiBMb2cgdGhlbSBvdXQgYW5kIHJlbW92ZVxyXG4gICAgICAgICAgICAgICAgLy8gdGhlbSBmcm9tIHN0b3JhZ2VcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGx5U2V0Q3VycmVudFVzZXIobnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKTtcclxuICAgIH1cclxuICAgIHVzZURldmljZUxhbmd1YWdlKCkge1xyXG4gICAgICAgIHRoaXMubGFuZ3VhZ2VDb2RlID0gX2dldFVzZXJMYW5ndWFnZSgpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX2RlbGV0ZSgpIHtcclxuICAgICAgICB0aGlzLl9kZWxldGVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIGFzeW5jIHVwZGF0ZUN1cnJlbnRVc2VyKHVzZXJFeHRlcm4pIHtcclxuICAgICAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAodGhpcy5hcHApKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvcih0aGlzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFRoZSBwdWJsaWMgdXBkYXRlQ3VycmVudFVzZXIgbWV0aG9kIG5lZWRzIHRvIG1ha2UgYSBjb3B5IG9mIHRoZSB1c2VyLFxyXG4gICAgICAgIC8vIGFuZCBhbHNvIGNoZWNrIHRoYXQgdGhlIHByb2plY3QgbWF0Y2hlc1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSB1c2VyRXh0ZXJuXHJcbiAgICAgICAgICAgID8gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXJFeHRlcm4pXHJcbiAgICAgICAgICAgIDogbnVsbDtcclxuICAgICAgICBpZiAodXNlcikge1xyXG4gICAgICAgICAgICBfYXNzZXJ0KHVzZXIuYXV0aC5jb25maWcuYXBpS2V5ID09PSB0aGlzLmNvbmZpZy5hcGlLZXksIHRoaXMsIFwiaW52YWxpZC11c2VyLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FVVEggKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIodXNlciAmJiB1c2VyLl9jbG9uZSh0aGlzKSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfdXBkYXRlQ3VycmVudFVzZXIodXNlciwgc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1c2VyKSB7XHJcbiAgICAgICAgICAgIF9hc3NlcnQodGhpcy50ZW5hbnRJZCA9PT0gdXNlci50ZW5hbnRJZCwgdGhpcywgXCJ0ZW5hbnQtaWQtbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlRFTkFOVF9JRF9NSVNNQVRDSCAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKHVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKTtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlBdXRoTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBzaWduT3V0KCkge1xyXG4gICAgICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcCh0aGlzLmFwcCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUnVuIGZpcnN0LCB0byBibG9jayBfc2V0UmVkaXJlY3RVc2VyKCkgaWYgYW55IGNhbGxiYWNrcyBmYWlsLlxyXG4gICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKG51bGwpO1xyXG4gICAgICAgIC8vIENsZWFyIHRoZSByZWRpcmVjdCB1c2VyIHdoZW4gc2lnbk91dCBpcyBjYWxsZWRcclxuICAgICAgICBpZiAodGhpcy5yZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlciB8fCB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5fc2V0UmVkaXJlY3RVc2VyKG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBQcmV2ZW50IGNhbGxiYWNrcyBmcm9tIGJlaW5nIGNhbGxlZCBhZ2FpbiBpbiBfdXBkYXRlQ3VycmVudFVzZXIsIGFzXHJcbiAgICAgICAgLy8gdGhleSB3ZXJlIGFscmVhZHkgY2FsbGVkIGluIHRoZSBmaXJzdCBsaW5lLlxyXG4gICAgICAgIHJldHVybiB0aGlzLl91cGRhdGVDdXJyZW50VXNlcihudWxsLCAvKiBza2lwQmVmb3JlU3RhdGVDYWxsYmFja3MgKi8gdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBzZXRQZXJzaXN0ZW5jZShwZXJzaXN0ZW5jZSkge1xyXG4gICAgICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcCh0aGlzLmFwcCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2Uuc2V0UGVyc2lzdGVuY2UoX2dldEluc3RhbmNlKHBlcnNpc3RlbmNlKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBfZ2V0UmVjYXB0Y2hhQ29uZmlnKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRlbmFudElkID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FnZW50UmVjYXB0Y2hhQ29uZmlnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3NbdGhpcy50ZW5hbnRJZF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXN5bmMgdmFsaWRhdGVQYXNzd29yZChwYXNzd29yZCkge1xyXG4gICAgICAgIGlmICghdGhpcy5fZ2V0UGFzc3dvcmRQb2xpY3lJbnRlcm5hbCgpKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3VwZGF0ZVBhc3N3b3JkUG9saWN5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFBhc3N3b3JkIHBvbGljeSB3aWxsIGJlIGRlZmluZWQgYWZ0ZXIgZmV0Y2hpbmcuXHJcbiAgICAgICAgY29uc3QgcGFzc3dvcmRQb2xpY3kgPSB0aGlzLl9nZXRQYXNzd29yZFBvbGljeUludGVybmFsKCk7XHJcbiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgcG9saWN5IHNjaGVtYSB2ZXJzaW9uIGlzIHN1cHBvcnRlZCBieSB0aGUgU0RLLlxyXG4gICAgICAgIC8vIFRPRE86IFVwZGF0ZSB0aGlzIGxvZ2ljIHRvIHVzZSBhIG1heCBzdXBwb3J0ZWQgcG9saWN5IHNjaGVtYSB2ZXJzaW9uIG9uY2Ugd2UgaGF2ZSBtdWx0aXBsZSBzY2hlbWEgdmVyc2lvbnMuXHJcbiAgICAgICAgaWYgKHBhc3N3b3JkUG9saWN5LnNjaGVtYVZlcnNpb24gIT09XHJcbiAgICAgICAgICAgIHRoaXMuRVhQRUNURURfUEFTU1dPUkRfUE9MSUNZX1NDSEVNQV9WRVJTSU9OKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCh0aGlzLl9lcnJvckZhY3RvcnkuY3JlYXRlKFwidW5zdXBwb3J0ZWQtcGFzc3dvcmQtcG9saWN5LXNjaGVtYS12ZXJzaW9uXCIgLyogQXV0aEVycm9yQ29kZS5VTlNVUFBPUlRFRF9QQVNTV09SRF9QT0xJQ1lfU0NIRU1BX1ZFUlNJT04gKi8sIHt9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXNzd29yZFBvbGljeS52YWxpZGF0ZVBhc3N3b3JkKHBhc3N3b3JkKTtcclxuICAgIH1cclxuICAgIF9nZXRQYXNzd29yZFBvbGljeUludGVybmFsKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRlbmFudElkID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9qZWN0UGFzc3dvcmRQb2xpY3k7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVuYW50UGFzc3dvcmRQb2xpY2llc1t0aGlzLnRlbmFudElkXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBfdXBkYXRlUGFzc3dvcmRQb2xpY3koKSB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfZ2V0UGFzc3dvcmRQb2xpY3kodGhpcyk7XHJcbiAgICAgICAgY29uc3QgcGFzc3dvcmRQb2xpY3kgPSBuZXcgUGFzc3dvcmRQb2xpY3lJbXBsKHJlc3BvbnNlKTtcclxuICAgICAgICBpZiAodGhpcy50ZW5hbnRJZCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9qZWN0UGFzc3dvcmRQb2xpY3kgPSBwYXNzd29yZFBvbGljeTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3RlbmFudFBhc3N3b3JkUG9saWNpZXNbdGhpcy50ZW5hbnRJZF0gPSBwYXNzd29yZFBvbGljeTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBfZ2V0UGVyc2lzdGVuY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5wZXJzaXN0ZW5jZS50eXBlO1xyXG4gICAgfVxyXG4gICAgX3VwZGF0ZUVycm9yTWFwKGVycm9yTWFwKSB7XHJcbiAgICAgICAgdGhpcy5fZXJyb3JGYWN0b3J5ID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIGVycm9yTWFwKCkpO1xyXG4gICAgfVxyXG4gICAgb25BdXRoU3RhdGVDaGFuZ2VkKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJTdGF0ZUxpc3RlbmVyKHRoaXMuYXV0aFN0YXRlU3Vic2NyaXB0aW9uLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7XHJcbiAgICB9XHJcbiAgICBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKGNhbGxiYWNrLCBvbkFib3J0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5wdXNoQ2FsbGJhY2soY2FsbGJhY2ssIG9uQWJvcnQpO1xyXG4gICAgfVxyXG4gICAgb25JZFRva2VuQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyU3RhdGVMaXN0ZW5lcih0aGlzLmlkVG9rZW5TdWJzY3JpcHRpb24sIG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKTtcclxuICAgIH1cclxuICAgIGF1dGhTdGF0ZVJlYWR5KCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IHRoaXMub25BdXRoU3RhdGVDaGFuZ2VkKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB1bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV2b2tlcyB0aGUgZ2l2ZW4gYWNjZXNzIHRva2VuLiBDdXJyZW50bHkgb25seSBzdXBwb3J0cyBBcHBsZSBPQXV0aCBhY2Nlc3MgdG9rZW5zLlxyXG4gICAgICovXHJcbiAgICBhc3luYyByZXZva2VBY2Nlc3NUb2tlbih0b2tlbikge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLmN1cnJlbnRVc2VyLmdldElkVG9rZW4oKTtcclxuICAgICAgICAgICAgLy8gR2VuZXJhbGl6ZSB0aGlzIHRvIGFjY2VwdCBvdGhlciBwcm92aWRlcnMgb25jZSBzdXBwb3J0ZWQuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICBwcm92aWRlcklkOiAnYXBwbGUuY29tJyxcclxuICAgICAgICAgICAgICAgIHRva2VuVHlwZTogXCJBQ0NFU1NfVE9LRU5cIiAvKiBUb2tlblR5cGUuQUNDRVNTX1RPS0VOICovLFxyXG4gICAgICAgICAgICAgICAgdG9rZW4sXHJcbiAgICAgICAgICAgICAgICBpZFRva2VuXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRlbmFudElkICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJlcXVlc3QudGVuYW50SWQgPSB0aGlzLnRlbmFudElkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGF3YWl0IHJldm9rZVRva2VuKHRoaXMsIHJlcXVlc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYXBpS2V5OiB0aGlzLmNvbmZpZy5hcGlLZXksXHJcbiAgICAgICAgICAgIGF1dGhEb21haW46IHRoaXMuY29uZmlnLmF1dGhEb21haW4sXHJcbiAgICAgICAgICAgIGFwcE5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgICAgICAgY3VycmVudFVzZXI6IChfYSA9IHRoaXMuX2N1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9KU09OKClcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3NldFJlZGlyZWN0VXNlcih1c2VyLCBwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHtcclxuICAgICAgICBjb25zdCByZWRpcmVjdE1hbmFnZXIgPSBhd2FpdCB0aGlzLmdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcik7XHJcbiAgICAgICAgcmV0dXJuIHVzZXIgPT09IG51bGxcclxuICAgICAgICAgICAgPyByZWRpcmVjdE1hbmFnZXIucmVtb3ZlQ3VycmVudFVzZXIoKVxyXG4gICAgICAgICAgICA6IHJlZGlyZWN0TWFuYWdlci5zZXRDdXJyZW50VXNlcih1c2VyKTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcikge1xyXG4gICAgICAgIGlmICghdGhpcy5yZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlcikge1xyXG4gICAgICAgICAgICBjb25zdCByZXNvbHZlciA9IChwb3B1cFJlZGlyZWN0UmVzb2x2ZXIgJiYgX2dldEluc3RhbmNlKHBvcHVwUmVkaXJlY3RSZXNvbHZlcikpIHx8XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXI7XHJcbiAgICAgICAgICAgIF9hc3NlcnQocmVzb2x2ZXIsIHRoaXMsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICAgICAgdGhpcy5yZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlciA9IGF3YWl0IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIuY3JlYXRlKHRoaXMsIFtfZ2V0SW5zdGFuY2UocmVzb2x2ZXIuX3JlZGlyZWN0UGVyc2lzdGVuY2UpXSwgXCJyZWRpcmVjdFVzZXJcIiAvKiBLZXlOYW1lLlJFRElSRUNUX1VTRVIgKi8pO1xyXG4gICAgICAgICAgICB0aGlzLnJlZGlyZWN0VXNlciA9XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyLmdldEN1cnJlbnRVc2VyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3JlZGlyZWN0VXNlckZvcklkKGlkKSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICAvLyBNYWtlIHN1cmUgd2UndmUgY2xlYXJlZCBhbnkgcGVuZGluZyBwZXJzaXN0ZW5jZSBhY3Rpb25zIGlmIHdlJ3JlIG5vdCBpblxyXG4gICAgICAgIC8vIHRoZSBpbml0aWFsaXplclxyXG4gICAgICAgIGlmICh0aGlzLl9pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucXVldWUoYXN5bmMgKCkgPT4geyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCgoX2EgPSB0aGlzLl9jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLl9yZWRpcmVjdEV2ZW50SWQpID09PSBpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFVzZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgoKF9iID0gdGhpcy5yZWRpcmVjdFVzZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5fcmVkaXJlY3RFdmVudElkKSA9PT0gaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RVc2VyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGFzeW5jIF9wZXJzaXN0VXNlcklmQ3VycmVudCh1c2VyKSB7XHJcbiAgICAgICAgaWYgKHVzZXIgPT09IHRoaXMuY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYXN5bmMgKCkgPT4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKiogTm90aWZpZXMgbGlzdGVuZXJzIG9ubHkgaWYgdGhlIHVzZXIgaXMgY3VycmVudCAqL1xyXG4gICAgX25vdGlmeUxpc3RlbmVyc0lmQ3VycmVudCh1c2VyKSB7XHJcbiAgICAgICAgaWYgKHVzZXIgPT09IHRoaXMuY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlBdXRoTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX2tleSgpIHtcclxuICAgICAgICByZXR1cm4gYCR7dGhpcy5jb25maWcuYXV0aERvbWFpbn06JHt0aGlzLmNvbmZpZy5hcGlLZXl9OiR7dGhpcy5uYW1lfWA7XHJcbiAgICB9XHJcbiAgICBfc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCkge1xyXG4gICAgICAgIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudFVzZXIuX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIF9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpIHtcclxuICAgICAgICB0aGlzLmlzUHJvYWN0aXZlUmVmcmVzaEVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fc3RvcFByb2FjdGl2ZVJlZnJlc2goKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKiogUmV0dXJucyB0aGUgY3VycmVudCB1c2VyIGNhc3QgYXMgdGhlIGludGVybmFsIHR5cGUgKi9cclxuICAgIGdldCBfY3VycmVudFVzZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFVzZXI7XHJcbiAgICB9XHJcbiAgICBub3RpZnlBdXRoTGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHZhciBfYSwgX2I7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pZFRva2VuU3Vic2NyaXB0aW9uLm5leHQodGhpcy5jdXJyZW50VXNlcik7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFVpZCA9IChfYiA9IChfYSA9IHRoaXMuY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMubGFzdE5vdGlmaWVkVWlkICE9PSBjdXJyZW50VWlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gY3VycmVudFVpZDtcclxuICAgICAgICAgICAgdGhpcy5hdXRoU3RhdGVTdWJzY3JpcHRpb24ubmV4dCh0aGlzLmN1cnJlbnRVc2VyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZWdpc3RlclN0YXRlTGlzdGVuZXIoc3Vic2NyaXB0aW9uLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoKSA9PiB7IH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNiID0gdHlwZW9mIG5leHRPck9ic2VydmVyID09PSAnZnVuY3Rpb24nXHJcbiAgICAgICAgICAgID8gbmV4dE9yT2JzZXJ2ZXJcclxuICAgICAgICAgICAgOiBuZXh0T3JPYnNlcnZlci5uZXh0LmJpbmQobmV4dE9yT2JzZXJ2ZXIpO1xyXG4gICAgICAgIGxldCBpc1Vuc3Vic2NyaWJlZCA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLl9pc0luaXRpYWxpemVkXHJcbiAgICAgICAgICAgID8gUHJvbWlzZS5yZXNvbHZlKClcclxuICAgICAgICAgICAgOiB0aGlzLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICAgICAgX2Fzc2VydChwcm9taXNlLCB0aGlzLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgLy8gVGhlIGNhbGxiYWNrIG5lZWRzIHRvIGJlIGNhbGxlZCBhc3luY2hyb25vdXNseSBwZXIgdGhlIHNwZWMuXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xyXG4gICAgICAgIHByb21pc2UudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpc1Vuc3Vic2NyaWJlZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNiKHRoaXMuY3VycmVudFVzZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICh0eXBlb2YgbmV4dE9yT2JzZXJ2ZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSBzdWJzY3JpcHRpb24uYWRkT2JzZXJ2ZXIobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaXNVbnN1YnNjcmliZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gc3Vic2NyaXB0aW9uLmFkZE9ic2VydmVyKG5leHRPck9ic2VydmVyKTtcclxuICAgICAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlzVW5zdWJzY3JpYmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVbnByb3RlY3RlZCAoZnJvbSByYWNlIGNvbmRpdGlvbnMpIG1ldGhvZCB0byBzZXQgdGhlIGN1cnJlbnQgdXNlci4gVGhpc1xyXG4gICAgICogc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gd2l0aGluIGEgcXVldWVkIGNhbGxiYWNrLiBUaGlzIGlzIG5lY2Vzc2FyeVxyXG4gICAgICogYmVjYXVzZSB0aGUgcXVldWUgc2hvdWxkbid0IHJlbHkgb24gYW5vdGhlciBxdWV1ZWQgY2FsbGJhY2suXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGRpcmVjdGx5U2V0Q3VycmVudFVzZXIodXNlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyICYmIHRoaXMuY3VycmVudFVzZXIgIT09IHVzZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudFVzZXIuX3N0b3BQcm9hY3RpdmVSZWZyZXNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1c2VyICYmIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCkge1xyXG4gICAgICAgICAgICB1c2VyLl9zdGFydFByb2FjdGl2ZVJlZnJlc2goKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXI7XHJcbiAgICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnNldEN1cnJlbnRVc2VyKHVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnJlbW92ZUN1cnJlbnRVc2VyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcXVldWUoYWN0aW9uKSB7XHJcbiAgICAgICAgLy8gSW4gY2FzZSBzb21ldGhpbmcgZXJyb3JzLCB0aGUgY2FsbGJhY2sgc3RpbGwgc2hvdWxkIGJlIGNhbGxlZCBpbiBvcmRlclxyXG4gICAgICAgIC8vIHRvIGtlZXAgdGhlIHByb21pc2UgY2hhaW4gYWxpdmVcclxuICAgICAgICB0aGlzLm9wZXJhdGlvbnMgPSB0aGlzLm9wZXJhdGlvbnMudGhlbihhY3Rpb24sIGFjdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlcmF0aW9ucztcclxuICAgIH1cclxuICAgIGdldCBhc3NlcnRlZFBlcnNpc3RlbmNlKCkge1xyXG4gICAgICAgIF9hc3NlcnQodGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXIsIHRoaXMsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXI7XHJcbiAgICB9XHJcbiAgICBfbG9nRnJhbWV3b3JrKGZyYW1ld29yaykge1xyXG4gICAgICAgIGlmICghZnJhbWV3b3JrIHx8IHRoaXMuZnJhbWV3b3Jrcy5pbmNsdWRlcyhmcmFtZXdvcmspKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mcmFtZXdvcmtzLnB1c2goZnJhbWV3b3JrKTtcclxuICAgICAgICAvLyBTb3J0IGFscGhhYmV0aWNhbGx5IHNvIHRoYXQgXCJGaXJlYmFzZUNvcmUtd2ViLEZpcmViYXNlVUktd2ViXCIgYW5kXHJcbiAgICAgICAgLy8gXCJGaXJlYmFzZVVJLXdlYixGaXJlYmFzZUNvcmUtd2ViXCIgYXJlbid0IHZpZXdlZCBhcyBkaWZmZXJlbnQuXHJcbiAgICAgICAgdGhpcy5mcmFtZXdvcmtzLnNvcnQoKTtcclxuICAgICAgICB0aGlzLmNsaWVudFZlcnNpb24gPSBfZ2V0Q2xpZW50VmVyc2lvbih0aGlzLmNvbmZpZy5jbGllbnRQbGF0Zm9ybSwgdGhpcy5fZ2V0RnJhbWV3b3JrcygpKTtcclxuICAgIH1cclxuICAgIF9nZXRGcmFtZXdvcmtzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZyYW1ld29ya3M7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfZ2V0QWRkaXRpb25hbEhlYWRlcnMoKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIC8vIEFkZGl0aW9uYWwgaGVhZGVycyBvbiBldmVyeSByZXF1ZXN0XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IHtcclxuICAgICAgICAgICAgW1wiWC1DbGllbnQtVmVyc2lvblwiIC8qIEh0dHBIZWFkZXIuWF9DTElFTlRfVkVSU0lPTiAqL106IHRoaXMuY2xpZW50VmVyc2lvblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMuYXBwLm9wdGlvbnMuYXBwSWQpIHtcclxuICAgICAgICAgICAgaGVhZGVyc1tcIlgtRmlyZWJhc2UtZ21waWRcIiAvKiBIdHRwSGVhZGVyLlhfRklSRUJBU0VfR01QSUQgKi9dID0gdGhpcy5hcHAub3B0aW9ucy5hcHBJZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgdGhlIGhlYXJ0YmVhdCBzZXJ2aWNlIGV4aXN0cywgYWRkIHRoZSBoZWFydGJlYXQgc3RyaW5nXHJcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0c0hlYWRlciA9IGF3YWl0ICgoX2EgPSB0aGlzLmhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlclxyXG4gICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKHtcclxuICAgICAgICAgICAgb3B0aW9uYWw6IHRydWVcclxuICAgICAgICB9KSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldEhlYXJ0YmVhdHNIZWFkZXIoKSk7XHJcbiAgICAgICAgaWYgKGhlYXJ0YmVhdHNIZWFkZXIpIHtcclxuICAgICAgICAgICAgaGVhZGVyc1tcIlgtRmlyZWJhc2UtQ2xpZW50XCIgLyogSHR0cEhlYWRlci5YX0ZJUkVCQVNFX0NMSUVOVCAqL10gPSBoZWFydGJlYXRzSGVhZGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiB0aGUgQXBwIENoZWNrIHNlcnZpY2UgZXhpc3RzLCBhZGQgdGhlIEFwcCBDaGVjayB0b2tlbiBpbiB0aGUgaGVhZGVyc1xyXG4gICAgICAgIGNvbnN0IGFwcENoZWNrVG9rZW4gPSBhd2FpdCB0aGlzLl9nZXRBcHBDaGVja1Rva2VuKCk7XHJcbiAgICAgICAgaWYgKGFwcENoZWNrVG9rZW4pIHtcclxuICAgICAgICAgICAgaGVhZGVyc1tcIlgtRmlyZWJhc2UtQXBwQ2hlY2tcIiAvKiBIdHRwSGVhZGVyLlhfRklSRUJBU0VfQVBQX0NIRUNLICovXSA9IGFwcENoZWNrVG9rZW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoZWFkZXJzO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX2dldEFwcENoZWNrVG9rZW4oKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIGNvbnN0IGFwcENoZWNrVG9rZW5SZXN1bHQgPSBhd2FpdCAoKF9hID0gdGhpcy5hcHBDaGVja1NlcnZpY2VQcm92aWRlclxyXG4gICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRUb2tlbigpKTtcclxuICAgICAgICBpZiAoYXBwQ2hlY2tUb2tlblJlc3VsdCA9PT0gbnVsbCB8fCBhcHBDaGVja1Rva2VuUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBDaGVja1Rva2VuUmVzdWx0LmVycm9yKSB7XHJcbiAgICAgICAgICAgIC8vIENvbnRleHQ6IGFwcENoZWNrLmdldFRva2VuKCkgd2lsbCBuZXZlciB0aHJvdyBldmVuIGlmIGFuIGVycm9yIGhhcHBlbmVkLlxyXG4gICAgICAgICAgICAvLyBJbiB0aGUgZXJyb3IgY2FzZSwgYSBkdW1teSB0b2tlbiB3aWxsIGJlIHJldHVybmVkIGFsb25nIHdpdGggYW4gZXJyb3IgZmllbGQgZGVzY3JpYmluZ1xyXG4gICAgICAgICAgICAvLyB0aGUgZXJyb3IuIEluIGdlbmVyYWwsIHdlIHNob3VsZG4ndCBjYXJlIGFib3V0IHRoZSBlcnJvciBjb25kaXRpb24gYW5kIGp1c3QgdXNlXHJcbiAgICAgICAgICAgIC8vIHRoZSB0b2tlbiAoYWN0dWFsIG9yIGR1bW15KSB0byBzZW5kIHJlcXVlc3RzLlxyXG4gICAgICAgICAgICBfbG9nV2FybihgRXJyb3Igd2hpbGUgcmV0cmlldmluZyBBcHAgQ2hlY2sgdG9rZW46ICR7YXBwQ2hlY2tUb2tlblJlc3VsdC5lcnJvcn1gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFwcENoZWNrVG9rZW5SZXN1bHQgPT09IG51bGwgfHwgYXBwQ2hlY2tUb2tlblJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwQ2hlY2tUb2tlblJlc3VsdC50b2tlbjtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogTWV0aG9kIHRvIGJlIHVzZWQgdG8gY2FzdCBkb3duIHRvIG91ciBwcml2YXRlIGltcGxlbWVudGF0aW9uIG9mIEF1dGguXHJcbiAqIEl0IHdpbGwgYWxzbyBoYW5kbGUgdW53cmFwcGluZyBmcm9tIHRoZSBjb21wYXQgdHlwZSBpZiBuZWNlc3NhcnlcclxuICpcclxuICogQHBhcmFtIGF1dGggQXV0aCBvYmplY3QgcGFzc2VkIGluIGZyb20gZGV2ZWxvcGVyXHJcbiAqL1xyXG5mdW5jdGlvbiBfY2FzdEF1dGgoYXV0aCkge1xyXG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKTtcclxufVxyXG4vKiogSGVscGVyIGNsYXNzIHRvIHdyYXAgc3Vic2NyaWJlciBsb2dpYyAqL1xyXG5jbGFzcyBTdWJzY3JpcHRpb24ge1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCkge1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hZGRPYnNlcnZlciA9IGNyZWF0ZVN1YnNjcmliZShvYnNlcnZlciA9PiAodGhpcy5vYnNlcnZlciA9IG9ic2VydmVyKSk7XHJcbiAgICB9XHJcbiAgICBnZXQgbmV4dCgpIHtcclxuICAgICAgICBfYXNzZXJ0KHRoaXMub2JzZXJ2ZXIsIHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9ic2VydmVyLm5leHQuYmluZCh0aGlzLm9ic2VydmVyKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5sZXQgZXh0ZXJuYWxKU1Byb3ZpZGVyID0ge1xyXG4gICAgYXN5bmMgbG9hZEpTKCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGxvYWQgZXh0ZXJuYWwgc2NyaXB0cycpO1xyXG4gICAgfSxcclxuICAgIHJlY2FwdGNoYVYyU2NyaXB0OiAnJyxcclxuICAgIHJlY2FwdGNoYUVudGVycHJpc2VTY3JpcHQ6ICcnLFxyXG4gICAgZ2FwaVNjcmlwdDogJydcclxufTtcclxuZnVuY3Rpb24gX3NldEV4dGVybmFsSlNQcm92aWRlcihwKSB7XHJcbiAgICBleHRlcm5hbEpTUHJvdmlkZXIgPSBwO1xyXG59XHJcbmZ1bmN0aW9uIF9sb2FkSlModXJsKSB7XHJcbiAgICByZXR1cm4gZXh0ZXJuYWxKU1Byb3ZpZGVyLmxvYWRKUyh1cmwpO1xyXG59XHJcbmZ1bmN0aW9uIF9yZWNhcHRjaGFWMlNjcmlwdFVybCgpIHtcclxuICAgIHJldHVybiBleHRlcm5hbEpTUHJvdmlkZXIucmVjYXB0Y2hhVjJTY3JpcHQ7XHJcbn1cclxuZnVuY3Rpb24gX3JlY2FwdGNoYUVudGVycHJpc2VTY3JpcHRVcmwoKSB7XHJcbiAgICByZXR1cm4gZXh0ZXJuYWxKU1Byb3ZpZGVyLnJlY2FwdGNoYUVudGVycHJpc2VTY3JpcHQ7XHJcbn1cclxuZnVuY3Rpb24gX2dhcGlTY3JpcHRVcmwoKSB7XHJcbiAgICByZXR1cm4gZXh0ZXJuYWxKU1Byb3ZpZGVyLmdhcGlTY3JpcHQ7XHJcbn1cclxuZnVuY3Rpb24gX2dlbmVyYXRlQ2FsbGJhY2tOYW1lKHByZWZpeCkge1xyXG4gICAgcmV0dXJuIGBfXyR7cHJlZml4fSR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCl9YDtcclxufVxuXG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzICovXHJcbmNvbnN0IFJFQ0FQVENIQV9FTlRFUlBSSVNFX1ZFUklGSUVSX1RZUEUgPSAncmVjYXB0Y2hhLWVudGVycHJpc2UnO1xyXG5jb25zdCBGQUtFX1RPS0VOID0gJ05PX1JFQ0FQVENIQSc7XHJcbmNsYXNzIFJlY2FwdGNoYUVudGVycHJpc2VWZXJpZmllciB7XHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYXV0aEV4dGVybiAtIFRoZSBjb3JyZXNwb25kaW5nIEZpcmViYXNlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGF1dGhFeHRlcm4pIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJZGVudGlmaWVzIHRoZSB0eXBlIG9mIGFwcGxpY2F0aW9uIHZlcmlmaWVyIChlLmcuIFwicmVjYXB0Y2hhLWVudGVycHJpc2VcIikuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy50eXBlID0gUkVDQVBUQ0hBX0VOVEVSUFJJU0VfVkVSSUZJRVJfVFlQRTtcclxuICAgICAgICB0aGlzLmF1dGggPSBfY2FzdEF1dGgoYXV0aEV4dGVybik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEV4ZWN1dGVzIHRoZSB2ZXJpZmljYXRpb24gcHJvY2Vzcy5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBBIFByb21pc2UgZm9yIGEgdG9rZW4gdGhhdCBjYW4gYmUgdXNlZCB0byBhc3NlcnQgdGhlIHZhbGlkaXR5IG9mIGEgcmVxdWVzdC5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgdmVyaWZ5KGFjdGlvbiA9ICd2ZXJpZnknLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkge1xyXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJldHJpZXZlU2l0ZUtleShhdXRoKSB7XHJcbiAgICAgICAgICAgIGlmICghZm9yY2VSZWZyZXNoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXV0aC50ZW5hbnRJZCA9PSBudWxsICYmIGF1dGguX2FnZW50UmVjYXB0Y2hhQ29uZmlnICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aC5fYWdlbnRSZWNhcHRjaGFDb25maWcuc2l0ZUtleTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhdXRoLnRlbmFudElkICE9IG51bGwgJiZcclxuICAgICAgICAgICAgICAgICAgICBhdXRoLl90ZW5hbnRSZWNhcHRjaGFDb25maWdzW2F1dGgudGVuYW50SWRdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aC5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1thdXRoLnRlbmFudElkXS5zaXRlS2V5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBnZXRSZWNhcHRjaGFDb25maWcoYXV0aCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsaWVudFR5cGU6IFwiQ0xJRU5UX1RZUEVfV0VCXCIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8sXHJcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogXCJSRUNBUFRDSEFfRU5URVJQUklTRVwiIC8qIFJlY2FwdGNoYVZlcnNpb24uRU5URVJQUklTRSAqL1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnJlY2FwdGNoYUtleSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3JlY2FwdGNoYSBFbnRlcnByaXNlIHNpdGUga2V5IHVuZGVmaW5lZCcpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IG5ldyBSZWNhcHRjaGFDb25maWcocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aC50ZW5hbnRJZCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoLl9hZ2VudFJlY2FwdGNoYUNvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGguX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3NbYXV0aC50ZW5hbnRJZF0gPSBjb25maWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoY29uZmlnLnNpdGVLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiByZXRyaWV2ZVJlY2FwdGNoYVRva2VuKHNpdGVLZXksIHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICBjb25zdCBncmVjYXB0Y2hhID0gd2luZG93LmdyZWNhcHRjaGE7XHJcbiAgICAgICAgICAgIGlmIChpc0VudGVycHJpc2UoZ3JlY2FwdGNoYSkpIHtcclxuICAgICAgICAgICAgICAgIGdyZWNhcHRjaGEuZW50ZXJwcmlzZS5yZWFkeSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3JlY2FwdGNoYS5lbnRlcnByaXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5leGVjdXRlKHNpdGVLZXksIHsgYWN0aW9uIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHRva2VuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShGQUtFX1RPS0VOKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KEVycm9yKCdObyByZUNBUFRDSEEgZW50ZXJwcmlzZSBzY3JpcHQgbG9hZGVkLicpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICByZXRyaWV2ZVNpdGVLZXkodGhpcy5hdXRoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oc2l0ZUtleSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWZvcmNlUmVmcmVzaCAmJiBpc0VudGVycHJpc2Uod2luZG93LmdyZWNhcHRjaGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0cmlldmVSZWNhcHRjaGFUb2tlbihzaXRlS2V5LCByZXNvbHZlLCByZWplY3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1JlY2FwdGNoYVZlcmlmaWVyIGlzIG9ubHkgc3VwcG9ydGVkIGluIGJyb3dzZXInKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHVybCA9IF9yZWNhcHRjaGFFbnRlcnByaXNlU2NyaXB0VXJsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVybC5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsICs9IHNpdGVLZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF9sb2FkSlModXJsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJpZXZlUmVjYXB0Y2hhVG9rZW4oc2l0ZUtleSwgcmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGluamVjdFJlY2FwdGNoYUZpZWxkcyhhdXRoLCByZXF1ZXN0LCBhY3Rpb24sIGNhcHRjaGFSZXNwID0gZmFsc2UpIHtcclxuICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFJlY2FwdGNoYUVudGVycHJpc2VWZXJpZmllcihhdXRoKTtcclxuICAgIGxldCBjYXB0Y2hhUmVzcG9uc2U7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNhcHRjaGFSZXNwb25zZSA9IGF3YWl0IHZlcmlmaWVyLnZlcmlmeShhY3Rpb24pO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY2FwdGNoYVJlc3BvbnNlID0gYXdhaXQgdmVyaWZpZXIudmVyaWZ5KGFjdGlvbiwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBuZXdSZXF1ZXN0ID0gT2JqZWN0LmFzc2lnbih7fSwgcmVxdWVzdCk7XHJcbiAgICBpZiAoIWNhcHRjaGFSZXNwKSB7XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihuZXdSZXF1ZXN0LCB7IGNhcHRjaGFSZXNwb25zZSB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24obmV3UmVxdWVzdCwgeyAnY2FwdGNoYVJlc3AnOiBjYXB0Y2hhUmVzcG9uc2UgfSk7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsgJ2NsaWVudFR5cGUnOiBcIkNMSUVOVF9UWVBFX1dFQlwiIC8qIFJlY2FwdGNoYUNsaWVudFR5cGUuV0VCICovIH0pO1xyXG4gICAgT2JqZWN0LmFzc2lnbihuZXdSZXF1ZXN0LCB7XHJcbiAgICAgICAgJ3JlY2FwdGNoYVZlcnNpb24nOiBcIlJFQ0FQVENIQV9FTlRFUlBSSVNFXCIgLyogUmVjYXB0Y2hhVmVyc2lvbi5FTlRFUlBSSVNFICovXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBuZXdSZXF1ZXN0O1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlY2FwdGNoYUZsb3coYXV0aEluc3RhbmNlLCByZXF1ZXN0LCBhY3Rpb25OYW1lLCBhY3Rpb25NZXRob2QpIHtcclxuICAgIHZhciBfYTtcclxuICAgIGlmICgoX2EgPSBhdXRoSW5zdGFuY2VcclxuICAgICAgICAuX2dldFJlY2FwdGNoYUNvbmZpZygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNQcm92aWRlckVuYWJsZWQoXCJFTUFJTF9QQVNTV09SRF9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYVByb3ZpZGVyLkVNQUlMX1BBU1NXT1JEX1BST1ZJREVSICovKSkge1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3RXaXRoUmVjYXB0Y2hhID0gYXdhaXQgaW5qZWN0UmVjYXB0Y2hhRmllbGRzKGF1dGhJbnN0YW5jZSwgcmVxdWVzdCwgYWN0aW9uTmFtZSwgYWN0aW9uTmFtZSA9PT0gXCJnZXRPb2JDb2RlXCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5HRVRfT09CX0NPREUgKi8pO1xyXG4gICAgICAgIHJldHVybiBhY3Rpb25NZXRob2QoYXV0aEluc3RhbmNlLCByZXF1ZXN0V2l0aFJlY2FwdGNoYSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gYWN0aW9uTWV0aG9kKGF1dGhJbnN0YW5jZSwgcmVxdWVzdCkuY2F0Y2goYXN5bmMgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8ke1wibWlzc2luZy1yZWNhcHRjaGEtdG9rZW5cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUkVDQVBUQ0hBX1RPS0VOICovfWApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke2FjdGlvbk5hbWV9IGlzIHByb3RlY3RlZCBieSByZUNBUFRDSEEgRW50ZXJwcmlzZSBmb3IgdGhpcyBwcm9qZWN0LiBBdXRvbWF0aWNhbGx5IHRyaWdnZXJpbmcgdGhlIHJlQ0FQVENIQSBmbG93IGFuZCByZXN0YXJ0aW5nIHRoZSBmbG93LmApO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFdpdGhSZWNhcHRjaGEgPSBhd2FpdCBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aEluc3RhbmNlLCByZXF1ZXN0LCBhY3Rpb25OYW1lLCBhY3Rpb25OYW1lID09PSBcImdldE9vYkNvZGVcIiAvKiBSZWNhcHRjaGFBY3Rpb25OYW1lLkdFVF9PT0JfQ09ERSAqLyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uTWV0aG9kKGF1dGhJbnN0YW5jZSwgcmVxdWVzdFdpdGhSZWNhcHRjaGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9pbml0aWFsaXplUmVjYXB0Y2hhQ29uZmlnKGF1dGgpIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0UmVjYXB0Y2hhQ29uZmlnKGF1dGhJbnRlcm5hbCwge1xyXG4gICAgICAgIGNsaWVudFR5cGU6IFwiQ0xJRU5UX1RZUEVfV0VCXCIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8sXHJcbiAgICAgICAgdmVyc2lvbjogXCJSRUNBUFRDSEFfRU5URVJQUklTRVwiIC8qIFJlY2FwdGNoYVZlcnNpb24uRU5URVJQUklTRSAqL1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBjb25maWcgPSBuZXcgUmVjYXB0Y2hhQ29uZmlnKHJlc3BvbnNlKTtcclxuICAgIGlmIChhdXRoSW50ZXJuYWwudGVuYW50SWQgPT0gbnVsbCkge1xyXG4gICAgICAgIGF1dGhJbnRlcm5hbC5fYWdlbnRSZWNhcHRjaGFDb25maWcgPSBjb25maWc7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBhdXRoSW50ZXJuYWwuX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3NbYXV0aEludGVybmFsLnRlbmFudElkXSA9IGNvbmZpZztcclxuICAgIH1cclxuICAgIGlmIChjb25maWcuaXNQcm92aWRlckVuYWJsZWQoXCJFTUFJTF9QQVNTV09SRF9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYVByb3ZpZGVyLkVNQUlMX1BBU1NXT1JEX1BST1ZJREVSICovKSkge1xyXG4gICAgICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFJlY2FwdGNoYUVudGVycHJpc2VWZXJpZmllcihhdXRoSW50ZXJuYWwpO1xyXG4gICAgICAgIHZvaWQgdmVyaWZpZXIudmVyaWZ5KCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEluaXRpYWxpemVzIGFuIHtAbGluayBBdXRofSBpbnN0YW5jZSB3aXRoIGZpbmUtZ3JhaW5lZCBjb250cm9sIG92ZXJcclxuICoge0BsaW5rIERlcGVuZGVuY2llc30uXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqXHJcbiAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIG1vcmUgY29udHJvbCBvdmVyIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdGhhblxyXG4gKiB7QGxpbmsgZ2V0QXV0aH0uIGBnZXRBdXRoYCB1c2VzIHBsYXRmb3JtLXNwZWNpZmljIGRlZmF1bHRzIHRvIHN1cHBseVxyXG4gKiB0aGUge0BsaW5rIERlcGVuZGVuY2llc30uIEluIGdlbmVyYWwsIGBnZXRBdXRoYCBpcyB0aGUgZWFzaWVzdCB3YXkgdG9cclxuICogaW5pdGlhbGl6ZSBBdXRoIGFuZCB3b3JrcyBmb3IgbW9zdCB1c2UgY2FzZXMuIFVzZSBgaW5pdGlhbGl6ZUF1dGhgIGlmIHlvdVxyXG4gKiBuZWVkIGNvbnRyb2wgb3ZlciB3aGljaCBwZXJzaXN0ZW5jZSBsYXllciBpcyB1c2VkLCBvciB0byBtaW5pbWl6ZSBidW5kbGVcclxuICogc2l6ZSBpZiB5b3UncmUgbm90IHVzaW5nIGVpdGhlciBgc2lnbkluV2l0aFBvcHVwYCBvciBgc2lnbkluV2l0aFJlZGlyZWN0YC5cclxuICpcclxuICogRm9yIGV4YW1wbGUsIGlmIHlvdXIgYXBwIG9ubHkgdXNlcyBhbm9ueW1vdXMgYWNjb3VudHMgYW5kIHlvdSBvbmx5IHdhbnRcclxuICogYWNjb3VudHMgc2F2ZWQgZm9yIHRoZSBjdXJyZW50IHNlc3Npb24sIGluaXRpYWxpemUgYEF1dGhgIHdpdGg6XHJcbiAqXHJcbiAqIGBgYGpzXHJcbiAqIGNvbnN0IGF1dGggPSBpbml0aWFsaXplQXV0aChhcHAsIHtcclxuICogICBwZXJzaXN0ZW5jZTogYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZSxcclxuICogICBwb3B1cFJlZGlyZWN0UmVzb2x2ZXI6IHVuZGVmaW5lZCxcclxuICogfSk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBpbml0aWFsaXplQXV0aChhcHAsIGRlcHMpIHtcclxuICAgIGNvbnN0IHByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgJ2F1dGgnKTtcclxuICAgIGlmIChwcm92aWRlci5pc0luaXRpYWxpemVkKCkpIHtcclxuICAgICAgICBjb25zdCBhdXRoID0gcHJvdmlkZXIuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICAgICAgY29uc3QgaW5pdGlhbE9wdGlvbnMgPSBwcm92aWRlci5nZXRPcHRpb25zKCk7XHJcbiAgICAgICAgaWYgKGRlZXBFcXVhbChpbml0aWFsT3B0aW9ucywgZGVwcyAhPT0gbnVsbCAmJiBkZXBzICE9PSB2b2lkIDAgPyBkZXBzIDoge30pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhdXRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgX2ZhaWwoYXV0aCwgXCJhbHJlYWR5LWluaXRpYWxpemVkXCIgLyogQXV0aEVycm9yQ29kZS5BTFJFQURZX0lOSVRJQUxJWkVEICovKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBhdXRoID0gcHJvdmlkZXIuaW5pdGlhbGl6ZSh7IG9wdGlvbnM6IGRlcHMgfSk7XHJcbiAgICByZXR1cm4gYXV0aDtcclxufVxyXG5mdW5jdGlvbiBfaW5pdGlhbGl6ZUF1dGhJbnN0YW5jZShhdXRoLCBkZXBzKSB7XHJcbiAgICBjb25zdCBwZXJzaXN0ZW5jZSA9IChkZXBzID09PSBudWxsIHx8IGRlcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlcHMucGVyc2lzdGVuY2UpIHx8IFtdO1xyXG4gICAgY29uc3QgaGllcmFyY2h5ID0gKEFycmF5LmlzQXJyYXkocGVyc2lzdGVuY2UpID8gcGVyc2lzdGVuY2UgOiBbcGVyc2lzdGVuY2VdKS5tYXAoX2dldEluc3RhbmNlKTtcclxuICAgIGlmIChkZXBzID09PSBudWxsIHx8IGRlcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlcHMuZXJyb3JNYXApIHtcclxuICAgICAgICBhdXRoLl91cGRhdGVFcnJvck1hcChkZXBzLmVycm9yTWFwKTtcclxuICAgIH1cclxuICAgIC8vIFRoaXMgcHJvbWlzZSBpcyBpbnRlbmRlZCB0byBmbG9hdDsgYXV0aCBpbml0aWFsaXphdGlvbiBoYXBwZW5zIGluIHRoZVxyXG4gICAgLy8gYmFja2dyb3VuZCwgbWVhbndoaWxlIHRoZSBhdXRoIG9iamVjdCBtYXkgYmUgdXNlZCBieSB0aGUgYXBwLlxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xyXG4gICAgYXV0aC5faW5pdGlhbGl6ZVdpdGhQZXJzaXN0ZW5jZShoaWVyYXJjaHksIGRlcHMgPT09IG51bGwgfHwgZGVwcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGVwcy5wb3B1cFJlZGlyZWN0UmVzb2x2ZXIpO1xyXG59XG5cbi8qKlxyXG4gKiBDaGFuZ2VzIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdG8gY29tbXVuaWNhdGUgd2l0aCB0aGUgRmlyZWJhc2UgQXV0aCBFbXVsYXRvciwgaW5zdGVhZCBvZiBwcm9kdWN0aW9uXHJcbiAqIEZpcmViYXNlIEF1dGggc2VydmljZXMuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoaXMgbXVzdCBiZSBjYWxsZWQgc3luY2hyb25vdXNseSBpbW1lZGlhdGVseSBmb2xsb3dpbmcgdGhlIGZpcnN0IGNhbGwgdG9cclxuICoge0BsaW5rIGluaXRpYWxpemVBdXRofS4gIERvIG5vdCB1c2Ugd2l0aCBwcm9kdWN0aW9uIGNyZWRlbnRpYWxzIGFzIGVtdWxhdG9yXHJcbiAqIHRyYWZmaWMgaXMgbm90IGVuY3J5cHRlZC5cclxuICpcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBjb25uZWN0QXV0aEVtdWxhdG9yKGF1dGgsICdodHRwOi8vMTI3LjAuMC4xOjkwOTknLCB7IGRpc2FibGVXYXJuaW5nczogdHJ1ZSB9KTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIHVybCAtIFRoZSBVUkwgYXQgd2hpY2ggdGhlIGVtdWxhdG9yIGlzIHJ1bm5pbmcgKGVnLCAnaHR0cDovL2xvY2FsaG9zdDo5MDk5JykuXHJcbiAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwuIGBvcHRpb25zLmRpc2FibGVXYXJuaW5nc2AgZGVmYXVsdHMgdG8gYGZhbHNlYC4gU2V0IGl0IHRvXHJcbiAqIGB0cnVlYCB0byBkaXNhYmxlIHRoZSB3YXJuaW5nIGJhbm5lciBhdHRhY2hlZCB0byB0aGUgRE9NLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBjb25uZWN0QXV0aEVtdWxhdG9yKGF1dGgsIHVybCwgb3B0aW9ucykge1xyXG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xyXG4gICAgX2Fzc2VydChhdXRoSW50ZXJuYWwuX2NhbkluaXRFbXVsYXRvciwgYXV0aEludGVybmFsLCBcImVtdWxhdG9yLWNvbmZpZy1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkVNVUxBVE9SX0NPTkZJR19GQUlMRUQgKi8pO1xyXG4gICAgX2Fzc2VydCgvXmh0dHBzPzpcXC9cXC8vLnRlc3QodXJsKSwgYXV0aEludGVybmFsLCBcImludmFsaWQtZW11bGF0b3Itc2NoZW1lXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0VNVUxBVE9SX1NDSEVNRSAqLyk7XHJcbiAgICBjb25zdCBkaXNhYmxlV2FybmluZ3MgPSAhIShvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuZGlzYWJsZVdhcm5pbmdzKTtcclxuICAgIGNvbnN0IHByb3RvY29sID0gZXh0cmFjdFByb3RvY29sKHVybCk7XHJcbiAgICBjb25zdCB7IGhvc3QsIHBvcnQgfSA9IGV4dHJhY3RIb3N0QW5kUG9ydCh1cmwpO1xyXG4gICAgY29uc3QgcG9ydFN0ciA9IHBvcnQgPT09IG51bGwgPyAnJyA6IGA6JHtwb3J0fWA7XHJcbiAgICAvLyBBbHdheXMgcmVwbGFjZSBwYXRoIHdpdGggXCIvXCIgKGV2ZW4gaWYgaW5wdXQgdXJsIGhhZCBubyBwYXRoIGF0IGFsbCwgb3IgaGFkIGEgZGlmZmVyZW50IG9uZSkuXHJcbiAgICBhdXRoSW50ZXJuYWwuY29uZmlnLmVtdWxhdG9yID0geyB1cmw6IGAke3Byb3RvY29sfS8vJHtob3N0fSR7cG9ydFN0cn0vYCB9O1xyXG4gICAgYXV0aEludGVybmFsLnNldHRpbmdzLmFwcFZlcmlmaWNhdGlvbkRpc2FibGVkRm9yVGVzdGluZyA9IHRydWU7XHJcbiAgICBhdXRoSW50ZXJuYWwuZW11bGF0b3JDb25maWcgPSBPYmplY3QuZnJlZXplKHtcclxuICAgICAgICBob3N0LFxyXG4gICAgICAgIHBvcnQsXHJcbiAgICAgICAgcHJvdG9jb2w6IHByb3RvY29sLnJlcGxhY2UoJzonLCAnJyksXHJcbiAgICAgICAgb3B0aW9uczogT2JqZWN0LmZyZWV6ZSh7IGRpc2FibGVXYXJuaW5ncyB9KVxyXG4gICAgfSk7XHJcbiAgICBpZiAoIWRpc2FibGVXYXJuaW5ncykge1xyXG4gICAgICAgIGVtaXRFbXVsYXRvcldhcm5pbmcoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBleHRyYWN0UHJvdG9jb2wodXJsKSB7XHJcbiAgICBjb25zdCBwcm90b2NvbEVuZCA9IHVybC5pbmRleE9mKCc6Jyk7XHJcbiAgICByZXR1cm4gcHJvdG9jb2xFbmQgPCAwID8gJycgOiB1cmwuc3Vic3RyKDAsIHByb3RvY29sRW5kICsgMSk7XHJcbn1cclxuZnVuY3Rpb24gZXh0cmFjdEhvc3RBbmRQb3J0KHVybCkge1xyXG4gICAgY29uc3QgcHJvdG9jb2wgPSBleHRyYWN0UHJvdG9jb2wodXJsKTtcclxuICAgIGNvbnN0IGF1dGhvcml0eSA9IC8oXFwvXFwvKT8oW14/Iy9dKykvLmV4ZWModXJsLnN1YnN0cihwcm90b2NvbC5sZW5ndGgpKTsgLy8gQmV0d2VlbiAvLyBhbmQgLywgPyBvciAjLlxyXG4gICAgaWYgKCFhdXRob3JpdHkpIHtcclxuICAgICAgICByZXR1cm4geyBob3N0OiAnJywgcG9ydDogbnVsbCB9O1xyXG4gICAgfVxyXG4gICAgY29uc3QgaG9zdEFuZFBvcnQgPSBhdXRob3JpdHlbMl0uc3BsaXQoJ0AnKS5wb3AoKSB8fCAnJzsgLy8gU3RyaXAgb3V0IFwidXNlcm5hbWU6cGFzc3dvcmRAXCIuXHJcbiAgICBjb25zdCBicmFja2V0ZWRJUHY2ID0gL14oXFxbW15cXF1dK1xcXSkoOnwkKS8uZXhlYyhob3N0QW5kUG9ydCk7XHJcbiAgICBpZiAoYnJhY2tldGVkSVB2Nikge1xyXG4gICAgICAgIGNvbnN0IGhvc3QgPSBicmFja2V0ZWRJUHY2WzFdO1xyXG4gICAgICAgIHJldHVybiB7IGhvc3QsIHBvcnQ6IHBhcnNlUG9ydChob3N0QW5kUG9ydC5zdWJzdHIoaG9zdC5sZW5ndGggKyAxKSkgfTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IFtob3N0LCBwb3J0XSA9IGhvc3RBbmRQb3J0LnNwbGl0KCc6Jyk7XHJcbiAgICAgICAgcmV0dXJuIHsgaG9zdCwgcG9ydDogcGFyc2VQb3J0KHBvcnQpIH07XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcGFyc2VQb3J0KHBvcnRTdHIpIHtcclxuICAgIGlmICghcG9ydFN0cikge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcG9ydCA9IE51bWJlcihwb3J0U3RyKTtcclxuICAgIGlmIChpc05hTihwb3J0KSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBvcnQ7XHJcbn1cclxuZnVuY3Rpb24gZW1pdEVtdWxhdG9yV2FybmluZygpIHtcclxuICAgIGZ1bmN0aW9uIGF0dGFjaEJhbm5lcigpIHtcclxuICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgICAgICBjb25zdCBzdHkgPSBlbC5zdHlsZTtcclxuICAgICAgICBlbC5pbm5lclRleHQgPVxyXG4gICAgICAgICAgICAnUnVubmluZyBpbiBlbXVsYXRvciBtb2RlLiBEbyBub3QgdXNlIHdpdGggcHJvZHVjdGlvbiBjcmVkZW50aWFscy4nO1xyXG4gICAgICAgIHN0eS5wb3NpdGlvbiA9ICdmaXhlZCc7XHJcbiAgICAgICAgc3R5LndpZHRoID0gJzEwMCUnO1xyXG4gICAgICAgIHN0eS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2ZmZmZmZic7XHJcbiAgICAgICAgc3R5LmJvcmRlciA9ICcuMWVtIHNvbGlkICMwMDAwMDAnO1xyXG4gICAgICAgIHN0eS5jb2xvciA9ICcjYjUwMDAwJztcclxuICAgICAgICBzdHkuYm90dG9tID0gJzBweCc7XHJcbiAgICAgICAgc3R5LmxlZnQgPSAnMHB4JztcclxuICAgICAgICBzdHkubWFyZ2luID0gJzBweCc7XHJcbiAgICAgICAgc3R5LnpJbmRleCA9ICcxMDAwMCc7XHJcbiAgICAgICAgc3R5LnRleHRBbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2ZpcmViYXNlLWVtdWxhdG9yLXdhcm5pbmcnKTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGNvbnNvbGUuaW5mbyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnV0FSTklORzogWW91IGFyZSB1c2luZyB0aGUgQXV0aCBFbXVsYXRvciwnICtcclxuICAgICAgICAgICAgJyB3aGljaCBpcyBpbnRlbmRlZCBmb3IgbG9jYWwgdGVzdGluZyBvbmx5LiAgRG8gbm90IHVzZSB3aXRoJyArXHJcbiAgICAgICAgICAgICcgcHJvZHVjdGlvbiBjcmVkZW50aWFscy4nKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdsb2FkaW5nJykge1xyXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGF0dGFjaEJhbm5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBhdHRhY2hCYW5uZXIoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEludGVyZmFjZSB0aGF0IHJlcHJlc2VudHMgdGhlIGNyZWRlbnRpYWxzIHJldHVybmVkIGJ5IGFuIHtAbGluayBBdXRoUHJvdmlkZXJ9LlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBJbXBsZW1lbnRhdGlvbnMgc3BlY2lmeSB0aGUgZGV0YWlscyBhYm91dCBlYWNoIGF1dGggcHJvdmlkZXIncyBjcmVkZW50aWFsIHJlcXVpcmVtZW50cy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgQXV0aENyZWRlbnRpYWwge1xyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAvKipcclxuICAgICAqIFRoZSBhdXRoZW50aWNhdGlvbiBwcm92aWRlciBJRCBmb3IgdGhlIGNyZWRlbnRpYWwuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIEZvciBleGFtcGxlLCAnZmFjZWJvb2suY29tJywgb3IgJ2dvb2dsZS5jb20nLlxyXG4gICAgICovXHJcbiAgICBwcm92aWRlcklkLCBcclxuICAgIC8qKlxyXG4gICAgICogVGhlIGF1dGhlbnRpY2F0aW9uIHNpZ24gaW4gbWV0aG9kIGZvciB0aGUgY3JlZGVudGlhbC5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICogRm9yIGV4YW1wbGUsIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JELCBvclxyXG4gICAgICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgc2lnbi1pbiBtZXRob2RcclxuICAgICAqIGlkZW50aWZpZXIgYXMgcmV0dXJuZWQgaW4ge0BsaW5rIGZldGNoU2lnbkluTWV0aG9kc0ZvckVtYWlsfS5cclxuICAgICAqL1xyXG4gICAgc2lnbkluTWV0aG9kKSB7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDtcclxuICAgICAgICB0aGlzLnNpZ25Jbk1ldGhvZCA9IHNpZ25Jbk1ldGhvZDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0LlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBvYmplY3QuXHJcbiAgICAgKi9cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoX2F1dGgpIHtcclxuICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9saW5rVG9JZFRva2VuKF9hdXRoLCBfaWRUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihfYXV0aCkge1xyXG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlc2V0UGFzc3dvcmQoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnJlc2V0UGFzc3dvcmRcIiAvKiBFbmRwb2ludC5SRVNFVF9QQVNTV09SRCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVFbWFpbFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czp1cGRhdGVcIiAvKiBFbmRwb2ludC5TRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTtcclxufVxyXG4vLyBVc2VkIGZvciBsaW5raW5nIGFuIGVtYWlsL3Bhc3N3b3JkIGFjY291bnQgdG8gYW4gZXhpc3RpbmcgaWRUb2tlbi4gVXNlcyB0aGUgc2FtZSByZXF1ZXN0L3Jlc3BvbnNlXHJcbi8vIGZvcm1hdCBhcyB1cGRhdGVFbWFpbFBhc3N3b3JkLlxyXG5hc3luYyBmdW5jdGlvbiBsaW5rRW1haWxQYXNzd29yZChhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnblVwXCIgLyogRW5kcG9pbnQuU0lHTl9VUCAqLywgcmVxdWVzdCk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gYXBwbHlBY3Rpb25Db2RlJDEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnVwZGF0ZVwiIC8qIEVuZHBvaW50LlNFVF9BQ0NPVU5UX0lORk8gKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoUGFzc3dvcmRcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfUEFTU1dPUkQgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gc2VuZE9vYkNvZGUoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNlbmRPb2JDb2RlXCIgLyogRW5kcG9pbnQuU0VORF9PT0JfQ09ERSAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBzZW5kRW1haWxWZXJpZmljYXRpb24kMShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gc2VuZE9vYkNvZGUoYXV0aCwgcmVxdWVzdCk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gc2VuZFBhc3N3b3JkUmVzZXRFbWFpbCQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBzZW5kT29iQ29kZShhdXRoLCByZXF1ZXN0KTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBzZW5kU2lnbkluTGlua1RvRW1haWwkMShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gc2VuZE9vYkNvZGUoYXV0aCwgcmVxdWVzdCk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QW5kQ2hhbmdlRW1haWwoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIHNlbmRPb2JDb2RlKGF1dGgsIHJlcXVlc3QpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbExpbmskMShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aEVtYWlsTGlua1wiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9FTUFJTF9MSU5LICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbExpbmtGb3JMaW5raW5nKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoRW1haWxMaW5rXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX0VNQUlMX0xJTksgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEludGVyZmFjZSB0aGF0IHJlcHJlc2VudHMgdGhlIGNyZWRlbnRpYWxzIHJldHVybmVkIGJ5IHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gZm9yXHJcbiAqIHtAbGluayBQcm92aWRlcklkfS5QQVNTV09SRFxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBDb3ZlcnMgYm90aCB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9QQVNTV09SRCBhbmRcclxuICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgRW1haWxBdXRoQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHtcclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2VtYWlsLCBcclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9wYXNzd29yZCwgc2lnbkluTWV0aG9kLCBcclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF90ZW5hbnRJZCA9IG51bGwpIHtcclxuICAgICAgICBzdXBlcihcInBhc3N3b3JkXCIgLyogUHJvdmlkZXJJZC5QQVNTV09SRCAqLywgc2lnbkluTWV0aG9kKTtcclxuICAgICAgICB0aGlzLl9lbWFpbCA9IF9lbWFpbDtcclxuICAgICAgICB0aGlzLl9wYXNzd29yZCA9IF9wYXNzd29yZDtcclxuICAgICAgICB0aGlzLl90ZW5hbnRJZCA9IF90ZW5hbnRJZDtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbUVtYWlsQW5kUGFzc3dvcmQoZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBFbWFpbEF1dGhDcmVkZW50aWFsKGVtYWlsLCBwYXNzd29yZCwgXCJwYXNzd29yZFwiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9QQVNTV09SRCAqLyk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBzdGF0aWMgX2Zyb21FbWFpbEFuZENvZGUoZW1haWwsIG9vYkNvZGUsIHRlbmFudElkID0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgRW1haWxBdXRoQ3JlZGVudGlhbChlbWFpbCwgb29iQ29kZSwgXCJlbWFpbExpbmtcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLywgdGVuYW50SWQpO1xyXG4gICAgfVxyXG4gICAgLyoqIHtAaW5oZXJpdGRvYyBBdXRoQ3JlZGVudGlhbC50b0pTT059ICovXHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmQsXHJcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogdGhpcy5zaWduSW5NZXRob2QsXHJcbiAgICAgICAgICAgIHRlbmFudElkOiB0aGlzLl90ZW5hbnRJZFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFN0YXRpYyBtZXRob2QgdG8gZGVzZXJpYWxpemUgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGFuIG9iamVjdCBpbnRvIGFuIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBqc29uIC0gRWl0aGVyIGBvYmplY3RgIG9yIHRoZSBzdHJpbmdpZmllZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgb2JqZWN0LiBXaGVuIHN0cmluZyBpc1xyXG4gICAgICogcHJvdmlkZWQsIGBKU09OLnBhcnNlYCB3b3VsZCBiZSBjYWxsZWQgZmlyc3QuXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMgSWYgdGhlIEpTT04gaW5wdXQgZG9lcyBub3QgcmVwcmVzZW50IGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0sIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmcm9tSlNPTihqc29uKSB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gdHlwZW9mIGpzb24gPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShqc29uKSA6IGpzb247XHJcbiAgICAgICAgaWYgKChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmouZW1haWwpICYmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmoucGFzc3dvcmQpKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmouc2lnbkluTWV0aG9kID09PSBcInBhc3N3b3JkXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbUVtYWlsQW5kUGFzc3dvcmQob2JqLmVtYWlsLCBvYmoucGFzc3dvcmQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG9iai5zaWduSW5NZXRob2QgPT09IFwiZW1haWxMaW5rXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi8pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRW1haWxBbmRDb2RlKG9iai5lbWFpbCwgb2JqLnBhc3N3b3JkLCBvYmoudGVuYW50SWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgYXN5bmMgX2dldElkVG9rZW5SZXNwb25zZShhdXRoKSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLnNpZ25Jbk1ldGhvZCkge1xyXG4gICAgICAgICAgICBjYXNlIFwicGFzc3dvcmRcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi86XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50VHlwZTogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqL1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVSZWNhcHRjaGFGbG93KGF1dGgsIHJlcXVlc3QsIFwic2lnbkluV2l0aFBhc3N3b3JkXCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5TSUdOX0lOX1dJVEhfUEFTU1dPUkQgKi8sIHNpZ25JbldpdGhQYXNzd29yZCk7XHJcbiAgICAgICAgICAgIGNhc2UgXCJlbWFpbExpbmtcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBzaWduSW5XaXRoRW1haWxMaW5rJDEoYXV0aCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICBvb2JDb2RlOiB0aGlzLl9wYXNzd29yZFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBfZmFpbChhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgYXN5bmMgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5zaWduSW5NZXRob2QpIHtcclxuICAgICAgICAgICAgY2FzZSBcInBhc3N3b3JkXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovOlxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBpZFRva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50VHlwZTogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqL1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVSZWNhcHRjaGFGbG93KGF1dGgsIHJlcXVlc3QsIFwic2lnblVwUGFzc3dvcmRcIiAvKiBSZWNhcHRjaGFBY3Rpb25OYW1lLlNJR05fVVBfUEFTU1dPUkQgKi8sIGxpbmtFbWFpbFBhc3N3b3JkKTtcclxuICAgICAgICAgICAgY2FzZSBcImVtYWlsTGlua1wiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9MSU5LICovOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhFbWFpbExpbmtGb3JMaW5raW5nKGF1dGgsIHtcclxuICAgICAgICAgICAgICAgICAgICBpZFRva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICBvb2JDb2RlOiB0aGlzLl9wYXNzd29yZFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBfZmFpbChhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldElkVG9rZW5SZXNwb25zZShhdXRoKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoSWRwXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX0lEUCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBJRFBfUkVRVUVTVF9VUkkkMSA9ICdodHRwOi8vbG9jYWxob3N0JztcclxuLyoqXHJcbiAqIFJlcHJlc2VudHMgdGhlIE9BdXRoIGNyZWRlbnRpYWxzIHJldHVybmVkIGJ5IGFuIHtAbGluayBPQXV0aFByb3ZpZGVyfS5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSW1wbGVtZW50YXRpb25zIHNwZWNpZnkgdGhlIGRldGFpbHMgYWJvdXQgZWFjaCBhdXRoIHByb3ZpZGVyJ3MgY3JlZGVudGlhbCByZXF1aXJlbWVudHMuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIE9BdXRoQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nVG9rZW4gPSBudWxsO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIF9mcm9tUGFyYW1zKHBhcmFtcykge1xyXG4gICAgICAgIGNvbnN0IGNyZWQgPSBuZXcgT0F1dGhDcmVkZW50aWFsKHBhcmFtcy5wcm92aWRlcklkLCBwYXJhbXMuc2lnbkluTWV0aG9kKTtcclxuICAgICAgICBpZiAocGFyYW1zLmlkVG9rZW4gfHwgcGFyYW1zLmFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgIC8vIE9BdXRoIDIgYW5kIGVpdGhlciBJRCB0b2tlbiBvciBhY2Nlc3MgdG9rZW4uXHJcbiAgICAgICAgICAgIGlmIChwYXJhbXMuaWRUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgY3JlZC5pZFRva2VuID0gcGFyYW1zLmlkVG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHBhcmFtcy5hY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgY3JlZC5hY2Nlc3NUb2tlbiA9IHBhcmFtcy5hY2Nlc3NUb2tlbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBBZGQgbm9uY2UgaWYgYXZhaWxhYmxlIGFuZCBubyBwZW5kaW5nVG9rZW4gaXMgcHJlc2VudC5cclxuICAgICAgICAgICAgaWYgKHBhcmFtcy5ub25jZSAmJiAhcGFyYW1zLnBlbmRpbmdUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgY3JlZC5ub25jZSA9IHBhcmFtcy5ub25jZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocGFyYW1zLnBlbmRpbmdUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgY3JlZC5wZW5kaW5nVG9rZW4gPSBwYXJhbXMucGVuZGluZ1Rva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBhcmFtcy5vYXV0aFRva2VuICYmIHBhcmFtcy5vYXV0aFRva2VuU2VjcmV0KSB7XHJcbiAgICAgICAgICAgIC8vIE9BdXRoIDEgYW5kIE9BdXRoIHRva2VuIHdpdGggdG9rZW4gc2VjcmV0XHJcbiAgICAgICAgICAgIGNyZWQuYWNjZXNzVG9rZW4gPSBwYXJhbXMub2F1dGhUb2tlbjtcclxuICAgICAgICAgICAgY3JlZC5zZWNyZXQgPSBwYXJhbXMub2F1dGhUb2tlblNlY3JldDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIF9mYWlsKFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNyZWQ7XHJcbiAgICB9XHJcbiAgICAvKioge0Bpbmhlcml0ZG9jIEF1dGhDcmVkZW50aWFsLnRvSlNPTn0gICovXHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaWRUb2tlbjogdGhpcy5pZFRva2VuLFxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogdGhpcy5hY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgc2VjcmV0OiB0aGlzLnNlY3JldCxcclxuICAgICAgICAgICAgbm9uY2U6IHRoaXMubm9uY2UsXHJcbiAgICAgICAgICAgIHBlbmRpbmdUb2tlbjogdGhpcy5wZW5kaW5nVG9rZW4sXHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IHRoaXMucHJvdmlkZXJJZCxcclxuICAgICAgICAgICAgc2lnbkluTWV0aG9kOiB0aGlzLnNpZ25Jbk1ldGhvZFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFN0YXRpYyBtZXRob2QgdG8gZGVzZXJpYWxpemUgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGFuIG9iamVjdCBpbnRvIGFuXHJcbiAgICAgKiB7QGxpbmsgIEF1dGhDcmVkZW50aWFsfS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ganNvbiAtIElucHV0IGNhbiBiZSBlaXRoZXIgT2JqZWN0IG9yIHRoZSBzdHJpbmdpZmllZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgb2JqZWN0LlxyXG4gICAgICogV2hlbiBzdHJpbmcgaXMgcHJvdmlkZWQsIEpTT04ucGFyc2Ugd291bGQgYmUgY2FsbGVkIGZpcnN0LlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIElmIHRoZSBKU09OIGlucHV0IGRvZXMgbm90IHJlcHJlc2VudCBhbiB7QGxpbmsgIEF1dGhDcmVkZW50aWFsfSwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZyb21KU09OKGpzb24pIHtcclxuICAgICAgICBjb25zdCBvYmogPSB0eXBlb2YganNvbiA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGpzb24pIDoganNvbjtcclxuICAgICAgICBjb25zdCB7IHByb3ZpZGVySWQsIHNpZ25Jbk1ldGhvZCB9ID0gb2JqLCByZXN0ID0gX19yZXN0KG9iaiwgW1wicHJvdmlkZXJJZFwiLCBcInNpZ25Jbk1ldGhvZFwiXSk7XHJcbiAgICAgICAgaWYgKCFwcm92aWRlcklkIHx8ICFzaWduSW5NZXRob2QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNyZWQgPSBuZXcgT0F1dGhDcmVkZW50aWFsKHByb3ZpZGVySWQsIHNpZ25Jbk1ldGhvZCk7XHJcbiAgICAgICAgY3JlZC5pZFRva2VuID0gcmVzdC5pZFRva2VuIHx8IHVuZGVmaW5lZDtcclxuICAgICAgICBjcmVkLmFjY2Vzc1Rva2VuID0gcmVzdC5hY2Nlc3NUb2tlbiB8fCB1bmRlZmluZWQ7XHJcbiAgICAgICAgY3JlZC5zZWNyZXQgPSByZXN0LnNlY3JldDtcclxuICAgICAgICBjcmVkLm5vbmNlID0gcmVzdC5ub25jZTtcclxuICAgICAgICBjcmVkLnBlbmRpbmdUb2tlbiA9IHJlc3QucGVuZGluZ1Rva2VuIHx8IG51bGw7XHJcbiAgICAgICAgcmV0dXJuIGNyZWQ7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTtcclxuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTtcclxuICAgICAgICByZXF1ZXN0LmlkVG9rZW4gPSBpZFRva2VuO1xyXG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKSB7XHJcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7XHJcbiAgICAgICAgcmVxdWVzdC5hdXRvQ3JlYXRlID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7XHJcbiAgICB9XHJcbiAgICBidWlsZFJlcXVlc3QoKSB7XHJcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgcmVxdWVzdFVyaTogSURQX1JFUVVFU1RfVVJJJDEsXHJcbiAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAodGhpcy5wZW5kaW5nVG9rZW4pIHtcclxuICAgICAgICAgICAgcmVxdWVzdC5wZW5kaW5nVG9rZW4gPSB0aGlzLnBlbmRpbmdUb2tlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvc3RCb2R5ID0ge307XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlkVG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHBvc3RCb2R5WydpZF90b2tlbiddID0gdGhpcy5pZFRva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBwb3N0Qm9keVsnYWNjZXNzX3Rva2VuJ10gPSB0aGlzLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlY3JldCkge1xyXG4gICAgICAgICAgICAgICAgcG9zdEJvZHlbJ29hdXRoX3Rva2VuX3NlY3JldCddID0gdGhpcy5zZWNyZXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcG9zdEJvZHlbJ3Byb3ZpZGVySWQnXSA9IHRoaXMucHJvdmlkZXJJZDtcclxuICAgICAgICAgICAgaWYgKHRoaXMubm9uY2UgJiYgIXRoaXMucGVuZGluZ1Rva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBwb3N0Qm9keVsnbm9uY2UnXSA9IHRoaXMubm9uY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVxdWVzdC5wb3N0Qm9keSA9IHF1ZXJ5c3RyaW5nKHBvc3RCb2R5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2VuZFBob25lVmVyaWZpY2F0aW9uQ29kZShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2VuZFZlcmlmaWNhdGlvbkNvZGVcIiAvKiBFbmRwb2ludC5TRU5EX1ZFUklGSUNBVElPTl9DT0RFICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhQaG9uZU51bWJlciQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoUGhvbmVOdW1iZXJcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfUEhPTkVfTlVNQkVSICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGxpbmtXaXRoUGhvbmVOdW1iZXIkMShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhQaG9uZU51bWJlclwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9QSE9ORV9OVU1CRVIgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbiAgICBpZiAocmVzcG9uc2UudGVtcG9yYXJ5UHJvb2YpIHtcclxuICAgICAgICB0aHJvdyBfbWFrZVRhZ2dlZEVycm9yKGF1dGgsIFwiYWNjb3VudC1leGlzdHMtd2l0aC1kaWZmZXJlbnQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuTkVFRF9DT05GSVJNQVRJT04gKi8sIHJlc3BvbnNlKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXNwb25zZTtcclxufVxyXG5jb25zdCBWRVJJRllfUEhPTkVfTlVNQkVSX0ZPUl9FWElTVElOR19FUlJPUl9NQVBfID0ge1xyXG4gICAgW1wiVVNFUl9OT1RfRk9VTkRcIiAvKiBTZXJ2ZXJFcnJvci5VU0VSX05PVF9GT1VORCAqL106IFwidXNlci1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfREVMRVRFRCAqL1xyXG59O1xyXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlQaG9uZU51bWJlckZvckV4aXN0aW5nKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIGNvbnN0IGFwaVJlcXVlc3QgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlcXVlc3QpLCB7IG9wZXJhdGlvbjogJ1JFQVVUSCcgfSk7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aFBob25lTnVtYmVyXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX1BIT05FX05VTUJFUiAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIGFwaVJlcXVlc3QpLCBWRVJJRllfUEhPTkVfTlVNQkVSX0ZPUl9FWElTVElOR19FUlJPUl9NQVBfKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUmVwcmVzZW50cyB0aGUgY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkge0BsaW5rIFBob25lQXV0aFByb3ZpZGVyfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgUGhvbmVBdXRoQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHtcclxuICAgIGNvbnN0cnVjdG9yKHBhcmFtcykge1xyXG4gICAgICAgIHN1cGVyKFwicGhvbmVcIiAvKiBQcm92aWRlcklkLlBIT05FICovLCBcInBob25lXCIgLyogU2lnbkluTWV0aG9kLlBIT05FICovKTtcclxuICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbVZlcmlmaWNhdGlvbih2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUGhvbmVBdXRoQ3JlZGVudGlhbCh7IHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIF9mcm9tVG9rZW5SZXNwb25zZShwaG9uZU51bWJlciwgdGVtcG9yYXJ5UHJvb2YpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFBob25lQXV0aENyZWRlbnRpYWwoeyBwaG9uZU51bWJlciwgdGVtcG9yYXJ5UHJvb2YgfSk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHtcclxuICAgICAgICByZXR1cm4gc2lnbkluV2l0aFBob25lTnVtYmVyJDEoYXV0aCwgdGhpcy5fbWFrZVZlcmlmaWNhdGlvblJlcXVlc3QoKSk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfbGlua1RvSWRUb2tlbihhdXRoLCBpZFRva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIGxpbmtXaXRoUGhvbmVOdW1iZXIkMShhdXRoLCBPYmplY3QuYXNzaWduKHsgaWRUb2tlbiB9LCB0aGlzLl9tYWtlVmVyaWZpY2F0aW9uUmVxdWVzdCgpKSk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcclxuICAgICAgICByZXR1cm4gdmVyaWZ5UGhvbmVOdW1iZXJGb3JFeGlzdGluZyhhdXRoLCB0aGlzLl9tYWtlVmVyaWZpY2F0aW9uUmVxdWVzdCgpKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9tYWtlVmVyaWZpY2F0aW9uUmVxdWVzdCgpIHtcclxuICAgICAgICBjb25zdCB7IHRlbXBvcmFyeVByb29mLCBwaG9uZU51bWJlciwgdmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUgfSA9IHRoaXMucGFyYW1zO1xyXG4gICAgICAgIGlmICh0ZW1wb3JhcnlQcm9vZiAmJiBwaG9uZU51bWJlcikge1xyXG4gICAgICAgICAgICByZXR1cm4geyB0ZW1wb3JhcnlQcm9vZiwgcGhvbmVOdW1iZXIgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2Vzc2lvbkluZm86IHZlcmlmaWNhdGlvbklkLFxyXG4gICAgICAgICAgICBjb2RlOiB2ZXJpZmljYXRpb25Db2RlXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKiB7QGluaGVyaXRkb2MgQXV0aENyZWRlbnRpYWwudG9KU09OfSAqL1xyXG4gICAgdG9KU09OKCkge1xyXG4gICAgICAgIGNvbnN0IG9iaiA9IHtcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogdGhpcy5wcm92aWRlcklkXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAodGhpcy5wYXJhbXMucGhvbmVOdW1iZXIpIHtcclxuICAgICAgICAgICAgb2JqLnBob25lTnVtYmVyID0gdGhpcy5wYXJhbXMucGhvbmVOdW1iZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnBhcmFtcy50ZW1wb3JhcnlQcm9vZikge1xyXG4gICAgICAgICAgICBvYmoudGVtcG9yYXJ5UHJvb2YgPSB0aGlzLnBhcmFtcy50ZW1wb3JhcnlQcm9vZjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMucGFyYW1zLnZlcmlmaWNhdGlvbkNvZGUpIHtcclxuICAgICAgICAgICAgb2JqLnZlcmlmaWNhdGlvbkNvZGUgPSB0aGlzLnBhcmFtcy52ZXJpZmljYXRpb25Db2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5wYXJhbXMudmVyaWZpY2F0aW9uSWQpIHtcclxuICAgICAgICAgICAgb2JqLnZlcmlmaWNhdGlvbklkID0gdGhpcy5wYXJhbXMudmVyaWZpY2F0aW9uSWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9XHJcbiAgICAvKiogR2VuZXJhdGVzIGEgcGhvbmUgY3JlZGVudGlhbCBiYXNlZCBvbiBhIHBsYWluIG9iamVjdCBvciBhIEpTT04gc3RyaW5nLiAqL1xyXG4gICAgc3RhdGljIGZyb21KU09OKGpzb24pIHtcclxuICAgICAgICBpZiAodHlwZW9mIGpzb24gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGpzb24gPSBKU09OLnBhcnNlKGpzb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlLCBwaG9uZU51bWJlciwgdGVtcG9yYXJ5UHJvb2YgfSA9IGpzb247XHJcbiAgICAgICAgaWYgKCF2ZXJpZmljYXRpb25Db2RlICYmXHJcbiAgICAgICAgICAgICF2ZXJpZmljYXRpb25JZCAmJlxyXG4gICAgICAgICAgICAhcGhvbmVOdW1iZXIgJiZcclxuICAgICAgICAgICAgIXRlbXBvcmFyeVByb29mKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IFBob25lQXV0aENyZWRlbnRpYWwoe1xyXG4gICAgICAgICAgICB2ZXJpZmljYXRpb25JZCxcclxuICAgICAgICAgICAgdmVyaWZpY2F0aW9uQ29kZSxcclxuICAgICAgICAgICAgcGhvbmVOdW1iZXIsXHJcbiAgICAgICAgICAgIHRlbXBvcmFyeVByb29mXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIE1hcHMgdGhlIG1vZGUgc3RyaW5nIGluIGFjdGlvbiBjb2RlIFVSTCB0byBBY3Rpb24gQ29kZSBJbmZvIG9wZXJhdGlvbi5cclxuICpcclxuICogQHBhcmFtIG1vZGVcclxuICovXHJcbmZ1bmN0aW9uIHBhcnNlTW9kZShtb2RlKSB7XHJcbiAgICBzd2l0Y2ggKG1vZGUpIHtcclxuICAgICAgICBjYXNlICdyZWNvdmVyRW1haWwnOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJSRUNPVkVSX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5SRUNPVkVSX0VNQUlMICovO1xyXG4gICAgICAgIGNhc2UgJ3Jlc2V0UGFzc3dvcmQnOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJQQVNTV09SRF9SRVNFVFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uUEFTU1dPUkRfUkVTRVQgKi87XHJcbiAgICAgICAgY2FzZSAnc2lnbkluJzpcclxuICAgICAgICAgICAgcmV0dXJuIFwiRU1BSUxfU0lHTklOXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5FTUFJTF9TSUdOSU4gKi87XHJcbiAgICAgICAgY2FzZSAndmVyaWZ5RW1haWwnOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJWRVJJRllfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9FTUFJTCAqLztcclxuICAgICAgICBjYXNlICd2ZXJpZnlBbmRDaGFuZ2VFbWFpbCc6XHJcbiAgICAgICAgICAgIHJldHVybiBcIlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfQU5EX0NIQU5HRV9FTUFJTCAqLztcclxuICAgICAgICBjYXNlICdyZXZlcnRTZWNvbmRGYWN0b3JBZGRpdGlvbic6XHJcbiAgICAgICAgICAgIHJldHVybiBcIlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5SRVZFUlRfU0VDT05EX0ZBQ1RPUl9BRERJVElPTiAqLztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogSGVscGVyIHRvIHBhcnNlIEZETCBsaW5rc1xyXG4gKlxyXG4gKiBAcGFyYW0gdXJsXHJcbiAqL1xyXG5mdW5jdGlvbiBwYXJzZURlZXBMaW5rKHVybCkge1xyXG4gICAgY29uc3QgbGluayA9IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyh1cmwpKVsnbGluayddO1xyXG4gICAgLy8gRG91YmxlIGxpbmsgY2FzZSAoYXV0b21hdGljIHJlZGlyZWN0KS5cclxuICAgIGNvbnN0IGRvdWJsZURlZXBMaW5rID0gbGlua1xyXG4gICAgICAgID8gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKGxpbmspKVsnZGVlcF9saW5rX2lkJ11cclxuICAgICAgICA6IG51bGw7XHJcbiAgICAvLyBpT1MgY3VzdG9tIHNjaGVtZSBsaW5rcy5cclxuICAgIGNvbnN0IGlPU0RlZXBMaW5rID0gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybCkpWydkZWVwX2xpbmtfaWQnXTtcclxuICAgIGNvbnN0IGlPU0RvdWJsZURlZXBMaW5rID0gaU9TRGVlcExpbmtcclxuICAgICAgICA/IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyhpT1NEZWVwTGluaykpWydsaW5rJ11cclxuICAgICAgICA6IG51bGw7XHJcbiAgICByZXR1cm4gaU9TRG91YmxlRGVlcExpbmsgfHwgaU9TRGVlcExpbmsgfHwgZG91YmxlRGVlcExpbmsgfHwgbGluayB8fCB1cmw7XHJcbn1cclxuLyoqXHJcbiAqIEEgdXRpbGl0eSBjbGFzcyB0byBwYXJzZSBlbWFpbCBhY3Rpb24gVVJMcyBzdWNoIGFzIHBhc3N3b3JkIHJlc2V0LCBlbWFpbCB2ZXJpZmljYXRpb24sXHJcbiAqIGVtYWlsIGxpbmsgc2lnbiBpbiwgZXRjLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBBY3Rpb25Db2RlVVJMIHtcclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIGFjdGlvbkxpbmsgLSBUaGUgbGluayBmcm9tIHdoaWNoIHRvIGV4dHJhY3QgdGhlIFVSTC5cclxuICAgICAqIEByZXR1cm5zIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVVSTH0gb2JqZWN0LCBvciBudWxsIGlmIHRoZSBsaW5rIGlzIGludmFsaWQuXHJcbiAgICAgKlxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGFjdGlvbkxpbmspIHtcclxuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcclxuICAgICAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBxdWVyeXN0cmluZ0RlY29kZShleHRyYWN0UXVlcnlzdHJpbmcoYWN0aW9uTGluaykpO1xyXG4gICAgICAgIGNvbnN0IGFwaUtleSA9IChfYSA9IHNlYXJjaFBhcmFtc1tcImFwaUtleVwiIC8qIFF1ZXJ5RmllbGQuQVBJX0tFWSAqL10pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGw7XHJcbiAgICAgICAgY29uc3QgY29kZSA9IChfYiA9IHNlYXJjaFBhcmFtc1tcIm9vYkNvZGVcIiAvKiBRdWVyeUZpZWxkLkNPREUgKi9dKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBudWxsO1xyXG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IHBhcnNlTW9kZSgoX2MgPSBzZWFyY2hQYXJhbXNbXCJtb2RlXCIgLyogUXVlcnlGaWVsZC5NT0RFICovXSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogbnVsbCk7XHJcbiAgICAgICAgLy8gVmFsaWRhdGUgQVBJIGtleSwgY29kZSBhbmQgbW9kZS5cclxuICAgICAgICBfYXNzZXJ0KGFwaUtleSAmJiBjb2RlICYmIG9wZXJhdGlvbiwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIHRoaXMuYXBpS2V5ID0gYXBpS2V5O1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xyXG4gICAgICAgIHRoaXMuY29kZSA9IGNvZGU7XHJcbiAgICAgICAgdGhpcy5jb250aW51ZVVybCA9IChfZCA9IHNlYXJjaFBhcmFtc1tcImNvbnRpbnVlVXJsXCIgLyogUXVlcnlGaWVsZC5DT05USU5VRV9VUkwgKi9dKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBudWxsO1xyXG4gICAgICAgIHRoaXMubGFuZ3VhZ2VDb2RlID0gKF9lID0gc2VhcmNoUGFyYW1zW1wibGFuZ3VhZ2VDb2RlXCIgLyogUXVlcnlGaWVsZC5MQU5HVUFHRV9DT0RFICovXSkgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogbnVsbDtcclxuICAgICAgICB0aGlzLnRlbmFudElkID0gKF9mID0gc2VhcmNoUGFyYW1zW1widGVuYW50SWRcIiAvKiBRdWVyeUZpZWxkLlRFTkFOVF9JRCAqL10pICE9PSBudWxsICYmIF9mICE9PSB2b2lkIDAgPyBfZiA6IG51bGw7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFBhcnNlcyB0aGUgZW1haWwgYWN0aW9uIGxpbmsgc3RyaW5nIGFuZCByZXR1cm5zIGFuIHtAbGluayBBY3Rpb25Db2RlVVJMfSBpZiB0aGUgbGluayBpcyB2YWxpZCxcclxuICAgICAqIG90aGVyd2lzZSByZXR1cm5zIG51bGwuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGxpbmsgIC0gVGhlIGVtYWlsIGFjdGlvbiBsaW5rIHN0cmluZy5cclxuICAgICAqIEByZXR1cm5zIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVVSTH0gb2JqZWN0LCBvciBudWxsIGlmIHRoZSBsaW5rIGlzIGludmFsaWQuXHJcbiAgICAgKlxyXG4gICAgICogQHB1YmxpY1xyXG4gICAgICovXHJcbiAgICBzdGF0aWMgcGFyc2VMaW5rKGxpbmspIHtcclxuICAgICAgICBjb25zdCBhY3Rpb25MaW5rID0gcGFyc2VEZWVwTGluayhsaW5rKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEFjdGlvbkNvZGVVUkwoYWN0aW9uTGluayk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFBhcnNlcyB0aGUgZW1haWwgYWN0aW9uIGxpbmsgc3RyaW5nIGFuZCByZXR1cm5zIGFuIHtAbGluayBBY3Rpb25Db2RlVVJMfSBpZlxyXG4gKiB0aGUgbGluayBpcyB2YWxpZCwgb3RoZXJ3aXNlIHJldHVybnMgbnVsbC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gcGFyc2VBY3Rpb25Db2RlVVJMKGxpbmspIHtcclxuICAgIHJldHVybiBBY3Rpb25Db2RlVVJMLnBhcnNlTGluayhsaW5rKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcge0BsaW5rIEVtYWlsQXV0aENyZWRlbnRpYWx9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBFbWFpbEF1dGhQcm92aWRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5QQVNTV09SRCwgZXZlbiBmb3IgZW1haWwgbGluay5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnByb3ZpZGVySWQgPSBFbWFpbEF1dGhQcm92aWRlci5QUk9WSURFUl9JRDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9IHVzaW5nIGFuIGVtYWlsIGFuZCBwYXNzd29yZC5cclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogY29uc3QgYXV0aENyZWRlbnRpYWwgPSBFbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKGVtYWlsLCBwYXNzd29yZCk7XHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGF1dGhDcmVkZW50aWFsKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZW1haWwgLSBFbWFpbCBhZGRyZXNzLlxyXG4gICAgICogQHBhcmFtIHBhc3N3b3JkIC0gVXNlciBhY2NvdW50IHBhc3N3b3JkLlxyXG4gICAgICogQHJldHVybnMgVGhlIGF1dGggcHJvdmlkZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgcmV0dXJuIEVtYWlsQXV0aENyZWRlbnRpYWwuX2Zyb21FbWFpbEFuZFBhc3N3b3JkKGVtYWlsLCBwYXNzd29yZCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEluaXRpYWxpemUgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSB1c2luZyBhbiBlbWFpbCBhbmQgYW4gZW1haWwgbGluayBhZnRlciBhIHNpZ24gaW4gd2l0aFxyXG4gICAgICogZW1haWwgbGluayBvcGVyYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIGBgYGphdmFzY3JpcHRcclxuICAgICAqIGNvbnN0IGF1dGhDcmVkZW50aWFsID0gRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbFdpdGhMaW5rKGF1dGgsIGVtYWlsLCBlbWFpbExpbmspO1xyXG4gICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChhdXRoLCBhdXRoQ3JlZGVudGlhbCk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogYXdhaXQgc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsIGVtYWlsKTtcclxuICAgICAqIC8vIE9idGFpbiBlbWFpbExpbmsgZnJvbSB1c2VyLlxyXG4gICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBzaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsIGVtYWlsLCBlbWFpbExpbmspO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlIHVzZWQgdG8gdmVyaWZ5IHRoZSBsaW5rLlxyXG4gICAgICogQHBhcmFtIGVtYWlsIC0gRW1haWwgYWRkcmVzcy5cclxuICAgICAqIEBwYXJhbSBlbWFpbExpbmsgLSBTaWduLWluIGVtYWlsIGxpbmsuXHJcbiAgICAgKiBAcmV0dXJucyAtIFRoZSBhdXRoIHByb3ZpZGVyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsV2l0aExpbmsoZW1haWwsIGVtYWlsTGluaykge1xyXG4gICAgICAgIGNvbnN0IGFjdGlvbkNvZGVVcmwgPSBBY3Rpb25Db2RlVVJMLnBhcnNlTGluayhlbWFpbExpbmspO1xyXG4gICAgICAgIF9hc3NlcnQoYWN0aW9uQ29kZVVybCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIHJldHVybiBFbWFpbEF1dGhDcmVkZW50aWFsLl9mcm9tRW1haWxBbmRDb2RlKGVtYWlsLCBhY3Rpb25Db2RlVXJsLmNvZGUsIGFjdGlvbkNvZGVVcmwudGVuYW50SWQpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5QQVNTV09SRCwgZXZlbiBmb3IgZW1haWwgbGluay5cclxuICovXHJcbkVtYWlsQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gXCJwYXNzd29yZFwiIC8qIFByb3ZpZGVySWQuUEFTU1dPUkQgKi87XHJcbi8qKlxyXG4gKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JELlxyXG4gKi9cclxuRW1haWxBdXRoUHJvdmlkZXIuRU1BSUxfUEFTU1dPUkRfU0lHTl9JTl9NRVRIT0QgPSBcInBhc3N3b3JkXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovO1xyXG4vKipcclxuICogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9MSU5LLlxyXG4gKi9cclxuRW1haWxBdXRoUHJvdmlkZXIuRU1BSUxfTElOS19TSUdOX0lOX01FVEhPRCA9IFwiZW1haWxMaW5rXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi87XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaGUgYmFzZSBjbGFzcyBmb3IgYWxsIEZlZGVyYXRlZCBwcm92aWRlcnMgKE9BdXRoIChpbmNsdWRpbmcgT0lEQyksIFNBTUwpLlxyXG4gKlxyXG4gKiBUaGlzIGNsYXNzIGlzIG5vdCBtZWFudCB0byBiZSBpbnN0YW50aWF0ZWQgZGlyZWN0bHkuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIEZlZGVyYXRlZEF1dGhQcm92aWRlciB7XHJcbiAgICAvKipcclxuICAgICAqIENvbnN0cnVjdG9yIGZvciBnZW5lcmljIE9BdXRoIHByb3ZpZGVycy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcHJvdmlkZXJJZCAtIFByb3ZpZGVyIGZvciB3aGljaCBjcmVkZW50aWFscyBzaG91bGQgYmUgZ2VuZXJhdGVkLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm92aWRlcklkKSB7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDtcclxuICAgICAgICAvKiogQGludGVybmFsICovXHJcbiAgICAgICAgdGhpcy5kZWZhdWx0TGFuZ3VhZ2VDb2RlID0gbnVsbDtcclxuICAgICAgICAvKiogQGludGVybmFsICovXHJcbiAgICAgICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJzID0ge307XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNldCB0aGUgbGFuZ3VhZ2UgZ29kZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2VDb2RlIC0gbGFuZ3VhZ2UgY29kZVxyXG4gICAgICovXHJcbiAgICBzZXREZWZhdWx0TGFuZ3VhZ2UobGFuZ3VhZ2VDb2RlKSB7XHJcbiAgICAgICAgdGhpcy5kZWZhdWx0TGFuZ3VhZ2VDb2RlID0gbGFuZ3VhZ2VDb2RlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIHRoZSBPQXV0aCBjdXN0b20gcGFyYW1ldGVycyB0byBwYXNzIGluIGFuIE9BdXRoIHJlcXVlc3QgZm9yIHBvcHVwIGFuZCByZWRpcmVjdCBzaWduLWluXHJcbiAgICAgKiBvcGVyYXRpb25zLlxyXG4gICAgICpcclxuICAgICAqIEByZW1hcmtzXHJcbiAgICAgKiBGb3IgYSBkZXRhaWxlZCBsaXN0LCBjaGVjayB0aGUgcmVzZXJ2ZWQgcmVxdWlyZWQgT0F1dGggMi4wIHBhcmFtZXRlcnMgc3VjaCBhcyBgY2xpZW50X2lkYCxcclxuICAgICAqIGByZWRpcmVjdF91cmlgLCBgc2NvcGVgLCBgcmVzcG9uc2VfdHlwZWAsIGFuZCBgc3RhdGVgIGFyZSBub3QgYWxsb3dlZCBhbmQgd2lsbCBiZSBpZ25vcmVkLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjdXN0b21PQXV0aFBhcmFtZXRlcnMgLSBUaGUgY3VzdG9tIE9BdXRoIHBhcmFtZXRlcnMgdG8gcGFzcyBpbiB0aGUgT0F1dGggcmVxdWVzdC5cclxuICAgICAqL1xyXG4gICAgc2V0Q3VzdG9tUGFyYW1ldGVycyhjdXN0b21PQXV0aFBhcmFtZXRlcnMpIHtcclxuICAgICAgICB0aGlzLmN1c3RvbVBhcmFtZXRlcnMgPSBjdXN0b21PQXV0aFBhcmFtZXRlcnM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJldHJpZXZlIHRoZSBjdXJyZW50IGxpc3Qgb2Yge0BsaW5rIEN1c3RvbVBhcmFtZXRlcnN9LlxyXG4gICAgICovXHJcbiAgICBnZXRDdXN0b21QYXJhbWV0ZXJzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1c3RvbVBhcmFtZXRlcnM7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIENvbW1vbiBjb2RlIHRvIGFsbCBPQXV0aCBwcm92aWRlcnMuIFRoaXMgaXMgc2VwYXJhdGUgZnJvbSB0aGVcclxuICoge0BsaW5rIE9BdXRoUHJvdmlkZXJ9IHNvIHRoYXQgY2hpbGQgcHJvdmlkZXJzIChsaWtlXHJcbiAqIHtAbGluayBHb29nbGVBdXRoUHJvdmlkZXJ9KSBkb24ndCBpbmhlcml0IHRoZSBgY3JlZGVudGlhbGAgaW5zdGFuY2UgbWV0aG9kLlxyXG4gKiBJbnN0ZWFkLCB0aGV5IHJlbHkgb24gYSBzdGF0aWMgYGNyZWRlbnRpYWxgIG1ldGhvZC5cclxuICovXHJcbmNsYXNzIEJhc2VPQXV0aFByb3ZpZGVyIGV4dGVuZHMgRmVkZXJhdGVkQXV0aFByb3ZpZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgICAgIHRoaXMuc2NvcGVzID0gW107XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFkZCBhbiBPQXV0aCBzY29wZSB0byB0aGUgY3JlZGVudGlhbC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc2NvcGUgLSBQcm92aWRlciBPQXV0aCBzY29wZSB0byBhZGQuXHJcbiAgICAgKi9cclxuICAgIGFkZFNjb3BlKHNjb3BlKSB7XHJcbiAgICAgICAgLy8gSWYgbm90IGFscmVhZHkgYWRkZWQsIGFkZCBzY29wZSB0byBsaXN0LlxyXG4gICAgICAgIGlmICghdGhpcy5zY29wZXMuaW5jbHVkZXMoc2NvcGUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NvcGVzLnB1c2goc2NvcGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgbGlzdCBvZiBPQXV0aCBzY29wZXMuXHJcbiAgICAgKi9cclxuICAgIGdldFNjb3BlcygpIHtcclxuICAgICAgICByZXR1cm4gWy4uLnRoaXMuc2NvcGVzXTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgZ2VuZXJpYyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IE9BdXRoUHJvdmlkZXIoJ2dvb2dsZS5jb20nKTtcclxuICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLlxyXG4gKiBwcm92aWRlci5hZGRTY29wZSgncHJvZmlsZScpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTtcclxuICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTtcclxuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXHJcbiAqXHJcbiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHRcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XHJcbiAqIGlmIChyZXN1bHQpIHtcclxuICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlclxyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIE9BdXRoIEFjY2VzcyBUb2tlbiBmb3IgdGhlIHByb3ZpZGVyLlxyXG4gKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBwcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChhdXRoLCByZXN1bHQpO1xyXG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogfVxyXG4gKiBgYGBcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IE9BdXRoUHJvdmlkZXIoJ2dvb2dsZS5jb20nKTtcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3Byb2ZpbGUnKTtcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ2VtYWlsJyk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XHJcbiAqXHJcbiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLlxyXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqIC8vIFRoaXMgZ2l2ZXMgeW91IGEgT0F1dGggQWNjZXNzIFRva2VuIGZvciB0aGUgcHJvdmlkZXIuXHJcbiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBwcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChhdXRoLCByZXN1bHQpO1xyXG4gKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqIGBgYFxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBPQXV0aFByb3ZpZGVyIGV4dGVuZHMgQmFzZU9BdXRoUHJvdmlkZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGFuIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSBKU09OIHN0cmluZyBvciBhIHBsYWluIG9iamVjdC5cclxuICAgICAqIEBwYXJhbSBqc29uIC0gQSBwbGFpbiBvYmplY3Qgb3IgYSBKU09OIHN0cmluZ1xyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21KU09OKGpzb24pIHtcclxuICAgICAgICBjb25zdCBvYmogPSB0eXBlb2YganNvbiA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGpzb24pIDoganNvbjtcclxuICAgICAgICBfYXNzZXJ0KCdwcm92aWRlcklkJyBpbiBvYmogJiYgJ3NpZ25Jbk1ldGhvZCcgaW4gb2JqLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyhvYmopO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIGdlbmVyaWMgT0F1dGggcHJvdmlkZXIncyBhY2Nlc3MgdG9rZW4gb3IgSUQgdG9rZW4uXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIFRoZSByYXcgbm9uY2UgaXMgcmVxdWlyZWQgd2hlbiBhbiBJRCB0b2tlbiB3aXRoIGEgbm9uY2UgZmllbGQgaXMgcHJvdmlkZWQuIFRoZSBTSEEtMjU2IGhhc2ggb2ZcclxuICAgICAqIHRoZSByYXcgbm9uY2UgbXVzdCBtYXRjaCB0aGUgbm9uY2UgZmllbGQgaW4gdGhlIElEIHRva2VuLlxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiAvLyBgZ29vZ2xlVXNlcmAgZnJvbSB0aGUgb25zdWNjZXNzIEdvb2dsZSBTaWduIEluIGNhbGxiYWNrLlxyXG4gICAgICogLy8gSW5pdGlhbGl6ZSBhIGdlbmVyYXRlIE9BdXRoIHByb3ZpZGVyIHdpdGggYSBgZ29vZ2xlLmNvbWAgcHJvdmlkZXJJZC5cclxuICAgICAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IE9BdXRoUHJvdmlkZXIoJ2dvb2dsZS5jb20nKTtcclxuICAgICAqIGNvbnN0IGNyZWRlbnRpYWwgPSBwcm92aWRlci5jcmVkZW50aWFsKHtcclxuICAgICAqICAgaWRUb2tlbjogZ29vZ2xlVXNlci5nZXRBdXRoUmVzcG9uc2UoKS5pZF90b2tlbixcclxuICAgICAqIH0pO1xyXG4gICAgICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoY3JlZGVudGlhbCk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcGFyYW1zIC0gRWl0aGVyIHRoZSBvcHRpb25zIG9iamVjdCBjb250YWluaW5nIHRoZSBJRCB0b2tlbiwgYWNjZXNzIHRva2VuIGFuZCByYXcgbm9uY2VcclxuICAgICAqIG9yIHRoZSBJRCB0b2tlbiBzdHJpbmcuXHJcbiAgICAgKi9cclxuICAgIGNyZWRlbnRpYWwocGFyYW1zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NyZWRlbnRpYWwoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBwYXJhbXMpLCB7IG5vbmNlOiBwYXJhbXMucmF3Tm9uY2UgfSkpO1xyXG4gICAgfVxyXG4gICAgLyoqIEFuIGludGVybmFsIGNyZWRlbnRpYWwgbWV0aG9kIHRoYXQgYWNjZXB0cyBtb3JlIHBlcm1pc3NpdmUgb3B0aW9ucyAqL1xyXG4gICAgX2NyZWRlbnRpYWwocGFyYW1zKSB7XHJcbiAgICAgICAgX2Fzc2VydChwYXJhbXMuaWRUb2tlbiB8fCBwYXJhbXMuYWNjZXNzVG9rZW4sIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICAvLyBGb3IgT0F1dGhDcmVkZW50aWFsLCBzaWduIGluIG1ldGhvZCBpcyBzYW1lIGFzIHByb3ZpZGVySWQuXHJcbiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcyksIHsgcHJvdmlkZXJJZDogdGhpcy5wcm92aWRlcklkLCBzaWduSW5NZXRob2Q6IHRoaXMucHJvdmlkZXJJZCB9KSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHtcclxuICAgICAgICByZXR1cm4gT0F1dGhQcm92aWRlci5vYXV0aENyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcclxuICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gT0F1dGhQcm92aWRlci5vYXV0aENyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgb2F1dGhDcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgb2F1dGhJZFRva2VuLCBvYXV0aEFjY2Vzc1Rva2VuLCBvYXV0aFRva2VuU2VjcmV0LCBwZW5kaW5nVG9rZW4sIG5vbmNlLCBwcm92aWRlcklkIH0gPSB0b2tlblJlc3BvbnNlO1xyXG4gICAgICAgIGlmICghb2F1dGhBY2Nlc3NUb2tlbiAmJlxyXG4gICAgICAgICAgICAhb2F1dGhUb2tlblNlY3JldCAmJlxyXG4gICAgICAgICAgICAhb2F1dGhJZFRva2VuICYmXHJcbiAgICAgICAgICAgICFwZW5kaW5nVG9rZW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghcHJvdmlkZXJJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBPQXV0aFByb3ZpZGVyKHByb3ZpZGVySWQpLl9jcmVkZW50aWFsKHtcclxuICAgICAgICAgICAgICAgIGlkVG9rZW46IG9hdXRoSWRUb2tlbixcclxuICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBvYXV0aEFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICAgICAgbm9uY2UsXHJcbiAgICAgICAgICAgICAgICBwZW5kaW5nVG9rZW5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5GQUNFQk9PSy5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci5cclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3VzZXJfYmlydGhkYXknKTtcclxuICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTtcclxuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXHJcbiAqXHJcbiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHRcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XHJcbiAqIGlmIChyZXN1bHQpIHtcclxuICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlclxyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIEZhY2Vib29rIEFjY2VzcyBUb2tlbi5cclxuICogICBjb25zdCBjcmVkZW50aWFsID0gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTtcclxuICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqIH1cclxuICogYGBgXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgndXNlcl9iaXJ0aGRheScpO1xyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgcHJvdmlkZXIpO1xyXG4gKlxyXG4gKiAvLyBUaGUgc2lnbmVkLWluIHVzZXIgaW5mby5cclxuICogY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xyXG4gKiAvLyBUaGlzIGdpdmVzIHlvdSBhIEZhY2Vib29rIEFjY2VzcyBUb2tlbi5cclxuICogY29uc3QgY3JlZGVudGlhbCA9IEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XHJcbiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIEZhY2Vib29rQXV0aFByb3ZpZGVyIGV4dGVuZHMgQmFzZU9BdXRoUHJvdmlkZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoXCJmYWNlYm9vay5jb21cIiAvKiBQcm92aWRlcklkLkZBQ0VCT09LICovKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIGNyZWRlbnRpYWwgZm9yIEZhY2Vib29rLlxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiAvLyBgZXZlbnRgIGZyb20gdGhlIEZhY2Vib29rIGF1dGguYXV0aFJlc3BvbnNlQ2hhbmdlIGNhbGxiYWNrLlxyXG4gICAgICogY29uc3QgY3JlZGVudGlhbCA9IEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZXZlbnQuYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuKTtcclxuICAgICAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGNyZWRlbnRpYWwpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gRmFjZWJvb2sgYWNjZXNzIHRva2VuLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbChhY2Nlc3NUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoe1xyXG4gICAgICAgICAgICBwcm92aWRlcklkOiBGYWNlYm9va0F1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcclxuICAgICAgICAgICAgc2lnbkluTWV0aG9kOiBGYWNlYm9va0F1dGhQcm92aWRlci5GQUNFQk9PS19TSUdOX0lOX01FVEhPRCxcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW5cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh1c2VyQ3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIEF1dGhFcnJvcn0gd2hpY2ggd2FzXHJcbiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7XHJcbiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlIHx8ICEoJ29hdXRoQWNjZXNzVG9rZW4nIGluIHRva2VuUmVzcG9uc2UpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2Uub2F1dGhBY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodG9rZW5SZXNwb25zZS5vYXV0aEFjY2Vzc1Rva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5GQUNFQk9PSy4gKi9cclxuRmFjZWJvb2tBdXRoUHJvdmlkZXIuRkFDRUJPT0tfU0lHTl9JTl9NRVRIT0QgPSBcImZhY2Vib29rLmNvbVwiIC8qIFNpZ25Jbk1ldGhvZC5GQUNFQk9PSyAqLztcclxuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LkZBQ0VCT09LLiAqL1xyXG5GYWNlYm9va0F1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9IFwiZmFjZWJvb2suY29tXCIgLyogUHJvdmlkZXJJZC5GQUNFQk9PSyAqLztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIGFuIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZvciB7QGxpbmsgUHJvdmlkZXJJZH0uR09PR0xFLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgR29vZ2xlQXV0aFByb3ZpZGVyKCk7XHJcbiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci5cclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3Byb2ZpbGUnKTtcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ2VtYWlsJyk7XHJcbiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7XHJcbiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcFxyXG4gKlxyXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpO1xyXG4gKiBpZiAocmVzdWx0KSB7XHJcbiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXJcclxuICogICBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBHb29nbGUgQWNjZXNzIFRva2VuLlxyXG4gKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBHb29nbGVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTtcclxuICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqIH1cclxuICogYGBgXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBHb29nbGVBdXRoUHJvdmlkZXIoKTtcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3Byb2ZpbGUnKTtcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ2VtYWlsJyk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XHJcbiAqXHJcbiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLlxyXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqIC8vIFRoaXMgZ2l2ZXMgeW91IGEgR29vZ2xlIEFjY2VzcyBUb2tlbi5cclxuICogY29uc3QgY3JlZGVudGlhbCA9IEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xyXG4gKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBHb29nbGVBdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcihcImdvb2dsZS5jb21cIiAvKiBQcm92aWRlcklkLkdPT0dMRSAqLyk7XHJcbiAgICAgICAgdGhpcy5hZGRTY29wZSgncHJvZmlsZScpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgR29vZ2xlLiBBdCBsZWFzdCBvbmUgb2YgSUQgdG9rZW4gYW5kIGFjY2VzcyB0b2tlbiBpcyByZXF1aXJlZC5cclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogLy8gXFxgZ29vZ2xlVXNlclxcYCBmcm9tIHRoZSBvbnN1Y2Nlc3MgR29vZ2xlIFNpZ24gSW4gY2FsbGJhY2suXHJcbiAgICAgKiBjb25zdCBjcmVkZW50aWFsID0gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZ29vZ2xlVXNlci5nZXRBdXRoUmVzcG9uc2UoKS5pZF90b2tlbik7XHJcbiAgICAgKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChjcmVkZW50aWFsKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZFRva2VuIC0gR29vZ2xlIElEIHRva2VuLlxyXG4gICAgICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gR29vZ2xlIGFjY2VzcyB0b2tlbi5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWwoaWRUb2tlbiwgYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKHtcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogR29vZ2xlQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lELFxyXG4gICAgICAgICAgICBzaWduSW5NZXRob2Q6IEdvb2dsZUF1dGhQcm92aWRlci5HT09HTEVfU0lHTl9JTl9NRVRIT0QsXHJcbiAgICAgICAgICAgIGlkVG9rZW4sXHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHtcclxuICAgICAgICByZXR1cm4gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcclxuICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7XHJcbiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IG9hdXRoSWRUb2tlbiwgb2F1dGhBY2Nlc3NUb2tlbiB9ID0gdG9rZW5SZXNwb25zZTtcclxuICAgICAgICBpZiAoIW9hdXRoSWRUb2tlbiAmJiAhb2F1dGhBY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIGFuIG9hdXRoIDEgY3JlZGVudGlhbCBvciBhIHBob25lIGNyZWRlbnRpYWxcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiBHb29nbGVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChvYXV0aElkVG9rZW4sIG9hdXRoQWNjZXNzVG9rZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkdPT0dMRS4gKi9cclxuR29vZ2xlQXV0aFByb3ZpZGVyLkdPT0dMRV9TSUdOX0lOX01FVEhPRCA9IFwiZ29vZ2xlLmNvbVwiIC8qIFNpZ25Jbk1ldGhvZC5HT09HTEUgKi87XHJcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5HT09HTEUuICovXHJcbkdvb2dsZUF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9IFwiZ29vZ2xlLmNvbVwiIC8qIFByb3ZpZGVySWQuR09PR0xFICovO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5HSVRIVUIuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIEdpdEh1YiByZXF1aXJlcyBhbiBPQXV0aCAyLjAgcmVkaXJlY3QsIHNvIHlvdSBjYW4gZWl0aGVyIGhhbmRsZSB0aGUgcmVkaXJlY3QgZGlyZWN0bHksIG9yIHVzZVxyXG4gKiB0aGUge0BsaW5rIHNpZ25JbldpdGhQb3B1cH0gaGFuZGxlcjpcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEdpdGh1YkF1dGhQcm92aWRlcigpO1xyXG4gKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuXHJcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdyZXBvJyk7XHJcbiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7XHJcbiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcFxyXG4gKlxyXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpO1xyXG4gKiBpZiAocmVzdWx0KSB7XHJcbiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXJcclxuICogICBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBHaXRIdWIgQWNjZXNzIFRva2VuLlxyXG4gKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTtcclxuICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqIH1cclxuICogYGBgXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBHaXRodWJBdXRoUHJvdmlkZXIoKTtcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3JlcG8nKTtcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBvcHVwKGF1dGgsIHByb3ZpZGVyKTtcclxuICpcclxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXHJcbiAqIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogLy8gVGhpcyBnaXZlcyB5b3UgYSBHaXRIdWIgQWNjZXNzIFRva2VuLlxyXG4gKiBjb25zdCBjcmVkZW50aWFsID0gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XHJcbiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogYGBgXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIEdpdGh1YkF1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKFwiZ2l0aHViLmNvbVwiIC8qIFByb3ZpZGVySWQuR0lUSFVCICovKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIGNyZWRlbnRpYWwgZm9yIEdpdEh1Yi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYWNjZXNzVG9rZW4gLSBHaXRIdWIgYWNjZXNzIHRva2VuLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbChhY2Nlc3NUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoe1xyXG4gICAgICAgICAgICBwcm92aWRlcklkOiBHaXRodWJBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQsXHJcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogR2l0aHViQXV0aFByb3ZpZGVyLkdJVEhVQl9TSUdOX0lOX01FVEhPRCxcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW5cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QodXNlckNyZWRlbnRpYWwpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBBdXRoRXJyb3J9IHdoaWNoIHdhc1xyXG4gICAgICogdGhyb3duIGR1cmluZyBhIHNpZ24taW4sIGxpbmssIG9yIHJlYXV0aGVudGljYXRlIG9wZXJhdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UgfHwgISgnb2F1dGhBY2Nlc3NUb2tlbicgaW4gdG9rZW5SZXNwb25zZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZS5vYXV0aEFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodG9rZW5SZXNwb25zZS5vYXV0aEFjY2Vzc1Rva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5HSVRIVUIuICovXHJcbkdpdGh1YkF1dGhQcm92aWRlci5HSVRIVUJfU0lHTl9JTl9NRVRIT0QgPSBcImdpdGh1Yi5jb21cIiAvKiBTaWduSW5NZXRob2QuR0lUSFVCICovO1xyXG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgUHJvdmlkZXJJZH0uR0lUSFVCLiAqL1xyXG5HaXRodWJBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQgPSBcImdpdGh1Yi5jb21cIiAvKiBQcm92aWRlcklkLkdJVEhVQiAqLztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgSURQX1JFUVVFU1RfVVJJID0gJ2h0dHA6Ly9sb2NhbGhvc3QnO1xyXG4vKipcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgU0FNTEF1dGhDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwge1xyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgY29uc3RydWN0b3IocHJvdmlkZXJJZCwgcGVuZGluZ1Rva2VuKSB7XHJcbiAgICAgICAgc3VwZXIocHJvdmlkZXJJZCwgcHJvdmlkZXJJZCk7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nVG9rZW4gPSBwZW5kaW5nVG9rZW47XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTtcclxuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTtcclxuICAgICAgICByZXF1ZXN0LmlkVG9rZW4gPSBpZFRva2VuO1xyXG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKSB7XHJcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7XHJcbiAgICAgICAgcmVxdWVzdC5hdXRvQ3JlYXRlID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7XHJcbiAgICB9XHJcbiAgICAvKioge0Bpbmhlcml0ZG9jIEF1dGhDcmVkZW50aWFsLnRvSlNPTn0gICovXHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2lnbkluTWV0aG9kOiB0aGlzLnNpZ25Jbk1ldGhvZCxcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogdGhpcy5wcm92aWRlcklkLFxyXG4gICAgICAgICAgICBwZW5kaW5nVG9rZW46IHRoaXMucGVuZGluZ1Rva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU3RhdGljIG1ldGhvZCB0byBkZXNlcmlhbGl6ZSBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYW4gb2JqZWN0IGludG8gYW5cclxuICAgICAqIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBqc29uIC0gSW5wdXQgY2FuIGJlIGVpdGhlciBPYmplY3Qgb3IgdGhlIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuXHJcbiAgICAgKiBXaGVuIHN0cmluZyBpcyBwcm92aWRlZCwgSlNPTi5wYXJzZSB3b3VsZCBiZSBjYWxsZWQgZmlyc3QuXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMgSWYgdGhlIEpTT04gaW5wdXQgZG9lcyBub3QgcmVwcmVzZW50IGFuIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZnJvbUpTT04oanNvbikge1xyXG4gICAgICAgIGNvbnN0IG9iaiA9IHR5cGVvZiBqc29uID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2UoanNvbikgOiBqc29uO1xyXG4gICAgICAgIGNvbnN0IHsgcHJvdmlkZXJJZCwgc2lnbkluTWV0aG9kLCBwZW5kaW5nVG9rZW4gfSA9IG9iajtcclxuICAgICAgICBpZiAoIXByb3ZpZGVySWQgfHxcclxuICAgICAgICAgICAgIXNpZ25Jbk1ldGhvZCB8fFxyXG4gICAgICAgICAgICAhcGVuZGluZ1Rva2VuIHx8XHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQgIT09IHNpZ25Jbk1ldGhvZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTQU1MQXV0aENyZWRlbnRpYWwocHJvdmlkZXJJZCwgcGVuZGluZ1Rva2VuKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSGVscGVyIHN0YXRpYyBtZXRob2QgdG8gYXZvaWQgZXhwb3NpbmcgdGhlIGNvbnN0cnVjdG9yIHRvIGVuZCB1c2Vycy5cclxuICAgICAqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgc3RhdGljIF9jcmVhdGUocHJvdmlkZXJJZCwgcGVuZGluZ1Rva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTQU1MQXV0aENyZWRlbnRpYWwocHJvdmlkZXJJZCwgcGVuZGluZ1Rva2VuKTtcclxuICAgIH1cclxuICAgIGJ1aWxkUmVxdWVzdCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0VXJpOiBJRFBfUkVRVUVTVF9VUkksXHJcbiAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxyXG4gICAgICAgICAgICBwZW5kaW5nVG9rZW46IHRoaXMucGVuZGluZ1Rva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBTQU1MX1BST1ZJREVSX1BSRUZJWCA9ICdzYW1sLic7XHJcbi8qKlxyXG4gKiBBbiB7QGxpbmsgQXV0aFByb3ZpZGVyfSBmb3IgU0FNTC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgU0FNTEF1dGhQcm92aWRlciBleHRlbmRzIEZlZGVyYXRlZEF1dGhQcm92aWRlciB7XHJcbiAgICAvKipcclxuICAgICAqIENvbnN0cnVjdG9yLiBUaGUgcHJvdmlkZXJJZCBtdXN0IHN0YXJ0IHdpdGggXCJzYW1sLlwiXHJcbiAgICAgKiBAcGFyYW0gcHJvdmlkZXJJZCAtIFNBTUwgcHJvdmlkZXIgSUQuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHByb3ZpZGVySWQpIHtcclxuICAgICAgICBfYXNzZXJ0KHByb3ZpZGVySWQuc3RhcnRzV2l0aChTQU1MX1BST1ZJREVSX1BSRUZJWCksIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICBzdXBlcihwcm92aWRlcklkKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2VuZXJhdGVzIGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0gYWZ0ZXIgYVxyXG4gICAgICogc3VjY2Vzc2Z1bCBTQU1MIGZsb3cgY29tcGxldGVzLlxyXG4gICAgICpcclxuICAgICAqIEByZW1hcmtzXHJcbiAgICAgKlxyXG4gICAgICogRm9yIGV4YW1wbGUsIHRvIGdldCBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9LCB5b3UgY291bGQgd3JpdGUgdGhlXHJcbiAgICAgKiBmb2xsb3dpbmcgY29kZTpcclxuICAgICAqXHJcbiAgICAgKiBgYGBqc1xyXG4gICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgc2FtbFByb3ZpZGVyKTtcclxuICAgICAqIGNvbnN0IGNyZWRlbnRpYWwgPSBTQU1MQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBTQU1MQXV0aFByb3ZpZGVyLnNhbWxDcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh1c2VyQ3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIEF1dGhFcnJvcn0gd2hpY2ggd2FzXHJcbiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFNBTUxBdXRoUHJvdmlkZXIuc2FtbENyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSBmcm9tIGEgSlNPTiBzdHJpbmcgb3IgYSBwbGFpbiBvYmplY3QuXHJcbiAgICAgKiBAcGFyYW0ganNvbiAtIEEgcGxhaW4gb2JqZWN0IG9yIGEgSlNPTiBzdHJpbmdcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tSlNPTihqc29uKSB7XHJcbiAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IFNBTUxBdXRoQ3JlZGVudGlhbC5mcm9tSlNPTihqc29uKTtcclxuICAgICAgICBfYXNzZXJ0KGNyZWRlbnRpYWwsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gY3JlZGVudGlhbDtcclxuICAgIH1cclxuICAgIHN0YXRpYyBzYW1sQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7XHJcbiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IHBlbmRpbmdUb2tlbiwgcHJvdmlkZXJJZCB9ID0gdG9rZW5SZXNwb25zZTtcclxuICAgICAgICBpZiAoIXBlbmRpbmdUb2tlbiB8fCAhcHJvdmlkZXJJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIFNBTUxBdXRoQ3JlZGVudGlhbC5fY3JlYXRlKHByb3ZpZGVySWQsIHBlbmRpbmdUb2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5UV0lUVEVSLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgVHdpdHRlckF1dGhQcm92aWRlcigpO1xyXG4gKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuXHJcbiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7XHJcbiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcFxyXG4gKlxyXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpO1xyXG4gKiBpZiAocmVzdWx0KSB7XHJcbiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXJcclxuICogICBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBUd2l0dGVyIEFjY2VzcyBUb2tlbiBhbmQgU2VjcmV0LlxyXG4gKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XHJcbiAqICAgY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xyXG4gKiAgIGNvbnN0IHNlY3JldCA9IGNyZWRlbnRpYWwuc2VjcmV0O1xyXG4gKiB9XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSBwb3B1cC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgVHdpdHRlckF1dGhQcm92aWRlcigpO1xyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgcHJvdmlkZXIpO1xyXG4gKlxyXG4gKiAvLyBUaGUgc2lnbmVkLWluIHVzZXIgaW5mby5cclxuICogY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xyXG4gKiAvLyBUaGlzIGdpdmVzIHlvdSBhIFR3aXR0ZXIgQWNjZXNzIFRva2VuIGFuZCBTZWNyZXQuXHJcbiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XHJcbiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogY29uc3Qgc2VjcmV0ID0gY3JlZGVudGlhbC5zZWNyZXQ7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBUd2l0dGVyQXV0aFByb3ZpZGVyIGV4dGVuZHMgQmFzZU9BdXRoUHJvdmlkZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoXCJ0d2l0dGVyLmNvbVwiIC8qIFByb3ZpZGVySWQuVFdJVFRFUiAqLyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIGZvciBUd2l0dGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0b2tlbiAtIFR3aXR0ZXIgYWNjZXNzIHRva2VuLlxyXG4gICAgICogQHBhcmFtIHNlY3JldCAtIFR3aXR0ZXIgc2VjcmV0LlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbCh0b2tlbiwgc2VjcmV0KSB7XHJcbiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyh7XHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IFR3aXR0ZXJBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQsXHJcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogVHdpdHRlckF1dGhQcm92aWRlci5UV0lUVEVSX1NJR05fSU5fTUVUSE9ELFxyXG4gICAgICAgICAgICBvYXV0aFRva2VuOiB0b2tlbixcclxuICAgICAgICAgICAgb2F1dGhUb2tlblNlY3JldDogc2VjcmV0XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHtcclxuICAgICAgICByZXR1cm4gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh1c2VyQ3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIEF1dGhFcnJvcn0gd2hpY2ggd2FzXHJcbiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFR3aXR0ZXJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgb2F1dGhBY2Nlc3NUb2tlbiwgb2F1dGhUb2tlblNlY3JldCB9ID0gdG9rZW5SZXNwb25zZTtcclxuICAgICAgICBpZiAoIW9hdXRoQWNjZXNzVG9rZW4gfHwgIW9hdXRoVG9rZW5TZWNyZXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwob2F1dGhBY2Nlc3NUb2tlbiwgb2F1dGhUb2tlblNlY3JldCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uVFdJVFRFUi4gKi9cclxuVHdpdHRlckF1dGhQcm92aWRlci5UV0lUVEVSX1NJR05fSU5fTUVUSE9EID0gXCJ0d2l0dGVyLmNvbVwiIC8qIFNpZ25Jbk1ldGhvZC5UV0lUVEVSICovO1xyXG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgUHJvdmlkZXJJZH0uVFdJVFRFUi4gKi9cclxuVHdpdHRlckF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9IFwidHdpdHRlci5jb21cIiAvKiBQcm92aWRlcklkLlRXSVRURVIgKi87XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25VcChhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnblVwXCIgLyogRW5kcG9pbnQuU0lHTl9VUCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBVc2VyQ3JlZGVudGlhbEltcGwge1xyXG4gICAgY29uc3RydWN0b3IocGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy51c2VyID0gcGFyYW1zLnVzZXI7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcGFyYW1zLnByb3ZpZGVySWQ7XHJcbiAgICAgICAgdGhpcy5fdG9rZW5SZXNwb25zZSA9IHBhcmFtcy5fdG9rZW5SZXNwb25zZTtcclxuICAgICAgICB0aGlzLm9wZXJhdGlvblR5cGUgPSBwYXJhbXMub3BlcmF0aW9uVHlwZTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBfZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoLCBvcGVyYXRpb25UeXBlLCBpZFRva2VuUmVzcG9uc2UsIGlzQW5vbnltb3VzID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlckltcGwuX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyk7XHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXJJZCA9IHByb3ZpZGVySWRGb3JSZXNwb25zZShpZFRva2VuUmVzcG9uc2UpO1xyXG4gICAgICAgIGNvbnN0IHVzZXJDcmVkID0gbmV3IFVzZXJDcmVkZW50aWFsSW1wbCh7XHJcbiAgICAgICAgICAgIHVzZXIsXHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQsXHJcbiAgICAgICAgICAgIF90b2tlblJlc3BvbnNlOiBpZFRva2VuUmVzcG9uc2UsXHJcbiAgICAgICAgICAgIG9wZXJhdGlvblR5cGVcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdXNlckNyZWQ7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgYXN5bmMgX2Zvck9wZXJhdGlvbih1c2VyLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSkge1xyXG4gICAgICAgIGF3YWl0IHVzZXIuX3VwZGF0ZVRva2Vuc0lmTmVjZXNzYXJ5KHJlc3BvbnNlLCAvKiByZWxvYWQgKi8gdHJ1ZSk7XHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXJJZCA9IHByb3ZpZGVySWRGb3JSZXNwb25zZShyZXNwb25zZSk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBVc2VyQ3JlZGVudGlhbEltcGwoe1xyXG4gICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgICAgICBwcm92aWRlcklkLFxyXG4gICAgICAgICAgICBfdG9rZW5SZXNwb25zZTogcmVzcG9uc2UsXHJcbiAgICAgICAgICAgIG9wZXJhdGlvblR5cGVcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwcm92aWRlcklkRm9yUmVzcG9uc2UocmVzcG9uc2UpIHtcclxuICAgIGlmIChyZXNwb25zZS5wcm92aWRlcklkKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnByb3ZpZGVySWQ7XHJcbiAgICB9XHJcbiAgICBpZiAoJ3Bob25lTnVtYmVyJyBpbiByZXNwb25zZSkge1xyXG4gICAgICAgIHJldHVybiBcInBob25lXCIgLyogUHJvdmlkZXJJZC5QSE9ORSAqLztcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBBc3luY2hyb25vdXNseSBzaWducyBpbiBhcyBhbiBhbm9ueW1vdXMgdXNlci5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSWYgdGhlcmUgaXMgYWxyZWFkeSBhbiBhbm9ueW1vdXMgdXNlciBzaWduZWQgaW4sIHRoYXQgdXNlciB3aWxsIGJlIHJldHVybmVkOyBvdGhlcndpc2UsIGFcclxuICogbmV3IGFub255bW91cyB1c2VyIGlkZW50aXR5IHdpbGwgYmUgY3JlYXRlZCBhbmQgcmV0dXJuZWQuXHJcbiAqXHJcbiAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgYnkge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYVxyXG4gKiB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZVNlcnZlckFwcH0uXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluQW5vbnltb3VzbHkoYXV0aCkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKGF1dGguYXBwKSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvcihhdXRoKSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XHJcbiAgICBhd2FpdCBhdXRoSW50ZXJuYWwuX2luaXRpYWxpemF0aW9uUHJvbWlzZTtcclxuICAgIGlmICgoX2EgPSBhdXRoSW50ZXJuYWwuY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc0Fub255bW91cykge1xyXG4gICAgICAgIC8vIElmIGFuIGFub255bW91cyB1c2VyIGlzIGFscmVhZHkgc2lnbmVkIGluLCBubyBuZWVkIHRvIHNpZ24gdGhlbSBpbiBhZ2Fpbi5cclxuICAgICAgICByZXR1cm4gbmV3IFVzZXJDcmVkZW50aWFsSW1wbCh7XHJcbiAgICAgICAgICAgIHVzZXI6IGF1dGhJbnRlcm5hbC5jdXJyZW50VXNlcixcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogbnVsbCxcclxuICAgICAgICAgICAgb3BlcmF0aW9uVHlwZTogXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi9cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2lnblVwKGF1dGhJbnRlcm5hbCwge1xyXG4gICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGhJbnRlcm5hbCwgXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi8sIHJlc3BvbnNlLCB0cnVlKTtcclxuICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fdXBkYXRlQ3VycmVudFVzZXIodXNlckNyZWRlbnRpYWwudXNlcik7XHJcbiAgICByZXR1cm4gdXNlckNyZWRlbnRpYWw7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgTXVsdGlGYWN0b3JFcnJvciBleHRlbmRzIEZpcmViYXNlRXJyb3Ige1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCwgZXJyb3IsIG9wZXJhdGlvblR5cGUsIHVzZXIpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgc3VwZXIoZXJyb3IuY29kZSwgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25UeXBlID0gb3BlcmF0aW9uVHlwZTtcclxuICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC13aWtpL2Jsb2IvbWFzdGVyL0JyZWFraW5nLUNoYW5nZXMubWQjZXh0ZW5kaW5nLWJ1aWx0LWlucy1saWtlLWVycm9yLWFycmF5LWFuZC1tYXAtbWF5LW5vLWxvbmdlci13b3JrXHJcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIE11bHRpRmFjdG9yRXJyb3IucHJvdG90eXBlKTtcclxuICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSB7XHJcbiAgICAgICAgICAgIGFwcE5hbWU6IGF1dGgubmFtZSxcclxuICAgICAgICAgICAgdGVuYW50SWQ6IChfYSA9IGF1dGgudGVuYW50SWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgX3NlcnZlclJlc3BvbnNlOiBlcnJvci5jdXN0b21EYXRhLl9zZXJ2ZXJSZXNwb25zZSxcclxuICAgICAgICAgICAgb3BlcmF0aW9uVHlwZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgX2Zyb21FcnJvckFuZE9wZXJhdGlvbihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcikge1xyXG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JFcnJvcihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcik7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5KGF1dGgsIG9wZXJhdGlvblR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpIHtcclxuICAgIGNvbnN0IGlkVG9rZW5Qcm92aWRlciA9IG9wZXJhdGlvblR5cGUgPT09IFwicmVhdXRoZW50aWNhdGVcIiAvKiBPcGVyYXRpb25UeXBlLlJFQVVUSEVOVElDQVRFICovXHJcbiAgICAgICAgPyBjcmVkZW50aWFsLl9nZXRSZWF1dGhlbnRpY2F0aW9uUmVzb2x2ZXIoYXV0aClcclxuICAgICAgICA6IGNyZWRlbnRpYWwuX2dldElkVG9rZW5SZXNwb25zZShhdXRoKTtcclxuICAgIHJldHVybiBpZFRva2VuUHJvdmlkZXIuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8ke1wibXVsdGktZmFjdG9yLWF1dGgtcmVxdWlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1GQV9SRVFVSVJFRCAqL31gKSB7XHJcbiAgICAgICAgICAgIHRocm93IE11bHRpRmFjdG9yRXJyb3IuX2Zyb21FcnJvckFuZE9wZXJhdGlvbihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFRha2VzIGEgc2V0IG9mIFVzZXJJbmZvIHByb3ZpZGVyIGRhdGEgYW5kIGNvbnZlcnRzIGl0IHRvIGEgc2V0IG9mIG5hbWVzXHJcbiAqL1xyXG5mdW5jdGlvbiBwcm92aWRlckRhdGFBc05hbWVzKHByb3ZpZGVyRGF0YSkge1xyXG4gICAgcmV0dXJuIG5ldyBTZXQocHJvdmlkZXJEYXRhXHJcbiAgICAgICAgLm1hcCgoeyBwcm92aWRlcklkIH0pID0+IHByb3ZpZGVySWQpXHJcbiAgICAgICAgLmZpbHRlcihwaWQgPT4gISFwaWQpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVW5saW5rcyBhIHByb3ZpZGVyIGZyb20gYSB1c2VyIGFjY291bnQuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwcm92aWRlcklkIC0gVGhlIHByb3ZpZGVyIHRvIHVubGluay5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdW5saW5rKHVzZXIsIHByb3ZpZGVySWQpIHtcclxuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGF3YWl0IF9hc3NlcnRMaW5rZWRTdGF0dXModHJ1ZSwgdXNlckludGVybmFsLCBwcm92aWRlcklkKTtcclxuICAgIGNvbnN0IHsgcHJvdmlkZXJVc2VySW5mbyB9ID0gYXdhaXQgZGVsZXRlTGlua2VkQWNjb3VudHModXNlckludGVybmFsLmF1dGgsIHtcclxuICAgICAgICBpZFRva2VuOiBhd2FpdCB1c2VySW50ZXJuYWwuZ2V0SWRUb2tlbigpLFxyXG4gICAgICAgIGRlbGV0ZVByb3ZpZGVyOiBbcHJvdmlkZXJJZF1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgcHJvdmlkZXJzTGVmdCA9IHByb3ZpZGVyRGF0YUFzTmFtZXMocHJvdmlkZXJVc2VySW5mbyB8fCBbXSk7XHJcbiAgICB1c2VySW50ZXJuYWwucHJvdmlkZXJEYXRhID0gdXNlckludGVybmFsLnByb3ZpZGVyRGF0YS5maWx0ZXIocGQgPT4gcHJvdmlkZXJzTGVmdC5oYXMocGQucHJvdmlkZXJJZCkpO1xyXG4gICAgaWYgKCFwcm92aWRlcnNMZWZ0LmhhcyhcInBob25lXCIgLyogUHJvdmlkZXJJZC5QSE9ORSAqLykpIHtcclxuICAgICAgICB1c2VySW50ZXJuYWwucGhvbmVOdW1iZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgdXNlckludGVybmFsLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHVzZXJJbnRlcm5hbCk7XHJcbiAgICByZXR1cm4gdXNlckludGVybmFsO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9saW5rJDEodXNlciwgY3JlZGVudGlhbCwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlciwgY3JlZGVudGlhbC5fbGlua1RvSWRUb2tlbih1c2VyLmF1dGgsIGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpKSwgYnlwYXNzQXV0aFN0YXRlKTtcclxuICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbih1c2VyLCBcImxpbmtcIiAvKiBPcGVyYXRpb25UeXBlLkxJTksgKi8sIHJlc3BvbnNlKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfYXNzZXJ0TGlua2VkU3RhdHVzKGV4cGVjdGVkLCB1c2VyLCBwcm92aWRlcikge1xyXG4gICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcik7XHJcbiAgICBjb25zdCBwcm92aWRlcklkcyA9IHByb3ZpZGVyRGF0YUFzTmFtZXModXNlci5wcm92aWRlckRhdGEpO1xyXG4gICAgY29uc3QgY29kZSA9IGV4cGVjdGVkID09PSBmYWxzZVxyXG4gICAgICAgID8gXCJwcm92aWRlci1hbHJlYWR5LWxpbmtlZFwiIC8qIEF1dGhFcnJvckNvZGUuUFJPVklERVJfQUxSRUFEWV9MSU5LRUQgKi9cclxuICAgICAgICA6IFwibm8tc3VjaC1wcm92aWRlclwiIC8qIEF1dGhFcnJvckNvZGUuTk9fU1VDSF9QUk9WSURFUiAqLztcclxuICAgIF9hc3NlcnQocHJvdmlkZXJJZHMuaGFzKHByb3ZpZGVyKSA9PT0gZXhwZWN0ZWQsIHVzZXIuYXV0aCwgY29kZSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gX3JlYXV0aGVudGljYXRlKHVzZXIsIGNyZWRlbnRpYWwsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCB7IGF1dGggfSA9IHVzZXI7XHJcbiAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAoYXV0aC5hcHApKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpKTtcclxuICAgIH1cclxuICAgIGNvbnN0IG9wZXJhdGlvblR5cGUgPSBcInJlYXV0aGVudGljYXRlXCIgLyogT3BlcmF0aW9uVHlwZS5SRUFVVEhFTlRJQ0FURSAqLztcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCBfcHJvY2Vzc0NyZWRlbnRpYWxTYXZpbmdNZmFDb250ZXh0SWZOZWNlc3NhcnkoYXV0aCwgb3BlcmF0aW9uVHlwZSwgY3JlZGVudGlhbCwgdXNlciksIGJ5cGFzc0F1dGhTdGF0ZSk7XHJcbiAgICAgICAgX2Fzc2VydChyZXNwb25zZS5pZFRva2VuLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgY29uc3QgcGFyc2VkID0gX3BhcnNlVG9rZW4ocmVzcG9uc2UuaWRUb2tlbik7XHJcbiAgICAgICAgX2Fzc2VydChwYXJzZWQsIGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICBjb25zdCB7IHN1YjogbG9jYWxJZCB9ID0gcGFyc2VkO1xyXG4gICAgICAgIF9hc3NlcnQodXNlci51aWQgPT09IGxvY2FsSWQsIGF1dGgsIFwidXNlci1taXNtYXRjaFwiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9NSVNNQVRDSCAqLyk7XHJcbiAgICAgICAgcmV0dXJuIFVzZXJDcmVkZW50aWFsSW1wbC5fZm9yT3BlcmF0aW9uKHVzZXIsIG9wZXJhdGlvblR5cGUsIHJlc3BvbnNlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgLy8gQ29udmVydCB1c2VyIGRlbGV0ZWQgZXJyb3IgaW50byB1c2VyIG1pc21hdGNoXHJcbiAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgPT09IGBhdXRoLyR7XCJ1c2VyLW5vdC1mb3VuZFwiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9ERUxFVEVEICovfWApIHtcclxuICAgICAgICAgICAgX2ZhaWwoYXV0aCwgXCJ1c2VyLW1pc21hdGNoXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX01JU01BVENIICovKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgZTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBfc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgY3JlZGVudGlhbCwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHtcclxuICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcChhdXRoLmFwcCkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IoYXV0aCkpO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb3BlcmF0aW9uVHlwZSA9IFwic2lnbkluXCIgLyogT3BlcmF0aW9uVHlwZS5TSUdOX0lOICovO1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfcHJvY2Vzc0NyZWRlbnRpYWxTYXZpbmdNZmFDb250ZXh0SWZOZWNlc3NhcnkoYXV0aCwgb3BlcmF0aW9uVHlwZSwgY3JlZGVudGlhbCk7XHJcbiAgICBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IFVzZXJDcmVkZW50aWFsSW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSk7XHJcbiAgICBpZiAoIWJ5cGFzc0F1dGhTdGF0ZSkge1xyXG4gICAgICAgIGF3YWl0IGF1dGguX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXJDcmVkZW50aWFsLnVzZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVzZXJDcmVkZW50aWFsO1xyXG59XHJcbi8qKlxyXG4gKiBBc3luY2hyb25vdXNseSBzaWducyBpbiB3aXRoIHRoZSBnaXZlbiBjcmVkZW50aWFscy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogQW4ge0BsaW5rIEF1dGhQcm92aWRlcn0gY2FuIGJlIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgYnkge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYVxyXG4gKiB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZVNlcnZlckFwcH0uXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGNyZWRlbnRpYWwgLSBUaGUgYXV0aCBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoQ3JlZGVudGlhbChhdXRoLCBjcmVkZW50aWFsKSB7XHJcbiAgICByZXR1cm4gX3NpZ25JbldpdGhDcmVkZW50aWFsKF9jYXN0QXV0aChhdXRoKSwgY3JlZGVudGlhbCk7XHJcbn1cclxuLyoqXHJcbiAqIExpbmtzIHRoZSB1c2VyIGFjY291bnQgd2l0aCB0aGUgZ2l2ZW4gY3JlZGVudGlhbHMuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIEFuIHtAbGluayBBdXRoUHJvdmlkZXJ9IGNhbiBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gY3JlZGVudGlhbCAtIFRoZSBhdXRoIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGxpbmtXaXRoQ3JlZGVudGlhbCh1c2VyLCBjcmVkZW50aWFsKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBhd2FpdCBfYXNzZXJ0TGlua2VkU3RhdHVzKGZhbHNlLCB1c2VySW50ZXJuYWwsIGNyZWRlbnRpYWwucHJvdmlkZXJJZCk7XHJcbiAgICByZXR1cm4gX2xpbmskMSh1c2VySW50ZXJuYWwsIGNyZWRlbnRpYWwpO1xyXG59XHJcbi8qKlxyXG4gKiBSZS1hdXRoZW50aWNhdGVzIGEgdXNlciB1c2luZyBhIGZyZXNoIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFVzZSBiZWZvcmUgb3BlcmF0aW9ucyBzdWNoIGFzIHtAbGluayB1cGRhdGVQYXNzd29yZH0gdGhhdCByZXF1aXJlIHRva2VucyBmcm9tIHJlY2VudCBzaWduLWluXHJcbiAqIGF0dGVtcHRzLiBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byByZWNvdmVyIGZyb20gYSBgQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOYCBlcnJvclxyXG4gKiBvciBhIGBUT0tFTl9FWFBJUkVEYCBlcnJvci5cclxuICpcclxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBvbiBhbnkge0BsaW5rIFVzZXJ9IHNpZ25lZCBpbiBieSB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzXHJcbiAqIGNyZWF0ZWQgd2l0aCBhIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIGNyZWRlbnRpYWwgLSBUaGUgYXV0aCBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiByZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsKHVzZXIsIGNyZWRlbnRpYWwpIHtcclxuICAgIHJldHVybiBfcmVhdXRoZW50aWNhdGUoZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpLCBjcmVkZW50aWFsKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoQ3VzdG9tVG9rZW4kMShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aEN1c3RvbVRva2VuXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX0NVU1RPTV9UT0tFTiAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQXN5bmNocm9ub3VzbHkgc2lnbnMgaW4gdXNpbmcgYSBjdXN0b20gdG9rZW4uXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIEN1c3RvbSB0b2tlbnMgYXJlIHVzZWQgdG8gaW50ZWdyYXRlIEZpcmViYXNlIEF1dGggd2l0aCBleGlzdGluZyBhdXRoIHN5c3RlbXMsIGFuZCBtdXN0XHJcbiAqIGJlIGdlbmVyYXRlZCBieSBhbiBhdXRoIGJhY2tlbmQgdXNpbmcgdGhlXHJcbiAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9yZWZlcmVuY2UvYWRtaW4vbm9kZS9hZG1pbi5hdXRoLkF1dGgjY3JlYXRlY3VzdG9tdG9rZW4gfCBjcmVhdGVDdXN0b21Ub2tlbn1cclxuICogbWV0aG9kIGluIHRoZSB7QGxpbmsgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvYXV0aC9hZG1pbiB8IEFkbWluIFNES30gLlxyXG4gKlxyXG4gKiBGYWlscyB3aXRoIGFuIGVycm9yIGlmIHRoZSB0b2tlbiBpcyBpbnZhbGlkLCBleHBpcmVkLCBvciBub3QgYWNjZXB0ZWQgYnkgdGhlIEZpcmViYXNlIEF1dGggc2VydmljZS5cclxuICpcclxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBieSB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXHJcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gY3VzdG9tVG9rZW4gLSBUaGUgY3VzdG9tIHRva2VuIHRvIHNpZ24gaW4gd2l0aC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aEN1c3RvbVRva2VuKGF1dGgsIGN1c3RvbVRva2VuKSB7XHJcbiAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAoYXV0aC5hcHApKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2lnbkluV2l0aEN1c3RvbVRva2VuJDEoYXV0aEludGVybmFsLCB7XHJcbiAgICAgICAgdG9rZW46IGN1c3RvbVRva2VuLFxyXG4gICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGNyZWQgPSBhd2FpdCBVc2VyQ3JlZGVudGlhbEltcGwuX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aEludGVybmFsLCBcInNpZ25JblwiIC8qIE9wZXJhdGlvblR5cGUuU0lHTl9JTiAqLywgcmVzcG9uc2UpO1xyXG4gICAgYXdhaXQgYXV0aEludGVybmFsLl91cGRhdGVDdXJyZW50VXNlcihjcmVkLnVzZXIpO1xyXG4gICAgcmV0dXJuIGNyZWQ7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgTXVsdGlGYWN0b3JJbmZvSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihmYWN0b3JJZCwgcmVzcG9uc2UpIHtcclxuICAgICAgICB0aGlzLmZhY3RvcklkID0gZmFjdG9ySWQ7XHJcbiAgICAgICAgdGhpcy51aWQgPSByZXNwb25zZS5tZmFFbnJvbGxtZW50SWQ7XHJcbiAgICAgICAgdGhpcy5lbnJvbGxtZW50VGltZSA9IG5ldyBEYXRlKHJlc3BvbnNlLmVucm9sbGVkQXQpLnRvVVRDU3RyaW5nKCk7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IHJlc3BvbnNlLmRpc3BsYXlOYW1lO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIF9mcm9tU2VydmVyUmVzcG9uc2UoYXV0aCwgZW5yb2xsbWVudCkge1xyXG4gICAgICAgIGlmICgncGhvbmVJbmZvJyBpbiBlbnJvbGxtZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQaG9uZU11bHRpRmFjdG9ySW5mb0ltcGwuX2Zyb21TZXJ2ZXJSZXNwb25zZShhdXRoLCBlbnJvbGxtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoJ3RvdHBJbmZvJyBpbiBlbnJvbGxtZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBUb3RwTXVsdGlGYWN0b3JJbmZvSW1wbC5fZnJvbVNlcnZlclJlc3BvbnNlKGF1dGgsIGVucm9sbG1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gX2ZhaWwoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIFBob25lTXVsdGlGYWN0b3JJbmZvSW1wbCBleHRlbmRzIE11bHRpRmFjdG9ySW5mb0ltcGwge1xyXG4gICAgY29uc3RydWN0b3IocmVzcG9uc2UpIHtcclxuICAgICAgICBzdXBlcihcInBob25lXCIgLyogRmFjdG9ySWQuUEhPTkUgKi8sIHJlc3BvbnNlKTtcclxuICAgICAgICB0aGlzLnBob25lTnVtYmVyID0gcmVzcG9uc2UucGhvbmVJbmZvO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIF9mcm9tU2VydmVyUmVzcG9uc2UoX2F1dGgsIGVucm9sbG1lbnQpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFBob25lTXVsdGlGYWN0b3JJbmZvSW1wbChlbnJvbGxtZW50KTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBUb3RwTXVsdGlGYWN0b3JJbmZvSW1wbCBleHRlbmRzIE11bHRpRmFjdG9ySW5mb0ltcGwge1xyXG4gICAgY29uc3RydWN0b3IocmVzcG9uc2UpIHtcclxuICAgICAgICBzdXBlcihcInRvdHBcIiAvKiBGYWN0b3JJZC5UT1RQICovLCByZXNwb25zZSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgX2Zyb21TZXJ2ZXJSZXNwb25zZShfYXV0aCwgZW5yb2xsbWVudCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgVG90cE11bHRpRmFjdG9ySW5mb0ltcGwoZW5yb2xsbWVudCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX3NldEFjdGlvbkNvZGVTZXR0aW5nc09uUmVxdWVzdChhdXRoLCByZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgIHZhciBfYTtcclxuICAgIF9hc3NlcnQoKChfYSA9IGFjdGlvbkNvZGVTZXR0aW5ncy51cmwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMCwgYXV0aCwgXCJpbnZhbGlkLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT05USU5VRV9VUkkgKi8pO1xyXG4gICAgX2Fzc2VydCh0eXBlb2YgYWN0aW9uQ29kZVNldHRpbmdzLmR5bmFtaWNMaW5rRG9tYWluID09PSAndW5kZWZpbmVkJyB8fFxyXG4gICAgICAgIGFjdGlvbkNvZGVTZXR0aW5ncy5keW5hbWljTGlua0RvbWFpbi5sZW5ndGggPiAwLCBhdXRoLCBcImludmFsaWQtZHluYW1pYy1saW5rLWRvbWFpblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9EWU5BTUlDX0xJTktfRE9NQUlOICovKTtcclxuICAgIHJlcXVlc3QuY29udGludWVVcmwgPSBhY3Rpb25Db2RlU2V0dGluZ3MudXJsO1xyXG4gICAgcmVxdWVzdC5keW5hbWljTGlua0RvbWFpbiA9IGFjdGlvbkNvZGVTZXR0aW5ncy5keW5hbWljTGlua0RvbWFpbjtcclxuICAgIHJlcXVlc3QuY2FuSGFuZGxlQ29kZUluQXBwID0gYWN0aW9uQ29kZVNldHRpbmdzLmhhbmRsZUNvZGVJbkFwcDtcclxuICAgIGlmIChhY3Rpb25Db2RlU2V0dGluZ3MuaU9TKSB7XHJcbiAgICAgICAgX2Fzc2VydChhY3Rpb25Db2RlU2V0dGluZ3MuaU9TLmJ1bmRsZUlkLmxlbmd0aCA+IDAsIGF1dGgsIFwibWlzc2luZy1pb3MtYnVuZGxlLWlkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0lPU19CVU5ETEVfSUQgKi8pO1xyXG4gICAgICAgIHJlcXVlc3QuaU9TQnVuZGxlSWQgPSBhY3Rpb25Db2RlU2V0dGluZ3MuaU9TLmJ1bmRsZUlkO1xyXG4gICAgfVxyXG4gICAgaWYgKGFjdGlvbkNvZGVTZXR0aW5ncy5hbmRyb2lkKSB7XHJcbiAgICAgICAgX2Fzc2VydChhY3Rpb25Db2RlU2V0dGluZ3MuYW5kcm9pZC5wYWNrYWdlTmFtZS5sZW5ndGggPiAwLCBhdXRoLCBcIm1pc3NpbmctYW5kcm9pZC1wa2ctbmFtZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSAqLyk7XHJcbiAgICAgICAgcmVxdWVzdC5hbmRyb2lkSW5zdGFsbEFwcCA9IGFjdGlvbkNvZGVTZXR0aW5ncy5hbmRyb2lkLmluc3RhbGxBcHA7XHJcbiAgICAgICAgcmVxdWVzdC5hbmRyb2lkTWluaW11bVZlcnNpb25Db2RlID1cclxuICAgICAgICAgICAgYWN0aW9uQ29kZVNldHRpbmdzLmFuZHJvaWQubWluaW11bVZlcnNpb247XHJcbiAgICAgICAgcmVxdWVzdC5hbmRyb2lkUGFja2FnZU5hbWUgPSBhY3Rpb25Db2RlU2V0dGluZ3MuYW5kcm9pZC5wYWNrYWdlTmFtZTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVXBkYXRlcyB0aGUgcGFzc3dvcmQgcG9saWN5IGNhY2hlZCBpbiB0aGUge0BsaW5rIEF1dGh9IGluc3RhbmNlIGlmIGEgcG9saWN5IGlzIGFscmVhZHlcclxuICogY2FjaGVkIGZvciB0aGUgcHJvamVjdCBvciB0ZW5hbnQuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFdlIG9ubHkgZmV0Y2ggdGhlIHBhc3N3b3JkIHBvbGljeSBpZiB0aGUgcGFzc3dvcmQgZGlkIG5vdCBtZWV0IHBvbGljeSByZXF1aXJlbWVudHMgYW5kXHJcbiAqIHRoZXJlIGlzIGFuIGV4aXN0aW5nIHBvbGljeSBjYWNoZWQuIEEgZGV2ZWxvcGVyIG11c3QgY2FsbCB2YWxpZGF0ZVBhc3N3b3JkIGF0IGxlYXN0XHJcbiAqIG9uY2UgZm9yIHRoZSBjYWNoZSB0byBiZSBhdXRvbWF0aWNhbGx5IHVwZGF0ZWQuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICpcclxuICogQHByaXZhdGVcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlY2FjaGVQYXNzd29yZFBvbGljeShhdXRoKSB7XHJcbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XHJcbiAgICBpZiAoYXV0aEludGVybmFsLl9nZXRQYXNzd29yZFBvbGljeUludGVybmFsKCkpIHtcclxuICAgICAgICBhd2FpdCBhdXRoSW50ZXJuYWwuX3VwZGF0ZVBhc3N3b3JkUG9saWN5KCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFNlbmRzIGEgcGFzc3dvcmQgcmVzZXQgZW1haWwgdG8gdGhlIGdpdmVuIGVtYWlsIGFkZHJlc3MuIFRoaXMgbWV0aG9kIGRvZXMgbm90IHRocm93IGFuIGVycm9yIHdoZW5cclxuICogdGhlcmUncyBubyB1c2VyIGFjY291bnQgd2l0aCB0aGUgZ2l2ZW4gZW1haWwgYWRkcmVzcyBhbmRcclxuICoge0BsaW5rIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9pZGVudGl0eS1wbGF0Zm9ybS9kb2NzL2FkbWluL2VtYWlsLWVudW1lcmF0aW9uLXByb3RlY3Rpb24gfCBFbWFpbCBFbnVtZXJhdGlvbiBQcm90ZWN0aW9ufVxyXG4gKiBpcyBlbmFibGVkLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUbyBjb21wbGV0ZSB0aGUgcGFzc3dvcmQgcmVzZXQsIGNhbGwge0BsaW5rIGNvbmZpcm1QYXNzd29yZFJlc2V0fSB3aXRoIHRoZSBjb2RlIHN1cHBsaWVkIGluXHJcbiAqIHRoZSBlbWFpbCBzZW50IHRvIHRoZSB1c2VyLCBhbG9uZyB3aXRoIHRoZSBuZXcgcGFzc3dvcmQgc3BlY2lmaWVkIGJ5IHRoZSB1c2VyLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIGNvbnN0IGFjdGlvbkNvZGVTZXR0aW5ncyA9IHtcclxuICogICB1cmw6ICdodHRwczovL3d3dy5leGFtcGxlLmNvbS8/ZW1haWw9dXNlckBleGFtcGxlLmNvbScsXHJcbiAqICAgaU9TOiB7XHJcbiAqICAgICAgYnVuZGxlSWQ6ICdjb20uZXhhbXBsZS5pb3MnXHJcbiAqICAgfSxcclxuICogICBhbmRyb2lkOiB7XHJcbiAqICAgICBwYWNrYWdlTmFtZTogJ2NvbS5leGFtcGxlLmFuZHJvaWQnLFxyXG4gKiAgICAgaW5zdGFsbEFwcDogdHJ1ZSxcclxuICogICAgIG1pbmltdW1WZXJzaW9uOiAnMTInXHJcbiAqICAgfSxcclxuICogICBoYW5kbGVDb2RlSW5BcHA6IHRydWVcclxuICogfTtcclxuICogYXdhaXQgc2VuZFBhc3N3b3JkUmVzZXRFbWFpbChhdXRoLCAndXNlckBleGFtcGxlLmNvbScsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAqIC8vIE9idGFpbiBjb2RlIGZyb20gdXNlci5cclxuICogYXdhaXQgY29uZmlybVBhc3N3b3JkUmVzZXQoJ3VzZXJAZXhhbXBsZS5jb20nLCBjb2RlKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxyXG4gKiBAcGFyYW0gYWN0aW9uQ29kZVNldHRpbmdzIC0gVGhlIHtAbGluayBBY3Rpb25Db2RlU2V0dGluZ3N9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzZW5kUGFzc3dvcmRSZXNldEVtYWlsKGF1dGgsIGVtYWlsLCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgcmVxdWVzdFR5cGU6IFwiUEFTU1dPUkRfUkVTRVRcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlBBU1NXT1JEX1JFU0VUICovLFxyXG4gICAgICAgIGVtYWlsLFxyXG4gICAgICAgIGNsaWVudFR5cGU6IFwiQ0xJRU5UX1RZUEVfV0VCXCIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi9cclxuICAgIH07XHJcbiAgICBpZiAoYWN0aW9uQ29kZVNldHRpbmdzKSB7XHJcbiAgICAgICAgX3NldEFjdGlvbkNvZGVTZXR0aW5nc09uUmVxdWVzdChhdXRoSW50ZXJuYWwsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBhd2FpdCBoYW5kbGVSZWNhcHRjaGFGbG93KGF1dGhJbnRlcm5hbCwgcmVxdWVzdCwgXCJnZXRPb2JDb2RlXCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5HRVRfT09CX0NPREUgKi8sIHNlbmRQYXNzd29yZFJlc2V0RW1haWwkMSk7XHJcbn1cclxuLyoqXHJcbiAqIENvbXBsZXRlcyB0aGUgcGFzc3dvcmQgcmVzZXQgcHJvY2VzcywgZ2l2ZW4gYSBjb25maXJtYXRpb24gY29kZSBhbmQgbmV3IHBhc3N3b3JkLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBvb2JDb2RlIC0gQSBjb25maXJtYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gbmV3UGFzc3dvcmQgLSBUaGUgbmV3IHBhc3N3b3JkLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBjb25maXJtUGFzc3dvcmRSZXNldChhdXRoLCBvb2JDb2RlLCBuZXdQYXNzd29yZCkge1xyXG4gICAgYXdhaXQgcmVzZXRQYXNzd29yZChnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCksIHtcclxuICAgICAgICBvb2JDb2RlLFxyXG4gICAgICAgIG5ld1Bhc3N3b3JkXHJcbiAgICB9KVxyXG4gICAgICAgIC5jYXRjaChhc3luYyAoZXJyb3IpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT1cclxuICAgICAgICAgICAgYGF1dGgvJHtcInBhc3N3b3JkLWRvZXMtbm90LW1lZXQtcmVxdWlyZW1lbnRzXCIgLyogQXV0aEVycm9yQ29kZS5QQVNTV09SRF9ET0VTX05PVF9NRUVUX1JFUVVJUkVNRU5UUyAqL31gKSB7XHJcbiAgICAgICAgICAgIHZvaWQgcmVjYWNoZVBhc3N3b3JkUG9saWN5KGF1dGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH0pO1xyXG4gICAgLy8gRG8gbm90IHJldHVybiB0aGUgZW1haWwuXHJcbn1cclxuLyoqXHJcbiAqIEFwcGxpZXMgYSB2ZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyIGJ5IGVtYWlsIG9yIG90aGVyIG91dC1vZi1iYW5kIG1lY2hhbmlzbS5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gb29iQ29kZSAtIEEgdmVyaWZpY2F0aW9uIGNvZGUgc2VudCB0byB0aGUgdXNlci5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gYXBwbHlBY3Rpb25Db2RlKGF1dGgsIG9vYkNvZGUpIHtcclxuICAgIGF3YWl0IGFwcGx5QWN0aW9uQ29kZSQxKGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKSwgeyBvb2JDb2RlIH0pO1xyXG59XHJcbi8qKlxyXG4gKiBDaGVja3MgYSB2ZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyIGJ5IGVtYWlsIG9yIG90aGVyIG91dC1vZi1iYW5kIG1lY2hhbmlzbS5cclxuICpcclxuICogQHJldHVybnMgbWV0YWRhdGEgYWJvdXQgdGhlIGNvZGUuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIG9vYkNvZGUgLSBBIHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8gdGhlIHVzZXIuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGNoZWNrQWN0aW9uQ29kZShhdXRoLCBvb2JDb2RlKSB7XHJcbiAgICBjb25zdCBhdXRoTW9kdWxhciA9IGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVzZXRQYXNzd29yZChhdXRoTW9kdWxhciwgeyBvb2JDb2RlIH0pO1xyXG4gICAgLy8gRW1haWwgY291bGQgYmUgZW1wdHkgb25seSBpZiB0aGUgcmVxdWVzdCB0eXBlIGlzIEVNQUlMX1NJR05JTiBvclxyXG4gICAgLy8gVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwuXHJcbiAgICAvLyBOZXcgZW1haWwgc2hvdWxkIG5vdCBiZSBlbXB0eSBpZiB0aGUgcmVxdWVzdCB0eXBlIGlzXHJcbiAgICAvLyBWRVJJRllfQU5EX0NIQU5HRV9FTUFJTC5cclxuICAgIC8vIE11bHRpLWZhY3RvciBpbmZvIGNvdWxkIG5vdCBiZSBlbXB0eSBpZiB0aGUgcmVxdWVzdCB0eXBlIGlzXHJcbiAgICAvLyBSRVZFUlRfU0VDT05EX0ZBQ1RPUl9BRERJVElPTi5cclxuICAgIGNvbnN0IG9wZXJhdGlvbiA9IHJlc3BvbnNlLnJlcXVlc3RUeXBlO1xyXG4gICAgX2Fzc2VydChvcGVyYXRpb24sIGF1dGhNb2R1bGFyLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICBzd2l0Y2ggKG9wZXJhdGlvbikge1xyXG4gICAgICAgIGNhc2UgXCJFTUFJTF9TSUdOSU5cIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLkVNQUlMX1NJR05JTiAqLzpcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcIlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfQU5EX0NIQU5HRV9FTUFJTCAqLzpcclxuICAgICAgICAgICAgX2Fzc2VydChyZXNwb25zZS5uZXdFbWFpbCwgYXV0aE1vZHVsYXIsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcIlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5SRVZFUlRfU0VDT05EX0ZBQ1RPUl9BRERJVElPTiAqLzpcclxuICAgICAgICAgICAgX2Fzc2VydChyZXNwb25zZS5tZmFJbmZvLCBhdXRoTW9kdWxhciwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIC8vIGZhbGwgdGhyb3VnaFxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIF9hc3NlcnQocmVzcG9uc2UuZW1haWwsIGF1dGhNb2R1bGFyLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICB9XHJcbiAgICAvLyBUaGUgbXVsdGktZmFjdG9yIGluZm8gZm9yIHJldmVydCBzZWNvbmQgZmFjdG9yIGFkZGl0aW9uXHJcbiAgICBsZXQgbXVsdGlGYWN0b3JJbmZvID0gbnVsbDtcclxuICAgIGlmIChyZXNwb25zZS5tZmFJbmZvKSB7XHJcbiAgICAgICAgbXVsdGlGYWN0b3JJbmZvID0gTXVsdGlGYWN0b3JJbmZvSW1wbC5fZnJvbVNlcnZlclJlc3BvbnNlKF9jYXN0QXV0aChhdXRoTW9kdWxhciksIHJlc3BvbnNlLm1mYUluZm8pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAocmVzcG9uc2UucmVxdWVzdFR5cGUgPT09IFwiVkVSSUZZX0FORF9DSEFOR0VfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMICovXHJcbiAgICAgICAgICAgICAgICA/IHJlc3BvbnNlLm5ld0VtYWlsXHJcbiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmVtYWlsKSB8fCBudWxsLFxyXG4gICAgICAgICAgICBwcmV2aW91c0VtYWlsOiAocmVzcG9uc2UucmVxdWVzdFR5cGUgPT09IFwiVkVSSUZZX0FORF9DSEFOR0VfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMICovXHJcbiAgICAgICAgICAgICAgICA/IHJlc3BvbnNlLmVtYWlsXHJcbiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLm5ld0VtYWlsKSB8fCBudWxsLFxyXG4gICAgICAgICAgICBtdWx0aUZhY3RvckluZm9cclxuICAgICAgICB9LFxyXG4gICAgICAgIG9wZXJhdGlvblxyXG4gICAgfTtcclxufVxyXG4vKipcclxuICogQ2hlY2tzIGEgcGFzc3dvcmQgcmVzZXQgY29kZSBzZW50IHRvIHRoZSB1c2VyIGJ5IGVtYWlsIG9yIG90aGVyIG91dC1vZi1iYW5kIG1lY2hhbmlzbS5cclxuICpcclxuICogQHJldHVybnMgdGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzIGlmIHZhbGlkLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBjb2RlIC0gQSB2ZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlQYXNzd29yZFJlc2V0Q29kZShhdXRoLCBjb2RlKSB7XHJcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGNoZWNrQWN0aW9uQ29kZShnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCksIGNvZGUpO1xyXG4gICAgLy8gRW1haWwgc2hvdWxkIGFsd2F5cyBiZSBwcmVzZW50IHNpbmNlIGEgY29kZSB3YXMgc2VudCB0byBpdFxyXG4gICAgcmV0dXJuIGRhdGEuZW1haWw7XHJcbn1cclxuLyoqXHJcbiAqIENyZWF0ZXMgYSBuZXcgdXNlciBhY2NvdW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIGVtYWlsIGFkZHJlc3MgYW5kIHBhc3N3b3JkLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBPbiBzdWNjZXNzZnVsIGNyZWF0aW9uIG9mIHRoZSB1c2VyIGFjY291bnQsIHRoaXMgdXNlciB3aWxsIGFsc28gYmUgc2lnbmVkIGluIHRvIHlvdXIgYXBwbGljYXRpb24uXHJcbiAqXHJcbiAqIFVzZXIgYWNjb3VudCBjcmVhdGlvbiBjYW4gZmFpbCBpZiB0aGUgYWNjb3VudCBhbHJlYWR5IGV4aXN0cyBvciB0aGUgcGFzc3dvcmQgaXMgaW52YWxpZC5cclxuICpcclxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBvbiB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXHJcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogTm90ZTogVGhlIGVtYWlsIGFkZHJlc3MgYWN0cyBhcyBhIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdXNlciBhbmQgZW5hYmxlcyBhbiBlbWFpbC1iYXNlZFxyXG4gKiBwYXNzd29yZCByZXNldC4gVGhpcyBmdW5jdGlvbiB3aWxsIGNyZWF0ZSBhIG5ldyB1c2VyIGFjY291bnQgYW5kIHNldCB0aGUgaW5pdGlhbCB1c2VyIHBhc3N3b3JkLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBlbWFpbCAtIFRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cclxuICogQHBhcmFtIHBhc3N3b3JkIC0gVGhlIHVzZXIncyBjaG9zZW4gcGFzc3dvcmQuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZChhdXRoLCBlbWFpbCwgcGFzc3dvcmQpIHtcclxuICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcChhdXRoLmFwcCkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IoYXV0aCkpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZSxcclxuICAgICAgICBlbWFpbCxcclxuICAgICAgICBwYXNzd29yZCxcclxuICAgICAgICBjbGllbnRUeXBlOiBcIkNMSUVOVF9UWVBFX1dFQlwiIC8qIFJlY2FwdGNoYUNsaWVudFR5cGUuV0VCICovXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgc2lnblVwUmVzcG9uc2UgPSBoYW5kbGVSZWNhcHRjaGFGbG93KGF1dGhJbnRlcm5hbCwgcmVxdWVzdCwgXCJzaWduVXBQYXNzd29yZFwiIC8qIFJlY2FwdGNoYUFjdGlvbk5hbWUuU0lHTl9VUF9QQVNTV09SRCAqLywgc2lnblVwKTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2lnblVwUmVzcG9uc2UuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8ke1wicGFzc3dvcmQtZG9lcy1ub3QtbWVldC1yZXF1aXJlbWVudHNcIiAvKiBBdXRoRXJyb3JDb2RlLlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTICovfWApIHtcclxuICAgICAgICAgICAgdm9pZCByZWNhY2hlUGFzc3dvcmRQb2xpY3koYXV0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IFVzZXJDcmVkZW50aWFsSW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoSW50ZXJuYWwsIFwic2lnbkluXCIgLyogT3BlcmF0aW9uVHlwZS5TSUdOX0lOICovLCByZXNwb25zZSk7XHJcbiAgICBhd2FpdCBhdXRoSW50ZXJuYWwuX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXJDcmVkZW50aWFsLnVzZXIpO1xyXG4gICAgcmV0dXJuIHVzZXJDcmVkZW50aWFsO1xyXG59XHJcbi8qKlxyXG4gKiBBc3luY2hyb25vdXNseSBzaWducyBpbiB1c2luZyBhbiBlbWFpbCBhbmQgcGFzc3dvcmQuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIEZhaWxzIHdpdGggYW4gZXJyb3IgaWYgdGhlIGVtYWlsIGFkZHJlc3MgYW5kIHBhc3N3b3JkIGRvIG5vdCBtYXRjaC4gV2hlblxyXG4gKiB7QGxpbmsgaHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2lkZW50aXR5LXBsYXRmb3JtL2RvY3MvYWRtaW4vZW1haWwtZW51bWVyYXRpb24tcHJvdGVjdGlvbiB8IEVtYWlsIEVudW1lcmF0aW9uIFByb3RlY3Rpb259XHJcbiAqIGlzIGVuYWJsZWQsIHRoaXMgbWV0aG9kIGZhaWxzIHdpdGggXCJhdXRoL2ludmFsaWQtY3JlZGVudGlhbFwiIGluIGNhc2Ugb2YgYW4gaW52YWxpZFxyXG4gKiBlbWFpbC9wYXNzd29yZC5cclxuICpcclxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBvbiB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXHJcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogTm90ZTogVGhlIHVzZXIncyBwYXNzd29yZCBpcyBOT1QgdGhlIHBhc3N3b3JkIHVzZWQgdG8gYWNjZXNzIHRoZSB1c2VyJ3MgZW1haWwgYWNjb3VudC4gVGhlXHJcbiAqIGVtYWlsIGFkZHJlc3Mgc2VydmVzIGFzIGEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSB1c2VyLCBhbmQgdGhlIHBhc3N3b3JkIGlzIHVzZWQgdG8gYWNjZXNzXHJcbiAqIHRoZSB1c2VyJ3MgYWNjb3VudCBpbiB5b3VyIEZpcmViYXNlIHByb2plY3QuIFNlZSBhbHNvOiB7QGxpbmsgY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkfS5cclxuICpcclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gZW1haWwgLSBUaGUgdXNlcnMgZW1haWwgYWRkcmVzcy5cclxuICogQHBhcmFtIHBhc3N3b3JkIC0gVGhlIHVzZXJzIHBhc3N3b3JkLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZChhdXRoLCBlbWFpbCwgcGFzc3dvcmQpIHtcclxuICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcChhdXRoLmFwcCkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IoYXV0aCkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNpZ25JbldpdGhDcmVkZW50aWFsKGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKSwgRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChlbWFpbCwgcGFzc3dvcmQpKS5jYXRjaChhc3luYyAoZXJyb3IpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gYGF1dGgvJHtcInBhc3N3b3JkLWRvZXMtbm90LW1lZXQtcmVxdWlyZW1lbnRzXCIgLyogQXV0aEVycm9yQ29kZS5QQVNTV09SRF9ET0VTX05PVF9NRUVUX1JFUVVJUkVNRU5UUyAqL31gKSB7XHJcbiAgICAgICAgICAgIHZvaWQgcmVjYWNoZVBhc3N3b3JkUG9saWN5KGF1dGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH0pO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBTZW5kcyBhIHNpZ24taW4gZW1haWwgbGluayB0byB0aGUgdXNlciB3aXRoIHRoZSBzcGVjaWZpZWQgZW1haWwuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoZSBzaWduLWluIG9wZXJhdGlvbiBoYXMgdG8gYWx3YXlzIGJlIGNvbXBsZXRlZCBpbiB0aGUgYXBwIHVubGlrZSBvdGhlciBvdXQgb2YgYmFuZCBlbWFpbFxyXG4gKiBhY3Rpb25zIChwYXNzd29yZCByZXNldCBhbmQgZW1haWwgdmVyaWZpY2F0aW9ucykuIFRoaXMgaXMgYmVjYXVzZSwgYXQgdGhlIGVuZCBvZiB0aGUgZmxvdyxcclxuICogdGhlIHVzZXIgaXMgZXhwZWN0ZWQgdG8gYmUgc2lnbmVkIGluIGFuZCB0aGVpciBBdXRoIHN0YXRlIHBlcnNpc3RlZCB3aXRoaW4gdGhlIGFwcC5cclxuICpcclxuICogVG8gY29tcGxldGUgc2lnbiBpbiB3aXRoIHRoZSBlbWFpbCBsaW5rLCBjYWxsIHtAbGluayBzaWduSW5XaXRoRW1haWxMaW5rfSB3aXRoIHRoZSBlbWFpbFxyXG4gKiBhZGRyZXNzIGFuZCB0aGUgZW1haWwgbGluayBzdXBwbGllZCBpbiB0aGUgZW1haWwgc2VudCB0byB0aGUgdXNlci5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBjb25zdCBhY3Rpb25Db2RlU2V0dGluZ3MgPSB7XHJcbiAqICAgdXJsOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20vP2VtYWlsPXVzZXJAZXhhbXBsZS5jb20nLFxyXG4gKiAgIGlPUzoge1xyXG4gKiAgICAgIGJ1bmRsZUlkOiAnY29tLmV4YW1wbGUuaW9zJ1xyXG4gKiAgIH0sXHJcbiAqICAgYW5kcm9pZDoge1xyXG4gKiAgICAgcGFja2FnZU5hbWU6ICdjb20uZXhhbXBsZS5hbmRyb2lkJyxcclxuICogICAgIGluc3RhbGxBcHA6IHRydWUsXHJcbiAqICAgICBtaW5pbXVtVmVyc2lvbjogJzEyJ1xyXG4gKiAgIH0sXHJcbiAqICAgaGFuZGxlQ29kZUluQXBwOiB0cnVlXHJcbiAqIH07XHJcbiAqIGF3YWl0IHNlbmRTaWduSW5MaW5rVG9FbWFpbChhdXRoLCAndXNlckBleGFtcGxlLmNvbScsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAqIC8vIE9idGFpbiBlbWFpbExpbmsgZnJvbSB0aGUgdXNlci5cclxuICogaWYoaXNTaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsIGVtYWlsTGluaykpIHtcclxuICogICBhd2FpdCBzaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsICd1c2VyQGV4YW1wbGUuY29tJywgZW1haWxMaW5rKTtcclxuICogfVxyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIGF1dGhJbnRlcm5hbCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBlbWFpbCAtIFRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cclxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsIGVtYWlsLCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgcmVxdWVzdFR5cGU6IFwiRU1BSUxfU0lHTklOXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5FTUFJTF9TSUdOSU4gKi8sXHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgY2xpZW50VHlwZTogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqL1xyXG4gICAgfTtcclxuICAgIGZ1bmN0aW9uIHNldEFjdGlvbkNvZGVTZXR0aW5ncyhyZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgICAgICBfYXNzZXJ0KGFjdGlvbkNvZGVTZXR0aW5ncy5oYW5kbGVDb2RlSW5BcHAsIGF1dGhJbnRlcm5hbCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIGlmIChhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgX3NldEFjdGlvbkNvZGVTZXR0aW5nc09uUmVxdWVzdChhdXRoSW50ZXJuYWwsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2V0QWN0aW9uQ29kZVNldHRpbmdzKHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAgICBhd2FpdCBoYW5kbGVSZWNhcHRjaGFGbG93KGF1dGhJbnRlcm5hbCwgcmVxdWVzdCwgXCJnZXRPb2JDb2RlXCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5HRVRfT09CX0NPREUgKi8sIHNlbmRTaWduSW5MaW5rVG9FbWFpbCQxKTtcclxufVxyXG4vKipcclxuICogQ2hlY2tzIGlmIGFuIGluY29taW5nIGxpbmsgaXMgYSBzaWduLWluIHdpdGggZW1haWwgbGluayBzdWl0YWJsZSBmb3Ige0BsaW5rIHNpZ25JbldpdGhFbWFpbExpbmt9LlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBlbWFpbExpbmsgLSBUaGUgbGluayBzZW50IHRvIHRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gaXNTaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsIGVtYWlsTGluaykge1xyXG4gICAgY29uc3QgYWN0aW9uQ29kZVVybCA9IEFjdGlvbkNvZGVVUkwucGFyc2VMaW5rKGVtYWlsTGluayk7XHJcbiAgICByZXR1cm4gKGFjdGlvbkNvZGVVcmwgPT09IG51bGwgfHwgYWN0aW9uQ29kZVVybCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYWN0aW9uQ29kZVVybC5vcGVyYXRpb24pID09PSBcIkVNQUlMX1NJR05JTlwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uRU1BSUxfU0lHTklOICovO1xyXG59XHJcbi8qKlxyXG4gKiBBc3luY2hyb25vdXNseSBzaWducyBpbiB1c2luZyBhbiBlbWFpbCBhbmQgc2lnbi1pbiBlbWFpbCBsaW5rLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBJZiBubyBsaW5rIGlzIHBhc3NlZCwgdGhlIGxpbmsgaXMgaW5mZXJyZWQgZnJvbSB0aGUgY3VycmVudCBVUkwuXHJcbiAqXHJcbiAqIEZhaWxzIHdpdGggYW4gZXJyb3IgaWYgdGhlIGVtYWlsIGFkZHJlc3MgaXMgaW52YWxpZCBvciBPVFAgaW4gZW1haWwgbGluayBleHBpcmVzLlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGFcclxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxyXG4gKlxyXG4gKiBOb3RlOiBDb25maXJtIHRoZSBsaW5rIGlzIGEgc2lnbi1pbiBlbWFpbCBsaW5rIGJlZm9yZSBjYWxsaW5nIHRoaXMgbWV0aG9kIGZpcmViYXNlLmF1dGguQXV0aC5pc1NpZ25JbldpdGhFbWFpbExpbmsuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogY29uc3QgYWN0aW9uQ29kZVNldHRpbmdzID0ge1xyXG4gKiAgIHVybDogJ2h0dHBzOi8vd3d3LmV4YW1wbGUuY29tLz9lbWFpbD11c2VyQGV4YW1wbGUuY29tJyxcclxuICogICBpT1M6IHtcclxuICogICAgICBidW5kbGVJZDogJ2NvbS5leGFtcGxlLmlvcydcclxuICogICB9LFxyXG4gKiAgIGFuZHJvaWQ6IHtcclxuICogICAgIHBhY2thZ2VOYW1lOiAnY29tLmV4YW1wbGUuYW5kcm9pZCcsXHJcbiAqICAgICBpbnN0YWxsQXBwOiB0cnVlLFxyXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcclxuICogICB9LFxyXG4gKiAgIGhhbmRsZUNvZGVJbkFwcDogdHJ1ZVxyXG4gKiB9O1xyXG4gKiBhd2FpdCBzZW5kU2lnbkluTGlua1RvRW1haWwoYXV0aCwgJ3VzZXJAZXhhbXBsZS5jb20nLCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xyXG4gKiAvLyBPYnRhaW4gZW1haWxMaW5rIGZyb20gdGhlIHVzZXIuXHJcbiAqIGlmKGlzU2lnbkluV2l0aEVtYWlsTGluayhhdXRoLCBlbWFpbExpbmspKSB7XHJcbiAqICAgYXdhaXQgc2lnbkluV2l0aEVtYWlsTGluayhhdXRoLCAndXNlckBleGFtcGxlLmNvbScsIGVtYWlsTGluayk7XHJcbiAqIH1cclxuICogYGBgXHJcbiAqXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxyXG4gKiBAcGFyYW0gZW1haWxMaW5rIC0gVGhlIGxpbmsgc2VudCB0byB0aGUgdXNlcidzIGVtYWlsIGFkZHJlc3MuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgZW1haWwsIGVtYWlsTGluaykge1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKGF1dGguYXBwKSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvcihhdXRoKSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhdXRoTW9kdWxhciA9IGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKTtcclxuICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBFbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsV2l0aExpbmsoZW1haWwsIGVtYWlsTGluayB8fCBfZ2V0Q3VycmVudFVybCgpKTtcclxuICAgIC8vIENoZWNrIGlmIHRoZSB0ZW5hbnQgSUQgaW4gdGhlIGVtYWlsIGxpbmsgbWF0Y2hlcyB0aGUgdGVuYW50IElEIG9uIEF1dGhcclxuICAgIC8vIGluc3RhbmNlLlxyXG4gICAgX2Fzc2VydChjcmVkZW50aWFsLl90ZW5hbnRJZCA9PT0gKGF1dGhNb2R1bGFyLnRlbmFudElkIHx8IG51bGwpLCBhdXRoTW9kdWxhciwgXCJ0ZW5hbnQtaWQtbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlRFTkFOVF9JRF9NSVNNQVRDSCAqLyk7XHJcbiAgICByZXR1cm4gc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aE1vZHVsYXIsIGNyZWRlbnRpYWwpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUF1dGhVcmkoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOmNyZWF0ZUF1dGhVcmlcIiAvKiBFbmRwb2ludC5DUkVBVEVfQVVUSF9VUkkgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEdldHMgdGhlIGxpc3Qgb2YgcG9zc2libGUgc2lnbiBpbiBtZXRob2RzIGZvciB0aGUgZ2l2ZW4gZW1haWwgYWRkcmVzcy4gVGhpcyBtZXRob2QgcmV0dXJucyBhblxyXG4gKiBlbXB0eSBsaXN0IHdoZW5cclxuICoge0BsaW5rIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9pZGVudGl0eS1wbGF0Zm9ybS9kb2NzL2FkbWluL2VtYWlsLWVudW1lcmF0aW9uLXByb3RlY3Rpb24gfCBFbWFpbCBFbnVtZXJhdGlvbiBQcm90ZWN0aW9ufVxyXG4gKiBpcyBlbmFibGVkLCBpcnJlc3BlY3RpdmUgb2YgdGhlIG51bWJlciBvZiBhdXRoZW50aWNhdGlvbiBtZXRob2RzIGF2YWlsYWJsZSBmb3IgdGhlIGdpdmVuIGVtYWlsLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUaGlzIGlzIHVzZWZ1bCB0byBkaWZmZXJlbnRpYXRlIG1ldGhvZHMgb2Ygc2lnbi1pbiBmb3IgdGhlIHNhbWUgcHJvdmlkZXIsIGVnLlxyXG4gKiB7QGxpbmsgRW1haWxBdXRoUHJvdmlkZXJ9IHdoaWNoIGhhcyAyIG1ldGhvZHMgb2Ygc2lnbi1pbixcclxuICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfUEFTU1dPUkQgYW5kXHJcbiAqIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX0xJTksuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxyXG4gKlxyXG4gKiBEZXByZWNhdGVkLiBNaWdyYXRpbmcgb2ZmIG9mIHRoaXMgbWV0aG9kIGlzIHJlY29tbWVuZGVkIGFzIGEgc2VjdXJpdHkgYmVzdC1wcmFjdGljZS5cclxuICogTGVhcm4gbW9yZSBpbiB0aGUgSWRlbnRpdHkgUGxhdGZvcm0gZG9jdW1lbnRhdGlvbiBmb3JcclxuICoge0BsaW5rIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9pZGVudGl0eS1wbGF0Zm9ybS9kb2NzL2FkbWluL2VtYWlsLWVudW1lcmF0aW9uLXByb3RlY3Rpb24gfCBFbWFpbCBFbnVtZXJhdGlvbiBQcm90ZWN0aW9ufS5cclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hTaWduSW5NZXRob2RzRm9yRW1haWwoYXV0aCwgZW1haWwpIHtcclxuICAgIC8vIGNyZWF0ZUF1dGhVcmkgcmV0dXJucyBhbiBlcnJvciBpZiBjb250aW51ZSBVUkkgaXMgbm90IGh0dHAgb3IgaHR0cHMuXHJcbiAgICAvLyBGb3IgZW52aXJvbm1lbnRzIGxpa2UgQ29yZG92YSwgQ2hyb21lIGV4dGVuc2lvbnMsIG5hdGl2ZSBmcmFtZXdvcmtzLCBmaWxlXHJcbiAgICAvLyBzeXN0ZW1zLCBldGMsIHVzZSBodHRwOi8vbG9jYWxob3N0IGFzIGNvbnRpbnVlIFVSTC5cclxuICAgIGNvbnN0IGNvbnRpbnVlVXJpID0gX2lzSHR0cE9ySHR0cHMoKSA/IF9nZXRDdXJyZW50VXJsKCkgOiAnaHR0cDovL2xvY2FsaG9zdCc7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xyXG4gICAgICAgIGlkZW50aWZpZXI6IGVtYWlsLFxyXG4gICAgICAgIGNvbnRpbnVlVXJpXHJcbiAgICB9O1xyXG4gICAgY29uc3QgeyBzaWduaW5NZXRob2RzIH0gPSBhd2FpdCBjcmVhdGVBdXRoVXJpKGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKSwgcmVxdWVzdCk7XHJcbiAgICByZXR1cm4gc2lnbmluTWV0aG9kcyB8fCBbXTtcclxufVxyXG4vKipcclxuICogU2VuZHMgYSB2ZXJpZmljYXRpb24gZW1haWwgdG8gYSB1c2VyLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUaGUgdmVyaWZpY2F0aW9uIHByb2Nlc3MgaXMgY29tcGxldGVkIGJ5IGNhbGxpbmcge0BsaW5rIGFwcGx5QWN0aW9uQ29kZX0uXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogY29uc3QgYWN0aW9uQ29kZVNldHRpbmdzID0ge1xyXG4gKiAgIHVybDogJ2h0dHBzOi8vd3d3LmV4YW1wbGUuY29tLz9lbWFpbD11c2VyQGV4YW1wbGUuY29tJyxcclxuICogICBpT1M6IHtcclxuICogICAgICBidW5kbGVJZDogJ2NvbS5leGFtcGxlLmlvcydcclxuICogICB9LFxyXG4gKiAgIGFuZHJvaWQ6IHtcclxuICogICAgIHBhY2thZ2VOYW1lOiAnY29tLmV4YW1wbGUuYW5kcm9pZCcsXHJcbiAqICAgICBpbnN0YWxsQXBwOiB0cnVlLFxyXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcclxuICogICB9LFxyXG4gKiAgIGhhbmRsZUNvZGVJbkFwcDogdHJ1ZVxyXG4gKiB9O1xyXG4gKiBhd2FpdCBzZW5kRW1haWxWZXJpZmljYXRpb24odXNlciwgYWN0aW9uQ29kZVNldHRpbmdzKTtcclxuICogLy8gT2J0YWluIGNvZGUgZnJvbSB0aGUgdXNlci5cclxuICogYXdhaXQgYXBwbHlBY3Rpb25Db2RlKGF1dGgsIGNvZGUpO1xyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2VuZEVtYWlsVmVyaWZpY2F0aW9uKHVzZXIsIGFjdGlvbkNvZGVTZXR0aW5ncykge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICByZXF1ZXN0VHlwZTogXCJWRVJJRllfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9FTUFJTCAqLyxcclxuICAgICAgICBpZFRva2VuXHJcbiAgICB9O1xyXG4gICAgaWYgKGFjdGlvbkNvZGVTZXR0aW5ncykge1xyXG4gICAgICAgIF9zZXRBY3Rpb25Db2RlU2V0dGluZ3NPblJlcXVlc3QodXNlckludGVybmFsLmF1dGgsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IGVtYWlsIH0gPSBhd2FpdCBzZW5kRW1haWxWZXJpZmljYXRpb24kMSh1c2VySW50ZXJuYWwuYXV0aCwgcmVxdWVzdCk7XHJcbiAgICBpZiAoZW1haWwgIT09IHVzZXIuZW1haWwpIHtcclxuICAgICAgICBhd2FpdCB1c2VyLnJlbG9hZCgpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBTZW5kcyBhIHZlcmlmaWNhdGlvbiBlbWFpbCB0byBhIG5ldyBlbWFpbCBhZGRyZXNzLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUaGUgdXNlcidzIGVtYWlsIHdpbGwgYmUgdXBkYXRlZCB0byB0aGUgbmV3IG9uZSBhZnRlciBiZWluZyB2ZXJpZmllZC5cclxuICpcclxuICogSWYgeW91IGhhdmUgYSBjdXN0b20gZW1haWwgYWN0aW9uIGhhbmRsZXIsIHlvdSBjYW4gY29tcGxldGUgdGhlIHZlcmlmaWNhdGlvbiBwcm9jZXNzIGJ5IGNhbGxpbmdcclxuICoge0BsaW5rIGFwcGx5QWN0aW9uQ29kZX0uXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogY29uc3QgYWN0aW9uQ29kZVNldHRpbmdzID0ge1xyXG4gKiAgIHVybDogJ2h0dHBzOi8vd3d3LmV4YW1wbGUuY29tLz9lbWFpbD11c2VyQGV4YW1wbGUuY29tJyxcclxuICogICBpT1M6IHtcclxuICogICAgICBidW5kbGVJZDogJ2NvbS5leGFtcGxlLmlvcydcclxuICogICB9LFxyXG4gKiAgIGFuZHJvaWQ6IHtcclxuICogICAgIHBhY2thZ2VOYW1lOiAnY29tLmV4YW1wbGUuYW5kcm9pZCcsXHJcbiAqICAgICBpbnN0YWxsQXBwOiB0cnVlLFxyXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcclxuICogICB9LFxyXG4gKiAgIGhhbmRsZUNvZGVJbkFwcDogdHJ1ZVxyXG4gKiB9O1xyXG4gKiBhd2FpdCB2ZXJpZnlCZWZvcmVVcGRhdGVFbWFpbCh1c2VyLCAnbmV3ZW1haWxAZXhhbXBsZS5jb20nLCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xyXG4gKiAvLyBPYnRhaW4gY29kZSBmcm9tIHRoZSB1c2VyLlxyXG4gKiBhd2FpdCBhcHBseUFjdGlvbkNvZGUoYXV0aCwgY29kZSk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gbmV3RW1haWwgLSBUaGUgbmV3IGVtYWlsIGFkZHJlc3MgdG8gYmUgdmVyaWZpZWQgYmVmb3JlIHVwZGF0ZS5cclxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QmVmb3JlVXBkYXRlRW1haWwodXNlciwgbmV3RW1haWwsIGFjdGlvbkNvZGVTZXR0aW5ncykge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICByZXF1ZXN0VHlwZTogXCJWRVJJRllfQU5EX0NIQU5HRV9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwgKi8sXHJcbiAgICAgICAgaWRUb2tlbixcclxuICAgICAgICBuZXdFbWFpbFxyXG4gICAgfTtcclxuICAgIGlmIChhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgICAgICBfc2V0QWN0aW9uQ29kZVNldHRpbmdzT25SZXF1ZXN0KHVzZXJJbnRlcm5hbC5hdXRoLCByZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBlbWFpbCB9ID0gYXdhaXQgdmVyaWZ5QW5kQ2hhbmdlRW1haWwodXNlckludGVybmFsLmF1dGgsIHJlcXVlc3QpO1xyXG4gICAgaWYgKGVtYWlsICE9PSB1c2VyLmVtYWlsKSB7XHJcbiAgICAgICAgLy8gSWYgdGhlIGxvY2FsIGNvcHkgb2YgdGhlIGVtYWlsIG9uIHVzZXIgaXMgb3V0ZGF0ZWQsIHJlbG9hZCB0aGVcclxuICAgICAgICAvLyB1c2VyLlxyXG4gICAgICAgIGF3YWl0IHVzZXIucmVsb2FkKCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlUHJvZmlsZSQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czp1cGRhdGVcIiAvKiBFbmRwb2ludC5TRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVXBkYXRlcyBhIHVzZXIncyBwcm9maWxlIGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwcm9maWxlIC0gVGhlIHByb2ZpbGUncyBgZGlzcGxheU5hbWVgIGFuZCBgcGhvdG9VUkxgIHRvIHVwZGF0ZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlUHJvZmlsZSh1c2VyLCB7IGRpc3BsYXlOYW1lLCBwaG90b1VSTDogcGhvdG9VcmwgfSkge1xyXG4gICAgaWYgKGRpc3BsYXlOYW1lID09PSB1bmRlZmluZWQgJiYgcGhvdG9VcmwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VySW50ZXJuYWwuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcHJvZmlsZVJlcXVlc3QgPSB7XHJcbiAgICAgICAgaWRUb2tlbixcclxuICAgICAgICBkaXNwbGF5TmFtZSxcclxuICAgICAgICBwaG90b1VybCxcclxuICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZVxyXG4gICAgfTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlckludGVybmFsLCB1cGRhdGVQcm9maWxlJDEodXNlckludGVybmFsLmF1dGgsIHByb2ZpbGVSZXF1ZXN0KSk7XHJcbiAgICB1c2VySW50ZXJuYWwuZGlzcGxheU5hbWUgPSByZXNwb25zZS5kaXNwbGF5TmFtZSB8fCBudWxsO1xyXG4gICAgdXNlckludGVybmFsLnBob3RvVVJMID0gcmVzcG9uc2UucGhvdG9VcmwgfHwgbnVsbDtcclxuICAgIC8vIFVwZGF0ZSB0aGUgcGFzc3dvcmQgcHJvdmlkZXIgYXMgd2VsbFxyXG4gICAgY29uc3QgcGFzc3dvcmRQcm92aWRlciA9IHVzZXJJbnRlcm5hbC5wcm92aWRlckRhdGEuZmluZCgoeyBwcm92aWRlcklkIH0pID0+IHByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIiAvKiBQcm92aWRlcklkLlBBU1NXT1JEICovKTtcclxuICAgIGlmIChwYXNzd29yZFByb3ZpZGVyKSB7XHJcbiAgICAgICAgcGFzc3dvcmRQcm92aWRlci5kaXNwbGF5TmFtZSA9IHVzZXJJbnRlcm5hbC5kaXNwbGF5TmFtZTtcclxuICAgICAgICBwYXNzd29yZFByb3ZpZGVyLnBob3RvVVJMID0gdXNlckludGVybmFsLnBob3RvVVJMO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgdXNlckludGVybmFsLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShyZXNwb25zZSk7XHJcbn1cclxuLyoqXHJcbiAqIFVwZGF0ZXMgdGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBBbiBlbWFpbCB3aWxsIGJlIHNlbnQgdG8gdGhlIG9yaWdpbmFsIGVtYWlsIGFkZHJlc3MgKGlmIGl0IHdhcyBzZXQpIHRoYXQgYWxsb3dzIHRvIHJldm9rZSB0aGVcclxuICogZW1haWwgYWRkcmVzcyBjaGFuZ2UsIGluIG9yZGVyIHRvIHByb3RlY3QgdGhlbSBmcm9tIGFjY291bnQgaGlqYWNraW5nLlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBpcyBub3Qgc3VwcG9ydGVkIG9uIGFueSB7QGxpbmsgVXNlcn0gc2lnbmVkIGluIGJ5IHtAbGluayBBdXRofSBpbnN0YW5jZXNcclxuICogY3JlYXRlZCB3aXRoIGEge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxyXG4gKlxyXG4gKiBJbXBvcnRhbnQ6IHRoaXMgaXMgYSBzZWN1cml0eSBzZW5zaXRpdmUgb3BlcmF0aW9uIHRoYXQgcmVxdWlyZXMgdGhlIHVzZXIgdG8gaGF2ZSByZWNlbnRseSBzaWduZWRcclxuICogaW4uIElmIHRoaXMgcmVxdWlyZW1lbnQgaXNuJ3QgbWV0LCBhc2sgdGhlIHVzZXIgdG8gYXV0aGVudGljYXRlIGFnYWluIGFuZCB0aGVuIGNhbGxcclxuICoge0BsaW5rIHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWx9LlxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gbmV3RW1haWwgLSBUaGUgbmV3IGVtYWlsIGFkZHJlc3MuXHJcbiAqXHJcbiAqIFRocm93cyBcImF1dGgvb3BlcmF0aW9uLW5vdC1hbGxvd2VkXCIgZXJyb3Igd2hlblxyXG4gKiB7QGxpbmsgaHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2lkZW50aXR5LXBsYXRmb3JtL2RvY3MvYWRtaW4vZW1haWwtZW51bWVyYXRpb24tcHJvdGVjdGlvbiB8IEVtYWlsIEVudW1lcmF0aW9uIFByb3RlY3Rpb259XHJcbiAqIGlzIGVuYWJsZWQuXHJcbiAqIERlcHJlY2F0ZWQgLSBVc2Uge0BsaW5rIHZlcmlmeUJlZm9yZVVwZGF0ZUVtYWlsfSBpbnN0ZWFkLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiB1cGRhdGVFbWFpbCh1c2VyLCBuZXdFbWFpbCkge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKHVzZXJJbnRlcm5hbC5hdXRoLmFwcCkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IodXNlckludGVybmFsLmF1dGgpKTtcclxuICAgIH1cclxuICAgIHJldHVybiB1cGRhdGVFbWFpbE9yUGFzc3dvcmQodXNlckludGVybmFsLCBuZXdFbWFpbCwgbnVsbCk7XHJcbn1cclxuLyoqXHJcbiAqIFVwZGF0ZXMgdGhlIHVzZXIncyBwYXNzd29yZC5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSW1wb3J0YW50OiB0aGlzIGlzIGEgc2VjdXJpdHkgc2Vuc2l0aXZlIG9wZXJhdGlvbiB0aGF0IHJlcXVpcmVzIHRoZSB1c2VyIHRvIGhhdmUgcmVjZW50bHkgc2lnbmVkXHJcbiAqIGluLiBJZiB0aGlzIHJlcXVpcmVtZW50IGlzbid0IG1ldCwgYXNrIHRoZSB1c2VyIHRvIGF1dGhlbnRpY2F0ZSBhZ2FpbiBhbmQgdGhlbiBjYWxsXHJcbiAqIHtAbGluayByZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsfS5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIG5ld1Bhc3N3b3JkIC0gVGhlIG5ldyBwYXNzd29yZC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlUGFzc3dvcmQodXNlciwgbmV3UGFzc3dvcmQpIHtcclxuICAgIHJldHVybiB1cGRhdGVFbWFpbE9yUGFzc3dvcmQoZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpLCBudWxsLCBuZXdQYXNzd29yZCk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRW1haWxPclBhc3N3b3JkKHVzZXIsIGVtYWlsLCBwYXNzd29yZCkge1xyXG4gICAgY29uc3QgeyBhdXRoIH0gPSB1c2VyO1xyXG4gICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICBpZFRva2VuLFxyXG4gICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXHJcbiAgICB9O1xyXG4gICAgaWYgKGVtYWlsKSB7XHJcbiAgICAgICAgcmVxdWVzdC5lbWFpbCA9IGVtYWlsO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhc3N3b3JkKSB7XHJcbiAgICAgICAgcmVxdWVzdC5wYXNzd29yZCA9IHBhc3N3b3JkO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCB1cGRhdGVFbWFpbFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpKTtcclxuICAgIGF3YWl0IHVzZXIuX3VwZGF0ZVRva2Vuc0lmTmVjZXNzYXJ5KHJlc3BvbnNlLCAvKiByZWxvYWQgKi8gdHJ1ZSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFBhcnNlIHRoZSBgQWRkaXRpb25hbFVzZXJJbmZvYCBmcm9tIHRoZSBJRCB0b2tlbiByZXNwb25zZS5cclxuICpcclxuICovXHJcbmZ1bmN0aW9uIF9mcm9tSWRUb2tlblJlc3BvbnNlKGlkVG9rZW5SZXNwb25zZSkge1xyXG4gICAgdmFyIF9hLCBfYjtcclxuICAgIGlmICghaWRUb2tlblJlc3BvbnNlKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IHByb3ZpZGVySWQgfSA9IGlkVG9rZW5SZXNwb25zZTtcclxuICAgIGNvbnN0IHByb2ZpbGUgPSBpZFRva2VuUmVzcG9uc2UucmF3VXNlckluZm9cclxuICAgICAgICA/IEpTT04ucGFyc2UoaWRUb2tlblJlc3BvbnNlLnJhd1VzZXJJbmZvKVxyXG4gICAgICAgIDoge307XHJcbiAgICBjb25zdCBpc05ld1VzZXIgPSBpZFRva2VuUmVzcG9uc2UuaXNOZXdVc2VyIHx8XHJcbiAgICAgICAgaWRUb2tlblJlc3BvbnNlLmtpbmQgPT09IFwiaWRlbnRpdHl0b29sa2l0I1NpZ251cE5ld1VzZXJSZXNwb25zZVwiIC8qIElkVG9rZW5SZXNwb25zZUtpbmQuU2lnbnVwTmV3VXNlciAqLztcclxuICAgIGlmICghcHJvdmlkZXJJZCAmJiAoaWRUb2tlblJlc3BvbnNlID09PSBudWxsIHx8IGlkVG9rZW5SZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWRUb2tlblJlc3BvbnNlLmlkVG9rZW4pKSB7XHJcbiAgICAgICAgY29uc3Qgc2lnbkluUHJvdmlkZXIgPSAoX2IgPSAoX2EgPSBfcGFyc2VUb2tlbihpZFRva2VuUmVzcG9uc2UuaWRUb2tlbikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maXJlYmFzZSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iWydzaWduX2luX3Byb3ZpZGVyJ107XHJcbiAgICAgICAgaWYgKHNpZ25JblByb3ZpZGVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkUHJvdmlkZXJJZCA9IHNpZ25JblByb3ZpZGVyICE9PSBcImFub255bW91c1wiIC8qIFByb3ZpZGVySWQuQU5PTllNT1VTICovICYmXHJcbiAgICAgICAgICAgICAgICBzaWduSW5Qcm92aWRlciAhPT0gXCJjdXN0b21cIiAvKiBQcm92aWRlcklkLkNVU1RPTSAqL1xyXG4gICAgICAgICAgICAgICAgPyBzaWduSW5Qcm92aWRlclxyXG4gICAgICAgICAgICAgICAgOiBudWxsO1xyXG4gICAgICAgICAgICAvLyBVc2VzIGdlbmVyaWMgY2xhc3MgaW4gYWNjb3JkYW5jZSB3aXRoIHRoZSBsZWdhY3kgU0RLLlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBmaWx0ZXJlZFByb3ZpZGVySWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICghcHJvdmlkZXJJZCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgc3dpdGNoIChwcm92aWRlcklkKSB7XHJcbiAgICAgICAgY2FzZSBcImZhY2Vib29rLmNvbVwiIC8qIFByb3ZpZGVySWQuRkFDRUJPT0sgKi86XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmFjZWJvb2tBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBwcm9maWxlKTtcclxuICAgICAgICBjYXNlIFwiZ2l0aHViLmNvbVwiIC8qIFByb3ZpZGVySWQuR0lUSFVCICovOlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEdpdGh1YkFkZGl0aW9uYWxVc2VySW5mbyhpc05ld1VzZXIsIHByb2ZpbGUpO1xyXG4gICAgICAgIGNhc2UgXCJnb29nbGUuY29tXCIgLyogUHJvdmlkZXJJZC5HT09HTEUgKi86XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgR29vZ2xlQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgcHJvZmlsZSk7XHJcbiAgICAgICAgY2FzZSBcInR3aXR0ZXIuY29tXCIgLyogUHJvdmlkZXJJZC5UV0lUVEVSICovOlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFR3aXR0ZXJBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBwcm9maWxlLCBpZFRva2VuUmVzcG9uc2Uuc2NyZWVuTmFtZSB8fCBudWxsKTtcclxuICAgICAgICBjYXNlIFwiY3VzdG9tXCIgLyogUHJvdmlkZXJJZC5DVVNUT00gKi86XHJcbiAgICAgICAgY2FzZSBcImFub255bW91c1wiIC8qIFByb3ZpZGVySWQuQU5PTllNT1VTICovOlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBudWxsKTtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBwcm92aWRlcklkLCBwcm9maWxlKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvIHtcclxuICAgIGNvbnN0cnVjdG9yKGlzTmV3VXNlciwgcHJvdmlkZXJJZCwgcHJvZmlsZSA9IHt9KSB7XHJcbiAgICAgICAgdGhpcy5pc05ld1VzZXIgPSBpc05ld1VzZXI7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDtcclxuICAgICAgICB0aGlzLnByb2ZpbGUgPSBwcm9maWxlO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIEZlZGVyYXRlZEFkZGl0aW9uYWxVc2VySW5mb1dpdGhVc2VybmFtZSBleHRlbmRzIEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8ge1xyXG4gICAgY29uc3RydWN0b3IoaXNOZXdVc2VyLCBwcm92aWRlcklkLCBwcm9maWxlLCB1c2VybmFtZSkge1xyXG4gICAgICAgIHN1cGVyKGlzTmV3VXNlciwgcHJvdmlkZXJJZCwgcHJvZmlsZSk7XHJcbiAgICAgICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIEZhY2Vib29rQWRkaXRpb25hbFVzZXJJbmZvIGV4dGVuZHMgR2VuZXJpY0FkZGl0aW9uYWxVc2VySW5mbyB7XHJcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb2ZpbGUpIHtcclxuICAgICAgICBzdXBlcihpc05ld1VzZXIsIFwiZmFjZWJvb2suY29tXCIgLyogUHJvdmlkZXJJZC5GQUNFQk9PSyAqLywgcHJvZmlsZSk7XHJcbiAgICB9XHJcbn1cclxuY2xhc3MgR2l0aHViQWRkaXRpb25hbFVzZXJJbmZvIGV4dGVuZHMgRmVkZXJhdGVkQWRkaXRpb25hbFVzZXJJbmZvV2l0aFVzZXJuYW1lIHtcclxuICAgIGNvbnN0cnVjdG9yKGlzTmV3VXNlciwgcHJvZmlsZSkge1xyXG4gICAgICAgIHN1cGVyKGlzTmV3VXNlciwgXCJnaXRodWIuY29tXCIgLyogUHJvdmlkZXJJZC5HSVRIVUIgKi8sIHByb2ZpbGUsIHR5cGVvZiAocHJvZmlsZSA9PT0gbnVsbCB8fCBwcm9maWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9maWxlLmxvZ2luKSA9PT0gJ3N0cmluZycgPyBwcm9maWxlID09PSBudWxsIHx8IHByb2ZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb2ZpbGUubG9naW4gOiBudWxsKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBHb29nbGVBZGRpdGlvbmFsVXNlckluZm8gZXh0ZW5kcyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvIHtcclxuICAgIGNvbnN0cnVjdG9yKGlzTmV3VXNlciwgcHJvZmlsZSkge1xyXG4gICAgICAgIHN1cGVyKGlzTmV3VXNlciwgXCJnb29nbGUuY29tXCIgLyogUHJvdmlkZXJJZC5HT09HTEUgKi8sIHByb2ZpbGUpO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIFR3aXR0ZXJBZGRpdGlvbmFsVXNlckluZm8gZXh0ZW5kcyBGZWRlcmF0ZWRBZGRpdGlvbmFsVXNlckluZm9XaXRoVXNlcm5hbWUge1xyXG4gICAgY29uc3RydWN0b3IoaXNOZXdVc2VyLCBwcm9maWxlLCBzY3JlZW5OYW1lKSB7XHJcbiAgICAgICAgc3VwZXIoaXNOZXdVc2VyLCBcInR3aXR0ZXIuY29tXCIgLyogUHJvdmlkZXJJZC5UV0lUVEVSICovLCBwcm9maWxlLCBzY3JlZW5OYW1lKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogRXh0cmFjdHMgcHJvdmlkZXIgc3BlY2lmaWMge0BsaW5rIEFkZGl0aW9uYWxVc2VySW5mb30gZm9yIHRoZSBnaXZlbiBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRBZGRpdGlvbmFsVXNlckluZm8odXNlckNyZWRlbnRpYWwpIHtcclxuICAgIGNvbnN0IHsgdXNlciwgX3Rva2VuUmVzcG9uc2UgfSA9IHVzZXJDcmVkZW50aWFsO1xyXG4gICAgaWYgKHVzZXIuaXNBbm9ueW1vdXMgJiYgIV90b2tlblJlc3BvbnNlKSB7XHJcbiAgICAgICAgLy8gSGFuZGxlIHRoZSBzcGVjaWFsIGNhc2Ugd2hlcmUgc2lnbkluQW5vbnltb3VzbHkoKSBnZXRzIGNhbGxlZCB0d2ljZS5cclxuICAgICAgICAvLyBObyBuZXR3b3JrIGNhbGwgaXMgbWFkZSBzbyB0aGVyZSdzIG5vdGhpbmcgdG8gYWN0dWFsbHkgZmlsbCB0aGlzIGluXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogbnVsbCxcclxuICAgICAgICAgICAgaXNOZXdVc2VyOiBmYWxzZSxcclxuICAgICAgICAgICAgcHJvZmlsZTogbnVsbFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX2Zyb21JZFRva2VuUmVzcG9uc2UoX3Rva2VuUmVzcG9uc2UpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8vIE5vbi1vcHRpb25hbCBhdXRoIG1ldGhvZHMuXHJcbi8qKlxyXG4gKiBDaGFuZ2VzIHRoZSB0eXBlIG9mIHBlcnNpc3RlbmNlIG9uIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgZm9yIHRoZSBjdXJyZW50bHkgc2F2ZWRcclxuICogYEF1dGhgIHNlc3Npb24gYW5kIGFwcGxpZXMgdGhpcyB0eXBlIG9mIHBlcnNpc3RlbmNlIGZvciBmdXR1cmUgc2lnbi1pbiByZXF1ZXN0cywgaW5jbHVkaW5nXHJcbiAqIHNpZ24taW4gd2l0aCByZWRpcmVjdCByZXF1ZXN0cy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBtYWtlcyBpdCBlYXN5IGZvciBhIHVzZXIgc2lnbmluZyBpbiB0byBzcGVjaWZ5IHdoZXRoZXIgdGhlaXIgc2Vzc2lvbiBzaG91bGQgYmVcclxuICogcmVtZW1iZXJlZCBvciBub3QuIEl0IGFsc28gbWFrZXMgaXQgZWFzaWVyIHRvIG5ldmVyIHBlcnNpc3QgdGhlIGBBdXRoYCBzdGF0ZSBmb3IgYXBwbGljYXRpb25zXHJcbiAqIHRoYXQgYXJlIHNoYXJlZCBieSBvdGhlciB1c2VycyBvciBoYXZlIHNlbnNpdGl2ZSBkYXRhLlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudCBvciB3aXRoIHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGFcclxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIHNldFBlcnNpc3RlbmNlKGF1dGgsIGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UpO1xyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gcGVyc2lzdGVuY2UgLSBUaGUge0BsaW5rIFBlcnNpc3RlbmNlfSB0byB1c2UuXHJcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgb25jZSB0aGUgcGVyc2lzdGVuY2UgY2hhbmdlIGhhcyBjb21wbGV0ZWRcclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gc2V0UGVyc2lzdGVuY2UoYXV0aCwgcGVyc2lzdGVuY2UpIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuc2V0UGVyc2lzdGVuY2UocGVyc2lzdGVuY2UpO1xyXG59XHJcbi8qKlxyXG4gKiBMb2FkcyB0aGUgcmVDQVBUQ0hBIGNvbmZpZ3VyYXRpb24gaW50byB0aGUgYEF1dGhgIGluc3RhbmNlLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUaGlzIHdpbGwgbG9hZCB0aGUgcmVDQVBUQ0hBIGNvbmZpZywgd2hpY2ggaW5kaWNhdGVzIHdoZXRoZXIgdGhlIHJlQ0FQVENIQVxyXG4gKiB2ZXJpZmljYXRpb24gZmxvdyBzaG91bGQgYmUgdHJpZ2dlcmVkIGZvciBlYWNoIGF1dGggcHJvdmlkZXIsIGludG8gdGhlXHJcbiAqIGN1cnJlbnQgQXV0aCBzZXNzaW9uLlxyXG4gKlxyXG4gKiBJZiBpbml0aWFsaXplUmVjYXB0Y2hhQ29uZmlnKCkgaXMgbm90IGludm9rZWQsIHRoZSBhdXRoIGZsb3cgd2lsbCBhbHdheXMgc3RhcnRcclxuICogd2l0aG91dCByZUNBUFRDSEEgdmVyaWZpY2F0aW9uLiBJZiB0aGUgcHJvdmlkZXIgaXMgY29uZmlndXJlZCB0byByZXF1aXJlIHJlQ0FQVENIQVxyXG4gKiB2ZXJpZmljYXRpb24sIHRoZSBTREsgd2lsbCB0cmFuc3BhcmVudGx5IGxvYWQgdGhlIHJlQ0FQVENIQSBjb25maWcgYW5kIHJlc3RhcnQgdGhlXHJcbiAqIGF1dGggZmxvd3MuXHJcbiAqXHJcbiAqIFRodXMsIGJ5IGNhbGxpbmcgdGhpcyBvcHRpb25hbCBtZXRob2QsIHlvdSB3aWxsIHJlZHVjZSB0aGUgbGF0ZW5jeSBvZiBmdXR1cmUgYXV0aCBmbG93cy5cclxuICogTG9hZGluZyB0aGUgcmVDQVBUQ0hBIGNvbmZpZyBlYXJseSB3aWxsIGFsc28gZW5oYW5jZSB0aGUgc2lnbmFsIGNvbGxlY3RlZCBieSByZUNBUFRDSEEuXHJcbiAqXHJcbiAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHdvcmsgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIGluaXRpYWxpemVSZWNhcHRjaGFDb25maWcoYXV0aCk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGluaXRpYWxpemVSZWNhcHRjaGFDb25maWcoYXV0aCkge1xyXG4gICAgcmV0dXJuIF9pbml0aWFsaXplUmVjYXB0Y2hhQ29uZmlnKGF1dGgpO1xyXG59XHJcbi8qKlxyXG4gKiBWYWxpZGF0ZXMgdGhlIHBhc3N3b3JkIGFnYWluc3QgdGhlIHBhc3N3b3JkIHBvbGljeSBjb25maWd1cmVkIGZvciB0aGUgcHJvamVjdCBvciB0ZW5hbnQuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIElmIG5vIHRlbmFudCBJRCBpcyBzZXQgb24gdGhlIGBBdXRoYCBpbnN0YW5jZSwgdGhlbiB0aGlzIG1ldGhvZCB3aWxsIHVzZSB0aGUgcGFzc3dvcmRcclxuICogcG9saWN5IGNvbmZpZ3VyZWQgZm9yIHRoZSBwcm9qZWN0LiBPdGhlcndpc2UsIHRoaXMgbWV0aG9kIHdpbGwgdXNlIHRoZSBwb2xpY3kgY29uZmlndXJlZFxyXG4gKiBmb3IgdGhlIHRlbmFudC4gSWYgYSBwYXNzd29yZCBwb2xpY3kgaGFzIG5vdCBiZWVuIGNvbmZpZ3VyZWQsIHRoZW4gdGhlIGRlZmF1bHQgcG9saWN5XHJcbiAqIGNvbmZpZ3VyZWQgZm9yIGFsbCBwcm9qZWN0cyB3aWxsIGJlIHVzZWQuXHJcbiAqXHJcbiAqIElmIGFuIGF1dGggZmxvdyBmYWlscyBiZWNhdXNlIGEgc3VibWl0dGVkIHBhc3N3b3JkIGRvZXMgbm90IG1lZXQgdGhlIHBhc3N3b3JkIHBvbGljeVxyXG4gKiByZXF1aXJlbWVudHMgYW5kIHRoaXMgbWV0aG9kIGhhcyBwcmV2aW91c2x5IGJlZW4gY2FsbGVkLCB0aGVuIHRoaXMgbWV0aG9kIHdpbGwgdXNlIHRoZVxyXG4gKiBtb3N0IHJlY2VudCBwb2xpY3kgYXZhaWxhYmxlIHdoZW4gY2FsbGVkIGFnYWluLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIHZhbGlkYXRlUGFzc3dvcmQoYXV0aCwgJ3NvbWUtcGFzc3dvcmQnKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBwYXNzd29yZCBUaGUgcGFzc3dvcmQgdG8gdmFsaWRhdGUuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlUGFzc3dvcmQoYXV0aCwgcGFzc3dvcmQpIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIHJldHVybiBhdXRoSW50ZXJuYWwudmFsaWRhdGVQYXNzd29yZChwYXNzd29yZCk7XHJcbn1cclxuLyoqXHJcbiAqIEFkZHMgYW4gb2JzZXJ2ZXIgZm9yIGNoYW5nZXMgdG8gdGhlIHNpZ25lZC1pbiB1c2VyJ3MgSUQgdG9rZW4uXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoaXMgaW5jbHVkZXMgc2lnbi1pbiwgc2lnbi1vdXQsIGFuZCB0b2tlbiByZWZyZXNoIGV2ZW50cy5cclxuICogVGhpcyB3aWxsIG5vdCBiZSB0cmlnZ2VyZWQgYXV0b21hdGljYWxseSB1cG9uIElEIHRva2VuIGV4cGlyYXRpb24uIFVzZSB7QGxpbmsgVXNlci5nZXRJZFRva2VufSB0byByZWZyZXNoIHRoZSBJRCB0b2tlbi5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gbmV4dE9yT2JzZXJ2ZXIgLSBjYWxsYmFjayB0cmlnZ2VyZWQgb24gY2hhbmdlLlxyXG4gKiBAcGFyYW0gZXJyb3IgLSBEZXByZWNhdGVkLiBUaGlzIGNhbGxiYWNrIGlzIG5ldmVyIHRyaWdnZXJlZC4gRXJyb3JzXHJcbiAqIG9uIHNpZ25pbmcgaW4vb3V0IGNhbiBiZSBjYXVnaHQgaW4gcHJvbWlzZXMgcmV0dXJuZWQgZnJvbVxyXG4gKiBzaWduLWluL3NpZ24tb3V0IGZ1bmN0aW9ucy5cclxuICogQHBhcmFtIGNvbXBsZXRlZCAtIERlcHJlY2F0ZWQuIFRoaXMgY2FsbGJhY2sgaXMgbmV2ZXIgdHJpZ2dlcmVkLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBvbklkVG9rZW5DaGFuZ2VkKGF1dGgsIG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7XHJcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLm9uSWRUb2tlbkNoYW5nZWQobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpO1xyXG59XHJcbi8qKlxyXG4gKiBBZGRzIGEgYmxvY2tpbmcgY2FsbGJhY2sgdGhhdCBydW5zIGJlZm9yZSBhbiBhdXRoIHN0YXRlIGNoYW5nZVxyXG4gKiBzZXRzIGEgbmV3IHVzZXIuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGNhbGxiYWNrIC0gY2FsbGJhY2sgdHJpZ2dlcmVkIGJlZm9yZSBuZXcgdXNlciB2YWx1ZSBpcyBzZXQuXHJcbiAqICAgSWYgdGhpcyB0aHJvd3MsIGl0IGJsb2NrcyB0aGUgdXNlciBmcm9tIGJlaW5nIHNldC5cclxuICogQHBhcmFtIG9uQWJvcnQgLSBjYWxsYmFjayB0cmlnZ2VyZWQgaWYgYSBsYXRlciBgYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZCgpYFxyXG4gKiAgIGNhbGxiYWNrIHRocm93cywgYWxsb3dpbmcgeW91IHRvIHVuZG8gYW55IHNpZGUgZWZmZWN0cy5cclxuICovXHJcbmZ1bmN0aW9uIGJlZm9yZUF1dGhTdGF0ZUNoYW5nZWQoYXV0aCwgY2FsbGJhY2ssIG9uQWJvcnQpIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChjYWxsYmFjaywgb25BYm9ydCk7XHJcbn1cclxuLyoqXHJcbiAqIEFkZHMgYW4gb2JzZXJ2ZXIgZm9yIGNoYW5nZXMgdG8gdGhlIHVzZXIncyBzaWduLWluIHN0YXRlLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUbyBrZWVwIHRoZSBvbGQgYmVoYXZpb3IsIHNlZSB7QGxpbmsgb25JZFRva2VuQ2hhbmdlZH0uXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIG5leHRPck9ic2VydmVyIC0gY2FsbGJhY2sgdHJpZ2dlcmVkIG9uIGNoYW5nZS5cclxuICogQHBhcmFtIGVycm9yIC0gRGVwcmVjYXRlZC4gVGhpcyBjYWxsYmFjayBpcyBuZXZlciB0cmlnZ2VyZWQuIEVycm9yc1xyXG4gKiBvbiBzaWduaW5nIGluL291dCBjYW4gYmUgY2F1Z2h0IGluIHByb21pc2VzIHJldHVybmVkIGZyb21cclxuICogc2lnbi1pbi9zaWduLW91dCBmdW5jdGlvbnMuXHJcbiAqIEBwYXJhbSBjb21wbGV0ZWQgLSBEZXByZWNhdGVkLiBUaGlzIGNhbGxiYWNrIGlzIG5ldmVyIHRyaWdnZXJlZC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gb25BdXRoU3RhdGVDaGFuZ2VkKGF1dGgsIG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7XHJcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLm9uQXV0aFN0YXRlQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7XHJcbn1cclxuLyoqXHJcbiAqIFNldHMgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UgdG8gdGhlIGRlZmF1bHQgZGV2aWNlL2Jyb3dzZXIgcHJlZmVyZW5jZS5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiB1c2VEZXZpY2VMYW5ndWFnZShhdXRoKSB7XHJcbiAgICBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkudXNlRGV2aWNlTGFuZ3VhZ2UoKTtcclxufVxyXG4vKipcclxuICogQXN5bmNocm9ub3VzbHkgc2V0cyB0aGUgcHJvdmlkZWQgdXNlciBhcyB7QGxpbmsgQXV0aC5jdXJyZW50VXNlcn0gb24gdGhlXHJcbiAqIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICpcclxuICogQHJlbWFya3NcclxuICogQSBuZXcgaW5zdGFuY2UgY29weSBvZiB0aGUgdXNlciBwcm92aWRlZCB3aWxsIGJlIG1hZGUgYW5kIHNldCBhcyBjdXJyZW50VXNlci5cclxuICpcclxuICogVGhpcyB3aWxsIHRyaWdnZXIge0BsaW5rIG9uQXV0aFN0YXRlQ2hhbmdlZH0gYW5kIHtAbGluayBvbklkVG9rZW5DaGFuZ2VkfSBsaXN0ZW5lcnNcclxuICogbGlrZSBvdGhlciBzaWduIGluIG1ldGhvZHMuXHJcbiAqXHJcbiAqIFRoZSBvcGVyYXRpb24gZmFpbHMgd2l0aCBhbiBlcnJvciBpZiB0aGUgdXNlciB0byBiZSB1cGRhdGVkIGJlbG9uZ3MgdG8gYSBkaWZmZXJlbnQgRmlyZWJhc2VcclxuICogcHJvamVjdC5cclxuICpcclxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBieSB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXHJcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSBuZXcge0BsaW5rIFVzZXJ9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiB1cGRhdGVDdXJyZW50VXNlcihhdXRoLCB1c2VyKSB7XHJcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLnVwZGF0ZUN1cnJlbnRVc2VyKHVzZXIpO1xyXG59XHJcbi8qKlxyXG4gKiBTaWducyBvdXQgdGhlIGN1cnJlbnQgdXNlci5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBieSB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXHJcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBzaWduT3V0KGF1dGgpIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuc2lnbk91dCgpO1xyXG59XHJcbi8qKlxyXG4gKiBSZXZva2VzIHRoZSBnaXZlbiBhY2Nlc3MgdG9rZW4uIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRzIEFwcGxlIE9BdXRoIGFjY2VzcyB0b2tlbnMuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIHRva2VuIC0gVGhlIEFwcGxlIE9BdXRoIGFjY2VzcyB0b2tlbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gcmV2b2tlQWNjZXNzVG9rZW4oYXV0aCwgdG9rZW4pIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIHJldHVybiBhdXRoSW50ZXJuYWwucmV2b2tlQWNjZXNzVG9rZW4odG9rZW4pO1xyXG59XHJcbi8qKlxyXG4gKiBEZWxldGVzIGFuZCBzaWducyBvdXQgdGhlIHVzZXIuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIEltcG9ydGFudDogdGhpcyBpcyBhIHNlY3VyaXR5LXNlbnNpdGl2ZSBvcGVyYXRpb24gdGhhdCByZXF1aXJlcyB0aGUgdXNlciB0byBoYXZlIHJlY2VudGx5XHJcbiAqIHNpZ25lZCBpbi4gSWYgdGhpcyByZXF1aXJlbWVudCBpc24ndCBtZXQsIGFzayB0aGUgdXNlciB0byBhdXRoZW50aWNhdGUgYWdhaW4gYW5kIHRoZW4gY2FsbFxyXG4gKiB7QGxpbmsgcmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbH0uXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVVzZXIodXNlcikge1xyXG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKS5kZWxldGUoKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBNdWx0aUZhY3RvclNlc3Npb25JbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKHR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpIHtcclxuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgICAgIHRoaXMuY3JlZGVudGlhbCA9IGNyZWRlbnRpYWw7XHJcbiAgICAgICAgdGhpcy51c2VyID0gdXNlcjtcclxuICAgIH1cclxuICAgIHN0YXRpYyBfZnJvbUlkdG9rZW4oaWRUb2tlbiwgdXNlcikge1xyXG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JTZXNzaW9uSW1wbChcImVucm9sbFwiIC8qIE11bHRpRmFjdG9yU2Vzc2lvblR5cGUuRU5ST0xMICovLCBpZFRva2VuLCB1c2VyKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBfZnJvbU1mYVBlbmRpbmdDcmVkZW50aWFsKG1mYVBlbmRpbmdDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBNdWx0aUZhY3RvclNlc3Npb25JbXBsKFwic2lnbmluXCIgLyogTXVsdGlGYWN0b3JTZXNzaW9uVHlwZS5TSUdOX0lOICovLCBtZmFQZW5kaW5nQ3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy50eXBlID09PSBcImVucm9sbFwiIC8qIE11bHRpRmFjdG9yU2Vzc2lvblR5cGUuRU5ST0xMICovXHJcbiAgICAgICAgICAgID8gJ2lkVG9rZW4nXHJcbiAgICAgICAgICAgIDogJ3BlbmRpbmdDcmVkZW50aWFsJztcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBtdWx0aUZhY3RvclNlc3Npb246IHtcclxuICAgICAgICAgICAgICAgIFtrZXldOiB0aGlzLmNyZWRlbnRpYWxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZnJvbUpTT04ob2JqKSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICBpZiAob2JqID09PSBudWxsIHx8IG9iaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2JqLm11bHRpRmFjdG9yU2Vzc2lvbikge1xyXG4gICAgICAgICAgICBpZiAoKF9hID0gb2JqLm11bHRpRmFjdG9yU2Vzc2lvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBlbmRpbmdDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTXVsdGlGYWN0b3JTZXNzaW9uSW1wbC5fZnJvbU1mYVBlbmRpbmdDcmVkZW50aWFsKG9iai5tdWx0aUZhY3RvclNlc3Npb24ucGVuZGluZ0NyZWRlbnRpYWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKChfYiA9IG9iai5tdWx0aUZhY3RvclNlc3Npb24pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pZFRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTXVsdGlGYWN0b3JTZXNzaW9uSW1wbC5fZnJvbUlkdG9rZW4ob2JqLm11bHRpRmFjdG9yU2Vzc2lvbi5pZFRva2VuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBNdWx0aUZhY3RvclJlc29sdmVySW1wbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXNzaW9uLCBoaW50cywgc2lnbkluUmVzb2x2ZXIpIHtcclxuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xyXG4gICAgICAgIHRoaXMuaGludHMgPSBoaW50cztcclxuICAgICAgICB0aGlzLnNpZ25JblJlc29sdmVyID0gc2lnbkluUmVzb2x2ZXI7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBzdGF0aWMgX2Zyb21FcnJvcihhdXRoRXh0ZXJuLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IGF1dGggPSBfY2FzdEF1dGgoYXV0aEV4dGVybik7XHJcbiAgICAgICAgY29uc3Qgc2VydmVyUmVzcG9uc2UgPSBlcnJvci5jdXN0b21EYXRhLl9zZXJ2ZXJSZXNwb25zZTtcclxuICAgICAgICBjb25zdCBoaW50cyA9IChzZXJ2ZXJSZXNwb25zZS5tZmFJbmZvIHx8IFtdKS5tYXAoZW5yb2xsbWVudCA9PiBNdWx0aUZhY3RvckluZm9JbXBsLl9mcm9tU2VydmVyUmVzcG9uc2UoYXV0aCwgZW5yb2xsbWVudCkpO1xyXG4gICAgICAgIF9hc3NlcnQoc2VydmVyUmVzcG9uc2UubWZhUGVuZGluZ0NyZWRlbnRpYWwsIGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICBjb25zdCBzZXNzaW9uID0gTXVsdGlGYWN0b3JTZXNzaW9uSW1wbC5fZnJvbU1mYVBlbmRpbmdDcmVkZW50aWFsKHNlcnZlclJlc3BvbnNlLm1mYVBlbmRpbmdDcmVkZW50aWFsKTtcclxuICAgICAgICByZXR1cm4gbmV3IE11bHRpRmFjdG9yUmVzb2x2ZXJJbXBsKHNlc3Npb24sIGhpbnRzLCBhc3luYyAoYXNzZXJ0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1mYVJlc3BvbnNlID0gYXdhaXQgYXNzZXJ0aW9uLl9wcm9jZXNzKGF1dGgsIHNlc3Npb24pO1xyXG4gICAgICAgICAgICAvLyBDbGVhciBvdXQgdGhlIHVubmVlZGVkIGZpZWxkcyBmcm9tIHRoZSBvbGQgbG9naW4gcmVzcG9uc2VcclxuICAgICAgICAgICAgZGVsZXRlIHNlcnZlclJlc3BvbnNlLm1mYUluZm87XHJcbiAgICAgICAgICAgIGRlbGV0ZSBzZXJ2ZXJSZXNwb25zZS5tZmFQZW5kaW5nQ3JlZGVudGlhbDtcclxuICAgICAgICAgICAgLy8gVXNlIGluIHRoZSBuZXcgdG9rZW4gJiByZWZyZXNoIHRva2VuIGluIHRoZSBvbGQgcmVzcG9uc2VcclxuICAgICAgICAgICAgY29uc3QgaWRUb2tlblJlc3BvbnNlID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBzZXJ2ZXJSZXNwb25zZSksIHsgaWRUb2tlbjogbWZhUmVzcG9uc2UuaWRUb2tlbiwgcmVmcmVzaFRva2VuOiBtZmFSZXNwb25zZS5yZWZyZXNoVG9rZW4gfSk7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IHdlIHNob3VsZCBjb2xsYXBzZSB0aGlzIHN3aXRjaCBzdGF0ZW1lbnQgaW50byBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbiBhbmQgaGF2ZSBpdCBzdXBwb3J0IHRoZSBTSUdOX0lOIGNhc2VcclxuICAgICAgICAgICAgc3dpdGNoIChlcnJvci5vcGVyYXRpb25UeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwic2lnbkluXCIgLyogT3BlcmF0aW9uVHlwZS5TSUdOX0lOICovOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGgsIGVycm9yLm9wZXJhdGlvblR5cGUsIGlkVG9rZW5SZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXV0aC5fdXBkYXRlQ3VycmVudFVzZXIodXNlckNyZWRlbnRpYWwudXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJDcmVkZW50aWFsO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInJlYXV0aGVudGljYXRlXCIgLyogT3BlcmF0aW9uVHlwZS5SRUFVVEhFTlRJQ0FURSAqLzpcclxuICAgICAgICAgICAgICAgICAgICBfYXNzZXJ0KGVycm9yLnVzZXIsIGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gVXNlckNyZWRlbnRpYWxJbXBsLl9mb3JPcGVyYXRpb24oZXJyb3IudXNlciwgZXJyb3Iub3BlcmF0aW9uVHlwZSwgaWRUb2tlblJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgX2ZhaWwoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyByZXNvbHZlU2lnbkluKGFzc2VydGlvbkV4dGVybikge1xyXG4gICAgICAgIGNvbnN0IGFzc2VydGlvbiA9IGFzc2VydGlvbkV4dGVybjtcclxuICAgICAgICByZXR1cm4gdGhpcy5zaWduSW5SZXNvbHZlcihhc3NlcnRpb24pO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBQcm92aWRlcyBhIHtAbGluayBNdWx0aUZhY3RvclJlc29sdmVyfSBzdWl0YWJsZSBmb3IgY29tcGxldGlvbiBvZiBhXHJcbiAqIG11bHRpLWZhY3RvciBmbG93LlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBlcnJvciAtIFRoZSB7QGxpbmsgTXVsdGlGYWN0b3JFcnJvcn0gcmFpc2VkIGR1cmluZyBhIHNpZ24taW4sIG9yXHJcbiAqIHJlYXV0aGVudGljYXRpb24gb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRNdWx0aUZhY3RvclJlc29sdmVyKGF1dGgsIGVycm9yKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICBjb25zdCBhdXRoTW9kdWxhciA9IGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKTtcclxuICAgIGNvbnN0IGVycm9ySW50ZXJuYWwgPSBlcnJvcjtcclxuICAgIF9hc3NlcnQoZXJyb3IuY3VzdG9tRGF0YS5vcGVyYXRpb25UeXBlLCBhdXRoTW9kdWxhciwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgX2Fzc2VydCgoX2EgPSBlcnJvckludGVybmFsLmN1c3RvbURhdGEuX3NlcnZlclJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWZhUGVuZGluZ0NyZWRlbnRpYWwsIGF1dGhNb2R1bGFyLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICByZXR1cm4gTXVsdGlGYWN0b3JSZXNvbHZlckltcGwuX2Zyb21FcnJvcihhdXRoTW9kdWxhciwgZXJyb3JJbnRlcm5hbCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gc3RhcnRFbnJvbGxQaG9uZU1mYShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhRW5yb2xsbWVudDpzdGFydFwiIC8qIEVuZHBvaW50LlNUQVJUX01GQV9FTlJPTExNRU5UICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmFsaXplRW5yb2xsUGhvbmVNZmEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYUVucm9sbG1lbnQ6ZmluYWxpemVcIiAvKiBFbmRwb2ludC5GSU5BTElaRV9NRkFfRU5ST0xMTUVOVCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxyXG5mdW5jdGlvbiBzdGFydEVucm9sbFRvdHBNZmEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYUVucm9sbG1lbnQ6c3RhcnRcIiAvKiBFbmRwb2ludC5TVEFSVF9NRkFfRU5ST0xMTUVOVCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxyXG5mdW5jdGlvbiBmaW5hbGl6ZUVucm9sbFRvdHBNZmEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYUVucm9sbG1lbnQ6ZmluYWxpemVcIiAvKiBFbmRwb2ludC5GSU5BTElaRV9NRkFfRU5ST0xMTUVOVCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxyXG5mdW5jdGlvbiB3aXRoZHJhd01mYShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhRW5yb2xsbWVudDp3aXRoZHJhd1wiIC8qIEVuZHBvaW50LldJVEhEUkFXX01GQSAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxuXG5jbGFzcyBNdWx0aUZhY3RvclVzZXJJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKHVzZXIpIHtcclxuICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgIHRoaXMuZW5yb2xsZWRGYWN0b3JzID0gW107XHJcbiAgICAgICAgdXNlci5fb25SZWxvYWQodXNlckluZm8gPT4ge1xyXG4gICAgICAgICAgICBpZiAodXNlckluZm8ubWZhSW5mbykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbnJvbGxlZEZhY3RvcnMgPSB1c2VySW5mby5tZmFJbmZvLm1hcChlbnJvbGxtZW50ID0+IE11bHRpRmFjdG9ySW5mb0ltcGwuX2Zyb21TZXJ2ZXJSZXNwb25zZSh1c2VyLmF1dGgsIGVucm9sbG1lbnQpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIF9mcm9tVXNlcih1c2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBNdWx0aUZhY3RvclVzZXJJbXBsKHVzZXIpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0U2Vzc2lvbigpIHtcclxuICAgICAgICByZXR1cm4gTXVsdGlGYWN0b3JTZXNzaW9uSW1wbC5fZnJvbUlkdG9rZW4oYXdhaXQgdGhpcy51c2VyLmdldElkVG9rZW4oKSwgdGhpcy51c2VyKTtcclxuICAgIH1cclxuICAgIGFzeW5jIGVucm9sbChhc3NlcnRpb25FeHRlcm4sIGRpc3BsYXlOYW1lKSB7XHJcbiAgICAgICAgY29uc3QgYXNzZXJ0aW9uID0gYXNzZXJ0aW9uRXh0ZXJuO1xyXG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSAoYXdhaXQgdGhpcy5nZXRTZXNzaW9uKCkpO1xyXG4gICAgICAgIGNvbnN0IGZpbmFsaXplTWZhUmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLnVzZXIsIGFzc2VydGlvbi5fcHJvY2Vzcyh0aGlzLnVzZXIuYXV0aCwgc2Vzc2lvbiwgZGlzcGxheU5hbWUpKTtcclxuICAgICAgICAvLyBOZXcgdG9rZW5zIHdpbGwgYmUgaXNzdWVkIGFmdGVyIGVucm9sbG1lbnQgb2YgdGhlIG5ldyBzZWNvbmQgZmFjdG9ycy5cclxuICAgICAgICAvLyBUaGV5IG5lZWQgdG8gYmUgdXBkYXRlZCBvbiB0aGUgdXNlci5cclxuICAgICAgICBhd2FpdCB0aGlzLnVzZXIuX3VwZGF0ZVRva2Vuc0lmTmVjZXNzYXJ5KGZpbmFsaXplTWZhUmVzcG9uc2UpO1xyXG4gICAgICAgIC8vIFRoZSB1c2VyIG5lZWRzIHRvIGJlIHJlbG9hZGVkIHRvIGdldCB0aGUgbmV3IG11bHRpLWZhY3RvciBpbmZvcm1hdGlvblxyXG4gICAgICAgIC8vIGZyb20gc2VydmVyLiBVU0VSX1JFTE9BREVEIGV2ZW50IHdpbGwgYmUgdHJpZ2dlcmVkIGFuZCBgZW5yb2xsZWRGYWN0b3JzYFxyXG4gICAgICAgIC8vIHdpbGwgYmUgdXBkYXRlZC5cclxuICAgICAgICByZXR1cm4gdGhpcy51c2VyLnJlbG9hZCgpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgdW5lbnJvbGwoaW5mb09yVWlkKSB7XHJcbiAgICAgICAgY29uc3QgbWZhRW5yb2xsbWVudElkID0gdHlwZW9mIGluZm9PclVpZCA9PT0gJ3N0cmluZycgPyBpbmZvT3JVaWQgOiBpbmZvT3JVaWQudWlkO1xyXG4gICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLnVzZXIuZ2V0SWRUb2tlbigpO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkVG9rZW5SZXNwb25zZSA9IGF3YWl0IF9sb2dvdXRJZkludmFsaWRhdGVkKHRoaXMudXNlciwgd2l0aGRyYXdNZmEodGhpcy51c2VyLmF1dGgsIHtcclxuICAgICAgICAgICAgICAgIGlkVG9rZW4sXHJcbiAgICAgICAgICAgICAgICBtZmFFbnJvbGxtZW50SWRcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNlY29uZCBmYWN0b3IgZnJvbSB0aGUgdXNlcidzIGxpc3QuXHJcbiAgICAgICAgICAgIHRoaXMuZW5yb2xsZWRGYWN0b3JzID0gdGhpcy5lbnJvbGxlZEZhY3RvcnMuZmlsdGVyKCh7IHVpZCB9KSA9PiB1aWQgIT09IG1mYUVucm9sbG1lbnRJZCk7XHJcbiAgICAgICAgICAgIC8vIERlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBiYWNrZW5kIGRlY2lkZWQgdG8gcmV2b2tlIHRoZSB1c2VyJ3Mgc2Vzc2lvbixcclxuICAgICAgICAgICAgLy8gdGhlIHRva2VuUmVzcG9uc2UgbWF5IGJlIGVtcHR5LiBJZiB0aGUgdG9rZW5zIHdlcmUgbm90IHVwZGF0ZWQgKGFuZCB0aGV5XHJcbiAgICAgICAgICAgIC8vIGFyZSBub3cgaW52YWxpZCksIHJlbG9hZGluZyB0aGUgdXNlciB3aWxsIGRpc2NvdmVyIHRoaXMgYW5kIGludmFsaWRhdGVcclxuICAgICAgICAgICAgLy8gdGhlIHVzZXIncyBzdGF0ZSBhY2NvcmRpbmdseS5cclxuICAgICAgICAgICAgYXdhaXQgdGhpcy51c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShpZFRva2VuUmVzcG9uc2UpO1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnVzZXIucmVsb2FkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmNvbnN0IG11bHRpRmFjdG9yVXNlckNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuLyoqXHJcbiAqIFRoZSB7QGxpbmsgTXVsdGlGYWN0b3JVc2VyfSBjb3JyZXNwb25kaW5nIHRvIHRoZSB1c2VyLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUaGlzIGlzIHVzZWQgdG8gYWNjZXNzIGFsbCBtdWx0aS1mYWN0b3IgcHJvcGVydGllcyBhbmQgb3BlcmF0aW9ucyByZWxhdGVkIHRvIHRoZSB1c2VyLlxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBtdWx0aUZhY3Rvcih1c2VyKSB7XHJcbiAgICBjb25zdCB1c2VyTW9kdWxhciA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGlmICghbXVsdGlGYWN0b3JVc2VyQ2FjaGUuaGFzKHVzZXJNb2R1bGFyKSkge1xyXG4gICAgICAgIG11bHRpRmFjdG9yVXNlckNhY2hlLnNldCh1c2VyTW9kdWxhciwgTXVsdGlGYWN0b3JVc2VySW1wbC5fZnJvbVVzZXIodXNlck1vZHVsYXIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBtdWx0aUZhY3RvclVzZXJDYWNoZS5nZXQodXNlck1vZHVsYXIpO1xyXG59XG5cbmNvbnN0IFNUT1JBR0VfQVZBSUxBQkxFX0tFWSA9ICdfX3Nhayc7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8vIFRoZXJlIGFyZSB0d28gZGlmZmVyZW50IGJyb3dzZXIgcGVyc2lzdGVuY2UgdHlwZXM6IGxvY2FsIGFuZCBzZXNzaW9uLlxyXG4vLyBCb3RoIGhhdmUgdGhlIHNhbWUgaW1wbGVtZW50YXRpb24gYnV0IHVzZSBhIGRpZmZlcmVudCB1bmRlcmx5aW5nIHN0b3JhZ2VcclxuLy8gb2JqZWN0LlxyXG5jbGFzcyBCcm93c2VyUGVyc2lzdGVuY2VDbGFzcyB7XHJcbiAgICBjb25zdHJ1Y3RvcihzdG9yYWdlUmV0cmlldmVyLCB0eXBlKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yYWdlUmV0cmlldmVyID0gc3RvcmFnZVJldHJpZXZlcjtcclxuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgfVxyXG4gICAgX2lzQXZhaWxhYmxlKCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zdG9yYWdlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0FWQUlMQUJMRV9LRVksICcxJyk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKFNUT1JBR0VfQVZBSUxBQkxFX0tFWSk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBfc2V0KGtleSwgdmFsdWUpIHtcclxuICAgICAgICB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfVxyXG4gICAgX2dldChrZXkpIHtcclxuICAgICAgICBjb25zdCBqc29uID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGpzb24gPyBKU09OLnBhcnNlKGpzb24pIDogbnVsbCk7XHJcbiAgICB9XHJcbiAgICBfcmVtb3ZlKGtleSkge1xyXG4gICAgICAgIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfVxyXG4gICAgZ2V0IHN0b3JhZ2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZVJldHJpZXZlcigpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8vIFRoZSBwb2xsaW5nIHBlcmlvZCBpbiBjYXNlIGV2ZW50cyBhcmUgbm90IHN1cHBvcnRlZFxyXG5jb25zdCBfUE9MTElOR19JTlRFUlZBTF9NUyQxID0gMTAwMDtcclxuLy8gVGhlIElFIDEwIGxvY2FsU3RvcmFnZSBjcm9zcyB0YWIgc3luY2hyb25pemF0aW9uIGRlbGF5IGluIG1pbGxpc2Vjb25kc1xyXG5jb25zdCBJRTEwX0xPQ0FMX1NUT1JBR0VfU1lOQ19ERUxBWSA9IDEwO1xyXG5jbGFzcyBCcm93c2VyTG9jYWxQZXJzaXN0ZW5jZSBleHRlbmRzIEJyb3dzZXJQZXJzaXN0ZW5jZUNsYXNzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKCgpID0+IHdpbmRvdy5sb2NhbFN0b3JhZ2UsIFwiTE9DQUxcIiAvKiBQZXJzaXN0ZW5jZVR5cGUuTE9DQUwgKi8pO1xyXG4gICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXIgPSAoZXZlbnQsIHBvbGwpID0+IHRoaXMub25TdG9yYWdlRXZlbnQoZXZlbnQsIHBvbGwpO1xyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307XHJcbiAgICAgICAgdGhpcy5sb2NhbENhY2hlID0ge307XHJcbiAgICAgICAgLy8gc2V0VGltZW91dCByZXR1cm4gdmFsdWUgaXMgcGxhdGZvcm0gc3BlY2lmaWNcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgICAgIHRoaXMucG9sbFRpbWVyID0gbnVsbDtcclxuICAgICAgICAvLyBXaGV0aGVyIHRvIHVzZSBwb2xsaW5nIGluc3RlYWQgb2YgZGVwZW5kaW5nIG9uIHdpbmRvdyBldmVudHNcclxuICAgICAgICB0aGlzLmZhbGxiYWNrVG9Qb2xsaW5nID0gX2lzTW9iaWxlQnJvd3NlcigpO1xyXG4gICAgICAgIHRoaXMuX3Nob3VsZEFsbG93TWlncmF0aW9uID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIGZvckFsbENoYW5nZWRLZXlzKGNiKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgYWxsIGtleXMgd2l0aCBsaXN0ZW5lcnMgb24gdGhlbS5cclxuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyh0aGlzLmxpc3RlbmVycykpIHtcclxuICAgICAgICAgICAgLy8gR2V0IHZhbHVlIGZyb20gbG9jYWxTdG9yYWdlLlxyXG4gICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5sb2NhbENhY2hlW2tleV07XHJcbiAgICAgICAgICAgIC8vIElmIGxvY2FsIG1hcCB2YWx1ZSBkb2VzIG5vdCBtYXRjaCwgdHJpZ2dlciBsaXN0ZW5lciB3aXRoIHN0b3JhZ2UgZXZlbnQuXHJcbiAgICAgICAgICAgIC8vIERpZmZlcmVudGlhdGUgdGhpcyBzaW11bGF0ZWQgZXZlbnQgZnJvbSB0aGUgcmVhbCBzdG9yYWdlIGV2ZW50LlxyXG4gICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBjYihrZXksIG9sZFZhbHVlLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvblN0b3JhZ2VFdmVudChldmVudCwgcG9sbCA9IGZhbHNlKSB7XHJcbiAgICAgICAgLy8gS2V5IHdvdWxkIGJlIG51bGwgaW4gc29tZSBzaXR1YXRpb25zLCBsaWtlIHdoZW4gbG9jYWxTdG9yYWdlIGlzIGNsZWFyZWRcclxuICAgICAgICBpZiAoIWV2ZW50LmtleSkge1xyXG4gICAgICAgICAgICB0aGlzLmZvckFsbENoYW5nZWRLZXlzKChrZXksIF9vbGRWYWx1ZSwgbmV3VmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKGtleSwgbmV3VmFsdWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBrZXkgPSBldmVudC5rZXk7XHJcbiAgICAgICAgLy8gQ2hlY2sgdGhlIG1lY2hhbmlzbSBob3cgdGhpcyBldmVudCB3YXMgZGV0ZWN0ZWQuXHJcbiAgICAgICAgLy8gVGhlIGZpcnN0IGV2ZW50IHdpbGwgZGljdGF0ZSB0aGUgbWVjaGFuaXNtIHRvIGJlIHVzZWQuXHJcbiAgICAgICAgaWYgKHBvbGwpIHtcclxuICAgICAgICAgICAgLy8gRW52aXJvbm1lbnQgZGV0ZWN0cyBzdG9yYWdlIGNoYW5nZXMgdmlhIHBvbGxpbmcuXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSBzdG9yYWdlIGV2ZW50IGxpc3RlbmVyIHRvIHByZXZlbnQgcG9zc2libGUgZXZlbnQgZHVwbGljYXRpb24uXHJcbiAgICAgICAgICAgIHRoaXMuZGV0YWNoTGlzdGVuZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEVudmlyb25tZW50IGRldGVjdHMgc3RvcmFnZSBjaGFuZ2VzIHZpYSBzdG9yYWdlIGV2ZW50IGxpc3RlbmVyLlxyXG4gICAgICAgICAgICAvLyBSZW1vdmUgcG9sbGluZyBsaXN0ZW5lciB0byBwcmV2ZW50IHBvc3NpYmxlIGV2ZW50IGR1cGxpY2F0aW9uLlxyXG4gICAgICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRyaWdnZXJMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIEtlZXAgbG9jYWwgbWFwIHVwIHRvIGRhdGUgaW4gY2FzZSBzdG9yYWdlIGV2ZW50IGlzIHRyaWdnZXJlZCBiZWZvcmVcclxuICAgICAgICAgICAgLy8gcG9sbC5cclxuICAgICAgICAgICAgY29uc3Qgc3RvcmVkVmFsdWUgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgICAgICBpZiAoIXBvbGwgJiYgdGhpcy5sb2NhbENhY2hlW2tleV0gPT09IHN0b3JlZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZWFsIHN0b3JhZ2UgZXZlbnQgd2hpY2ggaGFzIGFscmVhZHkgYmVlbiBkZXRlY3RlZCwgZG8gbm90aGluZy5cclxuICAgICAgICAgICAgICAgIC8vIFRoaXMgc2VlbXMgdG8gdHJpZ2dlciBpbiBzb21lIElFIGJyb3dzZXJzIGZvciBzb21lIHJlYXNvbi5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhrZXksIHN0b3JlZFZhbHVlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHN0b3JlZFZhbHVlID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICBpZiAoX2lzSUUxMCgpICYmXHJcbiAgICAgICAgICAgIHN0b3JlZFZhbHVlICE9PSBldmVudC5uZXdWYWx1ZSAmJlxyXG4gICAgICAgICAgICBldmVudC5uZXdWYWx1ZSAhPT0gZXZlbnQub2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gSUUgMTAgaGFzIHRoaXMgd2VpcmQgYnVnIHdoZXJlIGEgc3RvcmFnZSBldmVudCB3b3VsZCB0cmlnZ2VyIHdpdGggdGhlXHJcbiAgICAgICAgICAgIC8vIGNvcnJlY3Qga2V5LCBvbGRWYWx1ZSBhbmQgbmV3VmFsdWUgYnV0IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgZG9lc1xyXG4gICAgICAgICAgICAvLyBub3QgeWllbGQgdGhlIHVwZGF0ZWQgdmFsdWUgdW50aWwgYSBmZXcgbWlsbGlzZWNvbmRzLiBUaGlzIGVuc3VyZXNcclxuICAgICAgICAgICAgLy8gdGhpcyByZWNvdmVycyBmcm9tIHRoYXQgc2l0dWF0aW9uLlxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KHRyaWdnZXJMaXN0ZW5lcnMsIElFMTBfTE9DQUxfU1RPUkFHRV9TWU5DX0RFTEFZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRyaWdnZXJMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBub3RpZnlMaXN0ZW5lcnMoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnNba2V5XTtcclxuICAgICAgICBpZiAobGlzdGVuZXJzKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgQXJyYXkuZnJvbShsaXN0ZW5lcnMpKSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0ZW5lcih2YWx1ZSA/IEpTT04ucGFyc2UodmFsdWUpIDogdmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhcnRQb2xsaW5nKCkge1xyXG4gICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTtcclxuICAgICAgICB0aGlzLnBvbGxUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5mb3JBbGxDaGFuZ2VkS2V5cygoa2V5LCBvbGRWYWx1ZSwgbmV3VmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMub25TdG9yYWdlRXZlbnQobmV3IFN0b3JhZ2VFdmVudCgnc3RvcmFnZScsIHtcclxuICAgICAgICAgICAgICAgICAgICBrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVcclxuICAgICAgICAgICAgICAgIH0pLCBcclxuICAgICAgICAgICAgICAgIC8qIHBvbGwgKi8gdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIF9QT0xMSU5HX0lOVEVSVkFMX01TJDEpO1xyXG4gICAgfVxyXG4gICAgc3RvcFBvbGxpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucG9sbFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnBvbGxUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXR0YWNoTGlzdGVuZXIoKSB7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTtcclxuICAgIH1cclxuICAgIGRldGFjaExpc3RlbmVyKCkge1xyXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzdG9yYWdlJywgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcik7XHJcbiAgICB9XHJcbiAgICBfYWRkTGlzdGVuZXIoa2V5LCBsaXN0ZW5lcikge1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmxpc3RlbmVycykubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIC8vIFdoZXRoZXIgYnJvd3NlciBjYW4gZGV0ZWN0IHN0b3JhZ2UgZXZlbnQgd2hlbiBpdCBoYWQgYWxyZWFkeSBiZWVuIHB1c2hlZCB0byB0aGUgYmFja2dyb3VuZC5cclxuICAgICAgICAgICAgLy8gVGhpcyBtYXkgaGFwcGVuIGluIHNvbWUgbW9iaWxlIGJyb3dzZXJzLiBBIGxvY2FsU3RvcmFnZSBjaGFuZ2UgaW4gdGhlIGZvcmVncm91bmQgd2luZG93XHJcbiAgICAgICAgICAgIC8vIHdpbGwgbm90IGJlIGRldGVjdGVkIGluIHRoZSBiYWNrZ3JvdW5kIHdpbmRvdyB2aWEgdGhlIHN0b3JhZ2UgZXZlbnQuXHJcbiAgICAgICAgICAgIC8vIFRoaXMgd2FzIGRldGVjdGVkIGluIGlPUyA3LnggbW9iaWxlIGJyb3dzZXJzXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZhbGxiYWNrVG9Qb2xsaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0UG9sbGluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2hMaXN0ZW5lcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5saXN0ZW5lcnNba2V5XSkge1xyXG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldID0gbmV3IFNldCgpO1xyXG4gICAgICAgICAgICAvLyBQb3B1bGF0ZSB0aGUgY2FjaGUgdG8gYXZvaWQgc3B1cmlvdXNseSB0cmlnZ2VyaW5nIG9uIGZpcnN0IHBvbGwuXHJcbiAgICAgICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XS5hZGQobGlzdGVuZXIpO1xyXG4gICAgfVxyXG4gICAgX3JlbW92ZUxpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNba2V5XSkge1xyXG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldLmRlbGV0ZShsaXN0ZW5lcik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RlbmVyc1trZXldLnNpemUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmxpc3RlbmVyc1trZXldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmxpc3RlbmVycykubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGV0YWNoTGlzdGVuZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5zdG9wUG9sbGluZygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIFVwZGF0ZSBsb2NhbCBjYWNoZSBvbiBiYXNlIG9wZXJhdGlvbnM6XHJcbiAgICBhc3luYyBfc2V0KGtleSwgdmFsdWUpIHtcclxuICAgICAgICBhd2FpdCBzdXBlci5fc2V0KGtleSwgdmFsdWUpO1xyXG4gICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX2dldChrZXkpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHN1cGVyLl9nZXQoa2V5KTtcclxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfcmVtb3ZlKGtleSkge1xyXG4gICAgICAgIGF3YWl0IHN1cGVyLl9yZW1vdmUoa2V5KTtcclxuICAgICAgICBkZWxldGUgdGhpcy5sb2NhbENhY2hlW2tleV07XHJcbiAgICB9XHJcbn1cclxuQnJvd3NlckxvY2FsUGVyc2lzdGVuY2UudHlwZSA9ICdMT0NBTCc7XHJcbi8qKlxyXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIHR5cGUgYExPQ0FMYCB1c2luZyBgbG9jYWxTdG9yYWdlYFxyXG4gKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgYnJvd3NlckxvY2FsUGVyc2lzdGVuY2UgPSBCcm93c2VyTG9jYWxQZXJzaXN0ZW5jZTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgQnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZSBleHRlbmRzIEJyb3dzZXJQZXJzaXN0ZW5jZUNsYXNzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKCgpID0+IHdpbmRvdy5zZXNzaW9uU3RvcmFnZSwgXCJTRVNTSU9OXCIgLyogUGVyc2lzdGVuY2VUeXBlLlNFU1NJT04gKi8pO1xyXG4gICAgfVxyXG4gICAgX2FkZExpc3RlbmVyKF9rZXksIF9saXN0ZW5lcikge1xyXG4gICAgICAgIC8vIExpc3RlbmVycyBhcmUgbm90IHN1cHBvcnRlZCBmb3Igc2Vzc2lvbiBzdG9yYWdlIHNpbmNlIGl0IGNhbm5vdCBiZSBzaGFyZWQgYWNyb3NzIHdpbmRvd3NcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBfcmVtb3ZlTGlzdGVuZXIoX2tleSwgX2xpc3RlbmVyKSB7XHJcbiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBzZXNzaW9uIHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93c1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxufVxyXG5Ccm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlLnR5cGUgPSAnU0VTU0lPTic7XHJcbi8qKlxyXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIGBTRVNTSU9OYCB1c2luZyBgc2Vzc2lvblN0b3JhZ2VgXHJcbiAqIGZvciB0aGUgdW5kZXJseWluZyBzdG9yYWdlLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBicm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlID0gQnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFNoaW0gZm9yIFByb21pc2UuYWxsU2V0dGxlZCwgbm90ZSB0aGUgc2xpZ2h0bHkgZGlmZmVyZW50IGZvcm1hdCBvZiBgZnVsZmlsbGVkYCB2cyBgc3RhdHVzYC5cclxuICpcclxuICogQHBhcmFtIHByb21pc2VzIC0gQXJyYXkgb2YgcHJvbWlzZXMgdG8gd2FpdCBvbi5cclxuICovXHJcbmZ1bmN0aW9uIF9hbGxTZXR0bGVkKHByb21pc2VzKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMubWFwKGFzeW5jIChwcm9taXNlKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCBwcm9taXNlO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZnVsZmlsbGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdmFsdWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKHJlYXNvbikge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZnVsZmlsbGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlYXNvblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH0pKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogSW50ZXJmYWNlIGNsYXNzIGZvciByZWNlaXZpbmcgbWVzc2FnZXMuXHJcbiAqXHJcbiAqL1xyXG5jbGFzcyBSZWNlaXZlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihldmVudFRhcmdldCkge1xyXG4gICAgICAgIHRoaXMuZXZlbnRUYXJnZXQgPSBldmVudFRhcmdldDtcclxuICAgICAgICB0aGlzLmhhbmRsZXJzTWFwID0ge307XHJcbiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlciA9IHRoaXMuaGFuZGxlRXZlbnQuYmluZCh0aGlzKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogT2J0YWluIGFuIGluc3RhbmNlIG9mIGEgUmVjZWl2ZXIgZm9yIGEgZ2l2ZW4gZXZlbnQgdGFyZ2V0LCBpZiBub25lIGV4aXN0cyBpdCB3aWxsIGJlIGNyZWF0ZWQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGV2ZW50VGFyZ2V0IC0gQW4gZXZlbnQgdGFyZ2V0IChzdWNoIGFzIHdpbmRvdyBvciBzZWxmKSB0aHJvdWdoIHdoaWNoIHRoZSB1bmRlcmx5aW5nXHJcbiAgICAgKiBtZXNzYWdlcyB3aWxsIGJlIHJlY2VpdmVkLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgX2dldEluc3RhbmNlKGV2ZW50VGFyZ2V0KSB7XHJcbiAgICAgICAgLy8gVGhlIHJlc3VsdHMgYXJlIHN0b3JlZCBpbiBhbiBhcnJheSBzaW5jZSBvYmplY3RzIGNhbid0IGJlIGtleXMgZm9yIG90aGVyXHJcbiAgICAgICAgLy8gb2JqZWN0cy4gSW4gYWRkaXRpb24sIHNldHRpbmcgYSB1bmlxdWUgcHJvcGVydHkgb24gYW4gZXZlbnQgdGFyZ2V0IGFzIGFcclxuICAgICAgICAvLyBoYXNoIG1hcCBrZXkgbWF5IG5vdCBiZSBhbGxvd2VkIGR1ZSB0byBDT1JTIHJlc3RyaWN0aW9ucy5cclxuICAgICAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5yZWNlaXZlcnMuZmluZChyZWNlaXZlciA9PiByZWNlaXZlci5pc0xpc3RlbmluZ3RvKGV2ZW50VGFyZ2V0KSk7XHJcbiAgICAgICAgaWYgKGV4aXN0aW5nSW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nSW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG5ld0luc3RhbmNlID0gbmV3IFJlY2VpdmVyKGV2ZW50VGFyZ2V0KTtcclxuICAgICAgICB0aGlzLnJlY2VpdmVycy5wdXNoKG5ld0luc3RhbmNlKTtcclxuICAgICAgICByZXR1cm4gbmV3SW5zdGFuY2U7XHJcbiAgICB9XHJcbiAgICBpc0xpc3RlbmluZ3RvKGV2ZW50VGFyZ2V0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRUYXJnZXQgPT09IGV2ZW50VGFyZ2V0O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBGYW5zIG91dCBhIE1lc3NhZ2VFdmVudCB0byB0aGUgYXBwcm9wcmlhdGUgbGlzdGVuZXJzLlxyXG4gICAgICpcclxuICAgICAqIEByZW1hcmtzXHJcbiAgICAgKiBTZW5kcyBhbiB7QGxpbmsgU3RhdHVzLkFDS30gdXBvbiByZWNlaXB0IGFuZCBhIHtAbGluayBTdGF0dXMuRE9ORX0gb25jZSBhbGwgaGFuZGxlcnMgaGF2ZVxyXG4gICAgICogZmluaXNoZWQgcHJvY2Vzc2luZy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQgLSBUaGUgTWVzc2FnZUV2ZW50LlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgYXN5bmMgaGFuZGxlRXZlbnQoZXZlbnQpIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlRXZlbnQgPSBldmVudDtcclxuICAgICAgICBjb25zdCB7IGV2ZW50SWQsIGV2ZW50VHlwZSwgZGF0YSB9ID0gbWVzc2FnZUV2ZW50LmRhdGE7XHJcbiAgICAgICAgY29uc3QgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV07XHJcbiAgICAgICAgaWYgKCEoaGFuZGxlcnMgPT09IG51bGwgfHwgaGFuZGxlcnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhhbmRsZXJzLnNpemUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbWVzc2FnZUV2ZW50LnBvcnRzWzBdLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgc3RhdHVzOiBcImFja1wiIC8qIF9TdGF0dXMuQUNLICovLFxyXG4gICAgICAgICAgICBldmVudElkLFxyXG4gICAgICAgICAgICBldmVudFR5cGVcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5LmZyb20oaGFuZGxlcnMpLm1hcChhc3luYyAoaGFuZGxlcikgPT4gaGFuZGxlcihtZXNzYWdlRXZlbnQub3JpZ2luLCBkYXRhKSk7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfYWxsU2V0dGxlZChwcm9taXNlcyk7XHJcbiAgICAgICAgbWVzc2FnZUV2ZW50LnBvcnRzWzBdLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgc3RhdHVzOiBcImRvbmVcIiAvKiBfU3RhdHVzLkRPTkUgKi8sXHJcbiAgICAgICAgICAgIGV2ZW50SWQsXHJcbiAgICAgICAgICAgIGV2ZW50VHlwZSxcclxuICAgICAgICAgICAgcmVzcG9uc2VcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU3Vic2NyaWJlIGFuIGV2ZW50IGhhbmRsZXIgZm9yIGEgcGFydGljdWxhciBldmVudC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gRXZlbnQgbmFtZSB0byBzdWJzY3JpYmUgdG8uXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRIYW5kbGVyIC0gVGhlIGV2ZW50IGhhbmRsZXIgd2hpY2ggc2hvdWxkIHJlY2VpdmUgdGhlIGV2ZW50cy5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIF9zdWJzY3JpYmUoZXZlbnRUeXBlLCBldmVudEhhbmRsZXIpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5oYW5kbGVyc01hcCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXSkge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0gPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXS5hZGQoZXZlbnRIYW5kbGVyKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVW5zdWJzY3JpYmUgYW4gZXZlbnQgaGFuZGxlciBmcm9tIGEgcGFydGljdWxhciBldmVudC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gRXZlbnQgbmFtZSB0byB1bnN1YnNjcmliZSBmcm9tLlxyXG4gICAgICogQHBhcmFtIGV2ZW50SGFuZGxlciAtIE9wdGlvbmFsIGV2ZW50IGhhbmRsZXIsIGlmIG5vbmUgcHJvdmlkZWQsIHVuc3Vic2NyaWJlIGFsbCBoYW5kbGVycyBvbiB0aGlzIGV2ZW50LlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgX3Vuc3Vic2NyaWJlKGV2ZW50VHlwZSwgZXZlbnRIYW5kbGVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXSAmJiBldmVudEhhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdLmRlbGV0ZShldmVudEhhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWV2ZW50SGFuZGxlciB8fCB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0uc2l6ZSA9PT0gMCkge1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5oYW5kbGVyc01hcCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRUYXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5SZWNlaXZlci5yZWNlaXZlcnMgPSBbXTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX2dlbmVyYXRlRXZlbnRJZChwcmVmaXggPSAnJywgZGlnaXRzID0gMTApIHtcclxuICAgIGxldCByYW5kb20gPSAnJztcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGlnaXRzOyBpKyspIHtcclxuICAgICAgICByYW5kb20gKz0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHByZWZpeCArIHJhbmRvbTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogSW50ZXJmYWNlIGZvciBzZW5kaW5nIG1lc3NhZ2VzIGFuZCB3YWl0aW5nIGZvciBhIGNvbXBsZXRpb24gcmVzcG9uc2UuXHJcbiAqXHJcbiAqL1xyXG5jbGFzcyBTZW5kZXIge1xyXG4gICAgY29uc3RydWN0b3IodGFyZ2V0KSB7XHJcbiAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVycyA9IG5ldyBTZXQoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVW5zdWJzY3JpYmUgdGhlIGhhbmRsZXIgYW5kIHJlbW92ZSBpdCBmcm9tIG91ciB0cmFja2luZyBTZXQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGhhbmRsZXIgLSBUaGUgaGFuZGxlciB0byB1bnN1YnNjcmliZS5cclxuICAgICAqL1xyXG4gICAgcmVtb3ZlTWVzc2FnZUhhbmRsZXIoaGFuZGxlcikge1xyXG4gICAgICAgIGlmIChoYW5kbGVyLm1lc3NhZ2VDaGFubmVsKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZXIubWVzc2FnZUNoYW5uZWwucG9ydDEucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGhhbmRsZXIub25NZXNzYWdlKTtcclxuICAgICAgICAgICAgaGFuZGxlci5tZXNzYWdlQ2hhbm5lbC5wb3J0MS5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhhbmRsZXJzLmRlbGV0ZShoYW5kbGVyKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU2VuZCBhIG1lc3NhZ2UgdG8gdGhlIFJlY2VpdmVyIGxvY2F0ZWQgYXQge0BsaW5rIHRhcmdldH0uXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIFdlJ2xsIGZpcnN0IHdhaXQgYSBiaXQgZm9yIGFuIEFDSyAsIGlmIHdlIGdldCBvbmUgd2Ugd2lsbCB3YWl0IHNpZ25pZmljYW50bHkgbG9uZ2VyIHVudGlsIHRoZVxyXG4gICAgICogcmVjZWl2ZXIgaGFzIGhhZCBhIGNoYW5jZSB0byBmdWxseSBwcm9jZXNzIHRoZSBldmVudC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gVHlwZSBvZiBldmVudCB0byBzZW5kLlxyXG4gICAgICogQHBhcmFtIGRhdGEgLSBUaGUgcGF5bG9hZCBvZiB0aGUgZXZlbnQuXHJcbiAgICAgKiBAcGFyYW0gdGltZW91dCAtIFRpbWVvdXQgZm9yIHdhaXRpbmcgb24gYW4gQUNLIGZyb20gdGhlIHJlY2VpdmVyLlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIEFuIGFycmF5IG9mIHNldHRsZWQgcHJvbWlzZXMgZnJvbSBhbGwgdGhlIGhhbmRsZXJzIHRoYXQgd2VyZSBsaXN0ZW5pbmcgb24gdGhlIHJlY2VpdmVyLlxyXG4gICAgICovXHJcbiAgICBhc3luYyBfc2VuZChldmVudFR5cGUsIGRhdGEsIHRpbWVvdXQgPSA1MCAvKiBfVGltZW91dER1cmF0aW9uLkFDSyAqLykge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VDaGFubmVsID0gdHlwZW9mIE1lc3NhZ2VDaGFubmVsICE9PSAndW5kZWZpbmVkJyA/IG5ldyBNZXNzYWdlQ2hhbm5lbCgpIDogbnVsbDtcclxuICAgICAgICBpZiAoIW1lc3NhZ2VDaGFubmVsKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvbm5lY3Rpb25fdW5hdmFpbGFibGVcIiAvKiBfTWVzc2FnZUVycm9yLkNPTk5FQ1RJT05fVU5BVkFJTEFCTEUgKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBOb2RlIHRpbWVycyBhbmQgYnJvd3NlciB0aW1lcnMgcmV0dXJuIGZ1bmRhbWVudGFsbHkgZGlmZmVyZW50IHR5cGVzLlxyXG4gICAgICAgIC8vIFdlIGRvbid0IGFjdHVhbGx5IGNhcmUgd2hhdCB0aGUgdmFsdWUgaXMgYnV0IFRTIHdvbid0IGFjY2VwdCB1bmtub3duIGFuZFxyXG4gICAgICAgIC8vIHdlIGNhbid0IGNhc3QgcHJvcGVybHkgaW4gYm90aCBlbnZpcm9ubWVudHMuXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICBsZXQgY29tcGxldGlvblRpbWVyO1xyXG4gICAgICAgIGxldCBoYW5kbGVyO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50SWQgPSBfZ2VuZXJhdGVFdmVudElkKCcnLCAyMCk7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VDaGFubmVsLnBvcnQxLnN0YXJ0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGFja1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKFwidW5zdXBwb3J0ZWRfZXZlbnRcIiAvKiBfTWVzc2FnZUVycm9yLlVOU1VQUE9SVEVEX0VWRU5UICovKSk7XHJcbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xyXG4gICAgICAgICAgICBoYW5kbGVyID0ge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZUNoYW5uZWwsXHJcbiAgICAgICAgICAgICAgICBvbk1lc3NhZ2UoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlRXZlbnQgPSBldmVudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZUV2ZW50LmRhdGEuZXZlbnRJZCAhPT0gZXZlbnRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZUV2ZW50LmRhdGEuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhY2tcIiAvKiBfU3RhdHVzLkFDSyAqLzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSByZWNlaXZlciBzaG91bGQgQUNLIGZpcnN0LlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGFja1RpbWVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25UaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJ0aW1lb3V0XCIgLyogX01lc3NhZ2VFcnJvci5USU1FT1VUICovKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAzMDAwIC8qIF9UaW1lb3V0RHVyYXRpb24uQ09NUExFVElPTiAqLyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImRvbmVcIiAvKiBfU3RhdHVzLkRPTkUgKi86XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPbmNlIHRoZSByZWNlaXZlcidzIGhhbmRsZXJzIGFyZSBmaW5pc2hlZCB3ZSB3aWxsIGdldCB0aGUgcmVzdWx0cy5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChjb21wbGV0aW9uVGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtZXNzYWdlRXZlbnQuZGF0YS5yZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChhY2tUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoY29tcGxldGlvblRpbWVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJpbnZhbGlkX3Jlc3BvbnNlXCIgLyogX01lc3NhZ2VFcnJvci5JTlZBTElEX1JFU1BPTlNFICovKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlcnMuYWRkKGhhbmRsZXIpO1xyXG4gICAgICAgICAgICBtZXNzYWdlQ2hhbm5lbC5wb3J0MS5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlci5vbk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB0aGlzLnRhcmdldC5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICBldmVudFR5cGUsXHJcbiAgICAgICAgICAgICAgICBldmVudElkLFxyXG4gICAgICAgICAgICAgICAgZGF0YVxyXG4gICAgICAgICAgICB9LCBbbWVzc2FnZUNoYW5uZWwucG9ydDJdKTtcclxuICAgICAgICB9KS5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTWVzc2FnZUhhbmRsZXIoaGFuZGxlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogTGF6eSBhY2Nlc3NvciBmb3Igd2luZG93LCBzaW5jZSB0aGUgY29tcGF0IGxheWVyIHdvbid0IHRyZWUgc2hha2UgdGhpcyBvdXQsXHJcbiAqIHdlIG5lZWQgdG8gbWFrZSBzdXJlIG5vdCB0byBtZXNzIHdpdGggd2luZG93IHVubGVzcyB3ZSBoYXZlIHRvXHJcbiAqL1xyXG5mdW5jdGlvbiBfd2luZG93KCkge1xyXG4gICAgcmV0dXJuIHdpbmRvdztcclxufVxyXG5mdW5jdGlvbiBfc2V0V2luZG93TG9jYXRpb24odXJsKSB7XHJcbiAgICBfd2luZG93KCkubG9jYXRpb24uaHJlZiA9IHVybDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQy5cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX2lzV29ya2VyKCkge1xyXG4gICAgcmV0dXJuICh0eXBlb2YgX3dpbmRvdygpWydXb3JrZXJHbG9iYWxTY29wZSddICE9PSAndW5kZWZpbmVkJyAmJlxyXG4gICAgICAgIHR5cGVvZiBfd2luZG93KClbJ2ltcG9ydFNjcmlwdHMnXSA9PT0gJ2Z1bmN0aW9uJyk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX2dldEFjdGl2ZVNlcnZpY2VXb3JrZXIoKSB7XHJcbiAgICBpZiAoIShuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7XHJcbiAgICAgICAgcmV0dXJuIHJlZ2lzdHJhdGlvbi5hY3RpdmU7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfZ2V0U2VydmljZVdvcmtlckNvbnRyb2xsZXIoKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICByZXR1cm4gKChfYSA9IG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29udHJvbGxlcikgfHwgbnVsbDtcclxufVxyXG5mdW5jdGlvbiBfZ2V0V29ya2VyR2xvYmFsU2NvcGUoKSB7XHJcbiAgICByZXR1cm4gX2lzV29ya2VyKCkgPyBzZWxmIDogbnVsbDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBEQl9OQU1FID0gJ2ZpcmViYXNlTG9jYWxTdG9yYWdlRGInO1xyXG5jb25zdCBEQl9WRVJTSU9OID0gMTtcclxuY29uc3QgREJfT0JKRUNUU1RPUkVfTkFNRSA9ICdmaXJlYmFzZUxvY2FsU3RvcmFnZSc7XHJcbmNvbnN0IERCX0RBVEFfS0VZUEFUSCA9ICdmYmFzZV9rZXknO1xyXG4vKipcclxuICogUHJvbWlzZSB3cmFwcGVyIGZvciBJREJSZXF1ZXN0XHJcbiAqXHJcbiAqIFVuZm9ydHVuYXRlbHkgd2UgY2FuJ3QgY2xlYW5seSBleHRlbmQgUHJvbWlzZTxUPiBzaW5jZSBwcm9taXNlcyBhcmUgbm90IGNhbGxhYmxlIGluIEVTNlxyXG4gKlxyXG4gKi9cclxuY2xhc3MgREJQcm9taXNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHJlcXVlc3QpIHtcclxuICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0O1xyXG4gICAgfVxyXG4gICAgdG9Qcm9taXNlKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0aGlzLnJlcXVlc3QucmVzdWx0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlamVjdCh0aGlzLnJlcXVlc3QuZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXRPYmplY3RTdG9yZShkYiwgaXNSZWFkV3JpdGUpIHtcclxuICAgIHJldHVybiBkYlxyXG4gICAgICAgIC50cmFuc2FjdGlvbihbREJfT0JKRUNUU1RPUkVfTkFNRV0sIGlzUmVhZFdyaXRlID8gJ3JlYWR3cml0ZScgOiAncmVhZG9ubHknKVxyXG4gICAgICAgIC5vYmplY3RTdG9yZShEQl9PQkpFQ1RTVE9SRV9OQU1FKTtcclxufVxyXG5mdW5jdGlvbiBfZGVsZXRlRGF0YWJhc2UoKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKERCX05BTUUpO1xyXG4gICAgcmV0dXJuIG5ldyBEQlByb21pc2UocmVxdWVzdCkudG9Qcm9taXNlKCk7XHJcbn1cclxuZnVuY3Rpb24gX29wZW5EYXRhYmFzZSgpIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihEQl9OQU1FLCBEQl9WRVJTSU9OKTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHtcclxuICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGIgPSByZXF1ZXN0LnJlc3VsdDtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKERCX09CSkVDVFNUT1JFX05BTUUsIHsga2V5UGF0aDogREJfREFUQV9LRVlQQVRIIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiID0gcmVxdWVzdC5yZXN1bHQ7XHJcbiAgICAgICAgICAgIC8vIFN0cmFuZ2UgYnVnIHRoYXQgb2NjdXJzIGluIEZpcmVmb3ggd2hlbiBtdWx0aXBsZSB0YWJzIGFyZSBvcGVuZWQgYXQgdGhlXHJcbiAgICAgICAgICAgIC8vIHNhbWUgdGltZS4gVGhlIG9ubHkgd2F5IHRvIHJlY292ZXIgc2VlbXMgdG8gYmUgZGVsZXRpbmcgdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICAgIC8vIGFuZCByZS1pbml0aWFsaXppbmcgaXQuXHJcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvaXNzdWVzLzYzNFxyXG4gICAgICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoREJfT0JKRUNUU1RPUkVfTkFNRSkpIHtcclxuICAgICAgICAgICAgICAgIC8vIE5lZWQgdG8gY2xvc2UgdGhlIGRhdGFiYXNlIG9yIGVsc2UgeW91IGdldCBhIGBibG9ja2VkYCBldmVudFxyXG4gICAgICAgICAgICAgICAgZGIuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IF9kZWxldGVEYXRhYmFzZSgpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhd2FpdCBfb3BlbkRhdGFiYXNlKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShkYik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9wdXRPYmplY3QoZGIsIGtleSwgdmFsdWUpIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBnZXRPYmplY3RTdG9yZShkYiwgdHJ1ZSkucHV0KHtcclxuICAgICAgICBbREJfREFUQV9LRVlQQVRIXToga2V5LFxyXG4gICAgICAgIHZhbHVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGdldE9iamVjdChkYiwga2V5KSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIGZhbHNlKS5nZXQoa2V5KTtcclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpO1xyXG4gICAgcmV0dXJuIGRhdGEgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBkYXRhLnZhbHVlO1xyXG59XHJcbmZ1bmN0aW9uIF9kZWxldGVPYmplY3QoZGIsIGtleSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGdldE9iamVjdFN0b3JlKGRiLCB0cnVlKS5kZWxldGUoa2V5KTtcclxuICAgIHJldHVybiBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpO1xyXG59XHJcbmNvbnN0IF9QT0xMSU5HX0lOVEVSVkFMX01TID0gODAwO1xyXG5jb25zdCBfVFJBTlNBQ1RJT05fUkVUUllfQ09VTlQgPSAzO1xyXG5jbGFzcyBJbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IFwiTE9DQUxcIiAvKiBQZXJzaXN0ZW5jZVR5cGUuTE9DQUwgKi87XHJcbiAgICAgICAgdGhpcy5fc2hvdWxkQWxsb3dNaWdyYXRpb24gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307XHJcbiAgICAgICAgdGhpcy5sb2NhbENhY2hlID0ge307XHJcbiAgICAgICAgLy8gc2V0VGltZW91dCByZXR1cm4gdmFsdWUgaXMgcGxhdGZvcm0gc3BlY2lmaWNcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgICAgIHRoaXMucG9sbFRpbWVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLnBlbmRpbmdXcml0ZXMgPSAwO1xyXG4gICAgICAgIHRoaXMucmVjZWl2ZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc2VuZGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLnNlcnZpY2VXb3JrZXJSZWNlaXZlckF2YWlsYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlU2VydmljZVdvcmtlciA9IG51bGw7XHJcbiAgICAgICAgLy8gRmlyZSAmIGZvcmdldCB0aGUgc2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uIGFzIGl0IG1heSBuZXZlciByZXNvbHZlXHJcbiAgICAgICAgdGhpcy5fd29ya2VySW5pdGlhbGl6YXRpb25Qcm9taXNlID1cclxuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplU2VydmljZVdvcmtlck1lc3NhZ2luZygpLnRoZW4oKCkgPT4geyB9LCAoKSA9PiB7IH0pO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX29wZW5EYigpIHtcclxuICAgICAgICBpZiAodGhpcy5kYikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kYiA9IGF3YWl0IF9vcGVuRGF0YWJhc2UoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5kYjtcclxuICAgIH1cclxuICAgIGFzeW5jIF93aXRoUmV0cmllcyhvcCkge1xyXG4gICAgICAgIGxldCBudW1BdHRlbXB0cyA9IDA7XHJcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgdGhpcy5fb3BlbkRiKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgb3AoZGIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobnVtQXR0ZW1wdHMrKyA+IF9UUkFOU0FDVElPTl9SRVRSWV9DT1VOVCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGIuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRiID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogY29uc2lkZXIgYWRkaW5nIGV4cG9uZW50aWFsIGJhY2tvZmZcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSW5kZXhlZERCIGV2ZW50cyBkbyBub3QgcHJvcGFnYXRlIGZyb20gdGhlIG1haW4gd2luZG93IHRvIHRoZSB3b3JrZXIgY29udGV4dC4gIFdlIHJlbHkgb24gYVxyXG4gICAgICogcG9zdE1lc3NhZ2UgaW50ZXJmYWNlIHRvIHNlbmQgdGhlc2UgZXZlbnRzIHRvIHRoZSB3b3JrZXIgb3Vyc2VsdmVzLlxyXG4gICAgICovXHJcbiAgICBhc3luYyBpbml0aWFsaXplU2VydmljZVdvcmtlck1lc3NhZ2luZygpIHtcclxuICAgICAgICByZXR1cm4gX2lzV29ya2VyKCkgPyB0aGlzLmluaXRpYWxpemVSZWNlaXZlcigpIDogdGhpcy5pbml0aWFsaXplU2VuZGVyKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFzIHRoZSB3b3JrZXIgd2Ugc2hvdWxkIGxpc3RlbiB0byBldmVudHMgZnJvbSB0aGUgbWFpbiB3aW5kb3cuXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGluaXRpYWxpemVSZWNlaXZlcigpIHtcclxuICAgICAgICB0aGlzLnJlY2VpdmVyID0gUmVjZWl2ZXIuX2dldEluc3RhbmNlKF9nZXRXb3JrZXJHbG9iYWxTY29wZSgpKTtcclxuICAgICAgICAvLyBSZWZyZXNoIGZyb20gcGVyc2lzdGVuY2UgaWYgd2UgcmVjZWl2ZSBhIEtleUNoYW5nZWQgbWVzc2FnZS5cclxuICAgICAgICB0aGlzLnJlY2VpdmVyLl9zdWJzY3JpYmUoXCJrZXlDaGFuZ2VkXCIgLyogX0V2ZW50VHlwZS5LRVlfQ0hBTkdFRCAqLywgYXN5bmMgKF9vcmlnaW4sIGRhdGEpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qga2V5cyA9IGF3YWl0IHRoaXMuX3BvbGwoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGtleVByb2Nlc3NlZDoga2V5cy5pbmNsdWRlcyhkYXRhLmtleSlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBMZXQgdGhlIHNlbmRlciBrbm93IHRoYXQgd2UgYXJlIGxpc3RlbmluZyBzbyB0aGV5IGdpdmUgdXMgbW9yZSB0aW1lb3V0LlxyXG4gICAgICAgIHRoaXMucmVjZWl2ZXIuX3N1YnNjcmliZShcInBpbmdcIiAvKiBfRXZlbnRUeXBlLlBJTkcgKi8sIGFzeW5jIChfb3JpZ2luLCBfZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gW1wia2V5Q2hhbmdlZFwiIC8qIF9FdmVudFR5cGUuS0VZX0NIQU5HRUQgKi9dO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBcyB0aGUgbWFpbiB3aW5kb3csIHdlIHNob3VsZCBsZXQgdGhlIHdvcmtlciBrbm93IHdoZW4ga2V5cyBjaGFuZ2UgKHNldCBhbmQgcmVtb3ZlKS5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICoge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9TZXJ2aWNlV29ya2VyQ29udGFpbmVyL3JlYWR5IHwgU2VydmljZVdvcmtlckNvbnRhaW5lci5yZWFkeX1cclxuICAgICAqIG1heSBub3QgcmVzb2x2ZS5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgaW5pdGlhbGl6ZVNlbmRlcigpIHtcclxuICAgICAgICB2YXIgX2EsIF9iO1xyXG4gICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGFuIGFjdGl2ZSBzZXJ2aWNlIHdvcmtlci5cclxuICAgICAgICB0aGlzLmFjdGl2ZVNlcnZpY2VXb3JrZXIgPSBhd2FpdCBfZ2V0QWN0aXZlU2VydmljZVdvcmtlcigpO1xyXG4gICAgICAgIGlmICghdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZW5kZXIgPSBuZXcgU2VuZGVyKHRoaXMuYWN0aXZlU2VydmljZVdvcmtlcik7XHJcbiAgICAgICAgLy8gUGluZyB0aGUgc2VydmljZSB3b3JrZXIgdG8gY2hlY2sgd2hhdCBldmVudHMgdGhleSBjYW4gaGFuZGxlLlxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLnNlbmRlci5fc2VuZChcInBpbmdcIiAvKiBfRXZlbnRUeXBlLlBJTkcgKi8sIHt9LCA4MDAgLyogX1RpbWVvdXREdXJhdGlvbi5MT05HX0FDSyAqLyk7XHJcbiAgICAgICAgaWYgKCFyZXN1bHRzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCgoX2EgPSByZXN1bHRzWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZnVsZmlsbGVkKSAmJlxyXG4gICAgICAgICAgICAoKF9iID0gcmVzdWx0c1swXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnZhbHVlLmluY2x1ZGVzKFwia2V5Q2hhbmdlZFwiIC8qIF9FdmVudFR5cGUuS0VZX0NIQU5HRUQgKi8pKSkge1xyXG4gICAgICAgICAgICB0aGlzLnNlcnZpY2VXb3JrZXJSZWNlaXZlckF2YWlsYWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBMZXQgdGhlIHdvcmtlciBrbm93IGFib3V0IGEgY2hhbmdlZCBrZXksIHRoZSBleGFjdCBrZXkgZG9lc24ndCB0ZWNobmljYWxseSBtYXR0ZXIgc2luY2UgdGhlXHJcbiAgICAgKiB3b3JrZXIgd2lsbCBqdXN0IHRyaWdnZXIgYSBmdWxsIHN5bmMgYW55d2F5LlxyXG4gICAgICpcclxuICAgICAqIEByZW1hcmtzXHJcbiAgICAgKiBGb3Igbm93LCB3ZSBvbmx5IHN1cHBvcnQgb25lIHNlcnZpY2Ugd29ya2VyIHBlciBwYWdlLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBrZXkgLSBTdG9yYWdlIGtleSB3aGljaCBjaGFuZ2VkLlxyXG4gICAgICovXHJcbiAgICBhc3luYyBub3RpZnlTZXJ2aWNlV29ya2VyKGtleSkge1xyXG4gICAgICAgIGlmICghdGhpcy5zZW5kZXIgfHxcclxuICAgICAgICAgICAgIXRoaXMuYWN0aXZlU2VydmljZVdvcmtlciB8fFxyXG4gICAgICAgICAgICBfZ2V0U2VydmljZVdvcmtlckNvbnRyb2xsZXIoKSAhPT0gdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5zZW5kZXIuX3NlbmQoXCJrZXlDaGFuZ2VkXCIgLyogX0V2ZW50VHlwZS5LRVlfQ0hBTkdFRCAqLywgeyBrZXkgfSwgXHJcbiAgICAgICAgICAgIC8vIFVzZSBsb25nIHRpbWVvdXQgaWYgcmVjZWl2ZXIgaGFzIHByZXZpb3VzbHkgcmVzcG9uZGVkIHRvIGEgcGluZyBmcm9tIHVzLlxyXG4gICAgICAgICAgICB0aGlzLnNlcnZpY2VXb3JrZXJSZWNlaXZlckF2YWlsYWJsZVxyXG4gICAgICAgICAgICAgICAgPyA4MDAgLyogX1RpbWVvdXREdXJhdGlvbi5MT05HX0FDSyAqL1xyXG4gICAgICAgICAgICAgICAgOiA1MCAvKiBfVGltZW91dER1cmF0aW9uLkFDSyAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICAvLyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQgYXBwcm9hY2guIElnbm9yZSBlcnJvcnMuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXN5bmMgX2lzQXZhaWxhYmxlKCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmICghaW5kZXhlZERCKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZGIgPSBhd2FpdCBfb3BlbkRhdGFiYXNlKCk7XHJcbiAgICAgICAgICAgIGF3YWl0IF9wdXRPYmplY3QoZGIsIFNUT1JBR0VfQVZBSUxBQkxFX0tFWSwgJzEnKTtcclxuICAgICAgICAgICAgYXdhaXQgX2RlbGV0ZU9iamVjdChkYiwgU1RPUkFHRV9BVkFJTEFCTEVfS0VZKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChfYSkgeyB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3dpdGhQZW5kaW5nV3JpdGUod3JpdGUpIHtcclxuICAgICAgICB0aGlzLnBlbmRpbmdXcml0ZXMrKztcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCB3cml0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHtcclxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nV3JpdGVzLS07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXN5bmMgX3NldChrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpdGhQZW5kaW5nV3JpdGUoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLl93aXRoUmV0cmllcygoZGIpID0+IF9wdXRPYmplY3QoZGIsIGtleSwgdmFsdWUpKTtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5U2VydmljZVdvcmtlcihrZXkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX2dldChrZXkpIHtcclxuICAgICAgICBjb25zdCBvYmogPSAoYXdhaXQgdGhpcy5fd2l0aFJldHJpZXMoKGRiKSA9PiBnZXRPYmplY3QoZGIsIGtleSkpKTtcclxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IG9iajtcclxuICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3JlbW92ZShrZXkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fd2l0aFBlbmRpbmdXcml0ZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3dpdGhSZXRyaWVzKChkYikgPT4gX2RlbGV0ZU9iamVjdChkYiwga2V5KSk7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmxvY2FsQ2FjaGVba2V5XTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5U2VydmljZVdvcmtlcihrZXkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3BvbGwoKSB7XHJcbiAgICAgICAgLy8gVE9ETzogY2hlY2sgaWYgd2UgbmVlZCB0byBmYWxsYmFjayBpZiBnZXRBbGwgaXMgbm90IHN1cHBvcnRlZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX3dpdGhSZXRyaWVzKChkYikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBnZXRBbGxSZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIGZhbHNlKS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEQlByb21pc2UoZ2V0QWxsUmVxdWVzdCkudG9Qcm9taXNlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiB3ZSBoYXZlIHBlbmRpbmcgd3JpdGVzIGluIHByb2dyZXNzIGFib3J0LCB3ZSdsbCBnZXQgcGlja2VkIHVwIG9uIHRoZSBuZXh0IHBvbGxcclxuICAgICAgICBpZiAodGhpcy5wZW5kaW5nV3JpdGVzICE9PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qga2V5cyA9IFtdO1xyXG4gICAgICAgIGNvbnN0IGtleXNJblJlc3VsdCA9IG5ldyBTZXQoKTtcclxuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgZmJhc2Vfa2V5OiBrZXksIHZhbHVlIH0gb2YgcmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBrZXlzSW5SZXN1bHQuYWRkKGtleSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy5sb2NhbENhY2hlW2tleV0pICE9PSBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhrZXksIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBrZXlzLnB1c2goa2V5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IGxvY2FsS2V5IG9mIE9iamVjdC5rZXlzKHRoaXMubG9jYWxDYWNoZSkpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubG9jYWxDYWNoZVtsb2NhbEtleV0gJiYgIWtleXNJblJlc3VsdC5oYXMobG9jYWxLZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBEZWxldGVkXHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhsb2NhbEtleSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICBrZXlzLnB1c2gobG9jYWxLZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBrZXlzO1xyXG4gICAgfVxyXG4gICAgbm90aWZ5TGlzdGVuZXJzKGtleSwgbmV3VmFsdWUpIHtcclxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzW2tleV07XHJcbiAgICAgICAgaWYgKGxpc3RlbmVycykge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIEFycmF5LmZyb20obGlzdGVuZXJzKSkge1xyXG4gICAgICAgICAgICAgICAgbGlzdGVuZXIobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhcnRQb2xsaW5nKCkge1xyXG4gICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTtcclxuICAgICAgICB0aGlzLnBvbGxUaW1lciA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHRoaXMuX3BvbGwoKSwgX1BPTExJTkdfSU5URVJWQUxfTVMpO1xyXG4gICAgfVxyXG4gICAgc3RvcFBvbGxpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucG9sbFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnBvbGxUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX2FkZExpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0UG9sbGluZygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMubGlzdGVuZXJzW2tleV0pIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XSA9IG5ldyBTZXQoKTtcclxuICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIGNhY2hlIHRvIGF2b2lkIHNwdXJpb3VzbHkgdHJpZ2dlcmluZyBvbiBmaXJzdCBwb2xsLlxyXG4gICAgICAgICAgICB2b2lkIHRoaXMuX2dldChrZXkpOyAvLyBUaGlzIGNhbiBoYXBwZW4gaW4gdGhlIGJhY2tncm91bmQgYXN5bmMgYW5kIHdlIGNhbiByZXR1cm4gaW1tZWRpYXRlbHkuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uYWRkKGxpc3RlbmVyKTtcclxuICAgIH1cclxuICAgIF9yZW1vdmVMaXN0ZW5lcihrZXksIGxpc3RlbmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzW2tleV0pIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XS5kZWxldGUobGlzdGVuZXIpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNba2V5XS5zaXplID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNba2V5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbkluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UudHlwZSA9ICdMT0NBTCc7XHJcbi8qKlxyXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIHR5cGUgYExPQ0FMYCB1c2luZyBgaW5kZXhlZERCYFxyXG4gKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgaW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZSA9IEluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2U7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIHN0YXJ0U2lnbkluUGhvbmVNZmEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYVNpZ25JbjpzdGFydFwiIC8qIEVuZHBvaW50LlNUQVJUX01GQV9TSUdOX0lOICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmFsaXplU2lnbkluUGhvbmVNZmEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYVNpZ25JbjpmaW5hbGl6ZVwiIC8qIEVuZHBvaW50LkZJTkFMSVpFX01GQV9TSUdOX0lOICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmFsaXplU2lnbkluVG90cE1mYShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhU2lnbkluOmZpbmFsaXplXCIgLyogRW5kcG9pbnQuRklOQUxJWkVfTUZBX1NJR05fSU4gKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgX1NPTFZFX1RJTUVfTVMgPSA1MDA7XHJcbmNvbnN0IF9FWFBJUkFUSU9OX1RJTUVfTVMgPSA2MDAwMDtcclxuY29uc3QgX1dJREdFVF9JRF9TVEFSVCA9IDEwMDAwMDAwMDAwMDA7XHJcbmNsYXNzIE1vY2tSZUNhcHRjaGEge1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCkge1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XHJcbiAgICAgICAgdGhpcy5jb3VudGVyID0gX1dJREdFVF9JRF9TVEFSVDtcclxuICAgICAgICB0aGlzLl93aWRnZXRzID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgcmVuZGVyKGNvbnRhaW5lciwgcGFyYW1ldGVycykge1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5jb3VudGVyO1xyXG4gICAgICAgIHRoaXMuX3dpZGdldHMuc2V0KGlkLCBuZXcgTW9ja1dpZGdldChjb250YWluZXIsIHRoaXMuYXV0aC5uYW1lLCBwYXJhbWV0ZXJzIHx8IHt9KSk7XHJcbiAgICAgICAgdGhpcy5jb3VudGVyKys7XHJcbiAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgfVxyXG4gICAgcmVzZXQob3B0V2lkZ2V0SWQpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3QgaWQgPSBvcHRXaWRnZXRJZCB8fCBfV0lER0VUX0lEX1NUQVJUO1xyXG4gICAgICAgIHZvaWQgKChfYSA9IHRoaXMuX3dpZGdldHMuZ2V0KGlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlbGV0ZSgpKTtcclxuICAgICAgICB0aGlzLl93aWRnZXRzLmRlbGV0ZShpZCk7XHJcbiAgICB9XHJcbiAgICBnZXRSZXNwb25zZShvcHRXaWRnZXRJZCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICBjb25zdCBpZCA9IG9wdFdpZGdldElkIHx8IF9XSURHRVRfSURfU1RBUlQ7XHJcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLl93aWRnZXRzLmdldChpZCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRSZXNwb25zZSgpKSB8fCAnJztcclxuICAgIH1cclxuICAgIGFzeW5jIGV4ZWN1dGUob3B0V2lkZ2V0SWQpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3QgaWQgPSBvcHRXaWRnZXRJZCB8fCBfV0lER0VUX0lEX1NUQVJUO1xyXG4gICAgICAgIHZvaWQgKChfYSA9IHRoaXMuX3dpZGdldHMuZ2V0KGlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmV4ZWN1dGUoKSk7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIE1vY2tXaWRnZXQge1xyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyT3JJZCwgYXBwTmFtZSwgcGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgICAgICAgdGhpcy50aW1lcklkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRlbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJlc3BvbnNlVG9rZW4gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHR5cGVvZiBjb250YWluZXJPcklkID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lck9ySWQpXHJcbiAgICAgICAgICAgIDogY29udGFpbmVyT3JJZDtcclxuICAgICAgICBfYXNzZXJ0KGNvbnRhaW5lciwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8sIHsgYXBwTmFtZSB9KTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IHRoaXMucGFyYW1zLnNpemUgIT09ICdpbnZpc2libGUnO1xyXG4gICAgICAgIGlmICh0aGlzLmlzVmlzaWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja0hhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldFJlc3BvbnNlKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tJZkRlbGV0ZWQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZXNwb25zZVRva2VuO1xyXG4gICAgfVxyXG4gICAgZGVsZXRlKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tJZkRlbGV0ZWQoKTtcclxuICAgICAgICB0aGlzLmRlbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJZCk7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja0hhbmRsZXIpO1xyXG4gICAgfVxyXG4gICAgZXhlY3V0ZSgpIHtcclxuICAgICAgICB0aGlzLmNoZWNrSWZEZWxldGVkKCk7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZXJJZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudGltZXJJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZXNwb25zZVRva2VuID0gZ2VuZXJhdGVSYW5kb21BbHBoYU51bWVyaWNTdHJpbmcoNTApO1xyXG4gICAgICAgICAgICBjb25zdCB7IGNhbGxiYWNrLCAnZXhwaXJlZC1jYWxsYmFjayc6IGV4cGlyZWRDYWxsYmFjayB9ID0gdGhpcy5wYXJhbXM7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0aGlzLnJlc3BvbnNlVG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlVG9rZW4gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4cGlyZWRDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZWRDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkgeyB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1Zpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgX0VYUElSQVRJT05fVElNRV9NUyk7XHJcbiAgICAgICAgfSwgX1NPTFZFX1RJTUVfTVMpO1xyXG4gICAgfVxyXG4gICAgY2hlY2tJZkRlbGV0ZWQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGVsZXRlZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlQ0FQVENIQSBtb2NrIHdhcyBhbHJlYWR5IGRlbGV0ZWQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tQWxwaGFOdW1lcmljU3RyaW5nKGxlbikge1xyXG4gICAgY29uc3QgY2hhcnMgPSBbXTtcclxuICAgIGNvbnN0IGFsbG93ZWRDaGFycyA9ICcxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgY2hhcnMucHVzaChhbGxvd2VkQ2hhcnMuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFsbG93ZWRDaGFycy5sZW5ndGgpKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2hhcnMuam9pbignJyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLy8gUmVDYXB0Y2hhIHdpbGwgbG9hZCB1c2luZyB0aGUgc2FtZSBjYWxsYmFjaywgc28gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIG5lZWRzXHJcbi8vIHRvIGJlIGtlcHQgYXJvdW5kXHJcbmNvbnN0IF9KU0xPQURfQ0FMTEJBQ0sgPSBfZ2VuZXJhdGVDYWxsYmFja05hbWUoJ3JjYicpO1xyXG5jb25zdCBORVRXT1JLX1RJTUVPVVRfREVMQVkgPSBuZXcgRGVsYXkoMzAwMDAsIDYwMDAwKTtcclxuLyoqXHJcbiAqIExvYWRlciBmb3IgdGhlIEdSZUNhcHRjaGEgbGlicmFyeS4gVGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUgb2YgdGhpcy5cclxuICovXHJcbmNsYXNzIFJlQ2FwdGNoYUxvYWRlckltcGwge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIHRoaXMuaG9zdExhbmd1YWdlID0gJyc7XHJcbiAgICAgICAgdGhpcy5jb3VudGVyID0gMDtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDaGVjayBmb3IgYHJlbmRlcigpYCBtZXRob2QuIGB3aW5kb3cuZ3JlY2FwdGNoYWAgd2lsbCBleGlzdCBpZiB0aGUgRW50ZXJwcmlzZVxyXG4gICAgICAgICAqIHZlcnNpb24gb2YgdGhlIFJlQ0FQVENIQSBzY3JpcHQgd2FzIGxvYWRlZCBieSBzb21lb25lIGVsc2UgKGUuZy4gQXBwIENoZWNrKSBidXRcclxuICAgICAgICAgKiBgd2luZG93LmdyZWNhcHRjaGEucmVuZGVyKClgIHdpbGwgbm90LiBBbm90aGVyIGxvYWQgd2lsbCBhZGQgaXQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5saWJyYXJ5U2VwYXJhdGVseUxvYWRlZCA9ICEhKChfYSA9IF93aW5kb3coKS5ncmVjYXB0Y2hhKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVuZGVyKTtcclxuICAgIH1cclxuICAgIGxvYWQoYXV0aCwgaGwgPSAnJykge1xyXG4gICAgICAgIF9hc3NlcnQoaXNIb3N0TGFuZ3VhZ2VWYWxpZChobCksIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICBpZiAodGhpcy5zaG91bGRSZXNvbHZlSW1tZWRpYXRlbHkoaGwpICYmIGlzVjIoX3dpbmRvdygpLmdyZWNhcHRjaGEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoX3dpbmRvdygpLmdyZWNhcHRjaGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBuZXR3b3JrVGltZW91dCA9IF93aW5kb3coKS5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChfY3JlYXRlRXJyb3IoYXV0aCwgXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKSk7XHJcbiAgICAgICAgICAgIH0sIE5FVFdPUktfVElNRU9VVF9ERUxBWS5nZXQoKSk7XHJcbiAgICAgICAgICAgIF93aW5kb3coKVtfSlNMT0FEX0NBTExCQUNLXSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIF93aW5kb3coKS5jbGVhclRpbWVvdXQobmV0d29ya1RpbWVvdXQpO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIF93aW5kb3coKVtfSlNMT0FEX0NBTExCQUNLXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlY2FwdGNoYSA9IF93aW5kb3coKS5ncmVjYXB0Y2hhO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZWNhcHRjaGEgfHwgIWlzVjIocmVjYXB0Y2hhKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChfY3JlYXRlRXJyb3IoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBXcmFwIHRoZSByZWNhcHRjaGEgcmVuZGVyIGZ1bmN0aW9uIHNvIHRoYXQgd2Uga25vdyBpZiB0aGUgZGV2ZWxvcGVyIGhhc1xyXG4gICAgICAgICAgICAgICAgLy8gY2FsbGVkIGl0IHNlcGFyYXRlbHlcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlciA9IHJlY2FwdGNoYS5yZW5kZXI7XHJcbiAgICAgICAgICAgICAgICByZWNhcHRjaGEucmVuZGVyID0gKGNvbnRhaW5lciwgcGFyYW1zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2lkZ2V0SWQgPSByZW5kZXIoY29udGFpbmVyLCBwYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY291bnRlcisrO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3aWRnZXRJZDtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhvc3RMYW5ndWFnZSA9IGhsO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZWNhcHRjaGEpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCB1cmwgPSBgJHtfcmVjYXB0Y2hhVjJTY3JpcHRVcmwoKX0/JHtxdWVyeXN0cmluZyh7XHJcbiAgICAgICAgICAgICAgICBvbmxvYWQ6IF9KU0xPQURfQ0FMTEJBQ0ssXHJcbiAgICAgICAgICAgICAgICByZW5kZXI6ICdleHBsaWNpdCcsXHJcbiAgICAgICAgICAgICAgICBobFxyXG4gICAgICAgICAgICB9KX1gO1xyXG4gICAgICAgICAgICBfbG9hZEpTKHVybCkuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG5ldHdvcmtUaW1lb3V0KTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChfY3JlYXRlRXJyb3IoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBjbGVhcmVkT25lSW5zdGFuY2UoKSB7XHJcbiAgICAgICAgdGhpcy5jb3VudGVyLS07XHJcbiAgICB9XHJcbiAgICBzaG91bGRSZXNvbHZlSW1tZWRpYXRlbHkoaGwpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgLy8gV2UgY2FuIHJlc29sdmUgaW1tZWRpYXRlbHkgaWY6XHJcbiAgICAgICAgLy8gICDigKIgZ3JlY2FwdGNoYSBpcyBhbHJlYWR5IGRlZmluZWQgQU5EIChcclxuICAgICAgICAvLyAgICAgMS4gdGhlIHJlcXVlc3RlZCBsYW5ndWFnZSBjb2RlcyBhcmUgdGhlIHNhbWUgT1JcclxuICAgICAgICAvLyAgICAgMi4gdGhlcmUgZXhpc3RzIGFscmVhZHkgYSBSZUNhcHRjaGEgb24gdGhlIHBhZ2VcclxuICAgICAgICAvLyAgICAgMy4gdGhlIGxpYnJhcnkgd2FzIGFscmVhZHkgbG9hZGVkIGJ5IHRoZSBhcHBcclxuICAgICAgICAvLyBJbiBjYXNlcyAoMikgYW5kICgzKSwgd2UgX2Nhbid0XyByZWxvYWQgYXMgaXQgd291bGQgYnJlYWsgdGhlIHJlY2FwdGNoYXNcclxuICAgICAgICAvLyB0aGF0IGFyZSBhbHJlYWR5IGluIHRoZSBwYWdlXHJcbiAgICAgICAgcmV0dXJuICghISgoX2EgPSBfd2luZG93KCkuZ3JlY2FwdGNoYSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbmRlcikgJiZcclxuICAgICAgICAgICAgKGhsID09PSB0aGlzLmhvc3RMYW5ndWFnZSB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudGVyID4gMCB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5saWJyYXJ5U2VwYXJhdGVseUxvYWRlZCkpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGlzSG9zdExhbmd1YWdlVmFsaWQoaGwpIHtcclxuICAgIHJldHVybiBobC5sZW5ndGggPD0gNiAmJiAvXlxccypbYS16QS1aMC05XFwtXSpcXHMqJC8udGVzdChobCk7XHJcbn1cclxuY2xhc3MgTW9ja1JlQ2FwdGNoYUxvYWRlckltcGwge1xyXG4gICAgYXN5bmMgbG9hZChhdXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBNb2NrUmVDYXB0Y2hhKGF1dGgpO1xyXG4gICAgfVxyXG4gICAgY2xlYXJlZE9uZUluc3RhbmNlKCkgeyB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgUkVDQVBUQ0hBX1ZFUklGSUVSX1RZUEUgPSAncmVjYXB0Y2hhJztcclxuY29uc3QgREVGQVVMVF9QQVJBTVMgPSB7XHJcbiAgICB0aGVtZTogJ2xpZ2h0JyxcclxuICAgIHR5cGU6ICdpbWFnZSdcclxufTtcclxuLyoqXHJcbiAqIEFuIHtAbGluayBodHRwczovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS8gfCByZUNBUFRDSEF9LWJhc2VkIGFwcGxpY2F0aW9uIHZlcmlmaWVyLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBgUmVjYXB0Y2hhVmVyaWZpZXJgIGRvZXMgbm90IHdvcmsgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBSZWNhcHRjaGFWZXJpZmllciB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBhdXRoRXh0ZXJuIC0gVGhlIGNvcnJlc3BvbmRpbmcgRmlyZWJhc2Uge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb250YWluZXJPcklkIC0gVGhlIHJlQ0FQVENIQSBjb250YWluZXIgcGFyYW1ldGVyLlxyXG4gICAgICpcclxuICAgICAqIEByZW1hcmtzXHJcbiAgICAgKiBUaGlzIGhhcyBkaWZmZXJlbnQgbWVhbmluZyBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgcmVDQVBUQ0hBIGlzIGhpZGRlbiBvciB2aXNpYmxlLiBGb3IgYVxyXG4gICAgICogdmlzaWJsZSByZUNBUFRDSEEgdGhlIGNvbnRhaW5lciBtdXN0IGJlIGVtcHR5LiBJZiBhIHN0cmluZyBpcyB1c2VkLCBpdCBoYXMgdG8gY29ycmVzcG9uZCB0b1xyXG4gICAgICogYW4gZWxlbWVudCBJRC4gVGhlIGNvcnJlc3BvbmRpbmcgZWxlbWVudCBtdXN0IGFsc28gbXVzdCBiZSBpbiB0aGUgRE9NIGF0IHRoZSB0aW1lIG9mXHJcbiAgICAgKiBpbml0aWFsaXphdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcGFyYW1ldGVycyAtIFRoZSBvcHRpb25hbCByZUNBUFRDSEEgcGFyYW1ldGVycy5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICogQ2hlY2sgdGhlIHJlQ0FQVENIQSBkb2NzIGZvciBhIGNvbXByZWhlbnNpdmUgbGlzdC4gQWxsIHBhcmFtZXRlcnMgYXJlIGFjY2VwdGVkIGV4Y2VwdCBmb3JcclxuICAgICAqIHRoZSBzaXRla2V5LiBGaXJlYmFzZSBBdXRoIGJhY2tlbmQgcHJvdmlzaW9ucyBhIHJlQ0FQVENIQSBmb3IgZWFjaCBwcm9qZWN0IGFuZCB3aWxsXHJcbiAgICAgKiBjb25maWd1cmUgdGhpcyB1cG9uIHJlbmRlcmluZy4gRm9yIGFuIGludmlzaWJsZSByZUNBUFRDSEEsIGEgc2l6ZSBrZXkgbXVzdCBoYXZlIHRoZSB2YWx1ZVxyXG4gICAgICogJ2ludmlzaWJsZScuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGF1dGhFeHRlcm4sIGNvbnRhaW5lck9ySWQsIHBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1BBUkFNUykpIHtcclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSBhcHBsaWNhdGlvbiB2ZXJpZmllciB0eXBlLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJlbWFya3NcclxuICAgICAgICAgKiBGb3IgYSByZUNBUFRDSEEgdmVyaWZpZXIsIHRoaXMgaXMgJ3JlY2FwdGNoYScuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy50eXBlID0gUkVDQVBUQ0hBX1ZFUklGSUVSX1RZUEU7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLndpZGdldElkID0gbnVsbDtcclxuICAgICAgICB0aGlzLnRva2VuQ2hhbmdlTGlzdGVuZXJzID0gbmV3IFNldCgpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyUHJvbWlzZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5yZWNhcHRjaGEgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IF9jYXN0QXV0aChhdXRoRXh0ZXJuKTtcclxuICAgICAgICB0aGlzLmlzSW52aXNpYmxlID0gdGhpcy5wYXJhbWV0ZXJzLnNpemUgPT09ICdpbnZpc2libGUnO1xyXG4gICAgICAgIF9hc3NlcnQodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJywgdGhpcy5hdXRoLCBcIm9wZXJhdGlvbi1ub3Qtc3VwcG9ydGVkLWluLXRoaXMtZW52aXJvbm1lbnRcIiAvKiBBdXRoRXJyb3JDb2RlLk9QRVJBVElPTl9OT1RfU1VQUE9SVEVEICovKTtcclxuICAgICAgICBjb25zdCBjb250YWluZXIgPSB0eXBlb2YgY29udGFpbmVyT3JJZCA9PT0gJ3N0cmluZydcclxuICAgICAgICAgICAgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXJPcklkKVxyXG4gICAgICAgICAgICA6IGNvbnRhaW5lck9ySWQ7XHJcbiAgICAgICAgX2Fzc2VydChjb250YWluZXIsIHRoaXMuYXV0aCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMucGFyYW1ldGVycy5jYWxsYmFjayA9IHRoaXMubWFrZVRva2VuQ2FsbGJhY2sodGhpcy5wYXJhbWV0ZXJzLmNhbGxiYWNrKTtcclxuICAgICAgICB0aGlzLl9yZWNhcHRjaGFMb2FkZXIgPSB0aGlzLmF1dGguc2V0dGluZ3MuYXBwVmVyaWZpY2F0aW9uRGlzYWJsZWRGb3JUZXN0aW5nXHJcbiAgICAgICAgICAgID8gbmV3IE1vY2tSZUNhcHRjaGFMb2FkZXJJbXBsKClcclxuICAgICAgICAgICAgOiBuZXcgUmVDYXB0Y2hhTG9hZGVySW1wbCgpO1xyXG4gICAgICAgIHRoaXMudmFsaWRhdGVTdGFydGluZ1N0YXRlKCk7XHJcbiAgICAgICAgLy8gVE9ETzogRmlndXJlIG91dCBpZiBzZGsgdmVyc2lvbiBpcyBuZWVkZWRcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogV2FpdHMgZm9yIHRoZSB1c2VyIHRvIHNvbHZlIHRoZSByZUNBUFRDSEEgYW5kIHJlc29sdmVzIHdpdGggdGhlIHJlQ0FQVENIQSB0b2tlbi5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBBIFByb21pc2UgZm9yIHRoZSByZUNBUFRDSEEgdG9rZW4uXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIHZlcmlmeSgpIHtcclxuICAgICAgICB0aGlzLmFzc2VydE5vdERlc3Ryb3llZCgpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gYXdhaXQgdGhpcy5yZW5kZXIoKTtcclxuICAgICAgICBjb25zdCByZWNhcHRjaGEgPSB0aGlzLmdldEFzc2VydGVkUmVjYXB0Y2hhKCk7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSByZWNhcHRjaGEuZ2V0UmVzcG9uc2UoaWQpO1xyXG4gICAgICAgIGlmIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdG9rZW5DaGFuZ2UgPSAodG9rZW4pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIElnbm9yZSB0b2tlbiBleHBpcmF0aW9ucy5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMudG9rZW5DaGFuZ2VMaXN0ZW5lcnMuZGVsZXRlKHRva2VuQ2hhbmdlKTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUodG9rZW4pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnRva2VuQ2hhbmdlTGlzdGVuZXJzLmFkZCh0b2tlbkNoYW5nZSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSW52aXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZWNhcHRjaGEuZXhlY3V0ZShpZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVuZGVycyB0aGUgcmVDQVBUQ0hBIHdpZGdldCBvbiB0aGUgcGFnZS5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSByZUNBUFRDSEEgd2lkZ2V0IElELlxyXG4gICAgICovXHJcbiAgICByZW5kZXIoKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdGhpcy5hc3NlcnROb3REZXN0cm95ZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gVGhpcyBtZXRob2QgcmV0dXJucyBhIHByb21pc2UuIFNpbmNlIGl0J3Mgbm90IGFzeW5jICh3ZSB3YW50IHRvIHJldHVybiB0aGVcclxuICAgICAgICAgICAgLy8gX3NhbWVfIHByb21pc2UgaWYgcmVuZGVyaW5nIGlzIHN0aWxsIG9jY3VycmluZyksIHRoZSBBUEkgc3VyZmFjZSBzaG91bGRcclxuICAgICAgICAgICAgLy8gcmVqZWN0IHdpdGggdGhlIGVycm9yIHJhdGhlciB0aGFuIGp1c3QgdGhyb3dcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5yZW5kZXJQcm9taXNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlclByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVuZGVyUHJvbWlzZSA9IHRoaXMubWFrZVJlbmRlclByb21pc2UoKS5jYXRjaChlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJQcm9taXNlID0gbnVsbDtcclxuICAgICAgICAgICAgdGhyb3cgZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJQcm9taXNlO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX3Jlc2V0KCkge1xyXG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90RGVzdHJveWVkKCk7XHJcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0SWQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5nZXRBc3NlcnRlZFJlY2FwdGNoYSgpLnJlc2V0KHRoaXMud2lkZ2V0SWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ2xlYXJzIHRoZSByZUNBUFRDSEEgd2lkZ2V0IGZyb20gdGhlIHBhZ2UgYW5kIGRlc3Ryb3lzIHRoZSBpbnN0YW5jZS5cclxuICAgICAqL1xyXG4gICAgY2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5hc3NlcnROb3REZXN0cm95ZWQoKTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3llZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fcmVjYXB0Y2hhTG9hZGVyLmNsZWFyZWRPbmVJbnN0YW5jZSgpO1xyXG4gICAgICAgIGlmICghdGhpcy5pc0ludmlzaWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jaGlsZE5vZGVzLmZvckVhY2gobm9kZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVDaGlsZChub2RlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmFsaWRhdGVTdGFydGluZ1N0YXRlKCkge1xyXG4gICAgICAgIF9hc3NlcnQoIXRoaXMucGFyYW1ldGVycy5zaXRla2V5LCB0aGlzLmF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICBfYXNzZXJ0KHRoaXMuaXNJbnZpc2libGUgfHwgIXRoaXMuY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSwgdGhpcy5hdXRoLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnLCB0aGlzLmF1dGgsIFwib3BlcmF0aW9uLW5vdC1zdXBwb3J0ZWQtaW4tdGhpcy1lbnZpcm9ubWVudFwiIC8qIEF1dGhFcnJvckNvZGUuT1BFUkFUSU9OX05PVF9TVVBQT1JURUQgKi8pO1xyXG4gICAgfVxyXG4gICAgbWFrZVRva2VuQ2FsbGJhY2soZXhpc3RpbmcpIHtcclxuICAgICAgICByZXR1cm4gdG9rZW4gPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnRva2VuQ2hhbmdlTGlzdGVuZXJzLmZvckVhY2gobGlzdGVuZXIgPT4gbGlzdGVuZXIodG9rZW4pKTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBleGlzdGluZyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgZXhpc3RpbmcodG9rZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBleGlzdGluZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdsb2JhbEZ1bmMgPSBfd2luZG93KClbZXhpc3RpbmddO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBnbG9iYWxGdW5jID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRnVuYyh0b2tlbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgYXNzZXJ0Tm90RGVzdHJveWVkKCkge1xyXG4gICAgICAgIF9hc3NlcnQoIXRoaXMuZGVzdHJveWVkLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIH1cclxuICAgIGFzeW5jIG1ha2VSZW5kZXJQcm9taXNlKCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuaW5pdCgpO1xyXG4gICAgICAgIGlmICghdGhpcy53aWRnZXRJZCkge1xyXG4gICAgICAgICAgICBsZXQgY29udGFpbmVyID0gdGhpcy5jb250YWluZXI7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0ludmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3VhcmFudGVlZEVtcHR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZ3VhcmFudGVlZEVtcHR5KTtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lciA9IGd1YXJhbnRlZWRFbXB0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLndpZGdldElkID0gdGhpcy5nZXRBc3NlcnRlZFJlY2FwdGNoYSgpLnJlbmRlcihjb250YWluZXIsIHRoaXMucGFyYW1ldGVycyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLndpZGdldElkO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgaW5pdCgpIHtcclxuICAgICAgICBfYXNzZXJ0KF9pc0h0dHBPckh0dHBzKCkgJiYgIV9pc1dvcmtlcigpLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICBhd2FpdCBkb21SZWFkeSgpO1xyXG4gICAgICAgIHRoaXMucmVjYXB0Y2hhID0gYXdhaXQgdGhpcy5fcmVjYXB0Y2hhTG9hZGVyLmxvYWQodGhpcy5hdXRoLCB0aGlzLmF1dGgubGFuZ3VhZ2VDb2RlIHx8IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgY29uc3Qgc2l0ZUtleSA9IGF3YWl0IGdldFJlY2FwdGNoYVBhcmFtcyh0aGlzLmF1dGgpO1xyXG4gICAgICAgIF9hc3NlcnQoc2l0ZUtleSwgdGhpcy5hdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLnNpdGVrZXkgPSBzaXRlS2V5O1xyXG4gICAgfVxyXG4gICAgZ2V0QXNzZXJ0ZWRSZWNhcHRjaGEoKSB7XHJcbiAgICAgICAgX2Fzc2VydCh0aGlzLnJlY2FwdGNoYSwgdGhpcy5hdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjYXB0Y2hhO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGRvbVJlYWR5KCkge1xyXG4gICAgbGV0IHJlc29sdmVyID0gbnVsbDtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykge1xyXG4gICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRG9jdW1lbnQgbm90IHJlYWR5LCB3YWl0IGZvciBsb2FkIGJlZm9yZSByZXNvbHZpbmcuXHJcbiAgICAgICAgLy8gU2F2ZSByZXNvbHZlciwgc28gd2UgY2FuIHJlbW92ZSBsaXN0ZW5lciBpbiBjYXNlIGl0IHdhcyBleHRlcm5hbGx5XHJcbiAgICAgICAgLy8gY2FuY2VsbGVkLlxyXG4gICAgICAgIHJlc29sdmVyID0gKCkgPT4gcmVzb2x2ZSgpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgcmVzb2x2ZXIpO1xyXG4gICAgfSkuY2F0Y2goZSA9PiB7XHJcbiAgICAgICAgaWYgKHJlc29sdmVyKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgcmVzb2x2ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBlO1xyXG4gICAgfSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgQ29uZmlybWF0aW9uUmVzdWx0SW1wbCB7XHJcbiAgICBjb25zdHJ1Y3Rvcih2ZXJpZmljYXRpb25JZCwgb25Db25maXJtYXRpb24pIHtcclxuICAgICAgICB0aGlzLnZlcmlmaWNhdGlvbklkID0gdmVyaWZpY2F0aW9uSWQ7XHJcbiAgICAgICAgdGhpcy5vbkNvbmZpcm1hdGlvbiA9IG9uQ29uZmlybWF0aW9uO1xyXG4gICAgfVxyXG4gICAgY29uZmlybSh2ZXJpZmljYXRpb25Db2RlKSB7XHJcbiAgICAgICAgY29uc3QgYXV0aENyZWRlbnRpYWwgPSBQaG9uZUF1dGhDcmVkZW50aWFsLl9mcm9tVmVyaWZpY2F0aW9uKHRoaXMudmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9uQ29uZmlybWF0aW9uKGF1dGhDcmVkZW50aWFsKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogQXN5bmNocm9ub3VzbHkgc2lnbnMgaW4gdXNpbmcgYSBwaG9uZSBudW1iZXIuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoaXMgbWV0aG9kIHNlbmRzIGEgY29kZSB2aWEgU01TIHRvIHRoZSBnaXZlblxyXG4gKiBwaG9uZSBudW1iZXIsIGFuZCByZXR1cm5zIGEge0BsaW5rIENvbmZpcm1hdGlvblJlc3VsdH0uIEFmdGVyIHRoZSB1c2VyXHJcbiAqIHByb3ZpZGVzIHRoZSBjb2RlIHNlbnQgdG8gdGhlaXIgcGhvbmUsIGNhbGwge0BsaW5rIENvbmZpcm1hdGlvblJlc3VsdC5jb25maXJtfVxyXG4gKiB3aXRoIHRoZSBjb2RlIHRvIHNpZ24gdGhlIHVzZXIgaW4uXHJcbiAqXHJcbiAqIEZvciBhYnVzZSBwcmV2ZW50aW9uLCB0aGlzIG1ldGhvZCBhbHNvIHJlcXVpcmVzIGEge0BsaW5rIEFwcGxpY2F0aW9uVmVyaWZpZXJ9LlxyXG4gKiBUaGlzIFNESyBpbmNsdWRlcyBhIHJlQ0FQVENIQS1iYXNlZCBpbXBsZW1lbnRhdGlvbiwge0BsaW5rIFJlY2FwdGNoYVZlcmlmaWVyfS5cclxuICogVGhpcyBmdW5jdGlvbiBjYW4gd29yayBvbiBvdGhlciBwbGF0Zm9ybXMgdGhhdCBkbyBub3Qgc3VwcG9ydCB0aGVcclxuICoge0BsaW5rIFJlY2FwdGNoYVZlcmlmaWVyfSAobGlrZSBSZWFjdCBOYXRpdmUpLCBidXQgeW91IG5lZWQgdG8gdXNlIGFcclxuICogdGhpcmQtcGFydHkge0BsaW5rIEFwcGxpY2F0aW9uVmVyaWZpZXJ9IGltcGxlbWVudGF0aW9uLlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudCBvciB3aXRoIHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGFcclxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vICdyZWNhcHRjaGEtY29udGFpbmVyJyBpcyB0aGUgSUQgb2YgYW4gZWxlbWVudCBpbiB0aGUgRE9NLlxyXG4gKiBjb25zdCBhcHBsaWNhdGlvblZlcmlmaWVyID0gbmV3IGZpcmViYXNlLmF1dGguUmVjYXB0Y2hhVmVyaWZpZXIoJ3JlY2FwdGNoYS1jb250YWluZXInKTtcclxuICogY29uc3QgY29uZmlybWF0aW9uUmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBob25lTnVtYmVyKGF1dGgsIHBob25lTnVtYmVyLCBhcHBsaWNhdGlvblZlcmlmaWVyKTtcclxuICogLy8gT2J0YWluIGEgdmVyaWZpY2F0aW9uQ29kZSBmcm9tIHRoZSB1c2VyLlxyXG4gKiBjb25zdCBjcmVkZW50aWFsID0gYXdhaXQgY29uZmlybWF0aW9uUmVzdWx0LmNvbmZpcm0odmVyaWZpY2F0aW9uQ29kZSk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBwaG9uZU51bWJlciAtIFRoZSB1c2VyJ3MgcGhvbmUgbnVtYmVyIGluIEUuMTY0IGZvcm1hdCAoZS5nLiArMTY1MDU1NTAxMDEpLlxyXG4gKiBAcGFyYW0gYXBwVmVyaWZpZXIgLSBUaGUge0BsaW5rIEFwcGxpY2F0aW9uVmVyaWZpZXJ9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoUGhvbmVOdW1iZXIoYXV0aCwgcGhvbmVOdW1iZXIsIGFwcFZlcmlmaWVyKSB7XHJcbiAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAoYXV0aC5hcHApKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIGNvbnN0IHZlcmlmaWNhdGlvbklkID0gYXdhaXQgX3ZlcmlmeVBob25lTnVtYmVyKGF1dGhJbnRlcm5hbCwgcGhvbmVOdW1iZXIsIGdldE1vZHVsYXJJbnN0YW5jZShhcHBWZXJpZmllcikpO1xyXG4gICAgcmV0dXJuIG5ldyBDb25maXJtYXRpb25SZXN1bHRJbXBsKHZlcmlmaWNhdGlvbklkLCBjcmVkID0+IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGhJbnRlcm5hbCwgY3JlZCkpO1xyXG59XHJcbi8qKlxyXG4gKiBMaW5rcyB0aGUgdXNlciBhY2NvdW50IHdpdGggdGhlIGdpdmVuIHBob25lIG51bWJlci5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBtZXRob2QgZG9lcyBub3Qgd29yayBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwaG9uZU51bWJlciAtIFRoZSB1c2VyJ3MgcGhvbmUgbnVtYmVyIGluIEUuMTY0IGZvcm1hdCAoZS5nLiArMTY1MDU1NTAxMDEpLlxyXG4gKiBAcGFyYW0gYXBwVmVyaWZpZXIgLSBUaGUge0BsaW5rIEFwcGxpY2F0aW9uVmVyaWZpZXJ9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBsaW5rV2l0aFBob25lTnVtYmVyKHVzZXIsIHBob25lTnVtYmVyLCBhcHBWZXJpZmllcikge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgYXdhaXQgX2Fzc2VydExpbmtlZFN0YXR1cyhmYWxzZSwgdXNlckludGVybmFsLCBcInBob25lXCIgLyogUHJvdmlkZXJJZC5QSE9ORSAqLyk7XHJcbiAgICBjb25zdCB2ZXJpZmljYXRpb25JZCA9IGF3YWl0IF92ZXJpZnlQaG9uZU51bWJlcih1c2VySW50ZXJuYWwuYXV0aCwgcGhvbmVOdW1iZXIsIGdldE1vZHVsYXJJbnN0YW5jZShhcHBWZXJpZmllcikpO1xyXG4gICAgcmV0dXJuIG5ldyBDb25maXJtYXRpb25SZXN1bHRJbXBsKHZlcmlmaWNhdGlvbklkLCBjcmVkID0+IGxpbmtXaXRoQ3JlZGVudGlhbCh1c2VySW50ZXJuYWwsIGNyZWQpKTtcclxufVxyXG4vKipcclxuICogUmUtYXV0aGVudGljYXRlcyBhIHVzZXIgdXNpbmcgYSBmcmVzaCBwaG9uZSBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBVc2UgYmVmb3JlIG9wZXJhdGlvbnMgc3VjaCBhcyB7QGxpbmsgdXBkYXRlUGFzc3dvcmR9IHRoYXQgcmVxdWlyZSB0b2tlbnMgZnJvbSByZWNlbnQgc2lnbi1pbiBhdHRlbXB0cy5cclxuICpcclxuICogVGhpcyBtZXRob2QgZG9lcyBub3Qgd29yayBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQgb3Igb24gYW55IHtAbGluayBVc2VyfSBzaWduZWQgaW4gYnlcclxuICoge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZVNlcnZlckFwcH0uXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwaG9uZU51bWJlciAtIFRoZSB1c2VyJ3MgcGhvbmUgbnVtYmVyIGluIEUuMTY0IGZvcm1hdCAoZS5nLiArMTY1MDU1NTAxMDEpLlxyXG4gKiBAcGFyYW0gYXBwVmVyaWZpZXIgLSBUaGUge0BsaW5rIEFwcGxpY2F0aW9uVmVyaWZpZXJ9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiByZWF1dGhlbnRpY2F0ZVdpdGhQaG9uZU51bWJlcih1c2VyLCBwaG9uZU51bWJlciwgYXBwVmVyaWZpZXIpIHtcclxuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcCh1c2VySW50ZXJuYWwuYXV0aC5hcHApKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKHVzZXJJbnRlcm5hbC5hdXRoKSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB2ZXJpZmljYXRpb25JZCA9IGF3YWl0IF92ZXJpZnlQaG9uZU51bWJlcih1c2VySW50ZXJuYWwuYXV0aCwgcGhvbmVOdW1iZXIsIGdldE1vZHVsYXJJbnN0YW5jZShhcHBWZXJpZmllcikpO1xyXG4gICAgcmV0dXJuIG5ldyBDb25maXJtYXRpb25SZXN1bHRJbXBsKHZlcmlmaWNhdGlvbklkLCBjcmVkID0+IHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwodXNlckludGVybmFsLCBjcmVkKSk7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgYSB2ZXJpZmljYXRpb24gSUQgdG8gYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIHRoZSBTTVMgY29kZSB0aGF0IGlzIHNlbnQuXHJcbiAqXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBfdmVyaWZ5UGhvbmVOdW1iZXIoYXV0aCwgb3B0aW9ucywgdmVyaWZpZXIpIHtcclxuICAgIHZhciBfYTtcclxuICAgIGNvbnN0IHJlY2FwdGNoYVRva2VuID0gYXdhaXQgdmVyaWZpZXIudmVyaWZ5KCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIF9hc3NlcnQodHlwZW9mIHJlY2FwdGNoYVRva2VuID09PSAnc3RyaW5nJywgYXV0aCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIF9hc3NlcnQodmVyaWZpZXIudHlwZSA9PT0gUkVDQVBUQ0hBX1ZFUklGSUVSX1RZUEUsIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICBsZXQgcGhvbmVJbmZvT3B0aW9ucztcclxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHBob25lSW5mb09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBwaG9uZU51bWJlcjogb3B0aW9uc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcGhvbmVJbmZvT3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgnc2Vzc2lvbicgaW4gcGhvbmVJbmZvT3B0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBzZXNzaW9uID0gcGhvbmVJbmZvT3B0aW9ucy5zZXNzaW9uO1xyXG4gICAgICAgICAgICBpZiAoJ3Bob25lTnVtYmVyJyBpbiBwaG9uZUluZm9PcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBfYXNzZXJ0KHNlc3Npb24udHlwZSA9PT0gXCJlbnJvbGxcIiAvKiBNdWx0aUZhY3RvclNlc3Npb25UeXBlLkVOUk9MTCAqLywgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdGFydEVucm9sbFBob25lTWZhKGF1dGgsIHtcclxuICAgICAgICAgICAgICAgICAgICBpZFRva2VuOiBzZXNzaW9uLmNyZWRlbnRpYWwsXHJcbiAgICAgICAgICAgICAgICAgICAgcGhvbmVFbnJvbGxtZW50SW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwaG9uZU51bWJlcjogcGhvbmVJbmZvT3B0aW9ucy5waG9uZU51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjYXB0Y2hhVG9rZW5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5waG9uZVNlc3Npb25JbmZvLnNlc3Npb25JbmZvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX2Fzc2VydChzZXNzaW9uLnR5cGUgPT09IFwic2lnbmluXCIgLyogTXVsdGlGYWN0b3JTZXNzaW9uVHlwZS5TSUdOX0lOICovLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtZmFFbnJvbGxtZW50SWQgPSAoKF9hID0gcGhvbmVJbmZvT3B0aW9ucy5tdWx0aUZhY3RvckhpbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgcGhvbmVJbmZvT3B0aW9ucy5tdWx0aUZhY3RvclVpZDtcclxuICAgICAgICAgICAgICAgIF9hc3NlcnQobWZhRW5yb2xsbWVudElkLCBhdXRoLCBcIm1pc3NpbmctbXVsdGktZmFjdG9yLWluZm9cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX0lORk8gKi8pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdGFydFNpZ25JblBob25lTWZhKGF1dGgsIHtcclxuICAgICAgICAgICAgICAgICAgICBtZmFQZW5kaW5nQ3JlZGVudGlhbDogc2Vzc2lvbi5jcmVkZW50aWFsLFxyXG4gICAgICAgICAgICAgICAgICAgIG1mYUVucm9sbG1lbnRJZCxcclxuICAgICAgICAgICAgICAgICAgICBwaG9uZVNpZ25JbkluZm86IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjYXB0Y2hhVG9rZW5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5waG9uZVJlc3BvbnNlSW5mby5zZXNzaW9uSW5mbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgeyBzZXNzaW9uSW5mbyB9ID0gYXdhaXQgc2VuZFBob25lVmVyaWZpY2F0aW9uQ29kZShhdXRoLCB7XHJcbiAgICAgICAgICAgICAgICBwaG9uZU51bWJlcjogcGhvbmVJbmZvT3B0aW9ucy5waG9uZU51bWJlcixcclxuICAgICAgICAgICAgICAgIHJlY2FwdGNoYVRva2VuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gc2Vzc2lvbkluZm87XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZmluYWxseSB7XHJcbiAgICAgICAgdmVyaWZpZXIuX3Jlc2V0KCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFVwZGF0ZXMgdGhlIHVzZXIncyBwaG9uZSBudW1iZXIuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHdvcmsgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50IG9yIG9uIGFueSB7QGxpbmsgVXNlcn0gc2lnbmVkIGluIGJ5XHJcbiAqIHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGEge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBcclxuICogLy8gJ3JlY2FwdGNoYS1jb250YWluZXInIGlzIHRoZSBJRCBvZiBhbiBlbGVtZW50IGluIHRoZSBET00uXHJcbiAqIGNvbnN0IGFwcGxpY2F0aW9uVmVyaWZpZXIgPSBuZXcgUmVjYXB0Y2hhVmVyaWZpZXIoJ3JlY2FwdGNoYS1jb250YWluZXInKTtcclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgUGhvbmVBdXRoUHJvdmlkZXIoYXV0aCk7XHJcbiAqIGNvbnN0IHZlcmlmaWNhdGlvbklkID0gYXdhaXQgcHJvdmlkZXIudmVyaWZ5UGhvbmVOdW1iZXIoJysxNjUwNTU1MDEwMScsIGFwcGxpY2F0aW9uVmVyaWZpZXIpO1xyXG4gKiAvLyBPYnRhaW4gdGhlIHZlcmlmaWNhdGlvbkNvZGUgZnJvbSB0aGUgdXNlci5cclxuICogY29uc3QgcGhvbmVDcmVkZW50aWFsID0gUGhvbmVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSk7XHJcbiAqIGF3YWl0IHVwZGF0ZVBob25lTnVtYmVyKHVzZXIsIHBob25lQ3JlZGVudGlhbCk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gY3JlZGVudGlhbCAtIEEgY3JlZGVudGlhbCBhdXRoZW50aWNhdGluZyB0aGUgbmV3IHBob25lIG51bWJlci5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlUGhvbmVOdW1iZXIodXNlciwgY3JlZGVudGlhbCkge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKHVzZXJJbnRlcm5hbC5hdXRoLmFwcCkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IodXNlckludGVybmFsLmF1dGgpKTtcclxuICAgIH1cclxuICAgIGF3YWl0IF9saW5rJDEodXNlckludGVybmFsLCBjcmVkZW50aWFsKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4ge0BsaW5rIFBob25lQXV0aENyZWRlbnRpYWx9LlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBgUGhvbmVBdXRoUHJvdmlkZXJgIGRvZXMgbm90IHdvcmsgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vICdyZWNhcHRjaGEtY29udGFpbmVyJyBpcyB0aGUgSUQgb2YgYW4gZWxlbWVudCBpbiB0aGUgRE9NLlxyXG4gKiBjb25zdCBhcHBsaWNhdGlvblZlcmlmaWVyID0gbmV3IFJlY2FwdGNoYVZlcmlmaWVyKCdyZWNhcHRjaGEtY29udGFpbmVyJyk7XHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IFBob25lQXV0aFByb3ZpZGVyKGF1dGgpO1xyXG4gKiBjb25zdCB2ZXJpZmljYXRpb25JZCA9IGF3YWl0IHByb3ZpZGVyLnZlcmlmeVBob25lTnVtYmVyKCcrMTY1MDU1NTAxMDEnLCBhcHBsaWNhdGlvblZlcmlmaWVyKTtcclxuICogLy8gT2J0YWluIHRoZSB2ZXJpZmljYXRpb25Db2RlIGZyb20gdGhlIHVzZXIuXHJcbiAqIGNvbnN0IHBob25lQ3JlZGVudGlhbCA9IFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUpO1xyXG4gKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIHBob25lQ3JlZGVudGlhbCk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBQaG9uZUF1dGhQcm92aWRlciB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBhdXRoIC0gVGhlIEZpcmViYXNlIHtAbGluayBBdXRofSBpbnN0YW5jZSBpbiB3aGljaCBzaWduLWlucyBzaG91bGQgb2NjdXIuXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBIT05FLiAqL1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IFBob25lQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEO1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIFN0YXJ0cyBhIHBob25lIG51bWJlciBhdXRoZW50aWNhdGlvbiBmbG93IGJ5IHNlbmRpbmcgYSB2ZXJpZmljYXRpb24gY29kZSB0byB0aGUgZ2l2ZW4gcGhvbmVcclxuICAgICAqIG51bWJlci5cclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogY29uc3QgcHJvdmlkZXIgPSBuZXcgUGhvbmVBdXRoUHJvdmlkZXIoYXV0aCk7XHJcbiAgICAgKiBjb25zdCB2ZXJpZmljYXRpb25JZCA9IGF3YWl0IHByb3ZpZGVyLnZlcmlmeVBob25lTnVtYmVyKHBob25lTnVtYmVyLCBhcHBsaWNhdGlvblZlcmlmaWVyKTtcclxuICAgICAqIC8vIE9idGFpbiB2ZXJpZmljYXRpb25Db2RlIGZyb20gdGhlIHVzZXIuXHJcbiAgICAgKiBjb25zdCBhdXRoQ3JlZGVudGlhbCA9IFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUpO1xyXG4gICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChhdXRoLCBhdXRoQ3JlZGVudGlhbCk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogQW4gYWx0ZXJuYXRpdmUgZmxvdyBpcyBwcm92aWRlZCB1c2luZyB0aGUgYHNpZ25JbldpdGhQaG9uZU51bWJlcmAgbWV0aG9kLlxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogY29uc3QgY29uZmlybWF0aW9uUmVzdWx0ID0gc2lnbkluV2l0aFBob25lTnVtYmVyKGF1dGgsIHBob25lTnVtYmVyLCBhcHBsaWNhdGlvblZlcmlmaWVyKTtcclxuICAgICAqIC8vIE9idGFpbiB2ZXJpZmljYXRpb25Db2RlIGZyb20gdGhlIHVzZXIuXHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGNvbmZpcm1hdGlvblJlc3VsdC5jb25maXJtKHZlcmlmaWNhdGlvbkNvZGUpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBob25lSW5mb09wdGlvbnMgLSBUaGUgdXNlcidzIHtAbGluayBQaG9uZUluZm9PcHRpb25zfS4gVGhlIHBob25lIG51bWJlciBzaG91bGQgYmUgaW5cclxuICAgICAqIEUuMTY0IGZvcm1hdCAoZS5nLiArMTY1MDU1NTAxMDEpLlxyXG4gICAgICogQHBhcmFtIGFwcGxpY2F0aW9uVmVyaWZpZXIgLSBGb3IgYWJ1c2UgcHJldmVudGlvbiwgdGhpcyBtZXRob2QgYWxzbyByZXF1aXJlcyBhXHJcbiAgICAgKiB7QGxpbmsgQXBwbGljYXRpb25WZXJpZmllcn0uIFRoaXMgU0RLIGluY2x1ZGVzIGEgcmVDQVBUQ0hBLWJhc2VkIGltcGxlbWVudGF0aW9uLFxyXG4gICAgICoge0BsaW5rIFJlY2FwdGNoYVZlcmlmaWVyfS5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBBIFByb21pc2UgZm9yIGEgdmVyaWZpY2F0aW9uIElEIHRoYXQgY2FuIGJlIHBhc3NlZCB0b1xyXG4gICAgICoge0BsaW5rIFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWx9IHRvIGlkZW50aWZ5IHRoaXMgZmxvdy4uXHJcbiAgICAgKi9cclxuICAgIHZlcmlmeVBob25lTnVtYmVyKHBob25lT3B0aW9ucywgYXBwbGljYXRpb25WZXJpZmllcikge1xyXG4gICAgICAgIHJldHVybiBfdmVyaWZ5UGhvbmVOdW1iZXIodGhpcy5hdXRoLCBwaG9uZU9wdGlvbnMsIGdldE1vZHVsYXJJbnN0YW5jZShhcHBsaWNhdGlvblZlcmlmaWVyKSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBwaG9uZSBhdXRoIGNyZWRlbnRpYWwsIGdpdmVuIHRoZSB2ZXJpZmljYXRpb24gSUQgZnJvbVxyXG4gICAgICoge0BsaW5rIFBob25lQXV0aFByb3ZpZGVyLnZlcmlmeVBob25lTnVtYmVyfSBhbmQgdGhlIGNvZGUgdGhhdCB3YXMgc2VudCB0byB0aGUgdXNlcidzXHJcbiAgICAgKiBtb2JpbGUgZGV2aWNlLlxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiBjb25zdCBwcm92aWRlciA9IG5ldyBQaG9uZUF1dGhQcm92aWRlcihhdXRoKTtcclxuICAgICAqIGNvbnN0IHZlcmlmaWNhdGlvbklkID0gcHJvdmlkZXIudmVyaWZ5UGhvbmVOdW1iZXIocGhvbmVOdW1iZXIsIGFwcGxpY2F0aW9uVmVyaWZpZXIpO1xyXG4gICAgICogLy8gT2J0YWluIHZlcmlmaWNhdGlvbkNvZGUgZnJvbSB0aGUgdXNlci5cclxuICAgICAqIGNvbnN0IGF1dGhDcmVkZW50aWFsID0gUGhvbmVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSk7XHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGF1dGhDcmVkZW50aWFsKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBBbiBhbHRlcm5hdGl2ZSBmbG93IGlzIHByb3ZpZGVkIHVzaW5nIHRoZSBgc2lnbkluV2l0aFBob25lTnVtYmVyYCBtZXRob2QuXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiBjb25zdCBjb25maXJtYXRpb25SZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUGhvbmVOdW1iZXIoYXV0aCwgcGhvbmVOdW1iZXIsIGFwcGxpY2F0aW9uVmVyaWZpZXIpO1xyXG4gICAgICogLy8gT2J0YWluIHZlcmlmaWNhdGlvbkNvZGUgZnJvbSB0aGUgdXNlci5cclxuICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgY29uZmlybWF0aW9uUmVzdWx0LmNvbmZpcm0odmVyaWZpY2F0aW9uQ29kZSk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdmVyaWZpY2F0aW9uSWQgLSBUaGUgdmVyaWZpY2F0aW9uIElEIHJldHVybmVkIGZyb20ge0BsaW5rIFBob25lQXV0aFByb3ZpZGVyLnZlcmlmeVBob25lTnVtYmVyfS5cclxuICAgICAqIEBwYXJhbSB2ZXJpZmljYXRpb25Db2RlIC0gVGhlIHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8gdGhlIHVzZXIncyBtb2JpbGUgZGV2aWNlLlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIFRoZSBhdXRoIHByb3ZpZGVyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsKHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlKSB7XHJcbiAgICAgICAgcmV0dXJuIFBob25lQXV0aENyZWRlbnRpYWwuX2Zyb21WZXJpZmljYXRpb24odmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZW5lcmF0ZXMgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS5cclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xyXG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWwgPSB1c2VyQ3JlZGVudGlhbDtcclxuICAgICAgICByZXR1cm4gUGhvbmVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoY3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSB3aGVuIHBhc3NlZCBhbiBlcnJvci5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICpcclxuICAgICAqIFRoaXMgbWV0aG9kIHdvcmtzIGZvciBlcnJvcnMgbGlrZVxyXG4gICAgICogYGF1dGgvYWNjb3VudC1leGlzdHMtd2l0aC1kaWZmZXJlbnQtY3JlZGVudGlhbHNgLiBUaGlzIGlzIHVzZWZ1bCBmb3JcclxuICAgICAqIHJlY292ZXJpbmcgd2hlbiBhdHRlbXB0aW5nIHRvIHNldCBhIHVzZXIncyBwaG9uZSBudW1iZXIgYnV0IHRoZSBudW1iZXJcclxuICAgICAqIGluIHF1ZXN0aW9uIGlzIGFscmVhZHkgdGllZCB0byBhbm90aGVyIGFjY291bnQuIEZvciBleGFtcGxlLCB0aGUgZm9sbG93aW5nXHJcbiAgICAgKiBjb2RlIHRyaWVzIHRvIHVwZGF0ZSB0aGUgY3VycmVudCB1c2VyJ3MgcGhvbmUgbnVtYmVyLCBhbmQgaWYgdGhhdFxyXG4gICAgICogZmFpbHMsIGxpbmtzIHRoZSB1c2VyIHdpdGggdGhlIGFjY291bnQgYXNzb2NpYXRlZCB3aXRoIHRoYXQgbnVtYmVyOlxyXG4gICAgICpcclxuICAgICAqIGBgYGpzXHJcbiAgICAgKiBjb25zdCBwcm92aWRlciA9IG5ldyBQaG9uZUF1dGhQcm92aWRlcihhdXRoKTtcclxuICAgICAqIGNvbnN0IHZlcmlmaWNhdGlvbklkID0gYXdhaXQgcHJvdmlkZXIudmVyaWZ5UGhvbmVOdW1iZXIobnVtYmVyLCB2ZXJpZmllcik7XHJcbiAgICAgKiB0cnkge1xyXG4gICAgICogICBjb25zdCBjb2RlID0gJyc7IC8vIFByb21wdCB0aGUgdXNlciBmb3IgdGhlIHZlcmlmaWNhdGlvbiBjb2RlXHJcbiAgICAgKiAgIGF3YWl0IHVwZGF0ZVBob25lTnVtYmVyKFxyXG4gICAgICogICAgICAgYXV0aC5jdXJyZW50VXNlcixcclxuICAgICAqICAgICAgIFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodmVyaWZpY2F0aW9uSWQsIGNvZGUpKTtcclxuICAgICAqIH0gY2F0Y2ggKGUpIHtcclxuICAgICAqICAgaWYgKChlIGFzIEZpcmViYXNlRXJyb3IpPy5jb2RlID09PSAnYXV0aC9hY2NvdW50LWV4aXN0cy13aXRoLWRpZmZlcmVudC1jcmVkZW50aWFsJykge1xyXG4gICAgICogICAgIGNvbnN0IGNyZWQgPSBQaG9uZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbUVycm9yKGUpO1xyXG4gICAgICogICAgIGF3YWl0IGxpbmtXaXRoQ3JlZGVudGlhbChhdXRoLmN1cnJlbnRVc2VyLCBjcmVkKTtcclxuICAgICAqICAgfVxyXG4gICAgICogfVxyXG4gICAgICpcclxuICAgICAqIC8vIEF0IHRoaXMgcG9pbnQsIGF1dGguY3VycmVudFVzZXIucGhvbmVOdW1iZXIgPT09IG51bWJlci5cclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBlcnJvciAtIFRoZSBlcnJvciB0byBnZW5lcmF0ZSBhIGNyZWRlbnRpYWwgZnJvbS5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUGhvbmVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgcGhvbmVOdW1iZXIsIHRlbXBvcmFyeVByb29mIH0gPSB0b2tlblJlc3BvbnNlO1xyXG4gICAgICAgIGlmIChwaG9uZU51bWJlciAmJiB0ZW1wb3JhcnlQcm9vZikge1xyXG4gICAgICAgICAgICByZXR1cm4gUGhvbmVBdXRoQ3JlZGVudGlhbC5fZnJvbVRva2VuUmVzcG9uc2UocGhvbmVOdW1iZXIsIHRlbXBvcmFyeVByb29mKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbn1cclxuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBIT05FLiAqL1xyXG5QaG9uZUF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9IFwicGhvbmVcIiAvKiBQcm92aWRlcklkLlBIT05FICovO1xyXG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5QSE9ORS4gKi9cclxuUGhvbmVBdXRoUHJvdmlkZXIuUEhPTkVfU0lHTl9JTl9NRVRIT0QgPSBcInBob25lXCIgLyogU2lnbkluTWV0aG9kLlBIT05FICovO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQ2hvb3NlcyBhIHBvcHVwL3JlZGlyZWN0IHJlc29sdmVyIHRvIHVzZS4gVGhpcyBwcmVmZXJzIHRoZSBvdmVycmlkZSAod2hpY2hcclxuICogaXMgZGlyZWN0bHkgcGFzc2VkIGluKSwgYW5kIGZhbGxzIGJhY2sgdG8gdGhlIHByb3BlcnR5IHNldCBvbiB0aGUgYXV0aFxyXG4gKiBvYmplY3QuIElmIG5laXRoZXIgYXJlIGF2YWlsYWJsZSwgdGhpcyBmdW5jdGlvbiBlcnJvcnMgdy8gYW4gYXJndW1lbnQgZXJyb3IuXHJcbiAqL1xyXG5mdW5jdGlvbiBfd2l0aERlZmF1bHRSZXNvbHZlcihhdXRoLCByZXNvbHZlck92ZXJyaWRlKSB7XHJcbiAgICBpZiAocmVzb2x2ZXJPdmVycmlkZSkge1xyXG4gICAgICAgIHJldHVybiBfZ2V0SW5zdGFuY2UocmVzb2x2ZXJPdmVycmlkZSk7XHJcbiAgICB9XHJcbiAgICBfYXNzZXJ0KGF1dGguX3BvcHVwUmVkaXJlY3RSZXNvbHZlciwgYXV0aCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgcmV0dXJuIGF1dGguX3BvcHVwUmVkaXJlY3RSZXNvbHZlcjtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBJZHBDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwge1xyXG4gICAgY29uc3RydWN0b3IocGFyYW1zKSB7XHJcbiAgICAgICAgc3VwZXIoXCJjdXN0b21cIiAvKiBQcm92aWRlcklkLkNVU1RPTSAqLywgXCJjdXN0b21cIiAvKiBQcm92aWRlcklkLkNVU1RPTSAqLyk7XHJcbiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgICB9XHJcbiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHtcclxuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCB0aGlzLl9idWlsZElkcFJlcXVlc3QoKSk7XHJcbiAgICB9XHJcbiAgICBfbGlua1RvSWRUb2tlbihhdXRoLCBpZFRva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgdGhpcy5fYnVpbGRJZHBSZXF1ZXN0KGlkVG9rZW4pKTtcclxuICAgIH1cclxuICAgIF9nZXRSZWF1dGhlbnRpY2F0aW9uUmVzb2x2ZXIoYXV0aCkge1xyXG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHRoaXMuX2J1aWxkSWRwUmVxdWVzdCgpKTtcclxuICAgIH1cclxuICAgIF9idWlsZElkcFJlcXVlc3QoaWRUb2tlbikge1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RVcmk6IHRoaXMucGFyYW1zLnJlcXVlc3RVcmksXHJcbiAgICAgICAgICAgIHNlc3Npb25JZDogdGhpcy5wYXJhbXMuc2Vzc2lvbklkLFxyXG4gICAgICAgICAgICBwb3N0Qm9keTogdGhpcy5wYXJhbXMucG9zdEJvZHksXHJcbiAgICAgICAgICAgIHRlbmFudElkOiB0aGlzLnBhcmFtcy50ZW5hbnRJZCxcclxuICAgICAgICAgICAgcGVuZGluZ1Rva2VuOiB0aGlzLnBhcmFtcy5wZW5kaW5nVG9rZW4sXHJcbiAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxyXG4gICAgICAgICAgICByZXR1cm5JZHBDcmVkZW50aWFsOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoaWRUb2tlbikge1xyXG4gICAgICAgICAgICByZXF1ZXN0LmlkVG9rZW4gPSBpZFRva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVxdWVzdDtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBfc2lnbkluKHBhcmFtcykge1xyXG4gICAgcmV0dXJuIF9zaWduSW5XaXRoQ3JlZGVudGlhbChwYXJhbXMuYXV0aCwgbmV3IElkcENyZWRlbnRpYWwocGFyYW1zKSwgcGFyYW1zLmJ5cGFzc0F1dGhTdGF0ZSk7XHJcbn1cclxuZnVuY3Rpb24gX3JlYXV0aChwYXJhbXMpIHtcclxuICAgIGNvbnN0IHsgYXV0aCwgdXNlciB9ID0gcGFyYW1zO1xyXG4gICAgX2Fzc2VydCh1c2VyLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICByZXR1cm4gX3JlYXV0aGVudGljYXRlKHVzZXIsIG5ldyBJZHBDcmVkZW50aWFsKHBhcmFtcyksIHBhcmFtcy5ieXBhc3NBdXRoU3RhdGUpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9saW5rKHBhcmFtcykge1xyXG4gICAgY29uc3QgeyBhdXRoLCB1c2VyIH0gPSBwYXJhbXM7XHJcbiAgICBfYXNzZXJ0KHVzZXIsIGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIHJldHVybiBfbGluayQxKHVzZXIsIG5ldyBJZHBDcmVkZW50aWFsKHBhcmFtcyksIHBhcmFtcy5ieXBhc3NBdXRoU3RhdGUpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQb3B1cCBldmVudCBtYW5hZ2VyLiBIYW5kbGVzIHRoZSBwb3B1cCdzIGVudGlyZSBsaWZlY3ljbGU7IGxpc3RlbnMgdG8gYXV0aFxyXG4gKiBldmVudHNcclxuICovXHJcbmNsYXNzIEFic3RyYWN0UG9wdXBSZWRpcmVjdE9wZXJhdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoLCBmaWx0ZXIsIHJlc29sdmVyLCB1c2VyLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkge1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlciA9IHJlc29sdmVyO1xyXG4gICAgICAgIHRoaXMudXNlciA9IHVzZXI7XHJcbiAgICAgICAgdGhpcy5ieXBhc3NBdXRoU3RhdGUgPSBieXBhc3NBdXRoU3RhdGU7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nUHJvbWlzZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gZmlsdGVyIDogW2ZpbHRlcl07XHJcbiAgICB9XHJcbiAgICBleGVjdXRlKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UgPSB7IHJlc29sdmUsIHJlamVjdCB9O1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSBhd2FpdCB0aGlzLnJlc29sdmVyLl9pbml0aWFsaXplKHRoaXMuYXV0aCk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uRXhlY3V0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50TWFuYWdlci5yZWdpc3RlckNvbnN1bWVyKHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlamVjdChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgb25BdXRoRXZlbnQoZXZlbnQpIHtcclxuICAgICAgICBjb25zdCB7IHVybFJlc3BvbnNlLCBzZXNzaW9uSWQsIHBvc3RCb2R5LCB0ZW5hbnRJZCwgZXJyb3IsIHR5cGUgfSA9IGV2ZW50O1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICB0aGlzLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICAgICAgICBhdXRoOiB0aGlzLmF1dGgsXHJcbiAgICAgICAgICAgIHJlcXVlc3RVcmk6IHVybFJlc3BvbnNlLFxyXG4gICAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb25JZCxcclxuICAgICAgICAgICAgdGVuYW50SWQ6IHRlbmFudElkIHx8IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgcG9zdEJvZHk6IHBvc3RCb2R5IHx8IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgdXNlcjogdGhpcy51c2VyLFxyXG4gICAgICAgICAgICBieXBhc3NBdXRoU3RhdGU6IHRoaXMuYnlwYXNzQXV0aFN0YXRlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRJZHBUYXNrKHR5cGUpKHBhcmFtcykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlamVjdChlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvbkVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgdGhpcy5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG4gICAgZ2V0SWRwVGFzayh0eXBlKSB7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJzaWduSW5WaWFQb3B1cFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUE9QVVAgKi86XHJcbiAgICAgICAgICAgIGNhc2UgXCJzaWduSW5WaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi86XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3NpZ25JbjtcclxuICAgICAgICAgICAgY2FzZSBcImxpbmtWaWFQb3B1cFwiIC8qIEF1dGhFdmVudFR5cGUuTElOS19WSUFfUE9QVVAgKi86XHJcbiAgICAgICAgICAgIGNhc2UgXCJsaW5rVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLkxJTktfVklBX1JFRElSRUNUICovOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9saW5rO1xyXG4gICAgICAgICAgICBjYXNlIFwicmVhdXRoVmlhUG9wdXBcIiAvKiBBdXRoRXZlbnRUeXBlLlJFQVVUSF9WSUFfUE9QVVAgKi86XHJcbiAgICAgICAgICAgIGNhc2UgXCJyZWF1dGhWaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuUkVBVVRIX1ZJQV9SRURJUkVDVCAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBfcmVhdXRoO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgX2ZhaWwodGhpcy5hdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVzb2x2ZShjcmVkKSB7XHJcbiAgICAgICAgZGVidWdBc3NlcnQodGhpcy5wZW5kaW5nUHJvbWlzZSwgJ1BlbmRpbmcgcHJvbWlzZSB3YXMgbmV2ZXIgc2V0Jyk7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nUHJvbWlzZS5yZXNvbHZlKGNyZWQpO1xyXG4gICAgICAgIHRoaXMudW5yZWdpc3RlckFuZENsZWFuVXAoKTtcclxuICAgIH1cclxuICAgIHJlamVjdChlcnJvcikge1xyXG4gICAgICAgIGRlYnVnQXNzZXJ0KHRoaXMucGVuZGluZ1Byb21pc2UsICdQZW5kaW5nIHByb21pc2Ugd2FzIG5ldmVyIHNldCcpO1xyXG4gICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB0aGlzLnVucmVnaXN0ZXJBbmRDbGVhblVwKCk7XHJcbiAgICB9XHJcbiAgICB1bnJlZ2lzdGVyQW5kQ2xlYW5VcCgpIHtcclxuICAgICAgICBpZiAodGhpcy5ldmVudE1hbmFnZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIudW5yZWdpc3RlckNvbnN1bWVyKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBlbmRpbmdQcm9taXNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNsZWFuVXAoKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBfUE9MTF9XSU5ET1dfQ0xPU0VfVElNRU9VVCA9IG5ldyBEZWxheSgyMDAwLCAxMDAwMCk7XHJcbi8qKlxyXG4gKiBBdXRoZW50aWNhdGVzIGEgRmlyZWJhc2UgY2xpZW50IHVzaW5nIGEgcG9wdXAtYmFzZWQgT0F1dGggYXV0aGVudGljYXRpb24gZmxvdy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSWYgc3VjY2VlZHMsIHJldHVybnMgdGhlIHNpZ25lZCBpbiB1c2VyIGFsb25nIHdpdGggdGhlIHByb3ZpZGVyJ3MgY3JlZGVudGlhbC4gSWYgc2lnbiBpbiB3YXNcclxuICogdW5zdWNjZXNzZnVsLCByZXR1cm5zIGFuIGVycm9yIG9iamVjdCBjb250YWluaW5nIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGVycm9yLlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudCBvciB3aXRoIHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGFcclxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSBwb3B1cC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTtcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBvcHVwKGF1dGgsIHByb3ZpZGVyKTtcclxuICpcclxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXHJcbiAqIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogLy8gVGhpcyBnaXZlcyB5b3UgYSBGYWNlYm9vayBBY2Nlc3MgVG9rZW4uXHJcbiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBwcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChhdXRoLCByZXN1bHQpO1xyXG4gKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBwcm92aWRlciAtIFRoZSBwcm92aWRlciB0byBhdXRoZW50aWNhdGUuIFRoZSBwcm92aWRlciBoYXMgdG8gYmUgYW4ge0BsaW5rIE9BdXRoUHJvdmlkZXJ9LlxyXG4gKiBOb24tT0F1dGggcHJvdmlkZXJzIGxpa2Uge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSB3aWxsIHRocm93IGFuIGVycm9yLlxyXG4gKiBAcGFyYW0gcmVzb2x2ZXIgLSBBbiBpbnN0YW5jZSBvZiB7QGxpbmsgUG9wdXBSZWRpcmVjdFJlc29sdmVyfSwgb3B0aW9uYWxcclxuICogaWYgYWxyZWFkeSBzdXBwbGllZCB0byB7QGxpbmsgaW5pdGlhbGl6ZUF1dGh9IG9yIHByb3ZpZGVkIGJ5IHtAbGluayBnZXRBdXRofS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aFBvcHVwKGF1dGgsIHByb3ZpZGVyLCByZXNvbHZlcikge1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKGF1dGguYXBwKSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChfY3JlYXRlRXJyb3IoYXV0aCwgXCJvcGVyYXRpb24tbm90LXN1cHBvcnRlZC1pbi10aGlzLWVudmlyb25tZW50XCIgLyogQXV0aEVycm9yQ29kZS5PUEVSQVRJT05fTk9UX1NVUFBPUlRFRCAqLykpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xyXG4gICAgX2Fzc2VydEluc3RhbmNlT2YoYXV0aCwgcHJvdmlkZXIsIEZlZGVyYXRlZEF1dGhQcm92aWRlcik7XHJcbiAgICBjb25zdCByZXNvbHZlckludGVybmFsID0gX3dpdGhEZWZhdWx0UmVzb2x2ZXIoYXV0aEludGVybmFsLCByZXNvbHZlcik7XHJcbiAgICBjb25zdCBhY3Rpb24gPSBuZXcgUG9wdXBPcGVyYXRpb24oYXV0aEludGVybmFsLCBcInNpZ25JblZpYVBvcHVwXCIgLyogQXV0aEV2ZW50VHlwZS5TSUdOX0lOX1ZJQV9QT1BVUCAqLywgcHJvdmlkZXIsIHJlc29sdmVySW50ZXJuYWwpO1xyXG4gICAgcmV0dXJuIGFjdGlvbi5leGVjdXRlTm90TnVsbCgpO1xyXG59XHJcbi8qKlxyXG4gKiBSZWF1dGhlbnRpY2F0ZXMgdGhlIGN1cnJlbnQgdXNlciB3aXRoIHRoZSBzcGVjaWZpZWQge0BsaW5rIE9BdXRoUHJvdmlkZXJ9IHVzaW5nIGEgcG9wLXVwIGJhc2VkXHJcbiAqIE9BdXRoIGZsb3cuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIElmIHRoZSByZWF1dGhlbnRpY2F0aW9uIGlzIHN1Y2Nlc3NmdWwsIHRoZSByZXR1cm5lZCByZXN1bHQgd2lsbCBjb250YWluIHRoZSB1c2VyIGFuZCB0aGVcclxuICogcHJvdmlkZXIncyBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudCBvciBvbiBhbnkge0BsaW5rIFVzZXJ9IHNpZ25lZCBpbiBieVxyXG4gKiB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XHJcbiAqIC8vIFJlYXV0aGVudGljYXRlIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGF3YWl0IHJlYXV0aGVudGljYXRlV2l0aFBvcHVwKHJlc3VsdC51c2VyLCBwcm92aWRlcik7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgLSBUaGUgcHJvdmlkZXIgdG8gYXV0aGVudGljYXRlLiBUaGUgcHJvdmlkZXIgaGFzIHRvIGJlIGFuIHtAbGluayBPQXV0aFByb3ZpZGVyfS5cclxuICogTm9uLU9BdXRoIHByb3ZpZGVycyBsaWtlIHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gd2lsbCB0aHJvdyBhbiBlcnJvci5cclxuICogQHBhcmFtIHJlc29sdmVyIC0gQW4gaW5zdGFuY2Ugb2Yge0BsaW5rIFBvcHVwUmVkaXJlY3RSZXNvbHZlcn0sIG9wdGlvbmFsXHJcbiAqIGlmIGFscmVhZHkgc3VwcGxpZWQgdG8ge0BsaW5rIGluaXRpYWxpemVBdXRofSBvciBwcm92aWRlZCBieSB7QGxpbmsgZ2V0QXV0aH0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlYXV0aGVudGljYXRlV2l0aFBvcHVwKHVzZXIsIHByb3ZpZGVyLCByZXNvbHZlcikge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKHVzZXJJbnRlcm5hbC5hdXRoLmFwcCkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX2NyZWF0ZUVycm9yKHVzZXJJbnRlcm5hbC5hdXRoLCBcIm9wZXJhdGlvbi1ub3Qtc3VwcG9ydGVkLWluLXRoaXMtZW52aXJvbm1lbnRcIiAvKiBBdXRoRXJyb3JDb2RlLk9QRVJBVElPTl9OT1RfU1VQUE9SVEVEICovKSk7XHJcbiAgICB9XHJcbiAgICBfYXNzZXJ0SW5zdGFuY2VPZih1c2VySW50ZXJuYWwuYXV0aCwgcHJvdmlkZXIsIEZlZGVyYXRlZEF1dGhQcm92aWRlcik7XHJcbiAgICBjb25zdCByZXNvbHZlckludGVybmFsID0gX3dpdGhEZWZhdWx0UmVzb2x2ZXIodXNlckludGVybmFsLmF1dGgsIHJlc29sdmVyKTtcclxuICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBQb3B1cE9wZXJhdGlvbih1c2VySW50ZXJuYWwuYXV0aCwgXCJyZWF1dGhWaWFQb3B1cFwiIC8qIEF1dGhFdmVudFR5cGUuUkVBVVRIX1ZJQV9QT1BVUCAqLywgcHJvdmlkZXIsIHJlc29sdmVySW50ZXJuYWwsIHVzZXJJbnRlcm5hbCk7XHJcbiAgICByZXR1cm4gYWN0aW9uLmV4ZWN1dGVOb3ROdWxsKCk7XHJcbn1cclxuLyoqXHJcbiAqIExpbmtzIHRoZSBhdXRoZW50aWNhdGVkIHByb3ZpZGVyIHRvIHRoZSB1c2VyIGFjY291bnQgdXNpbmcgYSBwb3AtdXAgYmFzZWQgT0F1dGggZmxvdy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSWYgdGhlIGxpbmtpbmcgaXMgc3VjY2Vzc2Z1bCwgdGhlIHJldHVybmVkIHJlc3VsdCB3aWxsIGNvbnRhaW4gdGhlIHVzZXIgYW5kIHRoZSBwcm92aWRlcidzIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHdvcmsgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgc29tZSBvdGhlciBwcm92aWRlci5cclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKTtcclxuICogLy8gTGluayB1c2luZyBhIHBvcHVwLlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpO1xyXG4gKiBhd2FpdCBsaW5rV2l0aFBvcHVwKHJlc3VsdC51c2VyLCBwcm92aWRlcik7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgLSBUaGUgcHJvdmlkZXIgdG8gYXV0aGVudGljYXRlLiBUaGUgcHJvdmlkZXIgaGFzIHRvIGJlIGFuIHtAbGluayBPQXV0aFByb3ZpZGVyfS5cclxuICogTm9uLU9BdXRoIHByb3ZpZGVycyBsaWtlIHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gd2lsbCB0aHJvdyBhbiBlcnJvci5cclxuICogQHBhcmFtIHJlc29sdmVyIC0gQW4gaW5zdGFuY2Ugb2Yge0BsaW5rIFBvcHVwUmVkaXJlY3RSZXNvbHZlcn0sIG9wdGlvbmFsXHJcbiAqIGlmIGFscmVhZHkgc3VwcGxpZWQgdG8ge0BsaW5rIGluaXRpYWxpemVBdXRofSBvciBwcm92aWRlZCBieSB7QGxpbmsgZ2V0QXV0aH0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGxpbmtXaXRoUG9wdXAodXNlciwgcHJvdmlkZXIsIHJlc29sdmVyKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBfYXNzZXJ0SW5zdGFuY2VPZih1c2VySW50ZXJuYWwuYXV0aCwgcHJvdmlkZXIsIEZlZGVyYXRlZEF1dGhQcm92aWRlcik7XHJcbiAgICBjb25zdCByZXNvbHZlckludGVybmFsID0gX3dpdGhEZWZhdWx0UmVzb2x2ZXIodXNlckludGVybmFsLmF1dGgsIHJlc29sdmVyKTtcclxuICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBQb3B1cE9wZXJhdGlvbih1c2VySW50ZXJuYWwuYXV0aCwgXCJsaW5rVmlhUG9wdXBcIiAvKiBBdXRoRXZlbnRUeXBlLkxJTktfVklBX1BPUFVQICovLCBwcm92aWRlciwgcmVzb2x2ZXJJbnRlcm5hbCwgdXNlckludGVybmFsKTtcclxuICAgIHJldHVybiBhY3Rpb24uZXhlY3V0ZU5vdE51bGwoKTtcclxufVxyXG4vKipcclxuICogUG9wdXAgZXZlbnQgbWFuYWdlci4gSGFuZGxlcyB0aGUgcG9wdXAncyBlbnRpcmUgbGlmZWN5Y2xlOyBsaXN0ZW5zIHRvIGF1dGhcclxuICogZXZlbnRzXHJcbiAqXHJcbiAqL1xyXG5jbGFzcyBQb3B1cE9wZXJhdGlvbiBleHRlbmRzIEFic3RyYWN0UG9wdXBSZWRpcmVjdE9wZXJhdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoLCBmaWx0ZXIsIHByb3ZpZGVyLCByZXNvbHZlciwgdXNlcikge1xyXG4gICAgICAgIHN1cGVyKGF1dGgsIGZpbHRlciwgcmVzb2x2ZXIsIHVzZXIpO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXIgPSBwcm92aWRlcjtcclxuICAgICAgICB0aGlzLmF1dGhXaW5kb3cgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucG9sbElkID0gbnVsbDtcclxuICAgICAgICBpZiAoUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uKSB7XHJcbiAgICAgICAgICAgIFBvcHVwT3BlcmF0aW9uLmN1cnJlbnRQb3B1cEFjdGlvbi5jYW5jZWwoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gdGhpcztcclxuICAgIH1cclxuICAgIGFzeW5jIGV4ZWN1dGVOb3ROdWxsKCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZSgpO1xyXG4gICAgICAgIF9hc3NlcnQocmVzdWx0LCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgYXN5bmMgb25FeGVjdXRpb24oKSB7XHJcbiAgICAgICAgZGVidWdBc3NlcnQodGhpcy5maWx0ZXIubGVuZ3RoID09PSAxLCAnUG9wdXAgb3BlcmF0aW9ucyBvbmx5IGhhbmRsZSBvbmUgZXZlbnQnKTtcclxuICAgICAgICBjb25zdCBldmVudElkID0gX2dlbmVyYXRlRXZlbnRJZCgpO1xyXG4gICAgICAgIHRoaXMuYXV0aFdpbmRvdyA9IGF3YWl0IHRoaXMucmVzb2x2ZXIuX29wZW5Qb3B1cCh0aGlzLmF1dGgsIHRoaXMucHJvdmlkZXIsIHRoaXMuZmlsdGVyWzBdLCAvLyBUaGVyZSdzIGFsd2F5cyBvbmUsIHNlZSBjb25zdHJ1Y3RvclxyXG4gICAgICAgIGV2ZW50SWQpO1xyXG4gICAgICAgIHRoaXMuYXV0aFdpbmRvdy5hc3NvY2lhdGVkRXZlbnQgPSBldmVudElkO1xyXG4gICAgICAgIC8vIENoZWNrIGZvciB3ZWIgc3RvcmFnZSBzdXBwb3J0IGFuZCBvcmlnaW4gdmFsaWRhdGlvbiBfYWZ0ZXJfIHRoZSBwb3B1cCBpc1xyXG4gICAgICAgIC8vIGxvYWRlZC4gVGhlc2Ugb3BlcmF0aW9ucyBhcmUgc2xvdyAofjEgc2Vjb25kIG9yIHNvKSBSYXRoZXIgdGhhblxyXG4gICAgICAgIC8vIHdhaXRpbmcgb24gdGhlbSBiZWZvcmUgb3BlbmluZyB0aGUgd2luZG93LCBvcHRpbWlzdGljYWxseSBvcGVuIHRoZSBwb3B1cFxyXG4gICAgICAgIC8vIGFuZCBjaGVjayBmb3Igc3RvcmFnZSBzdXBwb3J0IGF0IHRoZSBzYW1lIHRpbWUuIElmIHN0b3JhZ2Ugc3VwcG9ydCBpc1xyXG4gICAgICAgIC8vIG5vdCBhdmFpbGFibGUsIHRoaXMgd2lsbCBjYXVzZSB0aGUgd2hvbGUgdGhpbmcgdG8gcmVqZWN0IHByb3Blcmx5LiBJdFxyXG4gICAgICAgIC8vIHdpbGwgYWxzbyBjbG9zZSB0aGUgcG9wdXAsIGJ1dCBzaW5jZSB0aGUgcHJvbWlzZSBoYXMgYWxyZWFkeSByZWplY3RlZCxcclxuICAgICAgICAvLyB0aGUgcG9wdXAgY2xvc2VkIGJ5IHVzZXIgcG9sbCB3aWxsIHJlamVjdCBpbnRvIHRoZSB2b2lkLlxyXG4gICAgICAgIHRoaXMucmVzb2x2ZXIuX29yaWdpblZhbGlkYXRpb24odGhpcy5hdXRoKS5jYXRjaChlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZWplY3QoZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlci5faXNJZnJhbWVXZWJTdG9yYWdlU3VwcG9ydGVkKHRoaXMuYXV0aCwgaXNTdXBwb3J0ZWQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWlzU3VwcG9ydGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlamVjdChfY3JlYXRlRXJyb3IodGhpcy5hdXRoLCBcIndlYi1zdG9yYWdlLXVuc3VwcG9ydGVkXCIgLyogQXV0aEVycm9yQ29kZS5XRUJfU1RPUkFHRV9VTlNVUFBPUlRFRCAqLykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gSGFuZGxlIHVzZXIgY2xvc3VyZS4gTm90aWNlIHRoaXMgZG9lcyAqbm90KiB1c2UgYXdhaXRcclxuICAgICAgICB0aGlzLnBvbGxVc2VyQ2FuY2VsbGF0aW9uKCk7XHJcbiAgICB9XHJcbiAgICBnZXQgZXZlbnRJZCgpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmF1dGhXaW5kb3cpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hc3NvY2lhdGVkRXZlbnQpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBjYW5jZWwoKSB7XHJcbiAgICAgICAgdGhpcy5yZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgXCJjYW5jZWxsZWQtcG9wdXAtcmVxdWVzdFwiIC8qIEF1dGhFcnJvckNvZGUuRVhQSVJFRF9QT1BVUF9SRVFVRVNUICovKSk7XHJcbiAgICB9XHJcbiAgICBjbGVhblVwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmF1dGhXaW5kb3cpIHtcclxuICAgICAgICAgICAgdGhpcy5hdXRoV2luZG93LmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnBvbGxJZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMucG9sbElkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hdXRoV2luZG93ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnBvbGxJZCA9IG51bGw7XHJcbiAgICAgICAgUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gbnVsbDtcclxuICAgIH1cclxuICAgIHBvbGxVc2VyQ2FuY2VsbGF0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHBvbGwgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XHJcbiAgICAgICAgICAgIGlmICgoX2IgPSAoX2EgPSB0aGlzLmF1dGhXaW5kb3cpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS53aW5kb3cpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbG9zZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZXJlIGlzIHN1ZmZpY2llbnQgdGltZSBmb3Igd2hhdGV2ZXIgYWN0aW9uIHRvXHJcbiAgICAgICAgICAgICAgICAvLyBjb21wbGV0ZS4gVGhlIHdpbmRvdyBjb3VsZCBoYXZlIGNsb3NlZCBidXQgdGhlIHNpZ24gaW4gbmV0d29ya1xyXG4gICAgICAgICAgICAgICAgLy8gY2FsbCBjb3VsZCBzdGlsbCBiZSBpbiBmbGlnaHQuIFRoaXMgaXMgc3BlY2lmaWNhbGx5IHRydWUgZm9yXHJcbiAgICAgICAgICAgICAgICAvLyBGaXJlZm94IG9yIGlmIHRoZSBvcGVuZXIgaXMgaW4gYW4gaWZyYW1lLCBpbiB3aGljaCBjYXNlIHRoZSBvYXV0aFxyXG4gICAgICAgICAgICAgICAgLy8gaGVscGVyIGNsb3NlcyB0aGUgcG9wdXAuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvbGxJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvbGxJZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgXCJwb3B1cC1jbG9zZWQtYnktdXNlclwiIC8qIEF1dGhFcnJvckNvZGUuUE9QVVBfQ0xPU0VEX0JZX1VTRVIgKi8pKTtcclxuICAgICAgICAgICAgICAgIH0sIDgwMDAgLyogX1RpbWVvdXQuQVVUSF9FVkVOVCAqLyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wb2xsSWQgPSB3aW5kb3cuc2V0VGltZW91dChwb2xsLCBfUE9MTF9XSU5ET1dfQ0xPU0VfVElNRU9VVC5nZXQoKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBwb2xsKCk7XHJcbiAgICB9XHJcbn1cclxuLy8gT25seSBvbmUgcG9wdXAgaXMgZXZlciBzaG93biBhdCBvbmNlLiBUaGUgbGlmZWN5Y2xlIG9mIHRoZSBjdXJyZW50IHBvcHVwXHJcbi8vIGNhbiBiZSBtYW5hZ2VkIC8gY2FuY2VsbGVkIGJ5IHRoZSBjb25zdHJ1Y3Rvci5cclxuUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gbnVsbDtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgUEVORElOR19SRURJUkVDVF9LRVkgPSAncGVuZGluZ1JlZGlyZWN0JztcclxuLy8gV2Ugb25seSBnZXQgb25lIHJlZGlyZWN0IG91dGNvbWUgZm9yIGFueSBvbmUgYXV0aCwgc28ganVzdCBzdG9yZSBpdFxyXG4vLyBpbiBoZXJlLlxyXG5jb25zdCByZWRpcmVjdE91dGNvbWVNYXAgPSBuZXcgTWFwKCk7XHJcbmNsYXNzIFJlZGlyZWN0QWN0aW9uIGV4dGVuZHMgQWJzdHJhY3RQb3B1cFJlZGlyZWN0T3BlcmF0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKGF1dGgsIHJlc29sdmVyLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkge1xyXG4gICAgICAgIHN1cGVyKGF1dGgsIFtcclxuICAgICAgICAgICAgXCJzaWduSW5WaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi8sXHJcbiAgICAgICAgICAgIFwibGlua1ZpYVJlZGlyZWN0XCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9SRURJUkVDVCAqLyxcclxuICAgICAgICAgICAgXCJyZWF1dGhWaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuUkVBVVRIX1ZJQV9SRURJUkVDVCAqLyxcclxuICAgICAgICAgICAgXCJ1bmtub3duXCIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovXHJcbiAgICAgICAgXSwgcmVzb2x2ZXIsIHVuZGVmaW5lZCwgYnlwYXNzQXV0aFN0YXRlKTtcclxuICAgICAgICB0aGlzLmV2ZW50SWQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBPdmVycmlkZSB0aGUgZXhlY3V0ZSBmdW5jdGlvbjsgaWYgd2UgYWxyZWFkeSBoYXZlIGEgcmVkaXJlY3QgcmVzdWx0LCB0aGVuXHJcbiAgICAgKiBqdXN0IHJldHVybiBpdC5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgZXhlY3V0ZSgpIHtcclxuICAgICAgICBsZXQgcmVhZHlPdXRjb21lID0gcmVkaXJlY3RPdXRjb21lTWFwLmdldCh0aGlzLmF1dGguX2tleSgpKTtcclxuICAgICAgICBpZiAoIXJlYWR5T3V0Y29tZSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzUGVuZGluZ1JlZGlyZWN0ID0gYXdhaXQgX2dldEFuZENsZWFyUGVuZGluZ1JlZGlyZWN0U3RhdHVzKHRoaXMucmVzb2x2ZXIsIHRoaXMuYXV0aCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBoYXNQZW5kaW5nUmVkaXJlY3QgPyBhd2FpdCBzdXBlci5leGVjdXRlKCkgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgcmVhZHlPdXRjb21lID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHJlYWR5T3V0Y29tZSA9ICgpID0+IFByb21pc2UucmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQodGhpcy5hdXRoLl9rZXkoKSwgcmVhZHlPdXRjb21lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgd2UncmUgbm90IGJ5cGFzc2luZyBhdXRoIHN0YXRlLCB0aGUgcmVhZHkgb3V0Y29tZSBzaG91bGQgYmUgc2V0IHRvXHJcbiAgICAgICAgLy8gbnVsbC5cclxuICAgICAgICBpZiAoIXRoaXMuYnlwYXNzQXV0aFN0YXRlKSB7XHJcbiAgICAgICAgICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQodGhpcy5hdXRoLl9rZXkoKSwgKCkgPT4gUHJvbWlzZS5yZXNvbHZlKG51bGwpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlYWR5T3V0Y29tZSgpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgb25BdXRoRXZlbnQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJzaWduSW5WaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi8pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm9uQXV0aEV2ZW50KGV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJ1bmtub3duXCIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovKSB7XHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBzZW50aW5lbCB2YWx1ZSBpbmRpY2F0aW5nIHRoZXJlJ3Mgbm8gcGVuZGluZyByZWRpcmVjdFxyXG4gICAgICAgICAgICB0aGlzLnJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV2ZW50LmV2ZW50SWQpIHtcclxuICAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuYXV0aC5fcmVkaXJlY3RVc2VyRm9ySWQoZXZlbnQuZXZlbnRJZCk7XHJcbiAgICAgICAgICAgIGlmICh1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm9uQXV0aEV2ZW50KGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIG9uRXhlY3V0aW9uKCkgeyB9XHJcbiAgICBjbGVhblVwKCkgeyB9XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX2dldEFuZENsZWFyUGVuZGluZ1JlZGlyZWN0U3RhdHVzKHJlc29sdmVyLCBhdXRoKSB7XHJcbiAgICBjb25zdCBrZXkgPSBwZW5kaW5nUmVkaXJlY3RLZXkoYXV0aCk7XHJcbiAgICBjb25zdCBwZXJzaXN0ZW5jZSA9IHJlc29sdmVyUGVyc2lzdGVuY2UocmVzb2x2ZXIpO1xyXG4gICAgaWYgKCEoYXdhaXQgcGVyc2lzdGVuY2UuX2lzQXZhaWxhYmxlKCkpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaGFzUGVuZGluZ1JlZGlyZWN0ID0gKGF3YWl0IHBlcnNpc3RlbmNlLl9nZXQoa2V5KSkgPT09ICd0cnVlJztcclxuICAgIGF3YWl0IHBlcnNpc3RlbmNlLl9yZW1vdmUoa2V5KTtcclxuICAgIHJldHVybiBoYXNQZW5kaW5nUmVkaXJlY3Q7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX3NldFBlbmRpbmdSZWRpcmVjdFN0YXR1cyhyZXNvbHZlciwgYXV0aCkge1xyXG4gICAgcmV0dXJuIHJlc29sdmVyUGVyc2lzdGVuY2UocmVzb2x2ZXIpLl9zZXQocGVuZGluZ1JlZGlyZWN0S2V5KGF1dGgpLCAndHJ1ZScpO1xyXG59XHJcbmZ1bmN0aW9uIF9jbGVhclJlZGlyZWN0T3V0Y29tZXMoKSB7XHJcbiAgICByZWRpcmVjdE91dGNvbWVNYXAuY2xlYXIoKTtcclxufVxyXG5mdW5jdGlvbiBfb3ZlcnJpZGVSZWRpcmVjdFJlc3VsdChhdXRoLCByZXN1bHQpIHtcclxuICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQoYXV0aC5fa2V5KCksIHJlc3VsdCk7XHJcbn1cclxuZnVuY3Rpb24gcmVzb2x2ZXJQZXJzaXN0ZW5jZShyZXNvbHZlcikge1xyXG4gICAgcmV0dXJuIF9nZXRJbnN0YW5jZShyZXNvbHZlci5fcmVkaXJlY3RQZXJzaXN0ZW5jZSk7XHJcbn1cclxuZnVuY3Rpb24gcGVuZGluZ1JlZGlyZWN0S2V5KGF1dGgpIHtcclxuICAgIHJldHVybiBfcGVyc2lzdGVuY2VLZXlOYW1lKFBFTkRJTkdfUkVESVJFQ1RfS0VZLCBhdXRoLmNvbmZpZy5hcGlLZXksIGF1dGgubmFtZSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEF1dGhlbnRpY2F0ZXMgYSBGaXJlYmFzZSBjbGllbnQgdXNpbmcgYSBmdWxsLXBhZ2UgcmVkaXJlY3QgZmxvdy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVG8gaGFuZGxlIHRoZSByZXN1bHRzIGFuZCBlcnJvcnMgZm9yIHRoaXMgb3BlcmF0aW9uLCByZWZlciB0byB7QGxpbmsgZ2V0UmVkaXJlY3RSZXN1bHR9LlxyXG4gKiBGb2xsb3cgdGhlIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9hdXRoL3dlYi9yZWRpcmVjdC1iZXN0LXByYWN0aWNlc1xyXG4gKiB8IGJlc3QgcHJhY3RpY2VzfSB3aGVuIHVzaW5nIHtAbGluayBzaWduSW5XaXRoUmVkaXJlY3R9LlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudCBvciB3aXRoIHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGFcclxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTtcclxuICogLy8gWW91IGNhbiBhZGQgYWRkaXRpb25hbCBzY29wZXMgdG8gdGhlIHByb3ZpZGVyOlxyXG4gKiBwcm92aWRlci5hZGRTY29wZSgndXNlcl9iaXJ0aGRheScpO1xyXG4gKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuXHJcbiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7XHJcbiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcFxyXG4gKlxyXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpO1xyXG4gKiBpZiAocmVzdWx0KSB7XHJcbiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXJcclxuICogICBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBGYWNlYm9vayBBY2Nlc3MgVG9rZW4uXHJcbiAqICAgY29uc3QgY3JlZGVudGlhbCA9IHByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KGF1dGgsIHJlc3VsdCk7XHJcbiAqICAgY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xyXG4gKiB9XHJcbiAqIC8vIEFzIHRoaXMgQVBJIGNhbiBiZSB1c2VkIGZvciBzaWduLWluLCBsaW5raW5nIGFuZCByZWF1dGhlbnRpY2F0aW9uLFxyXG4gKiAvLyBjaGVjayB0aGUgb3BlcmF0aW9uVHlwZSB0byBkZXRlcm1pbmUgd2hhdCB0cmlnZ2VyZWQgdGhpcyByZWRpcmVjdFxyXG4gKiAvLyBvcGVyYXRpb24uXHJcbiAqIGNvbnN0IG9wZXJhdGlvblR5cGUgPSByZXN1bHQub3BlcmF0aW9uVHlwZTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIHByb3ZpZGVyIC0gVGhlIHByb3ZpZGVyIHRvIGF1dGhlbnRpY2F0ZS4gVGhlIHByb3ZpZGVyIGhhcyB0byBiZSBhbiB7QGxpbmsgT0F1dGhQcm92aWRlcn0uXHJcbiAqIE5vbi1PQXV0aCBwcm92aWRlcnMgbGlrZSB7QGxpbmsgRW1haWxBdXRoUHJvdmlkZXJ9IHdpbGwgdGhyb3cgYW4gZXJyb3IuXHJcbiAqIEBwYXJhbSByZXNvbHZlciAtIEFuIGluc3RhbmNlIG9mIHtAbGluayBQb3B1cFJlZGlyZWN0UmVzb2x2ZXJ9LCBvcHRpb25hbFxyXG4gKiBpZiBhbHJlYWR5IHN1cHBsaWVkIHRvIHtAbGluayBpbml0aWFsaXplQXV0aH0gb3IgcHJvdmlkZWQgYnkge0BsaW5rIGdldEF1dGh9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIsIHJlc29sdmVyKSB7XHJcbiAgICByZXR1cm4gX3NpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlciwgcmVzb2x2ZXIpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9zaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIsIHJlc29sdmVyKSB7XHJcbiAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAoYXV0aC5hcHApKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIF9hc3NlcnRJbnN0YW5jZU9mKGF1dGgsIHByb3ZpZGVyLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIpO1xyXG4gICAgLy8gV2FpdCBmb3IgYXV0aCBpbml0aWFsaXphdGlvbiB0byBjb21wbGV0ZSwgdGhpcyB3aWxsIHByb2Nlc3MgcGVuZGluZyByZWRpcmVjdHMgYW5kIGNsZWFyIHRoZVxyXG4gICAgLy8gUEVORElOR19SRURJUkVDVF9LRVkgaW4gcGVyc2lzdGVuY2UuIFRoaXMgc2hvdWxkIGJlIGNvbXBsZXRlZCBiZWZvcmUgc3RhcnRpbmcgYSBuZXdcclxuICAgIC8vIHJlZGlyZWN0IGFuZCBjcmVhdGluZyBhIFBFTkRJTkdfUkVESVJFQ1RfS0VZIGVudHJ5LlxyXG4gICAgYXdhaXQgYXV0aEludGVybmFsLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICBjb25zdCByZXNvbHZlckludGVybmFsID0gX3dpdGhEZWZhdWx0UmVzb2x2ZXIoYXV0aEludGVybmFsLCByZXNvbHZlcik7XHJcbiAgICBhd2FpdCBfc2V0UGVuZGluZ1JlZGlyZWN0U3RhdHVzKHJlc29sdmVySW50ZXJuYWwsIGF1dGhJbnRlcm5hbCk7XHJcbiAgICByZXR1cm4gcmVzb2x2ZXJJbnRlcm5hbC5fb3BlblJlZGlyZWN0KGF1dGhJbnRlcm5hbCwgcHJvdmlkZXIsIFwic2lnbkluVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1JFRElSRUNUICovKTtcclxufVxyXG4vKipcclxuICogUmVhdXRoZW50aWNhdGVzIHRoZSBjdXJyZW50IHVzZXIgd2l0aCB0aGUgc3BlY2lmaWVkIHtAbGluayBPQXV0aFByb3ZpZGVyfSB1c2luZyBhIGZ1bGwtcGFnZSByZWRpcmVjdCBmbG93LlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUbyBoYW5kbGUgdGhlIHJlc3VsdHMgYW5kIGVycm9ycyBmb3IgdGhpcyBvcGVyYXRpb24sIHJlZmVyIHRvIHtAbGluayBnZXRSZWRpcmVjdFJlc3VsdH0uXHJcbiAqIEZvbGxvdyB0aGUge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2F1dGgvd2ViL3JlZGlyZWN0LWJlc3QtcHJhY3RpY2VzXHJcbiAqIHwgYmVzdCBwcmFjdGljZXN9IHdoZW4gdXNpbmcge0BsaW5rIHJlYXV0aGVudGljYXRlV2l0aFJlZGlyZWN0fS5cclxuICpcclxuICogVGhpcyBtZXRob2QgZG9lcyBub3Qgd29yayBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQgb3Igd2l0aCB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzXHJcbiAqIGNyZWF0ZWQgd2l0aCBhIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7XHJcbiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcFxyXG4gKlxyXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpO1xyXG4gKiAvLyBSZWF1dGhlbnRpY2F0ZSB1c2luZyBhIHJlZGlyZWN0LlxyXG4gKiBhd2FpdCByZWF1dGhlbnRpY2F0ZVdpdGhSZWRpcmVjdChyZXN1bHQudXNlciwgcHJvdmlkZXIpO1xyXG4gKiAvLyBUaGlzIHdpbGwgYWdhaW4gdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcclxuICpcclxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwcm92aWRlciAtIFRoZSBwcm92aWRlciB0byBhdXRoZW50aWNhdGUuIFRoZSBwcm92aWRlciBoYXMgdG8gYmUgYW4ge0BsaW5rIE9BdXRoUHJvdmlkZXJ9LlxyXG4gKiBOb24tT0F1dGggcHJvdmlkZXJzIGxpa2Uge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSB3aWxsIHRocm93IGFuIGVycm9yLlxyXG4gKiBAcGFyYW0gcmVzb2x2ZXIgLSBBbiBpbnN0YW5jZSBvZiB7QGxpbmsgUG9wdXBSZWRpcmVjdFJlc29sdmVyfSwgb3B0aW9uYWxcclxuICogaWYgYWxyZWFkeSBzdXBwbGllZCB0byB7QGxpbmsgaW5pdGlhbGl6ZUF1dGh9IG9yIHByb3ZpZGVkIGJ5IHtAbGluayBnZXRBdXRofS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gcmVhdXRoZW50aWNhdGVXaXRoUmVkaXJlY3QodXNlciwgcHJvdmlkZXIsIHJlc29sdmVyKSB7XHJcbiAgICByZXR1cm4gX3JlYXV0aGVudGljYXRlV2l0aFJlZGlyZWN0KHVzZXIsIHByb3ZpZGVyLCByZXNvbHZlcik7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX3JlYXV0aGVudGljYXRlV2l0aFJlZGlyZWN0KHVzZXIsIHByb3ZpZGVyLCByZXNvbHZlcikge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgX2Fzc2VydEluc3RhbmNlT2YodXNlckludGVybmFsLmF1dGgsIHByb3ZpZGVyLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIpO1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKHVzZXJJbnRlcm5hbC5hdXRoLmFwcCkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IodXNlckludGVybmFsLmF1dGgpKTtcclxuICAgIH1cclxuICAgIC8vIFdhaXQgZm9yIGF1dGggaW5pdGlhbGl6YXRpb24gdG8gY29tcGxldGUsIHRoaXMgd2lsbCBwcm9jZXNzIHBlbmRpbmcgcmVkaXJlY3RzIGFuZCBjbGVhciB0aGVcclxuICAgIC8vIFBFTkRJTkdfUkVESVJFQ1RfS0VZIGluIHBlcnNpc3RlbmNlLiBUaGlzIHNob3VsZCBiZSBjb21wbGV0ZWQgYmVmb3JlIHN0YXJ0aW5nIGEgbmV3XHJcbiAgICAvLyByZWRpcmVjdCBhbmQgY3JlYXRpbmcgYSBQRU5ESU5HX1JFRElSRUNUX0tFWSBlbnRyeS5cclxuICAgIGF3YWl0IHVzZXJJbnRlcm5hbC5hdXRoLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICAvLyBBbGxvdyB0aGUgcmVzb2x2ZXIgdG8gZXJyb3IgYmVmb3JlIHBlcnNpc3RpbmcgdGhlIHJlZGlyZWN0IHVzZXJcclxuICAgIGNvbnN0IHJlc29sdmVySW50ZXJuYWwgPSBfd2l0aERlZmF1bHRSZXNvbHZlcih1c2VySW50ZXJuYWwuYXV0aCwgcmVzb2x2ZXIpO1xyXG4gICAgYXdhaXQgX3NldFBlbmRpbmdSZWRpcmVjdFN0YXR1cyhyZXNvbHZlckludGVybmFsLCB1c2VySW50ZXJuYWwuYXV0aCk7XHJcbiAgICBjb25zdCBldmVudElkID0gYXdhaXQgcHJlcGFyZVVzZXJGb3JSZWRpcmVjdCh1c2VySW50ZXJuYWwpO1xyXG4gICAgcmV0dXJuIHJlc29sdmVySW50ZXJuYWwuX29wZW5SZWRpcmVjdCh1c2VySW50ZXJuYWwuYXV0aCwgcHJvdmlkZXIsIFwicmVhdXRoVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLlJFQVVUSF9WSUFfUkVESVJFQ1QgKi8sIGV2ZW50SWQpO1xyXG59XHJcbi8qKlxyXG4gKiBMaW5rcyB0aGUge0BsaW5rIE9BdXRoUHJvdmlkZXJ9IHRvIHRoZSB1c2VyIGFjY291bnQgdXNpbmcgYSBmdWxsLXBhZ2UgcmVkaXJlY3QgZmxvdy5cclxuICogQHJlbWFya3NcclxuICogVG8gaGFuZGxlIHRoZSByZXN1bHRzIGFuZCBlcnJvcnMgZm9yIHRoaXMgb3BlcmF0aW9uLCByZWZlciB0byB7QGxpbmsgZ2V0UmVkaXJlY3RSZXN1bHR9LlxyXG4gKiBGb2xsb3cgdGhlIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9hdXRoL3dlYi9yZWRpcmVjdC1iZXN0LXByYWN0aWNlc1xyXG4gKiB8IGJlc3QgcHJhY3RpY2VzfSB3aGVuIHVzaW5nIHtAbGluayBsaW5rV2l0aFJlZGlyZWN0fS5cclxuICpcclxuICogVGhpcyBtZXRob2QgZG9lcyBub3Qgd29yayBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQgb3Igd2l0aCB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzXHJcbiAqIGNyZWF0ZWQgd2l0aCBhIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIHNvbWUgb3RoZXIgcHJvdmlkZXIuXHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCk7XHJcbiAqIC8vIExpbmsgdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTtcclxuICogYXdhaXQgbGlua1dpdGhSZWRpcmVjdChyZXN1bHQudXNlciwgcHJvdmlkZXIpO1xyXG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcclxuICpcclxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwcm92aWRlciAtIFRoZSBwcm92aWRlciB0byBhdXRoZW50aWNhdGUuIFRoZSBwcm92aWRlciBoYXMgdG8gYmUgYW4ge0BsaW5rIE9BdXRoUHJvdmlkZXJ9LlxyXG4gKiBOb24tT0F1dGggcHJvdmlkZXJzIGxpa2Uge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSB3aWxsIHRocm93IGFuIGVycm9yLlxyXG4gKiBAcGFyYW0gcmVzb2x2ZXIgLSBBbiBpbnN0YW5jZSBvZiB7QGxpbmsgUG9wdXBSZWRpcmVjdFJlc29sdmVyfSwgb3B0aW9uYWxcclxuICogaWYgYWxyZWFkeSBzdXBwbGllZCB0byB7QGxpbmsgaW5pdGlhbGl6ZUF1dGh9IG9yIHByb3ZpZGVkIGJ5IHtAbGluayBnZXRBdXRofS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gbGlua1dpdGhSZWRpcmVjdCh1c2VyLCBwcm92aWRlciwgcmVzb2x2ZXIpIHtcclxuICAgIHJldHVybiBfbGlua1dpdGhSZWRpcmVjdCh1c2VyLCBwcm92aWRlciwgcmVzb2x2ZXIpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9saW5rV2l0aFJlZGlyZWN0KHVzZXIsIHByb3ZpZGVyLCByZXNvbHZlcikge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgX2Fzc2VydEluc3RhbmNlT2YodXNlckludGVybmFsLmF1dGgsIHByb3ZpZGVyLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIpO1xyXG4gICAgLy8gV2FpdCBmb3IgYXV0aCBpbml0aWFsaXphdGlvbiB0byBjb21wbGV0ZSwgdGhpcyB3aWxsIHByb2Nlc3MgcGVuZGluZyByZWRpcmVjdHMgYW5kIGNsZWFyIHRoZVxyXG4gICAgLy8gUEVORElOR19SRURJUkVDVF9LRVkgaW4gcGVyc2lzdGVuY2UuIFRoaXMgc2hvdWxkIGJlIGNvbXBsZXRlZCBiZWZvcmUgc3RhcnRpbmcgYSBuZXdcclxuICAgIC8vIHJlZGlyZWN0IGFuZCBjcmVhdGluZyBhIFBFTkRJTkdfUkVESVJFQ1RfS0VZIGVudHJ5LlxyXG4gICAgYXdhaXQgdXNlckludGVybmFsLmF1dGguX2luaXRpYWxpemF0aW9uUHJvbWlzZTtcclxuICAgIC8vIEFsbG93IHRoZSByZXNvbHZlciB0byBlcnJvciBiZWZvcmUgcGVyc2lzdGluZyB0aGUgcmVkaXJlY3QgdXNlclxyXG4gICAgY29uc3QgcmVzb2x2ZXJJbnRlcm5hbCA9IF93aXRoRGVmYXVsdFJlc29sdmVyKHVzZXJJbnRlcm5hbC5hdXRoLCByZXNvbHZlcik7XHJcbiAgICBhd2FpdCBfYXNzZXJ0TGlua2VkU3RhdHVzKGZhbHNlLCB1c2VySW50ZXJuYWwsIHByb3ZpZGVyLnByb3ZpZGVySWQpO1xyXG4gICAgYXdhaXQgX3NldFBlbmRpbmdSZWRpcmVjdFN0YXR1cyhyZXNvbHZlckludGVybmFsLCB1c2VySW50ZXJuYWwuYXV0aCk7XHJcbiAgICBjb25zdCBldmVudElkID0gYXdhaXQgcHJlcGFyZVVzZXJGb3JSZWRpcmVjdCh1c2VySW50ZXJuYWwpO1xyXG4gICAgcmV0dXJuIHJlc29sdmVySW50ZXJuYWwuX29wZW5SZWRpcmVjdCh1c2VySW50ZXJuYWwuYXV0aCwgcHJvdmlkZXIsIFwibGlua1ZpYVJlZGlyZWN0XCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9SRURJUkVDVCAqLywgZXZlbnRJZCk7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9IGZyb20gdGhlIHJlZGlyZWN0LWJhc2VkIHNpZ24taW4gZmxvdy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSWYgc2lnbi1pbiBzdWNjZWVkZWQsIHJldHVybnMgdGhlIHNpZ25lZCBpbiB1c2VyLiBJZiBzaWduLWluIHdhcyB1bnN1Y2Nlc3NmdWwsIGZhaWxzIHdpdGggYW5cclxuICogZXJyb3IuIElmIG5vIHJlZGlyZWN0IG9wZXJhdGlvbiB3YXMgY2FsbGVkLCByZXR1cm5zIGBudWxsYC5cclxuICpcclxuICogVGhpcyBtZXRob2QgZG9lcyBub3Qgd29yayBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQgb3Igd2l0aCB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXHJcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIC8vIFlvdSBjYW4gYWRkIGFkZGl0aW9uYWwgc2NvcGVzIHRvIHRoZSBwcm92aWRlcjpcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3VzZXJfYmlydGhkYXknKTtcclxuICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLlxyXG4gKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpO1xyXG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcclxuICpcclxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcclxuICogaWYgKHJlc3VsdCkge1xyXG4gKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyXHJcbiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xyXG4gKiAgIC8vIFRoaXMgZ2l2ZXMgeW91IGEgRmFjZWJvb2sgQWNjZXNzIFRva2VuLlxyXG4gKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBwcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChhdXRoLCByZXN1bHQpO1xyXG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogfVxyXG4gKiAvLyBBcyB0aGlzIEFQSSBjYW4gYmUgdXNlZCBmb3Igc2lnbi1pbiwgbGlua2luZyBhbmQgcmVhdXRoZW50aWNhdGlvbixcclxuICogLy8gY2hlY2sgdGhlIG9wZXJhdGlvblR5cGUgdG8gZGV0ZXJtaW5lIHdoYXQgdHJpZ2dlcmVkIHRoaXMgcmVkaXJlY3RcclxuICogLy8gb3BlcmF0aW9uLlxyXG4gKiBjb25zdCBvcGVyYXRpb25UeXBlID0gcmVzdWx0Lm9wZXJhdGlvblR5cGU7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSByZXNvbHZlciAtIEFuIGluc3RhbmNlIG9mIHtAbGluayBQb3B1cFJlZGlyZWN0UmVzb2x2ZXJ9LCBvcHRpb25hbFxyXG4gKiBpZiBhbHJlYWR5IHN1cHBsaWVkIHRvIHtAbGluayBpbml0aWFsaXplQXV0aH0gb3IgcHJvdmlkZWQgYnkge0BsaW5rIGdldEF1dGh9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZXRSZWRpcmVjdFJlc3VsdChhdXRoLCByZXNvbHZlcikge1xyXG4gICAgYXdhaXQgX2Nhc3RBdXRoKGF1dGgpLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICByZXR1cm4gX2dldFJlZGlyZWN0UmVzdWx0KGF1dGgsIHJlc29sdmVyLCBmYWxzZSk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX2dldFJlZGlyZWN0UmVzdWx0KGF1dGgsIHJlc29sdmVyRXh0ZXJuLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkge1xyXG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKGF1dGguYXBwKSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvcihhdXRoKSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XHJcbiAgICBjb25zdCByZXNvbHZlciA9IF93aXRoRGVmYXVsdFJlc29sdmVyKGF1dGhJbnRlcm5hbCwgcmVzb2x2ZXJFeHRlcm4pO1xyXG4gICAgY29uc3QgYWN0aW9uID0gbmV3IFJlZGlyZWN0QWN0aW9uKGF1dGhJbnRlcm5hbCwgcmVzb2x2ZXIsIGJ5cGFzc0F1dGhTdGF0ZSk7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhY3Rpb24uZXhlY3V0ZSgpO1xyXG4gICAgaWYgKHJlc3VsdCAmJiAhYnlwYXNzQXV0aFN0YXRlKSB7XHJcbiAgICAgICAgZGVsZXRlIHJlc3VsdC51c2VyLl9yZWRpcmVjdEV2ZW50SWQ7XHJcbiAgICAgICAgYXdhaXQgYXV0aEludGVybmFsLl9wZXJzaXN0VXNlcklmQ3VycmVudChyZXN1bHQudXNlcik7XHJcbiAgICAgICAgYXdhaXQgYXV0aEludGVybmFsLl9zZXRSZWRpcmVjdFVzZXIobnVsbCwgcmVzb2x2ZXJFeHRlcm4pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBwcmVwYXJlVXNlckZvclJlZGlyZWN0KHVzZXIpIHtcclxuICAgIGNvbnN0IGV2ZW50SWQgPSBfZ2VuZXJhdGVFdmVudElkKGAke3VzZXIudWlkfTo6OmApO1xyXG4gICAgdXNlci5fcmVkaXJlY3RFdmVudElkID0gZXZlbnRJZDtcclxuICAgIGF3YWl0IHVzZXIuYXV0aC5fc2V0UmVkaXJlY3RVc2VyKHVzZXIpO1xyXG4gICAgYXdhaXQgdXNlci5hdXRoLl9wZXJzaXN0VXNlcklmQ3VycmVudCh1c2VyKTtcclxuICAgIHJldHVybiBldmVudElkO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8vIFRoZSBhbW91bnQgb2YgdGltZSB0byBzdG9yZSB0aGUgVUlEcyBvZiBzZWVuIGV2ZW50czsgdGhpcyBpc1xyXG4vLyBzZXQgdG8gMTAgbWluIGJ5IGRlZmF1bHRcclxuY29uc3QgRVZFTlRfRFVQTElDQVRJT05fQ0FDSEVfRFVSQVRJT05fTVMgPSAxMCAqIDYwICogMTAwMDtcclxuY2xhc3MgQXV0aEV2ZW50TWFuYWdlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLmNhY2hlZEV2ZW50VWlkcyA9IG5ldyBTZXQoKTtcclxuICAgICAgICB0aGlzLmNvbnN1bWVycyA9IG5ldyBTZXQoKTtcclxuICAgICAgICB0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaGFzSGFuZGxlZFBvdGVudGlhbFJlZGlyZWN0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sYXN0UHJvY2Vzc2VkRXZlbnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgIH1cclxuICAgIHJlZ2lzdGVyQ29uc3VtZXIoYXV0aEV2ZW50Q29uc3VtZXIpIHtcclxuICAgICAgICB0aGlzLmNvbnN1bWVycy5hZGQoYXV0aEV2ZW50Q29uc3VtZXIpO1xyXG4gICAgICAgIGlmICh0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgJiZcclxuICAgICAgICAgICAgdGhpcy5pc0V2ZW50Rm9yQ29uc3VtZXIodGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50LCBhdXRoRXZlbnRDb25zdW1lcikpIHtcclxuICAgICAgICAgICAgdGhpcy5zZW5kVG9Db25zdW1lcih0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQsIGF1dGhFdmVudENvbnN1bWVyKTtcclxuICAgICAgICAgICAgdGhpcy5zYXZlRXZlbnRUb0NhY2hlKHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCk7XHJcbiAgICAgICAgICAgIHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdW5yZWdpc3RlckNvbnN1bWVyKGF1dGhFdmVudENvbnN1bWVyKSB7XHJcbiAgICAgICAgdGhpcy5jb25zdW1lcnMuZGVsZXRlKGF1dGhFdmVudENvbnN1bWVyKTtcclxuICAgIH1cclxuICAgIG9uRXZlbnQoZXZlbnQpIHtcclxuICAgICAgICAvLyBDaGVjayBpZiB0aGUgZXZlbnQgaGFzIGFscmVhZHkgYmVlbiBoYW5kbGVkXHJcbiAgICAgICAgaWYgKHRoaXMuaGFzRXZlbnRCZWVuSGFuZGxlZChldmVudCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgaGFuZGxlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY29uc3VtZXJzLmZvckVhY2goY29uc3VtZXIgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0V2ZW50Rm9yQ29uc3VtZXIoZXZlbnQsIGNvbnN1bWVyKSkge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRUb0NvbnN1bWVyKGV2ZW50LCBjb25zdW1lcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVFdmVudFRvQ2FjaGUoZXZlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHRoaXMuaGFzSGFuZGxlZFBvdGVudGlhbFJlZGlyZWN0IHx8ICFpc1JlZGlyZWN0RXZlbnQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgc2VlbiBhIHJlZGlyZWN0IGJlZm9yZSwgb3IgdGhpcyBpcyBhIHBvcHVwIGV2ZW50LFxyXG4gICAgICAgICAgICAvLyBiYWlsIG5vd1xyXG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5oYXNIYW5kbGVkUG90ZW50aWFsUmVkaXJlY3QgPSB0cnVlO1xyXG4gICAgICAgIC8vIElmIHRoZSByZWRpcmVjdCB3YXNuJ3QgaGFuZGxlZCwgaGFuZyBvbiB0byBpdFxyXG4gICAgICAgIGlmICghaGFuZGxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgPSBldmVudDtcclxuICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoYW5kbGVkO1xyXG4gICAgfVxyXG4gICAgc2VuZFRvQ29uc3VtZXIoZXZlbnQsIGNvbnN1bWVyKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIGlmIChldmVudC5lcnJvciAmJiAhaXNOdWxsUmVkaXJlY3RFdmVudChldmVudCkpIHtcclxuICAgICAgICAgICAgY29uc3QgY29kZSA9ICgoX2EgPSBldmVudC5lcnJvci5jb2RlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3BsaXQoJ2F1dGgvJylbMV0pIHx8XHJcbiAgICAgICAgICAgICAgICBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLztcclxuICAgICAgICAgICAgY29uc3VtZXIub25FcnJvcihfY3JlYXRlRXJyb3IodGhpcy5hdXRoLCBjb2RlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdW1lci5vbkF1dGhFdmVudChldmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaXNFdmVudEZvckNvbnN1bWVyKGV2ZW50LCBjb25zdW1lcikge1xyXG4gICAgICAgIGNvbnN0IGV2ZW50SWRNYXRjaGVzID0gY29uc3VtZXIuZXZlbnRJZCA9PT0gbnVsbCB8fFxyXG4gICAgICAgICAgICAoISFldmVudC5ldmVudElkICYmIGV2ZW50LmV2ZW50SWQgPT09IGNvbnN1bWVyLmV2ZW50SWQpO1xyXG4gICAgICAgIHJldHVybiBjb25zdW1lci5maWx0ZXIuaW5jbHVkZXMoZXZlbnQudHlwZSkgJiYgZXZlbnRJZE1hdGNoZXM7XHJcbiAgICB9XHJcbiAgICBoYXNFdmVudEJlZW5IYW5kbGVkKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSB0aGlzLmxhc3RQcm9jZXNzZWRFdmVudFRpbWUgPj1cclxuICAgICAgICAgICAgRVZFTlRfRFVQTElDQVRJT05fQ0FDSEVfRFVSQVRJT05fTVMpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZWRFdmVudFVpZHMuY2xlYXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVkRXZlbnRVaWRzLmhhcyhldmVudFVpZChldmVudCkpO1xyXG4gICAgfVxyXG4gICAgc2F2ZUV2ZW50VG9DYWNoZShldmVudCkge1xyXG4gICAgICAgIHRoaXMuY2FjaGVkRXZlbnRVaWRzLmFkZChldmVudFVpZChldmVudCkpO1xyXG4gICAgICAgIHRoaXMubGFzdFByb2Nlc3NlZEV2ZW50VGltZSA9IERhdGUubm93KCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZXZlbnRVaWQoZSkge1xyXG4gICAgcmV0dXJuIFtlLnR5cGUsIGUuZXZlbnRJZCwgZS5zZXNzaW9uSWQsIGUudGVuYW50SWRdLmZpbHRlcih2ID0+IHYpLmpvaW4oJy0nKTtcclxufVxyXG5mdW5jdGlvbiBpc051bGxSZWRpcmVjdEV2ZW50KHsgdHlwZSwgZXJyb3IgfSkge1xyXG4gICAgcmV0dXJuICh0eXBlID09PSBcInVua25vd25cIiAvKiBBdXRoRXZlbnRUeXBlLlVOS05PV04gKi8gJiZcclxuICAgICAgICAoZXJyb3IgPT09IG51bGwgfHwgZXJyb3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVycm9yLmNvZGUpID09PSBgYXV0aC8ke1wibm8tYXV0aC1ldmVudFwiIC8qIEF1dGhFcnJvckNvZGUuTk9fQVVUSF9FVkVOVCAqL31gKTtcclxufVxyXG5mdW5jdGlvbiBpc1JlZGlyZWN0RXZlbnQoZXZlbnQpIHtcclxuICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xyXG4gICAgICAgIGNhc2UgXCJzaWduSW5WaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi86XHJcbiAgICAgICAgY2FzZSBcImxpbmtWaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuTElOS19WSUFfUkVESVJFQ1QgKi86XHJcbiAgICAgICAgY2FzZSBcInJlYXV0aFZpYVJlZGlyZWN0XCIgLyogQXV0aEV2ZW50VHlwZS5SRUFVVEhfVklBX1JFRElSRUNUICovOlxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICBjYXNlIFwidW5rbm93blwiIC8qIEF1dGhFdmVudFR5cGUuVU5LTk9XTiAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIGlzTnVsbFJlZGlyZWN0RXZlbnQoZXZlbnQpO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBfZ2V0UHJvamVjdENvbmZpZyhhdXRoLCByZXF1ZXN0ID0ge30pIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJHRVRcIiAvKiBIdHRwTWV0aG9kLkdFVCAqLywgXCIvdjEvcHJvamVjdHNcIiAvKiBFbmRwb2ludC5HRVRfUFJPSkVDVF9DT05GSUcgKi8sIHJlcXVlc3QpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IElQX0FERFJFU1NfUkVHRVggPSAvXlxcZHsxLDN9XFwuXFxkezEsM31cXC5cXGR7MSwzfVxcLlxcZHsxLDN9JC87XHJcbmNvbnN0IEhUVFBfUkVHRVggPSAvXmh0dHBzPy87XHJcbmFzeW5jIGZ1bmN0aW9uIF92YWxpZGF0ZU9yaWdpbihhdXRoKSB7XHJcbiAgICAvLyBTa2lwIG9yaWdpbiB2YWxpZGF0aW9uIGlmIHdlIGFyZSBpbiBhbiBlbXVsYXRlZCBlbnZpcm9ubWVudFxyXG4gICAgaWYgKGF1dGguY29uZmlnLmVtdWxhdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBhdXRob3JpemVkRG9tYWlucyB9ID0gYXdhaXQgX2dldFByb2plY3RDb25maWcoYXV0aCk7XHJcbiAgICBmb3IgKGNvbnN0IGRvbWFpbiBvZiBhdXRob3JpemVkRG9tYWlucykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChtYXRjaERvbWFpbihkb21haW4pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmcgaWYgdGhlcmUncyBhIFVSTCBlcnJvcjsganVzdCBjb250aW51ZSBzZWFyY2hpbmdcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBJbiB0aGUgb2xkIFNESywgdGhpcyBlcnJvciBhbHNvIHByb3ZpZGVzIGhlbHBmdWwgbWVzc2FnZXMuXHJcbiAgICBfZmFpbChhdXRoLCBcInVuYXV0aG9yaXplZC1kb21haW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT1JJR0lOICovKTtcclxufVxyXG5mdW5jdGlvbiBtYXRjaERvbWFpbihleHBlY3RlZCkge1xyXG4gICAgY29uc3QgY3VycmVudFVybCA9IF9nZXRDdXJyZW50VXJsKCk7XHJcbiAgICBjb25zdCB7IHByb3RvY29sLCBob3N0bmFtZSB9ID0gbmV3IFVSTChjdXJyZW50VXJsKTtcclxuICAgIGlmIChleHBlY3RlZC5zdGFydHNXaXRoKCdjaHJvbWUtZXh0ZW5zaW9uOi8vJykpIHtcclxuICAgICAgICBjb25zdCBjZVVybCA9IG5ldyBVUkwoZXhwZWN0ZWQpO1xyXG4gICAgICAgIGlmIChjZVVybC5ob3N0bmFtZSA9PT0gJycgJiYgaG9zdG5hbWUgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIC8vIEZvciBzb21lIHJlYXNvbiB3ZSdyZSBub3QgcGFyc2luZyBjaHJvbWUgVVJMcyBwcm9wZXJseVxyXG4gICAgICAgICAgICByZXR1cm4gKHByb3RvY29sID09PSAnY2hyb21lLWV4dGVuc2lvbjonICYmXHJcbiAgICAgICAgICAgICAgICBleHBlY3RlZC5yZXBsYWNlKCdjaHJvbWUtZXh0ZW5zaW9uOi8vJywgJycpID09PVxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRVcmwucmVwbGFjZSgnY2hyb21lLWV4dGVuc2lvbjovLycsICcnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcm90b2NvbCA9PT0gJ2Nocm9tZS1leHRlbnNpb246JyAmJiBjZVVybC5ob3N0bmFtZSA9PT0gaG9zdG5hbWU7XHJcbiAgICB9XHJcbiAgICBpZiAoIUhUVFBfUkVHRVgudGVzdChwcm90b2NvbCkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoSVBfQUREUkVTU19SRUdFWC50ZXN0KGV4cGVjdGVkKSkge1xyXG4gICAgICAgIC8vIFRoZSBkb21haW4gaGFzIHRvIGJlIGV4YWN0bHkgZXF1YWwgdG8gdGhlIHBhdHRlcm4sIGFzIGFuIElQIGRvbWFpbiB3aWxsXHJcbiAgICAgICAgLy8gb25seSBjb250YWluIHRoZSBJUCwgbm8gZXh0cmEgY2hhcmFjdGVyLlxyXG4gICAgICAgIHJldHVybiBob3N0bmFtZSA9PT0gZXhwZWN0ZWQ7XHJcbiAgICB9XHJcbiAgICAvLyBEb3RzIGluIHBhdHRlcm4gc2hvdWxkIGJlIGVzY2FwZWQuXHJcbiAgICBjb25zdCBlc2NhcGVkRG9tYWluUGF0dGVybiA9IGV4cGVjdGVkLnJlcGxhY2UoL1xcLi9nLCAnXFxcXC4nKTtcclxuICAgIC8vIE5vbiBpcCBhZGRyZXNzIGRvbWFpbnMuXHJcbiAgICAvLyBkb21haW4uY29tID0gKi5kb21haW4uY29tIE9SIGRvbWFpbi5jb21cclxuICAgIGNvbnN0IHJlID0gbmV3IFJlZ0V4cCgnXiguK1xcXFwuJyArIGVzY2FwZWREb21haW5QYXR0ZXJuICsgJ3wnICsgZXNjYXBlZERvbWFpblBhdHRlcm4gKyAnKSQnLCAnaScpO1xyXG4gICAgcmV0dXJuIHJlLnRlc3QoaG9zdG5hbWUpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDLlxyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBORVRXT1JLX1RJTUVPVVQgPSBuZXcgRGVsYXkoMzAwMDAsIDYwMDAwKTtcclxuLyoqXHJcbiAqIFJlc2V0IHVubG9hZGVkIEdBcGkgbW9kdWxlcy4gSWYgZ2FwaS5sb2FkIGZhaWxzIGR1ZSB0byBhIG5ldHdvcmsgZXJyb3IsXHJcbiAqIGl0IHdpbGwgc3RvcCB3b3JraW5nIGFmdGVyIGEgcmV0cmlhbC4gVGhpcyBpcyBhIGhhY2sgdG8gZml4IHRoaXMgaXNzdWUuXHJcbiAqL1xyXG5mdW5jdGlvbiByZXNldFVubG9hZGVkR2FwaU1vZHVsZXMoKSB7XHJcbiAgICAvLyBDbGVhciBsYXN0IGZhaWxlZCBnYXBpLmxvYWQgc3RhdGUgdG8gZm9yY2UgbmV4dCBnYXBpLmxvYWQgdG8gZmlyc3RcclxuICAgIC8vIGxvYWQgdGhlIGZhaWxlZCBnYXBpLmlmcmFtZXMgbW9kdWxlLlxyXG4gICAgLy8gR2V0IGdhcGl4LmJlYWNvbiBjb250ZXh0LlxyXG4gICAgY29uc3QgYmVhY29uID0gX3dpbmRvdygpLl9fX2pzbDtcclxuICAgIC8vIEdldCBjdXJyZW50IGhpbnQuXHJcbiAgICBpZiAoYmVhY29uID09PSBudWxsIHx8IGJlYWNvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogYmVhY29uLkgpIHtcclxuICAgICAgICAvLyBHZXQgZ2FwaSBoaW50LlxyXG4gICAgICAgIGZvciAoY29uc3QgaGludCBvZiBPYmplY3Qua2V5cyhiZWFjb24uSCkpIHtcclxuICAgICAgICAgICAgLy8gUmVxdWVzdGVkIG1vZHVsZXMuXHJcbiAgICAgICAgICAgIGJlYWNvbi5IW2hpbnRdLnIgPSBiZWFjb24uSFtoaW50XS5yIHx8IFtdO1xyXG4gICAgICAgICAgICAvLyBMb2FkZWQgbW9kdWxlcy5cclxuICAgICAgICAgICAgYmVhY29uLkhbaGludF0uTCA9IGJlYWNvbi5IW2hpbnRdLkwgfHwgW107XHJcbiAgICAgICAgICAgIC8vIFNldCByZXF1ZXN0ZWQgbW9kdWxlcyB0byBhIGNvcHkgb2YgdGhlIGxvYWRlZCBtb2R1bGVzLlxyXG4gICAgICAgICAgICBiZWFjb24uSFtoaW50XS5yID0gWy4uLmJlYWNvbi5IW2hpbnRdLkxdO1xyXG4gICAgICAgICAgICAvLyBDbGVhciBwZW5kaW5nIGNhbGxiYWNrcy5cclxuICAgICAgICAgICAgaWYgKGJlYWNvbi5DUCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiZWFjb24uQ1AubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYWxsIGZhaWxlZCBwZW5kaW5nIGNhbGxiYWNrcy5cclxuICAgICAgICAgICAgICAgICAgICBiZWFjb24uQ1BbaV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGxvYWRHYXBpKGF1dGgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgdmFyIF9hLCBfYiwgX2M7XHJcbiAgICAgICAgLy8gRnVuY3Rpb24gdG8gcnVuIHdoZW4gZ2FwaS5sb2FkIGlzIHJlYWR5LlxyXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRHYXBpSWZyYW1lKCkge1xyXG4gICAgICAgICAgICAvLyBUaGUgZGV2ZWxvcGVyIG1heSBoYXZlIHRyaWVkIHRvIHByZXZpb3VzbHkgcnVuIGdhcGkubG9hZCBhbmQgZmFpbGVkLlxyXG4gICAgICAgICAgICAvLyBSdW4gdGhpcyB0byBmaXggdGhhdC5cclxuICAgICAgICAgICAgcmVzZXRVbmxvYWRlZEdhcGlNb2R1bGVzKCk7XHJcbiAgICAgICAgICAgIGdhcGkubG9hZCgnZ2FwaS5pZnJhbWVzJywge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGdhcGkuaWZyYW1lcy5nZXRDb250ZXh0KCkpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG9udGltZW91dDogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhYm92ZSByZXNldCBtYXkgYmUgc3VmZmljaWVudCwgYnV0IGhhdmluZyB0aGlzIHJlc2V0IGFmdGVyXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZmFpbHVyZSBlbnN1cmVzIHRoYXQgaWYgdGhlIGRldmVsb3BlciBjYWxscyBnYXBpLmxvYWQgYWZ0ZXIgdGhlXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29ubmVjdGlvbiBpcyByZS1lc3RhYmxpc2hlZCBhbmQgYmVmb3JlIGFub3RoZXIgYXR0ZW1wdCB0byBlbWJlZFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSBpZnJhbWUsIGl0IHdvdWxkIHdvcmsgYW5kIHdvdWxkIG5vdCBiZSBicm9rZW4gYmVjYXVzZSBvZiBvdXJcclxuICAgICAgICAgICAgICAgICAgICAvLyBmYWlsZWQgYXR0ZW1wdC5cclxuICAgICAgICAgICAgICAgICAgICAvLyBUaW1lb3V0IHdoZW4gZ2FwaS5pZnJhbWVzLklmcmFtZSBub3QgbG9hZGVkLlxyXG4gICAgICAgICAgICAgICAgICAgIHJlc2V0VW5sb2FkZWRHYXBpTW9kdWxlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChfY3JlYXRlRXJyb3IoYXV0aCwgXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKSk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgdGltZW91dDogTkVUV09SS19USU1FT1VULmdldCgpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKF9iID0gKF9hID0gX3dpbmRvdygpLmdhcGkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZnJhbWVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuSWZyYW1lKSB7XHJcbiAgICAgICAgICAgIC8vIElmIGdhcGkuaWZyYW1lcy5JZnJhbWUgYXZhaWxhYmxlLCByZXNvbHZlLlxyXG4gICAgICAgICAgICByZXNvbHZlKGdhcGkuaWZyYW1lcy5nZXRDb250ZXh0KCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghISgoX2MgPSBfd2luZG93KCkuZ2FwaSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmxvYWQpKSB7XHJcbiAgICAgICAgICAgIC8vIEdhcGkgbG9hZGVyIHJlYWR5LCBsb2FkIGdhcGkuaWZyYW1lcy5cclxuICAgICAgICAgICAgbG9hZEdhcGlJZnJhbWUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIG5ldyBpZnJhbWUgY2FsbGJhY2sgd2hlbiB0aGlzIGlzIGNhbGxlZCBzbyBhcyBub3QgdG8gb3ZlcndyaXRlXHJcbiAgICAgICAgICAgIC8vIGFueSBwcmV2aW91cyBkZWZpbmVkIGNhbGxiYWNrLiBUaGlzIGhhcHBlbnMgaWYgdGhpcyBtZXRob2QgaXMgY2FsbGVkXHJcbiAgICAgICAgICAgIC8vIG11bHRpcGxlIHRpbWVzIGluIHBhcmFsbGVsIGFuZCBjb3VsZCByZXN1bHQgaW4gdGhlIGxhdGVyIGNhbGxiYWNrXHJcbiAgICAgICAgICAgIC8vIG92ZXJ3cml0aW5nIHRoZSBwcmV2aW91cyBvbmUuIFRoaXMgd291bGQgZW5kIHVwIHdpdGggYSBpZnJhbWVcclxuICAgICAgICAgICAgLy8gdGltZW91dC5cclxuICAgICAgICAgICAgY29uc3QgY2JOYW1lID0gX2dlbmVyYXRlQ2FsbGJhY2tOYW1lKCdpZnJhbWVmY2InKTtcclxuICAgICAgICAgICAgLy8gR0FwaSBsb2FkZXIgbm90IGF2YWlsYWJsZSwgZHluYW1pY2FsbHkgbG9hZCBwbGF0Zm9ybS5qcy5cclxuICAgICAgICAgICAgX3dpbmRvdygpW2NiTmFtZV0gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBHQXBpIGxvYWRlciBzaG91bGQgYmUgcmVhZHkuXHJcbiAgICAgICAgICAgICAgICBpZiAoISFnYXBpLmxvYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkR2FwaUlmcmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gR2FwaSBsb2FkZXIgZmFpbGVkLCB0aHJvdyBlcnJvci5cclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoX2NyZWF0ZUVycm9yKGF1dGgsIFwibmV0d29yay1yZXF1ZXN0LWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvLyBMb2FkIEdBcGkgbG9hZGVyLlxyXG4gICAgICAgICAgICByZXR1cm4gX2xvYWRKUyhgJHtfZ2FwaVNjcmlwdFVybCgpfT9vbmxvYWQ9JHtjYk5hbWV9YClcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlID0+IHJlamVjdChlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIC8vIFJlc2V0IGNhY2hlZCBwcm9taXNlIHRvIGFsbG93IGZvciByZXRyaWFsLlxyXG4gICAgICAgIGNhY2hlZEdBcGlMb2FkZXIgPSBudWxsO1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfSk7XHJcbn1cclxubGV0IGNhY2hlZEdBcGlMb2FkZXIgPSBudWxsO1xyXG5mdW5jdGlvbiBfbG9hZEdhcGkoYXV0aCkge1xyXG4gICAgY2FjaGVkR0FwaUxvYWRlciA9IGNhY2hlZEdBcGlMb2FkZXIgfHwgbG9hZEdhcGkoYXV0aCk7XHJcbiAgICByZXR1cm4gY2FjaGVkR0FwaUxvYWRlcjtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQy5cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgUElOR19USU1FT1VUID0gbmV3IERlbGF5KDUwMDAsIDE1MDAwKTtcclxuY29uc3QgSUZSQU1FX1BBVEggPSAnX18vYXV0aC9pZnJhbWUnO1xyXG5jb25zdCBFTVVMQVRFRF9JRlJBTUVfUEFUSCA9ICdlbXVsYXRvci9hdXRoL2lmcmFtZSc7XHJcbmNvbnN0IElGUkFNRV9BVFRSSUJVVEVTID0ge1xyXG4gICAgc3R5bGU6IHtcclxuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcclxuICAgICAgICB0b3A6ICctMTAwcHgnLFxyXG4gICAgICAgIHdpZHRoOiAnMXB4JyxcclxuICAgICAgICBoZWlnaHQ6ICcxcHgnXHJcbiAgICB9LFxyXG4gICAgJ2FyaWEtaGlkZGVuJzogJ3RydWUnLFxyXG4gICAgdGFiaW5kZXg6ICctMSdcclxufTtcclxuLy8gTWFwIGZyb20gYXBpSG9zdCB0byBlbmRwb2ludCBJRCBmb3IgcGFzc2luZyBpbnRvIGlmcmFtZS4gSW4gY3VycmVudCBTREssIGFwaUhvc3QgY2FuIGJlIHNldCB0b1xyXG4vLyBhbnl0aGluZyAobm90IGZyb20gYSBsaXN0IG9mIGVuZHBvaW50cyB3aXRoIElEcyBhcyBpbiBsZWdhY3kpLCBzbyB0aGlzIGlzIHRoZSBjbG9zZXN0IHdlIGNhbiBnZXQuXHJcbmNvbnN0IEVJRF9GUk9NX0FQSUhPU1QgPSBuZXcgTWFwKFtcclxuICAgIFtcImlkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbVwiIC8qIERlZmF1bHRDb25maWcuQVBJX0hPU1QgKi8sICdwJ10sXHJcbiAgICBbJ3N0YWdpbmctaWRlbnRpdHl0b29sa2l0LnNhbmRib3guZ29vZ2xlYXBpcy5jb20nLCAncyddLFxyXG4gICAgWyd0ZXN0LWlkZW50aXR5dG9vbGtpdC5zYW5kYm94Lmdvb2dsZWFwaXMuY29tJywgJ3QnXSAvLyB0ZXN0XHJcbl0pO1xyXG5mdW5jdGlvbiBnZXRJZnJhbWVVcmwoYXV0aCkge1xyXG4gICAgY29uc3QgY29uZmlnID0gYXV0aC5jb25maWc7XHJcbiAgICBfYXNzZXJ0KGNvbmZpZy5hdXRoRG9tYWluLCBhdXRoLCBcImF1dGgtZG9tYWluLWNvbmZpZy1yZXF1aXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BVVRIX0RPTUFJTiAqLyk7XHJcbiAgICBjb25zdCB1cmwgPSBjb25maWcuZW11bGF0b3JcclxuICAgICAgICA/IF9lbXVsYXRvclVybChjb25maWcsIEVNVUxBVEVEX0lGUkFNRV9QQVRIKVxyXG4gICAgICAgIDogYGh0dHBzOi8vJHthdXRoLmNvbmZpZy5hdXRoRG9tYWlufS8ke0lGUkFNRV9QQVRIfWA7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgICAgYXBpS2V5OiBjb25maWcuYXBpS2V5LFxyXG4gICAgICAgIGFwcE5hbWU6IGF1dGgubmFtZSxcclxuICAgICAgICB2OiBTREtfVkVSU0lPTlxyXG4gICAgfTtcclxuICAgIGNvbnN0IGVpZCA9IEVJRF9GUk9NX0FQSUhPU1QuZ2V0KGF1dGguY29uZmlnLmFwaUhvc3QpO1xyXG4gICAgaWYgKGVpZCkge1xyXG4gICAgICAgIHBhcmFtcy5laWQgPSBlaWQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBmcmFtZXdvcmtzID0gYXV0aC5fZ2V0RnJhbWV3b3JrcygpO1xyXG4gICAgaWYgKGZyYW1ld29ya3MubGVuZ3RoKSB7XHJcbiAgICAgICAgcGFyYW1zLmZ3ID0gZnJhbWV3b3Jrcy5qb2luKCcsJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYCR7dXJsfT8ke3F1ZXJ5c3RyaW5nKHBhcmFtcykuc2xpY2UoMSl9YDtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfb3BlbklmcmFtZShhdXRoKSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gYXdhaXQgX2xvYWRHYXBpKGF1dGgpO1xyXG4gICAgY29uc3QgZ2FwaSA9IF93aW5kb3coKS5nYXBpO1xyXG4gICAgX2Fzc2VydChnYXBpLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICByZXR1cm4gY29udGV4dC5vcGVuKHtcclxuICAgICAgICB3aGVyZTogZG9jdW1lbnQuYm9keSxcclxuICAgICAgICB1cmw6IGdldElmcmFtZVVybChhdXRoKSxcclxuICAgICAgICBtZXNzYWdlSGFuZGxlcnNGaWx0ZXI6IGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIsXHJcbiAgICAgICAgYXR0cmlidXRlczogSUZSQU1FX0FUVFJJQlVURVMsXHJcbiAgICAgICAgZG9udGNsZWFyOiB0cnVlXHJcbiAgICB9LCAoaWZyYW1lKSA9PiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgYXdhaXQgaWZyYW1lLnJlc3R5bGUoe1xyXG4gICAgICAgICAgICAvLyBQcmV2ZW50IGlmcmFtZSBmcm9tIGNsb3Npbmcgb24gbW91c2Ugb3V0LlxyXG4gICAgICAgICAgICBzZXRIaWRlT25MZWF2ZTogZmFsc2VcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBuZXR3b3JrRXJyb3IgPSBfY3JlYXRlRXJyb3IoYXV0aCwgXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKTtcclxuICAgICAgICAvLyBDb25maXJtIGlmcmFtZSBpcyBjb3JyZWN0bHkgbG9hZGVkLlxyXG4gICAgICAgIC8vIFRvIGZhbGxiYWNrIG9uIGZhaWx1cmUsIHNldCBhIHRpbWVvdXQuXHJcbiAgICAgICAgY29uc3QgbmV0d29ya0Vycm9yVGltZXIgPSBfd2luZG93KCkuc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChuZXR3b3JrRXJyb3IpO1xyXG4gICAgICAgIH0sIFBJTkdfVElNRU9VVC5nZXQoKSk7XHJcbiAgICAgICAgLy8gQ2xlYXIgdGltZXIgYW5kIHJlc29sdmUgcGVuZGluZyBpZnJhbWUgcmVhZHkgcHJvbWlzZS5cclxuICAgICAgICBmdW5jdGlvbiBjbGVhclRpbWVyQW5kUmVzb2x2ZSgpIHtcclxuICAgICAgICAgICAgX3dpbmRvdygpLmNsZWFyVGltZW91dChuZXR3b3JrRXJyb3JUaW1lcik7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaWZyYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVGhpcyByZXR1cm5zIGFuIElUaGVuYWJsZS4gSG93ZXZlciB0aGUgcmVqZWN0IHBhcnQgZG9lcyBub3QgY2FsbFxyXG4gICAgICAgIC8vIHdoZW4gdGhlIGlmcmFtZSBpcyBub3QgbG9hZGVkLlxyXG4gICAgICAgIGlmcmFtZS5waW5nKGNsZWFyVGltZXJBbmRSZXNvbHZlKS50aGVuKGNsZWFyVGltZXJBbmRSZXNvbHZlLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChuZXR3b3JrRXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDLlxyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBCQVNFX1BPUFVQX09QVElPTlMgPSB7XHJcbiAgICBsb2NhdGlvbjogJ3llcycsXHJcbiAgICByZXNpemFibGU6ICd5ZXMnLFxyXG4gICAgc3RhdHVzYmFyOiAneWVzJyxcclxuICAgIHRvb2xiYXI6ICdubydcclxufTtcclxuY29uc3QgREVGQVVMVF9XSURUSCA9IDUwMDtcclxuY29uc3QgREVGQVVMVF9IRUlHSFQgPSA2MDA7XHJcbmNvbnN0IFRBUkdFVF9CTEFOSyA9ICdfYmxhbmsnO1xyXG5jb25zdCBGSVJFRk9YX0VNUFRZX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0JztcclxuY2xhc3MgQXV0aFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKHdpbmRvdykge1xyXG4gICAgICAgIHRoaXMud2luZG93ID0gd2luZG93O1xyXG4gICAgICAgIHRoaXMuYXNzb2NpYXRlZEV2ZW50ID0gbnVsbDtcclxuICAgIH1cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLndpbmRvdykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy53aW5kb3cuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkgeyB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF9vcGVuKGF1dGgsIHVybCwgbmFtZSwgd2lkdGggPSBERUZBVUxUX1dJRFRILCBoZWlnaHQgPSBERUZBVUxUX0hFSUdIVCkge1xyXG4gICAgY29uc3QgdG9wID0gTWF0aC5tYXgoKHdpbmRvdy5zY3JlZW4uYXZhaWxIZWlnaHQgLSBoZWlnaHQpIC8gMiwgMCkudG9TdHJpbmcoKTtcclxuICAgIGNvbnN0IGxlZnQgPSBNYXRoLm1heCgod2luZG93LnNjcmVlbi5hdmFpbFdpZHRoIC0gd2lkdGgpIC8gMiwgMCkudG9TdHJpbmcoKTtcclxuICAgIGxldCB0YXJnZXQgPSAnJztcclxuICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIEJBU0VfUE9QVVBfT1BUSU9OUyksIHsgd2lkdGg6IHdpZHRoLnRvU3RyaW5nKCksIGhlaWdodDogaGVpZ2h0LnRvU3RyaW5nKCksIHRvcCxcclxuICAgICAgICBsZWZ0IH0pO1xyXG4gICAgLy8gQ2hyb21lIGlPUyA3IGFuZCA4IGlzIHJldHVybmluZyBhbiB1bmRlZmluZWQgcG9wdXAgd2luIHdoZW4gdGFyZ2V0IGlzXHJcbiAgICAvLyBzcGVjaWZpZWQsIGV2ZW4gdGhvdWdoIHRoZSBwb3B1cCBpcyBub3QgbmVjZXNzYXJpbHkgYmxvY2tlZC5cclxuICAgIGNvbnN0IHVhID0gZ2V0VUEoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKG5hbWUpIHtcclxuICAgICAgICB0YXJnZXQgPSBfaXNDaHJvbWVJT1ModWEpID8gVEFSR0VUX0JMQU5LIDogbmFtZTtcclxuICAgIH1cclxuICAgIGlmIChfaXNGaXJlZm94KHVhKSkge1xyXG4gICAgICAgIC8vIEZpcmVmb3ggY29tcGxhaW5zIHdoZW4gaW52YWxpZCBVUkxzIGFyZSBwb3BwZWQgb3V0LiBIYWNreSB3YXkgdG8gYnlwYXNzLlxyXG4gICAgICAgIHVybCA9IHVybCB8fCBGSVJFRk9YX0VNUFRZX1VSTDtcclxuICAgICAgICAvLyBGaXJlZm94IGRpc2FibGVzIGJ5IGRlZmF1bHQgc2Nyb2xsaW5nIG9uIHBvcHVwIHdpbmRvd3MsIHdoaWNoIGNhbiBjcmVhdGVcclxuICAgICAgICAvLyBpc3N1ZXMgd2hlbiB0aGUgdXNlciBoYXMgbWFueSBHb29nbGUgYWNjb3VudHMsIGZvciBpbnN0YW5jZS5cclxuICAgICAgICBvcHRpb25zLnNjcm9sbGJhcnMgPSAneWVzJztcclxuICAgIH1cclxuICAgIGNvbnN0IG9wdGlvbnNTdHJpbmcgPSBPYmplY3QuZW50cmllcyhvcHRpb25zKS5yZWR1Y2UoKGFjY3VtLCBba2V5LCB2YWx1ZV0pID0+IGAke2FjY3VtfSR7a2V5fT0ke3ZhbHVlfSxgLCAnJyk7XHJcbiAgICBpZiAoX2lzSU9TU3RhbmRhbG9uZSh1YSkgJiYgdGFyZ2V0ICE9PSAnX3NlbGYnKSB7XHJcbiAgICAgICAgb3BlbkFzTmV3V2luZG93SU9TKHVybCB8fCAnJywgdGFyZ2V0KTtcclxuICAgICAgICByZXR1cm4gbmV3IEF1dGhQb3B1cChudWxsKTtcclxuICAgIH1cclxuICAgIC8vIGFib3V0OmJsYW5rIGdldHRpbmcgc2FuaXRpemVkIGNhdXNpbmcgYnJvd3NlcnMgbGlrZSBJRS9FZGdlIHRvIGRpc3BsYXlcclxuICAgIC8vIGJyaWVmIGVycm9yIG1lc3NhZ2UgYmVmb3JlIHJlZGlyZWN0aW5nIHRvIGhhbmRsZXIuXHJcbiAgICBjb25zdCBuZXdXaW4gPSB3aW5kb3cub3Blbih1cmwgfHwgJycsIHRhcmdldCwgb3B0aW9uc1N0cmluZyk7XHJcbiAgICBfYXNzZXJ0KG5ld1dpbiwgYXV0aCwgXCJwb3B1cC1ibG9ja2VkXCIgLyogQXV0aEVycm9yQ29kZS5QT1BVUF9CTE9DS0VEICovKTtcclxuICAgIC8vIEZsYWt5IG9uIElFIGVkZ2UsIGVuY2Fwc3VsYXRlIHdpdGggYSB0cnkgYW5kIGNhdGNoLlxyXG4gICAgdHJ5IHtcclxuICAgICAgICBuZXdXaW4uZm9jdXMoKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7IH1cclxuICAgIHJldHVybiBuZXcgQXV0aFBvcHVwKG5ld1dpbik7XHJcbn1cclxuZnVuY3Rpb24gb3BlbkFzTmV3V2luZG93SU9TKHVybCwgdGFyZ2V0KSB7XHJcbiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgIGVsLmhyZWYgPSB1cmw7XHJcbiAgICBlbC50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICBjb25zdCBjbGljayA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50Jyk7XHJcbiAgICBjbGljay5pbml0TW91c2VFdmVudCgnY2xpY2snLCB0cnVlLCB0cnVlLCB3aW5kb3csIDEsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAxLCBudWxsKTtcclxuICAgIGVsLmRpc3BhdGNoRXZlbnQoY2xpY2spO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBVUkwgZm9yIEF1dGhlbnRpY2F0aW9uIHdpZGdldCB3aGljaCB3aWxsIGluaXRpYXRlIHRoZSBPQXV0aCBoYW5kc2hha2VcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jb25zdCBXSURHRVRfUEFUSCA9ICdfXy9hdXRoL2hhbmRsZXInO1xyXG4vKipcclxuICogVVJMIGZvciBlbXVsYXRlZCBlbnZpcm9ubWVudFxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IEVNVUxBVE9SX1dJREdFVF9QQVRIID0gJ2VtdWxhdG9yL2F1dGgvaGFuZGxlcic7XHJcbi8qKlxyXG4gKiBGcmFnbWVudCBuYW1lIGZvciB0aGUgQXBwIENoZWNrIHRva2VuIHRoYXQgZ2V0cyBwYXNzZWQgdG8gdGhlIHdpZGdldFxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IEZJUkVCQVNFX0FQUF9DSEVDS19GUkFHTUVOVF9JRCA9IGVuY29kZVVSSUNvbXBvbmVudCgnZmFjJyk7XHJcbmFzeW5jIGZ1bmN0aW9uIF9nZXRSZWRpcmVjdFVybChhdXRoLCBwcm92aWRlciwgYXV0aFR5cGUsIHJlZGlyZWN0VXJsLCBldmVudElkLCBhZGRpdGlvbmFsUGFyYW1zKSB7XHJcbiAgICBfYXNzZXJ0KGF1dGguY29uZmlnLmF1dGhEb21haW4sIGF1dGgsIFwiYXV0aC1kb21haW4tY29uZmlnLXJlcXVpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0FVVEhfRE9NQUlOICovKTtcclxuICAgIF9hc3NlcnQoYXV0aC5jb25maWcuYXBpS2V5LCBhdXRoLCBcImludmFsaWQtYXBpLWtleVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUElfS0VZICovKTtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgICBhcGlLZXk6IGF1dGguY29uZmlnLmFwaUtleSxcclxuICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWUsXHJcbiAgICAgICAgYXV0aFR5cGUsXHJcbiAgICAgICAgcmVkaXJlY3RVcmwsXHJcbiAgICAgICAgdjogU0RLX1ZFUlNJT04sXHJcbiAgICAgICAgZXZlbnRJZFxyXG4gICAgfTtcclxuICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9mIEZlZGVyYXRlZEF1dGhQcm92aWRlcikge1xyXG4gICAgICAgIHByb3ZpZGVyLnNldERlZmF1bHRMYW5ndWFnZShhdXRoLmxhbmd1YWdlQ29kZSk7XHJcbiAgICAgICAgcGFyYW1zLnByb3ZpZGVySWQgPSBwcm92aWRlci5wcm92aWRlcklkIHx8ICcnO1xyXG4gICAgICAgIGlmICghaXNFbXB0eShwcm92aWRlci5nZXRDdXN0b21QYXJhbWV0ZXJzKCkpKSB7XHJcbiAgICAgICAgICAgIHBhcmFtcy5jdXN0b21QYXJhbWV0ZXJzID0gSlNPTi5zdHJpbmdpZnkocHJvdmlkZXIuZ2V0Q3VzdG9tUGFyYW1ldGVycygpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVE9ETyBzZXQgYWRkaXRpb25hbFBhcmFtcyBmcm9tIHRoZSBwcm92aWRlciBhcyB3ZWxsP1xyXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGFkZGl0aW9uYWxQYXJhbXMgfHwge30pKSB7XHJcbiAgICAgICAgICAgIHBhcmFtc1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHByb3ZpZGVyIGluc3RhbmNlb2YgQmFzZU9BdXRoUHJvdmlkZXIpIHtcclxuICAgICAgICBjb25zdCBzY29wZXMgPSBwcm92aWRlci5nZXRTY29wZXMoKS5maWx0ZXIoc2NvcGUgPT4gc2NvcGUgIT09ICcnKTtcclxuICAgICAgICBpZiAoc2NvcGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcGFyYW1zLnNjb3BlcyA9IHNjb3Blcy5qb2luKCcsJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGF1dGgudGVuYW50SWQpIHtcclxuICAgICAgICBwYXJhbXMudGlkID0gYXV0aC50ZW5hbnRJZDtcclxuICAgIH1cclxuICAgIC8vIFRPRE86IG1heWJlIHNldCBlaWQgYXMgZW5kcG9pbnRJZFxyXG4gICAgLy8gVE9ETzogbWF5YmUgc2V0IGZ3IGFzIEZyYW1ld29ya3Muam9pbihcIixcIilcclxuICAgIGNvbnN0IHBhcmFtc0RpY3QgPSBwYXJhbXM7XHJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwYXJhbXNEaWN0KSkge1xyXG4gICAgICAgIGlmIChwYXJhbXNEaWN0W2tleV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBkZWxldGUgcGFyYW1zRGljdFtrZXldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIFNldHMgdGhlIEFwcCBDaGVjayB0b2tlbiB0byBwYXNzIHRvIHRoZSB3aWRnZXRcclxuICAgIGNvbnN0IGFwcENoZWNrVG9rZW4gPSBhd2FpdCBhdXRoLl9nZXRBcHBDaGVja1Rva2VuKCk7XHJcbiAgICBjb25zdCBhcHBDaGVja1Rva2VuRnJhZ21lbnQgPSBhcHBDaGVja1Rva2VuXHJcbiAgICAgICAgPyBgIyR7RklSRUJBU0VfQVBQX0NIRUNLX0ZSQUdNRU5UX0lEfT0ke2VuY29kZVVSSUNvbXBvbmVudChhcHBDaGVja1Rva2VuKX1gXHJcbiAgICAgICAgOiAnJztcclxuICAgIC8vIFN0YXJ0IGF0IGluZGV4IDEgdG8gc2tpcCB0aGUgbGVhZGluZyAnJicgaW4gdGhlIHF1ZXJ5IHN0cmluZ1xyXG4gICAgcmV0dXJuIGAke2dldEhhbmRsZXJCYXNlKGF1dGgpfT8ke3F1ZXJ5c3RyaW5nKHBhcmFtc0RpY3QpLnNsaWNlKDEpfSR7YXBwQ2hlY2tUb2tlbkZyYWdtZW50fWA7XHJcbn1cclxuZnVuY3Rpb24gZ2V0SGFuZGxlckJhc2UoeyBjb25maWcgfSkge1xyXG4gICAgaWYgKCFjb25maWcuZW11bGF0b3IpIHtcclxuICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHtjb25maWcuYXV0aERvbWFpbn0vJHtXSURHRVRfUEFUSH1gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9lbXVsYXRvclVybChjb25maWcsIEVNVUxBVE9SX1dJREdFVF9QQVRIKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVGhlIHNwZWNpYWwgd2ViIHN0b3JhZ2UgZXZlbnRcclxuICpcclxuICovXHJcbmNvbnN0IFdFQl9TVE9SQUdFX1NVUFBPUlRfS0VZID0gJ3dlYlN0b3JhZ2VTdXBwb3J0JztcclxuY2xhc3MgQnJvd3NlclBvcHVwUmVkaXJlY3RSZXNvbHZlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmV2ZW50TWFuYWdlcnMgPSB7fTtcclxuICAgICAgICB0aGlzLmlmcmFtZXMgPSB7fTtcclxuICAgICAgICB0aGlzLm9yaWdpblZhbGlkYXRpb25Qcm9taXNlcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX3JlZGlyZWN0UGVyc2lzdGVuY2UgPSBicm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlO1xyXG4gICAgICAgIHRoaXMuX2NvbXBsZXRlUmVkaXJlY3RGbiA9IF9nZXRSZWRpcmVjdFJlc3VsdDtcclxuICAgICAgICB0aGlzLl9vdmVycmlkZVJlZGlyZWN0UmVzdWx0ID0gX292ZXJyaWRlUmVkaXJlY3RSZXN1bHQ7XHJcbiAgICB9XHJcbiAgICAvLyBXcmFwcGluZyBpbiBhc3luYyBldmVuIHRob3VnaCB3ZSBkb24ndCBhd2FpdCBhbnl3aGVyZSBpbiBvcmRlclxyXG4gICAgLy8gdG8gbWFrZSBzdXJlIGVycm9ycyBhcmUgcmFpc2VkIGFzIHByb21pc2UgcmVqZWN0aW9uc1xyXG4gICAgYXN5bmMgX29wZW5Qb3B1cChhdXRoLCBwcm92aWRlciwgYXV0aFR5cGUsIGV2ZW50SWQpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgZGVidWdBc3NlcnQoKF9hID0gdGhpcy5ldmVudE1hbmFnZXJzW2F1dGguX2tleSgpXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1hbmFnZXIsICdfaW5pdGlhbGl6ZSgpIG5vdCBjYWxsZWQgYmVmb3JlIF9vcGVuUG9wdXAoKScpO1xyXG4gICAgICAgIGNvbnN0IHVybCA9IGF3YWl0IF9nZXRSZWRpcmVjdFVybChhdXRoLCBwcm92aWRlciwgYXV0aFR5cGUsIF9nZXRDdXJyZW50VXJsKCksIGV2ZW50SWQpO1xyXG4gICAgICAgIHJldHVybiBfb3BlbihhdXRoLCB1cmwsIF9nZW5lcmF0ZUV2ZW50SWQoKSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfb3BlblJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgZXZlbnRJZCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuX29yaWdpblZhbGlkYXRpb24oYXV0aCk7XHJcbiAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgX2dldFJlZGlyZWN0VXJsKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgX2dldEN1cnJlbnRVcmwoKSwgZXZlbnRJZCk7XHJcbiAgICAgICAgX3NldFdpbmRvd0xvY2F0aW9uKHVybCk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCgpID0+IHsgfSk7XHJcbiAgICB9XHJcbiAgICBfaW5pdGlhbGl6ZShhdXRoKSB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gYXV0aC5fa2V5KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRNYW5hZ2Vyc1trZXldKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgbWFuYWdlciwgcHJvbWlzZSB9ID0gdGhpcy5ldmVudE1hbmFnZXJzW2tleV07XHJcbiAgICAgICAgICAgIGlmIChtYW5hZ2VyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG1hbmFnZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGVidWdBc3NlcnQocHJvbWlzZSwgJ0lmIG1hbmFnZXIgaXMgbm90IHNldCwgcHJvbWlzZSBzaG91bGQgYmUnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLmluaXRBbmRHZXRNYW5hZ2VyKGF1dGgpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2Vyc1trZXldID0geyBwcm9taXNlIH07XHJcbiAgICAgICAgLy8gSWYgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQsIHRoZSBrZXkgc2hvdWxkIGJlIHJlbW92ZWQgc28gdGhhdCB0aGVcclxuICAgICAgICAvLyBvcGVyYXRpb24gY2FuIGJlIHJldHJpZWQgbGF0ZXIuXHJcbiAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmV2ZW50TWFuYWdlcnNba2V5XTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgIH1cclxuICAgIGFzeW5jIGluaXRBbmRHZXRNYW5hZ2VyKGF1dGgpIHtcclxuICAgICAgICBjb25zdCBpZnJhbWUgPSBhd2FpdCBfb3BlbklmcmFtZShhdXRoKTtcclxuICAgICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IEF1dGhFdmVudE1hbmFnZXIoYXV0aCk7XHJcbiAgICAgICAgaWZyYW1lLnJlZ2lzdGVyKCdhdXRoRXZlbnQnLCAoaWZyYW1lRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgX2Fzc2VydChpZnJhbWVFdmVudCA9PT0gbnVsbCB8fCBpZnJhbWVFdmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWZyYW1lRXZlbnQuYXV0aEV2ZW50LCBhdXRoLCBcImludmFsaWQtYXV0aC1ldmVudFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BVVRIX0VWRU5UICovKTtcclxuICAgICAgICAgICAgLy8gVE9ETzogQ29uc2lkZXIgc3BsaXR0aW5nIHJlZGlyZWN0IGFuZCBwb3B1cCBldmVudHMgZWFybGllciBvblxyXG4gICAgICAgICAgICBjb25zdCBoYW5kbGVkID0gbWFuYWdlci5vbkV2ZW50KGlmcmFtZUV2ZW50LmF1dGhFdmVudCk7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHN0YXR1czogaGFuZGxlZCA/IFwiQUNLXCIgLyogR2FwaU91dGNvbWUuQUNLICovIDogXCJFUlJPUlwiIC8qIEdhcGlPdXRjb21lLkVSUk9SICovIH07XHJcbiAgICAgICAgfSwgZ2FwaS5pZnJhbWVzLkNST1NTX09SSUdJTl9JRlJBTUVTX0ZJTFRFUik7XHJcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXJzW2F1dGguX2tleSgpXSA9IHsgbWFuYWdlciB9O1xyXG4gICAgICAgIHRoaXMuaWZyYW1lc1thdXRoLl9rZXkoKV0gPSBpZnJhbWU7XHJcbiAgICAgICAgcmV0dXJuIG1hbmFnZXI7XHJcbiAgICB9XHJcbiAgICBfaXNJZnJhbWVXZWJTdG9yYWdlU3VwcG9ydGVkKGF1dGgsIGNiKSB7XHJcbiAgICAgICAgY29uc3QgaWZyYW1lID0gdGhpcy5pZnJhbWVzW2F1dGguX2tleSgpXTtcclxuICAgICAgICBpZnJhbWUuc2VuZChXRUJfU1RPUkFHRV9TVVBQT1JUX0tFWSwgeyB0eXBlOiBXRUJfU1RPUkFHRV9TVVBQT1JUX0tFWSB9LCByZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzU3VwcG9ydGVkID0gKF9hID0gcmVzdWx0ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzdWx0WzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVldO1xyXG4gICAgICAgICAgICBpZiAoaXNTdXBwb3J0ZWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY2IoISFpc1N1cHBvcnRlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX2ZhaWwoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIH0sIGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIpO1xyXG4gICAgfVxyXG4gICAgX29yaWdpblZhbGlkYXRpb24oYXV0aCkge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGF1dGguX2tleSgpO1xyXG4gICAgICAgIGlmICghdGhpcy5vcmlnaW5WYWxpZGF0aW9uUHJvbWlzZXNba2V5XSkge1xyXG4gICAgICAgICAgICB0aGlzLm9yaWdpblZhbGlkYXRpb25Qcm9taXNlc1trZXldID0gX3ZhbGlkYXRlT3JpZ2luKGF1dGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5vcmlnaW5WYWxpZGF0aW9uUHJvbWlzZXNba2V5XTtcclxuICAgIH1cclxuICAgIGdldCBfc2hvdWxkSW5pdFByb2FjdGl2ZWx5KCkge1xyXG4gICAgICAgIC8vIE1vYmlsZSBicm93c2VycyBhbmQgU2FmYXJpIG5lZWQgdG8gb3B0aW1pc3RpY2FsbHkgaW5pdGlhbGl6ZVxyXG4gICAgICAgIHJldHVybiBfaXNNb2JpbGVCcm93c2VyKCkgfHwgX2lzU2FmYXJpKCkgfHwgX2lzSU9TKCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQb3B1cFJlZGlyZWN0UmVzb2x2ZXJ9IHN1aXRhYmxlIGZvciBicm93c2VyXHJcbiAqIGJhc2VkIGFwcGxpY2F0aW9ucy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBtZXRob2QgZG9lcyBub3Qgd29yayBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGJyb3dzZXJQb3B1cFJlZGlyZWN0UmVzb2x2ZXIgPSBCcm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyO1xuXG5jbGFzcyBNdWx0aUZhY3RvckFzc2VydGlvbkltcGwge1xyXG4gICAgY29uc3RydWN0b3IoZmFjdG9ySWQpIHtcclxuICAgICAgICB0aGlzLmZhY3RvcklkID0gZmFjdG9ySWQ7XHJcbiAgICB9XHJcbiAgICBfcHJvY2VzcyhhdXRoLCBzZXNzaW9uLCBkaXNwbGF5TmFtZSkge1xyXG4gICAgICAgIHN3aXRjaCAoc2Vzc2lvbi50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJlbnJvbGxcIiAvKiBNdWx0aUZhY3RvclNlc3Npb25UeXBlLkVOUk9MTCAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5hbGl6ZUVucm9sbChhdXRoLCBzZXNzaW9uLmNyZWRlbnRpYWwsIGRpc3BsYXlOYW1lKTtcclxuICAgICAgICAgICAgY2FzZSBcInNpZ25pblwiIC8qIE11bHRpRmFjdG9yU2Vzc2lvblR5cGUuU0lHTl9JTiAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5hbGl6ZVNpZ25JbihhdXRoLCBzZXNzaW9uLmNyZWRlbnRpYWwpO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlYnVnRmFpbCgndW5leHBlY3RlZCBNdWx0aUZhY3RvclNlc3Npb25UeXBlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiB7QGluaGVyaXRkb2MgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbn1cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbkltcGwgZXh0ZW5kcyBNdWx0aUZhY3RvckFzc2VydGlvbkltcGwge1xyXG4gICAgY29uc3RydWN0b3IoY3JlZGVudGlhbCkge1xyXG4gICAgICAgIHN1cGVyKFwicGhvbmVcIiAvKiBGYWN0b3JJZC5QSE9ORSAqLyk7XHJcbiAgICAgICAgdGhpcy5jcmVkZW50aWFsID0gY3JlZGVudGlhbDtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbUNyZWRlbnRpYWwoY3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbkltcGwoY3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZmluYWxpemVFbnJvbGwoYXV0aCwgaWRUb2tlbiwgZGlzcGxheU5hbWUpIHtcclxuICAgICAgICByZXR1cm4gZmluYWxpemVFbnJvbGxQaG9uZU1mYShhdXRoLCB7XHJcbiAgICAgICAgICAgIGlkVG9rZW4sXHJcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lLFxyXG4gICAgICAgICAgICBwaG9uZVZlcmlmaWNhdGlvbkluZm86IHRoaXMuY3JlZGVudGlhbC5fbWFrZVZlcmlmaWNhdGlvblJlcXVlc3QoKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2ZpbmFsaXplU2lnbkluKGF1dGgsIG1mYVBlbmRpbmdDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIGZpbmFsaXplU2lnbkluUGhvbmVNZmEoYXV0aCwge1xyXG4gICAgICAgICAgICBtZmFQZW5kaW5nQ3JlZGVudGlhbCxcclxuICAgICAgICAgICAgcGhvbmVWZXJpZmljYXRpb25JbmZvOiB0aGlzLmNyZWRlbnRpYWwuX21ha2VWZXJpZmljYXRpb25SZXF1ZXN0KClcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYSB7QGxpbmsgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbn0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIFBob25lTXVsdGlGYWN0b3JHZW5lcmF0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoKSB7IH1cclxuICAgIC8qKlxyXG4gICAgICogUHJvdmlkZXMgYSB7QGxpbmsgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbn0gdG8gY29uZmlybSBvd25lcnNoaXAgb2YgdGhlIHBob25lIHNlY29uZCBmYWN0b3IuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHdvcmsgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwaG9uZUF1dGhDcmVkZW50aWFsIC0gQSBjcmVkZW50aWFsIHByb3ZpZGVkIGJ5IHtAbGluayBQaG9uZUF1dGhQcm92aWRlci5jcmVkZW50aWFsfS5cclxuICAgICAqIEByZXR1cm5zIEEge0BsaW5rIFBob25lTXVsdGlGYWN0b3JBc3NlcnRpb259IHdoaWNoIGNhbiBiZSB1c2VkIHdpdGhcclxuICAgICAqIHtAbGluayBNdWx0aUZhY3RvclJlc29sdmVyLnJlc29sdmVTaWduSW59XHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBhc3NlcnRpb24oY3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBQaG9uZU11bHRpRmFjdG9yQXNzZXJ0aW9uSW1wbC5fZnJvbUNyZWRlbnRpYWwoY3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBwaG9uZSBzZWNvbmQgZmFjdG9yOiBgcGhvbmVgLlxyXG4gKi9cclxuUGhvbmVNdWx0aUZhY3RvckdlbmVyYXRvci5GQUNUT1JfSUQgPSAncGhvbmUnO1xuXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYSB7QGxpbmsgVG90cE11bHRpRmFjdG9yQXNzZXJ0aW9ufS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgVG90cE11bHRpRmFjdG9yR2VuZXJhdG9yIHtcclxuICAgIC8qKlxyXG4gICAgICogUHJvdmlkZXMgYSB7QGxpbmsgVG90cE11bHRpRmFjdG9yQXNzZXJ0aW9ufSB0byBjb25maXJtIG93bmVyc2hpcCBvZlxyXG4gICAgICogdGhlIFRPVFAgKHRpbWUtYmFzZWQgb25lLXRpbWUgcGFzc3dvcmQpIHNlY29uZCBmYWN0b3IuXHJcbiAgICAgKiBUaGlzIGFzc2VydGlvbiBpcyB1c2VkIHRvIGNvbXBsZXRlIGVucm9sbG1lbnQgaW4gVE9UUCBzZWNvbmQgZmFjdG9yLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzZWNyZXQgQSB7QGxpbmsgVG90cFNlY3JldH0gY29udGFpbmluZyB0aGUgc2hhcmVkIHNlY3JldCBrZXkgYW5kIG90aGVyIFRPVFAgcGFyYW1ldGVycy5cclxuICAgICAqIEBwYXJhbSBvbmVUaW1lUGFzc3dvcmQgT25lLXRpbWUgcGFzc3dvcmQgZnJvbSBUT1RQIEFwcC5cclxuICAgICAqIEByZXR1cm5zIEEge0BsaW5rIFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbn0gd2hpY2ggY2FuIGJlIHVzZWQgd2l0aFxyXG4gICAgICoge0BsaW5rIE11bHRpRmFjdG9yVXNlci5lbnJvbGx9LlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXNzZXJ0aW9uRm9yRW5yb2xsbWVudChzZWNyZXQsIG9uZVRpbWVQYXNzd29yZCkge1xyXG4gICAgICAgIHJldHVybiBUb3RwTXVsdGlGYWN0b3JBc3NlcnRpb25JbXBsLl9mcm9tU2VjcmV0KHNlY3JldCwgb25lVGltZVBhc3N3b3JkKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUHJvdmlkZXMgYSB7QGxpbmsgVG90cE11bHRpRmFjdG9yQXNzZXJ0aW9ufSB0byBjb25maXJtIG93bmVyc2hpcCBvZiB0aGUgVE9UUCBzZWNvbmQgZmFjdG9yLlxyXG4gICAgICogVGhpcyBhc3NlcnRpb24gaXMgdXNlZCB0byBjb21wbGV0ZSBzaWduSW4gd2l0aCBUT1RQIGFzIHRoZSBzZWNvbmQgZmFjdG9yLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBlbnJvbGxtZW50SWQgaWRlbnRpZmllcyB0aGUgZW5yb2xsZWQgVE9UUCBzZWNvbmQgZmFjdG9yLlxyXG4gICAgICogQHBhcmFtIG9uZVRpbWVQYXNzd29yZCBPbmUtdGltZSBwYXNzd29yZCBmcm9tIFRPVFAgQXBwLlxyXG4gICAgICogQHJldHVybnMgQSB7QGxpbmsgVG90cE11bHRpRmFjdG9yQXNzZXJ0aW9ufSB3aGljaCBjYW4gYmUgdXNlZCB3aXRoXHJcbiAgICAgKiB7QGxpbmsgTXVsdGlGYWN0b3JSZXNvbHZlci5yZXNvbHZlU2lnbklufS5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGFzc2VydGlvbkZvclNpZ25JbihlbnJvbGxtZW50SWQsIG9uZVRpbWVQYXNzd29yZCkge1xyXG4gICAgICAgIHJldHVybiBUb3RwTXVsdGlGYWN0b3JBc3NlcnRpb25JbXBsLl9mcm9tRW5yb2xsbWVudElkKGVucm9sbG1lbnRJZCwgb25lVGltZVBhc3N3b3JkKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIHByb21pc2UgdG8ge0BsaW5rIFRvdHBTZWNyZXR9IHdoaWNoIGNvbnRhaW5zIHRoZSBUT1RQIHNoYXJlZCBzZWNyZXQga2V5IGFuZCBvdGhlciBwYXJhbWV0ZXJzLlxyXG4gICAgICogQ3JlYXRlcyBhIFRPVFAgc2VjcmV0IGFzIHBhcnQgb2YgZW5yb2xsaW5nIGEgVE9UUCBzZWNvbmQgZmFjdG9yLlxyXG4gICAgICogVXNlZCBmb3IgZ2VuZXJhdGluZyBhIFFSIGNvZGUgVVJMIG9yIGlucHV0dGluZyBpbnRvIGEgVE9UUCBhcHAuXHJcbiAgICAgKiBUaGlzIG1ldGhvZCB1c2VzIHRoZSBhdXRoIGluc3RhbmNlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHVzZXIgaW4gdGhlIG11bHRpRmFjdG9yU2Vzc2lvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc2Vzc2lvbiBUaGUge0BsaW5rIE11bHRpRmFjdG9yU2Vzc2lvbn0gdGhhdCB0aGUgdXNlciBpcyBwYXJ0IG9mLlxyXG4gICAgICogQHJldHVybnMgQSBwcm9taXNlIHRvIHtAbGluayBUb3RwU2VjcmV0fS5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGFzeW5jIGdlbmVyYXRlU2VjcmV0KHNlc3Npb24pIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3QgbWZhU2Vzc2lvbiA9IHNlc3Npb247XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgKChfYSA9IG1mYVNlc3Npb24udXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmF1dGgpICE9PSAndW5kZWZpbmVkJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc3RhcnRFbnJvbGxUb3RwTWZhKG1mYVNlc3Npb24udXNlci5hdXRoLCB7XHJcbiAgICAgICAgICAgIGlkVG9rZW46IG1mYVNlc3Npb24uY3JlZGVudGlhbCxcclxuICAgICAgICAgICAgdG90cEVucm9sbG1lbnRJbmZvOiB7fVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBUb3RwU2VjcmV0Ll9mcm9tU3RhcnRUb3RwTWZhRW5yb2xsbWVudFJlc3BvbnNlKHJlc3BvbnNlLCBtZmFTZXNzaW9uLnVzZXIuYXV0aCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBUT1RQIHNlY29uZCBmYWN0b3I6IGB0b3RwYC5cclxuICovXHJcblRvdHBNdWx0aUZhY3RvckdlbmVyYXRvci5GQUNUT1JfSUQgPSBcInRvdHBcIiAvKiBGYWN0b3JJZC5UT1RQICovO1xyXG5jbGFzcyBUb3RwTXVsdGlGYWN0b3JBc3NlcnRpb25JbXBsIGV4dGVuZHMgTXVsdGlGYWN0b3JBc3NlcnRpb25JbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKG90cCwgZW5yb2xsbWVudElkLCBzZWNyZXQpIHtcclxuICAgICAgICBzdXBlcihcInRvdHBcIiAvKiBGYWN0b3JJZC5UT1RQICovKTtcclxuICAgICAgICB0aGlzLm90cCA9IG90cDtcclxuICAgICAgICB0aGlzLmVucm9sbG1lbnRJZCA9IGVucm9sbG1lbnRJZDtcclxuICAgICAgICB0aGlzLnNlY3JldCA9IHNlY3JldDtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbVNlY3JldChzZWNyZXQsIG90cCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgVG90cE11bHRpRmFjdG9yQXNzZXJ0aW9uSW1wbChvdHAsIHVuZGVmaW5lZCwgc2VjcmV0KTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbUVucm9sbG1lbnRJZChlbnJvbGxtZW50SWQsIG90cCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgVG90cE11bHRpRmFjdG9yQXNzZXJ0aW9uSW1wbChvdHAsIGVucm9sbG1lbnRJZCk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBhc3luYyBfZmluYWxpemVFbnJvbGwoYXV0aCwgaWRUb2tlbiwgZGlzcGxheU5hbWUpIHtcclxuICAgICAgICBfYXNzZXJ0KHR5cGVvZiB0aGlzLnNlY3JldCAhPT0gJ3VuZGVmaW5lZCcsIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gZmluYWxpemVFbnJvbGxUb3RwTWZhKGF1dGgsIHtcclxuICAgICAgICAgICAgaWRUb2tlbixcclxuICAgICAgICAgICAgZGlzcGxheU5hbWUsXHJcbiAgICAgICAgICAgIHRvdHBWZXJpZmljYXRpb25JbmZvOiB0aGlzLnNlY3JldC5fbWFrZVRvdHBWZXJpZmljYXRpb25JbmZvKHRoaXMub3RwKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgYXN5bmMgX2ZpbmFsaXplU2lnbkluKGF1dGgsIG1mYVBlbmRpbmdDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgX2Fzc2VydCh0aGlzLmVucm9sbG1lbnRJZCAhPT0gdW5kZWZpbmVkICYmIHRoaXMub3RwICE9PSB1bmRlZmluZWQsIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICBjb25zdCB0b3RwVmVyaWZpY2F0aW9uSW5mbyA9IHsgdmVyaWZpY2F0aW9uQ29kZTogdGhpcy5vdHAgfTtcclxuICAgICAgICByZXR1cm4gZmluYWxpemVTaWduSW5Ub3RwTWZhKGF1dGgsIHtcclxuICAgICAgICAgICAgbWZhUGVuZGluZ0NyZWRlbnRpYWwsXHJcbiAgICAgICAgICAgIG1mYUVucm9sbG1lbnRJZDogdGhpcy5lbnJvbGxtZW50SWQsXHJcbiAgICAgICAgICAgIHRvdHBWZXJpZmljYXRpb25JbmZvXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIGEge0BsaW5rIFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbn0uXHJcbiAqXHJcbiAqIFN0b3JlcyB0aGUgc2hhcmVkIHNlY3JldCBrZXkgYW5kIG90aGVyIHBhcmFtZXRlcnMgdG8gZ2VuZXJhdGUgdGltZS1iYXNlZCBPVFBzLlxyXG4gKiBJbXBsZW1lbnRzIG1ldGhvZHMgdG8gcmV0cmlldmUgdGhlIHNoYXJlZCBzZWNyZXQga2V5IGFuZCBnZW5lcmF0ZSBhIFFSIGNvZGUgVVJMLlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBUb3RwU2VjcmV0IHtcclxuICAgIC8vIFRoZSBwdWJsaWMgbWVtYmVycyBhcmUgZGVjbGFyZWQgb3V0c2lkZSB0aGUgY29uc3RydWN0b3Igc28gdGhlIGRvY3MgY2FuIGJlIGdlbmVyYXRlZC5cclxuICAgIGNvbnN0cnVjdG9yKHNlY3JldEtleSwgaGFzaGluZ0FsZ29yaXRobSwgY29kZUxlbmd0aCwgY29kZUludGVydmFsU2Vjb25kcywgZW5yb2xsbWVudENvbXBsZXRpb25EZWFkbGluZSwgc2Vzc2lvbkluZm8sIGF1dGgpIHtcclxuICAgICAgICB0aGlzLnNlc3Npb25JbmZvID0gc2Vzc2lvbkluZm87XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLnNlY3JldEtleSA9IHNlY3JldEtleTtcclxuICAgICAgICB0aGlzLmhhc2hpbmdBbGdvcml0aG0gPSBoYXNoaW5nQWxnb3JpdGhtO1xyXG4gICAgICAgIHRoaXMuY29kZUxlbmd0aCA9IGNvZGVMZW5ndGg7XHJcbiAgICAgICAgdGhpcy5jb2RlSW50ZXJ2YWxTZWNvbmRzID0gY29kZUludGVydmFsU2Vjb25kcztcclxuICAgICAgICB0aGlzLmVucm9sbG1lbnRDb21wbGV0aW9uRGVhZGxpbmUgPSBlbnJvbGxtZW50Q29tcGxldGlvbkRlYWRsaW5lO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIF9mcm9tU3RhcnRUb3RwTWZhRW5yb2xsbWVudFJlc3BvbnNlKHJlc3BvbnNlLCBhdXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBUb3RwU2VjcmV0KHJlc3BvbnNlLnRvdHBTZXNzaW9uSW5mby5zaGFyZWRTZWNyZXRLZXksIHJlc3BvbnNlLnRvdHBTZXNzaW9uSW5mby5oYXNoaW5nQWxnb3JpdGhtLCByZXNwb25zZS50b3RwU2Vzc2lvbkluZm8udmVyaWZpY2F0aW9uQ29kZUxlbmd0aCwgcmVzcG9uc2UudG90cFNlc3Npb25JbmZvLnBlcmlvZFNlYywgbmV3IERhdGUocmVzcG9uc2UudG90cFNlc3Npb25JbmZvLmZpbmFsaXplRW5yb2xsbWVudFRpbWUpLnRvVVRDU3RyaW5nKCksIHJlc3BvbnNlLnRvdHBTZXNzaW9uSW5mby5zZXNzaW9uSW5mbywgYXV0aCk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfbWFrZVRvdHBWZXJpZmljYXRpb25JbmZvKG90cCkge1xyXG4gICAgICAgIHJldHVybiB7IHNlc3Npb25JbmZvOiB0aGlzLnNlc3Npb25JbmZvLCB2ZXJpZmljYXRpb25Db2RlOiBvdHAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIFFSIGNvZGUgVVJMIGFzIGRlc2NyaWJlZCBpblxyXG4gICAgICogaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9nb29nbGUtYXV0aGVudGljYXRvci93aWtpL0tleS1VcmktRm9ybWF0XHJcbiAgICAgKiBUaGlzIGNhbiBiZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIgYXMgYSBRUiBjb2RlIHRvIGJlIHNjYW5uZWQgaW50byBhIFRPVFAgYXBwIGxpa2UgR29vZ2xlIEF1dGhlbnRpY2F0b3IuXHJcbiAgICAgKiBJZiB0aGUgb3B0aW9uYWwgcGFyYW1ldGVycyBhcmUgdW5zcGVjaWZpZWQsIGFuIGFjY291bnROYW1lIG9mIDx1c2VyRW1haWw+IGFuZCBpc3N1ZXIgb2YgPGZpcmViYXNlQXBwTmFtZT4gYXJlIHVzZWQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFjY291bnROYW1lIHRoZSBuYW1lIG9mIHRoZSBhY2NvdW50L2FwcCBhbG9uZyB3aXRoIGEgdXNlciBpZGVudGlmaWVyLlxyXG4gICAgICogQHBhcmFtIGlzc3VlciBpc3N1ZXIgb2YgdGhlIFRPVFAgKGxpa2VseSB0aGUgYXBwIG5hbWUpLlxyXG4gICAgICogQHJldHVybnMgQSBRUiBjb2RlIFVSTCBzdHJpbmcuXHJcbiAgICAgKi9cclxuICAgIGdlbmVyYXRlUXJDb2RlVXJsKGFjY291bnROYW1lLCBpc3N1ZXIpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgbGV0IHVzZURlZmF1bHRzID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKF9pc0VtcHR5U3RyaW5nKGFjY291bnROYW1lKSB8fCBfaXNFbXB0eVN0cmluZyhpc3N1ZXIpKSB7XHJcbiAgICAgICAgICAgIHVzZURlZmF1bHRzID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHVzZURlZmF1bHRzKSB7XHJcbiAgICAgICAgICAgIGlmIChfaXNFbXB0eVN0cmluZyhhY2NvdW50TmFtZSkpIHtcclxuICAgICAgICAgICAgICAgIGFjY291bnROYW1lID0gKChfYSA9IHRoaXMuYXV0aC5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVtYWlsKSB8fCAndW5rbm93bnVzZXInO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChfaXNFbXB0eVN0cmluZyhpc3N1ZXIpKSB7XHJcbiAgICAgICAgICAgICAgICBpc3N1ZXIgPSB0aGlzLmF1dGgubmFtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYG90cGF1dGg6Ly90b3RwLyR7aXNzdWVyfToke2FjY291bnROYW1lfT9zZWNyZXQ9JHt0aGlzLnNlY3JldEtleX0maXNzdWVyPSR7aXNzdWVyfSZhbGdvcml0aG09JHt0aGlzLmhhc2hpbmdBbGdvcml0aG19JmRpZ2l0cz0ke3RoaXMuY29kZUxlbmd0aH1gO1xyXG4gICAgfVxyXG59XHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuZnVuY3Rpb24gX2lzRW1wdHlTdHJpbmcoaW5wdXQpIHtcclxuICAgIHJldHVybiB0eXBlb2YgaW5wdXQgPT09ICd1bmRlZmluZWQnIHx8IChpbnB1dCA9PT0gbnVsbCB8fCBpbnB1dCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaW5wdXQubGVuZ3RoKSA9PT0gMDtcclxufVxuXG52YXIgbmFtZSA9IFwiQGZpcmViYXNlL2F1dGhcIjtcbnZhciB2ZXJzaW9uID0gXCIxLjcuOVwiO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBBdXRoSW50ZXJvcCB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgZ2V0VWlkKCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmF1dGguY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRUb2tlbihmb3JjZVJlZnJlc2gpIHtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5hdXRoLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICAgICAgaWYgKCF0aGlzLmF1dGguY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgdGhpcy5hdXRoLmN1cnJlbnRVc2VyLmdldElkVG9rZW4oZm9yY2VSZWZyZXNoKTtcclxuICAgICAgICByZXR1cm4geyBhY2Nlc3NUb2tlbiB9O1xyXG4gICAgfVxyXG4gICAgYWRkQXV0aFRva2VuTGlzdGVuZXIobGlzdGVuZXIpIHtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuaGFzKGxpc3RlbmVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gdGhpcy5hdXRoLm9uSWRUb2tlbkNoYW5nZWQodXNlciA9PiB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIuc3RzVG9rZW5NYW5hZ2VyLmFjY2Vzc1Rva2VuKSB8fCBudWxsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzLnNldChsaXN0ZW5lciwgdW5zdWJzY3JpYmUpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgfVxyXG4gICAgcmVtb3ZlQXV0aFRva2VuTGlzdGVuZXIobGlzdGVuZXIpIHtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSB0aGlzLmludGVybmFsTGlzdGVuZXJzLmdldChsaXN0ZW5lcik7XHJcbiAgICAgICAgaWYgKCF1bnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuZGVsZXRlKGxpc3RlbmVyKTtcclxuICAgICAgICB1bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgfVxyXG4gICAgYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKSB7XHJcbiAgICAgICAgX2Fzc2VydCh0aGlzLmF1dGguX2luaXRpYWxpemF0aW9uUHJvbWlzZSwgXCJkZXBlbmRlbnQtc2RrLWluaXRpYWxpemVkLWJlZm9yZS1hdXRoXCIgLyogQXV0aEVycm9yQ29kZS5ERVBFTkRFTlRfU0RLX0lOSVRfQkVGT1JFX0FVVEggKi8pO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnRlcm5hbExpc3RlbmVycy5zaXplID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmF1dGguX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hdXRoLl9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRWZXJzaW9uRm9yUGxhdGZvcm0oY2xpZW50UGxhdGZvcm0pIHtcclxuICAgIHN3aXRjaCAoY2xpZW50UGxhdGZvcm0pIHtcclxuICAgICAgICBjYXNlIFwiTm9kZVwiIC8qIENsaWVudFBsYXRmb3JtLk5PREUgKi86XHJcbiAgICAgICAgICAgIHJldHVybiAnbm9kZSc7XHJcbiAgICAgICAgY2FzZSBcIlJlYWN0TmF0aXZlXCIgLyogQ2xpZW50UGxhdGZvcm0uUkVBQ1RfTkFUSVZFICovOlxyXG4gICAgICAgICAgICByZXR1cm4gJ3JuJztcclxuICAgICAgICBjYXNlIFwiV29ya2VyXCIgLyogQ2xpZW50UGxhdGZvcm0uV09SS0VSICovOlxyXG4gICAgICAgICAgICByZXR1cm4gJ3dlYndvcmtlcic7XHJcbiAgICAgICAgY2FzZSBcIkNvcmRvdmFcIiAvKiBDbGllbnRQbGF0Zm9ybS5DT1JET1ZBICovOlxyXG4gICAgICAgICAgICByZXR1cm4gJ2NvcmRvdmEnO1xyXG4gICAgICAgIGNhc2UgXCJXZWJFeHRlbnNpb25cIiAvKiBDbGllbnRQbGF0Zm9ybS5XRUJfRVhURU5TSU9OICovOlxyXG4gICAgICAgICAgICByZXR1cm4gJ3dlYi1leHRlbnNpb24nO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbn1cclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5mdW5jdGlvbiByZWdpc3RlckF1dGgoY2xpZW50UGxhdGZvcm0pIHtcclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KFwiYXV0aFwiIC8qIF9Db21wb25lbnROYW1lLkFVVEggKi8sIChjb250YWluZXIsIHsgb3B0aW9uczogZGVwcyB9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXBwID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTtcclxuICAgICAgICBjb25zdCBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2hlYXJ0YmVhdCcpO1xyXG4gICAgICAgIGNvbnN0IGFwcENoZWNrU2VydmljZVByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAtY2hlY2staW50ZXJuYWwnKTtcclxuICAgICAgICBjb25zdCB7IGFwaUtleSwgYXV0aERvbWFpbiB9ID0gYXBwLm9wdGlvbnM7XHJcbiAgICAgICAgX2Fzc2VydChhcGlLZXkgJiYgIWFwaUtleS5pbmNsdWRlcygnOicpLCBcImludmFsaWQtYXBpLWtleVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUElfS0VZICovLCB7IGFwcE5hbWU6IGFwcC5uYW1lIH0pO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHtcclxuICAgICAgICAgICAgYXBpS2V5LFxyXG4gICAgICAgICAgICBhdXRoRG9tYWluLFxyXG4gICAgICAgICAgICBjbGllbnRQbGF0Zm9ybSxcclxuICAgICAgICAgICAgYXBpSG9zdDogXCJpZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb21cIiAvKiBEZWZhdWx0Q29uZmlnLkFQSV9IT1NUICovLFxyXG4gICAgICAgICAgICB0b2tlbkFwaUhvc3Q6IFwic2VjdXJldG9rZW4uZ29vZ2xlYXBpcy5jb21cIiAvKiBEZWZhdWx0Q29uZmlnLlRPS0VOX0FQSV9IT1NUICovLFxyXG4gICAgICAgICAgICBhcGlTY2hlbWU6IFwiaHR0cHNcIiAvKiBEZWZhdWx0Q29uZmlnLkFQSV9TQ0hFTUUgKi8sXHJcbiAgICAgICAgICAgIHNka0NsaWVudFZlcnNpb246IF9nZXRDbGllbnRWZXJzaW9uKGNsaWVudFBsYXRmb3JtKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgYXV0aEluc3RhbmNlID0gbmV3IEF1dGhJbXBsKGFwcCwgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyLCBhcHBDaGVja1NlcnZpY2VQcm92aWRlciwgY29uZmlnKTtcclxuICAgICAgICBfaW5pdGlhbGl6ZUF1dGhJbnN0YW5jZShhdXRoSW5zdGFuY2UsIGRlcHMpO1xyXG4gICAgICAgIHJldHVybiBhdXRoSW5zdGFuY2U7XHJcbiAgICB9LCBcIlBVQkxJQ1wiIC8qIENvbXBvbmVudFR5cGUuUFVCTElDICovKVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEF1dGggY2FuIG9ubHkgYmUgaW5pdGlhbGl6ZWQgYnkgZXhwbGljaXRseSBjYWxsaW5nIGdldEF1dGgoKSBvciBpbml0aWFsaXplQXV0aCgpXHJcbiAgICAgICAgICogRm9yIHdoeSB3ZSBkbyB0aGlzLCBTZWUgZ28vZmlyZWJhc2UtbmV4dC1hdXRoLWluaXRcclxuICAgICAgICAgKi9cclxuICAgICAgICAuc2V0SW5zdGFudGlhdGlvbk1vZGUoXCJFWFBMSUNJVFwiIC8qIEluc3RhbnRpYXRpb25Nb2RlLkVYUExJQ0lUICovKVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEJlY2F1c2UgYWxsIGZpcmViYXNlIHByb2R1Y3RzIHRoYXQgZGVwZW5kIG9uIGF1dGggZGVwZW5kIG9uIGF1dGgtaW50ZXJuYWwgZGlyZWN0bHksXHJcbiAgICAgICAgICogd2UgbmVlZCB0byBpbml0aWFsaXplIGF1dGgtaW50ZXJuYWwgYWZ0ZXIgYXV0aCBpcyBpbml0aWFsaXplZCB0byBtYWtlIGl0IGF2YWlsYWJsZSB0byBvdGhlciBmaXJlYmFzZSBwcm9kdWN0cy5cclxuICAgICAgICAgKi9cclxuICAgICAgICAuc2V0SW5zdGFuY2VDcmVhdGVkQ2FsbGJhY2soKGNvbnRhaW5lciwgX2luc3RhbmNlSWRlbnRpZmllciwgX2luc3RhbmNlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXV0aEludGVybmFsUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoXCJhdXRoLWludGVybmFsXCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSF9JTlRFUk5BTCAqLyk7XHJcbiAgICAgICAgYXV0aEludGVybmFsUHJvdmlkZXIuaW5pdGlhbGl6ZSgpO1xyXG4gICAgfSkpO1xyXG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoXCJhdXRoLWludGVybmFsXCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSF9JTlRFUk5BTCAqLywgY29udGFpbmVyID0+IHtcclxuICAgICAgICBjb25zdCBhdXRoID0gX2Nhc3RBdXRoKGNvbnRhaW5lci5nZXRQcm92aWRlcihcImF1dGhcIiAvKiBfQ29tcG9uZW50TmFtZS5BVVRIICovKS5nZXRJbW1lZGlhdGUoKSk7XHJcbiAgICAgICAgcmV0dXJuIChhdXRoID0+IG5ldyBBdXRoSW50ZXJvcChhdXRoKSkoYXV0aCk7XHJcbiAgICB9LCBcIlBSSVZBVEVcIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pLnNldEluc3RhbnRpYXRpb25Nb2RlKFwiRVhQTElDSVRcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLykpO1xyXG4gICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUsIHZlcnNpb24sIGdldFZlcnNpb25Gb3JQbGF0Zm9ybShjbGllbnRQbGF0Zm9ybSkpO1xyXG4gICAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtNSwgZXNtMjAxNywgY2pzNSwgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb25cclxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uLCAnZXNtMjAxNycpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfSURfVE9LRU5fTUFYX0FHRSA9IDUgKiA2MDtcclxuY29uc3QgYXV0aElkVG9rZW5NYXhBZ2UgPSBnZXRFeHBlcmltZW50YWxTZXR0aW5nKCdhdXRoSWRUb2tlbk1heEFnZScpIHx8IERFRkFVTFRfSURfVE9LRU5fTUFYX0FHRTtcclxubGV0IGxhc3RQb3N0ZWRJZFRva2VuID0gbnVsbDtcclxuY29uc3QgbWludENvb2tpZUZhY3RvcnkgPSAodXJsKSA9PiBhc3luYyAodXNlcikgPT4ge1xyXG4gICAgY29uc3QgaWRUb2tlblJlc3VsdCA9IHVzZXIgJiYgKGF3YWl0IHVzZXIuZ2V0SWRUb2tlblJlc3VsdCgpKTtcclxuICAgIGNvbnN0IGlkVG9rZW5BZ2UgPSBpZFRva2VuUmVzdWx0ICYmXHJcbiAgICAgICAgKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gRGF0ZS5wYXJzZShpZFRva2VuUmVzdWx0Lmlzc3VlZEF0VGltZSkpIC8gMTAwMDtcclxuICAgIGlmIChpZFRva2VuQWdlICYmIGlkVG9rZW5BZ2UgPiBhdXRoSWRUb2tlbk1heEFnZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIFNwZWNpZmljYWxseSB0cmlwIG51bGwgPT4gdW5kZWZpbmVkIHdoZW4gbG9nZ2VkIG91dCwgdG8gZGVsZXRlIGFueSBleGlzdGluZyBjb29raWVcclxuICAgIGNvbnN0IGlkVG9rZW4gPSBpZFRva2VuUmVzdWx0ID09PSBudWxsIHx8IGlkVG9rZW5SZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlkVG9rZW5SZXN1bHQudG9rZW47XHJcbiAgICBpZiAobGFzdFBvc3RlZElkVG9rZW4gPT09IGlkVG9rZW4pIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsYXN0UG9zdGVkSWRUb2tlbiA9IGlkVG9rZW47XHJcbiAgICBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgICAgICBtZXRob2Q6IGlkVG9rZW4gPyAnUE9TVCcgOiAnREVMRVRFJyxcclxuICAgICAgICBoZWFkZXJzOiBpZFRva2VuXHJcbiAgICAgICAgICAgID8ge1xyXG4gICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7aWRUb2tlbn1gXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgOiB7fVxyXG4gICAgfSk7XHJcbn07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSBBdXRoIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgcHJvdmlkZWQge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9LlxyXG4gKiBJZiBubyBpbnN0YW5jZSBleGlzdHMsIGluaXRpYWxpemVzIGFuIEF1dGggaW5zdGFuY2Ugd2l0aCBwbGF0Zm9ybS1zcGVjaWZpYyBkZWZhdWx0IGRlcGVuZGVuY2llcy5cclxuICpcclxuICogQHBhcmFtIGFwcCAtIFRoZSBGaXJlYmFzZSBBcHAuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEF1dGgoYXBwID0gZ2V0QXBwKCkpIHtcclxuICAgIGNvbnN0IHByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgJ2F1dGgnKTtcclxuICAgIGlmIChwcm92aWRlci5pc0luaXRpYWxpemVkKCkpIHtcclxuICAgICAgICByZXR1cm4gcHJvdmlkZXIuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhdXRoID0gaW5pdGlhbGl6ZUF1dGgoYXBwLCB7XHJcbiAgICAgICAgcG9wdXBSZWRpcmVjdFJlc29sdmVyOiBicm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyLFxyXG4gICAgICAgIHBlcnNpc3RlbmNlOiBbXHJcbiAgICAgICAgICAgIGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UsXHJcbiAgICAgICAgICAgIGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlLFxyXG4gICAgICAgICAgICBicm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlXHJcbiAgICAgICAgXVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBhdXRoVG9rZW5TeW5jUGF0aCA9IGdldEV4cGVyaW1lbnRhbFNldHRpbmcoJ2F1dGhUb2tlblN5bmNVUkwnKTtcclxuICAgIC8vIE9ubHkgZG8gdGhlIENvb2tpZSBleGNoYW5nZSBpbiBhIHNlY3VyZSBjb250ZXh0XHJcbiAgICBpZiAoYXV0aFRva2VuU3luY1BhdGggJiZcclxuICAgICAgICB0eXBlb2YgaXNTZWN1cmVDb250ZXh0ID09PSAnYm9vbGVhbicgJiZcclxuICAgICAgICBpc1NlY3VyZUNvbnRleHQpIHtcclxuICAgICAgICAvLyBEb24ndCBhbGxvdyB1cmxzIChYU1MgcG9zc2liaWxpdHkpLCBvbmx5IHBhdGhzIG9uIHRoZSBzYW1lIGRvbWFpblxyXG4gICAgICAgIGNvbnN0IGF1dGhUb2tlblN5bmNVcmwgPSBuZXcgVVJMKGF1dGhUb2tlblN5bmNQYXRoLCBsb2NhdGlvbi5vcmlnaW4pO1xyXG4gICAgICAgIGlmIChsb2NhdGlvbi5vcmlnaW4gPT09IGF1dGhUb2tlblN5bmNVcmwub3JpZ2luKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbnRDb29raWUgPSBtaW50Q29va2llRmFjdG9yeShhdXRoVG9rZW5TeW5jVXJsLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKGF1dGgsIG1pbnRDb29raWUsICgpID0+IG1pbnRDb29raWUoYXV0aC5jdXJyZW50VXNlcikpO1xyXG4gICAgICAgICAgICBvbklkVG9rZW5DaGFuZ2VkKGF1dGgsIHVzZXIgPT4gbWludENvb2tpZSh1c2VyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgYXV0aEVtdWxhdG9ySG9zdCA9IGdldERlZmF1bHRFbXVsYXRvckhvc3QoJ2F1dGgnKTtcclxuICAgIGlmIChhdXRoRW11bGF0b3JIb3N0KSB7XHJcbiAgICAgICAgY29ubmVjdEF1dGhFbXVsYXRvcihhdXRoLCBgaHR0cDovLyR7YXV0aEVtdWxhdG9ySG9zdH1gKTtcclxuICAgIH1cclxuICAgIHJldHVybiBhdXRoO1xyXG59XHJcbmZ1bmN0aW9uIGdldFNjcmlwdFBhcmVudEVsZW1lbnQoKSB7XHJcbiAgICB2YXIgX2EsIF9iO1xyXG4gICAgcmV0dXJuIChfYiA9IChfYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJykpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogZG9jdW1lbnQ7XHJcbn1cclxuX3NldEV4dGVybmFsSlNQcm92aWRlcih7XHJcbiAgICBsb2FkSlModXJsKSB7XHJcbiAgICAgICAgLy8gVE9ETzogY29uc2lkZXIgYWRkaW5nIHRpbWVvdXQgc3VwcG9ydCAmIGNhbmNlbGxhdGlvblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XHJcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsKTtcclxuICAgICAgICAgICAgZWwub25sb2FkID0gcmVzb2x2ZTtcclxuICAgICAgICAgICAgZWwub25lcnJvciA9IGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBfY3JlYXRlRXJyb3IoXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgICAgICAgICAgZXJyb3IuY3VzdG9tRGF0YSA9IGU7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBlbC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XHJcbiAgICAgICAgICAgIGVsLmNoYXJzZXQgPSAnVVRGLTgnO1xyXG4gICAgICAgICAgICBnZXRTY3JpcHRQYXJlbnRFbGVtZW50KCkuYXBwZW5kQ2hpbGQoZWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGdhcGlTY3JpcHQ6ICdodHRwczovL2FwaXMuZ29vZ2xlLmNvbS9qcy9hcGkuanMnLFxyXG4gICAgcmVjYXB0Y2hhVjJTY3JpcHQ6ICdodHRwczovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkuanMnLFxyXG4gICAgcmVjYXB0Y2hhRW50ZXJwcmlzZVNjcmlwdDogJ2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2VudGVycHJpc2UuanM/cmVuZGVyPSdcclxufSk7XHJcbnJlZ2lzdGVyQXV0aChcIkJyb3dzZXJcIiAvKiBDbGllbnRQbGF0Zm9ybS5CUk9XU0VSICovKTtcblxuZXhwb3J0IHsgVHdpdHRlckF1dGhQcm92aWRlciBhcyAkLCBBY3Rpb25Db2RlT3BlcmF0aW9uIGFzIEEsIHVwZGF0ZUN1cnJlbnRVc2VyIGFzIEIsIHNpZ25PdXQgYXMgQywgcmV2b2tlQWNjZXNzVG9rZW4gYXMgRCwgZGVsZXRlVXNlciBhcyBFLCBGYWN0b3JJZCBhcyBGLCBkZWJ1Z0Vycm9yTWFwIGFzIEcsIHByb2RFcnJvck1hcCBhcyBILCBBVVRIX0VSUk9SX0NPREVTX01BUF9ET19OT1RfVVNFX0lOVEVSTkFMTFkgYXMgSSwgaW5pdGlhbGl6ZUF1dGggYXMgSiwgY29ubmVjdEF1dGhFbXVsYXRvciBhcyBLLCBBdXRoQ3JlZGVudGlhbCBhcyBMLCBFbWFpbEF1dGhDcmVkZW50aWFsIGFzIE0sIE9BdXRoQ3JlZGVudGlhbCBhcyBOLCBPcGVyYXRpb25UeXBlIGFzIE8sIFBob25lQXV0aFByb3ZpZGVyIGFzIFAsIFBob25lQXV0aENyZWRlbnRpYWwgYXMgUSwgUmVjYXB0Y2hhVmVyaWZpZXIgYXMgUiwgU2lnbkluTWV0aG9kIGFzIFMsIFRvdHBNdWx0aUZhY3RvckdlbmVyYXRvciBhcyBULCBpbk1lbW9yeVBlcnNpc3RlbmNlIGFzIFUsIEVtYWlsQXV0aFByb3ZpZGVyIGFzIFYsIEZhY2Vib29rQXV0aFByb3ZpZGVyIGFzIFcsIEdvb2dsZUF1dGhQcm92aWRlciBhcyBYLCBHaXRodWJBdXRoUHJvdmlkZXIgYXMgWSwgT0F1dGhQcm92aWRlciBhcyBaLCBTQU1MQXV0aFByb3ZpZGVyIGFzIF8sIGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UgYXMgYSwgc2lnbkluQW5vbnltb3VzbHkgYXMgYTAsIHNpZ25JbldpdGhDcmVkZW50aWFsIGFzIGExLCBsaW5rV2l0aENyZWRlbnRpYWwgYXMgYTIsIHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwgYXMgYTMsIHNpZ25JbldpdGhDdXN0b21Ub2tlbiBhcyBhNCwgc2VuZFBhc3N3b3JkUmVzZXRFbWFpbCBhcyBhNSwgY29uZmlybVBhc3N3b3JkUmVzZXQgYXMgYTYsIGFwcGx5QWN0aW9uQ29kZSBhcyBhNywgY2hlY2tBY3Rpb25Db2RlIGFzIGE4LCB2ZXJpZnlQYXNzd29yZFJlc2V0Q29kZSBhcyBhOSwgX2lzSU9TN09yOCBhcyBhQSwgX2NyZWF0ZUVycm9yIGFzIGFCLCBfYXNzZXJ0IGFzIGFDLCBBdXRoRXZlbnRNYW5hZ2VyIGFzIGFELCBfZ2V0SW5zdGFuY2UgYXMgYUUsIF9wZXJzaXN0ZW5jZUtleU5hbWUgYXMgYUYsIF9nZXRSZWRpcmVjdFJlc3VsdCBhcyBhRywgX292ZXJyaWRlUmVkaXJlY3RSZXN1bHQgYXMgYUgsIF9jbGVhclJlZGlyZWN0T3V0Y29tZXMgYXMgYUksIF9jYXN0QXV0aCBhcyBhSiwgVXNlckltcGwgYXMgYUssIEF1dGhJbXBsIGFzIGFMLCBfZ2V0Q2xpZW50VmVyc2lvbiBhcyBhTSwgX2dlbmVyYXRlRXZlbnRJZCBhcyBhTiwgQXV0aFBvcHVwIGFzIGFPLCBGZXRjaFByb3ZpZGVyIGFzIGFQLCBTQU1MQXV0aENyZWRlbnRpYWwgYXMgYVEsIGNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZCBhcyBhYSwgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQgYXMgYWIsIHNlbmRTaWduSW5MaW5rVG9FbWFpbCBhcyBhYywgaXNTaWduSW5XaXRoRW1haWxMaW5rIGFzIGFkLCBzaWduSW5XaXRoRW1haWxMaW5rIGFzIGFlLCBmZXRjaFNpZ25Jbk1ldGhvZHNGb3JFbWFpbCBhcyBhZiwgc2VuZEVtYWlsVmVyaWZpY2F0aW9uIGFzIGFnLCB2ZXJpZnlCZWZvcmVVcGRhdGVFbWFpbCBhcyBhaCwgQWN0aW9uQ29kZVVSTCBhcyBhaSwgcGFyc2VBY3Rpb25Db2RlVVJMIGFzIGFqLCB1cGRhdGVQcm9maWxlIGFzIGFrLCB1cGRhdGVFbWFpbCBhcyBhbCwgdXBkYXRlUGFzc3dvcmQgYXMgYW0sIGdldElkVG9rZW4gYXMgYW4sIGdldElkVG9rZW5SZXN1bHQgYXMgYW8sIHVubGluayBhcyBhcCwgZ2V0QWRkaXRpb25hbFVzZXJJbmZvIGFzIGFxLCByZWxvYWQgYXMgYXIsIGdldE11bHRpRmFjdG9yUmVzb2x2ZXIgYXMgYXMsIG11bHRpRmFjdG9yIGFzIGF0LCBkZWJ1Z0Fzc2VydCBhcyBhdSwgX2lzSU9TIGFzIGF2LCBfaXNBbmRyb2lkIGFzIGF3LCBfZmFpbCBhcyBheCwgX2dldFJlZGlyZWN0VXJsIGFzIGF5LCBfZ2V0UHJvamVjdENvbmZpZyBhcyBheiwgYnJvd3NlckxvY2FsUGVyc2lzdGVuY2UgYXMgYiwgc2lnbkluV2l0aFBvcHVwIGFzIGMsIGxpbmtXaXRoUG9wdXAgYXMgZCwgcmVhdXRoZW50aWNhdGVXaXRoUG9wdXAgYXMgZSwgc2lnbkluV2l0aFJlZGlyZWN0IGFzIGYsIGxpbmtXaXRoUmVkaXJlY3QgYXMgZywgcmVhdXRoZW50aWNhdGVXaXRoUmVkaXJlY3QgYXMgaCwgaW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZSBhcyBpLCBnZXRSZWRpcmVjdFJlc3VsdCBhcyBqLCBicm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyIGFzIGssIGxpbmtXaXRoUGhvbmVOdW1iZXIgYXMgbCwgUGhvbmVNdWx0aUZhY3RvckdlbmVyYXRvciBhcyBtLCBUb3RwU2VjcmV0IGFzIG4sIGdldEF1dGggYXMgbywgUHJvdmlkZXJJZCBhcyBwLCBzZXRQZXJzaXN0ZW5jZSBhcyBxLCByZWF1dGhlbnRpY2F0ZVdpdGhQaG9uZU51bWJlciBhcyByLCBzaWduSW5XaXRoUGhvbmVOdW1iZXIgYXMgcywgaW5pdGlhbGl6ZVJlY2FwdGNoYUNvbmZpZyBhcyB0LCB1cGRhdGVQaG9uZU51bWJlciBhcyB1LCB2YWxpZGF0ZVBhc3N3b3JkIGFzIHYsIG9uSWRUb2tlbkNoYW5nZWQgYXMgdywgYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZCBhcyB4LCBvbkF1dGhTdGF0ZUNoYW5nZWQgYXMgeSwgdXNlRGV2aWNlTGFuZ3VhZ2UgYXMgeiB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgtNjg2MDJkMjQuanMubWFwXG4iLCJ2YXIgY29tbW9uanNHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB7fTtcblxudmFyIGJsb29tX2Jsb2JfZXMyMDE4ID0ge307XG5cbi8qKiBAbGljZW5zZVxuQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cblNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4qL1xuXG52YXIgSW50ZWdlcjtcbnZhciBNZDU7XG4oZnVuY3Rpb24oKSB7dmFyIGg7LyoqIEBsaWNlbnNlXG5cbiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4qL1xuZnVuY3Rpb24gayhmLGEpe2Z1bmN0aW9uIGMoKXt9Yy5wcm90b3R5cGU9YS5wcm90b3R5cGU7Zi5EPWEucHJvdG90eXBlO2YucHJvdG90eXBlPW5ldyBjO2YucHJvdG90eXBlLmNvbnN0cnVjdG9yPWY7Zi5DPWZ1bmN0aW9uKGQsZSxnKXtmb3IodmFyIGI9QXJyYXkoYXJndW1lbnRzLmxlbmd0aC0yKSxyPTI7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyliW3ItMl09YXJndW1lbnRzW3JdO3JldHVybiBhLnByb3RvdHlwZVtlXS5hcHBseShkLGIpfTt9ZnVuY3Rpb24gbCgpe3RoaXMuYmxvY2tTaXplPS0xO31mdW5jdGlvbiBtKCl7dGhpcy5ibG9ja1NpemU9LTE7dGhpcy5ibG9ja1NpemU9NjQ7dGhpcy5nPUFycmF5KDQpO3RoaXMuQj1BcnJheSh0aGlzLmJsb2NrU2l6ZSk7dGhpcy5vPXRoaXMuaD0wO3RoaXMucygpO31rKG0sbCk7bS5wcm90b3R5cGUucz1mdW5jdGlvbigpe3RoaXMuZ1swXT0xNzMyNTg0MTkzO3RoaXMuZ1sxXT00MDIzMjMzNDE3O3RoaXMuZ1syXT0yNTYyMzgzMTAyO3RoaXMuZ1szXT0yNzE3MzM4Nzg7dGhpcy5vPXRoaXMuaD0wO307XG5mdW5jdGlvbiBuKGYsYSxjKXtjfHwoYz0wKTt2YXIgZD1BcnJheSgxNik7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKWZvcih2YXIgZT0wOzE2PmU7KytlKWRbZV09YS5jaGFyQ29kZUF0KGMrKyl8YS5jaGFyQ29kZUF0KGMrKyk8PDh8YS5jaGFyQ29kZUF0KGMrKyk8PDE2fGEuY2hhckNvZGVBdChjKyspPDwyNDtlbHNlIGZvcihlPTA7MTY+ZTsrK2UpZFtlXT1hW2MrK118YVtjKytdPDw4fGFbYysrXTw8MTZ8YVtjKytdPDwyNDthPWYuZ1swXTtjPWYuZ1sxXTtlPWYuZ1syXTt2YXIgZz1mLmdbM107dmFyIGI9YSsoZ15jJihlXmcpKStkWzBdKzM2MTQwOTAzNjAmNDI5NDk2NzI5NTthPWMrKGI8PDcmNDI5NDk2NzI5NXxiPj4+MjUpO2I9ZysoZV5hJihjXmUpKStkWzFdKzM5MDU0MDI3MTAmNDI5NDk2NzI5NTtnPWErKGI8PDEyJjQyOTQ5NjcyOTV8Yj4+PjIwKTtiPWUrKGNeZyYoYV5jKSkrZFsyXSs2MDYxMDU4MTkmNDI5NDk2NzI5NTtlPWcrKGI8PDE3JjQyOTQ5NjcyOTV8Yj4+PjE1KTtcbmI9YysoYV5lJihnXmEpKStkWzNdKzMyNTA0NDE5NjYmNDI5NDk2NzI5NTtjPWUrKGI8PDIyJjQyOTQ5NjcyOTV8Yj4+PjEwKTtiPWErKGdeYyYoZV5nKSkrZFs0XSs0MTE4NTQ4Mzk5JjQyOTQ5NjcyOTU7YT1jKyhiPDw3JjQyOTQ5NjcyOTV8Yj4+PjI1KTtiPWcrKGVeYSYoY15lKSkrZFs1XSsxMjAwMDgwNDI2JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMiY0Mjk0OTY3Mjk1fGI+Pj4yMCk7Yj1lKyhjXmcmKGFeYykpK2RbNl0rMjgyMTczNTk1NSY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTcmNDI5NDk2NzI5NXxiPj4+MTUpO2I9YysoYV5lJihnXmEpKStkWzddKzQyNDkyNjEzMTMmNDI5NDk2NzI5NTtjPWUrKGI8PDIyJjQyOTQ5NjcyOTV8Yj4+PjEwKTtiPWErKGdeYyYoZV5nKSkrZFs4XSsxNzcwMDM1NDE2JjQyOTQ5NjcyOTU7YT1jKyhiPDw3JjQyOTQ5NjcyOTV8Yj4+PjI1KTtiPWcrKGVeYSYoY15lKSkrZFs5XSsyMzM2NTUyODc5JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMiY0Mjk0OTY3Mjk1fFxuYj4+PjIwKTtiPWUrKGNeZyYoYV5jKSkrZFsxMF0rNDI5NDkyNTIzMyY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTcmNDI5NDk2NzI5NXxiPj4+MTUpO2I9YysoYV5lJihnXmEpKStkWzExXSsyMzA0NTYzMTM0JjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMiY0Mjk0OTY3Mjk1fGI+Pj4xMCk7Yj1hKyhnXmMmKGVeZykpK2RbMTJdKzE4MDQ2MDM2ODImNDI5NDk2NzI5NTthPWMrKGI8PDcmNDI5NDk2NzI5NXxiPj4+MjUpO2I9ZysoZV5hJihjXmUpKStkWzEzXSs0MjU0NjI2MTk1JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMiY0Mjk0OTY3Mjk1fGI+Pj4yMCk7Yj1lKyhjXmcmKGFeYykpK2RbMTRdKzI3OTI5NjUwMDYmNDI5NDk2NzI5NTtlPWcrKGI8PDE3JjQyOTQ5NjcyOTV8Yj4+PjE1KTtiPWMrKGFeZSYoZ15hKSkrZFsxNV0rMTIzNjUzNTMyOSY0Mjk0OTY3Mjk1O2M9ZSsoYjw8MjImNDI5NDk2NzI5NXxiPj4+MTApO2I9YSsoZV5nJihjXmUpKStkWzFdKzQxMjkxNzA3ODYmNDI5NDk2NzI5NTthPWMrKGI8PFxuNSY0Mjk0OTY3Mjk1fGI+Pj4yNyk7Yj1nKyhjXmUmKGFeYykpK2RbNl0rMzIyNTQ2NTY2NCY0Mjk0OTY3Mjk1O2c9YSsoYjw8OSY0Mjk0OTY3Mjk1fGI+Pj4yMyk7Yj1lKyhhXmMmKGdeYSkpK2RbMTFdKzY0MzcxNzcxMyY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTQmNDI5NDk2NzI5NXxiPj4+MTgpO2I9YysoZ15hJihlXmcpKStkWzBdKzM5MjEwNjk5OTQmNDI5NDk2NzI5NTtjPWUrKGI8PDIwJjQyOTQ5NjcyOTV8Yj4+PjEyKTtiPWErKGVeZyYoY15lKSkrZFs1XSszNTkzNDA4NjA1JjQyOTQ5NjcyOTU7YT1jKyhiPDw1JjQyOTQ5NjcyOTV8Yj4+PjI3KTtiPWcrKGNeZSYoYV5jKSkrZFsxMF0rMzgwMTYwODMmNDI5NDk2NzI5NTtnPWErKGI8PDkmNDI5NDk2NzI5NXxiPj4+MjMpO2I9ZSsoYV5jJihnXmEpKStkWzE1XSszNjM0NDg4OTYxJjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNCY0Mjk0OTY3Mjk1fGI+Pj4xOCk7Yj1jKyhnXmEmKGVeZykpK2RbNF0rMzg4OTQyOTQ0OCY0Mjk0OTY3Mjk1O2M9XG5lKyhiPDwyMCY0Mjk0OTY3Mjk1fGI+Pj4xMik7Yj1hKyhlXmcmKGNeZSkpK2RbOV0rNTY4NDQ2NDM4JjQyOTQ5NjcyOTU7YT1jKyhiPDw1JjQyOTQ5NjcyOTV8Yj4+PjI3KTtiPWcrKGNeZSYoYV5jKSkrZFsxNF0rMzI3NTE2MzYwNiY0Mjk0OTY3Mjk1O2c9YSsoYjw8OSY0Mjk0OTY3Mjk1fGI+Pj4yMyk7Yj1lKyhhXmMmKGdeYSkpK2RbM10rNDEwNzYwMzMzNSY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTQmNDI5NDk2NzI5NXxiPj4+MTgpO2I9YysoZ15hJihlXmcpKStkWzhdKzExNjM1MzE1MDEmNDI5NDk2NzI5NTtjPWUrKGI8PDIwJjQyOTQ5NjcyOTV8Yj4+PjEyKTtiPWErKGVeZyYoY15lKSkrZFsxM10rMjg1MDI4NTgyOSY0Mjk0OTY3Mjk1O2E9YysoYjw8NSY0Mjk0OTY3Mjk1fGI+Pj4yNyk7Yj1nKyhjXmUmKGFeYykpK2RbMl0rNDI0MzU2MzUxMiY0Mjk0OTY3Mjk1O2c9YSsoYjw8OSY0Mjk0OTY3Mjk1fGI+Pj4yMyk7Yj1lKyhhXmMmKGdeYSkpK2RbN10rMTczNTMyODQ3MyY0Mjk0OTY3Mjk1O1xuZT1nKyhiPDwxNCY0Mjk0OTY3Mjk1fGI+Pj4xOCk7Yj1jKyhnXmEmKGVeZykpK2RbMTJdKzIzNjgzNTk1NjImNDI5NDk2NzI5NTtjPWUrKGI8PDIwJjQyOTQ5NjcyOTV8Yj4+PjEyKTtiPWErKGNeZV5nKStkWzVdKzQyOTQ1ODg3MzgmNDI5NDk2NzI5NTthPWMrKGI8PDQmNDI5NDk2NzI5NXxiPj4+MjgpO2I9ZysoYV5jXmUpK2RbOF0rMjI3MjM5MjgzMyY0Mjk0OTY3Mjk1O2c9YSsoYjw8MTEmNDI5NDk2NzI5NXxiPj4+MjEpO2I9ZSsoZ15hXmMpK2RbMTFdKzE4MzkwMzA1NjImNDI5NDk2NzI5NTtlPWcrKGI8PDE2JjQyOTQ5NjcyOTV8Yj4+PjE2KTtiPWMrKGVeZ15hKStkWzE0XSs0MjU5NjU3NzQwJjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMyY0Mjk0OTY3Mjk1fGI+Pj45KTtiPWErKGNeZV5nKStkWzFdKzI3NjM5NzUyMzYmNDI5NDk2NzI5NTthPWMrKGI8PDQmNDI5NDk2NzI5NXxiPj4+MjgpO2I9ZysoYV5jXmUpK2RbNF0rMTI3Mjg5MzM1MyY0Mjk0OTY3Mjk1O2c9YSsoYjw8MTEmNDI5NDk2NzI5NXxcbmI+Pj4yMSk7Yj1lKyhnXmFeYykrZFs3XSs0MTM5NDY5NjY0JjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNiY0Mjk0OTY3Mjk1fGI+Pj4xNik7Yj1jKyhlXmdeYSkrZFsxMF0rMzIwMDIzNjY1NiY0Mjk0OTY3Mjk1O2M9ZSsoYjw8MjMmNDI5NDk2NzI5NXxiPj4+OSk7Yj1hKyhjXmVeZykrZFsxM10rNjgxMjc5MTc0JjQyOTQ5NjcyOTU7YT1jKyhiPDw0JjQyOTQ5NjcyOTV8Yj4+PjI4KTtiPWcrKGFeY15lKStkWzBdKzM5MzY0MzAwNzQmNDI5NDk2NzI5NTtnPWErKGI8PDExJjQyOTQ5NjcyOTV8Yj4+PjIxKTtiPWUrKGdeYV5jKStkWzNdKzM1NzI0NDUzMTcmNDI5NDk2NzI5NTtlPWcrKGI8PDE2JjQyOTQ5NjcyOTV8Yj4+PjE2KTtiPWMrKGVeZ15hKStkWzZdKzc2MDI5MTg5JjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMyY0Mjk0OTY3Mjk1fGI+Pj45KTtiPWErKGNeZV5nKStkWzldKzM2NTQ2MDI4MDkmNDI5NDk2NzI5NTthPWMrKGI8PDQmNDI5NDk2NzI5NXxiPj4+MjgpO2I9ZysoYV5jXmUpK2RbMTJdK1xuMzg3MzE1MTQ2MSY0Mjk0OTY3Mjk1O2c9YSsoYjw8MTEmNDI5NDk2NzI5NXxiPj4+MjEpO2I9ZSsoZ15hXmMpK2RbMTVdKzUzMDc0MjUyMCY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTYmNDI5NDk2NzI5NXxiPj4+MTYpO2I9YysoZV5nXmEpK2RbMl0rMzI5OTYyODY0NSY0Mjk0OTY3Mjk1O2M9ZSsoYjw8MjMmNDI5NDk2NzI5NXxiPj4+OSk7Yj1hKyhlXihjfH5nKSkrZFswXSs0MDk2MzM2NDUyJjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzddKzExMjY4OTE0MTUmNDI5NDk2NzI5NTtnPWErKGI8PDEwJjQyOTQ5NjcyOTV8Yj4+PjIyKTtiPWUrKGFeKGd8fmMpKStkWzE0XSsyODc4NjEyMzkxJjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNSY0Mjk0OTY3Mjk1fGI+Pj4xNyk7Yj1jKyhnXihlfH5hKSkrZFs1XSs0MjM3NTMzMjQxJjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSk7Yj1hKyhlXihjfH5nKSkrZFsxMl0rMTcwMDQ4NTU3MSZcbjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzNdKzIzOTk5ODA2OTAmNDI5NDk2NzI5NTtnPWErKGI8PDEwJjQyOTQ5NjcyOTV8Yj4+PjIyKTtiPWUrKGFeKGd8fmMpKStkWzEwXSs0MjkzOTE1NzczJjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNSY0Mjk0OTY3Mjk1fGI+Pj4xNyk7Yj1jKyhnXihlfH5hKSkrZFsxXSsyMjQwMDQ0NDk3JjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSk7Yj1hKyhlXihjfH5nKSkrZFs4XSsxODczMzEzMzU5JjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzE1XSs0MjY0MzU1NTUyJjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMCY0Mjk0OTY3Mjk1fGI+Pj4yMik7Yj1lKyhhXihnfH5jKSkrZFs2XSsyNzM0NzY4OTE2JjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNSY0Mjk0OTY3Mjk1fGI+Pj4xNyk7Yj1jKyhnXihlfH5hKSkrZFsxM10rMTMwOTE1MTY0OSZcbjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSk7Yj1hKyhlXihjfH5nKSkrZFs0XSs0MTQ5NDQ0MjI2JjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzExXSszMTc0NzU2OTE3JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMCY0Mjk0OTY3Mjk1fGI+Pj4yMik7Yj1lKyhhXihnfH5jKSkrZFsyXSs3MTg3ODcyNTkmNDI5NDk2NzI5NTtlPWcrKGI8PDE1JjQyOTQ5NjcyOTV8Yj4+PjE3KTtiPWMrKGdeKGV8fmEpKStkWzldKzM5NTE0ODE3NDUmNDI5NDk2NzI5NTtmLmdbMF09Zi5nWzBdK2EmNDI5NDk2NzI5NTtmLmdbMV09Zi5nWzFdKyhlKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSkpJjQyOTQ5NjcyOTU7Zi5nWzJdPWYuZ1syXStlJjQyOTQ5NjcyOTU7Zi5nWzNdPWYuZ1szXStnJjQyOTQ5NjcyOTU7fVxubS5wcm90b3R5cGUudT1mdW5jdGlvbihmLGEpe3ZvaWQgMD09PWEmJihhPWYubGVuZ3RoKTtmb3IodmFyIGM9YS10aGlzLmJsb2NrU2l6ZSxkPXRoaXMuQixlPXRoaXMuaCxnPTA7ZzxhOyl7aWYoMD09ZSlmb3IoO2c8PWM7KW4odGhpcyxmLGcpLGcrPXRoaXMuYmxvY2tTaXplO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgZilmb3IoO2c8YTspe2lmKGRbZSsrXT1mLmNoYXJDb2RlQXQoZysrKSxlPT10aGlzLmJsb2NrU2l6ZSl7bih0aGlzLGQpO2U9MDticmVha319ZWxzZSBmb3IoO2c8YTspaWYoZFtlKytdPWZbZysrXSxlPT10aGlzLmJsb2NrU2l6ZSl7bih0aGlzLGQpO2U9MDticmVha319dGhpcy5oPWU7dGhpcy5vKz1hO307XG5tLnByb3RvdHlwZS52PWZ1bmN0aW9uKCl7dmFyIGY9QXJyYXkoKDU2PnRoaXMuaD90aGlzLmJsb2NrU2l6ZToyKnRoaXMuYmxvY2tTaXplKS10aGlzLmgpO2ZbMF09MTI4O2Zvcih2YXIgYT0xO2E8Zi5sZW5ndGgtODsrK2EpZlthXT0wO3ZhciBjPTgqdGhpcy5vO2ZvcihhPWYubGVuZ3RoLTg7YTxmLmxlbmd0aDsrK2EpZlthXT1jJjI1NSxjLz0yNTY7dGhpcy51KGYpO2Y9QXJyYXkoMTYpO2ZvcihhPWM9MDs0PmE7KythKWZvcih2YXIgZD0wOzMyPmQ7ZCs9OClmW2MrK109dGhpcy5nW2FdPj4+ZCYyNTU7cmV0dXJuIGZ9O2Z1bmN0aW9uIHAoZixhKXt2YXIgYz1xO3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYyxmKT9jW2ZdOmNbZl09YShmKX1mdW5jdGlvbiB0KGYsYSl7dGhpcy5oPWE7Zm9yKHZhciBjPVtdLGQ9ITAsZT1mLmxlbmd0aC0xOzA8PWU7ZS0tKXt2YXIgZz1mW2VdfDA7ZCYmZz09YXx8KGNbZV09ZyxkPSExKTt9dGhpcy5nPWM7fXZhciBxPXt9O2Z1bmN0aW9uIHUoZil7cmV0dXJuIC0xMjg8PWYmJjEyOD5mP3AoZixmdW5jdGlvbihhKXtyZXR1cm4gbmV3IHQoW2F8MF0sMD5hPy0xOjApfSk6bmV3IHQoW2Z8MF0sMD5mPy0xOjApfWZ1bmN0aW9uIHYoZil7aWYoaXNOYU4oZil8fCFpc0Zpbml0ZShmKSlyZXR1cm4gdztpZigwPmYpcmV0dXJuIHgodigtZikpO2Zvcih2YXIgYT1bXSxjPTEsZD0wO2Y+PWM7ZCsrKWFbZF09Zi9jfDAsYyo9NDI5NDk2NzI5NjtyZXR1cm4gbmV3IHQoYSwwKX1cbmZ1bmN0aW9uIHkoZixhKXtpZigwPT1mLmxlbmd0aCl0aHJvdyBFcnJvcihcIm51bWJlciBmb3JtYXQgZXJyb3I6IGVtcHR5IHN0cmluZ1wiKTthPWF8fDEwO2lmKDI+YXx8MzY8YSl0aHJvdyBFcnJvcihcInJhZGl4IG91dCBvZiByYW5nZTogXCIrYSk7aWYoXCItXCI9PWYuY2hhckF0KDApKXJldHVybiB4KHkoZi5zdWJzdHJpbmcoMSksYSkpO2lmKDA8PWYuaW5kZXhPZihcIi1cIikpdGhyb3cgRXJyb3IoJ251bWJlciBmb3JtYXQgZXJyb3I6IGludGVyaW9yIFwiLVwiIGNoYXJhY3RlcicpO2Zvcih2YXIgYz12KE1hdGgucG93KGEsOCkpLGQ9dyxlPTA7ZTxmLmxlbmd0aDtlKz04KXt2YXIgZz1NYXRoLm1pbig4LGYubGVuZ3RoLWUpLGI9cGFyc2VJbnQoZi5zdWJzdHJpbmcoZSxlK2cpLGEpOzg+Zz8oZz12KE1hdGgucG93KGEsZykpLGQ9ZC5qKGcpLmFkZCh2KGIpKSk6KGQ9ZC5qKGMpLGQ9ZC5hZGQodihiKSkpO31yZXR1cm4gZH12YXIgdz11KDApLHo9dSgxKSxBPXUoMTY3NzcyMTYpO2g9dC5wcm90b3R5cGU7XG5oLm09ZnVuY3Rpb24oKXtpZihCKHRoaXMpKXJldHVybiAteCh0aGlzKS5tKCk7Zm9yKHZhciBmPTAsYT0xLGM9MDtjPHRoaXMuZy5sZW5ndGg7YysrKXt2YXIgZD10aGlzLmkoYyk7Zis9KDA8PWQ/ZDo0Mjk0OTY3Mjk2K2QpKmE7YSo9NDI5NDk2NzI5Njt9cmV0dXJuIGZ9O2gudG9TdHJpbmc9ZnVuY3Rpb24oZil7Zj1mfHwxMDtpZigyPmZ8fDM2PGYpdGhyb3cgRXJyb3IoXCJyYWRpeCBvdXQgb2YgcmFuZ2U6IFwiK2YpO2lmKEModGhpcykpcmV0dXJuIFwiMFwiO2lmKEIodGhpcykpcmV0dXJuIFwiLVwiK3godGhpcykudG9TdHJpbmcoZik7Zm9yKHZhciBhPXYoTWF0aC5wb3coZiw2KSksYz10aGlzLGQ9XCJcIjs7KXt2YXIgZT1EKGMsYSkuZztjPUYoYyxlLmooYSkpO3ZhciBnPSgoMDxjLmcubGVuZ3RoP2MuZ1swXTpjLmgpPj4+MCkudG9TdHJpbmcoZik7Yz1lO2lmKEMoYykpcmV0dXJuIGcrZDtmb3IoOzY+Zy5sZW5ndGg7KWc9XCIwXCIrZztkPWcrZDt9fTtcbmguaT1mdW5jdGlvbihmKXtyZXR1cm4gMD5mPzA6Zjx0aGlzLmcubGVuZ3RoP3RoaXMuZ1tmXTp0aGlzLmh9O2Z1bmN0aW9uIEMoZil7aWYoMCE9Zi5oKXJldHVybiAhMTtmb3IodmFyIGE9MDthPGYuZy5sZW5ndGg7YSsrKWlmKDAhPWYuZ1thXSlyZXR1cm4gITE7cmV0dXJuICEwfWZ1bmN0aW9uIEIoZil7cmV0dXJuIC0xPT1mLmh9aC5sPWZ1bmN0aW9uKGYpe2Y9Rih0aGlzLGYpO3JldHVybiBCKGYpPy0xOkMoZik/MDoxfTtmdW5jdGlvbiB4KGYpe2Zvcih2YXIgYT1mLmcubGVuZ3RoLGM9W10sZD0wO2Q8YTtkKyspY1tkXT1+Zi5nW2RdO3JldHVybiAobmV3IHQoYyx+Zi5oKSkuYWRkKHopfWguYWJzPWZ1bmN0aW9uKCl7cmV0dXJuIEIodGhpcyk/eCh0aGlzKTp0aGlzfTtcbmguYWRkPWZ1bmN0aW9uKGYpe2Zvcih2YXIgYT1NYXRoLm1heCh0aGlzLmcubGVuZ3RoLGYuZy5sZW5ndGgpLGM9W10sZD0wLGU9MDtlPD1hO2UrKyl7dmFyIGc9ZCsodGhpcy5pKGUpJjY1NTM1KSsoZi5pKGUpJjY1NTM1KSxiPShnPj4+MTYpKyh0aGlzLmkoZSk+Pj4xNikrKGYuaShlKT4+PjE2KTtkPWI+Pj4xNjtnJj02NTUzNTtiJj02NTUzNTtjW2VdPWI8PDE2fGc7fXJldHVybiBuZXcgdChjLGNbYy5sZW5ndGgtMV0mLTIxNDc0ODM2NDg/LTE6MCl9O2Z1bmN0aW9uIEYoZixhKXtyZXR1cm4gZi5hZGQoeChhKSl9XG5oLmo9ZnVuY3Rpb24oZil7aWYoQyh0aGlzKXx8QyhmKSlyZXR1cm4gdztpZihCKHRoaXMpKXJldHVybiBCKGYpP3godGhpcykuaih4KGYpKTp4KHgodGhpcykuaihmKSk7aWYoQihmKSlyZXR1cm4geCh0aGlzLmooeChmKSkpO2lmKDA+dGhpcy5sKEEpJiYwPmYubChBKSlyZXR1cm4gdih0aGlzLm0oKSpmLm0oKSk7Zm9yKHZhciBhPXRoaXMuZy5sZW5ndGgrZi5nLmxlbmd0aCxjPVtdLGQ9MDtkPDIqYTtkKyspY1tkXT0wO2ZvcihkPTA7ZDx0aGlzLmcubGVuZ3RoO2QrKylmb3IodmFyIGU9MDtlPGYuZy5sZW5ndGg7ZSsrKXt2YXIgZz10aGlzLmkoZCk+Pj4xNixiPXRoaXMuaShkKSY2NTUzNSxyPWYuaShlKT4+PjE2LEU9Zi5pKGUpJjY1NTM1O2NbMipkKzIqZV0rPWIqRTtHKGMsMipkKzIqZSk7Y1syKmQrMiplKzFdKz1nKkU7RyhjLDIqZCsyKmUrMSk7Y1syKmQrMiplKzFdKz1iKnI7RyhjLDIqZCsyKmUrMSk7Y1syKmQrMiplKzJdKz1nKnI7RyhjLDIqZCsyKmUrMik7fWZvcihkPTA7ZDxcbmE7ZCsrKWNbZF09Y1syKmQrMV08PDE2fGNbMipkXTtmb3IoZD1hO2Q8MiphO2QrKyljW2RdPTA7cmV0dXJuIG5ldyB0KGMsMCl9O2Z1bmN0aW9uIEcoZixhKXtmb3IoOyhmW2FdJjY1NTM1KSE9ZlthXTspZlthKzFdKz1mW2FdPj4+MTYsZlthXSY9NjU1MzUsYSsrO31mdW5jdGlvbiBIKGYsYSl7dGhpcy5nPWY7dGhpcy5oPWE7fVxuZnVuY3Rpb24gRChmLGEpe2lmKEMoYSkpdGhyb3cgRXJyb3IoXCJkaXZpc2lvbiBieSB6ZXJvXCIpO2lmKEMoZikpcmV0dXJuIG5ldyBIKHcsdyk7aWYoQihmKSlyZXR1cm4gYT1EKHgoZiksYSksbmV3IEgoeChhLmcpLHgoYS5oKSk7aWYoQihhKSlyZXR1cm4gYT1EKGYseChhKSksbmV3IEgoeChhLmcpLGEuaCk7aWYoMzA8Zi5nLmxlbmd0aCl7aWYoQihmKXx8QihhKSl0aHJvdyBFcnJvcihcInNsb3dEaXZpZGVfIG9ubHkgd29ya3Mgd2l0aCBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7Zm9yKHZhciBjPXosZD1hOzA+PWQubChmKTspYz1JKGMpLGQ9SShkKTt2YXIgZT1KKGMsMSksZz1KKGQsMSk7ZD1KKGQsMik7Zm9yKGM9SihjLDIpOyFDKGQpOyl7dmFyIGI9Zy5hZGQoZCk7MD49Yi5sKGYpJiYoZT1lLmFkZChjKSxnPWIpO2Q9SihkLDEpO2M9SihjLDEpO31hPUYoZixlLmooYSkpO3JldHVybiBuZXcgSChlLGEpfWZvcihlPXc7MDw9Zi5sKGEpOyl7Yz1NYXRoLm1heCgxLE1hdGguZmxvb3IoZi5tKCkvXG5hLm0oKSkpO2Q9TWF0aC5jZWlsKE1hdGgubG9nKGMpL01hdGguTE4yKTtkPTQ4Pj1kPzE6TWF0aC5wb3coMixkLTQ4KTtnPXYoYyk7Zm9yKGI9Zy5qKGEpO0IoYil8fDA8Yi5sKGYpOyljLT1kLGc9dihjKSxiPWcuaihhKTtDKGcpJiYoZz16KTtlPWUuYWRkKGcpO2Y9RihmLGIpO31yZXR1cm4gbmV3IEgoZSxmKX1oLkE9ZnVuY3Rpb24oZil7cmV0dXJuIEQodGhpcyxmKS5ofTtoLmFuZD1mdW5jdGlvbihmKXtmb3IodmFyIGE9TWF0aC5tYXgodGhpcy5nLmxlbmd0aCxmLmcubGVuZ3RoKSxjPVtdLGQ9MDtkPGE7ZCsrKWNbZF09dGhpcy5pKGQpJmYuaShkKTtyZXR1cm4gbmV3IHQoYyx0aGlzLmgmZi5oKX07aC5vcj1mdW5jdGlvbihmKXtmb3IodmFyIGE9TWF0aC5tYXgodGhpcy5nLmxlbmd0aCxmLmcubGVuZ3RoKSxjPVtdLGQ9MDtkPGE7ZCsrKWNbZF09dGhpcy5pKGQpfGYuaShkKTtyZXR1cm4gbmV3IHQoYyx0aGlzLmh8Zi5oKX07XG5oLnhvcj1mdW5jdGlvbihmKXtmb3IodmFyIGE9TWF0aC5tYXgodGhpcy5nLmxlbmd0aCxmLmcubGVuZ3RoKSxjPVtdLGQ9MDtkPGE7ZCsrKWNbZF09dGhpcy5pKGQpXmYuaShkKTtyZXR1cm4gbmV3IHQoYyx0aGlzLmheZi5oKX07ZnVuY3Rpb24gSShmKXtmb3IodmFyIGE9Zi5nLmxlbmd0aCsxLGM9W10sZD0wO2Q8YTtkKyspY1tkXT1mLmkoZCk8PDF8Zi5pKGQtMSk+Pj4zMTtyZXR1cm4gbmV3IHQoYyxmLmgpfWZ1bmN0aW9uIEooZixhKXt2YXIgYz1hPj41O2ElPTMyO2Zvcih2YXIgZD1mLmcubGVuZ3RoLWMsZT1bXSxnPTA7ZzxkO2crKyllW2ddPTA8YT9mLmkoZytjKT4+PmF8Zi5pKGcrYysxKTw8MzItYTpmLmkoZytjKTtyZXR1cm4gbmV3IHQoZSxmLmgpfW0ucHJvdG90eXBlLmRpZ2VzdD1tLnByb3RvdHlwZS52O20ucHJvdG90eXBlLnJlc2V0PW0ucHJvdG90eXBlLnM7bS5wcm90b3R5cGUudXBkYXRlPW0ucHJvdG90eXBlLnU7TWQ1ID0gYmxvb21fYmxvYl9lczIwMTguTWQ1PW07dC5wcm90b3R5cGUuYWRkPXQucHJvdG90eXBlLmFkZDt0LnByb3RvdHlwZS5tdWx0aXBseT10LnByb3RvdHlwZS5qO3QucHJvdG90eXBlLm1vZHVsbz10LnByb3RvdHlwZS5BO3QucHJvdG90eXBlLmNvbXBhcmU9dC5wcm90b3R5cGUubDt0LnByb3RvdHlwZS50b051bWJlcj10LnByb3RvdHlwZS5tO3QucHJvdG90eXBlLnRvU3RyaW5nPXQucHJvdG90eXBlLnRvU3RyaW5nO3QucHJvdG90eXBlLmdldEJpdHM9dC5wcm90b3R5cGUuaTt0LmZyb21OdW1iZXI9djt0LmZyb21TdHJpbmc9eTtJbnRlZ2VyID0gYmxvb21fYmxvYl9lczIwMTguSW50ZWdlcj10O30pLmFwcGx5KCB0eXBlb2YgY29tbW9uanNHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gY29tbW9uanNHbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmICA6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93ICA6IHt9KTtcblxuZXhwb3J0IHsgSW50ZWdlciwgTWQ1LCBibG9vbV9ibG9iX2VzMjAxOCBhcyBkZWZhdWx0IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1ibG9vbV9ibG9iX2VzMjAxOC5qcy5tYXBcbiIsInZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9O1xuXG52YXIgd2ViY2hhbm5lbF9ibG9iX2VzMjAxOCA9IHt9O1xuXG4vKiogQGxpY2Vuc2VcbkNvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG5TUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuKi9cblxudmFyIFhocklvO1xudmFyIEZldGNoWG1sSHR0cEZhY3Rvcnk7XG52YXIgV2ViQ2hhbm5lbDtcbnZhciBFdmVudFR5cGU7XG52YXIgRXJyb3JDb2RlO1xudmFyIFN0YXQ7XG52YXIgRXZlbnQ7XG52YXIgZ2V0U3RhdEV2ZW50VGFyZ2V0O1xudmFyIGNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQ7XG4oZnVuY3Rpb24oKSB7dmFyIGgsYWE9XCJmdW5jdGlvblwiPT10eXBlb2YgT2JqZWN0LmRlZmluZVByb3BlcnRpZXM/T2JqZWN0LmRlZmluZVByb3BlcnR5OmZ1bmN0aW9uKGEsYixjKXtpZihhPT1BcnJheS5wcm90b3R5cGV8fGE9PU9iamVjdC5wcm90b3R5cGUpcmV0dXJuIGE7YVtiXT1jLnZhbHVlO3JldHVybiBhfTtmdW5jdGlvbiBiYShhKXthPVtcIm9iamVjdFwiPT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcyxhLFwib2JqZWN0XCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyxcIm9iamVjdFwiPT10eXBlb2Ygc2VsZiYmc2VsZixcIm9iamVjdFwiPT10eXBlb2YgY29tbW9uanNHbG9iYWwmJmNvbW1vbmpzR2xvYmFsXTtmb3IodmFyIGI9MDtiPGEubGVuZ3RoOysrYil7dmFyIGM9YVtiXTtpZihjJiZjLk1hdGg9PU1hdGgpcmV0dXJuIGN9dGhyb3cgRXJyb3IoXCJDYW5ub3QgZmluZCBnbG9iYWwgb2JqZWN0XCIpO312YXIgY2E9YmEodGhpcyk7XG5mdW5jdGlvbiBkYShhLGIpe2lmKGIpYTp7dmFyIGM9Y2E7YT1hLnNwbGl0KFwiLlwiKTtmb3IodmFyIGQ9MDtkPGEubGVuZ3RoLTE7ZCsrKXt2YXIgZT1hW2RdO2lmKCEoZSBpbiBjKSlicmVhayBhO2M9Y1tlXTt9YT1hW2EubGVuZ3RoLTFdO2Q9Y1thXTtiPWIoZCk7YiE9ZCYmbnVsbCE9YiYmYWEoYyxhLHtjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6Yn0pO319ZnVuY3Rpb24gZWEoYSxiKXthIGluc3RhbmNlb2YgU3RyaW5nJiYoYSs9XCJcIik7dmFyIGM9MCxkPSExLGU9e25leHQ6ZnVuY3Rpb24oKXtpZighZCYmYzxhLmxlbmd0aCl7dmFyIGY9YysrO3JldHVybiB7dmFsdWU6YihmLGFbZl0pLGRvbmU6ITF9fWQ9ITA7cmV0dXJuIHtkb25lOiEwLHZhbHVlOnZvaWQgMH19fTtlW1N5bWJvbC5pdGVyYXRvcl09ZnVuY3Rpb24oKXtyZXR1cm4gZX07cmV0dXJuIGV9XG5kYShcIkFycmF5LnByb3RvdHlwZS52YWx1ZXNcIixmdW5jdGlvbihhKXtyZXR1cm4gYT9hOmZ1bmN0aW9uKCl7cmV0dXJuIGVhKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gY30pfX0pOy8qKiBAbGljZW5zZVxuXG4gQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuKi9cbnZhciBmYT1mYXx8e30saz10aGlzfHxzZWxmO2Z1bmN0aW9uIGhhKGEpe3ZhciBiPXR5cGVvZiBhO2I9XCJvYmplY3RcIiE9Yj9iOmE/QXJyYXkuaXNBcnJheShhKT9cImFycmF5XCI6YjpcIm51bGxcIjtyZXR1cm4gXCJhcnJheVwiPT1ifHxcIm9iamVjdFwiPT1iJiZcIm51bWJlclwiPT10eXBlb2YgYS5sZW5ndGh9ZnVuY3Rpb24gbihhKXt2YXIgYj10eXBlb2YgYTtyZXR1cm4gXCJvYmplY3RcIj09YiYmbnVsbCE9YXx8XCJmdW5jdGlvblwiPT1ifWZ1bmN0aW9uIGlhKGEsYixjKXtyZXR1cm4gYS5jYWxsLmFwcGx5KGEuYmluZCxhcmd1bWVudHMpfVxuZnVuY3Rpb24gamEoYSxiLGMpe2lmKCFhKXRocm93IEVycm9yKCk7aWYoMjxhcmd1bWVudHMubGVuZ3RoKXt2YXIgZD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtBcnJheS5wcm90b3R5cGUudW5zaGlmdC5hcHBseShlLGQpO3JldHVybiBhLmFwcGx5KGIsZSl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGIsYXJndW1lbnRzKX19ZnVuY3Rpb24gcChhLGIsYyl7cD1GdW5jdGlvbi5wcm90b3R5cGUuYmluZCYmLTEhPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLnRvU3RyaW5nKCkuaW5kZXhPZihcIm5hdGl2ZSBjb2RlXCIpP2lhOmphO3JldHVybiBwLmFwcGx5KG51bGwsYXJndW1lbnRzKX1cbmZ1bmN0aW9uIGthKGEsYil7dmFyIGM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO3JldHVybiBmdW5jdGlvbigpe3ZhciBkPWMuc2xpY2UoKTtkLnB1c2guYXBwbHkoZCxhcmd1bWVudHMpO3JldHVybiBhLmFwcGx5KHRoaXMsZCl9fWZ1bmN0aW9uIHIoYSxiKXtmdW5jdGlvbiBjKCl7fWMucHJvdG90eXBlPWIucHJvdG90eXBlO2EuYWE9Yi5wcm90b3R5cGU7YS5wcm90b3R5cGU9bmV3IGM7YS5wcm90b3R5cGUuY29uc3RydWN0b3I9YTthLlFiPWZ1bmN0aW9uKGQsZSxmKXtmb3IodmFyIGc9QXJyYXkoYXJndW1lbnRzLmxlbmd0aC0yKSxtPTI7bTxhcmd1bWVudHMubGVuZ3RoO20rKylnW20tMl09YXJndW1lbnRzW21dO3JldHVybiBiLnByb3RvdHlwZVtlXS5hcHBseShkLGcpfTt9ZnVuY3Rpb24gbGEoYSl7Y29uc3QgYj1hLmxlbmd0aDtpZigwPGIpe2NvbnN0IGM9QXJyYXkoYik7Zm9yKGxldCBkPTA7ZDxiO2QrKyljW2RdPWFbZF07cmV0dXJuIGN9cmV0dXJuIFtdfWZ1bmN0aW9uIG1hKGEsYil7Zm9yKGxldCBjPTE7Yzxhcmd1bWVudHMubGVuZ3RoO2MrKyl7Y29uc3QgZD1hcmd1bWVudHNbY107aWYoaGEoZCkpe2NvbnN0IGU9YS5sZW5ndGh8fDAsZj1kLmxlbmd0aHx8MDthLmxlbmd0aD1lK2Y7Zm9yKGxldCBnPTA7ZzxmO2crKylhW2UrZ109ZFtnXTt9ZWxzZSBhLnB1c2goZCk7fX1jbGFzcyBuYXtjb25zdHJ1Y3RvcihhLGIpe3RoaXMuaT1hO3RoaXMuaj1iO3RoaXMuaD0wO3RoaXMuZz1udWxsO31nZXQoKXtsZXQgYTswPHRoaXMuaD8odGhpcy5oLS0sYT10aGlzLmcsdGhpcy5nPWEubmV4dCxhLm5leHQ9bnVsbCk6YT10aGlzLmkoKTtyZXR1cm4gYX19ZnVuY3Rpb24gdChhKXtyZXR1cm4gL15bXFxzXFx4YTBdKiQvLnRlc3QoYSl9ZnVuY3Rpb24gdSgpe3ZhciBhPWsubmF2aWdhdG9yO3JldHVybiBhJiYoYT1hLnVzZXJBZ2VudCk/YTpcIlwifWZ1bmN0aW9uIG9hKGEpe29hW1wiIFwiXShhKTtyZXR1cm4gYX1vYVtcIiBcIl09ZnVuY3Rpb24oKXt9O3ZhciBwYT0tMSE9dSgpLmluZGV4T2YoXCJHZWNrb1wiKSYmISgtMSE9dSgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIndlYmtpdFwiKSYmLTE9PXUoKS5pbmRleE9mKFwiRWRnZVwiKSkmJiEoLTEhPXUoKS5pbmRleE9mKFwiVHJpZGVudFwiKXx8LTEhPXUoKS5pbmRleE9mKFwiTVNJRVwiKSkmJi0xPT11KCkuaW5kZXhPZihcIkVkZ2VcIik7ZnVuY3Rpb24gcWEoYSxiLGMpe2Zvcihjb25zdCBkIGluIGEpYi5jYWxsKGMsYVtkXSxkLGEpO31mdW5jdGlvbiByYShhLGIpe2Zvcihjb25zdCBjIGluIGEpYi5jYWxsKHZvaWQgMCxhW2NdLGMsYSk7fWZ1bmN0aW9uIHNhKGEpe2NvbnN0IGI9e307Zm9yKGNvbnN0IGMgaW4gYSliW2NdPWFbY107cmV0dXJuIGJ9Y29uc3QgdGE9XCJjb25zdHJ1Y3RvciBoYXNPd25Qcm9wZXJ0eSBpc1Byb3RvdHlwZU9mIHByb3BlcnR5SXNFbnVtZXJhYmxlIHRvTG9jYWxlU3RyaW5nIHRvU3RyaW5nIHZhbHVlT2ZcIi5zcGxpdChcIiBcIik7ZnVuY3Rpb24gdWEoYSxiKXtsZXQgYyxkO2ZvcihsZXQgZT0xO2U8YXJndW1lbnRzLmxlbmd0aDtlKyspe2Q9YXJndW1lbnRzW2VdO2ZvcihjIGluIGQpYVtjXT1kW2NdO2ZvcihsZXQgZj0wO2Y8dGEubGVuZ3RoO2YrKyljPXRhW2ZdLE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkLGMpJiYoYVtjXT1kW2NdKTt9fWZ1bmN0aW9uIHZhKGEpe3ZhciBiPTE7YT1hLnNwbGl0KFwiOlwiKTtjb25zdCBjPVtdO2Zvcig7MDxiJiZhLmxlbmd0aDspYy5wdXNoKGEuc2hpZnQoKSksYi0tO2EubGVuZ3RoJiZjLnB1c2goYS5qb2luKFwiOlwiKSk7cmV0dXJuIGN9ZnVuY3Rpb24gd2EoYSl7ay5zZXRUaW1lb3V0KCgpPT57dGhyb3cgYTt9LDApO31mdW5jdGlvbiB4YSgpe3ZhciBhPXphO2xldCBiPW51bGw7YS5nJiYoYj1hLmcsYS5nPWEuZy5uZXh0LGEuZ3x8KGEuaD1udWxsKSxiLm5leHQ9bnVsbCk7cmV0dXJuIGJ9Y2xhc3MgQWF7Y29uc3RydWN0b3IoKXt0aGlzLmg9dGhpcy5nPW51bGw7fWFkZChhLGIpe2NvbnN0IGM9QmEuZ2V0KCk7Yy5zZXQoYSxiKTt0aGlzLmg/dGhpcy5oLm5leHQ9Yzp0aGlzLmc9Yzt0aGlzLmg9Yzt9fXZhciBCYT1uZXcgbmEoKCk9Pm5ldyBDYSxhPT5hLnJlc2V0KCkpO2NsYXNzIENhe2NvbnN0cnVjdG9yKCl7dGhpcy5uZXh0PXRoaXMuZz10aGlzLmg9bnVsbDt9c2V0KGEsYil7dGhpcy5oPWE7dGhpcy5nPWI7dGhpcy5uZXh0PW51bGw7fXJlc2V0KCl7dGhpcy5uZXh0PXRoaXMuZz10aGlzLmg9bnVsbDt9fWxldCB4LHk9ITEsemE9bmV3IEFhLEVhPSgpPT57Y29uc3QgYT1rLlByb21pc2UucmVzb2x2ZSh2b2lkIDApO3g9KCk9PnthLnRoZW4oRGEpO307fTt2YXIgRGE9KCk9Pntmb3IodmFyIGE7YT14YSgpOyl7dHJ5e2EuaC5jYWxsKGEuZyk7fWNhdGNoKGMpe3dhKGMpO312YXIgYj1CYTtiLmooYSk7MTAwPmIuaCYmKGIuaCsrLGEubmV4dD1iLmcsYi5nPWEpO315PSExO307ZnVuY3Rpb24geigpe3RoaXMucz10aGlzLnM7dGhpcy5DPXRoaXMuQzt9ei5wcm90b3R5cGUucz0hMTt6LnByb3RvdHlwZS5tYT1mdW5jdGlvbigpe3RoaXMuc3x8KHRoaXMucz0hMCx0aGlzLk4oKSk7fTt6LnByb3RvdHlwZS5OPWZ1bmN0aW9uKCl7aWYodGhpcy5DKWZvcig7dGhpcy5DLmxlbmd0aDspdGhpcy5DLnNoaWZ0KCkoKTt9O2Z1bmN0aW9uIEEoYSxiKXt0aGlzLnR5cGU9YTt0aGlzLmc9dGhpcy50YXJnZXQ9Yjt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITE7fUEucHJvdG90eXBlLmg9ZnVuY3Rpb24oKXt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITA7fTt2YXIgRmE9ZnVuY3Rpb24oKXtpZighay5hZGRFdmVudExpc3RlbmVyfHwhT2JqZWN0LmRlZmluZVByb3BlcnR5KXJldHVybiAhMTt2YXIgYT0hMSxiPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSxcInBhc3NpdmVcIix7Z2V0OmZ1bmN0aW9uKCl7YT0hMDt9fSk7dHJ5e2NvbnN0IGM9KCk9Pnt9O2suYWRkRXZlbnRMaXN0ZW5lcihcInRlc3RcIixjLGIpO2sucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRlc3RcIixjLGIpO31jYXRjaChjKXt9cmV0dXJuIGF9KCk7ZnVuY3Rpb24gQyhhLGIpe0EuY2FsbCh0aGlzLGE/YS50eXBlOlwiXCIpO3RoaXMucmVsYXRlZFRhcmdldD10aGlzLmc9dGhpcy50YXJnZXQ9bnVsbDt0aGlzLmJ1dHRvbj10aGlzLnNjcmVlblk9dGhpcy5zY3JlZW5YPXRoaXMuY2xpZW50WT10aGlzLmNsaWVudFg9MDt0aGlzLmtleT1cIlwiO3RoaXMubWV0YUtleT10aGlzLnNoaWZ0S2V5PXRoaXMuYWx0S2V5PXRoaXMuY3RybEtleT0hMTt0aGlzLnN0YXRlPW51bGw7dGhpcy5wb2ludGVySWQ9MDt0aGlzLnBvaW50ZXJUeXBlPVwiXCI7dGhpcy5pPW51bGw7aWYoYSl7dmFyIGM9dGhpcy50eXBlPWEudHlwZSxkPWEuY2hhbmdlZFRvdWNoZXMmJmEuY2hhbmdlZFRvdWNoZXMubGVuZ3RoP2EuY2hhbmdlZFRvdWNoZXNbMF06bnVsbDt0aGlzLnRhcmdldD1hLnRhcmdldHx8YS5zcmNFbGVtZW50O3RoaXMuZz1iO2lmKGI9YS5yZWxhdGVkVGFyZ2V0KXtpZihwYSl7YTp7dHJ5e29hKGIubm9kZU5hbWUpO3ZhciBlPSEwO2JyZWFrIGF9Y2F0Y2goZil7fWU9XG4hMTt9ZXx8KGI9bnVsbCk7fX1lbHNlIFwibW91c2VvdmVyXCI9PWM/Yj1hLmZyb21FbGVtZW50OlwibW91c2VvdXRcIj09YyYmKGI9YS50b0VsZW1lbnQpO3RoaXMucmVsYXRlZFRhcmdldD1iO2Q/KHRoaXMuY2xpZW50WD12b2lkIDAhPT1kLmNsaWVudFg/ZC5jbGllbnRYOmQucGFnZVgsdGhpcy5jbGllbnRZPXZvaWQgMCE9PWQuY2xpZW50WT9kLmNsaWVudFk6ZC5wYWdlWSx0aGlzLnNjcmVlblg9ZC5zY3JlZW5YfHwwLHRoaXMuc2NyZWVuWT1kLnNjcmVlbll8fDApOih0aGlzLmNsaWVudFg9dm9pZCAwIT09YS5jbGllbnRYP2EuY2xpZW50WDphLnBhZ2VYLHRoaXMuY2xpZW50WT12b2lkIDAhPT1hLmNsaWVudFk/YS5jbGllbnRZOmEucGFnZVksdGhpcy5zY3JlZW5YPWEuc2NyZWVuWHx8MCx0aGlzLnNjcmVlblk9YS5zY3JlZW5ZfHwwKTt0aGlzLmJ1dHRvbj1hLmJ1dHRvbjt0aGlzLmtleT1hLmtleXx8XCJcIjt0aGlzLmN0cmxLZXk9YS5jdHJsS2V5O3RoaXMuYWx0S2V5PWEuYWx0S2V5O3RoaXMuc2hpZnRLZXk9XG5hLnNoaWZ0S2V5O3RoaXMubWV0YUtleT1hLm1ldGFLZXk7dGhpcy5wb2ludGVySWQ9YS5wb2ludGVySWR8fDA7dGhpcy5wb2ludGVyVHlwZT1cInN0cmluZ1wiPT09dHlwZW9mIGEucG9pbnRlclR5cGU/YS5wb2ludGVyVHlwZTpHYVthLnBvaW50ZXJUeXBlXXx8XCJcIjt0aGlzLnN0YXRlPWEuc3RhdGU7dGhpcy5pPWE7YS5kZWZhdWx0UHJldmVudGVkJiZDLmFhLmguY2FsbCh0aGlzKTt9fXIoQyxBKTt2YXIgR2E9ezI6XCJ0b3VjaFwiLDM6XCJwZW5cIiw0OlwibW91c2VcIn07Qy5wcm90b3R5cGUuaD1mdW5jdGlvbigpe0MuYWEuaC5jYWxsKHRoaXMpO3ZhciBhPXRoaXMuaTthLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTphLnJldHVyblZhbHVlPSExO307dmFyIEQ9XCJjbG9zdXJlX2xpc3RlbmFibGVfXCIrKDFFNipNYXRoLnJhbmRvbSgpfDApO3ZhciBIYT0wO2Z1bmN0aW9uIElhKGEsYixjLGQsZSl7dGhpcy5saXN0ZW5lcj1hO3RoaXMucHJveHk9bnVsbDt0aGlzLnNyYz1iO3RoaXMudHlwZT1jO3RoaXMuY2FwdHVyZT0hIWQ7dGhpcy5oYT1lO3RoaXMua2V5PSsrSGE7dGhpcy5kYT10aGlzLmZhPSExO31mdW5jdGlvbiBKYShhKXthLmRhPSEwO2EubGlzdGVuZXI9bnVsbDthLnByb3h5PW51bGw7YS5zcmM9bnVsbDthLmhhPW51bGw7fWZ1bmN0aW9uIEthKGEpe3RoaXMuc3JjPWE7dGhpcy5nPXt9O3RoaXMuaD0wO31LYS5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9YS50b1N0cmluZygpO2E9dGhpcy5nW2ZdO2F8fChhPXRoaXMuZ1tmXT1bXSx0aGlzLmgrKyk7dmFyIGc9TGEoYSxiLGQsZSk7LTE8Zz8oYj1hW2ddLGN8fChiLmZhPSExKSk6KGI9bmV3IElhKGIsdGhpcy5zcmMsZiwhIWQsZSksYi5mYT1jLGEucHVzaChiKSk7cmV0dXJuIGJ9O2Z1bmN0aW9uIE1hKGEsYil7dmFyIGM9Yi50eXBlO2lmKGMgaW4gYS5nKXt2YXIgZD1hLmdbY10sZT1BcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGQsYix2b2lkIDApLGY7KGY9MDw9ZSkmJkFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbChkLGUsMSk7ZiYmKEphKGIpLDA9PWEuZ1tjXS5sZW5ndGgmJihkZWxldGUgYS5nW2NdLGEuaC0tKSk7fX1cbmZ1bmN0aW9uIExhKGEsYixjLGQpe2Zvcih2YXIgZT0wO2U8YS5sZW5ndGg7KytlKXt2YXIgZj1hW2VdO2lmKCFmLmRhJiZmLmxpc3RlbmVyPT1iJiZmLmNhcHR1cmU9PSEhYyYmZi5oYT09ZClyZXR1cm4gZX1yZXR1cm4gLTF9dmFyIE5hPVwiY2xvc3VyZV9sbV9cIisoMUU2Kk1hdGgucmFuZG9tKCl8MCksT2E9e307ZnVuY3Rpb24gUWEoYSxiLGMsZCxlKXtpZihkJiZkLm9uY2UpcmV0dXJuIFJhKGEsYixjLGQsZSk7aWYoQXJyYXkuaXNBcnJheShiKSl7Zm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspUWEoYSxiW2ZdLGMsZCxlKTtyZXR1cm4gbnVsbH1jPVNhKGMpO3JldHVybiBhJiZhW0RdP2EuSyhiLGMsbihkKT8hIWQuY2FwdHVyZTohIWQsZSk6VGEoYSxiLGMsITEsZCxlKX1cbmZ1bmN0aW9uIFRhKGEsYixjLGQsZSxmKXtpZighYil0aHJvdyBFcnJvcihcIkludmFsaWQgZXZlbnQgdHlwZVwiKTt2YXIgZz1uKGUpPyEhZS5jYXB0dXJlOiEhZSxtPVVhKGEpO218fChhW05hXT1tPW5ldyBLYShhKSk7Yz1tLmFkZChiLGMsZCxnLGYpO2lmKGMucHJveHkpcmV0dXJuIGM7ZD1WYSgpO2MucHJveHk9ZDtkLnNyYz1hO2QubGlzdGVuZXI9YztpZihhLmFkZEV2ZW50TGlzdGVuZXIpRmF8fChlPWcpLHZvaWQgMD09PWUmJihlPSExKSxhLmFkZEV2ZW50TGlzdGVuZXIoYi50b1N0cmluZygpLGQsZSk7ZWxzZSBpZihhLmF0dGFjaEV2ZW50KWEuYXR0YWNoRXZlbnQoV2EoYi50b1N0cmluZygpKSxkKTtlbHNlIGlmKGEuYWRkTGlzdGVuZXImJmEucmVtb3ZlTGlzdGVuZXIpYS5hZGRMaXN0ZW5lcihkKTtlbHNlIHRocm93IEVycm9yKFwiYWRkRXZlbnRMaXN0ZW5lciBhbmQgYXR0YWNoRXZlbnQgYXJlIHVuYXZhaWxhYmxlLlwiKTtyZXR1cm4gY31cbmZ1bmN0aW9uIFZhKCl7ZnVuY3Rpb24gYShjKXtyZXR1cm4gYi5jYWxsKGEuc3JjLGEubGlzdGVuZXIsYyl9Y29uc3QgYj1YYTtyZXR1cm4gYX1mdW5jdGlvbiBSYShhLGIsYyxkLGUpe2lmKEFycmF5LmlzQXJyYXkoYikpe2Zvcih2YXIgZj0wO2Y8Yi5sZW5ndGg7ZisrKVJhKGEsYltmXSxjLGQsZSk7cmV0dXJuIG51bGx9Yz1TYShjKTtyZXR1cm4gYSYmYVtEXT9hLkwoYixjLG4oZCk/ISFkLmNhcHR1cmU6ISFkLGUpOlRhKGEsYixjLCEwLGQsZSl9XG5mdW5jdGlvbiBZYShhLGIsYyxkLGUpe2lmKEFycmF5LmlzQXJyYXkoYikpZm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspWWEoYSxiW2ZdLGMsZCxlKTtlbHNlIChkPW4oZCk/ISFkLmNhcHR1cmU6ISFkLGM9U2EoYyksYSYmYVtEXSk/KGE9YS5pLGI9U3RyaW5nKGIpLnRvU3RyaW5nKCksYiBpbiBhLmcmJihmPWEuZ1tiXSxjPUxhKGYsYyxkLGUpLC0xPGMmJihKYShmW2NdKSxBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoZixjLDEpLDA9PWYubGVuZ3RoJiYoZGVsZXRlIGEuZ1tiXSxhLmgtLSkpKSk6YSYmKGE9VWEoYSkpJiYoYj1hLmdbYi50b1N0cmluZygpXSxhPS0xLGImJihhPUxhKGIsYyxkLGUpKSwoYz0tMTxhP2JbYV06bnVsbCkmJlphKGMpKTt9XG5mdW5jdGlvbiBaYShhKXtpZihcIm51bWJlclwiIT09dHlwZW9mIGEmJmEmJiFhLmRhKXt2YXIgYj1hLnNyYztpZihiJiZiW0RdKU1hKGIuaSxhKTtlbHNlIHt2YXIgYz1hLnR5cGUsZD1hLnByb3h5O2IucmVtb3ZlRXZlbnRMaXN0ZW5lcj9iLnJlbW92ZUV2ZW50TGlzdGVuZXIoYyxkLGEuY2FwdHVyZSk6Yi5kZXRhY2hFdmVudD9iLmRldGFjaEV2ZW50KFdhKGMpLGQpOmIuYWRkTGlzdGVuZXImJmIucmVtb3ZlTGlzdGVuZXImJmIucmVtb3ZlTGlzdGVuZXIoZCk7KGM9VWEoYikpPyhNYShjLGEpLDA9PWMuaCYmKGMuc3JjPW51bGwsYltOYV09bnVsbCkpOkphKGEpO319fWZ1bmN0aW9uIFdhKGEpe3JldHVybiBhIGluIE9hP09hW2FdOk9hW2FdPVwib25cIithfWZ1bmN0aW9uIFhhKGEsYil7aWYoYS5kYSlhPSEwO2Vsc2Uge2I9bmV3IEMoYix0aGlzKTt2YXIgYz1hLmxpc3RlbmVyLGQ9YS5oYXx8YS5zcmM7YS5mYSYmWmEoYSk7YT1jLmNhbGwoZCxiKTt9cmV0dXJuIGF9XG5mdW5jdGlvbiBVYShhKXthPWFbTmFdO3JldHVybiBhIGluc3RhbmNlb2YgS2E/YTpudWxsfXZhciAkYT1cIl9fY2xvc3VyZV9ldmVudHNfZm5fXCIrKDFFOSpNYXRoLnJhbmRvbSgpPj4+MCk7ZnVuY3Rpb24gU2EoYSl7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGEpcmV0dXJuIGE7YVskYV18fChhWyRhXT1mdW5jdGlvbihiKXtyZXR1cm4gYS5oYW5kbGVFdmVudChiKX0pO3JldHVybiBhWyRhXX1mdW5jdGlvbiBFKCl7ei5jYWxsKHRoaXMpO3RoaXMuaT1uZXcgS2EodGhpcyk7dGhpcy5NPXRoaXM7dGhpcy5GPW51bGw7fXIoRSx6KTtFLnByb3RvdHlwZVtEXT0hMDtFLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYixjLGQpe1lhKHRoaXMsYSxiLGMsZCk7fTtcbmZ1bmN0aW9uIEYoYSxiKXt2YXIgYyxkPWEuRjtpZihkKWZvcihjPVtdO2Q7ZD1kLkYpYy5wdXNoKGQpO2E9YS5NO2Q9Yi50eXBlfHxiO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYiliPW5ldyBBKGIsYSk7ZWxzZSBpZihiIGluc3RhbmNlb2YgQSliLnRhcmdldD1iLnRhcmdldHx8YTtlbHNlIHt2YXIgZT1iO2I9bmV3IEEoZCxhKTt1YShiLGUpO31lPSEwO2lmKGMpZm9yKHZhciBmPWMubGVuZ3RoLTE7MDw9ZjtmLS0pe3ZhciBnPWIuZz1jW2ZdO2U9YWIoZyxkLCEwLGIpJiZlO31nPWIuZz1hO2U9YWIoZyxkLCEwLGIpJiZlO2U9YWIoZyxkLCExLGIpJiZlO2lmKGMpZm9yKGY9MDtmPGMubGVuZ3RoO2YrKylnPWIuZz1jW2ZdLGU9YWIoZyxkLCExLGIpJiZlO31cbkUucHJvdG90eXBlLk49ZnVuY3Rpb24oKXtFLmFhLk4uY2FsbCh0aGlzKTtpZih0aGlzLmkpe3ZhciBhPXRoaXMuaSxjO2ZvcihjIGluIGEuZyl7Zm9yKHZhciBkPWEuZ1tjXSxlPTA7ZTxkLmxlbmd0aDtlKyspSmEoZFtlXSk7ZGVsZXRlIGEuZ1tjXTthLmgtLTt9fXRoaXMuRj1udWxsO307RS5wcm90b3R5cGUuSz1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5pLmFkZChTdHJpbmcoYSksYiwhMSxjLGQpfTtFLnByb3RvdHlwZS5MPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLmkuYWRkKFN0cmluZyhhKSxiLCEwLGMsZCl9O1xuZnVuY3Rpb24gYWIoYSxiLGMsZCl7Yj1hLmkuZ1tTdHJpbmcoYildO2lmKCFiKXJldHVybiAhMDtiPWIuY29uY2F0KCk7Zm9yKHZhciBlPSEwLGY9MDtmPGIubGVuZ3RoOysrZil7dmFyIGc9YltmXTtpZihnJiYhZy5kYSYmZy5jYXB0dXJlPT1jKXt2YXIgbT1nLmxpc3RlbmVyLHE9Zy5oYXx8Zy5zcmM7Zy5mYSYmTWEoYS5pLGcpO2U9ITEhPT1tLmNhbGwocSxkKSYmZTt9fXJldHVybiBlJiYhZC5kZWZhdWx0UHJldmVudGVkfWZ1bmN0aW9uIGJiKGEsYixjKXtpZihcImZ1bmN0aW9uXCI9PT10eXBlb2YgYSljJiYoYT1wKGEsYykpO2Vsc2UgaWYoYSYmXCJmdW5jdGlvblwiPT10eXBlb2YgYS5oYW5kbGVFdmVudClhPXAoYS5oYW5kbGVFdmVudCxhKTtlbHNlIHRocm93IEVycm9yKFwiSW52YWxpZCBsaXN0ZW5lciBhcmd1bWVudFwiKTtyZXR1cm4gMjE0NzQ4MzY0NzxOdW1iZXIoYik/LTE6ay5zZXRUaW1lb3V0KGEsYnx8MCl9ZnVuY3Rpb24gY2IoYSl7YS5nPWJiKCgpPT57YS5nPW51bGw7YS5pJiYoYS5pPSExLGNiKGEpKTt9LGEubCk7Y29uc3QgYj1hLmg7YS5oPW51bGw7YS5tLmFwcGx5KG51bGwsYik7fWNsYXNzIGViIGV4dGVuZHMgentjb25zdHJ1Y3RvcihhLGIpe3N1cGVyKCk7dGhpcy5tPWE7dGhpcy5sPWI7dGhpcy5oPW51bGw7dGhpcy5pPSExO3RoaXMuZz1udWxsO31qKGEpe3RoaXMuaD1hcmd1bWVudHM7dGhpcy5nP3RoaXMuaT0hMDpjYih0aGlzKTt9Tigpe3N1cGVyLk4oKTt0aGlzLmcmJihrLmNsZWFyVGltZW91dCh0aGlzLmcpLHRoaXMuZz1udWxsLHRoaXMuaT0hMSx0aGlzLmg9bnVsbCk7fX1mdW5jdGlvbiBHKGEpe3ouY2FsbCh0aGlzKTt0aGlzLmg9YTt0aGlzLmc9e307fXIoRyx6KTt2YXIgZmI9W107ZnVuY3Rpb24gZ2IoYSl7cWEoYS5nLGZ1bmN0aW9uKGIsYyl7dGhpcy5nLmhhc093blByb3BlcnR5KGMpJiZaYShiKTt9LGEpO2EuZz17fTt9Ry5wcm90b3R5cGUuTj1mdW5jdGlvbigpe0cuYWEuTi5jYWxsKHRoaXMpO2diKHRoaXMpO307Ry5wcm90b3R5cGUuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oKXt0aHJvdyBFcnJvcihcIkV2ZW50SGFuZGxlci5oYW5kbGVFdmVudCBub3QgaW1wbGVtZW50ZWRcIik7fTt2YXIgaGI9ay5KU09OLnN0cmluZ2lmeTt2YXIgaWI9ay5KU09OLnBhcnNlO3ZhciBqYj1jbGFzc3tzdHJpbmdpZnkoYSl7cmV0dXJuIGsuSlNPTi5zdHJpbmdpZnkoYSx2b2lkIDApfXBhcnNlKGEpe3JldHVybiBrLkpTT04ucGFyc2UoYSx2b2lkIDApfX07ZnVuY3Rpb24ga2IoKXt9a2IucHJvdG90eXBlLmg9bnVsbDtmdW5jdGlvbiBsYihhKXtyZXR1cm4gYS5ofHwoYS5oPWEuaSgpKX1mdW5jdGlvbiBtYigpe312YXIgSD17T1BFTjpcImFcIixrYjpcImJcIixKYTpcImNcIix3YjpcImRcIn07ZnVuY3Rpb24gbmIoKXtBLmNhbGwodGhpcyxcImRcIik7fXIobmIsQSk7ZnVuY3Rpb24gb2IoKXtBLmNhbGwodGhpcyxcImNcIik7fXIob2IsQSk7dmFyIEk9e30scGI9bnVsbDtmdW5jdGlvbiBxYigpe3JldHVybiBwYj1wYnx8bmV3IEV9SS5MYT1cInNlcnZlcnJlYWNoYWJpbGl0eVwiO2Z1bmN0aW9uIHJiKGEpe0EuY2FsbCh0aGlzLEkuTGEsYSk7fXIocmIsQSk7ZnVuY3Rpb24gSihhKXtjb25zdCBiPXFiKCk7RihiLG5ldyByYihiKSk7fUkuU1RBVF9FVkVOVD1cInN0YXRldmVudFwiO2Z1bmN0aW9uIHNiKGEsYil7QS5jYWxsKHRoaXMsSS5TVEFUX0VWRU5ULGEpO3RoaXMuc3RhdD1iO31yKHNiLEEpO2Z1bmN0aW9uIEsoYSl7Y29uc3QgYj1xYigpO0YoYixuZXcgc2IoYixhKSk7fUkuTWE9XCJ0aW1pbmdldmVudFwiO2Z1bmN0aW9uIHRiKGEsYil7QS5jYWxsKHRoaXMsSS5NYSxhKTt0aGlzLnNpemU9Yjt9cih0YixBKTtcbmZ1bmN0aW9uIHViKGEsYil7aWYoXCJmdW5jdGlvblwiIT09dHlwZW9mIGEpdGhyb3cgRXJyb3IoXCJGbiBtdXN0IG5vdCBiZSBudWxsIGFuZCBtdXN0IGJlIGEgZnVuY3Rpb25cIik7cmV0dXJuIGsuc2V0VGltZW91dChmdW5jdGlvbigpe2EoKTt9LGIpfWZ1bmN0aW9uIHZiKCl7dGhpcy5nPSEwO312Yi5wcm90b3R5cGUueGE9ZnVuY3Rpb24oKXt0aGlzLmc9ITE7fTtmdW5jdGlvbiB3YihhLGIsYyxkLGUsZil7YS5pbmZvKGZ1bmN0aW9uKCl7aWYoYS5nKWlmKGYpe3ZhciBnPVwiXCI7Zm9yKHZhciBtPWYuc3BsaXQoXCImXCIpLHE9MDtxPG0ubGVuZ3RoO3ErKyl7dmFyIGw9bVtxXS5zcGxpdChcIj1cIik7aWYoMTxsLmxlbmd0aCl7dmFyIHY9bFswXTtsPWxbMV07dmFyIHc9di5zcGxpdChcIl9cIik7Zz0yPD13Lmxlbmd0aCYmXCJ0eXBlXCI9PXdbMV0/ZysoditcIj1cIitsK1wiJlwiKTpnKyh2K1wiPXJlZGFjdGVkJlwiKTt9fX1lbHNlIGc9bnVsbDtlbHNlIGc9ZjtyZXR1cm4gXCJYTUxIVFRQIFJFUSAoXCIrZCtcIikgW2F0dGVtcHQgXCIrZStcIl06IFwiK2IrXCJcXG5cIitjK1wiXFxuXCIrZ30pO31cbmZ1bmN0aW9uIHhiKGEsYixjLGQsZSxmLGcpe2EuaW5mbyhmdW5jdGlvbigpe3JldHVybiBcIlhNTEhUVFAgUkVTUCAoXCIrZCtcIikgWyBhdHRlbXB0IFwiK2UrXCJdOiBcIitiK1wiXFxuXCIrYytcIlxcblwiK2YrXCIgXCIrZ30pO31mdW5jdGlvbiBMKGEsYixjLGQpe2EuaW5mbyhmdW5jdGlvbigpe3JldHVybiBcIlhNTEhUVFAgVEVYVCAoXCIrYitcIik6IFwiK3liKGEsYykrKGQ/XCIgXCIrZDpcIlwiKX0pO31mdW5jdGlvbiB6YihhLGIpe2EuaW5mbyhmdW5jdGlvbigpe3JldHVybiBcIlRJTUVPVVQ6IFwiK2J9KTt9dmIucHJvdG90eXBlLmluZm89ZnVuY3Rpb24oKXt9O1xuZnVuY3Rpb24geWIoYSxiKXtpZighYS5nKXJldHVybiBiO2lmKCFiKXJldHVybiBudWxsO3RyeXt2YXIgYz1KU09OLnBhcnNlKGIpO2lmKGMpZm9yKGE9MDthPGMubGVuZ3RoO2ErKylpZihBcnJheS5pc0FycmF5KGNbYV0pKXt2YXIgZD1jW2FdO2lmKCEoMj5kLmxlbmd0aCkpe3ZhciBlPWRbMV07aWYoQXJyYXkuaXNBcnJheShlKSYmISgxPmUubGVuZ3RoKSl7dmFyIGY9ZVswXTtpZihcIm5vb3BcIiE9ZiYmXCJzdG9wXCIhPWYmJlwiY2xvc2VcIiE9Zilmb3IodmFyIGc9MTtnPGUubGVuZ3RoO2crKyllW2ddPVwiXCI7fX19cmV0dXJuIGhiKGMpfWNhdGNoKG0pe3JldHVybiBifX12YXIgQWI9e05PX0VSUk9SOjAsZ2I6MSx0YjoyLHNiOjMsbmI6NCxyYjo1LHViOjYsSWE6NyxUSU1FT1VUOjgseGI6OX07dmFyIEJiPXtsYjpcImNvbXBsZXRlXCIsSGI6XCJzdWNjZXNzXCIsSmE6XCJlcnJvclwiLElhOlwiYWJvcnRcIix6YjpcInJlYWR5XCIsQWI6XCJyZWFkeXN0YXRlY2hhbmdlXCIsVElNRU9VVDpcInRpbWVvdXRcIix2YjpcImluY3JlbWVudGFsZGF0YVwiLHliOlwicHJvZ3Jlc3NcIixvYjpcImRvd25sb2FkcHJvZ3Jlc3NcIixQYjpcInVwbG9hZHByb2dyZXNzXCJ9O3ZhciBDYjtmdW5jdGlvbiBEYigpe31yKERiLGtiKTtEYi5wcm90b3R5cGUuZz1mdW5jdGlvbigpe3JldHVybiBuZXcgWE1MSHR0cFJlcXVlc3R9O0RiLnByb3RvdHlwZS5pPWZ1bmN0aW9uKCl7cmV0dXJuIHt9fTtDYj1uZXcgRGI7ZnVuY3Rpb24gTShhLGIsYyxkKXt0aGlzLmo9YTt0aGlzLmk9Yjt0aGlzLmw9Yzt0aGlzLlI9ZHx8MTt0aGlzLlU9bmV3IEcodGhpcyk7dGhpcy5JPTQ1RTM7dGhpcy5IPW51bGw7dGhpcy5vPSExO3RoaXMubT10aGlzLkE9dGhpcy52PXRoaXMuTD10aGlzLkY9dGhpcy5TPXRoaXMuQj1udWxsO3RoaXMuRD1bXTt0aGlzLmc9bnVsbDt0aGlzLkM9MDt0aGlzLnM9dGhpcy51PW51bGw7dGhpcy5YPS0xO3RoaXMuSj0hMTt0aGlzLk89MDt0aGlzLk09bnVsbDt0aGlzLlc9dGhpcy5LPXRoaXMuVD10aGlzLlA9ITE7dGhpcy5oPW5ldyBFYjt9ZnVuY3Rpb24gRWIoKXt0aGlzLmk9bnVsbDt0aGlzLmc9XCJcIjt0aGlzLmg9ITE7fXZhciBGYj17fSxHYj17fTtmdW5jdGlvbiBIYihhLGIsYyl7YS5MPTE7YS52PUliKE4oYikpO2EubT1jO2EuUD0hMDtKYihhLG51bGwpO31cbmZ1bmN0aW9uIEpiKGEsYil7YS5GPURhdGUubm93KCk7S2IoYSk7YS5BPU4oYS52KTt2YXIgYz1hLkEsZD1hLlI7QXJyYXkuaXNBcnJheShkKXx8KGQ9W1N0cmluZyhkKV0pO0xiKGMuaSxcInRcIixkKTthLkM9MDtjPWEuai5KO2EuaD1uZXcgRWI7YS5nPU1iKGEuaixjP2I6bnVsbCwhYS5tKTswPGEuTyYmKGEuTT1uZXcgZWIocChhLlksYSxhLmcpLGEuTykpO2I9YS5VO2M9YS5nO2Q9YS5jYTt2YXIgZT1cInJlYWR5c3RhdGVjaGFuZ2VcIjtBcnJheS5pc0FycmF5KGUpfHwoZSYmKGZiWzBdPWUudG9TdHJpbmcoKSksZT1mYik7Zm9yKHZhciBmPTA7ZjxlLmxlbmd0aDtmKyspe3ZhciBnPVFhKGMsZVtmXSxkfHxiLmhhbmRsZUV2ZW50LCExLGIuaHx8Yik7aWYoIWcpYnJlYWs7Yi5nW2cua2V5XT1nO31iPWEuSD9zYShhLkgpOnt9O2EubT8oYS51fHwoYS51PVwiUE9TVFwiKSxiW1wiQ29udGVudC1UeXBlXCJdPVwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsYS5nLmVhKGEuQSxhLnUsXG5hLm0sYikpOihhLnU9XCJHRVRcIixhLmcuZWEoYS5BLGEudSxudWxsLGIpKTtKKCk7d2IoYS5pLGEudSxhLkEsYS5sLGEuUixhLm0pO31NLnByb3RvdHlwZS5jYT1mdW5jdGlvbihhKXthPWEudGFyZ2V0O2NvbnN0IGI9dGhpcy5NO2ImJjM9PVAoYSk/Yi5qKCk6dGhpcy5ZKGEpO307XG5NLnByb3RvdHlwZS5ZPWZ1bmN0aW9uKGEpe3RyeXtpZihhPT10aGlzLmcpYTp7Y29uc3Qgdz1QKHRoaXMuZyk7dmFyIGI9dGhpcy5nLkJhKCk7Y29uc3QgTz10aGlzLmcuWigpO2lmKCEoMz53KSYmKDMhPXd8fHRoaXMuZyYmKHRoaXMuaC5ofHx0aGlzLmcub2EoKXx8TmIodGhpcy5nKSkpKXt0aGlzLkp8fDQhPXd8fDc9PWJ8fCg4PT1ifHwwPj1PP0ooMyk6SigyKSk7T2IodGhpcyk7dmFyIGM9dGhpcy5nLlooKTt0aGlzLlg9YztiOmlmKFBiKHRoaXMpKXt2YXIgZD1OYih0aGlzLmcpO2E9XCJcIjt2YXIgZT1kLmxlbmd0aCxmPTQ9PVAodGhpcy5nKTtpZighdGhpcy5oLmkpe2lmKFwidW5kZWZpbmVkXCI9PT10eXBlb2YgVGV4dERlY29kZXIpe1EodGhpcyk7UWIodGhpcyk7dmFyIGc9XCJcIjticmVhayBifXRoaXMuaC5pPW5ldyBrLlRleHREZWNvZGVyO31mb3IoYj0wO2I8ZTtiKyspdGhpcy5oLmg9ITAsYSs9dGhpcy5oLmkuZGVjb2RlKGRbYl0se3N0cmVhbTohKGYmJmI9PWUtMSl9KTtkLmxlbmd0aD1cbjA7dGhpcy5oLmcrPWE7dGhpcy5DPTA7Zz10aGlzLmguZzt9ZWxzZSBnPXRoaXMuZy5vYSgpO3RoaXMubz0yMDA9PWM7eGIodGhpcy5pLHRoaXMudSx0aGlzLkEsdGhpcy5sLHRoaXMuUix3LGMpO2lmKHRoaXMubyl7aWYodGhpcy5UJiYhdGhpcy5LKXtiOntpZih0aGlzLmcpe3ZhciBtLHE9dGhpcy5nO2lmKChtPXEuZz9xLmcuZ2V0UmVzcG9uc2VIZWFkZXIoXCJYLUhUVFAtSW5pdGlhbC1SZXNwb25zZVwiKTpudWxsKSYmIXQobSkpe3ZhciBsPW07YnJlYWsgYn19bD1udWxsO31pZihjPWwpTCh0aGlzLmksdGhpcy5sLGMsXCJJbml0aWFsIGhhbmRzaGFrZSByZXNwb25zZSB2aWEgWC1IVFRQLUluaXRpYWwtUmVzcG9uc2VcIiksdGhpcy5LPSEwLFJiKHRoaXMsYyk7ZWxzZSB7dGhpcy5vPSExO3RoaXMucz0zO0soMTIpO1EodGhpcyk7UWIodGhpcyk7YnJlYWsgYX19aWYodGhpcy5QKXtjPSEwO2xldCBCO2Zvcig7IXRoaXMuSiYmdGhpcy5DPGcubGVuZ3RoOylpZihCPVNiKHRoaXMsZyksQj09R2IpezQ9PVxudyYmKHRoaXMucz00LEsoMTQpLGM9ITEpO0wodGhpcy5pLHRoaXMubCxudWxsLFwiW0luY29tcGxldGUgUmVzcG9uc2VdXCIpO2JyZWFrfWVsc2UgaWYoQj09RmIpe3RoaXMucz00O0soMTUpO0wodGhpcy5pLHRoaXMubCxnLFwiW0ludmFsaWQgQ2h1bmtdXCIpO2M9ITE7YnJlYWt9ZWxzZSBMKHRoaXMuaSx0aGlzLmwsQixudWxsKSxSYih0aGlzLEIpO1BiKHRoaXMpJiYwIT10aGlzLkMmJih0aGlzLmguZz10aGlzLmguZy5zbGljZSh0aGlzLkMpLHRoaXMuQz0wKTs0IT13fHwwIT1nLmxlbmd0aHx8dGhpcy5oLmh8fCh0aGlzLnM9MSxLKDE2KSxjPSExKTt0aGlzLm89dGhpcy5vJiZjO2lmKCFjKUwodGhpcy5pLHRoaXMubCxnLFwiW0ludmFsaWQgQ2h1bmtlZCBSZXNwb25zZV1cIiksUSh0aGlzKSxRYih0aGlzKTtlbHNlIGlmKDA8Zy5sZW5ndGgmJiF0aGlzLlcpe3RoaXMuVz0hMDt2YXIgdj10aGlzLmo7di5nPT10aGlzJiZ2LmJhJiYhdi5NJiYodi5qLmluZm8oXCJHcmVhdCwgbm8gYnVmZmVyaW5nIHByb3h5IGRldGVjdGVkLiBCeXRlcyByZWNlaXZlZDogXCIrXG5nLmxlbmd0aCksVGIodiksdi5NPSEwLEsoMTEpKTt9fWVsc2UgTCh0aGlzLmksdGhpcy5sLGcsbnVsbCksUmIodGhpcyxnKTs0PT13JiZRKHRoaXMpO3RoaXMubyYmIXRoaXMuSiYmKDQ9PXc/VWIodGhpcy5qLHRoaXMpOih0aGlzLm89ITEsS2IodGhpcykpKTt9ZWxzZSBWYih0aGlzLmcpLDQwMD09YyYmMDxnLmluZGV4T2YoXCJVbmtub3duIFNJRFwiKT8odGhpcy5zPTMsSygxMikpOih0aGlzLnM9MCxLKDEzKSksUSh0aGlzKSxRYih0aGlzKTt9fX1jYXRjaCh3KXt9ZmluYWxseXt9fTtmdW5jdGlvbiBQYihhKXtyZXR1cm4gYS5nP1wiR0VUXCI9PWEudSYmMiE9YS5MJiZhLmouQ2E6ITF9XG5mdW5jdGlvbiBTYihhLGIpe3ZhciBjPWEuQyxkPWIuaW5kZXhPZihcIlxcblwiLGMpO2lmKC0xPT1kKXJldHVybiBHYjtjPU51bWJlcihiLnN1YnN0cmluZyhjLGQpKTtpZihpc05hTihjKSlyZXR1cm4gRmI7ZCs9MTtpZihkK2M+Yi5sZW5ndGgpcmV0dXJuIEdiO2I9Yi5zbGljZShkLGQrYyk7YS5DPWQrYztyZXR1cm4gYn1NLnByb3RvdHlwZS5jYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLko9ITA7USh0aGlzKTt9O2Z1bmN0aW9uIEtiKGEpe2EuUz1EYXRlLm5vdygpK2EuSTtXYihhLGEuSSk7fWZ1bmN0aW9uIFdiKGEsYil7aWYobnVsbCE9YS5CKXRocm93IEVycm9yKFwiV2F0Y2hEb2cgdGltZXIgbm90IG51bGxcIik7YS5CPXViKHAoYS5iYSxhKSxiKTt9ZnVuY3Rpb24gT2IoYSl7YS5CJiYoay5jbGVhclRpbWVvdXQoYS5CKSxhLkI9bnVsbCk7fVxuTS5wcm90b3R5cGUuYmE9ZnVuY3Rpb24oKXt0aGlzLkI9bnVsbDtjb25zdCBhPURhdGUubm93KCk7MDw9YS10aGlzLlM/KHpiKHRoaXMuaSx0aGlzLkEpLDIhPXRoaXMuTCYmKEooKSxLKDE3KSksUSh0aGlzKSx0aGlzLnM9MixRYih0aGlzKSk6V2IodGhpcyx0aGlzLlMtYSk7fTtmdW5jdGlvbiBRYihhKXswPT1hLmouR3x8YS5KfHxVYihhLmosYSk7fWZ1bmN0aW9uIFEoYSl7T2IoYSk7dmFyIGI9YS5NO2ImJlwiZnVuY3Rpb25cIj09dHlwZW9mIGIubWEmJmIubWEoKTthLk09bnVsbDtnYihhLlUpO2EuZyYmKGI9YS5nLGEuZz1udWxsLGIuYWJvcnQoKSxiLm1hKCkpO31cbmZ1bmN0aW9uIFJiKGEsYil7dHJ5e3ZhciBjPWEuajtpZigwIT1jLkcmJihjLmc9PWF8fFhiKGMuaCxhKSkpaWYoIWEuSyYmWGIoYy5oLGEpJiYzPT1jLkcpe3RyeXt2YXIgZD1jLkRhLmcucGFyc2UoYik7fWNhdGNoKGwpe2Q9bnVsbDt9aWYoQXJyYXkuaXNBcnJheShkKSYmMz09ZC5sZW5ndGgpe3ZhciBlPWQ7aWYoMD09ZVswXSlhOntpZighYy51KXtpZihjLmcpaWYoYy5nLkYrM0UzPGEuRilZYihjKSxaYihjKTtlbHNlIGJyZWFrIGE7JGIoYyk7SygxOCk7fX1lbHNlIGMuemE9ZVsxXSwwPGMuemEtYy5UJiYzNzUwMD5lWzJdJiZjLkYmJjA9PWMudiYmIWMuQyYmKGMuQz11YihwKGMuWmEsYyksNkUzKSk7aWYoMT49YWMoYy5oKSYmYy5jYSl7dHJ5e2MuY2EoKTt9Y2F0Y2gobCl7fWMuY2E9dm9pZCAwO319ZWxzZSBSKGMsMTEpO31lbHNlIGlmKChhLkt8fGMuZz09YSkmJlliKGMpLCF0KGIpKWZvcihlPWMuRGEuZy5wYXJzZShiKSxiPTA7YjxlLmxlbmd0aDtiKyspe2xldCBsPWVbYl07Yy5UPVxubFswXTtsPWxbMV07aWYoMj09Yy5HKWlmKFwiY1wiPT1sWzBdKXtjLks9bFsxXTtjLmlhPWxbMl07Y29uc3Qgdj1sWzNdO251bGwhPXYmJihjLmxhPXYsYy5qLmluZm8oXCJWRVI9XCIrYy5sYSkpO2NvbnN0IHc9bFs0XTtudWxsIT13JiYoYy5BYT13LGMuai5pbmZvKFwiU1ZFUj1cIitjLkFhKSk7Y29uc3QgTz1sWzVdO251bGwhPU8mJlwibnVtYmVyXCI9PT10eXBlb2YgTyYmMDxPJiYoZD0xLjUqTyxjLkw9ZCxjLmouaW5mbyhcImJhY2tDaGFubmVsUmVxdWVzdFRpbWVvdXRNc189XCIrZCkpO2Q9Yztjb25zdCBCPWEuZztpZihCKXtjb25zdCB5YT1CLmc/Qi5nLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1DbGllbnQtV2lyZS1Qcm90b2NvbFwiKTpudWxsO2lmKHlhKXt2YXIgZj1kLmg7Zi5nfHwtMT09eWEuaW5kZXhPZihcInNwZHlcIikmJi0xPT15YS5pbmRleE9mKFwicXVpY1wiKSYmLTE9PXlhLmluZGV4T2YoXCJoMlwiKXx8KGYuaj1mLmwsZi5nPW5ldyBTZXQsZi5oJiYoYmMoZixmLmgpLGYuaD1udWxsKSk7fWlmKGQuRCl7Y29uc3QgZGI9XG5CLmc/Qi5nLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1IVFRQLVNlc3Npb24tSWRcIik6bnVsbDtkYiYmKGQueWE9ZGIsUyhkLkksZC5ELGRiKSk7fX1jLkc9MztjLmwmJmMubC51YSgpO2MuYmEmJihjLlI9RGF0ZS5ub3coKS1hLkYsYy5qLmluZm8oXCJIYW5kc2hha2UgUlRUOiBcIitjLlIrXCJtc1wiKSk7ZD1jO3ZhciBnPWE7ZC5xYT1jYyhkLGQuSj9kLmlhOm51bGwsZC5XKTtpZihnLkspe2RjKGQuaCxnKTt2YXIgbT1nLHE9ZC5MO3EmJihtLkk9cSk7bS5CJiYoT2IobSksS2IobSkpO2QuZz1nO31lbHNlIGVjKGQpOzA8Yy5pLmxlbmd0aCYmZmMoYyk7fWVsc2UgXCJzdG9wXCIhPWxbMF0mJlwiY2xvc2VcIiE9bFswXXx8UihjLDcpO2Vsc2UgMz09Yy5HJiYoXCJzdG9wXCI9PWxbMF18fFwiY2xvc2VcIj09bFswXT9cInN0b3BcIj09bFswXT9SKGMsNyk6Z2MoYyk6XCJub29wXCIhPWxbMF0mJmMubCYmYy5sLnRhKGwpLGMudj0wKTt9Sig0KTt9Y2F0Y2gobCl7fX12YXIgaGM9Y2xhc3N7Y29uc3RydWN0b3IoYSxiKXt0aGlzLmc9YTt0aGlzLm1hcD1iO319O2Z1bmN0aW9uIGljKGEpe3RoaXMubD1hfHwxMDtrLlBlcmZvcm1hbmNlTmF2aWdhdGlvblRpbWluZz8oYT1rLnBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoXCJuYXZpZ2F0aW9uXCIpLGE9MDxhLmxlbmd0aCYmKFwiaHFcIj09YVswXS5uZXh0SG9wUHJvdG9jb2x8fFwiaDJcIj09YVswXS5uZXh0SG9wUHJvdG9jb2wpKTphPSEhKGsuY2hyb21lJiZrLmNocm9tZS5sb2FkVGltZXMmJmsuY2hyb21lLmxvYWRUaW1lcygpJiZrLmNocm9tZS5sb2FkVGltZXMoKS53YXNGZXRjaGVkVmlhU3BkeSk7dGhpcy5qPWE/dGhpcy5sOjE7dGhpcy5nPW51bGw7MTx0aGlzLmomJih0aGlzLmc9bmV3IFNldCk7dGhpcy5oPW51bGw7dGhpcy5pPVtdO31mdW5jdGlvbiBqYyhhKXtyZXR1cm4gYS5oPyEwOmEuZz9hLmcuc2l6ZT49YS5qOiExfWZ1bmN0aW9uIGFjKGEpe3JldHVybiBhLmg/MTphLmc/YS5nLnNpemU6MH1mdW5jdGlvbiBYYihhLGIpe3JldHVybiBhLmg/YS5oPT1iOmEuZz9hLmcuaGFzKGIpOiExfVxuZnVuY3Rpb24gYmMoYSxiKXthLmc/YS5nLmFkZChiKTphLmg9Yjt9ZnVuY3Rpb24gZGMoYSxiKXthLmgmJmEuaD09Yj9hLmg9bnVsbDphLmcmJmEuZy5oYXMoYikmJmEuZy5kZWxldGUoYik7fWljLnByb3RvdHlwZS5jYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLmk9a2ModGhpcyk7aWYodGhpcy5oKXRoaXMuaC5jYW5jZWwoKSx0aGlzLmg9bnVsbDtlbHNlIGlmKHRoaXMuZyYmMCE9PXRoaXMuZy5zaXplKXtmb3IoY29uc3QgYSBvZiB0aGlzLmcudmFsdWVzKCkpYS5jYW5jZWwoKTt0aGlzLmcuY2xlYXIoKTt9fTtmdW5jdGlvbiBrYyhhKXtpZihudWxsIT1hLmgpcmV0dXJuIGEuaS5jb25jYXQoYS5oLkQpO2lmKG51bGwhPWEuZyYmMCE9PWEuZy5zaXplKXtsZXQgYj1hLmk7Zm9yKGNvbnN0IGMgb2YgYS5nLnZhbHVlcygpKWI9Yi5jb25jYXQoYy5EKTtyZXR1cm4gYn1yZXR1cm4gbGEoYS5pKX1mdW5jdGlvbiBsYyhhKXtpZihhLlYmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuVilyZXR1cm4gYS5WKCk7aWYoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBNYXAmJmEgaW5zdGFuY2VvZiBNYXB8fFwidW5kZWZpbmVkXCIhPT10eXBlb2YgU2V0JiZhIGluc3RhbmNlb2YgU2V0KXJldHVybiBBcnJheS5mcm9tKGEudmFsdWVzKCkpO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYSlyZXR1cm4gYS5zcGxpdChcIlwiKTtpZihoYShhKSl7Zm9yKHZhciBiPVtdLGM9YS5sZW5ndGgsZD0wO2Q8YztkKyspYi5wdXNoKGFbZF0pO3JldHVybiBifWI9W107Yz0wO2ZvcihkIGluIGEpYltjKytdPWFbZF07cmV0dXJuIGJ9XG5mdW5jdGlvbiBtYyhhKXtpZihhLm5hJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhLm5hKXJldHVybiBhLm5hKCk7aWYoIWEuVnx8XCJmdW5jdGlvblwiIT10eXBlb2YgYS5WKXtpZihcInVuZGVmaW5lZFwiIT09dHlwZW9mIE1hcCYmYSBpbnN0YW5jZW9mIE1hcClyZXR1cm4gQXJyYXkuZnJvbShhLmtleXMoKSk7aWYoIShcInVuZGVmaW5lZFwiIT09dHlwZW9mIFNldCYmYSBpbnN0YW5jZW9mIFNldCkpe2lmKGhhKGEpfHxcInN0cmluZ1wiPT09dHlwZW9mIGEpe3ZhciBiPVtdO2E9YS5sZW5ndGg7Zm9yKHZhciBjPTA7YzxhO2MrKyliLnB1c2goYyk7cmV0dXJuIGJ9Yj1bXTtjPTA7Zm9yKGNvbnN0IGQgaW4gYSliW2MrK109ZDtyZXR1cm4gYn19fVxuZnVuY3Rpb24gbmMoYSxiKXtpZihhLmZvckVhY2gmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuZm9yRWFjaClhLmZvckVhY2goYix2b2lkIDApO2Vsc2UgaWYoaGEoYSl8fFwic3RyaW5nXCI9PT10eXBlb2YgYSlBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGEsYix2b2lkIDApO2Vsc2UgZm9yKHZhciBjPW1jKGEpLGQ9bGMoYSksZT1kLmxlbmd0aCxmPTA7ZjxlO2YrKyliLmNhbGwodm9pZCAwLGRbZl0sYyYmY1tmXSxhKTt9dmFyIG9jPVJlZ0V4cChcIl4oPzooW146Lz8jLl0rKTopPyg/Oi8vKD86KFteXFxcXFxcXFwvPyNdKilAKT8oW15cXFxcXFxcXC8/I10qPykoPzo6KFswLTldKykpPyg/PVtcXFxcXFxcXC8/I118JCkpPyhbXj8jXSspPyg/OlxcXFw/KFteI10qKSk/KD86IyhbXFxcXHNcXFxcU10qKSk/JFwiKTtmdW5jdGlvbiBwYyhhLGIpe2lmKGEpe2E9YS5zcGxpdChcIiZcIik7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspe3ZhciBkPWFbY10uaW5kZXhPZihcIj1cIiksZT1udWxsO2lmKDA8PWQpe3ZhciBmPWFbY10uc3Vic3RyaW5nKDAsZCk7ZT1hW2NdLnN1YnN0cmluZyhkKzEpO31lbHNlIGY9YVtjXTtiKGYsZT9kZWNvZGVVUklDb21wb25lbnQoZS5yZXBsYWNlKC9cXCsvZyxcIiBcIikpOlwiXCIpO319fWZ1bmN0aW9uIFQoYSl7dGhpcy5nPXRoaXMubz10aGlzLmo9XCJcIjt0aGlzLnM9bnVsbDt0aGlzLm09dGhpcy5sPVwiXCI7dGhpcy5oPSExO2lmKGEgaW5zdGFuY2VvZiBUKXt0aGlzLmg9YS5oO3FjKHRoaXMsYS5qKTt0aGlzLm89YS5vO3RoaXMuZz1hLmc7cmModGhpcyxhLnMpO3RoaXMubD1hLmw7dmFyIGI9YS5pO3ZhciBjPW5ldyBzYztjLmk9Yi5pO2IuZyYmKGMuZz1uZXcgTWFwKGIuZyksYy5oPWIuaCk7dGModGhpcyxjKTt0aGlzLm09YS5tO31lbHNlIGEmJihiPVN0cmluZyhhKS5tYXRjaChvYykpPyh0aGlzLmg9ITEscWModGhpcyxiWzFdfHxcIlwiLCEwKSx0aGlzLm89dWMoYlsyXXx8XCJcIiksdGhpcy5nPXVjKGJbM118fFwiXCIsITApLHJjKHRoaXMsYls0XSksdGhpcy5sPXVjKGJbNV18fFwiXCIsITApLHRjKHRoaXMsYls2XXx8XCJcIiwhMCksdGhpcy5tPXVjKGJbN118fFwiXCIpKToodGhpcy5oPSExLHRoaXMuaT1uZXcgc2MobnVsbCx0aGlzLmgpKTt9XG5ULnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3ZhciBhPVtdLGI9dGhpcy5qO2ImJmEucHVzaCh2YyhiLHdjLCEwKSxcIjpcIik7dmFyIGM9dGhpcy5nO2lmKGN8fFwiZmlsZVwiPT1iKWEucHVzaChcIi8vXCIpLChiPXRoaXMubykmJmEucHVzaCh2YyhiLHdjLCEwKSxcIkBcIiksYS5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoYykpLnJlcGxhY2UoLyUyNShbMC05YS1mQS1GXXsyfSkvZyxcIiUkMVwiKSksYz10aGlzLnMsbnVsbCE9YyYmYS5wdXNoKFwiOlwiLFN0cmluZyhjKSk7aWYoYz10aGlzLmwpdGhpcy5nJiZcIi9cIiE9Yy5jaGFyQXQoMCkmJmEucHVzaChcIi9cIiksYS5wdXNoKHZjKGMsXCIvXCI9PWMuY2hhckF0KDApP3hjOnljLCEwKSk7KGM9dGhpcy5pLnRvU3RyaW5nKCkpJiZhLnB1c2goXCI/XCIsYyk7KGM9dGhpcy5tKSYmYS5wdXNoKFwiI1wiLHZjKGMsemMpKTtyZXR1cm4gYS5qb2luKFwiXCIpfTtmdW5jdGlvbiBOKGEpe3JldHVybiBuZXcgVChhKX1cbmZ1bmN0aW9uIHFjKGEsYixjKXthLmo9Yz91YyhiLCEwKTpiO2EuaiYmKGEuaj1hLmoucmVwbGFjZSgvOiQvLFwiXCIpKTt9ZnVuY3Rpb24gcmMoYSxiKXtpZihiKXtiPU51bWJlcihiKTtpZihpc05hTihiKXx8MD5iKXRocm93IEVycm9yKFwiQmFkIHBvcnQgbnVtYmVyIFwiK2IpO2Eucz1iO31lbHNlIGEucz1udWxsO31mdW5jdGlvbiB0YyhhLGIsYyl7YiBpbnN0YW5jZW9mIHNjPyhhLmk9YixBYyhhLmksYS5oKSk6KGN8fChiPXZjKGIsQmMpKSxhLmk9bmV3IHNjKGIsYS5oKSk7fWZ1bmN0aW9uIFMoYSxiLGMpe2EuaS5zZXQoYixjKTt9ZnVuY3Rpb24gSWIoYSl7UyhhLFwienhcIixNYXRoLmZsb29yKDIxNDc0ODM2NDgqTWF0aC5yYW5kb20oKSkudG9TdHJpbmcoMzYpK01hdGguYWJzKE1hdGguZmxvb3IoMjE0NzQ4MzY0OCpNYXRoLnJhbmRvbSgpKV5EYXRlLm5vdygpKS50b1N0cmluZygzNikpO3JldHVybiBhfVxuZnVuY3Rpb24gdWMoYSxiKXtyZXR1cm4gYT9iP2RlY29kZVVSSShhLnJlcGxhY2UoLyUyNS9nLFwiJTI1MjVcIikpOmRlY29kZVVSSUNvbXBvbmVudChhKTpcIlwifWZ1bmN0aW9uIHZjKGEsYixjKXtyZXR1cm4gXCJzdHJpbmdcIj09PXR5cGVvZiBhPyhhPWVuY29kZVVSSShhKS5yZXBsYWNlKGIsQ2MpLGMmJihhPWEucmVwbGFjZSgvJTI1KFswLTlhLWZBLUZdezJ9KS9nLFwiJSQxXCIpKSxhKTpudWxsfWZ1bmN0aW9uIENjKGEpe2E9YS5jaGFyQ29kZUF0KDApO3JldHVybiBcIiVcIisoYT4+NCYxNSkudG9TdHJpbmcoMTYpKyhhJjE1KS50b1N0cmluZygxNil9dmFyIHdjPS9bI1xcL1xcP0BdL2cseWM9L1sjXFw/Ol0vZyx4Yz0vWyNcXD9dL2csQmM9L1sjXFw/QF0vZyx6Yz0vIy9nO2Z1bmN0aW9uIHNjKGEsYil7dGhpcy5oPXRoaXMuZz1udWxsO3RoaXMuaT1hfHxudWxsO3RoaXMuaj0hIWI7fVxuZnVuY3Rpb24gVShhKXthLmd8fChhLmc9bmV3IE1hcCxhLmg9MCxhLmkmJnBjKGEuaSxmdW5jdGlvbihiLGMpe2EuYWRkKGRlY29kZVVSSUNvbXBvbmVudChiLnJlcGxhY2UoL1xcKy9nLFwiIFwiKSksYyk7fSkpO31oPXNjLnByb3RvdHlwZTtoLmFkZD1mdW5jdGlvbihhLGIpe1UodGhpcyk7dGhpcy5pPW51bGw7YT1WKHRoaXMsYSk7dmFyIGM9dGhpcy5nLmdldChhKTtjfHx0aGlzLmcuc2V0KGEsYz1bXSk7Yy5wdXNoKGIpO3RoaXMuaCs9MTtyZXR1cm4gdGhpc307ZnVuY3Rpb24gRGMoYSxiKXtVKGEpO2I9VihhLGIpO2EuZy5oYXMoYikmJihhLmk9bnVsbCxhLmgtPWEuZy5nZXQoYikubGVuZ3RoLGEuZy5kZWxldGUoYikpO31mdW5jdGlvbiBFYyhhLGIpe1UoYSk7Yj1WKGEsYik7cmV0dXJuIGEuZy5oYXMoYil9XG5oLmZvckVhY2g9ZnVuY3Rpb24oYSxiKXtVKHRoaXMpO3RoaXMuZy5mb3JFYWNoKGZ1bmN0aW9uKGMsZCl7Yy5mb3JFYWNoKGZ1bmN0aW9uKGUpe2EuY2FsbChiLGUsZCx0aGlzKTt9LHRoaXMpO30sdGhpcyk7fTtoLm5hPWZ1bmN0aW9uKCl7VSh0aGlzKTtjb25zdCBhPUFycmF5LmZyb20odGhpcy5nLnZhbHVlcygpKSxiPUFycmF5LmZyb20odGhpcy5nLmtleXMoKSksYz1bXTtmb3IobGV0IGQ9MDtkPGIubGVuZ3RoO2QrKyl7Y29uc3QgZT1hW2RdO2ZvcihsZXQgZj0wO2Y8ZS5sZW5ndGg7ZisrKWMucHVzaChiW2RdKTt9cmV0dXJuIGN9O2guVj1mdW5jdGlvbihhKXtVKHRoaXMpO2xldCBiPVtdO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYSlFYyh0aGlzLGEpJiYoYj1iLmNvbmNhdCh0aGlzLmcuZ2V0KFYodGhpcyxhKSkpKTtlbHNlIHthPUFycmF5LmZyb20odGhpcy5nLnZhbHVlcygpKTtmb3IobGV0IGM9MDtjPGEubGVuZ3RoO2MrKyliPWIuY29uY2F0KGFbY10pO31yZXR1cm4gYn07XG5oLnNldD1mdW5jdGlvbihhLGIpe1UodGhpcyk7dGhpcy5pPW51bGw7YT1WKHRoaXMsYSk7RWModGhpcyxhKSYmKHRoaXMuaC09dGhpcy5nLmdldChhKS5sZW5ndGgpO3RoaXMuZy5zZXQoYSxbYl0pO3RoaXMuaCs9MTtyZXR1cm4gdGhpc307aC5nZXQ9ZnVuY3Rpb24oYSxiKXtpZighYSlyZXR1cm4gYjthPXRoaXMuVihhKTtyZXR1cm4gMDxhLmxlbmd0aD9TdHJpbmcoYVswXSk6Yn07ZnVuY3Rpb24gTGIoYSxiLGMpe0RjKGEsYik7MDxjLmxlbmd0aCYmKGEuaT1udWxsLGEuZy5zZXQoVihhLGIpLGxhKGMpKSxhLmgrPWMubGVuZ3RoKTt9XG5oLnRvU3RyaW5nPWZ1bmN0aW9uKCl7aWYodGhpcy5pKXJldHVybiB0aGlzLmk7aWYoIXRoaXMuZylyZXR1cm4gXCJcIjtjb25zdCBhPVtdLGI9QXJyYXkuZnJvbSh0aGlzLmcua2V5cygpKTtmb3IodmFyIGM9MDtjPGIubGVuZ3RoO2MrKyl7dmFyIGQ9YltjXTtjb25zdCBmPWVuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoZCkpLGc9dGhpcy5WKGQpO2ZvcihkPTA7ZDxnLmxlbmd0aDtkKyspe3ZhciBlPWY7XCJcIiE9PWdbZF0mJihlKz1cIj1cIitlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGdbZF0pKSk7YS5wdXNoKGUpO319cmV0dXJuIHRoaXMuaT1hLmpvaW4oXCImXCIpfTtmdW5jdGlvbiBWKGEsYil7Yj1TdHJpbmcoYik7YS5qJiYoYj1iLnRvTG93ZXJDYXNlKCkpO3JldHVybiBifVxuZnVuY3Rpb24gQWMoYSxiKXtiJiYhYS5qJiYoVShhKSxhLmk9bnVsbCxhLmcuZm9yRWFjaChmdW5jdGlvbihjLGQpe3ZhciBlPWQudG9Mb3dlckNhc2UoKTtkIT1lJiYoRGModGhpcyxkKSxMYih0aGlzLGUsYykpO30sYSkpO2Euaj1iO31mdW5jdGlvbiBGYyhhLGIpe2NvbnN0IGM9bmV3IHZiO2lmKGsuSW1hZ2Upe2NvbnN0IGQ9bmV3IEltYWdlO2Qub25sb2FkPWthKFcsYyxcIlRlc3RMb2FkSW1hZ2U6IGxvYWRlZFwiLCEwLGIsZCk7ZC5vbmVycm9yPWthKFcsYyxcIlRlc3RMb2FkSW1hZ2U6IGVycm9yXCIsITEsYixkKTtkLm9uYWJvcnQ9a2EoVyxjLFwiVGVzdExvYWRJbWFnZTogYWJvcnRcIiwhMSxiLGQpO2Qub250aW1lb3V0PWthKFcsYyxcIlRlc3RMb2FkSW1hZ2U6IHRpbWVvdXRcIiwhMSxiLGQpO2suc2V0VGltZW91dChmdW5jdGlvbigpe2lmKGQub250aW1lb3V0KWQub250aW1lb3V0KCk7fSwxRTQpO2Quc3JjPWE7fWVsc2UgYighMSk7fVxuZnVuY3Rpb24gR2MoYSxiKXtjb25zdCBjPW5ldyB2YixkPW5ldyBBYm9ydENvbnRyb2xsZXIsZT1zZXRUaW1lb3V0KCgpPT57ZC5hYm9ydCgpO1coYyxcIlRlc3RQaW5nU2VydmVyOiB0aW1lb3V0XCIsITEsYik7fSwxRTQpO2ZldGNoKGEse3NpZ25hbDpkLnNpZ25hbH0pLnRoZW4oZj0+e2NsZWFyVGltZW91dChlKTtmLm9rP1coYyxcIlRlc3RQaW5nU2VydmVyOiBva1wiLCEwLGIpOlcoYyxcIlRlc3RQaW5nU2VydmVyOiBzZXJ2ZXIgZXJyb3JcIiwhMSxiKTt9KS5jYXRjaCgoKT0+e2NsZWFyVGltZW91dChlKTtXKGMsXCJUZXN0UGluZ1NlcnZlcjogZXJyb3JcIiwhMSxiKTt9KTt9ZnVuY3Rpb24gVyhhLGIsYyxkLGUpe3RyeXtlJiYoZS5vbmxvYWQ9bnVsbCxlLm9uZXJyb3I9bnVsbCxlLm9uYWJvcnQ9bnVsbCxlLm9udGltZW91dD1udWxsKSxkKGMpO31jYXRjaChmKXt9fWZ1bmN0aW9uIEhjKCl7dGhpcy5nPW5ldyBqYjt9ZnVuY3Rpb24gSWMoYSxiLGMpe2NvbnN0IGQ9Y3x8XCJcIjt0cnl7bmMoYSxmdW5jdGlvbihlLGYpe2xldCBnPWU7bihlKSYmKGc9aGIoZSkpO2IucHVzaChkK2YrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGcpKTt9KTt9Y2F0Y2goZSl7dGhyb3cgYi5wdXNoKGQrXCJ0eXBlPVwiK2VuY29kZVVSSUNvbXBvbmVudChcIl9iYWRtYXBcIikpLGU7fX1mdW5jdGlvbiBKYyhhKXt0aGlzLmw9YS5VYnx8bnVsbDt0aGlzLmo9YS5lYnx8ITE7fXIoSmMsa2IpO0pjLnByb3RvdHlwZS5nPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBLYyh0aGlzLmwsdGhpcy5qKX07SmMucHJvdG90eXBlLmk9ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGF9fSh7fSk7ZnVuY3Rpb24gS2MoYSxiKXtFLmNhbGwodGhpcyk7dGhpcy5EPWE7dGhpcy5vPWI7dGhpcy5tPXZvaWQgMDt0aGlzLnN0YXR1cz10aGlzLnJlYWR5U3RhdGU9MDt0aGlzLnJlc3BvbnNlVHlwZT10aGlzLnJlc3BvbnNlVGV4dD10aGlzLnJlc3BvbnNlPXRoaXMuc3RhdHVzVGV4dD1cIlwiO3RoaXMub25yZWFkeXN0YXRlY2hhbmdlPW51bGw7dGhpcy51PW5ldyBIZWFkZXJzO3RoaXMuaD1udWxsO3RoaXMuQj1cIkdFVFwiO3RoaXMuQT1cIlwiO3RoaXMuZz0hMTt0aGlzLnY9dGhpcy5qPXRoaXMubD1udWxsO31yKEtjLEUpO2g9S2MucHJvdG90eXBlO1xuaC5vcGVuPWZ1bmN0aW9uKGEsYil7aWYoMCE9dGhpcy5yZWFkeVN0YXRlKXRocm93IHRoaXMuYWJvcnQoKSxFcnJvcihcIkVycm9yIHJlb3BlbmluZyBhIGNvbm5lY3Rpb25cIik7dGhpcy5CPWE7dGhpcy5BPWI7dGhpcy5yZWFkeVN0YXRlPTE7TGModGhpcyk7fTtoLnNlbmQ9ZnVuY3Rpb24oYSl7aWYoMSE9dGhpcy5yZWFkeVN0YXRlKXRocm93IHRoaXMuYWJvcnQoKSxFcnJvcihcIm5lZWQgdG8gY2FsbCBvcGVuKCkgZmlyc3QuIFwiKTt0aGlzLmc9ITA7Y29uc3QgYj17aGVhZGVyczp0aGlzLnUsbWV0aG9kOnRoaXMuQixjcmVkZW50aWFsczp0aGlzLm0sY2FjaGU6dm9pZCAwfTthJiYoYi5ib2R5PWEpOyh0aGlzLkR8fGspLmZldGNoKG5ldyBSZXF1ZXN0KHRoaXMuQSxiKSkudGhlbih0aGlzLlNhLmJpbmQodGhpcyksdGhpcy5nYS5iaW5kKHRoaXMpKTt9O1xuaC5hYm9ydD1mdW5jdGlvbigpe3RoaXMucmVzcG9uc2U9dGhpcy5yZXNwb25zZVRleHQ9XCJcIjt0aGlzLnU9bmV3IEhlYWRlcnM7dGhpcy5zdGF0dXM9MDt0aGlzLmomJnRoaXMuai5jYW5jZWwoXCJSZXF1ZXN0IHdhcyBhYm9ydGVkLlwiKS5jYXRjaCgoKT0+e30pOzE8PXRoaXMucmVhZHlTdGF0ZSYmdGhpcy5nJiY0IT10aGlzLnJlYWR5U3RhdGUmJih0aGlzLmc9ITEsTWModGhpcykpO3RoaXMucmVhZHlTdGF0ZT0wO307XG5oLlNhPWZ1bmN0aW9uKGEpe2lmKHRoaXMuZyYmKHRoaXMubD1hLHRoaXMuaHx8KHRoaXMuc3RhdHVzPXRoaXMubC5zdGF0dXMsdGhpcy5zdGF0dXNUZXh0PXRoaXMubC5zdGF0dXNUZXh0LHRoaXMuaD1hLmhlYWRlcnMsdGhpcy5yZWFkeVN0YXRlPTIsTGModGhpcykpLHRoaXMuZyYmKHRoaXMucmVhZHlTdGF0ZT0zLExjKHRoaXMpLHRoaXMuZykpKWlmKFwiYXJyYXlidWZmZXJcIj09PXRoaXMucmVzcG9uc2VUeXBlKWEuYXJyYXlCdWZmZXIoKS50aGVuKHRoaXMuUWEuYmluZCh0aGlzKSx0aGlzLmdhLmJpbmQodGhpcykpO2Vsc2UgaWYoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBrLlJlYWRhYmxlU3RyZWFtJiZcImJvZHlcImluIGEpe3RoaXMuaj1hLmJvZHkuZ2V0UmVhZGVyKCk7aWYodGhpcy5vKXtpZih0aGlzLnJlc3BvbnNlVHlwZSl0aHJvdyBFcnJvcigncmVzcG9uc2VUeXBlIG11c3QgYmUgZW1wdHkgZm9yIFwic3RyZWFtQmluYXJ5Q2h1bmtzXCIgbW9kZSByZXNwb25zZXMuJyk7dGhpcy5yZXNwb25zZT1cbltdO31lbHNlIHRoaXMucmVzcG9uc2U9dGhpcy5yZXNwb25zZVRleHQ9XCJcIix0aGlzLnY9bmV3IFRleHREZWNvZGVyO05jKHRoaXMpO31lbHNlIGEudGV4dCgpLnRoZW4odGhpcy5SYS5iaW5kKHRoaXMpLHRoaXMuZ2EuYmluZCh0aGlzKSk7fTtmdW5jdGlvbiBOYyhhKXthLmoucmVhZCgpLnRoZW4oYS5QYS5iaW5kKGEpKS5jYXRjaChhLmdhLmJpbmQoYSkpO31oLlBhPWZ1bmN0aW9uKGEpe2lmKHRoaXMuZyl7aWYodGhpcy5vJiZhLnZhbHVlKXRoaXMucmVzcG9uc2UucHVzaChhLnZhbHVlKTtlbHNlIGlmKCF0aGlzLm8pe3ZhciBiPWEudmFsdWU/YS52YWx1ZTpuZXcgVWludDhBcnJheSgwKTtpZihiPXRoaXMudi5kZWNvZGUoYix7c3RyZWFtOiFhLmRvbmV9KSl0aGlzLnJlc3BvbnNlPXRoaXMucmVzcG9uc2VUZXh0Kz1iO31hLmRvbmU/TWModGhpcyk6TGModGhpcyk7Mz09dGhpcy5yZWFkeVN0YXRlJiZOYyh0aGlzKTt9fTtcbmguUmE9ZnVuY3Rpb24oYSl7dGhpcy5nJiYodGhpcy5yZXNwb25zZT10aGlzLnJlc3BvbnNlVGV4dD1hLE1jKHRoaXMpKTt9O2guUWE9ZnVuY3Rpb24oYSl7dGhpcy5nJiYodGhpcy5yZXNwb25zZT1hLE1jKHRoaXMpKTt9O2guZ2E9ZnVuY3Rpb24oKXt0aGlzLmcmJk1jKHRoaXMpO307ZnVuY3Rpb24gTWMoYSl7YS5yZWFkeVN0YXRlPTQ7YS5sPW51bGw7YS5qPW51bGw7YS52PW51bGw7TGMoYSk7fWguc2V0UmVxdWVzdEhlYWRlcj1mdW5jdGlvbihhLGIpe3RoaXMudS5hcHBlbmQoYSxiKTt9O2guZ2V0UmVzcG9uc2VIZWFkZXI9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuaD90aGlzLmguZ2V0KGEudG9Mb3dlckNhc2UoKSl8fFwiXCI6XCJcIn07XG5oLmdldEFsbFJlc3BvbnNlSGVhZGVycz1mdW5jdGlvbigpe2lmKCF0aGlzLmgpcmV0dXJuIFwiXCI7Y29uc3QgYT1bXSxiPXRoaXMuaC5lbnRyaWVzKCk7Zm9yKHZhciBjPWIubmV4dCgpOyFjLmRvbmU7KWM9Yy52YWx1ZSxhLnB1c2goY1swXStcIjogXCIrY1sxXSksYz1iLm5leHQoKTtyZXR1cm4gYS5qb2luKFwiXFxyXFxuXCIpfTtmdW5jdGlvbiBMYyhhKXthLm9ucmVhZHlzdGF0ZWNoYW5nZSYmYS5vbnJlYWR5c3RhdGVjaGFuZ2UuY2FsbChhKTt9T2JqZWN0LmRlZmluZVByb3BlcnR5KEtjLnByb3RvdHlwZSxcIndpdGhDcmVkZW50aWFsc1wiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gXCJpbmNsdWRlXCI9PT10aGlzLm19LHNldDpmdW5jdGlvbihhKXt0aGlzLm09YT9cImluY2x1ZGVcIjpcInNhbWUtb3JpZ2luXCI7fX0pO2Z1bmN0aW9uIE9jKGEpe2xldCBiPVwiXCI7cWEoYSxmdW5jdGlvbihjLGQpe2IrPWQ7Yis9XCI6XCI7Yis9YztiKz1cIlxcclxcblwiO30pO3JldHVybiBifWZ1bmN0aW9uIFBjKGEsYixjKXthOntmb3IoZCBpbiBjKXt2YXIgZD0hMTticmVhayBhfWQ9ITA7fWR8fChjPU9jKGMpLFwic3RyaW5nXCI9PT10eXBlb2YgYT8obnVsbCE9YyYmZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhjKSkpOlMoYSxiLGMpKTt9ZnVuY3Rpb24gWChhKXtFLmNhbGwodGhpcyk7dGhpcy5oZWFkZXJzPW5ldyBNYXA7dGhpcy5vPWF8fG51bGw7dGhpcy5oPSExO3RoaXMudj10aGlzLmc9bnVsbDt0aGlzLkQ9XCJcIjt0aGlzLm09MDt0aGlzLmw9XCJcIjt0aGlzLmo9dGhpcy5CPXRoaXMudT10aGlzLkE9ITE7dGhpcy5JPW51bGw7dGhpcy5IPVwiXCI7dGhpcy5KPSExO31yKFgsRSk7dmFyIFFjPS9eaHR0cHM/JC9pLFJjPVtcIlBPU1RcIixcIlBVVFwiXTtoPVgucHJvdG90eXBlO2guSGE9ZnVuY3Rpb24oYSl7dGhpcy5KPWE7fTtcbmguZWE9ZnVuY3Rpb24oYSxiLGMsZCl7aWYodGhpcy5nKXRocm93IEVycm9yKFwiW2dvb2cubmV0LlhocklvXSBPYmplY3QgaXMgYWN0aXZlIHdpdGggYW5vdGhlciByZXF1ZXN0PVwiK3RoaXMuRCtcIjsgbmV3VXJpPVwiK2EpO2I9Yj9iLnRvVXBwZXJDYXNlKCk6XCJHRVRcIjt0aGlzLkQ9YTt0aGlzLmw9XCJcIjt0aGlzLm09MDt0aGlzLkE9ITE7dGhpcy5oPSEwO3RoaXMuZz10aGlzLm8/dGhpcy5vLmcoKTpDYi5nKCk7dGhpcy52PXRoaXMubz9sYih0aGlzLm8pOmxiKENiKTt0aGlzLmcub25yZWFkeXN0YXRlY2hhbmdlPXAodGhpcy5FYSx0aGlzKTt0cnl7dGhpcy5CPSEwLHRoaXMuZy5vcGVuKGIsU3RyaW5nKGEpLCEwKSx0aGlzLkI9ITE7fWNhdGNoKGYpe1NjKHRoaXMsZik7cmV0dXJufWE9Y3x8XCJcIjtjPW5ldyBNYXAodGhpcy5oZWFkZXJzKTtpZihkKWlmKE9iamVjdC5nZXRQcm90b3R5cGVPZihkKT09PU9iamVjdC5wcm90b3R5cGUpZm9yKHZhciBlIGluIGQpYy5zZXQoZSxkW2VdKTtlbHNlIGlmKFwiZnVuY3Rpb25cIj09PVxudHlwZW9mIGQua2V5cyYmXCJmdW5jdGlvblwiPT09dHlwZW9mIGQuZ2V0KWZvcihjb25zdCBmIG9mIGQua2V5cygpKWMuc2V0KGYsZC5nZXQoZikpO2Vsc2UgdGhyb3cgRXJyb3IoXCJVbmtub3duIGlucHV0IHR5cGUgZm9yIG9wdF9oZWFkZXJzOiBcIitTdHJpbmcoZCkpO2Q9QXJyYXkuZnJvbShjLmtleXMoKSkuZmluZChmPT5cImNvbnRlbnQtdHlwZVwiPT1mLnRvTG93ZXJDYXNlKCkpO2U9ay5Gb3JtRGF0YSYmYSBpbnN0YW5jZW9mIGsuRm9ybURhdGE7ISgwPD1BcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKFJjLGIsdm9pZCAwKSl8fGR8fGV8fGMuc2V0KFwiQ29udGVudC1UeXBlXCIsXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD11dGYtOFwiKTtmb3IoY29uc3QgW2YsZ11vZiBjKXRoaXMuZy5zZXRSZXF1ZXN0SGVhZGVyKGYsZyk7dGhpcy5IJiYodGhpcy5nLnJlc3BvbnNlVHlwZT10aGlzLkgpO1wid2l0aENyZWRlbnRpYWxzXCJpbiB0aGlzLmcmJnRoaXMuZy53aXRoQ3JlZGVudGlhbHMhPT1cbnRoaXMuSiYmKHRoaXMuZy53aXRoQ3JlZGVudGlhbHM9dGhpcy5KKTt0cnl7VGModGhpcyksdGhpcy51PSEwLHRoaXMuZy5zZW5kKGEpLHRoaXMudT0hMTt9Y2F0Y2goZil7U2ModGhpcyxmKTt9fTtmdW5jdGlvbiBTYyhhLGIpe2EuaD0hMTthLmcmJihhLmo9ITAsYS5nLmFib3J0KCksYS5qPSExKTthLmw9YjthLm09NTtVYyhhKTtWYyhhKTt9ZnVuY3Rpb24gVWMoYSl7YS5BfHwoYS5BPSEwLEYoYSxcImNvbXBsZXRlXCIpLEYoYSxcImVycm9yXCIpKTt9aC5hYm9ydD1mdW5jdGlvbihhKXt0aGlzLmcmJnRoaXMuaCYmKHRoaXMuaD0hMSx0aGlzLmo9ITAsdGhpcy5nLmFib3J0KCksdGhpcy5qPSExLHRoaXMubT1hfHw3LEYodGhpcyxcImNvbXBsZXRlXCIpLEYodGhpcyxcImFib3J0XCIpLFZjKHRoaXMpKTt9O2guTj1mdW5jdGlvbigpe3RoaXMuZyYmKHRoaXMuaCYmKHRoaXMuaD0hMSx0aGlzLmo9ITAsdGhpcy5nLmFib3J0KCksdGhpcy5qPSExKSxWYyh0aGlzLCEwKSk7WC5hYS5OLmNhbGwodGhpcyk7fTtcbmguRWE9ZnVuY3Rpb24oKXt0aGlzLnN8fCh0aGlzLkJ8fHRoaXMudXx8dGhpcy5qP1djKHRoaXMpOnRoaXMuYmIoKSk7fTtoLmJiPWZ1bmN0aW9uKCl7V2ModGhpcyk7fTtcbmZ1bmN0aW9uIFdjKGEpe2lmKGEuaCYmXCJ1bmRlZmluZWRcIiE9dHlwZW9mIGZhJiYoIWEudlsxXXx8NCE9UChhKXx8MiE9YS5aKCkpKWlmKGEudSYmND09UChhKSliYihhLkVhLDAsYSk7ZWxzZSBpZihGKGEsXCJyZWFkeXN0YXRlY2hhbmdlXCIpLDQ9PVAoYSkpe2EuaD0hMTt0cnl7Y29uc3QgZz1hLlooKTthOnN3aXRjaChnKXtjYXNlIDIwMDpjYXNlIDIwMTpjYXNlIDIwMjpjYXNlIDIwNDpjYXNlIDIwNjpjYXNlIDMwNDpjYXNlIDEyMjM6dmFyIGI9ITA7YnJlYWsgYTtkZWZhdWx0OmI9ITE7fXZhciBjO2lmKCEoYz1iKSl7dmFyIGQ7aWYoZD0wPT09Zyl7dmFyIGU9U3RyaW5nKGEuRCkubWF0Y2gob2MpWzFdfHxudWxsOyFlJiZrLnNlbGYmJmsuc2VsZi5sb2NhdGlvbiYmKGU9ay5zZWxmLmxvY2F0aW9uLnByb3RvY29sLnNsaWNlKDAsLTEpKTtkPSFRYy50ZXN0KGU/ZS50b0xvd2VyQ2FzZSgpOlwiXCIpO31jPWQ7fWlmKGMpRihhLFwiY29tcGxldGVcIiksRihhLFwic3VjY2Vzc1wiKTtlbHNlIHthLm09XG42O3RyeXt2YXIgZj0yPFAoYSk/YS5nLnN0YXR1c1RleHQ6XCJcIjt9Y2F0Y2gobSl7Zj1cIlwiO31hLmw9ZitcIiBbXCIrYS5aKCkrXCJdXCI7VWMoYSk7fX1maW5hbGx5e1ZjKGEpO319fWZ1bmN0aW9uIFZjKGEsYil7aWYoYS5nKXtUYyhhKTtjb25zdCBjPWEuZyxkPWEudlswXT8oKT0+e306bnVsbDthLmc9bnVsbDthLnY9bnVsbDtifHxGKGEsXCJyZWFkeVwiKTt0cnl7Yy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZDt9Y2F0Y2goZSl7fX19ZnVuY3Rpb24gVGMoYSl7YS5JJiYoay5jbGVhclRpbWVvdXQoYS5JKSxhLkk9bnVsbCk7fWguaXNBY3RpdmU9ZnVuY3Rpb24oKXtyZXR1cm4gISF0aGlzLmd9O2Z1bmN0aW9uIFAoYSl7cmV0dXJuIGEuZz9hLmcucmVhZHlTdGF0ZTowfWguWj1mdW5jdGlvbigpe3RyeXtyZXR1cm4gMjxQKHRoaXMpP3RoaXMuZy5zdGF0dXM6LTF9Y2F0Y2goYSl7cmV0dXJuIC0xfX07aC5vYT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gdGhpcy5nP3RoaXMuZy5yZXNwb25zZVRleHQ6XCJcIn1jYXRjaChhKXtyZXR1cm4gXCJcIn19O1xuaC5PYT1mdW5jdGlvbihhKXtpZih0aGlzLmcpe3ZhciBiPXRoaXMuZy5yZXNwb25zZVRleHQ7YSYmMD09Yi5pbmRleE9mKGEpJiYoYj1iLnN1YnN0cmluZyhhLmxlbmd0aCkpO3JldHVybiBpYihiKX19O2Z1bmN0aW9uIE5iKGEpe3RyeXtpZighYS5nKXJldHVybiBudWxsO2lmKFwicmVzcG9uc2VcImluIGEuZylyZXR1cm4gYS5nLnJlc3BvbnNlO3N3aXRjaChhLkgpe2Nhc2UgXCJcIjpjYXNlIFwidGV4dFwiOnJldHVybiBhLmcucmVzcG9uc2VUZXh0O2Nhc2UgXCJhcnJheWJ1ZmZlclwiOmlmKFwibW96UmVzcG9uc2VBcnJheUJ1ZmZlclwiaW4gYS5nKXJldHVybiBhLmcubW96UmVzcG9uc2VBcnJheUJ1ZmZlcn1yZXR1cm4gbnVsbH1jYXRjaChiKXtyZXR1cm4gbnVsbH19XG5mdW5jdGlvbiBWYihhKXtjb25zdCBiPXt9O2E9KGEuZyYmMjw9UChhKT9hLmcuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCl8fFwiXCI6XCJcIikuc3BsaXQoXCJcXHJcXG5cIik7Zm9yKGxldCBkPTA7ZDxhLmxlbmd0aDtkKyspe2lmKHQoYVtkXSkpY29udGludWU7dmFyIGM9dmEoYVtkXSk7Y29uc3QgZT1jWzBdO2M9Y1sxXTtpZihcInN0cmluZ1wiIT09dHlwZW9mIGMpY29udGludWU7Yz1jLnRyaW0oKTtjb25zdCBmPWJbZV18fFtdO2JbZV09ZjtmLnB1c2goYyk7fXJhKGIsZnVuY3Rpb24oZCl7cmV0dXJuIGQuam9pbihcIiwgXCIpfSk7fWguQmE9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tfTtoLkthPWZ1bmN0aW9uKCl7cmV0dXJuIFwic3RyaW5nXCI9PT10eXBlb2YgdGhpcy5sP3RoaXMubDpTdHJpbmcodGhpcy5sKX07ZnVuY3Rpb24gWGMoYSxiLGMpe3JldHVybiBjJiZjLmludGVybmFsQ2hhbm5lbFBhcmFtcz9jLmludGVybmFsQ2hhbm5lbFBhcmFtc1thXXx8YjpifVxuZnVuY3Rpb24gWWMoYSl7dGhpcy5BYT0wO3RoaXMuaT1bXTt0aGlzLmo9bmV3IHZiO3RoaXMuaWE9dGhpcy5xYT10aGlzLkk9dGhpcy5XPXRoaXMuZz10aGlzLnlhPXRoaXMuRD10aGlzLkg9dGhpcy5tPXRoaXMuUz10aGlzLm89bnVsbDt0aGlzLllhPXRoaXMuVT0wO3RoaXMuVmE9WGMoXCJmYWlsRmFzdFwiLCExLGEpO3RoaXMuRj10aGlzLkM9dGhpcy51PXRoaXMucz10aGlzLmw9bnVsbDt0aGlzLlg9ITA7dGhpcy56YT10aGlzLlQ9LTE7dGhpcy5ZPXRoaXMudj10aGlzLkI9MDt0aGlzLlRhPVhjKFwiYmFzZVJldHJ5RGVsYXlNc1wiLDVFMyxhKTt0aGlzLmNiPVhjKFwicmV0cnlEZWxheVNlZWRNc1wiLDFFNCxhKTt0aGlzLldhPVhjKFwiZm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzXCIsMixhKTt0aGlzLndhPVhjKFwiZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zXCIsMkU0LGEpO3RoaXMucGE9YSYmYS54bWxIdHRwRmFjdG9yeXx8dm9pZCAwO3RoaXMuWGE9YSYmYS5UYnx8dm9pZCAwO3RoaXMuQ2E9XG5hJiZhLnVzZUZldGNoU3RyZWFtc3x8ITE7dGhpcy5MPXZvaWQgMDt0aGlzLko9YSYmYS5zdXBwb3J0c0Nyb3NzRG9tYWluWGhyfHwhMTt0aGlzLks9XCJcIjt0aGlzLmg9bmV3IGljKGEmJmEuY29uY3VycmVudFJlcXVlc3RMaW1pdCk7dGhpcy5EYT1uZXcgSGM7dGhpcy5QPWEmJmEuZmFzdEhhbmRzaGFrZXx8ITE7dGhpcy5PPWEmJmEuZW5jb2RlSW5pdE1lc3NhZ2VIZWFkZXJzfHwhMTt0aGlzLlAmJnRoaXMuTyYmKHRoaXMuTz0hMSk7dGhpcy5VYT1hJiZhLlJifHwhMTthJiZhLnhhJiZ0aGlzLmoueGEoKTthJiZhLmZvcmNlTG9uZ1BvbGxpbmcmJih0aGlzLlg9ITEpO3RoaXMuYmE9IXRoaXMuUCYmdGhpcy5YJiZhJiZhLmRldGVjdEJ1ZmZlcmluZ1Byb3h5fHwhMTt0aGlzLmphPXZvaWQgMDthJiZhLmxvbmdQb2xsaW5nVGltZW91dCYmMDxhLmxvbmdQb2xsaW5nVGltZW91dCYmKHRoaXMuamE9YS5sb25nUG9sbGluZ1RpbWVvdXQpO3RoaXMuY2E9dm9pZCAwO3RoaXMuUj0wO3RoaXMuTT1cbiExO3RoaXMua2E9dGhpcy5BPW51bGw7fWg9WWMucHJvdG90eXBlO2gubGE9ODtoLkc9MTtoLmNvbm5lY3Q9ZnVuY3Rpb24oYSxiLGMsZCl7SygwKTt0aGlzLlc9YTt0aGlzLkg9Ynx8e307YyYmdm9pZCAwIT09ZCYmKHRoaXMuSC5PU0lEPWMsdGhpcy5ILk9BSUQ9ZCk7dGhpcy5GPXRoaXMuWDt0aGlzLkk9Y2ModGhpcyxudWxsLHRoaXMuVyk7ZmModGhpcyk7fTtcbmZ1bmN0aW9uIGdjKGEpe1pjKGEpO2lmKDM9PWEuRyl7dmFyIGI9YS5VKyssYz1OKGEuSSk7UyhjLFwiU0lEXCIsYS5LKTtTKGMsXCJSSURcIixiKTtTKGMsXCJUWVBFXCIsXCJ0ZXJtaW5hdGVcIik7JGMoYSxjKTtiPW5ldyBNKGEsYS5qLGIpO2IuTD0yO2Iudj1JYihOKGMpKTtjPSExO2lmKGsubmF2aWdhdG9yJiZrLm5hdmlnYXRvci5zZW5kQmVhY29uKXRyeXtjPWsubmF2aWdhdG9yLnNlbmRCZWFjb24oYi52LnRvU3RyaW5nKCksXCJcIik7fWNhdGNoKGQpe30hYyYmay5JbWFnZSYmKChuZXcgSW1hZ2UpLnNyYz1iLnYsYz0hMCk7Y3x8KGIuZz1NYihiLmosbnVsbCksYi5nLmVhKGIudikpO2IuRj1EYXRlLm5vdygpO0tiKGIpO31hZChhKTt9ZnVuY3Rpb24gWmIoYSl7YS5nJiYoVGIoYSksYS5nLmNhbmNlbCgpLGEuZz1udWxsKTt9XG5mdW5jdGlvbiBaYyhhKXtaYihhKTthLnUmJihrLmNsZWFyVGltZW91dChhLnUpLGEudT1udWxsKTtZYihhKTthLmguY2FuY2VsKCk7YS5zJiYoXCJudW1iZXJcIj09PXR5cGVvZiBhLnMmJmsuY2xlYXJUaW1lb3V0KGEucyksYS5zPW51bGwpO31mdW5jdGlvbiBmYyhhKXtpZighamMoYS5oKSYmIWEucyl7YS5zPSEwO3ZhciBiPWEuR2E7eHx8RWEoKTt5fHwoeCgpLHk9ITApO3phLmFkZChiLGEpO2EuQj0wO319ZnVuY3Rpb24gYmQoYSxiKXtpZihhYyhhLmgpPj1hLmguai0oYS5zPzE6MCkpcmV0dXJuICExO2lmKGEucylyZXR1cm4gYS5pPWIuRC5jb25jYXQoYS5pKSwhMDtpZigxPT1hLkd8fDI9PWEuR3x8YS5CPj0oYS5WYT8wOmEuV2EpKXJldHVybiAhMTthLnM9dWIocChhLkdhLGEsYiksY2QoYSxhLkIpKTthLkIrKztyZXR1cm4gITB9XG5oLkdhPWZ1bmN0aW9uKGEpe2lmKHRoaXMucylpZih0aGlzLnM9bnVsbCwxPT10aGlzLkcpe2lmKCFhKXt0aGlzLlU9TWF0aC5mbG9vcigxRTUqTWF0aC5yYW5kb20oKSk7YT10aGlzLlUrKztjb25zdCBlPW5ldyBNKHRoaXMsdGhpcy5qLGEpO2xldCBmPXRoaXMubzt0aGlzLlMmJihmPyhmPXNhKGYpLHVhKGYsdGhpcy5TKSk6Zj10aGlzLlMpO251bGwhPT10aGlzLm18fHRoaXMuT3x8KGUuSD1mLGY9bnVsbCk7aWYodGhpcy5QKWE6e3ZhciBiPTA7Zm9yKHZhciBjPTA7Yzx0aGlzLmkubGVuZ3RoO2MrKyl7Yjp7dmFyIGQ9dGhpcy5pW2NdO2lmKFwiX19kYXRhX19cImluIGQubWFwJiYoZD1kLm1hcC5fX2RhdGFfXyxcInN0cmluZ1wiPT09dHlwZW9mIGQpKXtkPWQubGVuZ3RoO2JyZWFrIGJ9ZD12b2lkIDA7fWlmKHZvaWQgMD09PWQpYnJlYWs7Yis9ZDtpZig0MDk2PGIpe2I9YzticmVhayBhfWlmKDQwOTY9PT1ifHxjPT09dGhpcy5pLmxlbmd0aC0xKXtiPWMrMTticmVhayBhfX1iPTFFMzt9ZWxzZSBiPVxuMUUzO2I9ZGQodGhpcyxlLGIpO2M9Tih0aGlzLkkpO1MoYyxcIlJJRFwiLGEpO1MoYyxcIkNWRVJcIiwyMik7dGhpcy5EJiZTKGMsXCJYLUhUVFAtU2Vzc2lvbi1JZFwiLHRoaXMuRCk7JGModGhpcyxjKTtmJiYodGhpcy5PP2I9XCJoZWFkZXJzPVwiK2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoT2MoZikpKStcIiZcIitiOnRoaXMubSYmUGMoYyx0aGlzLm0sZikpO2JjKHRoaXMuaCxlKTt0aGlzLlVhJiZTKGMsXCJUWVBFXCIsXCJpbml0XCIpO3RoaXMuUD8oUyhjLFwiJHJlcVwiLGIpLFMoYyxcIlNJRFwiLFwibnVsbFwiKSxlLlQ9ITAsSGIoZSxjLG51bGwpKTpIYihlLGMsYik7dGhpcy5HPTI7fX1lbHNlIDM9PXRoaXMuRyYmKGE/ZWQodGhpcyxhKTowPT10aGlzLmkubGVuZ3RofHxqYyh0aGlzLmgpfHxlZCh0aGlzKSk7fTtcbmZ1bmN0aW9uIGVkKGEsYil7dmFyIGM7Yj9jPWIubDpjPWEuVSsrO2NvbnN0IGQ9TihhLkkpO1MoZCxcIlNJRFwiLGEuSyk7UyhkLFwiUklEXCIsYyk7UyhkLFwiQUlEXCIsYS5UKTskYyhhLGQpO2EubSYmYS5vJiZQYyhkLGEubSxhLm8pO2M9bmV3IE0oYSxhLmosYyxhLkIrMSk7bnVsbD09PWEubSYmKGMuSD1hLm8pO2ImJihhLmk9Yi5ELmNvbmNhdChhLmkpKTtiPWRkKGEsYywxRTMpO2MuST1NYXRoLnJvdW5kKC41KmEud2EpK01hdGgucm91bmQoLjUqYS53YSpNYXRoLnJhbmRvbSgpKTtiYyhhLmgsYyk7SGIoYyxkLGIpO31mdW5jdGlvbiAkYyhhLGIpe2EuSCYmcWEoYS5ILGZ1bmN0aW9uKGMsZCl7UyhiLGQsYyk7fSk7YS5sJiZuYyh7fSxmdW5jdGlvbihjLGQpe1MoYixkLGMpO30pO31cbmZ1bmN0aW9uIGRkKGEsYixjKXtjPU1hdGgubWluKGEuaS5sZW5ndGgsYyk7dmFyIGQ9YS5sP3AoYS5sLk5hLGEubCxhKTpudWxsO2E6e3ZhciBlPWEuaTtsZXQgZj0tMTtmb3IoOzspe2NvbnN0IGc9W1wiY291bnQ9XCIrY107LTE9PWY/MDxjPyhmPWVbMF0uZyxnLnB1c2goXCJvZnM9XCIrZikpOmY9MDpnLnB1c2goXCJvZnM9XCIrZik7bGV0IG09ITA7Zm9yKGxldCBxPTA7cTxjO3ErKyl7bGV0IGw9ZVtxXS5nO2NvbnN0IHY9ZVtxXS5tYXA7bC09ZjtpZigwPmwpZj1NYXRoLm1heCgwLGVbcV0uZy0xMDApLG09ITE7ZWxzZSB0cnl7SWModixnLFwicmVxXCIrbCtcIl9cIik7fWNhdGNoKHcpe2QmJmQodik7fX1pZihtKXtkPWcuam9pbihcIiZcIik7YnJlYWsgYX19fWE9YS5pLnNwbGljZSgwLGMpO2IuRD1hO3JldHVybiBkfWZ1bmN0aW9uIGVjKGEpe2lmKCFhLmcmJiFhLnUpe2EuWT0xO3ZhciBiPWEuRmE7eHx8RWEoKTt5fHwoeCgpLHk9ITApO3phLmFkZChiLGEpO2Eudj0wO319XG5mdW5jdGlvbiAkYihhKXtpZihhLmd8fGEudXx8Mzw9YS52KXJldHVybiAhMTthLlkrKzthLnU9dWIocChhLkZhLGEpLGNkKGEsYS52KSk7YS52Kys7cmV0dXJuICEwfWguRmE9ZnVuY3Rpb24oKXt0aGlzLnU9bnVsbDtmZCh0aGlzKTtpZih0aGlzLmJhJiYhKHRoaXMuTXx8bnVsbD09dGhpcy5nfHwwPj10aGlzLlIpKXt2YXIgYT0yKnRoaXMuUjt0aGlzLmouaW5mbyhcIkJQIGRldGVjdGlvbiB0aW1lciBlbmFibGVkOiBcIithKTt0aGlzLkE9dWIocCh0aGlzLmFiLHRoaXMpLGEpO319O2guYWI9ZnVuY3Rpb24oKXt0aGlzLkEmJih0aGlzLkE9bnVsbCx0aGlzLmouaW5mbyhcIkJQIGRldGVjdGlvbiB0aW1lb3V0IHJlYWNoZWQuXCIpLHRoaXMuai5pbmZvKFwiQnVmZmVyaW5nIHByb3h5IGRldGVjdGVkIGFuZCBzd2l0Y2ggdG8gbG9uZy1wb2xsaW5nIVwiKSx0aGlzLkY9ITEsdGhpcy5NPSEwLEsoMTApLFpiKHRoaXMpLGZkKHRoaXMpKTt9O1xuZnVuY3Rpb24gVGIoYSl7bnVsbCE9YS5BJiYoay5jbGVhclRpbWVvdXQoYS5BKSxhLkE9bnVsbCk7fWZ1bmN0aW9uIGZkKGEpe2EuZz1uZXcgTShhLGEuaixcInJwY1wiLGEuWSk7bnVsbD09PWEubSYmKGEuZy5IPWEubyk7YS5nLk89MDt2YXIgYj1OKGEucWEpO1MoYixcIlJJRFwiLFwicnBjXCIpO1MoYixcIlNJRFwiLGEuSyk7UyhiLFwiQUlEXCIsYS5UKTtTKGIsXCJDSVwiLGEuRj9cIjBcIjpcIjFcIik7IWEuRiYmYS5qYSYmUyhiLFwiVE9cIixhLmphKTtTKGIsXCJUWVBFXCIsXCJ4bWxodHRwXCIpOyRjKGEsYik7YS5tJiZhLm8mJlBjKGIsYS5tLGEubyk7YS5MJiYoYS5nLkk9YS5MKTt2YXIgYz1hLmc7YT1hLmlhO2MuTD0xO2Mudj1JYihOKGIpKTtjLm09bnVsbDtjLlA9ITA7SmIoYyxhKTt9aC5aYT1mdW5jdGlvbigpe251bGwhPXRoaXMuQyYmKHRoaXMuQz1udWxsLFpiKHRoaXMpLCRiKHRoaXMpLEsoMTkpKTt9O2Z1bmN0aW9uIFliKGEpe251bGwhPWEuQyYmKGsuY2xlYXJUaW1lb3V0KGEuQyksYS5DPW51bGwpO31cbmZ1bmN0aW9uIFViKGEsYil7dmFyIGM9bnVsbDtpZihhLmc9PWIpe1liKGEpO1RiKGEpO2EuZz1udWxsO3ZhciBkPTI7fWVsc2UgaWYoWGIoYS5oLGIpKWM9Yi5ELGRjKGEuaCxiKSxkPTE7ZWxzZSByZXR1cm47aWYoMCE9YS5HKWlmKGIubylpZigxPT1kKXtjPWIubT9iLm0ubGVuZ3RoOjA7Yj1EYXRlLm5vdygpLWIuRjt2YXIgZT1hLkI7ZD1xYigpO0YoZCxuZXcgdGIoZCxjKSk7ZmMoYSk7fWVsc2UgZWMoYSk7ZWxzZSBpZihlPWIucywzPT1lfHwwPT1lJiYwPGIuWHx8ISgxPT1kJiZiZChhLGIpfHwyPT1kJiYkYihhKSkpc3dpdGNoKGMmJjA8Yy5sZW5ndGgmJihiPWEuaCxiLmk9Yi5pLmNvbmNhdChjKSksZSl7Y2FzZSAxOlIoYSw1KTticmVhaztjYXNlIDQ6UihhLDEwKTticmVhaztjYXNlIDM6UihhLDYpO2JyZWFrO2RlZmF1bHQ6UihhLDIpO319XG5mdW5jdGlvbiBjZChhLGIpe2xldCBjPWEuVGErTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmEuY2IpO2EuaXNBY3RpdmUoKXx8KGMqPTIpO3JldHVybiBjKmJ9ZnVuY3Rpb24gUihhLGIpe2Euai5pbmZvKFwiRXJyb3IgY29kZSBcIitiKTtpZigyPT1iKXt2YXIgYz1wKGEuZmIsYSksZD1hLlhhO2NvbnN0IGU9IWQ7ZD1uZXcgVChkfHxcIi8vd3d3Lmdvb2dsZS5jb20vaW1hZ2VzL2NsZWFyZG90LmdpZlwiKTtrLmxvY2F0aW9uJiZcImh0dHBcIj09ay5sb2NhdGlvbi5wcm90b2NvbHx8cWMoZCxcImh0dHBzXCIpO0liKGQpO2U/RmMoZC50b1N0cmluZygpLGMpOkdjKGQudG9TdHJpbmcoKSxjKTt9ZWxzZSBLKDIpO2EuRz0wO2EubCYmYS5sLnNhKGIpO2FkKGEpO1pjKGEpO31oLmZiPWZ1bmN0aW9uKGEpe2E/KHRoaXMuai5pbmZvKFwiU3VjY2Vzc2Z1bGx5IHBpbmdlZCBnb29nbGUuY29tXCIpLEsoMikpOih0aGlzLmouaW5mbyhcIkZhaWxlZCB0byBwaW5nIGdvb2dsZS5jb21cIiksSygxKSk7fTtcbmZ1bmN0aW9uIGFkKGEpe2EuRz0wO2Eua2E9W107aWYoYS5sKXtjb25zdCBiPWtjKGEuaCk7aWYoMCE9Yi5sZW5ndGh8fDAhPWEuaS5sZW5ndGgpbWEoYS5rYSxiKSxtYShhLmthLGEuaSksYS5oLmkubGVuZ3RoPTAsbGEoYS5pKSxhLmkubGVuZ3RoPTA7YS5sLnJhKCk7fX1mdW5jdGlvbiBjYyhhLGIsYyl7dmFyIGQ9YyBpbnN0YW5jZW9mIFQ/TihjKTpuZXcgVChjKTtpZihcIlwiIT1kLmcpYiYmKGQuZz1iK1wiLlwiK2QuZykscmMoZCxkLnMpO2Vsc2Uge3ZhciBlPWsubG9jYXRpb247ZD1lLnByb3RvY29sO2I9Yj9iK1wiLlwiK2UuaG9zdG5hbWU6ZS5ob3N0bmFtZTtlPStlLnBvcnQ7dmFyIGY9bmV3IFQobnVsbCk7ZCYmcWMoZixkKTtiJiYoZi5nPWIpO2UmJnJjKGYsZSk7YyYmKGYubD1jKTtkPWY7fWM9YS5EO2I9YS55YTtjJiZiJiZTKGQsYyxiKTtTKGQsXCJWRVJcIixhLmxhKTskYyhhLGQpO3JldHVybiBkfVxuZnVuY3Rpb24gTWIoYSxiLGMpe2lmKGImJiFhLkopdGhyb3cgRXJyb3IoXCJDYW4ndCBjcmVhdGUgc2Vjb25kYXJ5IGRvbWFpbiBjYXBhYmxlIFhocklvIG9iamVjdC5cIik7Yj1hLkNhJiYhYS5wYT9uZXcgWChuZXcgSmMoe2ViOmN9KSk6bmV3IFgoYS5wYSk7Yi5IYShhLkopO3JldHVybiBifWguaXNBY3RpdmU9ZnVuY3Rpb24oKXtyZXR1cm4gISF0aGlzLmwmJnRoaXMubC5pc0FjdGl2ZSh0aGlzKX07ZnVuY3Rpb24gZ2QoKXt9aD1nZC5wcm90b3R5cGU7aC51YT1mdW5jdGlvbigpe307aC50YT1mdW5jdGlvbigpe307aC5zYT1mdW5jdGlvbigpe307aC5yYT1mdW5jdGlvbigpe307aC5pc0FjdGl2ZT1mdW5jdGlvbigpe3JldHVybiAhMH07aC5OYT1mdW5jdGlvbigpe307ZnVuY3Rpb24gaGQoKXt9aGQucHJvdG90eXBlLmc9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IFkoYSxiKX07XG5mdW5jdGlvbiBZKGEsYil7RS5jYWxsKHRoaXMpO3RoaXMuZz1uZXcgWWMoYik7dGhpcy5sPWE7dGhpcy5oPWImJmIubWVzc2FnZVVybFBhcmFtc3x8bnVsbDthPWImJmIubWVzc2FnZUhlYWRlcnN8fG51bGw7YiYmYi5jbGllbnRQcm90b2NvbEhlYWRlclJlcXVpcmVkJiYoYT9hW1wiWC1DbGllbnQtUHJvdG9jb2xcIl09XCJ3ZWJjaGFubmVsXCI6YT17XCJYLUNsaWVudC1Qcm90b2NvbFwiOlwid2ViY2hhbm5lbFwifSk7dGhpcy5nLm89YTthPWImJmIuaW5pdE1lc3NhZ2VIZWFkZXJzfHxudWxsO2ImJmIubWVzc2FnZUNvbnRlbnRUeXBlJiYoYT9hW1wiWC1XZWJDaGFubmVsLUNvbnRlbnQtVHlwZVwiXT1iLm1lc3NhZ2VDb250ZW50VHlwZTphPXtcIlgtV2ViQ2hhbm5lbC1Db250ZW50LVR5cGVcIjpiLm1lc3NhZ2VDb250ZW50VHlwZX0pO2ImJmIudmEmJihhP2FbXCJYLVdlYkNoYW5uZWwtQ2xpZW50LVByb2ZpbGVcIl09Yi52YTphPXtcIlgtV2ViQ2hhbm5lbC1DbGllbnQtUHJvZmlsZVwiOmIudmF9KTt0aGlzLmcuUz1cbmE7KGE9YiYmYi5TYikmJiF0KGEpJiYodGhpcy5nLm09YSk7dGhpcy52PWImJmIuc3VwcG9ydHNDcm9zc0RvbWFpblhocnx8ITE7dGhpcy51PWImJmIuc2VuZFJhd0pzb258fCExOyhiPWImJmIuaHR0cFNlc3Npb25JZFBhcmFtKSYmIXQoYikmJih0aGlzLmcuRD1iLGE9dGhpcy5oLG51bGwhPT1hJiZiIGluIGEmJihhPXRoaXMuaCxiIGluIGEmJmRlbGV0ZSBhW2JdKSk7dGhpcy5qPW5ldyBaKHRoaXMpO31yKFksRSk7WS5wcm90b3R5cGUubT1mdW5jdGlvbigpe3RoaXMuZy5sPXRoaXMuajt0aGlzLnYmJih0aGlzLmcuSj0hMCk7dGhpcy5nLmNvbm5lY3QodGhpcy5sLHRoaXMuaHx8dm9pZCAwKTt9O1kucHJvdG90eXBlLmNsb3NlPWZ1bmN0aW9uKCl7Z2ModGhpcy5nKTt9O1xuWS5wcm90b3R5cGUubz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmc7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKXt2YXIgYz17fTtjLl9fZGF0YV9fPWE7YT1jO31lbHNlIHRoaXMudSYmKGM9e30sYy5fX2RhdGFfXz1oYihhKSxhPWMpO2IuaS5wdXNoKG5ldyBoYyhiLllhKyssYSkpOzM9PWIuRyYmZmMoYik7fTtZLnByb3RvdHlwZS5OPWZ1bmN0aW9uKCl7dGhpcy5nLmw9bnVsbDtkZWxldGUgdGhpcy5qO2djKHRoaXMuZyk7ZGVsZXRlIHRoaXMuZztZLmFhLk4uY2FsbCh0aGlzKTt9O1xuZnVuY3Rpb24gaWQoYSl7bmIuY2FsbCh0aGlzKTthLl9faGVhZGVyc19fJiYodGhpcy5oZWFkZXJzPWEuX19oZWFkZXJzX18sdGhpcy5zdGF0dXNDb2RlPWEuX19zdGF0dXNfXyxkZWxldGUgYS5fX2hlYWRlcnNfXyxkZWxldGUgYS5fX3N0YXR1c19fKTt2YXIgYj1hLl9fc21fXztpZihiKXthOntmb3IoY29uc3QgYyBpbiBiKXthPWM7YnJlYWsgYX1hPXZvaWQgMDt9aWYodGhpcy5pPWEpYT10aGlzLmksYj1udWxsIT09YiYmYSBpbiBiP2JbYV06dm9pZCAwO3RoaXMuZGF0YT1iO31lbHNlIHRoaXMuZGF0YT1hO31yKGlkLG5iKTtmdW5jdGlvbiBqZCgpe29iLmNhbGwodGhpcyk7dGhpcy5zdGF0dXM9MTt9cihqZCxvYik7ZnVuY3Rpb24gWihhKXt0aGlzLmc9YTt9cihaLGdkKTtaLnByb3RvdHlwZS51YT1mdW5jdGlvbigpe0YodGhpcy5nLFwiYVwiKTt9O1oucHJvdG90eXBlLnRhPWZ1bmN0aW9uKGEpe0YodGhpcy5nLG5ldyBpZChhKSk7fTtcbloucHJvdG90eXBlLnNhPWZ1bmN0aW9uKGEpe0YodGhpcy5nLG5ldyBqZCgpKTt9O1oucHJvdG90eXBlLnJhPWZ1bmN0aW9uKCl7Rih0aGlzLmcsXCJiXCIpO307aGQucHJvdG90eXBlLmNyZWF0ZVdlYkNoYW5uZWw9aGQucHJvdG90eXBlLmc7WS5wcm90b3R5cGUuc2VuZD1ZLnByb3RvdHlwZS5vO1kucHJvdG90eXBlLm9wZW49WS5wcm90b3R5cGUubTtZLnByb3RvdHlwZS5jbG9zZT1ZLnByb3RvdHlwZS5jbG9zZTtjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0ID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5jcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0PWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBoZH07Z2V0U3RhdEV2ZW50VGFyZ2V0ID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5nZXRTdGF0RXZlbnRUYXJnZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gcWIoKX07RXZlbnQgPSB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4LkV2ZW50PUk7U3RhdCA9IHdlYmNoYW5uZWxfYmxvYl9lczIwMTguU3RhdD17bWI6MCxwYjoxLHFiOjIsSmI6MyxPYjo0LExiOjUsTWI6NixLYjo3LEliOjgsTmI6OSxQUk9YWToxMCxOT1BST1hZOjExLEdiOjEyLENiOjEzLERiOjE0LEJiOjE1LEViOjE2LEZiOjE3LGliOjE4LGhiOjE5LGpiOjIwfTtBYi5OT19FUlJPUj0wO0FiLlRJTUVPVVQ9ODtBYi5IVFRQX0VSUk9SPTY7XG5FcnJvckNvZGUgPSB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4LkVycm9yQ29kZT1BYjtCYi5DT01QTEVURT1cImNvbXBsZXRlXCI7RXZlbnRUeXBlID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5FdmVudFR5cGU9QmI7bWIuRXZlbnRUeXBlPUg7SC5PUEVOPVwiYVwiO0guQ0xPU0U9XCJiXCI7SC5FUlJPUj1cImNcIjtILk1FU1NBR0U9XCJkXCI7RS5wcm90b3R5cGUubGlzdGVuPUUucHJvdG90eXBlLks7V2ViQ2hhbm5lbCA9IHdlYmNoYW5uZWxfYmxvYl9lczIwMTguV2ViQ2hhbm5lbD1tYjtGZXRjaFhtbEh0dHBGYWN0b3J5ID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5GZXRjaFhtbEh0dHBGYWN0b3J5PUpjO1gucHJvdG90eXBlLmxpc3Rlbk9uY2U9WC5wcm90b3R5cGUuTDtYLnByb3RvdHlwZS5nZXRMYXN0RXJyb3I9WC5wcm90b3R5cGUuS2E7WC5wcm90b3R5cGUuZ2V0TGFzdEVycm9yQ29kZT1YLnByb3RvdHlwZS5CYTtYLnByb3RvdHlwZS5nZXRTdGF0dXM9WC5wcm90b3R5cGUuWjtYLnByb3RvdHlwZS5nZXRSZXNwb25zZUpzb249WC5wcm90b3R5cGUuT2E7WC5wcm90b3R5cGUuZ2V0UmVzcG9uc2VUZXh0PVgucHJvdG90eXBlLm9hO1xuWC5wcm90b3R5cGUuc2VuZD1YLnByb3RvdHlwZS5lYTtYLnByb3RvdHlwZS5zZXRXaXRoQ3JlZGVudGlhbHM9WC5wcm90b3R5cGUuSGE7WGhySW8gPSB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4LlhocklvPVg7fSkuYXBwbHkoIHR5cGVvZiBjb21tb25qc0dsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBjb21tb25qc0dsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgIDogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgIDoge30pO1xuXG5leHBvcnQgeyBFcnJvckNvZGUsIEV2ZW50LCBFdmVudFR5cGUsIEZldGNoWG1sSHR0cEZhY3RvcnksIFN0YXQsIFdlYkNoYW5uZWwsIFhocklvLCBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0LCB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4IGFzIGRlZmF1bHQsIGdldFN0YXRFdmVudFRhcmdldCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9d2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5qcy5tYXBcbiIsImltcG9ydCB7IF9yZWdpc3RlckNvbXBvbmVudCwgcmVnaXN0ZXJWZXJzaW9uLCBfZ2V0UHJvdmlkZXIsIGdldEFwcCwgX3JlbW92ZVNlcnZpY2VJbnN0YW5jZSwgU0RLX1ZFUlNJT04gfSBmcm9tICdAZmlyZWJhc2UvYXBwJztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0BmaXJlYmFzZS9jb21wb25lbnQnO1xuaW1wb3J0IHsgTG9nZ2VyLCBMb2dMZXZlbCB9IGZyb20gJ0BmaXJlYmFzZS9sb2dnZXInO1xuaW1wb3J0IHsgRmlyZWJhc2VFcnJvciwgY3JlYXRlTW9ja1VzZXJUb2tlbiwgZ2V0TW9kdWxhckluc3RhbmNlLCBkZWVwRXF1YWwsIGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCwgZ2V0VUEsIGlzSW5kZXhlZERCQXZhaWxhYmxlLCBpc1NhZmFyaSB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcbmltcG9ydCB7IEludGVnZXIsIE1kNSB9IGZyb20gJ0BmaXJlYmFzZS93ZWJjaGFubmVsLXdyYXBwZXIvYmxvb20tYmxvYic7XG5pbXBvcnQgeyBYaHJJbywgRXZlbnRUeXBlLCBFcnJvckNvZGUsIGNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQsIGdldFN0YXRFdmVudFRhcmdldCwgV2ViQ2hhbm5lbCwgRXZlbnQsIFN0YXQgfSBmcm9tICdAZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL3dlYmNoYW5uZWwtYmxvYic7XG5cbmNvbnN0IHcgPSBcIkBmaXJlYmFzZS9maXJlc3RvcmVcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogU2ltcGxlIHdyYXBwZXIgYXJvdW5kIGEgbnVsbGFibGUgVUlELiBNb3N0bHkgZXhpc3RzIHRvIG1ha2UgY29kZSBtb3JlXG4gKiByZWFkYWJsZS5cbiAqL1xuY2xhc3MgVXNlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnVpZCA9IGU7XG4gICAgfVxuICAgIGlzQXV0aGVudGljYXRlZCgpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT0gdGhpcy51aWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBrZXkgcmVwcmVzZW50aW5nIHRoaXMgdXNlciwgc3VpdGFibGUgZm9yIGluY2x1c2lvbiBpbiBhXG4gICAgICogZGljdGlvbmFyeS5cbiAgICAgKi8gICAgdG9LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQXV0aGVudGljYXRlZCgpID8gXCJ1aWQ6XCIgKyB0aGlzLnVpZCA6IFwiYW5vbnltb3VzLXVzZXJcIjtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBlLnVpZCA9PT0gdGhpcy51aWQ7XG4gICAgfVxufVxuXG4vKiogQSB1c2VyIHdpdGggYSBudWxsIFVJRC4gKi8gVXNlci5VTkFVVEhFTlRJQ0FURUQgPSBuZXcgVXNlcihudWxsKSwgXG4vLyBUT0RPKG1pa2VsZWhlbik6IExvb2sgaW50byBnZXR0aW5nIGEgcHJvcGVyIHVpZC1lcXVpdmFsZW50IGZvclxuLy8gbm9uLUZpcmViYXNlQXV0aCBwcm92aWRlcnMuXG5Vc2VyLkdPT0dMRV9DUkVERU5USUFMUyA9IG5ldyBVc2VyKFwiZ29vZ2xlLWNyZWRlbnRpYWxzLXVpZFwiKSwgVXNlci5GSVJTVF9QQVJUWSA9IG5ldyBVc2VyKFwiZmlyc3QtcGFydHktdWlkXCIpLCBcblVzZXIuTU9DS19VU0VSID0gbmV3IFVzZXIoXCJtb2NrLXVzZXJcIik7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5sZXQgUyA9IFwiMTAuMTQuMFwiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgYiA9IG5ldyBMb2dnZXIoXCJAZmlyZWJhc2UvZmlyZXN0b3JlXCIpO1xuXG4vLyBIZWxwZXIgbWV0aG9kcyBhcmUgbmVlZGVkIGJlY2F1c2UgdmFyaWFibGVzIGNhbid0IGJlIGV4cG9ydGVkIGFzIHJlYWQvd3JpdGVcbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIHtcbiAgICByZXR1cm4gYi5sb2dMZXZlbDtcbn1cblxuLyoqXG4gKiBTZXRzIHRoZSB2ZXJib3NpdHkgb2YgQ2xvdWQgRmlyZXN0b3JlIGxvZ3MgKGRlYnVnLCBlcnJvciwgb3Igc2lsZW50KS5cbiAqXG4gKiBAcGFyYW0gbG9nTGV2ZWwgLSBUaGUgdmVyYm9zaXR5IHlvdSBzZXQgZm9yIGFjdGl2aXR5IGFuZCBlcnJvciBsb2dnaW5nLiBDYW5cbiAqICAgYmUgYW55IG9mIHRoZSBmb2xsb3dpbmcgdmFsdWVzOlxuICpcbiAqICAgPHVsPlxuICogICAgIDxsaT5gZGVidWdgIGZvciB0aGUgbW9zdCB2ZXJib3NlIGxvZ2dpbmcgbGV2ZWwsIHByaW1hcmlseSBmb3JcbiAqICAgICBkZWJ1Z2dpbmcuPC9saT5cbiAqICAgICA8bGk+YGVycm9yYCB0byBsb2cgZXJyb3JzIG9ubHkuPC9saT5cbiAqICAgICA8bGk+PGNvZGU+YHNpbGVudGAgdG8gdHVybiBvZmYgbG9nZ2luZy48L2xpPlxuICogICA8L3VsPlxuICovIGZ1bmN0aW9uIHNldExvZ0xldmVsKGUpIHtcbiAgICBiLnNldExvZ0xldmVsKGUpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9nRGVidWcoZSwgLi4udCkge1xuICAgIGlmIChiLmxvZ0xldmVsIDw9IExvZ0xldmVsLkRFQlVHKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0Lm1hcChfX1BSSVZBVEVfYXJnVG9TdHJpbmcpO1xuICAgICAgICBiLmRlYnVnKGBGaXJlc3RvcmUgKCR7U30pOiAke2V9YCwgLi4ubik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9nRXJyb3IoZSwgLi4udCkge1xuICAgIGlmIChiLmxvZ0xldmVsIDw9IExvZ0xldmVsLkVSUk9SKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0Lm1hcChfX1BSSVZBVEVfYXJnVG9TdHJpbmcpO1xuICAgICAgICBiLmVycm9yKGBGaXJlc3RvcmUgKCR7U30pOiAke2V9YCwgLi4ubik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2dXYXJuKGUsIC4uLnQpIHtcbiAgICBpZiAoYi5sb2dMZXZlbCA8PSBMb2dMZXZlbC5XQVJOKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0Lm1hcChfX1BSSVZBVEVfYXJnVG9TdHJpbmcpO1xuICAgICAgICBiLndhcm4oYEZpcmVzdG9yZSAoJHtTfSk6ICR7ZX1gLCAuLi5uKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29udmVydHMgYW4gYWRkaXRpb25hbCBsb2cgcGFyYW1ldGVyIHRvIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hcmdUb1N0cmluZyhlKSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpIHJldHVybiBlO1xuICAgIHRyeSB7XG4gICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgICAgIC8qKiBGb3JtYXRzIGFuIG9iamVjdCBhcyBhIEpTT04gc3RyaW5nLCBzdWl0YWJsZSBmb3IgbG9nZ2luZy4gKi9cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9mb3JtYXRKU09OKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShlKTtcbiAgICAgICAgfShlKTtcbiAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIC8vIENvbnZlcnRpbmcgdG8gSlNPTiBmYWlsZWQsIGp1c3QgbG9nIHRoZSBvYmplY3QgZGlyZWN0bHlcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBVbmNvbmRpdGlvbmFsbHkgZmFpbHMsIHRocm93aW5nIGFuIEVycm9yIHdpdGggdGhlIGdpdmVuIG1lc3NhZ2UuXG4gKiBNZXNzYWdlcyBhcmUgc3RyaXBwZWQgaW4gcHJvZHVjdGlvbiBidWlsZHMuXG4gKlxuICogUmV0dXJucyBgbmV2ZXJgIGFuZCBjYW4gYmUgdXNlZCBpbiBleHByZXNzaW9uczpcbiAqIEBleGFtcGxlXG4gKiBsZXQgZnV0dXJlVmFyID0gZmFpbCgnbm90IGltcGxlbWVudGVkIHlldCcpO1xuICovIGZ1bmN0aW9uIGZhaWwoZSA9IFwiVW5leHBlY3RlZCBzdGF0ZVwiKSB7XG4gICAgLy8gTG9nIHRoZSBmYWlsdXJlIGluIGFkZGl0aW9uIHRvIHRocm93IGFuIGV4Y2VwdGlvbiwganVzdCBpbiBjYXNlIHRoZVxuICAgIC8vIGV4Y2VwdGlvbiBpcyBzd2FsbG93ZWQuXG4gICAgY29uc3QgdCA9IGBGSVJFU1RPUkUgKCR7U30pIElOVEVSTkFMIEFTU0VSVElPTiBGQUlMRUQ6IGAgKyBlO1xuICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBGaXJlc3RvcmVFcnJvciBoZXJlIGJlY2F1c2UgdGhlc2UgYXJlIGludGVybmFsIGZhaWx1cmVzXG4gICAgLy8gdGhhdCBjYW5ub3QgYmUgaGFuZGxlZCBieSB0aGUgdXNlci4gKEFsc28gaXQgd291bGQgY3JlYXRlIGEgY2lyY3VsYXJcbiAgICAvLyBkZXBlbmRlbmN5IGJldHdlZW4gdGhlIGVycm9yIGFuZCBhc3NlcnQgbW9kdWxlcyB3aGljaCBkb2Vzbid0IHdvcmsuKVxuICAgIHRocm93IF9fUFJJVkFURV9sb2dFcnJvcih0KSwgbmV3IEVycm9yKHQpO1xufVxuXG4vKipcbiAqIEZhaWxzIGlmIHRoZSBnaXZlbiBhc3NlcnRpb24gY29uZGl0aW9uIGlzIGZhbHNlLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZVxuICogZ2l2ZW4gbWVzc2FnZSBpZiBpdCBkaWQuXG4gKlxuICogTWVzc2FnZXMgYXJlIHN0cmlwcGVkIGluIHByb2R1Y3Rpb24gYnVpbGRzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUsIHQpIHtcbiAgICBlIHx8IGZhaWwoKTtcbn1cblxuLyoqXG4gKiBGYWlscyBpZiB0aGUgZ2l2ZW4gYXNzZXJ0aW9uIGNvbmRpdGlvbiBpcyBmYWxzZSwgdGhyb3dpbmcgYW4gRXJyb3Igd2l0aCB0aGVcbiAqIGdpdmVuIG1lc3NhZ2UgaWYgaXQgZGlkLlxuICpcbiAqIFRoZSBjb2RlIG9mIGNhbGxzaXRlcyBpbnZva2luZyB0aGlzIGZ1bmN0aW9uIGFyZSBzdHJpcHBlZCBvdXQgaW4gcHJvZHVjdGlvblxuICogYnVpbGRzLiBBbnkgc2lkZS1lZmZlY3RzIG9mIGNvZGUgd2l0aGluIHRoZSBkZWJ1Z0Fzc2VydCgpIGludm9jYXRpb24gd2lsbCBub3RcbiAqIGhhcHBlbiBpbiB0aGlzIGNhc2UuXG4gKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2RlYnVnQXNzZXJ0KGUsIHQpIHtcbiAgICBlIHx8IGZhaWwoKTtcbn1cblxuLyoqXG4gKiBDYXN0cyBgb2JqYCB0byBgVGAuIEluIG5vbi1wcm9kdWN0aW9uIGJ1aWxkcywgdmVyaWZpZXMgdGhhdCBgb2JqYCBpcyBhblxuICogaW5zdGFuY2Ugb2YgYFRgIGJlZm9yZSBjYXN0aW5nLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSwgXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxudCkge1xuICAgIHJldHVybiBlO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBEID0ge1xuICAgIC8vIENhdXNlcyBhcmUgY29waWVkIGZyb206XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYy9ibG9iL2JjZWVjOTRlYTRmYzVmMDA4NWQ4MTIzNWQ4ZTFjMDY3OThkYzM0MWEvaW5jbHVkZS9ncnBjJTJCJTJCL2ltcGwvY29kZWdlbi9zdGF0dXNfY29kZV9lbnVtLmhcbiAgICAvKiogTm90IGFuIGVycm9yOyByZXR1cm5lZCBvbiBzdWNjZXNzLiAqL1xuICAgIE9LOiBcIm9rXCIsXG4gICAgLyoqIFRoZSBvcGVyYXRpb24gd2FzIGNhbmNlbGxlZCAodHlwaWNhbGx5IGJ5IHRoZSBjYWxsZXIpLiAqL1xuICAgIENBTkNFTExFRDogXCJjYW5jZWxsZWRcIixcbiAgICAvKiogVW5rbm93biBlcnJvciBvciBhbiBlcnJvciBmcm9tIGEgZGlmZmVyZW50IGVycm9yIGRvbWFpbi4gKi9cbiAgICBVTktOT1dOOiBcInVua25vd25cIixcbiAgICAvKipcbiAgICAgKiBDbGllbnQgc3BlY2lmaWVkIGFuIGludmFsaWQgYXJndW1lbnQuIE5vdGUgdGhhdCB0aGlzIGRpZmZlcnMgZnJvbVxuICAgICAqIEZBSUxFRF9QUkVDT05ESVRJT04uIElOVkFMSURfQVJHVU1FTlQgaW5kaWNhdGVzIGFyZ3VtZW50cyB0aGF0IGFyZVxuICAgICAqIHByb2JsZW1hdGljIHJlZ2FyZGxlc3Mgb2YgdGhlIHN0YXRlIG9mIHRoZSBzeXN0ZW0gKGUuZy4sIGEgbWFsZm9ybWVkIGZpbGVcbiAgICAgKiBuYW1lKS5cbiAgICAgKi9cbiAgICBJTlZBTElEX0FSR1VNRU5UOiBcImludmFsaWQtYXJndW1lbnRcIixcbiAgICAvKipcbiAgICAgKiBEZWFkbGluZSBleHBpcmVkIGJlZm9yZSBvcGVyYXRpb24gY291bGQgY29tcGxldGUuIEZvciBvcGVyYXRpb25zIHRoYXRcbiAgICAgKiBjaGFuZ2UgdGhlIHN0YXRlIG9mIHRoZSBzeXN0ZW0sIHRoaXMgZXJyb3IgbWF5IGJlIHJldHVybmVkIGV2ZW4gaWYgdGhlXG4gICAgICogb3BlcmF0aW9uIGhhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LiBGb3IgZXhhbXBsZSwgYSBzdWNjZXNzZnVsIHJlc3BvbnNlXG4gICAgICogZnJvbSBhIHNlcnZlciBjb3VsZCBoYXZlIGJlZW4gZGVsYXllZCBsb25nIGVub3VnaCBmb3IgdGhlIGRlYWRsaW5lIHRvXG4gICAgICogZXhwaXJlLlxuICAgICAqL1xuICAgIERFQURMSU5FX0VYQ0VFREVEOiBcImRlYWRsaW5lLWV4Y2VlZGVkXCIsXG4gICAgLyoqIFNvbWUgcmVxdWVzdGVkIGVudGl0eSAoZS5nLiwgZmlsZSBvciBkaXJlY3RvcnkpIHdhcyBub3QgZm91bmQuICovXG4gICAgTk9UX0ZPVU5EOiBcIm5vdC1mb3VuZFwiLFxuICAgIC8qKlxuICAgICAqIFNvbWUgZW50aXR5IHRoYXQgd2UgYXR0ZW1wdGVkIHRvIGNyZWF0ZSAoZS5nLiwgZmlsZSBvciBkaXJlY3RvcnkpIGFscmVhZHlcbiAgICAgKiBleGlzdHMuXG4gICAgICovXG4gICAgQUxSRUFEWV9FWElTVFM6IFwiYWxyZWFkeS1leGlzdHNcIixcbiAgICAvKipcbiAgICAgKiBUaGUgY2FsbGVyIGRvZXMgbm90IGhhdmUgcGVybWlzc2lvbiB0byBleGVjdXRlIHRoZSBzcGVjaWZpZWQgb3BlcmF0aW9uLlxuICAgICAqIFBFUk1JU1NJT05fREVOSUVEIG11c3Qgbm90IGJlIHVzZWQgZm9yIHJlamVjdGlvbnMgY2F1c2VkIGJ5IGV4aGF1c3RpbmdcbiAgICAgKiBzb21lIHJlc291cmNlICh1c2UgUkVTT1VSQ0VfRVhIQVVTVEVEIGluc3RlYWQgZm9yIHRob3NlIGVycm9ycykuXG4gICAgICogUEVSTUlTU0lPTl9ERU5JRUQgbXVzdCBub3QgYmUgdXNlZCBpZiB0aGUgY2FsbGVyIGNhbm5vdCBiZSBpZGVudGlmaWVkXG4gICAgICogKHVzZSBVTkFVVEhFTlRJQ0FURUQgaW5zdGVhZCBmb3IgdGhvc2UgZXJyb3JzKS5cbiAgICAgKi9cbiAgICBQRVJNSVNTSU9OX0RFTklFRDogXCJwZXJtaXNzaW9uLWRlbmllZFwiLFxuICAgIC8qKlxuICAgICAqIFRoZSByZXF1ZXN0IGRvZXMgbm90IGhhdmUgdmFsaWQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgZm9yIHRoZVxuICAgICAqIG9wZXJhdGlvbi5cbiAgICAgKi9cbiAgICBVTkFVVEhFTlRJQ0FURUQ6IFwidW5hdXRoZW50aWNhdGVkXCIsXG4gICAgLyoqXG4gICAgICogU29tZSByZXNvdXJjZSBoYXMgYmVlbiBleGhhdXN0ZWQsIHBlcmhhcHMgYSBwZXItdXNlciBxdW90YSwgb3IgcGVyaGFwcyB0aGVcbiAgICAgKiBlbnRpcmUgZmlsZSBzeXN0ZW0gaXMgb3V0IG9mIHNwYWNlLlxuICAgICAqL1xuICAgIFJFU09VUkNFX0VYSEFVU1RFRDogXCJyZXNvdXJjZS1leGhhdXN0ZWRcIixcbiAgICAvKipcbiAgICAgKiBPcGVyYXRpb24gd2FzIHJlamVjdGVkIGJlY2F1c2UgdGhlIHN5c3RlbSBpcyBub3QgaW4gYSBzdGF0ZSByZXF1aXJlZCBmb3JcbiAgICAgKiB0aGUgb3BlcmF0aW9uJ3MgZXhlY3V0aW9uLiBGb3IgZXhhbXBsZSwgZGlyZWN0b3J5IHRvIGJlIGRlbGV0ZWQgbWF5IGJlXG4gICAgICogbm9uLWVtcHR5LCBhbiBybWRpciBvcGVyYXRpb24gaXMgYXBwbGllZCB0byBhIG5vbi1kaXJlY3RvcnksIGV0Yy5cbiAgICAgKlxuICAgICAqIEEgbGl0bXVzIHRlc3QgdGhhdCBtYXkgaGVscCBhIHNlcnZpY2UgaW1wbGVtZW50b3IgaW4gZGVjaWRpbmdcbiAgICAgKiBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04sIEFCT1JURUQsIGFuZCBVTkFWQUlMQUJMRTpcbiAgICAgKiAgKGEpIFVzZSBVTkFWQUlMQUJMRSBpZiB0aGUgY2xpZW50IGNhbiByZXRyeSBqdXN0IHRoZSBmYWlsaW5nIGNhbGwuXG4gICAgICogIChiKSBVc2UgQUJPUlRFRCBpZiB0aGUgY2xpZW50IHNob3VsZCByZXRyeSBhdCBhIGhpZ2hlci1sZXZlbFxuICAgICAqICAgICAgKGUuZy4sIHJlc3RhcnRpbmcgYSByZWFkLW1vZGlmeS13cml0ZSBzZXF1ZW5jZSkuXG4gICAgICogIChjKSBVc2UgRkFJTEVEX1BSRUNPTkRJVElPTiBpZiB0aGUgY2xpZW50IHNob3VsZCBub3QgcmV0cnkgdW50aWxcbiAgICAgKiAgICAgIHRoZSBzeXN0ZW0gc3RhdGUgaGFzIGJlZW4gZXhwbGljaXRseSBmaXhlZC4gRS5nLiwgaWYgYW4gXCJybWRpclwiXG4gICAgICogICAgICBmYWlscyBiZWNhdXNlIHRoZSBkaXJlY3RvcnkgaXMgbm9uLWVtcHR5LCBGQUlMRURfUFJFQ09ORElUSU9OXG4gICAgICogICAgICBzaG91bGQgYmUgcmV0dXJuZWQgc2luY2UgdGhlIGNsaWVudCBzaG91bGQgbm90IHJldHJ5IHVubGVzc1xuICAgICAqICAgICAgdGhleSBoYXZlIGZpcnN0IGZpeGVkIHVwIHRoZSBkaXJlY3RvcnkgYnkgZGVsZXRpbmcgZmlsZXMgZnJvbSBpdC5cbiAgICAgKiAgKGQpIFVzZSBGQUlMRURfUFJFQ09ORElUSU9OIGlmIHRoZSBjbGllbnQgcGVyZm9ybXMgY29uZGl0aW9uYWxcbiAgICAgKiAgICAgIFJFU1QgR2V0L1VwZGF0ZS9EZWxldGUgb24gYSByZXNvdXJjZSBhbmQgdGhlIHJlc291cmNlIG9uIHRoZVxuICAgICAqICAgICAgc2VydmVyIGRvZXMgbm90IG1hdGNoIHRoZSBjb25kaXRpb24uIEUuZy4sIGNvbmZsaWN0aW5nXG4gICAgICogICAgICByZWFkLW1vZGlmeS13cml0ZSBvbiB0aGUgc2FtZSByZXNvdXJjZS5cbiAgICAgKi9cbiAgICBGQUlMRURfUFJFQ09ORElUSU9OOiBcImZhaWxlZC1wcmVjb25kaXRpb25cIixcbiAgICAvKipcbiAgICAgKiBUaGUgb3BlcmF0aW9uIHdhcyBhYm9ydGVkLCB0eXBpY2FsbHkgZHVlIHRvIGEgY29uY3VycmVuY3kgaXNzdWUgbGlrZVxuICAgICAqIHNlcXVlbmNlciBjaGVjayBmYWlsdXJlcywgdHJhbnNhY3Rpb24gYWJvcnRzLCBldGMuXG4gICAgICpcbiAgICAgKiBTZWUgbGl0bXVzIHRlc3QgYWJvdmUgZm9yIGRlY2lkaW5nIGJldHdlZW4gRkFJTEVEX1BSRUNPTkRJVElPTiwgQUJPUlRFRCxcbiAgICAgKiBhbmQgVU5BVkFJTEFCTEUuXG4gICAgICovXG4gICAgQUJPUlRFRDogXCJhYm9ydGVkXCIsXG4gICAgLyoqXG4gICAgICogT3BlcmF0aW9uIHdhcyBhdHRlbXB0ZWQgcGFzdCB0aGUgdmFsaWQgcmFuZ2UuIEUuZy4sIHNlZWtpbmcgb3IgcmVhZGluZ1xuICAgICAqIHBhc3QgZW5kIG9mIGZpbGUuXG4gICAgICpcbiAgICAgKiBVbmxpa2UgSU5WQUxJRF9BUkdVTUVOVCwgdGhpcyBlcnJvciBpbmRpY2F0ZXMgYSBwcm9ibGVtIHRoYXQgbWF5IGJlIGZpeGVkXG4gICAgICogaWYgdGhlIHN5c3RlbSBzdGF0ZSBjaGFuZ2VzLiBGb3IgZXhhbXBsZSwgYSAzMi1iaXQgZmlsZSBzeXN0ZW0gd2lsbFxuICAgICAqIGdlbmVyYXRlIElOVkFMSURfQVJHVU1FTlQgaWYgYXNrZWQgdG8gcmVhZCBhdCBhbiBvZmZzZXQgdGhhdCBpcyBub3QgaW4gdGhlXG4gICAgICogcmFuZ2UgWzAsMl4zMi0xXSwgYnV0IGl0IHdpbGwgZ2VuZXJhdGUgT1VUX09GX1JBTkdFIGlmIGFza2VkIHRvIHJlYWQgZnJvbVxuICAgICAqIGFuIG9mZnNldCBwYXN0IHRoZSBjdXJyZW50IGZpbGUgc2l6ZS5cbiAgICAgKlxuICAgICAqIFRoZXJlIGlzIGEgZmFpciBiaXQgb2Ygb3ZlcmxhcCBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04gYW5kXG4gICAgICogT1VUX09GX1JBTkdFLiBXZSByZWNvbW1lbmQgdXNpbmcgT1VUX09GX1JBTkdFICh0aGUgbW9yZSBzcGVjaWZpYyBlcnJvcilcbiAgICAgKiB3aGVuIGl0IGFwcGxpZXMgc28gdGhhdCBjYWxsZXJzIHdobyBhcmUgaXRlcmF0aW5nIHRocm91Z2ggYSBzcGFjZSBjYW5cbiAgICAgKiBlYXNpbHkgbG9vayBmb3IgYW4gT1VUX09GX1JBTkdFIGVycm9yIHRvIGRldGVjdCB3aGVuIHRoZXkgYXJlIGRvbmUuXG4gICAgICovXG4gICAgT1VUX09GX1JBTkdFOiBcIm91dC1vZi1yYW5nZVwiLFxuICAgIC8qKiBPcGVyYXRpb24gaXMgbm90IGltcGxlbWVudGVkIG9yIG5vdCBzdXBwb3J0ZWQvZW5hYmxlZCBpbiB0aGlzIHNlcnZpY2UuICovXG4gICAgVU5JTVBMRU1FTlRFRDogXCJ1bmltcGxlbWVudGVkXCIsXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgZXJyb3JzLiBNZWFucyBzb21lIGludmFyaWFudHMgZXhwZWN0ZWQgYnkgdW5kZXJseWluZyBTeXN0ZW0gaGFzXG4gICAgICogYmVlbiBicm9rZW4uIElmIHlvdSBzZWUgb25lIG9mIHRoZXNlIGVycm9ycywgU29tZXRoaW5nIGlzIHZlcnkgYnJva2VuLlxuICAgICAqL1xuICAgIElOVEVSTkFMOiBcImludGVybmFsXCIsXG4gICAgLyoqXG4gICAgICogVGhlIHNlcnZpY2UgaXMgY3VycmVudGx5IHVuYXZhaWxhYmxlLiBUaGlzIGlzIGEgbW9zdCBsaWtlbHkgYSB0cmFuc2llbnRcbiAgICAgKiBjb25kaXRpb24gYW5kIG1heSBiZSBjb3JyZWN0ZWQgYnkgcmV0cnlpbmcgd2l0aCBhIGJhY2tvZmYuXG4gICAgICpcbiAgICAgKiBTZWUgbGl0bXVzIHRlc3QgYWJvdmUgZm9yIGRlY2lkaW5nIGJldHdlZW4gRkFJTEVEX1BSRUNPTkRJVElPTiwgQUJPUlRFRCxcbiAgICAgKiBhbmQgVU5BVkFJTEFCTEUuXG4gICAgICovXG4gICAgVU5BVkFJTEFCTEU6IFwidW5hdmFpbGFibGVcIixcbiAgICAvKiogVW5yZWNvdmVyYWJsZSBkYXRhIGxvc3Mgb3IgY29ycnVwdGlvbi4gKi9cbiAgICBEQVRBX0xPU1M6IFwiZGF0YS1sb3NzXCJcbn07XG5cbi8qKiBBbiBlcnJvciByZXR1cm5lZCBieSBhIEZpcmVzdG9yZSBvcGVyYXRpb24uICovIGNsYXNzIEZpcmVzdG9yZUVycm9yIGV4dGVuZHMgRmlyZWJhc2VFcnJvciB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgYmFja2VuZCBlcnJvciBjb2RlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGVycm9yLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIEEgY3VzdG9tIGVycm9yIGRlc2NyaXB0aW9uLlxuICAgICAqL1xuICAgIHQpIHtcbiAgICAgICAgc3VwZXIoZSwgdCksIHRoaXMuY29kZSA9IGUsIHRoaXMubWVzc2FnZSA9IHQsIFxuICAgICAgICAvLyBIQUNLOiBXZSB3cml0ZSBhIHRvU3RyaW5nIHByb3BlcnR5IGRpcmVjdGx5IGJlY2F1c2UgRXJyb3IgaXMgbm90IGEgcmVhbFxuICAgICAgICAvLyBjbGFzcyBhbmQgc28gaW5oZXJpdGFuY2UgZG9lcyBub3Qgd29yayBjb3JyZWN0bHkuIFdlIGNvdWxkIGFsdGVybmF0aXZlbHlcbiAgICAgICAgLy8gZG8gdGhlIHNhbWUgXCJiYWNrLWRvb3IgaW5oZXJpdGFuY2VcIiB0cmljayB0aGF0IEZpcmViYXNlRXJyb3IgZG9lcy5cbiAgICAgICAgdGhpcy50b1N0cmluZyA9ICgpID0+IGAke3RoaXMubmFtZX06IFtjb2RlPSR7dGhpcy5jb2RlfV06ICR7dGhpcy5tZXNzYWdlfWA7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfRGVmZXJyZWQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZSgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZSA9IGUsIHRoaXMucmVqZWN0ID0gdDtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX09BdXRoVG9rZW4ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy51c2VyID0gdCwgdGhpcy50eXBlID0gXCJPQXV0aFwiLCB0aGlzLmhlYWRlcnMgPSBuZXcgTWFwLCB0aGlzLmhlYWRlcnMuc2V0KFwiQXV0aG9yaXphdGlvblwiLCBgQmVhcmVyICR7ZX1gKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBDcmVkZW50aWFsc1Byb3ZpZGVyIHRoYXQgYWx3YXlzIHlpZWxkcyBhbiBlbXB0eSB0b2tlbi5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIF9fUFJJVkFURV9FbXB0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIHtcbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge31cbiAgICBzdGFydChlLCB0KSB7XG4gICAgICAgIC8vIEZpcmUgd2l0aCBpbml0aWFsIHVzZXIuXG4gICAgICAgIGUuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gdChVc2VyLlVOQVVUSEVOVElDQVRFRCkpKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7fVxufVxuXG4vKipcbiAqIEEgQ3JlZGVudGlhbHNQcm92aWRlciB0aGF0IGFsd2F5cyByZXR1cm5zIGEgY29uc3RhbnQgdG9rZW4uIFVzZWQgZm9yXG4gKiBlbXVsYXRvciB0b2tlbiBtb2NraW5nLlxuICovIGNsYXNzIF9fUFJJVkFURV9FbXVsYXRvckF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudG9rZW4gPSBlLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JlcyB0aGUgbGlzdGVuZXIgcmVnaXN0ZXJlZCB3aXRoIHNldENoYW5nZUxpc3RlbmVyKClcbiAgICAgICAgICogVGhpcyBpc24ndCBhY3R1YWxseSBuZWNlc3Nhcnkgc2luY2UgdGhlIFVJRCBuZXZlciBjaGFuZ2VzLCBidXQgd2UgdXNlIHRoaXNcbiAgICAgICAgICogdG8gdmVyaWZ5IHRoZSBsaXN0ZW4gY29udHJhY3QgaXMgYWRoZXJlZCB0byBpbiB0ZXN0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXIgPSBudWxsO1xuICAgIH1cbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLnRva2VuKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge31cbiAgICBzdGFydChlLCB0KSB7XG4gICAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXIgPSB0LCBcbiAgICAgICAgLy8gRmlyZSB3aXRoIGluaXRpYWwgdXNlci5cbiAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0KHRoaXMudG9rZW4udXNlcikpKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXIgPSBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0ZpcmViYXNlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy50ID0gZSwgXG4gICAgICAgIC8qKiBUcmFja3MgdGhlIGN1cnJlbnQgVXNlci4gKi9cbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IFVzZXIuVU5BVVRIRU5USUNBVEVELCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvdW50ZXIgdXNlZCB0byBkZXRlY3QgaWYgdGhlIHRva2VuIGNoYW5nZWQgd2hpbGUgYSBnZXRUb2tlbiByZXF1ZXN0IHdhc1xuICAgICAgICAgKiBvdXRzdGFuZGluZy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaSA9IDAsIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXV0aCA9IG51bGw7XG4gICAgfVxuICAgIHN0YXJ0KGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQodm9pZCAwID09PSB0aGlzLm8pO1xuICAgICAgICBsZXQgbiA9IHRoaXMuaTtcbiAgICAgICAgLy8gQSBjaGFuZ2UgbGlzdGVuZXIgdGhhdCBwcmV2ZW50cyBkb3VibGUtZmlyaW5nIGZvciB0aGUgc2FtZSB0b2tlbiBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgY29uc3QgX19QUklWQVRFX2d1YXJkZWRDaGFuZ2VMaXN0ZW5lciA9IGUgPT4gdGhpcy5pICE9PSBuID8gKG4gPSB0aGlzLmksIFxuICAgICAgICB0KGUpKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAvLyBBIHByb21pc2UgdGhhdCBjYW4gYmUgd2FpdGVkIG9uIHRvIGJsb2NrIG9uIHRoZSBuZXh0IHRva2VuIGNoYW5nZS5cbiAgICAgICAgLy8gVGhpcyBwcm9taXNlIGlzIHJlLWNyZWF0ZWQgYWZ0ZXIgZWFjaCBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgbGV0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICB0aGlzLm8gPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmkrKywgdGhpcy5jdXJyZW50VXNlciA9IHRoaXMudSgpLCByLnJlc29sdmUoKSwgciA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIFxuICAgICAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiBfX1BSSVZBVEVfZ3VhcmRlZENoYW5nZUxpc3RlbmVyKHRoaXMuY3VycmVudFVzZXIpKSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IF9fUFJJVkFURV9hd2FpdE5leHRUb2tlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSByO1xuICAgICAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdC5wcm9taXNlLCBhd2FpdCBfX1BSSVZBVEVfZ3VhcmRlZENoYW5nZUxpc3RlbmVyKHRoaXMuY3VycmVudFVzZXIpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9LCBfX1BSSVZBVEVfcmVnaXN0ZXJBdXRoID0gZSA9PiB7XG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyXCIsIFwiQXV0aCBkZXRlY3RlZFwiKSwgdGhpcy5hdXRoID0gZSwgXG4gICAgICAgICAgICB0aGlzLm8gJiYgKHRoaXMuYXV0aC5hZGRBdXRoVG9rZW5MaXN0ZW5lcih0aGlzLm8pLCBfX1BSSVZBVEVfYXdhaXROZXh0VG9rZW4oKSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudC5vbkluaXQoKGUgPT4gX19QUklWQVRFX3JlZ2lzdGVyQXV0aChlKSkpLCBcbiAgICAgICAgLy8gT3VyIHVzZXJzIGNhbiBpbml0aWFsaXplIEF1dGggcmlnaHQgYWZ0ZXIgRmlyZXN0b3JlLCBzbyB3ZSBnaXZlIGl0XG4gICAgICAgIC8vIGEgY2hhbmNlIHRvIHJlZ2lzdGVyIGl0c2VsZiB3aXRoIHRoZSBjb21wb25lbnQgZnJhbWV3b3JrIGJlZm9yZSB3ZVxuICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0byBzdGFydCB1cCBpbiB1bmF1dGhlbnRpY2F0ZWQgbW9kZS5cbiAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmF1dGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy50LmdldEltbWVkaWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsOiAhMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGUgPyBfX1BSSVZBVEVfcmVnaXN0ZXJBdXRoKGUpIDogKFxuICAgICAgICAgICAgICAgIC8vIElmIGF1dGggaXMgc3RpbGwgbm90IGF2YWlsYWJsZSwgcHJvY2VlZCB3aXRoIGBudWxsYCB1c2VyXG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlclwiLCBcIkF1dGggbm90IHlldCBkZXRlY3RlZFwiKSwgXG4gICAgICAgICAgICAgICAgci5yZXNvbHZlKCksIHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksIDApLCBfX1BSSVZBVEVfYXdhaXROZXh0VG9rZW4oKTtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIC8vIFRha2Ugbm90ZSBvZiB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgdG9rZW5Db3VudGVyIHNvIHRoYXQgdGhpcyBtZXRob2RcbiAgICAgICAgLy8gY2FuIGZhaWwgKHdpdGggYW4gQUJPUlRFRCBlcnJvcikgaWYgdGhlcmUgaXMgYSB0b2tlbiBjaGFuZ2Ugd2hpbGUgdGhlXG4gICAgICAgIC8vIHJlcXVlc3QgaXMgb3V0c3RhbmRpbmcuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmksIHQgPSB0aGlzLmZvcmNlUmVmcmVzaDtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXV0aCA/IHRoaXMuYXV0aC5nZXRUb2tlbih0KS50aGVuKCh0ID0+IFxuICAgICAgICAvLyBDYW5jZWwgdGhlIHJlcXVlc3Qgc2luY2UgdGhlIHRva2VuIGNoYW5nZWQgd2hpbGUgdGhlIHJlcXVlc3Qgd2FzXG4gICAgICAgIC8vIG91dHN0YW5kaW5nIHNvIHRoZSByZXNwb25zZSBpcyBwb3RlbnRpYWxseSBmb3IgYSBwcmV2aW91cyB1c2VyICh3aGljaFxuICAgICAgICAvLyB1c2VyLCB3ZSBjYW4ndCBiZSBzdXJlKS5cbiAgICAgICAgdGhpcy5pICE9PSBlID8gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmViYXNlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXJcIiwgXCJnZXRUb2tlbiBhYm9ydGVkIGR1ZSB0byB0b2tlbiBjaGFuZ2UuXCIpLCBcbiAgICAgICAgdGhpcy5nZXRUb2tlbigpKSA6IHQgPyAoX19QUklWQVRFX2hhcmRBc3NlcnQoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdC5hY2Nlc3NUb2tlbiksIFxuICAgICAgICBuZXcgX19QUklWQVRFX09BdXRoVG9rZW4odC5hY2Nlc3NUb2tlbiwgdGhpcy5jdXJyZW50VXNlcikpIDogbnVsbCkpIDogUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7XG4gICAgICAgIHRoaXMuZm9yY2VSZWZyZXNoID0gITA7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB0aGlzLmF1dGggJiYgdGhpcy5vICYmIHRoaXMuYXV0aC5yZW1vdmVBdXRoVG9rZW5MaXN0ZW5lcih0aGlzLm8pLCB0aGlzLm8gPSB2b2lkIDA7XG4gICAgfVxuICAgIC8vIEF1dGguZ2V0VWlkKCkgY2FuIHJldHVybiBudWxsIGV2ZW4gd2l0aCBhIHVzZXIgbG9nZ2VkIGluLiBJdCBpcyBiZWNhdXNlXG4gICAgLy8gZ2V0VWlkKCkgaXMgc3luY2hyb25vdXMsIGJ1dCB0aGUgYXV0aCBjb2RlIHBvcHVsYXRpbmcgVWlkIGlzIGFzeW5jaHJvbm91cy5cbiAgICAvLyBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWQgaW4gdGhlIEF1dGhUb2tlbkxpc3RlbmVyIGNhbGxiYWNrXG4gICAgLy8gdG8gZ3VhcmFudGVlIHRvIGdldCB0aGUgYWN0dWFsIHVzZXIuXG4gICAgdSgpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuYXV0aCAmJiB0aGlzLmF1dGguZ2V0VWlkKCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChudWxsID09PSBlIHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpLCBuZXcgVXNlcihlKTtcbiAgICB9XG59XG5cbi8qXG4gKiBGaXJzdFBhcnR5VG9rZW4gcHJvdmlkZXMgYSBmcmVzaCB0b2tlbiBlYWNoIHRpbWUgaXRzIHZhbHVlXG4gKiBpcyByZXF1ZXN0ZWQsIGJlY2F1c2UgaWYgdGhlIHRva2VuIGlzIHRvbyBvbGQsIHJlcXVlc3RzIHdpbGwgYmUgcmVqZWN0ZWQuXG4gKiBUZWNobmljYWxseSB0aGlzIG1heSBubyBsb25nZXIgYmUgbmVjZXNzYXJ5IHNpbmNlIHRoZSBTREsgc2hvdWxkIGdyYWNlZnVsbHlcbiAqIHJlY292ZXIgZnJvbSB1bmF1dGhlbnRpY2F0ZWQgZXJyb3JzIChzZWUgYi8zMzE0NzgxOCBmb3IgY29udGV4dCksIGJ1dCBpdCdzXG4gKiBzYWZlciB0byBrZWVwIHRoZSBpbXBsZW1lbnRhdGlvbiBhcy1pcy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfRmlyc3RQYXJ0eVRva2VuIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMubCA9IGUsIHRoaXMuaCA9IHQsIHRoaXMuUCA9IG4sIHRoaXMudHlwZSA9IFwiRmlyc3RQYXJ0eVwiLCB0aGlzLnVzZXIgPSBVc2VyLkZJUlNUX1BBUlRZLCBcbiAgICAgICAgdGhpcy5JID0gbmV3IE1hcDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyBhbiBhdXRob3JpemF0aW9uIHRva2VuLCB1c2luZyBhIHByb3ZpZGVkIGZhY3RvcnkgZnVuY3Rpb24sIG9yIHJldHVyblxuICAgICAqIG51bGwuXG4gICAgICovICAgIFQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlAgPyB0aGlzLlAoKSA6IG51bGw7XG4gICAgfVxuICAgIGdldCBoZWFkZXJzKCkge1xuICAgICAgICB0aGlzLkkuc2V0KFwiWC1Hb29nLUF1dGhVc2VyXCIsIHRoaXMubCk7XG4gICAgICAgIC8vIFVzZSBhcnJheSBub3RhdGlvbiB0byBwcmV2ZW50IG1pbmlmaWNhdGlvblxuICAgICAgICBjb25zdCBlID0gdGhpcy5UKCk7XG4gICAgICAgIHJldHVybiBlICYmIHRoaXMuSS5zZXQoXCJBdXRob3JpemF0aW9uXCIsIGUpLCB0aGlzLmggJiYgdGhpcy5JLnNldChcIlgtR29vZy1JYW0tQXV0aG9yaXphdGlvbi1Ub2tlblwiLCB0aGlzLmgpLCBcbiAgICAgICAgdGhpcy5JO1xuICAgIH1cbn1cblxuLypcbiAqIFByb3ZpZGVzIHVzZXIgY3JlZGVudGlhbHMgcmVxdWlyZWQgZm9yIHRoZSBGaXJlc3RvcmUgSmF2YVNjcmlwdCBTREtcbiAqIHRvIGF1dGhlbnRpY2F0ZSB0aGUgdXNlciwgdXNpbmcgdGVjaG5pcXVlIHRoYXQgaXMgb25seSBhdmFpbGFibGVcbiAqIHRvIGFwcGxpY2F0aW9ucyBob3N0ZWQgYnkgR29vZ2xlLlxuICovIGNsYXNzIF9fUFJJVkFURV9GaXJzdFBhcnR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5sID0gZSwgdGhpcy5oID0gdCwgdGhpcy5QID0gbjtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IF9fUFJJVkFURV9GaXJzdFBhcnR5VG9rZW4odGhpcy5sLCB0aGlzLmgsIHRoaXMuUCkpO1xuICAgIH1cbiAgICBzdGFydChlLCB0KSB7XG4gICAgICAgIC8vIEZpcmUgd2l0aCBpbml0aWFsIHVpZC5cbiAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0KFVzZXIuRklSU1RfUEFSVFkpKSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge31cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7fVxufVxuXG5jbGFzcyBBcHBDaGVja1Rva2VuIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBlLCB0aGlzLnR5cGUgPSBcIkFwcENoZWNrXCIsIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAsIGUgJiYgZS5sZW5ndGggPiAwICYmIHRoaXMuaGVhZGVycy5zZXQoXCJ4LWZpcmViYXNlLWFwcGNoZWNrXCIsIHRoaXMudmFsdWUpO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0ZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuQSA9IGUsIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXBwQ2hlY2sgPSBudWxsLCB0aGlzLlIgPSBudWxsO1xuICAgIH1cbiAgICBzdGFydChlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KHZvaWQgMCA9PT0gdGhpcy5vKTtcbiAgICAgICAgY29uc3Qgb25Ub2tlbkNoYW5nZWQgPSBlID0+IHtcbiAgICAgICAgICAgIG51bGwgIT0gZS5lcnJvciAmJiBfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlclwiLCBgRXJyb3IgZ2V0dGluZyBBcHAgQ2hlY2sgdG9rZW47IHVzaW5nIHBsYWNlaG9sZGVyIHRva2VuIGluc3RlYWQuIEVycm9yOiAke2UuZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLnRva2VuICE9PSB0aGlzLlI7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5SID0gZS50b2tlbiwgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgYFJlY2VpdmVkICR7biA/IFwibmV3XCIgOiBcImV4aXN0aW5nXCJ9IHRva2VuLmApLCBcbiAgICAgICAgICAgIG4gPyB0KGUudG9rZW4pIDogUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubyA9IHQgPT4ge1xuICAgICAgICAgICAgZS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiBvblRva2VuQ2hhbmdlZCh0KSkpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBfX1BSSVZBVEVfcmVnaXN0ZXJBcHBDaGVjayA9IGUgPT4ge1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgXCJBcHBDaGVjayBkZXRlY3RlZFwiKSwgdGhpcy5hcHBDaGVjayA9IGUsIFxuICAgICAgICAgICAgdGhpcy5vICYmIHRoaXMuYXBwQ2hlY2suYWRkVG9rZW5MaXN0ZW5lcih0aGlzLm8pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLkEub25Jbml0KChlID0+IF9fUFJJVkFURV9yZWdpc3RlckFwcENoZWNrKGUpKSksIFxuICAgICAgICAvLyBPdXIgdXNlcnMgY2FuIGluaXRpYWxpemUgQXBwQ2hlY2sgYWZ0ZXIgRmlyZXN0b3JlLCBzbyB3ZSBnaXZlIGl0XG4gICAgICAgIC8vIGEgY2hhbmNlIHRvIHJlZ2lzdGVyIGl0c2VsZiB3aXRoIHRoZSBjb21wb25lbnQgZnJhbWV3b3JrLlxuICAgICAgICBzZXRUaW1lb3V0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXBwQ2hlY2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5BLmdldEltbWVkaWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsOiAhMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGUgPyBfX1BSSVZBVEVfcmVnaXN0ZXJBcHBDaGVjayhlKSA6IFxuICAgICAgICAgICAgICAgIC8vIElmIEFwcENoZWNrIGlzIHN0aWxsIG5vdCBhdmFpbGFibGUsIHByb2NlZWQgd2l0aG91dCBpdC5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlclwiLCBcIkFwcENoZWNrIG5vdCB5ZXQgZGV0ZWN0ZWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCAwKTtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmZvcmNlUmVmcmVzaDtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yY2VSZWZyZXNoID0gITEsIHRoaXMuYXBwQ2hlY2sgPyB0aGlzLmFwcENoZWNrLmdldFRva2VuKGUpLnRoZW4oKGUgPT4gZSA/IChfX1BSSVZBVEVfaGFyZEFzc2VydChcInN0cmluZ1wiID09IHR5cGVvZiBlLnRva2VuKSwgXG4gICAgICAgIHRoaXMuUiA9IGUudG9rZW4sIG5ldyBBcHBDaGVja1Rva2VuKGUudG9rZW4pKSA6IG51bGwpKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge1xuICAgICAgICB0aGlzLmZvcmNlUmVmcmVzaCA9ICEwO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgdGhpcy5hcHBDaGVjayAmJiB0aGlzLm8gJiYgdGhpcy5hcHBDaGVjay5yZW1vdmVUb2tlbkxpc3RlbmVyKHRoaXMubyksIHRoaXMubyA9IHZvaWQgMDtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gQXBwQ2hlY2sgdG9rZW4gcHJvdmlkZXIgdGhhdCBhbHdheXMgeWllbGRzIGFuIGVtcHR5IHRva2VuLlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgX19QUklWQVRFX0VtcHR5QXBwQ2hlY2tUb2tlblByb3ZpZGVyIHtcbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgQXBwQ2hlY2tUb2tlbihcIlwiKSk7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHt9XG4gICAgc3RhcnQoZSwgdCkge31cbiAgICBzaHV0ZG93bigpIHt9XG59XG5cbi8qKlxuICogQnVpbGRzIGEgQ3JlZGVudGlhbHNQcm92aWRlciBkZXBlbmRpbmcgb24gdGhlIHR5cGUgb2ZcbiAqIHRoZSBjcmVkZW50aWFscyBwYXNzZWQgaW4uXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEdlbmVyYXRlcyBgbkJ5dGVzYCBvZiByYW5kb20gYnl0ZXMuXG4gKlxuICogSWYgYG5CeXRlcyA8IDBgICwgYW4gZXJyb3Igd2lsbCBiZSB0aHJvd24uXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9yYW5kb21CeXRlcyhlKSB7XG4gICAgLy8gUG9seWZpbGxzIGZvciBJRSBhbmQgV2ViV29ya2VyIGJ5IHVzaW5nIGBzZWxmYCBhbmQgYG1zQ3J5cHRvYCB3aGVuIGBjcnlwdG9gIGlzIG5vdCBhdmFpbGFibGUuXG4gICAgY29uc3QgdCA9IFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2Ygc2VsZiAmJiAoc2VsZi5jcnlwdG8gfHwgc2VsZi5tc0NyeXB0byksIG4gPSBuZXcgVWludDhBcnJheShlKTtcbiAgICBpZiAodCAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQuZ2V0UmFuZG9tVmFsdWVzKSB0LmdldFJhbmRvbVZhbHVlcyhuKTsgZWxzZSBcbiAgICAvLyBGYWxscyBiYWNrIHRvIE1hdGgucmFuZG9tXG4gICAgZm9yIChsZXQgdCA9IDA7IHQgPCBlOyB0KyspIG5bdF0gPSBNYXRoLmZsb29yKDI1NiAqIE1hdGgucmFuZG9tKCkpO1xuICAgIHJldHVybiBuO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHV0aWxpdHkgY2xhc3MgZm9yIGdlbmVyYXRpbmcgdW5pcXVlIGFscGhhbnVtZXJpYyBJRHMgb2YgYSBzcGVjaWZpZWQgbGVuZ3RoLlxuICpcbiAqIEBpbnRlcm5hbFxuICogRXhwb3J0ZWQgaW50ZXJuYWxseSBmb3IgdGVzdGluZyBwdXJwb3Nlcy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQXV0b0lkIHtcbiAgICBzdGF0aWMgbmV3SWQoKSB7XG4gICAgICAgIC8vIEFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzXG4gICAgICAgIGNvbnN0IGUgPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5XCIsIHQgPSBNYXRoLmZsb29yKDI1NiAvIGUubGVuZ3RoKSAqIGUubGVuZ3RoO1xuICAgICAgICAvLyBUaGUgbGFyZ2VzdCBieXRlIHZhbHVlIHRoYXQgaXMgYSBtdWx0aXBsZSBvZiBgY2hhci5sZW5ndGhgLlxuICAgICAgICAgICAgICAgIGxldCBuID0gXCJcIjtcbiAgICAgICAgZm9yICg7bi5sZW5ndGggPCAyMDsgKSB7XG4gICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3JhbmRvbUJ5dGVzKDQwKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgci5sZW5ndGg7ICsraSkgXG4gICAgICAgICAgICAvLyBPbmx5IGFjY2VwdCB2YWx1ZXMgdGhhdCBhcmUgWzAsIG1heE11bHRpcGxlKSwgdGhpcyBlbnN1cmVzIHRoZXkgY2FuXG4gICAgICAgICAgICAvLyBiZSBldmVubHkgbWFwcGVkIHRvIGluZGljZXMgb2YgYGNoYXJzYCB2aWEgYSBtb2R1bG8gb3BlcmF0aW9uLlxuICAgICAgICAgICAgbi5sZW5ndGggPCAyMCAmJiByW2ldIDwgdCAmJiAobiArPSBlLmNoYXJBdChyW2ldICUgZS5sZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbjtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUsIHQpIHtcbiAgICByZXR1cm4gZSA8IHQgPyAtMSA6IGUgPiB0ID8gMSA6IDA7XG59XG5cbi8qKiBIZWxwZXIgdG8gY29tcGFyZSBhcnJheXMgdXNpbmcgaXNFcXVhbCgpLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYXJyYXlFcXVhbHMoZSwgdCwgbikge1xuICAgIHJldHVybiBlLmxlbmd0aCA9PT0gdC5sZW5ndGggJiYgZS5ldmVyeSgoKGUsIHIpID0+IG4oZSwgdFtyXSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBpbW1lZGlhdGUgbGV4aWNvZ3JhcGhpY2FsbHktZm9sbG93aW5nIHN0cmluZy4gVGhpcyBpcyB1c2VmdWwgdG9cbiAqIGNvbnN0cnVjdCBhbiBpbmNsdXNpdmUgcmFuZ2UgZm9yIGluZGV4ZWRkYiBpdGVyYXRvcnMuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ltbWVkaWF0ZVN1Y2Nlc3NvcihlKSB7XG4gICAgLy8gUmV0dXJuIHRoZSBpbnB1dCBzdHJpbmcsIHdpdGggYW4gYWRkaXRpb25hbCBOVUwgYnl0ZSBhcHBlbmRlZC5cbiAgICByZXR1cm4gZSArIFwiXFwwXCI7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBUaGUgZWFybGllc3QgZGF0ZSBzdXBwb3J0ZWQgYnkgRmlyZXN0b3JlIHRpbWVzdGFtcHMgKDAwMDEtMDEtMDFUMDA6MDA6MDBaKS5cbi8qKlxuICogQSBgVGltZXN0YW1wYCByZXByZXNlbnRzIGEgcG9pbnQgaW4gdGltZSBpbmRlcGVuZGVudCBvZiBhbnkgdGltZSB6b25lIG9yXG4gKiBjYWxlbmRhciwgcmVwcmVzZW50ZWQgYXMgc2Vjb25kcyBhbmQgZnJhY3Rpb25zIG9mIHNlY29uZHMgYXQgbmFub3NlY29uZFxuICogcmVzb2x1dGlvbiBpbiBVVEMgRXBvY2ggdGltZS5cbiAqXG4gKiBJdCBpcyBlbmNvZGVkIHVzaW5nIHRoZSBQcm9sZXB0aWMgR3JlZ29yaWFuIENhbGVuZGFyIHdoaWNoIGV4dGVuZHMgdGhlXG4gKiBHcmVnb3JpYW4gY2FsZW5kYXIgYmFja3dhcmRzIHRvIHllYXIgb25lLiBJdCBpcyBlbmNvZGVkIGFzc3VtaW5nIGFsbCBtaW51dGVzXG4gKiBhcmUgNjAgc2Vjb25kcyBsb25nLCBpLmUuIGxlYXAgc2Vjb25kcyBhcmUgXCJzbWVhcmVkXCIgc28gdGhhdCBubyBsZWFwIHNlY29uZFxuICogdGFibGUgaXMgbmVlZGVkIGZvciBpbnRlcnByZXRhdGlvbi4gUmFuZ2UgaXMgZnJvbSAwMDAxLTAxLTAxVDAwOjAwOjAwWiB0b1xuICogOTk5OS0xMi0zMVQyMzo1OTo1OS45OTk5OTk5OTlaLlxuICpcbiAqIEZvciBleGFtcGxlcyBhbmQgZnVydGhlciBzcGVjaWZpY2F0aW9ucywgcmVmZXIgdG8gdGhlXG4gKiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9wcm90b2J1Zi9ibG9iL21hc3Rlci9zcmMvZ29vZ2xlL3Byb3RvYnVmL3RpbWVzdGFtcC5wcm90byB8IFRpbWVzdGFtcCBkZWZpbml0aW9ufS5cbiAqL1xuY2xhc3MgVGltZXN0YW1wIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRpbWVzdGFtcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZWNvbmRzIC0gVGhlIG51bWJlciBvZiBzZWNvbmRzIG9mIFVUQyB0aW1lIHNpbmNlIFVuaXggZXBvY2hcbiAgICAgKiAgICAgMTk3MC0wMS0wMVQwMDowMDowMFouIE11c3QgYmUgZnJvbSAwMDAxLTAxLTAxVDAwOjAwOjAwWiB0b1xuICAgICAqICAgICA5OTk5LTEyLTMxVDIzOjU5OjU5WiBpbmNsdXNpdmUuXG4gICAgICogQHBhcmFtIG5hbm9zZWNvbmRzIC0gVGhlIG5vbi1uZWdhdGl2ZSBmcmFjdGlvbnMgb2YgYSBzZWNvbmQgYXQgbmFub3NlY29uZFxuICAgICAqICAgICByZXNvbHV0aW9uLiBOZWdhdGl2ZSBzZWNvbmQgdmFsdWVzIHdpdGggZnJhY3Rpb25zIG11c3Qgc3RpbGwgaGF2ZVxuICAgICAqICAgICBub24tbmVnYXRpdmUgbmFub3NlY29uZHMgdmFsdWVzIHRoYXQgY291bnQgZm9yd2FyZCBpbiB0aW1lLiBNdXN0IGJlXG4gICAgICogICAgIGZyb20gMCB0byA5OTksOTk5LDk5OSBpbmNsdXNpdmUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBzZWNvbmRzIG9mIFVUQyB0aW1lIHNpbmNlIFVuaXggZXBvY2ggMTk3MC0wMS0wMVQwMDowMDowMFouXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGZyYWN0aW9ucyBvZiBhIHNlY29uZCBhdCBuYW5vc2Vjb25kIHJlc29sdXRpb24uKlxuICAgICAqL1xuICAgIHQpIHtcbiAgICAgICAgaWYgKHRoaXMuc2Vjb25kcyA9IGUsIHRoaXMubmFub3NlY29uZHMgPSB0LCB0IDwgMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgbmFub3NlY29uZHMgb3V0IG9mIHJhbmdlOiBcIiArIHQpO1xuICAgICAgICBpZiAodCA+PSAxZTkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiVGltZXN0YW1wIG5hbm9zZWNvbmRzIG91dCBvZiByYW5nZTogXCIgKyB0KTtcbiAgICAgICAgaWYgKGUgPCAtNjIxMzU1OTY4MDApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiVGltZXN0YW1wIHNlY29uZHMgb3V0IG9mIHJhbmdlOiBcIiArIGUpO1xuICAgICAgICAvLyBUaGlzIHdpbGwgYnJlYWsgaW4gdGhlIHllYXIgMTAsMDAwLlxuICAgICAgICAgICAgICAgIGlmIChlID49IDI1MzQwMjMwMDgwMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGltZXN0YW1wIHdpdGggdGhlIGN1cnJlbnQgZGF0ZSwgd2l0aCBtaWxsaXNlY29uZCBwcmVjaXNpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBhIG5ldyB0aW1lc3RhbXAgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50IGRhdGUuXG4gICAgICovICAgIHN0YXRpYyBub3coKSB7XG4gICAgICAgIHJldHVybiBUaW1lc3RhbXAuZnJvbU1pbGxpcyhEYXRlLm5vdygpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0aW1lc3RhbXAgZnJvbSB0aGUgZ2l2ZW4gZGF0ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYXRlIC0gVGhlIGRhdGUgdG8gaW5pdGlhbGl6ZSB0aGUgYFRpbWVzdGFtcGAgZnJvbS5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyBgVGltZXN0YW1wYCByZXByZXNlbnRpbmcgdGhlIHNhbWUgcG9pbnQgaW4gdGltZSBhcyB0aGUgZ2l2ZW5cbiAgICAgKiAgICAgZGF0ZS5cbiAgICAgKi8gICAgc3RhdGljIGZyb21EYXRlKGUpIHtcbiAgICAgICAgcmV0dXJuIFRpbWVzdGFtcC5mcm9tTWlsbGlzKGUuZ2V0VGltZSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0aW1lc3RhbXAgZnJvbSB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBtaWxsaXNlY29uZHMgLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlIFVuaXggZXBvY2hcbiAgICAgKiAgICAgMTk3MC0wMS0wMVQwMDowMDowMFouXG4gICAgICogQHJldHVybnMgQSBuZXcgYFRpbWVzdGFtcGAgcmVwcmVzZW50aW5nIHRoZSBzYW1lIHBvaW50IGluIHRpbWUgYXMgdGhlIGdpdmVuXG4gICAgICogICAgIG51bWJlciBvZiBtaWxsaXNlY29uZHMuXG4gICAgICovICAgIHN0YXRpYyBmcm9tTWlsbGlzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IE1hdGguZmxvb3IoZSAvIDFlMyksIG4gPSBNYXRoLmZsb29yKDFlNiAqIChlIC0gMWUzICogdCkpO1xuICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcCh0LCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYSBgVGltZXN0YW1wYCB0byBhIEphdmFTY3JpcHQgYERhdGVgIG9iamVjdC4gVGhpcyBjb252ZXJzaW9uXG4gICAgICogY2F1c2VzIGEgbG9zcyBvZiBwcmVjaXNpb24gc2luY2UgYERhdGVgIG9iamVjdHMgb25seSBzdXBwb3J0IG1pbGxpc2Vjb25kXG4gICAgICogcHJlY2lzaW9uLlxuICAgICAqXG4gICAgICogQHJldHVybnMgSmF2YVNjcmlwdCBgRGF0ZWAgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2FtZSBwb2ludCBpbiB0aW1lIGFzXG4gICAgICogICAgIHRoaXMgYFRpbWVzdGFtcGAsIHdpdGggbWlsbGlzZWNvbmQgcHJlY2lzaW9uLlxuICAgICAqLyAgICB0b0RhdGUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLnRvTWlsbGlzKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhIGBUaW1lc3RhbXBgIHRvIGEgbnVtZXJpYyB0aW1lc3RhbXAgKGluIG1pbGxpc2Vjb25kcyBzaW5jZVxuICAgICAqIGVwb2NoKS4gVGhpcyBvcGVyYXRpb24gY2F1c2VzIGEgbG9zcyBvZiBwcmVjaXNpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgcG9pbnQgaW4gdGltZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgdGltZXN0YW1wLCByZXByZXNlbnRlZCBhc1xuICAgICAqICAgICB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IGVwb2NoIDE5NzAtMDEtMDFUMDA6MDA6MDBaLlxuICAgICAqLyAgICB0b01pbGxpcygpIHtcbiAgICAgICAgcmV0dXJuIDFlMyAqIHRoaXMuc2Vjb25kcyArIHRoaXMubmFub3NlY29uZHMgLyAxZTY7XG4gICAgfVxuICAgIF9jb21wYXJlVG8oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWNvbmRzID09PSBlLnNlY29uZHMgPyBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcih0aGlzLm5hbm9zZWNvbmRzLCBlLm5hbm9zZWNvbmRzKSA6IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHRoaXMuc2Vjb25kcywgZS5zZWNvbmRzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgYFRpbWVzdGFtcGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgVGltZXN0YW1wYCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBUaW1lc3RhbXBgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICovICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZS5zZWNvbmRzID09PSB0aGlzLnNlY29uZHMgJiYgZS5uYW5vc2Vjb25kcyA9PT0gdGhpcy5uYW5vc2Vjb25kcztcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSB0ZXh0dWFsIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgYFRpbWVzdGFtcGAuICovICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gXCJUaW1lc3RhbXAoc2Vjb25kcz1cIiArIHRoaXMuc2Vjb25kcyArIFwiLCBuYW5vc2Vjb25kcz1cIiArIHRoaXMubmFub3NlY29uZHMgKyBcIilcIjtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSBKU09OLXNlcmlhbGl6YWJsZSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGBUaW1lc3RhbXBgLiAqLyAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZWNvbmRzOiB0aGlzLnNlY29uZHMsXG4gICAgICAgICAgICBuYW5vc2Vjb25kczogdGhpcy5uYW5vc2Vjb25kc1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyB0aGlzIG9iamVjdCB0byBhIHByaW1pdGl2ZSBzdHJpbmcsIHdoaWNoIGFsbG93cyBgVGltZXN0YW1wYCBvYmplY3RzXG4gICAgICogdG8gYmUgY29tcGFyZWQgdXNpbmcgdGhlIGA+YCwgYDw9YCwgYD49YCBhbmQgYD5gIG9wZXJhdG9ycy5cbiAgICAgKi8gICAgdmFsdWVPZigpIHtcbiAgICAgICAgLy8gVGhpcyBtZXRob2QgcmV0dXJucyBhIHN0cmluZyBvZiB0aGUgZm9ybSA8c2Vjb25kcz4uPG5hbm9zZWNvbmRzPiB3aGVyZVxuICAgICAgICAvLyA8c2Vjb25kcz4gaXMgdHJhbnNsYXRlZCB0byBoYXZlIGEgbm9uLW5lZ2F0aXZlIHZhbHVlIGFuZCBib3RoIDxzZWNvbmRzPlxuICAgICAgICAvLyBhbmQgPG5hbm9zZWNvbmRzPiBhcmUgbGVmdC1wYWRkZWQgd2l0aCB6ZXJvZXMgdG8gYmUgYSBjb25zaXN0ZW50IGxlbmd0aC5cbiAgICAgICAgLy8gU3RyaW5ncyB3aXRoIHRoaXMgZm9ybWF0IHRoZW4gaGF2ZSBhIGxleGljb2dyYXBoaWNhbCBvcmRlcmluZyB0aGF0IG1hdGNoZXNcbiAgICAgICAgLy8gdGhlIGV4cGVjdGVkIG9yZGVyaW5nLiBUaGUgPHNlY29uZHM+IHRyYW5zbGF0aW9uIGlzIGRvbmUgdG8gYXZvaWQgaGF2aW5nXG4gICAgICAgIC8vIGEgbGVhZGluZyBuZWdhdGl2ZSBzaWduIChpLmUuIGEgbGVhZGluZyAnLScgY2hhcmFjdGVyKSBpbiBpdHMgc3RyaW5nXG4gICAgICAgIC8vIHJlcHJlc2VudGF0aW9uLCB3aGljaCB3b3VsZCBhZmZlY3QgaXRzIGxleGljb2dyYXBoaWNhbCBvcmRlcmluZy5cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuc2Vjb25kcyAtIC02MjEzNTU5NjgwMDtcbiAgICAgICAgLy8gTm90ZTogVXAgdG8gMTIgZGVjaW1hbCBkaWdpdHMgYXJlIHJlcXVpcmVkIHRvIHJlcHJlc2VudCBhbGwgdmFsaWRcbiAgICAgICAgLy8gJ3NlY29uZHMnIHZhbHVlcy5cbiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKGUpLnBhZFN0YXJ0KDEyLCBcIjBcIikgKyBcIi5cIiArIFN0cmluZyh0aGlzLm5hbm9zZWNvbmRzKS5wYWRTdGFydCg5LCBcIjBcIik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHZlcnNpb24gb2YgYSBkb2N1bWVudCBpbiBGaXJlc3RvcmUuIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIHZlcnNpb25cbiAqIHRpbWVzdGFtcCwgc3VjaCBhcyB1cGRhdGVfdGltZSBvciByZWFkX3RpbWUuXG4gKi8gY2xhc3MgU25hcHNob3RWZXJzaW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudGltZXN0YW1wID0gZTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21UaW1lc3RhbXAoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNuYXBzaG90VmVyc2lvbihlKTtcbiAgICB9XG4gICAgc3RhdGljIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTbmFwc2hvdFZlcnNpb24obmV3IFRpbWVzdGFtcCgwLCAwKSk7XG4gICAgfVxuICAgIHN0YXRpYyBtYXgoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU25hcHNob3RWZXJzaW9uKG5ldyBUaW1lc3RhbXAoMjUzNDAyMzAwNzk5LCA5OTk5OTk5OTkpKTtcbiAgICB9XG4gICAgY29tcGFyZVRvKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wLl9jb21wYXJlVG8oZS50aW1lc3RhbXApO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wLmlzRXF1YWwoZS50aW1lc3RhbXApO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIG51bWJlciByZXByZXNlbnRhdGlvbiBvZiB0aGUgdmVyc2lvbiBmb3IgdXNlIGluIHNwZWMgdGVzdHMuICovICAgIHRvTWljcm9zZWNvbmRzKCkge1xuICAgICAgICAvLyBDb252ZXJ0IHRvIG1pY3Jvc2Vjb25kcy5cbiAgICAgICAgcmV0dXJuIDFlNiAqIHRoaXMudGltZXN0YW1wLnNlY29uZHMgKyB0aGlzLnRpbWVzdGFtcC5uYW5vc2Vjb25kcyAvIDFlMztcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBcIlNuYXBzaG90VmVyc2lvbihcIiArIHRoaXMudGltZXN0YW1wLnRvU3RyaW5nKCkgKyBcIilcIjtcbiAgICB9XG4gICAgdG9UaW1lc3RhbXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVzdGFtcDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFBhdGggcmVwcmVzZW50cyBhbiBvcmRlcmVkIHNlcXVlbmNlIG9mIHN0cmluZyBzZWdtZW50cy5cbiAqL1xuY2xhc3MgQmFzZVBhdGgge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdm9pZCAwID09PSB0ID8gdCA9IDAgOiB0ID4gZS5sZW5ndGggJiYgZmFpbCgpLCB2b2lkIDAgPT09IG4gPyBuID0gZS5sZW5ndGggLSB0IDogbiA+IGUubGVuZ3RoIC0gdCAmJiBmYWlsKCksIFxuICAgICAgICB0aGlzLnNlZ21lbnRzID0gZSwgdGhpcy5vZmZzZXQgPSB0LCB0aGlzLmxlbiA9IG47XG4gICAgfVxuICAgIGdldCBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlbjtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiAwID09PSBCYXNlUGF0aC5jb21wYXJhdG9yKHRoaXMsIGUpO1xuICAgIH1cbiAgICBjaGlsZChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnNlZ21lbnRzLnNsaWNlKHRoaXMub2Zmc2V0LCB0aGlzLmxpbWl0KCkpO1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEJhc2VQYXRoID8gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQucHVzaChlKTtcbiAgICAgICAgfSkpIDogdC5wdXNoKGUpLCB0aGlzLmNvbnN0cnVjdCh0KTtcbiAgICB9XG4gICAgLyoqIFRoZSBpbmRleCBvZiBvbmUgcGFzdCB0aGUgbGFzdCBzZWdtZW50IG9mIHRoZSBwYXRoLiAqLyAgICBsaW1pdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0ICsgdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIHBvcEZpcnN0KGUpIHtcbiAgICAgICAgcmV0dXJuIGUgPSB2b2lkIDAgPT09IGUgPyAxIDogZSwgdGhpcy5jb25zdHJ1Y3QodGhpcy5zZWdtZW50cywgdGhpcy5vZmZzZXQgKyBlLCB0aGlzLmxlbmd0aCAtIGUpO1xuICAgIH1cbiAgICBwb3BMYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3QodGhpcy5zZWdtZW50cywgdGhpcy5vZmZzZXQsIHRoaXMubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGZpcnN0U2VnbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VnbWVudHNbdGhpcy5vZmZzZXRdO1xuICAgIH1cbiAgICBsYXN0U2VnbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KHRoaXMubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGdldChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlZ21lbnRzW3RoaXMub2Zmc2V0ICsgZV07XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiAwID09PSB0aGlzLmxlbmd0aDtcbiAgICB9XG4gICAgaXNQcmVmaXhPZihlKSB7XG4gICAgICAgIGlmIChlLmxlbmd0aCA8IHRoaXMubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgdGhpcy5sZW5ndGg7IHQrKykgaWYgKHRoaXMuZ2V0KHQpICE9PSBlLmdldCh0KSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGlzSW1tZWRpYXRlUGFyZW50T2YoZSkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggKyAxICE9PSBlLmxlbmd0aCkgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IHRoaXMubGVuZ3RoOyB0KyspIGlmICh0aGlzLmdldCh0KSAhPT0gZS5nZXQodCkpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICBmb3JFYWNoKGUpIHtcbiAgICAgICAgZm9yIChsZXQgdCA9IHRoaXMub2Zmc2V0LCBuID0gdGhpcy5saW1pdCgpOyB0IDwgbjsgdCsrKSBlKHRoaXMuc2VnbWVudHNbdF0pO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWdtZW50cy5zbGljZSh0aGlzLm9mZnNldCwgdGhpcy5saW1pdCgpKTtcbiAgICB9XG4gICAgc3RhdGljIGNvbXBhcmF0b3IoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gTWF0aC5taW4oZS5sZW5ndGgsIHQubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBuOyByKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmdldChyKSwgaSA9IHQuZ2V0KHIpO1xuICAgICAgICAgICAgaWYgKG4gPCBpKSByZXR1cm4gLTE7XG4gICAgICAgICAgICBpZiAobiA+IGkpIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlLmxlbmd0aCA8IHQubGVuZ3RoID8gLTEgOiBlLmxlbmd0aCA+IHQubGVuZ3RoID8gMSA6IDA7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgc2xhc2gtc2VwYXJhdGVkIHBhdGggZm9yIG5hdmlnYXRpbmcgcmVzb3VyY2VzIChkb2N1bWVudHMgYW5kIGNvbGxlY3Rpb25zKVxuICogd2l0aGluIEZpcmVzdG9yZS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBSZXNvdXJjZVBhdGggZXh0ZW5kcyBCYXNlUGF0aCB7XG4gICAgY29uc3RydWN0KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNvdXJjZVBhdGgoZSwgdCwgbik7XG4gICAgfVxuICAgIGNhbm9uaWNhbFN0cmluZygpIHtcbiAgICAgICAgLy8gTk9URTogVGhlIGNsaWVudCBpcyBpZ25vcmFudCBvZiBhbnkgcGF0aCBzZWdtZW50cyBjb250YWluaW5nIGVzY2FwZVxuICAgICAgICAvLyBzZXF1ZW5jZXMgKGUuZy4gX19pZDEyM19fKSBhbmQganVzdCBwYXNzZXMgdGhlbSB0aHJvdWdoIHJhdyAodGhleSBleGlzdFxuICAgICAgICAvLyBmb3IgbGVnYWN5IHJlYXNvbnMgYW5kIHNob3VsZCBub3QgYmUgdXNlZCBmcmVxdWVudGx5KS5cbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmpvaW4oXCIvXCIpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwYXRoXG4gICAgICogd2hlcmUgZWFjaCBwYXRoIHNlZ21lbnQgaGFzIGJlZW4gZW5jb2RlZCB3aXRoXG4gICAgICogYGVuY29kZVVSSUNvbXBvbmVudGAuXG4gICAgICovICAgIHRvVXJpRW5jb2RlZFN0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLm1hcChlbmNvZGVVUklDb21wb25lbnQpLmpvaW4oXCIvXCIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgcmVzb3VyY2UgcGF0aCBmcm9tIHRoZSBnaXZlbiBzbGFzaC1kZWxpbWl0ZWQgc3RyaW5nLiBJZiBtdWx0aXBsZVxuICAgICAqIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQsIGFsbCBjb21wb25lbnRzIGFyZSBjb21iaW5lZC4gTGVhZGluZyBhbmQgdHJhaWxpbmdcbiAgICAgKiBzbGFzaGVzIGZyb20gYWxsIGNvbXBvbmVudHMgYXJlIGlnbm9yZWQuXG4gICAgICovICAgIHN0YXRpYyBmcm9tU3RyaW5nKC4uLmUpIHtcbiAgICAgICAgLy8gTk9URTogVGhlIGNsaWVudCBpcyBpZ25vcmFudCBvZiBhbnkgcGF0aCBzZWdtZW50cyBjb250YWluaW5nIGVzY2FwZVxuICAgICAgICAvLyBzZXF1ZW5jZXMgKGUuZy4gX19pZDEyM19fKSBhbmQganVzdCBwYXNzZXMgdGhlbSB0aHJvdWdoIHJhdyAodGhleSBleGlzdFxuICAgICAgICAvLyBmb3IgbGVnYWN5IHJlYXNvbnMgYW5kIHNob3VsZCBub3QgYmUgdXNlZCBmcmVxdWVudGx5KS5cbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZSkge1xuICAgICAgICAgICAgaWYgKG4uaW5kZXhPZihcIi8vXCIpID49IDApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHNlZ21lbnQgKCR7bn0pLiBQYXRocyBtdXN0IG5vdCBjb250YWluIC8vIGluIHRoZW0uYCk7XG4gICAgICAgICAgICAvLyBTdHJpcCBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgdC5wdXNoKC4uLm4uc3BsaXQoXCIvXCIpLmZpbHRlcigoZSA9PiBlLmxlbmd0aCA+IDApKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBSZXNvdXJjZVBhdGgodCk7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eVBhdGgoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVzb3VyY2VQYXRoKFtdKTtcbiAgICB9XG59XG5cbmNvbnN0IHYgPSAvXltfYS16QS1aXVtfYS16QS1aMC05XSokLztcblxuLyoqXG4gKiBBIGRvdC1zZXBhcmF0ZWQgcGF0aCBmb3IgbmF2aWdhdGluZyBzdWItb2JqZWN0cyB3aXRoaW4gYSBkb2N1bWVudC5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIEZpZWxkUGF0aCQxIGV4dGVuZHMgQmFzZVBhdGgge1xuICAgIGNvbnN0cnVjdChlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRQYXRoJDEoZSwgdCwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgc3RyaW5nIGNvdWxkIGJlIHVzZWQgYXMgYSBzZWdtZW50IGluIGEgZmllbGQgcGF0aFxuICAgICAqIHdpdGhvdXQgZXNjYXBpbmcuXG4gICAgICovICAgIHN0YXRpYyBpc1ZhbGlkSWRlbnRpZmllcihlKSB7XG4gICAgICAgIHJldHVybiB2LnRlc3QoZSk7XG4gICAgfVxuICAgIGNhbm9uaWNhbFN0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLm1hcCgoZSA9PiAoZSA9IGUucmVwbGFjZSgvXFxcXC9nLCBcIlxcXFxcXFxcXCIpLnJlcGxhY2UoL2AvZywgXCJcXFxcYFwiKSwgXG4gICAgICAgIEZpZWxkUGF0aCQxLmlzVmFsaWRJZGVudGlmaWVyKGUpIHx8IChlID0gXCJgXCIgKyBlICsgXCJgXCIpLCBlKSkpLmpvaW4oXCIuXCIpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGZpZWxkIHJlZmVyZW5jZXMgdGhlIGtleSBvZiBhIGRvY3VtZW50LlxuICAgICAqLyAgICBpc0tleUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gMSA9PT0gdGhpcy5sZW5ndGggJiYgXCJfX25hbWVfX1wiID09PSB0aGlzLmdldCgwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGZpZWxkIGRlc2lnbmF0aW5nIHRoZSBrZXkgb2YgYSBkb2N1bWVudC5cbiAgICAgKi8gICAgc3RhdGljIGtleUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkUGF0aCQxKFsgXCJfX25hbWVfX1wiIF0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBmaWVsZCBzdHJpbmcgZnJvbSB0aGUgZ2l2ZW4gc2VydmVyLWZvcm1hdHRlZCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiAtIFNwbGl0dGluZyB0aGUgZW1wdHkgc3RyaW5nIGlzIG5vdCBhbGxvd2VkIChmb3Igbm93IGF0IGxlYXN0KS5cbiAgICAgKiAtIEVtcHR5IHNlZ21lbnRzIHdpdGhpbiB0aGUgc3RyaW5nIChlLmcuIGlmIHRoZXJlIGFyZSB0d28gY29uc2VjdXRpdmVcbiAgICAgKiAgIHNlcGFyYXRvcnMpIGFyZSBub3QgYWxsb3dlZC5cbiAgICAgKlxuICAgICAqIFRPRE8oYi8zNzI0NDE1Nyk6IHdlIHNob3VsZCBtYWtlIHRoaXMgbW9yZSBzdHJpY3QuIFJpZ2h0IG5vdywgaXQgYWxsb3dzXG4gICAgICogbm9uLWlkZW50aWZpZXIgcGF0aCBjb21wb25lbnRzLCBldmVuIGlmIHRoZXkgYXJlbid0IGVzY2FwZWQuXG4gICAgICovICAgIHN0YXRpYyBmcm9tU2VydmVyRm9ybWF0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBsZXQgbiA9IFwiXCIsIHIgPSAwO1xuICAgICAgICBjb25zdCBfX1BSSVZBVEVfYWRkQ3VycmVudFNlZ21lbnQgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoMCA9PT0gbi5sZW5ndGgpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGZpZWxkIHBhdGggKCR7ZX0pLiBQYXRocyBtdXN0IG5vdCBiZSBlbXB0eSwgYmVnaW4gd2l0aCAnLicsIGVuZCB3aXRoICcuJywgb3IgY29udGFpbiAnLi4nYCk7XG4gICAgICAgICAgICB0LnB1c2gobiksIG4gPSBcIlwiO1xuICAgICAgICB9O1xuICAgICAgICBsZXQgaSA9ICExO1xuICAgICAgICBmb3IgKDtyIDwgZS5sZW5ndGg7ICkge1xuICAgICAgICAgICAgY29uc3QgdCA9IGVbcl07XG4gICAgICAgICAgICBpZiAoXCJcXFxcXCIgPT09IHQpIHtcbiAgICAgICAgICAgICAgICBpZiAociArIDEgPT09IGUubGVuZ3RoKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBcIlBhdGggaGFzIHRyYWlsaW5nIGVzY2FwZSBjaGFyYWN0ZXI6IFwiICsgZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGVbciArIDFdO1xuICAgICAgICAgICAgICAgIGlmIChcIlxcXFxcIiAhPT0gdCAmJiBcIi5cIiAhPT0gdCAmJiBcImBcIiAhPT0gdCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJQYXRoIGhhcyBpbnZhbGlkIGVzY2FwZSBzZXF1ZW5jZTogXCIgKyBlKTtcbiAgICAgICAgICAgICAgICBuICs9IHQsIHIgKz0gMjtcbiAgICAgICAgICAgIH0gZWxzZSBcImBcIiA9PT0gdCA/IChpID0gIWksIHIrKykgOiBcIi5cIiAhPT0gdCB8fCBpID8gKG4gKz0gdCwgcisrKSA6IChfX1BSSVZBVEVfYWRkQ3VycmVudFNlZ21lbnQoKSwgXG4gICAgICAgICAgICByKyspO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfX1BSSVZBVEVfYWRkQ3VycmVudFNlZ21lbnQoKSwgaSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJVbnRlcm1pbmF0ZWQgYCBpbiBwYXRoOiBcIiArIGUpO1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkUGF0aCQxKHQpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHlQYXRoKCkge1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkUGF0aCQxKFtdKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIERvY3VtZW50S2V5IHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMucGF0aCA9IGU7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tUGF0aChlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRLZXkoUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZSkpO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbU5hbWUoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50S2V5KFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGUpLnBvcEZpcnN0KDUpKTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50S2V5KFJlc291cmNlUGF0aC5lbXB0eVBhdGgoKSk7XG4gICAgfVxuICAgIGdldCBjb2xsZWN0aW9uR3JvdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGgucG9wTGFzdCgpLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGluIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbklkLiAqLyAgICBoYXNDb2xsZWN0aW9uSWQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLmxlbmd0aCA+PSAyICYmIHRoaXMucGF0aC5nZXQodGhpcy5wYXRoLmxlbmd0aCAtIDIpID09PSBlO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgY29sbGVjdGlvbiBncm91cCAoaS5lLiB0aGUgbmFtZSBvZiB0aGUgcGFyZW50IGNvbGxlY3Rpb24pIGZvciB0aGlzIGtleS4gKi8gICAgZ2V0Q29sbGVjdGlvbkdyb3VwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLmdldCh0aGlzLnBhdGgubGVuZ3RoIC0gMik7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBmdWxseSBxdWFsaWZpZWQgcGF0aCB0byB0aGUgcGFyZW50IGNvbGxlY3Rpb24uICovICAgIGdldENvbGxlY3Rpb25QYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnBvcExhc3QoKTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBlICYmIDAgPT09IFJlc291cmNlUGF0aC5jb21wYXJhdG9yKHRoaXMucGF0aCwgZS5wYXRoKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGgudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgc3RhdGljIGNvbXBhcmF0b3IoZSwgdCkge1xuICAgICAgICByZXR1cm4gUmVzb3VyY2VQYXRoLmNvbXBhcmF0b3IoZS5wYXRoLCB0LnBhdGgpO1xuICAgIH1cbiAgICBzdGF0aWMgaXNEb2N1bWVudEtleShlKSB7XG4gICAgICAgIHJldHVybiBlLmxlbmd0aCAlIDIgPT0gMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIG5ldyBkb2N1bWVudCBrZXkgd2l0aCB0aGUgZ2l2ZW4gc2VnbWVudHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2VnbWVudHMgLSBUaGUgc2VnbWVudHMgb2YgdGhlIHBhdGggdG8gdGhlIGRvY3VtZW50XG4gICAgICogQHJldHVybnMgQSBuZXcgaW5zdGFuY2Ugb2YgRG9jdW1lbnRLZXlcbiAgICAgKi8gICAgc3RhdGljIGZyb21TZWdtZW50cyhlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRLZXkobmV3IFJlc291cmNlUGF0aChlLnNsaWNlKCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBpbml0aWFsIG11dGF0aW9uIGJhdGNoIGlkIGZvciBlYWNoIGluZGV4LiBHZXRzIHVwZGF0ZWQgZHVyaW5nIGluZGV4XG4gKiBiYWNrZmlsbC5cbiAqL1xuLyoqXG4gKiBBbiBpbmRleCBkZWZpbml0aW9uIGZvciBmaWVsZCBpbmRleGVzIGluIEZpcmVzdG9yZS5cbiAqXG4gKiBFdmVyeSBpbmRleCBpcyBhc3NvY2lhdGVkIHdpdGggYSBjb2xsZWN0aW9uLiBUaGUgZGVmaW5pdGlvbiBjb250YWlucyBhIGxpc3RcbiAqIG9mIGZpZWxkcyBhbmQgdGhlaXIgaW5kZXgga2luZCAod2hpY2ggY2FuIGJlIGBBU0NFTkRJTkdgLCBgREVTQ0VORElOR2Agb3JcbiAqIGBDT05UQUlOU2AgZm9yIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueSBxdWVyaWVzKS5cbiAqXG4gKiBVbmxpa2UgdGhlIGJhY2tlbmQsIHRoZSBTREsgZG9lcyBub3QgZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGNvbGxlY3Rpb24gb3JcbiAqIGNvbGxlY3Rpb24gZ3JvdXAtc2NvcGVkIGluZGljZXMuIEV2ZXJ5IGluZGV4IGNhbiBiZSB1c2VkIGZvciBib3RoIHNpbmdsZVxuICogY29sbGVjdGlvbiBhbmQgY29sbGVjdGlvbiBncm91cCBxdWVyaWVzLlxuICovXG5jbGFzcyBGaWVsZEluZGV4IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgaW5kZXggSUQuIFJldHVybnMgLTEgaWYgdGhlIGluZGV4IElEIGlzIG5vdCBhdmFpbGFibGUgKGUuZy4gdGhlIGluZGV4XG4gICAgICogaGFzIG5vdCB5ZXQgYmVlbiBwZXJzaXN0ZWQpLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKiBUaGUgY29sbGVjdGlvbiBJRCB0aGlzIGluZGV4IGFwcGxpZXMgdG8uICovXG4gICAgdCwgXG4gICAgLyoqIFRoZSBmaWVsZCBzZWdtZW50cyBmb3IgdGhpcyBpbmRleC4gKi9cbiAgICBuLCBcbiAgICAvKiogU2hvd3MgaG93IHVwLXRvLWRhdGUgdGhlIGluZGV4IGlzIGZvciB0aGUgY3VycmVudCB1c2VyLiAqL1xuICAgIHIpIHtcbiAgICAgICAgdGhpcy5pbmRleElkID0gZSwgdGhpcy5jb2xsZWN0aW9uR3JvdXAgPSB0LCB0aGlzLmZpZWxkcyA9IG4sIHRoaXMuaW5kZXhTdGF0ZSA9IHI7XG4gICAgfVxufVxuXG4vKiogQW4gSUQgZm9yIGFuIGluZGV4IHRoYXQgaGFzIG5vdCB5ZXQgYmVlbiBhZGRlZCB0byBwZXJzaXN0ZW5jZS4gICovXG4vKiogUmV0dXJucyB0aGUgQXJyYXlDb250YWlucy9BcnJheUNvbnRhaW5zQW55IHNlZ21lbnQgZm9yIHRoaXMgaW5kZXguICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRJbmRleEdldEFycmF5U2VnbWVudChlKSB7XG4gICAgcmV0dXJuIGUuZmllbGRzLmZpbmQoKGUgPT4gMiAvKiBJbmRleEtpbmQuQ09OVEFJTlMgKi8gPT09IGUua2luZCkpO1xufVxuXG4vKiogUmV0dXJucyBhbGwgZGlyZWN0aW9uYWwgKGFzY2VuZGluZy9kZXNjZW5kaW5nKSBzZWdtZW50cyBmb3IgdGhpcyBpbmRleC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKGUpIHtcbiAgICByZXR1cm4gZS5maWVsZHMuZmlsdGVyKChlID0+IDIgLyogSW5kZXhLaW5kLkNPTlRBSU5TICovICE9PSBlLmtpbmQpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBvcmRlciBvZiB0aGUgZG9jdW1lbnQga2V5IGNvbXBvbmVudCBmb3IgdGhlIGdpdmVuIGluZGV4LlxuICpcbiAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgaW4gdGhlIFdlYiBJbmRleGVkRGIgaW1wbGVtZW50YXRpb24uXG4gKi9cbi8qKlxuICogQ29tcGFyZXMgaW5kZXhlcyBieSBjb2xsZWN0aW9uIGdyb3VwIGFuZCBzZWdtZW50cy4gSWdub3JlcyB1cGRhdGUgdGltZSBhbmRcbiAqIGluZGV4IElELlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRJbmRleFNlbWFudGljQ29tcGFyYXRvcihlLCB0KSB7XG4gICAgbGV0IG4gPSBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmNvbGxlY3Rpb25Hcm91cCwgdC5jb2xsZWN0aW9uR3JvdXApO1xuICAgIGlmICgwICE9PSBuKSByZXR1cm4gbjtcbiAgICBmb3IgKGxldCByID0gMDsgciA8IE1hdGgubWluKGUuZmllbGRzLmxlbmd0aCwgdC5maWVsZHMubGVuZ3RoKTsgKytyKSBpZiAobiA9IF9fUFJJVkFURV9pbmRleFNlZ21lbnRDb21wYXJhdG9yKGUuZmllbGRzW3JdLCB0LmZpZWxkc1tyXSksIFxuICAgIDAgIT09IG4pIHJldHVybiBuO1xuICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmZpZWxkcy5sZW5ndGgsIHQuZmllbGRzLmxlbmd0aCk7XG59XG5cbi8qKiBSZXR1cm5zIGEgZGVidWcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZpZWxkIGluZGV4ICovIEZpZWxkSW5kZXguVU5LTk9XTl9JRCA9IC0xO1xuXG4vKiogQW4gaW5kZXggY29tcG9uZW50IGNvbnNpc3Rpbmcgb2YgZmllbGQgcGF0aCBhbmQgaW5kZXggdHlwZS4gICovXG5jbGFzcyBJbmRleFNlZ21lbnQge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgZmllbGQgcGF0aCBvZiB0aGUgY29tcG9uZW50LiAqL1xuICAgIGUsIFxuICAgIC8qKiBUaGUgZmllbGRzIHNvcnRpbmcgb3JkZXIuICovXG4gICAgdCkge1xuICAgICAgICB0aGlzLmZpZWxkUGF0aCA9IGUsIHRoaXMua2luZCA9IHQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhTZWdtZW50Q29tcGFyYXRvcihlLCB0KSB7XG4gICAgY29uc3QgbiA9IEZpZWxkUGF0aCQxLmNvbXBhcmF0b3IoZS5maWVsZFBhdGgsIHQuZmllbGRQYXRoKTtcbiAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmtpbmQsIHQua2luZCk7XG59XG5cbi8qKlxuICogU3RvcmVzIHRoZSBcImhpZ2ggd2F0ZXIgbWFya1wiIHRoYXQgaW5kaWNhdGVzIGhvdyB1cGRhdGVkIHRoZSBJbmRleCBpcyBmb3IgdGhlXG4gKiBjdXJyZW50IHVzZXIuXG4gKi8gY2xhc3MgSW5kZXhTdGF0ZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogSW5kaWNhdGVzIHdoZW4gdGhlIGluZGV4IHdhcyBsYXN0IHVwZGF0ZWQgKHJlbGF0aXZlIHRvIG90aGVyIGluZGV4ZXMpLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKiBUaGUgdGhlIGxhdGVzdCBpbmRleGVkIHJlYWQgdGltZSwgZG9jdW1lbnQgYW5kIGJhdGNoIGlkLiAqL1xuICAgIHQpIHtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZU51bWJlciA9IGUsIHRoaXMub2Zmc2V0ID0gdDtcbiAgICB9XG4gICAgLyoqIFRoZSBzdGF0ZSBvZiBhbiBpbmRleCB0aGF0IGhhcyBub3QgeWV0IGJlZW4gYmFja2ZpbGxlZC4gKi8gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IEluZGV4U3RhdGUoMCwgSW5kZXhPZmZzZXQubWluKCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIG9mZnNldCB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50cyB3aXRoIGEgcmVhZCB0aW1lIGhpZ2hlciB0aGFuXG4gKiBgcmVhZFRpbWVgLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdJbmRleE9mZnNldFN1Y2Nlc3NvckZyb21SZWFkVGltZShlLCB0KSB7XG4gICAgLy8gV2Ugd2FudCB0byBjcmVhdGUgYW4gb2Zmc2V0IHRoYXQgbWF0Y2hlcyBhbGwgZG9jdW1lbnRzIHdpdGggYSByZWFkIHRpbWVcbiAgICAvLyBncmVhdGVyIHRoYW4gdGhlIHByb3ZpZGVkIHJlYWQgdGltZS4gVG8gZG8gc28sIHdlIHRlY2huaWNhbGx5IG5lZWQgdG9cbiAgICAvLyBjcmVhdGUgYW4gb2Zmc2V0IGZvciBgKHJlYWRUaW1lLCBNQVhfRE9DVU1FTlRfS0VZKWAuIFdoaWxlIHdlIGNvdWxkIHVzZVxuICAgIC8vIFVuaWNvZGUgY29kZXBvaW50cyB0byBnZW5lcmF0ZSBNQVhfRE9DVU1FTlRfS0VZLCBpdCBpcyBtdWNoIGVhc2llciB0byB1c2VcbiAgICAvLyBgKHJlYWRUaW1lICsgMSwgRG9jdW1lbnRLZXkuZW1wdHkoKSlgIHNpbmNlIGA+IERvY3VtZW50S2V5LmVtcHR5KClgIG1hdGNoZXNcbiAgICAvLyBhbGwgdmFsaWQgZG9jdW1lbnQgSURzLlxuICAgIGNvbnN0IG4gPSBlLnRvVGltZXN0YW1wKCkuc2Vjb25kcywgciA9IGUudG9UaW1lc3RhbXAoKS5uYW5vc2Vjb25kcyArIDEsIGkgPSBTbmFwc2hvdFZlcnNpb24uZnJvbVRpbWVzdGFtcCgxZTkgPT09IHIgPyBuZXcgVGltZXN0YW1wKG4gKyAxLCAwKSA6IG5ldyBUaW1lc3RhbXAobiwgcikpO1xuICAgIHJldHVybiBuZXcgSW5kZXhPZmZzZXQoaSwgRG9jdW1lbnRLZXkuZW1wdHkoKSwgdCk7XG59XG5cbi8qKiBDcmVhdGVzIGEgbmV3IG9mZnNldCBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgZG9jdW1lbnQuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdJbmRleE9mZnNldEZyb21Eb2N1bWVudChlKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleE9mZnNldChlLnJlYWRUaW1lLCBlLmtleSwgLTEpO1xufVxuXG4vKipcbiAqIFN0b3JlcyB0aGUgbGF0ZXN0IHJlYWQgdGltZSwgZG9jdW1lbnQgYW5kIGJhdGNoIElEIHRoYXQgd2VyZSBwcm9jZXNzZWQgZm9yIGFuXG4gKiBpbmRleC5cbiAqLyBjbGFzcyBJbmRleE9mZnNldCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGxhdGVzdCByZWFkIHRpbWUgdmVyc2lvbiB0aGF0IGhhcyBiZWVuIGluZGV4ZWQgYnkgRmlyZXN0b3JlIGZvciB0aGlzXG4gICAgICogZmllbGQgaW5kZXguXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGtleSBvZiB0aGUgbGFzdCBkb2N1bWVudCB0aGF0IHdhcyBpbmRleGVkIGZvciB0aGlzIHF1ZXJ5LiBVc2VcbiAgICAgKiBgRG9jdW1lbnRLZXkuZW1wdHkoKWAgaWYgbm8gZG9jdW1lbnQgaGFzIGJlZW4gaW5kZXhlZC5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKlxuICAgICAqIFRoZSBsYXJnZXN0IG11dGF0aW9uIGJhdGNoIGlkIHRoYXQncyBiZWVuIHByb2Nlc3NlZCBieSBGaXJlc3RvcmUuXG4gICAgICovXG4gICAgbikge1xuICAgICAgICB0aGlzLnJlYWRUaW1lID0gZSwgdGhpcy5kb2N1bWVudEtleSA9IHQsIHRoaXMubGFyZ2VzdEJhdGNoSWQgPSBuO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhbiBvZmZzZXQgdGhhdCBzb3J0cyBiZWZvcmUgYWxsIHJlZ3VsYXIgb2Zmc2V0cy4gKi8gICAgc3RhdGljIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE9mZnNldChTbmFwc2hvdFZlcnNpb24ubWluKCksIERvY3VtZW50S2V5LmVtcHR5KCksIC0xKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYW4gb2Zmc2V0IHRoYXQgc29ydHMgYWZ0ZXIgYWxsIHJlZ3VsYXIgb2Zmc2V0cy4gKi8gICAgc3RhdGljIG1heCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE9mZnNldChTbmFwc2hvdFZlcnNpb24ubWF4KCksIERvY3VtZW50S2V5LmVtcHR5KCksIC0xKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9pbmRleE9mZnNldENvbXBhcmF0b3IoZSwgdCkge1xuICAgIGxldCBuID0gZS5yZWFkVGltZS5jb21wYXJlVG8odC5yZWFkVGltZSk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogKG4gPSBEb2N1bWVudEtleS5jb21wYXJhdG9yKGUuZG9jdW1lbnRLZXksIHQuZG9jdW1lbnRLZXkpLCBcbiAgICAwICE9PSBuID8gbiA6IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUubGFyZ2VzdEJhdGNoSWQsIHQubGFyZ2VzdEJhdGNoSWQpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgQyA9IFwiVGhlIGN1cnJlbnQgdGFiIGlzIG5vdCBpbiB0aGUgcmVxdWlyZWQgc3RhdGUgdG8gcGVyZm9ybSB0aGlzIG9wZXJhdGlvbi4gSXQgbWlnaHQgYmUgbmVjZXNzYXJ5IHRvIHJlZnJlc2ggdGhlIGJyb3dzZXIgdGFiLlwiO1xuXG4vKipcbiAqIEEgYmFzZSBjbGFzcyByZXByZXNlbnRpbmcgYSBwZXJzaXN0ZW5jZSB0cmFuc2FjdGlvbiwgZW5jYXBzdWxhdGluZyBib3RoIHRoZVxuICogdHJhbnNhY3Rpb24ncyBzZXF1ZW5jZSBudW1iZXJzIGFzIHdlbGwgYXMgYSBsaXN0IG9mIG9uQ29tbWl0dGVkIGxpc3RlbmVycy5cbiAqXG4gKiBXaGVuIHlvdSBjYWxsIFBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKCksIGl0IHdpbGwgY3JlYXRlIGEgdHJhbnNhY3Rpb24gYW5kXG4gKiBwYXNzIGl0IHRvIHlvdXIgY2FsbGJhY2suIFlvdSB0aGVuIHBhc3MgaXQgdG8gYW55IG1ldGhvZCB0aGF0IG9wZXJhdGVzXG4gKiBvbiBwZXJzaXN0ZW5jZS5cbiAqLyBjbGFzcyBQZXJzaXN0ZW5jZVRyYW5zYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5vbkNvbW1pdHRlZExpc3RlbmVycyA9IFtdO1xuICAgIH1cbiAgICBhZGRPbkNvbW1pdHRlZExpc3RlbmVyKGUpIHtcbiAgICAgICAgdGhpcy5vbkNvbW1pdHRlZExpc3RlbmVycy5wdXNoKGUpO1xuICAgIH1cbiAgICByYWlzZU9uQ29tbWl0dGVkRXZlbnQoKSB7XG4gICAgICAgIHRoaXMub25Db21taXR0ZWRMaXN0ZW5lcnMuZm9yRWFjaCgoZSA9PiBlKCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFZlcmlmaWVzIHRoZSBlcnJvciB0aHJvd24gYnkgYSBMb2NhbFN0b3JlIG9wZXJhdGlvbi4gSWYgYSBMb2NhbFN0b3JlXG4gKiBvcGVyYXRpb24gZmFpbHMgYmVjYXVzZSB0aGUgcHJpbWFyeSBsZWFzZSBoYXMgYmVlbiB0YWtlbiBieSBhbm90aGVyIGNsaWVudCxcbiAqIHdlIGlnbm9yZSB0aGUgZXJyb3IgKHRoZSBwZXJzaXN0ZW5jZSBsYXllciB3aWxsIGltbWVkaWF0ZWx5IGNhbGxcbiAqIGBhcHBseVByaW1hcnlMZWFzZWAgdG8gcHJvcGFnYXRlIHRoZSBwcmltYXJ5IHN0YXRlIGNoYW5nZSkuIEFsbCBvdGhlciBlcnJvcnNcbiAqIGFyZSByZS10aHJvd24uXG4gKlxuICogQHBhcmFtIGVyciAtIEFuIGVycm9yIHJldHVybmVkIGJ5IGEgTG9jYWxTdG9yZSBvcGVyYXRpb24uXG4gKiBAcmV0dXJucyBBIFByb21pc2UgdGhhdCByZXNvbHZlcyBhZnRlciB3ZSByZWNvdmVyZWQsIG9yIHRoZSBvcmlnaW5hbCBlcnJvci5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaWdub3JlSWZQcmltYXJ5TGVhc2VMb3NzKGUpIHtcbiAgICBpZiAoZS5jb2RlICE9PSBELkZBSUxFRF9QUkVDT05ESVRJT04gfHwgZS5tZXNzYWdlICE9PSBDKSB0aHJvdyBlO1xuICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxvY2FsU3RvcmVcIiwgXCJVbmV4cGVjdGVkbHkgbG9zdCBwcmltYXJ5IGxlYXNlXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQZXJzaXN0ZW5jZVByb21pc2UgaXMgZXNzZW50aWFsbHkgYSByZS1pbXBsZW1lbnRhdGlvbiBvZiBQcm9taXNlIGV4Y2VwdFxuICogaXQgaGFzIGEgLm5leHQoKSBtZXRob2QgaW5zdGVhZCBvZiAudGhlbigpIGFuZCAubmV4dCgpIGFuZCAuY2F0Y2goKSBjYWxsYmFja3NcbiAqIGFyZSBleGVjdXRlZCBzeW5jaHJvbm91c2x5IHdoZW4gYSBQZXJzaXN0ZW5jZVByb21pc2UgcmVzb2x2ZXMgcmF0aGVyIHRoYW5cbiAqIGFzeW5jaHJvbm91c2x5IChQcm9taXNlIGltcGxlbWVudGF0aW9ucyB1c2Ugc2V0SW1tZWRpYXRlKCkgb3Igc2ltaWxhcikuXG4gKlxuICogVGhpcyBpcyBuZWNlc3NhcnkgdG8gaW50ZXJvcGVyYXRlIHdpdGggSW5kZXhlZERCIHdoaWNoIHdpbGwgYXV0b21hdGljYWxseVxuICogY29tbWl0IHRyYW5zYWN0aW9ucyBpZiBjb250cm9sIGlzIHJldHVybmVkIHRvIHRoZSBldmVudCBsb29wIHdpdGhvdXRcbiAqIHN5bmNocm9ub3VzbHkgaW5pdGlhdGluZyBhbm90aGVyIG9wZXJhdGlvbiBvbiB0aGUgdHJhbnNhY3Rpb24uXG4gKlxuICogTk9URTogLnRoZW4oKSBhbmQgLmNhdGNoKCkgb25seSBhbGxvdyBhIHNpbmdsZSBjb25zdW1lciwgdW5saWtlIG5vcm1hbFxuICogUHJvbWlzZXMuXG4gKi8gY2xhc3MgUGVyc2lzdGVuY2VQcm9taXNlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIC8vIE5PVEU6IG5leHQvY2F0Y2hDYWxsYmFjayB3aWxsIGFsd2F5cyBwb2ludCB0byBvdXIgb3duIHdyYXBwZXIgZnVuY3Rpb25zLFxuICAgICAgICAvLyBub3QgdGhlIHVzZXIncyByYXcgbmV4dCgpIG9yIGNhdGNoKCkgY2FsbGJhY2tzLlxuICAgICAgICB0aGlzLm5leHRDYWxsYmFjayA9IG51bGwsIHRoaXMuY2F0Y2hDYWxsYmFjayA9IG51bGwsIFxuICAgICAgICAvLyBXaGVuIHRoZSBvcGVyYXRpb24gcmVzb2x2ZXMsIHdlJ2xsIHNldCByZXN1bHQgb3IgZXJyb3IgYW5kIG1hcmsgaXNEb25lLlxuICAgICAgICB0aGlzLnJlc3VsdCA9IHZvaWQgMCwgdGhpcy5lcnJvciA9IHZvaWQgMCwgdGhpcy5pc0RvbmUgPSAhMSwgXG4gICAgICAgIC8vIFNldCB0byB0cnVlIHdoZW4gLnRoZW4oKSBvciAuY2F0Y2goKSBhcmUgY2FsbGVkIGFuZCBwcmV2ZW50cyBhZGRpdGlvbmFsXG4gICAgICAgIC8vIGNoYWluaW5nLlxuICAgICAgICB0aGlzLmNhbGxiYWNrQXR0YWNoZWQgPSAhMSwgZSgoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzRG9uZSA9ICEwLCB0aGlzLnJlc3VsdCA9IGUsIHRoaXMubmV4dENhbGxiYWNrICYmIFxuICAgICAgICAgICAgLy8gdmFsdWUgc2hvdWxkIGJlIGRlZmluZWQgdW5sZXNzIFQgaXMgVm9pZCwgYnV0IHdlIGNhbid0IGV4cHJlc3NcbiAgICAgICAgICAgIC8vIHRoYXQgaW4gdGhlIHR5cGUgc3lzdGVtLlxuICAgICAgICAgICAgdGhpcy5uZXh0Q2FsbGJhY2soZSk7XG4gICAgICAgIH0pLCAoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzRG9uZSA9ICEwLCB0aGlzLmVycm9yID0gZSwgdGhpcy5jYXRjaENhbGxiYWNrICYmIHRoaXMuY2F0Y2hDYWxsYmFjayhlKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBjYXRjaChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5leHQodm9pZCAwLCBlKTtcbiAgICB9XG4gICAgbmV4dChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGxiYWNrQXR0YWNoZWQgJiYgZmFpbCgpLCB0aGlzLmNhbGxiYWNrQXR0YWNoZWQgPSAhMCwgdGhpcy5pc0RvbmUgPyB0aGlzLmVycm9yID8gdGhpcy53cmFwRmFpbHVyZSh0LCB0aGlzLmVycm9yKSA6IHRoaXMud3JhcFN1Y2Nlc3MoZSwgdGhpcy5yZXN1bHQpIDogbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgIHRoaXMubmV4dENhbGxiYWNrID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy53cmFwU3VjY2VzcyhlLCB0KS5uZXh0KG4sIHIpO1xuICAgICAgICAgICAgfSwgdGhpcy5jYXRjaENhbGxiYWNrID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy53cmFwRmFpbHVyZSh0LCBlKS5uZXh0KG4sIHIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB0b1Byb21pc2UoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIHRoaXMubmV4dChlLCB0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB3cmFwVXNlckZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlKCk7XG4gICAgICAgICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlUHJvbWlzZSA/IHQgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgd3JhcFN1Y2Nlc3MoZSwgdCkge1xuICAgICAgICByZXR1cm4gZSA/IHRoaXMud3JhcFVzZXJGdW5jdGlvbigoKCkgPT4gZSh0KSkpIDogUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodCk7XG4gICAgfVxuICAgIHdyYXBGYWlsdXJlKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUgPyB0aGlzLndyYXBVc2VyRnVuY3Rpb24oKCgpID0+IGUodCkpKSA6IFBlcnNpc3RlbmNlUHJvbWlzZS5yZWplY3QodCk7XG4gICAgfVxuICAgIHN0YXRpYyByZXNvbHZlKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICB0KGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHN0YXRpYyByZWplY3QoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIG4oZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc3RhdGljIHdhaXRGb3IoXG4gICAgLy8gQWNjZXB0IGFsbCBQcm9taXNlIHR5cGVzIGluIHdhaXRGb3IoKS5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBsZXQgciA9IDAsIGkgPSAwLCBzID0gITE7XG4gICAgICAgICAgICBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgICsrciwgZS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICsraSwgcyAmJiBpID09PSByICYmIHQoKTtcbiAgICAgICAgICAgICAgICB9KSwgKGUgPT4gbihlKSkpO1xuICAgICAgICAgICAgfSkpLCBzID0gITAsIGkgPT09IHIgJiYgdCgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdpdmVuIGFuIGFycmF5IG9mIHByZWRpY2F0ZSBmdW5jdGlvbnMgdGhhdCBhc3luY2hyb25vdXNseSBldmFsdWF0ZSB0byBhXG4gICAgICogYm9vbGVhbiwgaW1wbGVtZW50cyBhIHNob3J0LWNpcmN1aXRpbmcgYG9yYCBiZXR3ZWVuIHRoZSByZXN1bHRzLiBQcmVkaWNhdGVzXG4gICAgICogd2lsbCBiZSBldmFsdWF0ZWQgdW50aWwgb25lIG9mIHRoZW0gcmV0dXJucyBgdHJ1ZWAsIHRoZW4gc3RvcC4gVGhlIGZpbmFsXG4gICAgICogcmVzdWx0IHdpbGwgYmUgd2hldGhlciBhbnkgb2YgdGhlbSByZXR1cm5lZCBgdHJ1ZWAuXG4gICAgICovICAgIHN0YXRpYyBvcihlKSB7XG4gICAgICAgIGxldCB0ID0gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoITEpO1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZSkgdCA9IHQubmV4dCgoZSA9PiBlID8gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoZSkgOiBuKCkpKTtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfVxuICAgIHN0YXRpYyBmb3JFYWNoKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKCgoZSwgcikgPT4ge1xuICAgICAgICAgICAgbi5wdXNoKHQuY2FsbCh0aGlzLCBlLCByKSk7XG4gICAgICAgIH0pKSwgdGhpcy53YWl0Rm9yKG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25jdXJyZW50bHkgbWFwIGFsbCBhcnJheSBlbGVtZW50cyB0aHJvdWdoIGFzeW5jaHJvbm91cyBmdW5jdGlvbi5cbiAgICAgKi8gICAgc3RhdGljIG1hcEFycmF5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKChuLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gZS5sZW5ndGgsIHMgPSBuZXcgQXJyYXkoaSk7XG4gICAgICAgICAgICBsZXQgbyA9IDA7XG4gICAgICAgICAgICBmb3IgKGxldCBfID0gMDsgXyA8IGk7IF8rKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBfO1xuICAgICAgICAgICAgICAgIHQoZVthXSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNbYV0gPSBlLCArK28sIG8gPT09IGkgJiYgbihzKTtcbiAgICAgICAgICAgICAgICB9KSwgKGUgPT4gcihlKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFuIGFsdGVybmF0aXZlIHRvIHJlY3Vyc2l2ZSBQZXJzaXN0ZW5jZVByb21pc2UgY2FsbHMsIHRoYXQgYXZvaWRzXG4gICAgICogcG90ZW50aWFsIG1lbW9yeSBwcm9ibGVtcyBmcm9tIHVuYm91bmRlZCBjaGFpbnMgb2YgcHJvbWlzZXMuXG4gICAgICpcbiAgICAgKiBUaGUgYGFjdGlvbmAgd2lsbCBiZSBjYWxsZWQgcmVwZWF0ZWRseSB3aGlsZSBgY29uZGl0aW9uYCBpcyB0cnVlLlxuICAgICAqLyAgICBzdGF0aWMgZG9XaGlsZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJvY2VzcyA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAhMCA9PT0gZSgpID8gdCgpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvY2VzcygpO1xuICAgICAgICAgICAgICAgIH0pLCByKSA6IG4oKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBwcm9jZXNzKCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBSZWZlcmVuY2VzIHRvIGB3aW5kb3dgIGFyZSBndWFyZGVkIGJ5IFNpbXBsZURiLmlzQXZhaWxhYmxlKClcbi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscyAqL1xuLyoqXG4gKiBXcmFwcyBhbiBJREJUcmFuc2FjdGlvbiBhbmQgZXhwb3NlcyBhIHN0b3JlKCkgbWV0aG9kIHRvIGdldCBhIGhhbmRsZSB0byBhXG4gKiBzcGVjaWZpYyBvYmplY3Qgc3RvcmUuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9TaW1wbGVEYlRyYW5zYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuYWN0aW9uID0gZSwgdGhpcy50cmFuc2FjdGlvbiA9IHQsIHRoaXMuYWJvcnRlZCA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgcmVzdWx0IG9mIHRoZSBJbmRleGVkRGIgdHJhbnNhY3Rpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLlYgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkLCB0aGlzLnRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLlYucmVzb2x2ZSgpO1xuICAgICAgICB9LCB0aGlzLnRyYW5zYWN0aW9uLm9uYWJvcnQgPSAoKSA9PiB7XG4gICAgICAgICAgICB0LmVycm9yID8gdGhpcy5WLnJlamVjdChuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSwgdC5lcnJvcikpIDogdGhpcy5WLnJlc29sdmUoKTtcbiAgICAgICAgfSwgdGhpcy50cmFuc2FjdGlvbi5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2NoZWNrRm9yQW5kUmVwb3J0aU9TRXJyb3IodC50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy5WLnJlamVjdChuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSwgbikpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBzdGF0aWMgb3BlbihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9TaW1wbGVEYlRyYW5zYWN0aW9uKHQsIGUudHJhbnNhY3Rpb24ociwgbikpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IodCwgZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlYucHJvbWlzZTtcbiAgICB9XG4gICAgYWJvcnQoZSkge1xuICAgICAgICBlICYmIHRoaXMuVi5yZWplY3QoZSksIHRoaXMuYWJvcnRlZCB8fCAoX19QUklWQVRFX2xvZ0RlYnVnKFwiU2ltcGxlRGJcIiwgXCJBYm9ydGluZyB0cmFuc2FjdGlvbjpcIiwgZSA/IGUubWVzc2FnZSA6IFwiQ2xpZW50LWluaXRpYXRlZCBhYm9ydFwiKSwgXG4gICAgICAgIHRoaXMuYWJvcnRlZCA9ICEwLCB0aGlzLnRyYW5zYWN0aW9uLmFib3J0KCkpO1xuICAgIH1cbiAgICBnKCkge1xuICAgICAgICAvLyBJZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBWMyBJbmRleGVkREIsIHdlIGludm9rZSBjb21taXQoKSBleHBsaWNpdGx5IHRvXG4gICAgICAgIC8vIHNwZWVkIHVwIGluZGV4IERCIHByb2Nlc3NpbmcgaWYgdGhlIGV2ZW50IGxvb3AgcmVtYWlucyBibG9ja3MuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnRyYW5zYWN0aW9uO1xuICAgICAgICB0aGlzLmFib3J0ZWQgfHwgXCJmdW5jdGlvblwiICE9IHR5cGVvZiBlLmNvbW1pdCB8fCBlLmNvbW1pdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgU2ltcGxlRGJTdG9yZTxLZXlUeXBlLCBWYWx1ZVR5cGU+IGZvciB0aGUgc3BlY2lmaWVkIHN0b3JlLiBBbGxcbiAgICAgKiBvcGVyYXRpb25zIHBlcmZvcm1lZCBvbiB0aGUgU2ltcGxlRGJTdG9yZSBoYXBwZW4gd2l0aGluIHRoZSBjb250ZXh0IG9mIHRoaXNcbiAgICAgKiB0cmFuc2FjdGlvbiBhbmQgaXQgY2Fubm90IGJlIHVzZWQgYW55bW9yZSBvbmNlIHRoZSB0cmFuc2FjdGlvbiBpc1xuICAgICAqIGNvbXBsZXRlZC5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB3ZSBjYW4ndCBhY3R1YWxseSBlbmZvcmNlIHRoYXQgdGhlIEtleVR5cGUgYW5kIFZhbHVlVHlwZSBhcmVcbiAgICAgKiBjb3JyZWN0LCBidXQgdGhleSBhbGxvdyB0eXBlIHNhZmV0eSB0aHJvdWdoIHRoZSByZXN0IG9mIHRoZSBjb25zdW1pbmcgY29kZS5cbiAgICAgKi8gICAgc3RvcmUoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy50cmFuc2FjdGlvbi5vYmplY3RTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2ltcGxlRGJTdG9yZSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSB3cmFwcGVyIGFyb3VuZCBJbmRleGVkRGIgd2l0aCBhIHNpbXBsaWZpZWQgaW50ZXJmYWNlIHRoYXQgdXNlc1xuICogUHJvbWlzZS1saWtlIHJldHVybiB2YWx1ZXMgdG8gY2hhaW4gb3BlcmF0aW9ucy4gUmVhbCBwcm9taXNlcyBjYW5ub3QgYmUgdXNlZFxuICogc2luY2UgLnRoZW4oKSBjb250aW51YXRpb25zIGFyZSBleGVjdXRlZCBhc3luY2hyb25vdXNseSAoZS5nLiB2aWFcbiAqIC5zZXRJbW1lZGlhdGUpLCB3aGljaCB3b3VsZCBjYXVzZSBJbmRleGVkREIgdG8gZW5kIHRoZSB0cmFuc2FjdGlvbi5cbiAqIFNlZSBQZXJzaXN0ZW5jZVByb21pc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU2ltcGxlRGIge1xuICAgIC8qXG4gICAgICogQ3JlYXRlcyBhIG5ldyBTaW1wbGVEYiB3cmFwcGVyIGZvciBJbmRleGVkRGIgZGF0YWJhc2UgYG5hbWVgLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IGB2ZXJzaW9uYCBtdXN0IG5vdCBiZSBhIGRvd25ncmFkZS4gSW5kZXhlZERCIGRvZXMgbm90IHN1cHBvcnRcbiAgICAgKiBkb3duZ3JhZGluZyB0aGUgc2NoZW1hIHZlcnNpb24uIFdlIGN1cnJlbnRseSBkbyBub3Qgc3VwcG9ydCBhbnkgd2F5IHRvIGRvXG4gICAgICogdmVyc2lvbmluZyBvdXRzaWRlIG9mIEluZGV4ZWREQidzIHZlcnNpb25pbmcgbWVjaGFuaXNtLCBhcyBvbmx5XG4gICAgICogdmVyc2lvbi11cGdyYWRlIHRyYW5zYWN0aW9ucyBhcmUgYWxsb3dlZCB0byBkbyB0aGluZ3MgbGlrZSBjcmVhdGVcbiAgICAgKiBvYmplY3RzdG9yZXMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICB0aGlzLm5hbWUgPSBlLCB0aGlzLnZlcnNpb24gPSB0LCB0aGlzLnAgPSBuO1xuICAgICAgICAvLyBOT1RFOiBBY2NvcmRpbmcgdG8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE5NzA1MCwgdGhlXG4gICAgICAgIC8vIGJ1ZyB3ZSdyZSBjaGVja2luZyBmb3Igc2hvdWxkIGV4aXN0IGluIGlPUyA+PSAxMi4yIGFuZCA8IDEzLCBidXQgZm9yXG4gICAgICAgIC8vIHdoYXRldmVyIHJlYXNvbiBpdCdzIG11Y2ggaGFyZGVyIHRvIGhpdCBhZnRlciAxMi4yIHNvIHdlIG9ubHkgcHJvYWN0aXZlbHlcbiAgICAgICAgLy8gbG9nIG9uIDEyLjIuXG4gICAgICAgIDEyLjIgPT09IF9fUFJJVkFURV9TaW1wbGVEYi5TKGdldFVBKCkpICYmIF9fUFJJVkFURV9sb2dFcnJvcihcIkZpcmVzdG9yZSBwZXJzaXN0ZW5jZSBzdWZmZXJzIGZyb20gYSBidWcgaW4gaU9TIDEyLjIgU2FmYXJpIHRoYXQgbWF5IGNhdXNlIHlvdXIgYXBwIHRvIHN0b3Agd29ya2luZy4gU2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcS81NjQ5NjI5Ni8xMTA5MTUgZm9yIGRldGFpbHMgYW5kIGEgcG90ZW50aWFsIHdvcmthcm91bmQuXCIpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlcyB0aGUgc3BlY2lmaWVkIGRhdGFiYXNlLiAqLyAgICBzdGF0aWMgZGVsZXRlKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiUmVtb3ZpbmcgZGF0YWJhc2U6XCIsIGUpLCBfX1BSSVZBVEVfd3JhcFJlcXVlc3Qod2luZG93LmluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShlKSkudG9Qcm9taXNlKCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgSW5kZXhlZERCIGlzIGF2YWlsYWJsZSBpbiB0aGUgY3VycmVudCBlbnZpcm9ubWVudC4gKi8gICAgc3RhdGljIEQoKSB7XG4gICAgICAgIGlmICghaXNJbmRleGVkREJBdmFpbGFibGUoKSkgcmV0dXJuICExO1xuICAgICAgICBpZiAoX19QUklWQVRFX1NpbXBsZURiLnYoKSkgcmV0dXJuICEwO1xuICAgICAgICAvLyBXZSBleHRlbnNpdmVseSB1c2UgaW5kZXhlZCBhcnJheSB2YWx1ZXMgYW5kIGNvbXBvdW5kIGtleXMsXG4gICAgICAgIC8vIHdoaWNoIElFIGFuZCBFZGdlIGRvIG5vdCBzdXBwb3J0LiBIb3dldmVyLCB0aGV5IHN0aWxsIGhhdmUgaW5kZXhlZERCXG4gICAgICAgIC8vIGRlZmluZWQgb24gdGhlIHdpbmRvdywgc28gd2UgbmVlZCB0byBjaGVjayBmb3IgdGhlbSBoZXJlIGFuZCBtYWtlIHN1cmVcbiAgICAgICAgLy8gdG8gcmV0dXJuIHRoYXQgcGVyc2lzdGVuY2UgaXMgbm90IGVuYWJsZWQgZm9yIHRob3NlIGJyb3dzZXJzLlxuICAgICAgICAvLyBGb3IgdHJhY2tpbmcgc3VwcG9ydCBvZiB0aGlzIGZlYXR1cmUsIHNlZSBoZXJlOlxuICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5taWNyb3NvZnQuY29tL2VuLXVzL21pY3Jvc29mdC1lZGdlL3BsYXRmb3JtL3N0YXR1cy9pbmRleGVkZGJhcnJheXNhbmRtdWx0aWVudHJ5c3VwcG9ydC9cbiAgICAgICAgLy8gQ2hlY2sgdGhlIFVBIHN0cmluZyB0byBmaW5kIG91dCB0aGUgYnJvd3Nlci5cbiAgICAgICAgICAgICAgICBjb25zdCBlID0gZ2V0VUEoKSwgdCA9IF9fUFJJVkFURV9TaW1wbGVEYi5TKGUpLCBuID0gMCA8IHQgJiYgdCA8IDEwLCByID0gX19QUklWQVRFX2dldEFuZHJvaWRWZXJzaW9uKGUpLCBpID0gMCA8IHIgJiYgciA8IDQuNTtcbiAgICAgICAgLy8gSUUgMTBcbiAgICAgICAgLy8gdWEgPSAnTW96aWxsYS81LjAgKGNvbXBhdGlibGU7IE1TSUUgMTAuMDsgV2luZG93cyBOVCA2LjI7IFRyaWRlbnQvNi4wKSc7XG4gICAgICAgIC8vIElFIDExXG4gICAgICAgIC8vIHVhID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMzsgVHJpZGVudC83LjA7IHJ2OjExLjApIGxpa2UgR2Vja28nO1xuICAgICAgICAvLyBFZGdlXG4gICAgICAgIC8vIHVhID0gJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLFxuICAgICAgICAvLyBsaWtlIEdlY2tvKSBDaHJvbWUvMzkuMC4yMTcxLjcxIFNhZmFyaS81MzcuMzYgRWRnZS8xMi4wJztcbiAgICAgICAgLy8gaU9TIFNhZmFyaTogRGlzYWJsZSBmb3IgdXNlcnMgcnVubmluZyBpT1MgdmVyc2lvbiA8IDEwLlxuICAgICAgICAgICAgICAgIHJldHVybiAhKGUuaW5kZXhPZihcIk1TSUUgXCIpID4gMCB8fCBlLmluZGV4T2YoXCJUcmlkZW50L1wiKSA+IDAgfHwgZS5pbmRleE9mKFwiRWRnZS9cIikgPiAwIHx8IG4gfHwgaSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYmFja2luZyBJbmRleGVkREIgc3RvcmUgaXMgdGhlIE5vZGUgSW5kZXhlZERCU2hpbVxuICAgICAqIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL2F4ZW1jbGlvbi9JbmRleGVkREJTaGltKS5cbiAgICAgKi8gICAgc3RhdGljIHYoKSB7XG4gICAgICAgIHZhciBlO1xuICAgICAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgcHJvY2VzcyAmJiBcIllFU1wiID09PSAobnVsbCA9PT0gKGUgPSBwcm9jZXNzLl9fUFJJVkFURV9lbnYpIHx8IHZvaWQgMCA9PT0gZSA/IHZvaWQgMCA6IGUuQyk7XG4gICAgfVxuICAgIC8qKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmcm9tIGEgdHJhbnNhY3Rpb24uICovICAgIHN0YXRpYyBGKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUuc3RvcmUodCk7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAvKiogUGFyc2UgVXNlciBBZ2VudCB0byBkZXRlcm1pbmUgaU9TIHZlcnNpb24uIFJldHVybnMgLTEgaWYgbm90IGZvdW5kLiAqL1xuICAgIHN0YXRpYyBTKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUubWF0Y2goL2koPzpwaG9uZXxwYWR8cG9kKSBvcyAoW1xcZF9dKykvaSksIG4gPSB0ID8gdFsxXS5zcGxpdChcIl9cIikuc2xpY2UoMCwgMikuam9pbihcIi5cIikgOiBcIi0xXCI7XG4gICAgICAgIHJldHVybiBOdW1iZXIobik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9wZW5zIHRoZSBzcGVjaWZpZWQgZGF0YWJhc2UsIGNyZWF0aW5nIG9yIHVwZ3JhZGluZyBpdCBpZiBuZWNlc3NhcnkuXG4gICAgICovICAgIGFzeW5jIE0oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYiB8fCAoX19QUklWQVRFX2xvZ0RlYnVnKFwiU2ltcGxlRGJcIiwgXCJPcGVuaW5nIGRhdGFiYXNlOlwiLCB0aGlzLm5hbWUpLCBcbiAgICAgICAgdGhpcy5kYiA9IGF3YWl0IG5ldyBQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgLy8gVE9ETyhtaWtlbGVoZW4pOiBJbnZlc3RpZ2F0ZSBicm93c2VyIGNvbXBhdGliaWxpdHkuXG4gICAgICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvSW5kZXhlZERCX0FQSS9Vc2luZ19JbmRleGVkREJcbiAgICAgICAgICAgIC8vIHN1Z2dlc3RzIElFOSBhbmQgb2xkZXIgV2ViS2l0IGJyb3dzZXJzIGhhbmRsZSB1cGdyYWRlXG4gICAgICAgICAgICAvLyBkaWZmZXJlbnRseS4gVGhleSBleHBlY3Qgc2V0VmVyc2lvbiwgYXMgZGVzY3JpYmVkIGhlcmU6XG4gICAgICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvSURCVmVyc2lvbkNoYW5nZVJlcXVlc3Qvc2V0VmVyc2lvblxuICAgICAgICAgICAgY29uc3QgciA9IGluZGV4ZWREQi5vcGVuKHRoaXMubmFtZSwgdGhpcy52ZXJzaW9uKTtcbiAgICAgICAgICAgIHIub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICB0KG4pO1xuICAgICAgICAgICAgfSwgci5vbmJsb2NrZWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgbihuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSwgXCJDYW5ub3QgdXBncmFkZSBJbmRleGVkREIgc2NoZW1hIHdoaWxlIGFub3RoZXIgdGFiIGlzIG9wZW4uIENsb3NlIGFsbCB0YWJzIHRoYXQgYWNjZXNzIEZpcmVzdG9yZSBhbmQgcmVsb2FkIHRoaXMgcGFnZSB0byBwcm9jZWVkLlwiKSk7XG4gICAgICAgICAgICB9LCByLm9uZXJyb3IgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdC50YXJnZXQuZXJyb3I7XG4gICAgICAgICAgICAgICAgXCJWZXJzaW9uRXJyb3JcIiA9PT0gci5uYW1lID8gbihuZXcgRmlyZXN0b3JlRXJyb3IoRC5GQUlMRURfUFJFQ09ORElUSU9OLCBcIkEgbmV3ZXIgdmVyc2lvbiBvZiB0aGUgRmlyZXN0b3JlIFNESyB3YXMgcHJldmlvdXNseSB1c2VkIGFuZCBzbyB0aGUgcGVyc2lzdGVkIGRhdGEgaXMgbm90IGNvbXBhdGlibGUgd2l0aCB0aGUgdmVyc2lvbiBvZiB0aGUgU0RLIHlvdSBhcmUgbm93IHVzaW5nLiBUaGUgU0RLIHdpbGwgb3BlcmF0ZSB3aXRoIHBlcnNpc3RlbmNlIGRpc2FibGVkLiBJZiB5b3UgbmVlZCBwZXJzaXN0ZW5jZSwgcGxlYXNlIHJlLXVwZ3JhZGUgdG8gYSBuZXdlciB2ZXJzaW9uIG9mIHRoZSBTREsgb3IgZWxzZSBjbGVhciB0aGUgcGVyc2lzdGVkIEluZGV4ZWREQiBkYXRhIGZvciB5b3VyIGFwcCB0byBzdGFydCBmcmVzaC5cIikpIDogXCJJbnZhbGlkU3RhdGVFcnJvclwiID09PSByLm5hbWUgPyBuKG5ldyBGaXJlc3RvcmVFcnJvcihELkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVW5hYmxlIHRvIG9wZW4gYW4gSW5kZXhlZERCIGNvbm5lY3Rpb24uIFRoaXMgY291bGQgYmUgZHVlIHRvIHJ1bm5pbmcgaW4gYSBwcml2YXRlIGJyb3dzaW5nIHNlc3Npb24gb24gYSBicm93c2VyIHdob3NlIHByaXZhdGUgYnJvd3Npbmcgc2Vzc2lvbnMgZG8gbm90IHN1cHBvcnQgSW5kZXhlZERCOiBcIiArIHIpKSA6IG4obmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUsIHIpKTtcbiAgICAgICAgICAgIH0sIHIub251cGdyYWRlbmVlZGVkID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiU2ltcGxlRGJcIiwgJ0RhdGFiYXNlIFwiJyArIHRoaXMubmFtZSArICdcIiByZXF1aXJlcyB1cGdyYWRlIGZyb20gdmVyc2lvbjonLCBlLm9sZFZlcnNpb24pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5wLk8odCwgci50cmFuc2FjdGlvbiwgZS5vbGRWZXJzaW9uLCB0aGlzLnZlcnNpb24pLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiU2ltcGxlRGJcIiwgXCJEYXRhYmFzZSB1cGdyYWRlIHRvIHZlcnNpb24gXCIgKyB0aGlzLnZlcnNpb24gKyBcIiBjb21wbGV0ZVwiKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSkpLCB0aGlzLk4gJiYgKHRoaXMuZGIub252ZXJzaW9uY2hhbmdlID0gZSA9PiB0aGlzLk4oZSkpLCB0aGlzLmRiO1xuICAgIH1cbiAgICBMKGUpIHtcbiAgICAgICAgdGhpcy5OID0gZSwgdGhpcy5kYiAmJiAodGhpcy5kYi5vbnZlcnNpb25jaGFuZ2UgPSB0ID0+IGUodCkpO1xuICAgIH1cbiAgICBhc3luYyBydW5UcmFuc2FjdGlvbihlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSBcInJlYWRvbmx5XCIgPT09IHQ7XG4gICAgICAgIGxldCBzID0gMDtcbiAgICAgICAgZm9yICg7Oykge1xuICAgICAgICAgICAgKytzO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRiID0gYXdhaXQgdGhpcy5NKGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfU2ltcGxlRGJUcmFuc2FjdGlvbi5vcGVuKHRoaXMuZGIsIGUsIGkgPyBcInJlYWRvbmx5XCIgOiBcInJlYWR3cml0ZVwiLCBuKSwgcyA9IHIodCkubmV4dCgoZSA9PiAodC5nKCksIFxuICAgICAgICAgICAgICAgIGUpKSkuY2F0Y2goKGUgPT4gKFxuICAgICAgICAgICAgICAgIC8vIEFib3J0IHRoZSB0cmFuc2FjdGlvbiBpZiB0aGVyZSB3YXMgYW4gZXJyb3IuXG4gICAgICAgICAgICAgICAgdC5hYm9ydChlKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlamVjdChlKSkpKS50b1Byb21pc2UoKTtcbiAgICAgICAgICAgICAgICAvLyBBcyBub3RlZCBhYm92ZSwgZXJyb3JzIGFyZSBwcm9wYWdhdGVkIGJ5IGFib3J0aW5nIHRoZSB0cmFuc2FjdGlvbi4gU29cbiAgICAgICAgICAgICAgICAvLyB3ZSBzd2FsbG93IGFueSBlcnJvciBoZXJlIHRvIGF2b2lkIHRoZSBicm93c2VyIGxvZ2dpbmcgaXQgYXMgdW5oYW5kbGVkLlxuICAgICAgICAgICAgICAgIHJldHVybiBzLmNhdGNoKCgoKSA9PiB7fSkpLCBcbiAgICAgICAgICAgICAgICAvLyBXYWl0IGZvciB0aGUgdHJhbnNhY3Rpb24gdG8gY29tcGxldGUgKGkuZS4gSW5kZXhlZERiJ3Mgb25zdWNjZXNzIGV2ZW50IHRvXG4gICAgICAgICAgICAgICAgLy8gZmlyZSksIGJ1dCBzdGlsbCByZXR1cm4gdGhlIG9yaWdpbmFsIHRyYW5zYWN0aW9uRm5SZXN1bHQgYmFjayB0byB0aGVcbiAgICAgICAgICAgICAgICAvLyBjYWxsZXIuXG4gICAgICAgICAgICAgICAgYXdhaXQgdC5tLCBzO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLCBuID0gXCJGaXJlYmFzZUVycm9yXCIgIT09IHQubmFtZSAmJiBzIDwgMztcbiAgICAgICAgICAgICAgICAvLyBUT0RPKHNjaG1pZHQtc2ViYXN0aWFuKTogV2UgY291bGQgcHJvYmFibHkgYmUgc21hcnRlciBhYm91dCB0aGlzIGFuZFxuICAgICAgICAgICAgICAgIC8vIG5vdCByZXRyeSBleGNlcHRpb25zIHRoYXQgYXJlIGxpa2VseSB1bnJlY292ZXJhYmxlIChzdWNoIGFzIHF1b3RhXG4gICAgICAgICAgICAgICAgLy8gZXhjZWVkZWQgZXJyb3JzKS5cbiAgICAgICAgICAgICAgICAvLyBOb3RlOiBXZSBjYW5ub3QgdXNlIGFuIGluc3RhbmNlb2YgY2hlY2sgZm9yIEZpcmVzdG9yZUV4Y2VwdGlvbiwgc2luY2UgdGhlXG4gICAgICAgICAgICAgICAgLy8gZXhjZXB0aW9uIGlzIHdyYXBwZWQgaW4gYSBnZW5lcmljIGVycm9yIGJ5IG91ciBhc3luYy9hd2FpdCBoYW5kbGluZy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiVHJhbnNhY3Rpb24gZmFpbGVkIHdpdGggZXJyb3I6XCIsIHQubWVzc2FnZSwgXCJSZXRyeWluZzpcIiwgbiksIFxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKSwgIW4pIHJldHVybiBQcm9taXNlLnJlamVjdCh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5kYiAmJiB0aGlzLmRiLmNsb3NlKCksIHRoaXMuZGIgPSB2b2lkIDA7XG4gICAgfVxufVxuXG4vKiogUGFyc2UgVXNlciBBZ2VudCB0byBkZXRlcm1pbmUgQW5kcm9pZCB2ZXJzaW9uLiBSZXR1cm5zIC0xIGlmIG5vdCBmb3VuZC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2dldEFuZHJvaWRWZXJzaW9uKGUpIHtcbiAgICBjb25zdCB0ID0gZS5tYXRjaCgvQW5kcm9pZCAoW1xcZC5dKykvaSksIG4gPSB0ID8gdFsxXS5zcGxpdChcIi5cIikuc2xpY2UoMCwgMikuam9pbihcIi5cIikgOiBcIi0xXCI7XG4gICAgcmV0dXJuIE51bWJlcihuKTtcbn1cblxuLyoqXG4gKiBBIGNvbnRyb2xsZXIgZm9yIGl0ZXJhdGluZyBvdmVyIGEga2V5IHJhbmdlIG9yIGluZGV4LiBJdCBhbGxvd3MgYW4gaXRlcmF0ZVxuICogY2FsbGJhY2sgdG8gZGVsZXRlIHRoZSBjdXJyZW50bHktcmVmZXJlbmNlZCBvYmplY3QsIG9yIGp1bXAgdG8gYSBuZXcga2V5XG4gKiB3aXRoaW4gdGhlIGtleSByYW5nZSBvciBpbmRleC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSXRlcmF0aW9uQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLkIgPSBlLCB0aGlzLmsgPSAhMSwgdGhpcy5xID0gbnVsbDtcbiAgICB9XG4gICAgZ2V0IGlzRG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaztcbiAgICB9XG4gICAgZ2V0IEsoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnE7XG4gICAgfVxuICAgIHNldCBjdXJzb3IoZSkge1xuICAgICAgICB0aGlzLkIgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgdG8gc3RvcCBpdGVyYXRpb24gYXQgYW55IHBvaW50LlxuICAgICAqLyAgICBkb25lKCkge1xuICAgICAgICB0aGlzLmsgPSAhMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIHRvIHNraXAgdG8gdGhhdCBuZXh0IGtleSwgd2hpY2ggY291bGQgYmVcbiAgICAgKiBhbiBpbmRleCBvciBhIHByaW1hcnkga2V5LlxuICAgICAqLyAgICAkKGUpIHtcbiAgICAgICAgdGhpcy5xID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlIHRoZSBjdXJyZW50IGN1cnNvciB2YWx1ZSBmcm9tIHRoZSBvYmplY3Qgc3RvcmUuXG4gICAgICpcbiAgICAgKiBOT1RFOiBZb3UgQ0FOTk9UIGRvIHRoaXMgd2l0aCBhIGtleXNPbmx5IHF1ZXJ5LlxuICAgICAqLyAgICBkZWxldGUoKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QodGhpcy5CLmRlbGV0ZSgpKTtcbiAgICB9XG59XG5cbi8qKiBBbiBlcnJvciB0aGF0IHdyYXBzIGV4Y2VwdGlvbnMgdGhhdCB0aHJvd24gZHVyaW5nIEluZGV4ZWREQiBleGVjdXRpb24uICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yIGV4dGVuZHMgRmlyZXN0b3JlRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoRC5VTkFWQUlMQUJMRSwgYEluZGV4ZWREQiB0cmFuc2FjdGlvbiAnJHtlfScgZmFpbGVkOiAke3R9YCksIHRoaXMubmFtZSA9IFwiSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvclwiO1xuICAgIH1cbn1cblxuLyoqIFZlcmlmaWVzIHdoZXRoZXIgYGVgIGlzIGFuIEluZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSkge1xuICAgIC8vIFVzZSBuYW1lIGVxdWFsaXR5LCBhcyBpbnN0YW5jZW9mIGNoZWNrcyBvbiBlcnJvcnMgZG9uJ3Qgd29yayB3aXRoIGVycm9yc1xuICAgIC8vIHRoYXQgd3JhcCBvdGhlciBlcnJvcnMuXG4gICAgcmV0dXJuIFwiSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvclwiID09PSBlLm5hbWU7XG59XG5cbi8qKlxuICogQSB3cmFwcGVyIGFyb3VuZCBhbiBJREJPYmplY3RTdG9yZSBwcm92aWRpbmcgYW4gQVBJIHRoYXQ6XG4gKlxuICogMSkgSGFzIGdlbmVyaWMgS2V5VHlwZSAvIFZhbHVlVHlwZSBwYXJhbWV0ZXJzIHRvIHByb3ZpZGUgc3Ryb25nbHktdHlwZWRcbiAqIG1ldGhvZHMgZm9yIGFjdGluZyBhZ2FpbnN0IHRoZSBvYmplY3Qgc3RvcmUuXG4gKiAyKSBEZWFscyB3aXRoIEluZGV4ZWREQidzIG9uc3VjY2VzcyAvIG9uZXJyb3IgZXZlbnQgY2FsbGJhY2tzLCBtYWtpbmcgZXZlcnlcbiAqIG1ldGhvZCByZXR1cm4gYSBQZXJzaXN0ZW5jZVByb21pc2UgaW5zdGVhZC5cbiAqIDMpIFByb3ZpZGVzIGEgaGlnaGVyLWxldmVsIEFQSSB0byBhdm9pZCBuZWVkaW5nIHRvIGRvIGV4Y2Vzc2l2ZSB3cmFwcGluZyBvZlxuICogaW50ZXJtZWRpYXRlIEluZGV4ZWREQiB0eXBlcyAoSURCQ3Vyc29yV2l0aFZhbHVlLCBldGMuKVxuICovIGNsYXNzIF9fUFJJVkFURV9TaW1wbGVEYlN0b3JlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSBlO1xuICAgIH1cbiAgICBwdXQoZSwgdCkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdCA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJTaW1wbGVEYlwiLCBcIlBVVFwiLCB0aGlzLnN0b3JlLm5hbWUsIGUsIHQpLCBcbiAgICAgICAgbiA9IHRoaXMuc3RvcmUucHV0KHQsIGUpKSA6IChfX1BSSVZBVEVfbG9nRGVidWcoXCJTaW1wbGVEYlwiLCBcIlBVVFwiLCB0aGlzLnN0b3JlLm5hbWUsIFwiPGF1dG8ta2V5PlwiLCBlKSwgXG4gICAgICAgIG4gPSB0aGlzLnN0b3JlLnB1dChlKSksIF9fUFJJVkFURV93cmFwUmVxdWVzdChuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIG5ldyB2YWx1ZSBpbnRvIGFuIE9iamVjdCBTdG9yZSBhbmQgcmV0dXJucyB0aGUgbmV3IGtleS4gU2ltaWxhciB0b1xuICAgICAqIEluZGV4ZWREYidzIGBhZGQoKWAsIHRoaXMgbWV0aG9kIHdpbGwgZmFpbCBvbiBwcmltYXJ5IGtleSBjb2xsaXNpb25zLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIG9iamVjdCB0byB3cml0ZS5cbiAgICAgKiBAcmV0dXJucyBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBhZGQuXG4gICAgICovICAgIGFkZChlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiQUREXCIsIHRoaXMuc3RvcmUubmFtZSwgZSwgZSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QodGhpcy5zdG9yZS5hZGQoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBvYmplY3Qgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBmcm9tIHRoZSBzcGVjaWZpZWQgc3RvcmUsIG9yIG51bGxcbiAgICAgKiBpZiBubyBvYmplY3QgZXhpc3RzIHdpdGggdGhlIHNwZWNpZmllZCBrZXkuXG4gICAgICpcbiAgICAgKiBAa2V5IFRoZSBrZXkgb2YgdGhlIG9iamVjdCB0byBnZXQuXG4gICAgICogQHJldHVybnMgVGhlIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IG9yIG51bGwgaWYgbm8gb2JqZWN0IGV4aXN0cy5cbiAgICAgKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgLy8gV2UncmUgZG9pbmcgYW4gdW5zYWZlIGNhc3QgdG8gVmFsdWVUeXBlLlxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyYXBSZXF1ZXN0KHRoaXMuc3RvcmUuZ2V0KGUpKS5uZXh0KCh0ID0+IChcbiAgICAgICAgLy8gTm9ybWFsaXplIG5vbmV4aXN0ZW5jZSB0byBudWxsLlxuICAgICAgICB2b2lkIDAgPT09IHQgJiYgKHQgPSBudWxsKSwgX19QUklWQVRFX2xvZ0RlYnVnKFwiU2ltcGxlRGJcIiwgXCJHRVRcIiwgdGhpcy5zdG9yZS5uYW1lLCBlLCB0KSwgXG4gICAgICAgIHQpKSk7XG4gICAgfVxuICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiREVMRVRFXCIsIHRoaXMuc3RvcmUubmFtZSwgZSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QodGhpcy5zdG9yZS5kZWxldGUoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJZiB3ZSBldmVyIG5lZWQgbW9yZSBvZiB0aGUgY291bnQgdmFyaWFudHMsIHdlIGNhbiBhZGQgb3ZlcmxvYWRzLiBGb3Igbm93LFxuICAgICAqIGFsbCB3ZSBuZWVkIGlzIHRvIGNvdW50IGV2ZXJ5dGhpbmcgaW4gYSBzdG9yZS5cbiAgICAgKlxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByb3dzIGluIHRoZSBzdG9yZS5cbiAgICAgKi8gICAgY291bnQoKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNpbXBsZURiXCIsIFwiQ09VTlRcIiwgdGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cmFwUmVxdWVzdCh0aGlzLnN0b3JlLmNvdW50KCkpO1xuICAgIH1cbiAgICBVKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMub3B0aW9ucyhlLCB0KSwgciA9IG4uaW5kZXggPyB0aGlzLnN0b3JlLmluZGV4KG4uaW5kZXgpIDogdGhpcy5zdG9yZTtcbiAgICAgICAgLy8gVXNlIGBnZXRBbGwoKWAgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgSW5kZXhlZERCIHYzLCBhcyBpdCBpcyByb3VnaGx5XG4gICAgICAgIC8vIDIwJSBmYXN0ZXIuXG4gICAgICAgICAgICAgICAgaWYgKFwiZnVuY3Rpb25cIiA9PSB0eXBlb2Ygci5nZXRBbGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSByLmdldEFsbChuLnJhbmdlKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGUub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBuKGUudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgICAgICB9LCBlLm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0KGUudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5jdXJzb3IobiksIHQgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLlcoZSwgKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgdC5wdXNoKG4pO1xuICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb2FkcyB0aGUgZmlyc3QgYGNvdW50YCBlbGVtZW50cyBmcm9tIHRoZSBwcm92aWRlZCBpbmRleCByYW5nZS4gTG9hZHMgYWxsXG4gICAgICogZWxlbWVudHMgaWYgbm8gbGltaXQgaXMgcHJvdmlkZWQuXG4gICAgICovICAgIEcoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5zdG9yZS5nZXRBbGwoZSwgbnVsbCA9PT0gdCA/IHZvaWQgMCA6IHQpO1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIG4ub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIHQoZS50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgfSwgbi5vbnN1Y2Nlc3MgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBlKHQudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGooZSwgdCkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJTaW1wbGVEYlwiLCBcIkRFTEVURSBBTExcIiwgdGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMub3B0aW9ucyhlLCB0KTtcbiAgICAgICAgbi5IID0gITE7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLmN1cnNvcihuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuVyhyLCAoKGUsIHQsIG4pID0+IG4uZGVsZXRlKCkpKTtcbiAgICB9XG4gICAgSihlLCB0KSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICB0ID8gbiA9IGUgOiAobiA9IHt9LCB0ID0gZSk7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLmN1cnNvcihuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuVyhyLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBhIHN0b3JlLCBidXQgd2FpdHMgZm9yIHRoZSBnaXZlbiBjYWxsYmFjayB0byBjb21wbGV0ZSBmb3JcbiAgICAgKiBlYWNoIGVudHJ5IGJlZm9yZSBpdGVyYXRpbmcgdGhlIG5leHQgZW50cnkuIFRoaXMgYWxsb3dzIHRoZSBjYWxsYmFjayB0byBkb1xuICAgICAqIGFzeW5jaHJvbm91cyB3b3JrIHRvIGRldGVybWluZSBpZiB0aGlzIGl0ZXJhdGlvbiBzaG91bGQgY29udGludWUuXG4gICAgICpcbiAgICAgKiBUaGUgcHJvdmlkZWQgY2FsbGJhY2sgc2hvdWxkIHJldHVybiBgdHJ1ZWAgdG8gY29udGludWUgaXRlcmF0aW9uLCBhbmRcbiAgICAgKiBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICAgKi8gICAgWShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmN1cnNvcih7fSk7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgdC5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9jaGVja0ZvckFuZFJlcG9ydGlPU0Vycm9yKGUudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgICAgICByKHQpO1xuICAgICAgICAgICAgfSwgdC5vbnN1Y2Nlc3MgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdC50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgIHIgPyBlKHIucHJpbWFyeUtleSwgci52YWx1ZSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUgPyByLmNvbnRpbnVlKCkgOiBuKCk7XG4gICAgICAgICAgICAgICAgfSkpIDogbigpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBXKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKHIsIGkpID0+IHtcbiAgICAgICAgICAgIGUub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGkoZS50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgfSwgZS5vbnN1Y2Nlc3MgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgIGlmICghaSkgcmV0dXJuIHZvaWQgcigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgX19QUklWQVRFX0l0ZXJhdGlvbkNvbnRyb2xsZXIoaSksIG8gPSB0KGkucHJpbWFyeUtleSwgaS52YWx1ZSwgcyk7XG4gICAgICAgICAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZVByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IG8uY2F0Y2goKGUgPT4gKHMuZG9uZSgpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVqZWN0KGUpKSkpO1xuICAgICAgICAgICAgICAgICAgICBuLnB1c2goZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHMuaXNEb25lID8gcigpIDogbnVsbCA9PT0gcy5LID8gaS5jb250aW51ZSgpIDogaS5jb250aW51ZShzLkspO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKG4pKSk7XG4gICAgfVxuICAgIG9wdGlvbnMoZSwgdCkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZSAmJiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IG4gPSBlIDogdCA9IGUpLCB7XG4gICAgICAgICAgICBpbmRleDogbixcbiAgICAgICAgICAgIHJhbmdlOiB0XG4gICAgICAgIH07XG4gICAgfVxuICAgIGN1cnNvcihlKSB7XG4gICAgICAgIGxldCB0ID0gXCJuZXh0XCI7XG4gICAgICAgIGlmIChlLnJldmVyc2UgJiYgKHQgPSBcInByZXZcIiksIGUuaW5kZXgpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnN0b3JlLmluZGV4KGUuaW5kZXgpO1xuICAgICAgICAgICAgcmV0dXJuIGUuSCA/IG4ub3BlbktleUN1cnNvcihlLnJhbmdlLCB0KSA6IG4ub3BlbkN1cnNvcihlLnJhbmdlLCB0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zdG9yZS5vcGVuQ3Vyc29yKGUucmFuZ2UsIHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBXcmFwcyBhbiBJREJSZXF1ZXN0IGluIGEgUGVyc2lzdGVuY2VQcm9taXNlLCB1c2luZyB0aGUgb25zdWNjZXNzIC8gb25lcnJvclxuICogaGFuZGxlcnMgdG8gcmVzb2x2ZSAvIHJlamVjdCB0aGUgUGVyc2lzdGVuY2VQcm9taXNlIGFzIGFwcHJvcHJpYXRlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV93cmFwUmVxdWVzdChlKSB7XG4gICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKCh0LCBuKSA9PiB7XG4gICAgICAgIGUub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgdChuKTtcbiAgICAgICAgfSwgZS5vbmVycm9yID0gZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2NoZWNrRm9yQW5kUmVwb3J0aU9TRXJyb3IoZS50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgbih0KTtcbiAgICAgICAgfTtcbiAgICB9KSk7XG59XG5cbi8vIEd1YXJkIHNvIHdlIG9ubHkgcmVwb3J0IHRoZSBlcnJvciBvbmNlLlxubGV0IEYgPSAhMTtcblxuZnVuY3Rpb24gX19QUklWQVRFX2NoZWNrRm9yQW5kUmVwb3J0aU9TRXJyb3IoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfU2ltcGxlRGIuUyhnZXRVQSgpKTtcbiAgICBpZiAodCA+PSAxMi4yICYmIHQgPCAxMykge1xuICAgICAgICBjb25zdCB0ID0gXCJBbiBpbnRlcm5hbCBlcnJvciB3YXMgZW5jb3VudGVyZWQgaW4gdGhlIEluZGV4ZWQgRGF0YWJhc2Ugc2VydmVyXCI7XG4gICAgICAgIGlmIChlLm1lc3NhZ2UuaW5kZXhPZih0KSA+PSAwKSB7XG4gICAgICAgICAgICAvLyBXcmFwIGVycm9yIGluIGEgbW9yZSBkZXNjcmlwdGl2ZSBvbmUuXG4gICAgICAgICAgICBjb25zdCBlID0gbmV3IEZpcmVzdG9yZUVycm9yKFwiaW50ZXJuYWxcIiwgYElPU19JTkRFWEVEREJfQlVHMTogSW5kZXhlZERiIGhhcyB0aHJvd24gJyR7dH0nLiBUaGlzIGlzIGxpa2VseSBkdWUgdG8gYW4gdW5hdm9pZGFibGUgYnVnIGluIGlPUy4gU2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcS81NjQ5NjI5Ni8xMTA5MTUgZm9yIGRldGFpbHMgYW5kIGEgcG90ZW50aWFsIHdvcmthcm91bmQuYCk7XG4gICAgICAgICAgICByZXR1cm4gRiB8fCAoRiA9ICEwLCBcbiAgICAgICAgICAgIC8vIFRocm93IGEgZ2xvYmFsIGV4Y2VwdGlvbiBvdXRzaWRlIG9mIHRoaXMgcHJvbWlzZSBjaGFpbiwgZm9yIHRoZSB1c2VyIHRvXG4gICAgICAgICAgICAvLyBwb3RlbnRpYWxseSBjYXRjaC5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgfSksIDApKSwgZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZTtcbn1cblxuLyoqIFRoaXMgY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIHRoZSBzY2hlZHVsaW5nIG9mIEluZGV4IEJhY2tmaWxsZXIuICovXG5jbGFzcyBfX1BSSVZBVEVfSW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZSA9IGUsIHRoaXMuWiA9IHQsIHRoaXMudGFzayA9IG51bGw7XG4gICAgfVxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLlgoMTVlMyk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIHRoaXMudGFzayAmJiAodGhpcy50YXNrLmNhbmNlbCgpLCB0aGlzLnRhc2sgPSBudWxsKTtcbiAgICB9XG4gICAgZ2V0IHN0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLnRhc2s7XG4gICAgfVxuICAgIFgoZSkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJJbmRleEJhY2tmaWxsZXJcIiwgYFNjaGVkdWxlZCBpbiAke2V9bXNgKSwgdGhpcy50YXNrID0gdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBZnRlckRlbGF5KFwiaW5kZXhfYmFja2ZpbGxcIiAvKiBUaW1lcklkLkluZGV4QmFja2ZpbGwgKi8gLCBlLCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy50YXNrID0gbnVsbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhCYWNrZmlsbGVyXCIsIGBEb2N1bWVudHMgd3JpdHRlbjogJHthd2FpdCB0aGlzLlouZWUoKX1gKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUpID8gX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhCYWNrZmlsbGVyXCIsIFwiSWdub3JpbmcgSW5kZXhlZERCIGVycm9yIGR1cmluZyBpbmRleCBiYWNrZmlsbDogXCIsIGUpIDogYXdhaXQgX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuWCg2ZTQpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKiogSW1wbGVtZW50cyB0aGUgc3RlcHMgZm9yIGJhY2tmaWxsaW5nIGluZGV4ZXMuICovIGNsYXNzIF9fUFJJVkFURV9JbmRleEJhY2tmaWxsZXIge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIExvY2FsU3RvcmUgcHJvdmlkZXMgYWNjZXNzIHRvIEluZGV4TWFuYWdlciBhbmQgTG9jYWxEb2N1bWVudFZpZXcuXG4gICAgICogVGhlc2UgcHJvcGVydGllcyB3aWxsIHVwZGF0ZSB3aGVuIHRoZSB1c2VyIGNoYW5nZXMuIENvbnNlcXVlbnRseSxcbiAgICAgKiBtYWtpbmcgYSBsb2NhbCBjb3B5IG9mIEluZGV4TWFuYWdlciBhbmQgTG9jYWxEb2N1bWVudFZpZXcgd2lsbCByZXF1aXJlXG4gICAgICogdXBkYXRlcyBvdmVyIHRpbWUuIFRoZSBzaW1wbGVyIHNvbHV0aW9uIGlzIHRvIHJlbHkgb24gTG9jYWxTdG9yZSB0byBoYXZlXG4gICAgICogYW4gdXAtdG8tZGF0ZSByZWZlcmVuY2VzIHRvIEluZGV4TWFuYWdlciBhbmQgTG9jYWxEb2N1bWVudFN0b3JlLlxuICAgICAqL1xuICAgIGUsIHQpIHtcbiAgICAgICAgdGhpcy5sb2NhbFN0b3JlID0gZSwgdGhpcy5wZXJzaXN0ZW5jZSA9IHQ7XG4gICAgfVxuICAgIGFzeW5jIGVlKGUgPSA1MCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkJhY2tmaWxsIEluZGV4ZXNcIiwgXCJyZWFkd3JpdGUtcHJpbWFyeVwiLCAodCA9PiB0aGlzLnRlKHQsIGUpKSk7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgaW5kZXggZW50cmllcyB1bnRpbCB0aGUgY2FwIGlzIHJlYWNoZWQuIFJldHVybnMgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgcHJvY2Vzc2VkLiAqLyAgICB0ZShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgU2V0O1xuICAgICAgICBsZXQgciA9IHQsIGkgPSAhMDtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5kb1doaWxlKCgoKSA9PiAhMCA9PT0gaSAmJiByID4gMCksICgoKSA9PiB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLmdldE5leHRDb2xsZWN0aW9uR3JvdXBUb1VwZGF0ZShlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0ICYmICFuLmhhcyh0KSkgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4QmFja2ZpbGxlclwiLCBgUHJvY2Vzc2luZyBjb2xsZWN0aW9uOiAke3R9YCksIFxuICAgICAgICAgICAgdGhpcy5uZShlLCB0LCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICByIC09IGUsIG4uYWRkKHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaSA9ICExO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiB0IC0gcikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZXMgZW50cmllcyBmb3IgdGhlIHByb3ZpZGVkIGNvbGxlY3Rpb24gZ3JvdXAuIFJldHVybnMgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgcHJvY2Vzc2VkLlxuICAgICAqLyAgICBuZShlLCB0LCBuKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgZWFybGllc3Qgb2Zmc2V0IG9mIGFsbCBmaWVsZCBpbmRleGVzIHRvIHF1ZXJ5IHRoZSBsb2NhbCBjYWNoZS5cbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxTdG9yZS5pbmRleE1hbmFnZXIuZ2V0TWluT2Zmc2V0RnJvbUNvbGxlY3Rpb25Hcm91cChlLCB0KS5uZXh0KChyID0+IHRoaXMubG9jYWxTdG9yZS5sb2NhbERvY3VtZW50cy5nZXROZXh0RG9jdW1lbnRzKGUsIHQsIHIsIG4pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uY2hhbmdlcztcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLnVwZGF0ZUluZGV4RW50cmllcyhlLCBpKS5uZXh0KCgoKSA9PiB0aGlzLnJlKHIsIG4pKSkubmV4dCgobiA9PiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhCYWNrZmlsbGVyXCIsIGBVcGRhdGluZyBvZmZzZXQ6ICR7bn1gKSwgXG4gICAgICAgICAgICB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLnVwZGF0ZUNvbGxlY3Rpb25Hcm91cChlLCB0LCBuKSkpKS5uZXh0KCgoKSA9PiBpLnNpemUpKTtcbiAgICAgICAgfSkpKSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBuZXh0IG9mZnNldCBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgZG9jdW1lbnRzLiAqLyAgICByZShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gZTtcbiAgICAgICAgcmV0dXJuIHQuY2hhbmdlcy5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9uZXdJbmRleE9mZnNldEZyb21Eb2N1bWVudCh0KTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9pbmRleE9mZnNldENvbXBhcmF0b3IociwgbikgPiAwICYmIChuID0gcik7XG4gICAgICAgIH0pKSwgbmV3IEluZGV4T2Zmc2V0KG4ucmVhZFRpbWUsIG4uZG9jdW1lbnRLZXksIE1hdGgubWF4KHQuYmF0Y2hJZCwgZS5sYXJnZXN0QmF0Y2hJZCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogYExpc3RlblNlcXVlbmNlYCBpcyBhIG1vbm90b25pYyBzZXF1ZW5jZS4gSXQgaXMgaW5pdGlhbGl6ZWQgd2l0aCBhIG1pbmltdW0gdmFsdWUgdG9cbiAqIGV4Y2VlZC4gQWxsIHN1YnNlcXVlbnQgY2FsbHMgdG8gbmV4dCB3aWxsIHJldHVybiBpbmNyZWFzaW5nIHZhbHVlcy4gSWYgcHJvdmlkZWQgd2l0aCBhXG4gKiBgU2VxdWVuY2VOdW1iZXJTeW5jZXJgLCBpdCB3aWxsIGFkZGl0aW9uYWxseSBidW1wIGl0cyBuZXh0IHZhbHVlIHdoZW4gdG9sZCBvZiBhIG5ldyB2YWx1ZSwgYXNcbiAqIHdlbGwgYXMgd3JpdGUgb3V0IHNlcXVlbmNlIG51bWJlcnMgdGhhdCBpdCBwcm9kdWNlcyB2aWEgYG5leHQoKWAuXG4gKi8gY2xhc3MgX19QUklWQVRFX0xpc3RlblNlcXVlbmNlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMucHJldmlvdXNWYWx1ZSA9IGUsIHQgJiYgKHQuc2VxdWVuY2VOdW1iZXJIYW5kbGVyID0gZSA9PiB0aGlzLmllKGUpLCB0aGlzLnNlID0gZSA9PiB0LndyaXRlU2VxdWVuY2VOdW1iZXIoZSkpO1xuICAgIH1cbiAgICBpZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByZXZpb3VzVmFsdWUgPSBNYXRoLm1heChlLCB0aGlzLnByZXZpb3VzVmFsdWUpLCB0aGlzLnByZXZpb3VzVmFsdWU7XG4gICAgfVxuICAgIG5leHQoKSB7XG4gICAgICAgIGNvbnN0IGUgPSArK3RoaXMucHJldmlvdXNWYWx1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2UgJiYgdGhpcy5zZShlKSwgZTtcbiAgICB9XG59XG5cbl9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5vZSA9IC0xO1xuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBhIHZhcmlhYmxlIGlzIGVpdGhlciB1bmRlZmluZWQgb3IgbnVsbC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2lzTnVsbE9yVW5kZWZpbmVkKGUpIHtcbiAgICByZXR1cm4gbnVsbCA9PSBlO1xufVxuXG4vKiogUmV0dXJucyB3aGV0aGVyIHRoZSB2YWx1ZSByZXByZXNlbnRzIC0wLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNOZWdhdGl2ZVplcm8oZSkge1xuICAgIC8vIERldGVjdCBpZiB0aGUgdmFsdWUgaXMgLTAuMC4gQmFzZWQgb24gcG9seWZpbGwgZnJvbVxuICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9pc1xuICAgIHJldHVybiAwID09PSBlICYmIDEgLyBlID09IC0xIC8gMDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgYSB2YWx1ZSBpcyBhbiBpbnRlZ2VyIGFuZCBpbiB0aGUgc2FmZSBpbnRlZ2VyIHJhbmdlXG4gKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gdGVzdCBmb3IgYmVpbmcgYW4gaW50ZWdlciBhbmQgaW4gdGhlIHNhZmUgcmFuZ2VcbiAqLyBmdW5jdGlvbiBpc1NhZmVJbnRlZ2VyKGUpIHtcbiAgICByZXR1cm4gXCJudW1iZXJcIiA9PSB0eXBlb2YgZSAmJiBOdW1iZXIuaXNJbnRlZ2VyKGUpICYmICFfX1BSSVZBVEVfaXNOZWdhdGl2ZVplcm8oZSkgJiYgZSA8PSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiAmJiBlID49IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBFbmNvZGVzIGEgcmVzb3VyY2UgcGF0aCBpbnRvIGEgSW5kZXhlZERiLWNvbXBhdGlibGUgc3RyaW5nIGZvcm0uXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgoZSkge1xuICAgIGxldCB0ID0gXCJcIjtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHQubGVuZ3RoID4gMCAmJiAodCA9IF9fUFJJVkFURV9lbmNvZGVTZXBhcmF0b3IodCkpLCBcbiAgICB0ID0gX19QUklWQVRFX2VuY29kZVNlZ21lbnQoZS5nZXQobiksIHQpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZW5jb2RlU2VwYXJhdG9yKHQpO1xufVxuXG4vKiogRW5jb2RlcyBhIHNpbmdsZSBzZWdtZW50IG9mIGEgcmVzb3VyY2UgcGF0aCBpbnRvIHRoZSBnaXZlbiByZXN1bHQgKi8gZnVuY3Rpb24gX19QUklWQVRFX2VuY29kZVNlZ21lbnQoZSwgdCkge1xuICAgIGxldCBuID0gdDtcbiAgICBjb25zdCByID0gZS5sZW5ndGg7XG4gICAgZm9yIChsZXQgdCA9IDA7IHQgPCByOyB0KyspIHtcbiAgICAgICAgY29uc3QgciA9IGUuY2hhckF0KHQpO1xuICAgICAgICBzd2l0Y2ggKHIpIHtcbiAgICAgICAgICBjYXNlIFwiXFwwXCI6XG4gICAgICAgICAgICBuICs9IFwiXHUwMDAxXHUwMDEwXCI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCJcdTAwMDFcIjpcbiAgICAgICAgICAgIG4gKz0gXCJcdTAwMDFcdTAwMTFcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIG4gKz0gcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbjtcbn1cblxuLyoqIEVuY29kZXMgYSBwYXRoIHNlcGFyYXRvciBpbnRvIHRoZSBnaXZlbiByZXN1bHQgKi8gZnVuY3Rpb24gX19QUklWQVRFX2VuY29kZVNlcGFyYXRvcihlKSB7XG4gICAgcmV0dXJuIGUgKyBcIlx1MDAwMVx1MDAwMVwiO1xufVxuXG4vKipcbiAqIERlY29kZXMgdGhlIGdpdmVuIEluZGV4ZWREYi1jb21wYXRpYmxlIHN0cmluZyBmb3JtIG9mIGEgcmVzb3VyY2UgcGF0aCBpbnRvXG4gKiBhIFJlc291cmNlUGF0aCBpbnN0YW5jZS4gTm90ZSB0aGF0IHRoaXMgbWV0aG9kIGlzIG5vdCBzdWl0YWJsZSBmb3IgdXNlIHdpdGhcbiAqIGRlY29kaW5nIHJlc291cmNlIG5hbWVzIGZyb20gdGhlIHNlcnZlcjsgdGhvc2UgYXJlIE9uZSBQbGF0Zm9ybSBmb3JtYXRcbiAqIHN0cmluZ3MuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChlKSB7XG4gICAgLy8gRXZlbnQgdGhlIGVtcHR5IHBhdGggbXVzdCBlbmNvZGUgYXMgYSBwYXRoIG9mIGF0IGxlYXN0IGxlbmd0aCAyLiBBIHBhdGhcbiAgICAvLyB3aXRoIGV4YWN0bHkgMiBtdXN0IGJlIHRoZSBlbXB0eSBwYXRoLlxuICAgIGNvbnN0IHQgPSBlLmxlbmd0aDtcbiAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQodCA+PSAyKSwgMiA9PT0gdCkgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KFwiXHUwMDAxXCIgPT09IGUuY2hhckF0KDApICYmIFwiXHUwMDAxXCIgPT09IGUuY2hhckF0KDEpKSwgXG4gICAgUmVzb3VyY2VQYXRoLmVtcHR5UGF0aCgpO1xuICAgIC8vIEVzY2FwZSBjaGFyYWN0ZXJzIGNhbm5vdCBleGlzdCBwYXN0IHRoZSBzZWNvbmQtdG8tbGFzdCBwb3NpdGlvbiBpbiB0aGVcbiAgICAvLyBzb3VyY2UgdmFsdWUuXG4gICAgICAgIGNvbnN0IF9fUFJJVkFURV9sYXN0UmVhc29uYWJsZUVzY2FwZUluZGV4ID0gdCAtIDIsIG4gPSBbXTtcbiAgICBsZXQgciA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0OyApIHtcbiAgICAgICAgLy8gVGhlIGxhc3QgdHdvIGNoYXJhY3RlcnMgb2YgYSB2YWxpZCBlbmNvZGVkIHBhdGggbXVzdCBiZSBhIHNlcGFyYXRvciwgc29cbiAgICAgICAgLy8gdGhlcmUgbXVzdCBiZSBhbiBlbmQgdG8gdGhpcyBzZWdtZW50LlxuICAgICAgICBjb25zdCB0ID0gZS5pbmRleE9mKFwiXHUwMDAxXCIsIGkpO1xuICAgICAgICAodCA8IDAgfHwgdCA+IF9fUFJJVkFURV9sYXN0UmVhc29uYWJsZUVzY2FwZUluZGV4KSAmJiBmYWlsKCk7XG4gICAgICAgIHN3aXRjaCAoZS5jaGFyQXQodCArIDEpKSB7XG4gICAgICAgICAgY2FzZSBcIlx1MDAwMVwiOlxuICAgICAgICAgICAgY29uc3QgcyA9IGUuc3Vic3RyaW5nKGksIHQpO1xuICAgICAgICAgICAgbGV0IG87XG4gICAgICAgICAgICAwID09PSByLmxlbmd0aCA/IFxuICAgICAgICAgICAgLy8gQXZvaWQgY29weWluZyBmb3IgdGhlIGNvbW1vbiBjYXNlIG9mIGEgc2VnbWVudCB0aGF0IGV4Y2x1ZGVzIFxcMFxuICAgICAgICAgICAgLy8gYW5kIFxcMDAxXG4gICAgICAgICAgICBvID0gcyA6IChyICs9IHMsIG8gPSByLCByID0gXCJcIiksIG4ucHVzaChvKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIlx1MDAxMFwiOlxuICAgICAgICAgICAgciArPSBlLnN1YnN0cmluZyhpLCB0KSwgciArPSBcIlxcMFwiO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiXHUwMDExXCI6XG4gICAgICAgICAgICAvLyBUaGUgZXNjYXBlIGNoYXJhY3RlciBjYW4gYmUgdXNlZCBpbiB0aGUgb3V0cHV0IHRvIGVuY29kZSBpdHNlbGYuXG4gICAgICAgICAgICByICs9IGUuc3Vic3RyaW5nKGksIHQgKyAxKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgfVxuICAgICAgICBpID0gdCArIDI7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUmVzb3VyY2VQYXRoKG4pO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBNID0gWyBcInVzZXJJZFwiLCBcImJhdGNoSWRcIiBdO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBOYW1lIG9mIHRoZSBJbmRleGVkRGIgb2JqZWN0IHN0b3JlLlxuICpcbiAqIE5vdGUgdGhhdCB0aGUgbmFtZSAnb3duZXInIGlzIGNob3NlbiB0byBlbnN1cmUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aFxuICogb2xkZXIgY2xpZW50cyB0aGF0IG9ubHkgc3VwcG9ydGVkIHNpbmdsZSBsb2NrZWQgYWNjZXNzIHRvIHRoZSBwZXJzaXN0ZW5jZVxuICogbGF5ZXIuXG4gKi9cbi8qKlxuICogQ3JlYXRlcyBhIFt1c2VySWQsIGVuY29kZWRQYXRoXSBrZXkgZm9yIHVzZSBpbiB0aGUgRGJEb2N1bWVudE11dGF0aW9uc1xuICogaW5kZXggdG8gaXRlcmF0ZSBvdmVyIGFsbCBhdCBkb2N1bWVudCBtdXRhdGlvbnMgZm9yIGEgZ2l2ZW4gcGF0aCBvciBsb3dlci5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvblByZWZpeEZvclBhdGgoZSwgdCkge1xuICAgIHJldHVybiBbIGUsIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodCkgXTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVsbCBpbmRleCBrZXkgb2YgW3VzZXJJZCwgZW5jb2RlZFBhdGgsIGJhdGNoSWRdIGZvciBpbnNlcnRpbmdcbiAqIGFuZCBkZWxldGluZyBpbnRvIHRoZSBEYkRvY3VtZW50TXV0YXRpb25zIGluZGV4LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdEYkRvY3VtZW50TXV0YXRpb25LZXkoZSwgdCwgbikge1xuICAgIHJldHVybiBbIGUsIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodCksIG4gXTtcbn1cblxuLyoqXG4gKiBCZWNhdXNlIHdlIHN0b3JlIGFsbCB0aGUgdXNlZnVsIGluZm9ybWF0aW9uIGZvciB0aGlzIHN0b3JlIGluIHRoZSBrZXksXG4gKiB0aGVyZSBpcyBubyB1c2VmdWwgaW5mb3JtYXRpb24gdG8gc3RvcmUgYXMgdGhlIHZhbHVlLiBUaGUgcmF3ICh1bmVuY29kZWQpXG4gKiBwYXRoIGNhbm5vdCBiZSBzdG9yZWQgYmVjYXVzZSBJbmRleGVkRGIgZG9lc24ndCBzdG9yZSBwcm90b3R5cGVcbiAqIGluZm9ybWF0aW9uLlxuICovIGNvbnN0IHggPSB7fSwgTyA9IFsgXCJwcmVmaXhQYXRoXCIsIFwiY29sbGVjdGlvbkdyb3VwXCIsIFwicmVhZFRpbWVcIiwgXCJkb2N1bWVudElkXCIgXSwgTiA9IFsgXCJwcmVmaXhQYXRoXCIsIFwiY29sbGVjdGlvbkdyb3VwXCIsIFwiZG9jdW1lbnRJZFwiIF0sIEwgPSBbIFwiY29sbGVjdGlvbkdyb3VwXCIsIFwicmVhZFRpbWVcIiwgXCJwcmVmaXhQYXRoXCIsIFwiZG9jdW1lbnRJZFwiIF0sIEIgPSBbIFwiY2Fub25pY2FsSWRcIiwgXCJ0YXJnZXRJZFwiIF0sIGsgPSBbIFwidGFyZ2V0SWRcIiwgXCJwYXRoXCIgXSwgcSA9IFsgXCJwYXRoXCIsIFwidGFyZ2V0SWRcIiBdLCBRID0gWyBcImNvbGxlY3Rpb25JZFwiLCBcInBhcmVudFwiIF0sIEsgPSBbIFwiaW5kZXhJZFwiLCBcInVpZFwiIF0sICQgPSBbIFwidWlkXCIsIFwic2VxdWVuY2VOdW1iZXJcIiBdLCBVID0gWyBcImluZGV4SWRcIiwgXCJ1aWRcIiwgXCJhcnJheVZhbHVlXCIsIFwiZGlyZWN0aW9uYWxWYWx1ZVwiLCBcIm9yZGVyZWREb2N1bWVudEtleVwiLCBcImRvY3VtZW50S2V5XCIgXSwgVyA9IFsgXCJpbmRleElkXCIsIFwidWlkXCIsIFwib3JkZXJlZERvY3VtZW50S2V5XCIgXSwgRyA9IFsgXCJ1c2VySWRcIiwgXCJjb2xsZWN0aW9uUGF0aFwiLCBcImRvY3VtZW50SWRcIiBdLCB6ID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25QYXRoXCIsIFwibGFyZ2VzdEJhdGNoSWRcIiBdLCBqID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25Hcm91cFwiLCBcImxhcmdlc3RCYXRjaElkXCIgXSwgSCA9IFsgLi4uWyAuLi5bIC4uLlsgLi4uWyBcIm11dGF0aW9uUXVldWVzXCIsIFwibXV0YXRpb25zXCIsIFwiZG9jdW1lbnRNdXRhdGlvbnNcIiwgXCJyZW1vdGVEb2N1bWVudHNcIiwgXCJ0YXJnZXRzXCIsIFwib3duZXJcIiwgXCJ0YXJnZXRHbG9iYWxcIiwgXCJ0YXJnZXREb2N1bWVudHNcIiBdLCBcImNsaWVudE1ldGFkYXRhXCIgXSwgXCJyZW1vdGVEb2N1bWVudEdsb2JhbFwiIF0sIFwiY29sbGVjdGlvblBhcmVudHNcIiBdLCBcImJ1bmRsZXNcIiwgXCJuYW1lZFF1ZXJpZXNcIiBdLCBKID0gWyAuLi5ILCBcImRvY3VtZW50T3ZlcmxheXNcIiBdLCBZID0gWyBcIm11dGF0aW9uUXVldWVzXCIsIFwibXV0YXRpb25zXCIsIFwiZG9jdW1lbnRNdXRhdGlvbnNcIiwgXCJyZW1vdGVEb2N1bWVudHNWMTRcIiwgXCJ0YXJnZXRzXCIsIFwib3duZXJcIiwgXCJ0YXJnZXRHbG9iYWxcIiwgXCJ0YXJnZXREb2N1bWVudHNcIiwgXCJjbGllbnRNZXRhZGF0YVwiLCBcInJlbW90ZURvY3VtZW50R2xvYmFsXCIsIFwiY29sbGVjdGlvblBhcmVudHNcIiwgXCJidW5kbGVzXCIsIFwibmFtZWRRdWVyaWVzXCIsIFwiZG9jdW1lbnRPdmVybGF5c1wiIF0sIFogPSBZLCBYID0gWyAuLi5aLCBcImluZGV4Q29uZmlndXJhdGlvblwiLCBcImluZGV4U3RhdGVcIiwgXCJpbmRleEVudHJpZXNcIiBdLCBlZSA9IFgsIHRlID0gWyAuLi5YLCBcImdsb2JhbHNcIiBdO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uIGV4dGVuZHMgUGVyc2lzdGVuY2VUcmFuc2FjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLl9lID0gZSwgdGhpcy5jdXJyZW50U2VxdWVuY2VOdW1iZXIgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFN0b3JlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gX19QUklWQVRFX1NpbXBsZURiLkYobi5fZSwgdCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9vYmplY3RTaXplKGUpIHtcbiAgICBsZXQgdCA9IDA7XG4gICAgZm9yIChjb25zdCBuIGluIGUpIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBuKSAmJiB0Kys7XG4gICAgcmV0dXJuIHQ7XG59XG5cbmZ1bmN0aW9uIGZvckVhY2goZSwgdCkge1xuICAgIGZvciAoY29uc3QgbiBpbiBlKSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgbikgJiYgdChuLCBlW25dKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX21hcFRvQXJyYXkoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHIgaW4gZSkgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHIpICYmIG4ucHVzaCh0KGVbcl0sIHIsIGUpKTtcbiAgICByZXR1cm4gbjtcbn1cblxuZnVuY3Rpb24gaXNFbXB0eShlKSB7XG4gICAgZm9yIChjb25zdCB0IGluIGUpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiAhMTtcbiAgICByZXR1cm4gITA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBBbiBpbW11dGFibGUgc29ydGVkIG1hcCBpbXBsZW1lbnRhdGlvbiwgYmFzZWQgb24gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrXG4vLyB0cmVlLlxuY2xhc3MgU29ydGVkTWFwIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuY29tcGFyYXRvciA9IGUsIHRoaXMucm9vdCA9IHQgfHwgTExSQk5vZGUuRU1QVFk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYSBjb3B5IG9mIHRoZSBtYXAsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkvdmFsdWUgYWRkZWQgb3IgcmVwbGFjZWQuXG4gICAgaW5zZXJ0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yLCB0aGlzLnJvb3QuaW5zZXJ0KGUsIHQsIHRoaXMuY29tcGFyYXRvcikuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCkpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgbWFwLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IHJlbW92ZWQuXG4gICAgcmVtb3ZlKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yLCB0aGlzLnJvb3QucmVtb3ZlKGUsIHRoaXMuY29tcGFyYXRvcikuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCkpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbm9kZSB3aXRoIHRoZSBnaXZlbiBrZXksIG9yIG51bGwuXG4gICAgZ2V0KGUpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLnJvb3Q7XG4gICAgICAgIGZvciAoOyF0LmlzRW1wdHkoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5jb21wYXJhdG9yKGUsIHQua2V5KTtcbiAgICAgICAgICAgIGlmICgwID09PSBuKSByZXR1cm4gdC52YWx1ZTtcbiAgICAgICAgICAgIG4gPCAwID8gdCA9IHQubGVmdCA6IG4gPiAwICYmICh0ID0gdC5yaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IGluIHRoaXMgc29ydGVkIG1hcCwgb3IgLTEgaWYgaXQgZG9lc24ndFxuICAgIC8vIGV4aXN0LlxuICAgIGluZGV4T2YoZSkge1xuICAgICAgICAvLyBOdW1iZXIgb2Ygbm9kZXMgdGhhdCB3ZXJlIHBydW5lZCB3aGVuIGRlc2NlbmRpbmcgcmlnaHRcbiAgICAgICAgbGV0IHQgPSAwLCBuID0gdGhpcy5yb290O1xuICAgICAgICBmb3IgKDshbi5pc0VtcHR5KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY29tcGFyYXRvcihlLCBuLmtleSk7XG4gICAgICAgICAgICBpZiAoMCA9PT0gcikgcmV0dXJuIHQgKyBuLmxlZnQuc2l6ZTtcbiAgICAgICAgICAgIHIgPCAwID8gbiA9IG4ubGVmdCA6IChcbiAgICAgICAgICAgIC8vIENvdW50IGFsbCBub2RlcyBsZWZ0IG9mIHRoZSBub2RlIHBsdXMgdGhlIG5vZGUgaXRzZWxmXG4gICAgICAgICAgICB0ICs9IG4ubGVmdC5zaXplICsgMSwgbiA9IG4ucmlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vZGUgbm90IGZvdW5kXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290LmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSBtYXAuXG4gICAgZ2V0IHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3Quc2l6ZTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWluaW11bSBrZXkgaW4gdGhlIG1hcC5cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QubWluS2V5KCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIG1heGltdW0ga2V5IGluIHRoZSBtYXAuXG4gICAgbWF4S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290Lm1heEtleSgpO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIG1hcCBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uXG4gICAgLy8gZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICBpbm9yZGVyVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5pbm9yZGVyVHJhdmVyc2FsKGUpO1xuICAgIH1cbiAgICBmb3JFYWNoKGUpIHtcbiAgICAgICAgdGhpcy5pbm9yZGVyVHJhdmVyc2FsKCgodCwgbikgPT4gKGUodCwgbiksICExKSkpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5pbm9yZGVyVHJhdmVyc2FsKCgodCwgbikgPT4gKGUucHVzaChgJHt0fToke259YCksICExKSkpLCBgeyR7ZS5qb2luKFwiLCBcIil9fWA7XG4gICAgfVxuICAgIC8vIFRyYXZlcnNlcyB0aGUgbWFwIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvblxuICAgIC8vIGZ1bmN0aW9uIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLiBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXNcbiAgICAvLyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICByZXZlcnNlVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5yZXZlcnNlVHJhdmVyc2FsKGUpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIFNvcnRlZE1hcC5cbiAgICBnZXRJdGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3QsIG51bGwsIHRoaXMuY29tcGFyYXRvciwgITEpO1xuICAgIH1cbiAgICBnZXRJdGVyYXRvckZyb20oZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNvcnRlZE1hcEl0ZXJhdG9yKHRoaXMucm9vdCwgZSwgdGhpcy5jb21wYXJhdG9yLCAhMSk7XG4gICAgfVxuICAgIGdldFJldmVyc2VJdGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3QsIG51bGwsIHRoaXMuY29tcGFyYXRvciwgITApO1xuICAgIH1cbiAgICBnZXRSZXZlcnNlSXRlcmF0b3JGcm9tKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3QsIGUsIHRoaXMuY29tcGFyYXRvciwgITApO1xuICAgIH1cbn1cblxuIC8vIGVuZCBTb3J0ZWRNYXBcbi8vIEFuIGl0ZXJhdG9yIG92ZXIgYW4gTExSQk5vZGUuXG5jbGFzcyBTb3J0ZWRNYXBJdGVyYXRvciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLmlzUmV2ZXJzZSA9IHIsIHRoaXMubm9kZVN0YWNrID0gW107XG4gICAgICAgIGxldCBpID0gMTtcbiAgICAgICAgZm9yICg7IWUuaXNFbXB0eSgpOyApIGlmIChpID0gdCA/IG4oZS5rZXksIHQpIDogMSwgXG4gICAgICAgIC8vIGZsaXAgdGhlIGNvbXBhcmlzb24gaWYgd2UncmUgZ29pbmcgaW4gcmV2ZXJzZVxuICAgICAgICB0ICYmIHIgJiYgKGkgKj0gLTEpLCBpIDwgMCkgXG4gICAgICAgIC8vIFRoaXMgbm9kZSBpcyBsZXNzIHRoYW4gb3VyIHN0YXJ0IGtleS4gaWdub3JlIGl0XG4gICAgICAgIGUgPSB0aGlzLmlzUmV2ZXJzZSA/IGUubGVmdCA6IGUucmlnaHQ7IGVsc2Uge1xuICAgICAgICAgICAgaWYgKDAgPT09IGkpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZXhhY3RseSBlcXVhbCB0byBvdXIgc3RhcnQga2V5LiBQdXNoIGl0IG9uIHRoZSBzdGFjayxcbiAgICAgICAgICAgICAgICAvLyBidXQgc3RvcCBpdGVyYXRpbmc7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlU3RhY2sucHVzaChlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBncmVhdGVyIHRoYW4gb3VyIHN0YXJ0IGtleSwgYWRkIGl0IHRvIHRoZSBzdGFjayBhbmQgbW92ZVxuICAgICAgICAgICAgLy8gdG8gdGhlIG5leHQgb25lXG4gICAgICAgICAgICB0aGlzLm5vZGVTdGFjay5wdXNoKGUpLCBlID0gdGhpcy5pc1JldmVyc2UgPyBlLnJpZ2h0IDogZS5sZWZ0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldE5leHQoKSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5ub2RlU3RhY2sucG9wKCk7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBrZXk6IGUua2V5LFxuICAgICAgICAgICAgdmFsdWU6IGUudmFsdWVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuaXNSZXZlcnNlKSBmb3IgKGUgPSBlLmxlZnQ7ICFlLmlzRW1wdHkoKTsgKSB0aGlzLm5vZGVTdGFjay5wdXNoKGUpLCBlID0gZS5yaWdodDsgZWxzZSBmb3IgKGUgPSBlLnJpZ2h0OyAhZS5pc0VtcHR5KCk7ICkgdGhpcy5ub2RlU3RhY2sucHVzaChlKSwgXG4gICAgICAgIGUgPSBlLmxlZnQ7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICBoYXNOZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ub2RlU3RhY2subGVuZ3RoID4gMDtcbiAgICB9XG4gICAgcGVlaygpIHtcbiAgICAgICAgaWYgKDAgPT09IHRoaXMubm9kZVN0YWNrLmxlbmd0aCkgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLm5vZGVTdGFja1t0aGlzLm5vZGVTdGFjay5sZW5ndGggLSAxXTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtleTogZS5rZXksXG4gICAgICAgICAgICB2YWx1ZTogZS52YWx1ZVxuICAgICAgICB9O1xuICAgIH1cbn1cblxuIC8vIGVuZCBTb3J0ZWRNYXBJdGVyYXRvclxuLy8gUmVwcmVzZW50cyBhIG5vZGUgaW4gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrIHRyZWUuXG5jbGFzcyBMTFJCTm9kZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICB0aGlzLmtleSA9IGUsIHRoaXMudmFsdWUgPSB0LCB0aGlzLmNvbG9yID0gbnVsbCAhPSBuID8gbiA6IExMUkJOb2RlLlJFRCwgdGhpcy5sZWZ0ID0gbnVsbCAhPSByID8gciA6IExMUkJOb2RlLkVNUFRZLCBcbiAgICAgICAgdGhpcy5yaWdodCA9IG51bGwgIT0gaSA/IGkgOiBMTFJCTm9kZS5FTVBUWSwgdGhpcy5zaXplID0gdGhpcy5sZWZ0LnNpemUgKyAxICsgdGhpcy5yaWdodC5zaXplO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgY3VycmVudCBub2RlLCBvcHRpb25hbGx5IHJlcGxhY2luZyBwaWVjZXMgb2YgaXQuXG4gICAgY29weShlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHJldHVybiBuZXcgTExSQk5vZGUobnVsbCAhPSBlID8gZSA6IHRoaXMua2V5LCBudWxsICE9IHQgPyB0IDogdGhpcy52YWx1ZSwgbnVsbCAhPSBuID8gbiA6IHRoaXMuY29sb3IsIG51bGwgIT0gciA/IHIgOiB0aGlzLmxlZnQsIG51bGwgIT0gaSA/IGkgOiB0aGlzLnJpZ2h0KTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIHRyZWUgaW4ga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvblxuICAgIC8vIGZvciBlYWNoIG5vZGUuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICBpbm9yZGVyVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5pbm9yZGVyVHJhdmVyc2FsKGUpIHx8IGUodGhpcy5rZXksIHRoaXMudmFsdWUpIHx8IHRoaXMucmlnaHQuaW5vcmRlclRyYXZlcnNhbChlKTtcbiAgICB9XG4gICAgLy8gVHJhdmVyc2VzIHRoZSB0cmVlIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvblxuICAgIC8vIGZ1bmN0aW9uIGZvciBlYWNoIG5vZGUuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICByZXZlcnNlVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmlnaHQucmV2ZXJzZVRyYXZlcnNhbChlKSB8fCBlKHRoaXMua2V5LCB0aGlzLnZhbHVlKSB8fCB0aGlzLmxlZnQucmV2ZXJzZVRyYXZlcnNhbChlKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWluaW11bSBub2RlIGluIHRoZSB0cmVlLlxuICAgIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5pc0VtcHR5KCkgPyB0aGlzIDogdGhpcy5sZWZ0Lm1pbigpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS5cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbigpLmtleTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWF4aW11bSBrZXkgaW4gdGhlIHRyZWUuXG4gICAgbWF4S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5pc0VtcHR5KCkgPyB0aGlzLmtleSA6IHRoaXMucmlnaHQubWF4S2V5KCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgbmV3IHRyZWUsIHdpdGggdGhlIGtleS92YWx1ZSBhZGRlZC5cbiAgICBpbnNlcnQoZSwgdCwgbikge1xuICAgICAgICBsZXQgciA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGkgPSBuKGUsIHIua2V5KTtcbiAgICAgICAgcmV0dXJuIHIgPSBpIDwgMCA/IHIuY29weShudWxsLCBudWxsLCBudWxsLCByLmxlZnQuaW5zZXJ0KGUsIHQsIG4pLCBudWxsKSA6IDAgPT09IGkgPyByLmNvcHkobnVsbCwgdCwgbnVsbCwgbnVsbCwgbnVsbCkgOiByLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgci5yaWdodC5pbnNlcnQoZSwgdCwgbikpLCBcbiAgICAgICAgci5maXhVcCgpO1xuICAgIH1cbiAgICByZW1vdmVNaW4oKSB7XG4gICAgICAgIGlmICh0aGlzLmxlZnQuaXNFbXB0eSgpKSByZXR1cm4gTExSQk5vZGUuRU1QVFk7XG4gICAgICAgIGxldCBlID0gdGhpcztcbiAgICAgICAgcmV0dXJuIGUubGVmdC5pc1JlZCgpIHx8IGUubGVmdC5sZWZ0LmlzUmVkKCkgfHwgKGUgPSBlLm1vdmVSZWRMZWZ0KCkpLCBlID0gZS5jb3B5KG51bGwsIG51bGwsIG51bGwsIGUubGVmdC5yZW1vdmVNaW4oKSwgbnVsbCksIFxuICAgICAgICBlLmZpeFVwKCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgbmV3IHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBpdGVtIHJlbW92ZWQuXG4gICAgcmVtb3ZlKGUsIHQpIHtcbiAgICAgICAgbGV0IG4sIHIgPSB0aGlzO1xuICAgICAgICBpZiAodChlLCByLmtleSkgPCAwKSByLmxlZnQuaXNFbXB0eSgpIHx8IHIubGVmdC5pc1JlZCgpIHx8IHIubGVmdC5sZWZ0LmlzUmVkKCkgfHwgKHIgPSByLm1vdmVSZWRMZWZ0KCkpLCBcbiAgICAgICAgciA9IHIuY29weShudWxsLCBudWxsLCBudWxsLCByLmxlZnQucmVtb3ZlKGUsIHQpLCBudWxsKTsgZWxzZSB7XG4gICAgICAgICAgICBpZiAoci5sZWZ0LmlzUmVkKCkgJiYgKHIgPSByLnJvdGF0ZVJpZ2h0KCkpLCByLnJpZ2h0LmlzRW1wdHkoKSB8fCByLnJpZ2h0LmlzUmVkKCkgfHwgci5yaWdodC5sZWZ0LmlzUmVkKCkgfHwgKHIgPSByLm1vdmVSZWRSaWdodCgpKSwgXG4gICAgICAgICAgICAwID09PSB0KGUsIHIua2V5KSkge1xuICAgICAgICAgICAgICAgIGlmIChyLnJpZ2h0LmlzRW1wdHkoKSkgcmV0dXJuIExMUkJOb2RlLkVNUFRZO1xuICAgICAgICAgICAgICAgIG4gPSByLnJpZ2h0Lm1pbigpLCByID0gci5jb3B5KG4ua2V5LCBuLnZhbHVlLCBudWxsLCBudWxsLCByLnJpZ2h0LnJlbW92ZU1pbigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHIgPSByLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgci5yaWdodC5yZW1vdmUoZSwgdCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByLmZpeFVwKCk7XG4gICAgfVxuICAgIGlzUmVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xvcjtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBuZXcgdHJlZSBhZnRlciBwZXJmb3JtaW5nIGFueSBuZWVkZWQgcm90YXRpb25zLlxuICAgIGZpeFVwKCkge1xuICAgICAgICBsZXQgZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBlLnJpZ2h0LmlzUmVkKCkgJiYgIWUubGVmdC5pc1JlZCgpICYmIChlID0gZS5yb3RhdGVMZWZ0KCkpLCBlLmxlZnQuaXNSZWQoKSAmJiBlLmxlZnQubGVmdC5pc1JlZCgpICYmIChlID0gZS5yb3RhdGVSaWdodCgpKSwgXG4gICAgICAgIGUubGVmdC5pc1JlZCgpICYmIGUucmlnaHQuaXNSZWQoKSAmJiAoZSA9IGUuY29sb3JGbGlwKCkpLCBlO1xuICAgIH1cbiAgICBtb3ZlUmVkTGVmdCgpIHtcbiAgICAgICAgbGV0IGUgPSB0aGlzLmNvbG9yRmxpcCgpO1xuICAgICAgICByZXR1cm4gZS5yaWdodC5sZWZ0LmlzUmVkKCkgJiYgKGUgPSBlLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgZS5yaWdodC5yb3RhdGVSaWdodCgpKSwgXG4gICAgICAgIGUgPSBlLnJvdGF0ZUxlZnQoKSwgZSA9IGUuY29sb3JGbGlwKCkpLCBlO1xuICAgIH1cbiAgICBtb3ZlUmVkUmlnaHQoKSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5jb2xvckZsaXAoKTtcbiAgICAgICAgcmV0dXJuIGUubGVmdC5sZWZ0LmlzUmVkKCkgJiYgKGUgPSBlLnJvdGF0ZVJpZ2h0KCksIGUgPSBlLmNvbG9yRmxpcCgpKSwgZTtcbiAgICB9XG4gICAgcm90YXRlTGVmdCgpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5SRUQsIG51bGwsIHRoaXMucmlnaHQubGVmdCk7XG4gICAgICAgIHJldHVybiB0aGlzLnJpZ2h0LmNvcHkobnVsbCwgbnVsbCwgdGhpcy5jb2xvciwgZSwgbnVsbCk7XG4gICAgfVxuICAgIHJvdGF0ZVJpZ2h0KCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5jb3B5KG51bGwsIG51bGwsIExMUkJOb2RlLlJFRCwgdGhpcy5sZWZ0LnJpZ2h0LCBudWxsKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5jb3B5KG51bGwsIG51bGwsIHRoaXMuY29sb3IsIG51bGwsIGUpO1xuICAgIH1cbiAgICBjb2xvckZsaXAoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmxlZnQuY29weShudWxsLCBudWxsLCAhdGhpcy5sZWZ0LmNvbG9yLCBudWxsLCBudWxsKSwgdCA9IHRoaXMucmlnaHQuY29weShudWxsLCBudWxsLCAhdGhpcy5yaWdodC5jb2xvciwgbnVsbCwgbnVsbCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNvcHkobnVsbCwgbnVsbCwgIXRoaXMuY29sb3IsIGUsIHQpO1xuICAgIH1cbiAgICAvLyBGb3IgdGVzdGluZy5cbiAgICBjaGVja01heERlcHRoKCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5jaGVjaygpO1xuICAgICAgICByZXR1cm4gTWF0aC5wb3coMiwgZSkgPD0gdGhpcy5zaXplICsgMTtcbiAgICB9XG4gICAgLy8gSW4gYSBiYWxhbmNlZCBSQiB0cmVlLCB0aGUgYmxhY2stZGVwdGggKG51bWJlciBvZiBibGFjayBub2RlcykgZnJvbSByb290IHRvXG4gICAgLy8gbGVhdmVzIGlzIGVxdWFsIG9uIGJvdGggc2lkZXMuICBUaGlzIGZ1bmN0aW9uIHZlcmlmaWVzIHRoYXQgb3IgYXNzZXJ0cy5cbiAgICBjaGVjaygpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNSZWQoKSAmJiB0aGlzLmxlZnQuaXNSZWQoKSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICBpZiAodGhpcy5yaWdodC5pc1JlZCgpKSB0aHJvdyBmYWlsKCk7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmxlZnQuY2hlY2soKTtcbiAgICAgICAgaWYgKGUgIT09IHRoaXMucmlnaHQuY2hlY2soKSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICByZXR1cm4gZSArICh0aGlzLmlzUmVkKCkgPyAwIDogMSk7XG4gICAgfVxufVxuXG4gLy8gZW5kIExMUkJOb2RlXG4vLyBFbXB0eSBub2RlIGlzIHNoYXJlZCBiZXR3ZWVuIGFsbCBMTFJCIHRyZWVzLlxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbkxMUkJOb2RlLkVNUFRZID0gbnVsbCwgTExSQk5vZGUuUkVEID0gITAsIExMUkJOb2RlLkJMQUNLID0gITE7XG5cbi8vIGVuZCBMTFJCRW1wdHlOb2RlXG5MTFJCTm9kZS5FTVBUWSA9IG5ldyBcbi8vIFJlcHJlc2VudHMgYW4gZW1wdHkgbm9kZSAoYSBsZWFmIG5vZGUgaW4gdGhlIFJlZC1CbGFjayBUcmVlKS5cbmNsYXNzIExMUkJFbXB0eU5vZGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnNpemUgPSAwO1xuICAgIH1cbiAgICBnZXQga2V5KCkge1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxuICAgIGdldCB2YWx1ZSgpIHtcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbiAgICBnZXQgY29sb3IoKSB7XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9XG4gICAgZ2V0IGxlZnQoKSB7XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9XG4gICAgZ2V0IHJpZ2h0KCkge1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IG5vZGUuXG4gICAgY29weShlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleS92YWx1ZSBhZGRlZC5cbiAgICBpbnNlcnQoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IExMUkJOb2RlKGUsIHQpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLlxuICAgIHJlbW92ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGlub3JkZXJUcmF2ZXJzYWwoZSkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIHJldmVyc2VUcmF2ZXJzYWwoZSkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIG1pbktleSgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIG1heEtleSgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlzUmVkKCkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIC8vIEZvciB0ZXN0aW5nLlxuICAgIGNoZWNrTWF4RGVwdGgoKSB7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgY2hlY2soKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNvcnRlZFNldCBpcyBhbiBpbW11dGFibGUgKGNvcHktb24td3JpdGUpIGNvbGxlY3Rpb24gdGhhdCBob2xkcyBlbGVtZW50c1xuICogaW4gb3JkZXIgc3BlY2lmaWVkIGJ5IHRoZSBwcm92aWRlZCBjb21wYXJhdG9yLlxuICpcbiAqIE5PVEU6IGlmIHByb3ZpZGVkIGNvbXBhcmF0b3IgcmV0dXJucyAwIGZvciB0d28gZWxlbWVudHMsIHdlIGNvbnNpZGVyIHRoZW0gdG9cbiAqIGJlIGVxdWFsIVxuICovXG5jbGFzcyBTb3J0ZWRTZXQge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5jb21wYXJhdG9yID0gZSwgdGhpcy5kYXRhID0gbmV3IFNvcnRlZE1hcCh0aGlzLmNvbXBhcmF0b3IpO1xuICAgIH1cbiAgICBoYXMoZSkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5kYXRhLmdldChlKTtcbiAgICB9XG4gICAgZmlyc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEubWluS2V5KCk7XG4gICAgfVxuICAgIGxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEubWF4S2V5KCk7XG4gICAgfVxuICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLnNpemU7XG4gICAgfVxuICAgIGluZGV4T2YoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmluZGV4T2YoZSk7XG4gICAgfVxuICAgIC8qKiBJdGVyYXRlcyBlbGVtZW50cyBpbiBvcmRlciBkZWZpbmVkIGJ5IFwiY29tcGFyYXRvclwiICovICAgIGZvckVhY2goZSkge1xuICAgICAgICB0aGlzLmRhdGEuaW5vcmRlclRyYXZlcnNhbCgoKHQsIG4pID0+IChlKHQpLCAhMSkpKTtcbiAgICB9XG4gICAgLyoqIEl0ZXJhdGVzIG92ZXIgYGVsZW1gcyBzdWNoIHRoYXQ6IHJhbmdlWzBdICZsdDs9IGVsZW0gJmx0OyByYW5nZVsxXS4gKi8gICAgZm9yRWFjaEluUmFuZ2UoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5kYXRhLmdldEl0ZXJhdG9yRnJvbShlWzBdKTtcbiAgICAgICAgZm9yICg7bi5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgciA9IG4uZ2V0TmV4dCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29tcGFyYXRvcihyLmtleSwgZVsxXSkgPj0gMCkgcmV0dXJuO1xuICAgICAgICAgICAgdChyLmtleSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBgZWxlbWBzIHN1Y2ggdGhhdDogc3RhcnQgJmx0Oz0gZWxlbSB1bnRpbCBmYWxzZSBpcyByZXR1cm5lZC5cbiAgICAgKi8gICAgZm9yRWFjaFdoaWxlKGUsIHQpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIGZvciAobiA9IHZvaWQgMCAhPT0gdCA/IHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20odCkgOiB0aGlzLmRhdGEuZ2V0SXRlcmF0b3IoKTsgbi5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgaWYgKCFlKG4uZ2V0TmV4dCgpLmtleSkpIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogRmluZHMgdGhlIGxlYXN0IGVsZW1lbnQgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGBlbGVtYC4gKi8gICAgZmlyc3RBZnRlck9yRXF1YWwoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5kYXRhLmdldEl0ZXJhdG9yRnJvbShlKTtcbiAgICAgICAgcmV0dXJuIHQuaGFzTmV4dCgpID8gdC5nZXROZXh0KCkua2V5IDogbnVsbDtcbiAgICB9XG4gICAgZ2V0SXRlcmF0b3IoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkU2V0SXRlcmF0b3IodGhpcy5kYXRhLmdldEl0ZXJhdG9yKCkpO1xuICAgIH1cbiAgICBnZXRJdGVyYXRvckZyb20oZSkge1xuICAgICAgICByZXR1cm4gbmV3IFNvcnRlZFNldEl0ZXJhdG9yKHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20oZSkpO1xuICAgIH1cbiAgICAvKiogSW5zZXJ0cyBvciB1cGRhdGVzIGFuIGVsZW1lbnQgKi8gICAgYWRkKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29weSh0aGlzLmRhdGEucmVtb3ZlKGUpLmluc2VydChlLCAhMCkpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlcyBhbiBlbGVtZW50ICovICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhcyhlKSA/IHRoaXMuY29weSh0aGlzLmRhdGEucmVtb3ZlKGUpKSA6IHRoaXM7XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuaXNFbXB0eSgpO1xuICAgIH1cbiAgICB1bmlvbldpdGgoZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIC8vIE1ha2Ugc3VyZSBgcmVzdWx0YCBhbHdheXMgcmVmZXJzIHRvIHRoZSBsYXJnZXIgb25lIG9mIHRoZSB0d28gc2V0cy5cbiAgICAgICAgICAgICAgICByZXR1cm4gdC5zaXplIDwgZS5zaXplICYmICh0ID0gZSwgZSA9IHRoaXMpLCBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdCA9IHQuYWRkKGUpO1xuICAgICAgICB9KSksIHQ7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgU29ydGVkU2V0KSkgcmV0dXJuICExO1xuICAgICAgICBpZiAodGhpcy5zaXplICE9PSBlLnNpemUpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZGF0YS5nZXRJdGVyYXRvcigpLCBuID0gZS5kYXRhLmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO3QuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmdldE5leHQoKS5rZXksIHIgPSBuLmdldE5leHQoKS5rZXk7XG4gICAgICAgICAgICBpZiAoMCAhPT0gdGhpcy5jb21wYXJhdG9yKGUsIHIpKSByZXR1cm4gITE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgZS5wdXNoKHQpO1xuICAgICAgICB9KSksIGU7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKHQgPT4gZS5wdXNoKHQpKSksIFwiU29ydGVkU2V0KFwiICsgZS50b1N0cmluZygpICsgXCIpXCI7XG4gICAgfVxuICAgIGNvcHkoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IFNvcnRlZFNldCh0aGlzLmNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gdC5kYXRhID0gZSwgdDtcbiAgICB9XG59XG5cbmNsYXNzIFNvcnRlZFNldEl0ZXJhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuaXRlciA9IGU7XG4gICAgfVxuICAgIGdldE5leHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZXIuZ2V0TmV4dCgpLmtleTtcbiAgICB9XG4gICAgaGFzTmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlci5oYXNOZXh0KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbXBhcmVzIHR3byBzb3J0ZWQgc2V0cyBmb3IgZXF1YWxpdHkgdXNpbmcgdGhlaXIgbmF0dXJhbCBvcmRlcmluZy4gVGhlXG4gKiBtZXRob2QgY29tcHV0ZXMgdGhlIGludGVyc2VjdGlvbiBhbmQgaW52b2tlcyBgb25BZGRgIGZvciBldmVyeSBlbGVtZW50IHRoYXRcbiAqIGlzIGluIGBhZnRlcmAgYnV0IG5vdCBgYmVmb3JlYC4gYG9uUmVtb3ZlYCBpcyBpbnZva2VkIGZvciBldmVyeSBlbGVtZW50IGluXG4gKiBgYmVmb3JlYCBidXQgbWlzc2luZyBmcm9tIGBhZnRlcmAuXG4gKlxuICogVGhlIG1ldGhvZCBjcmVhdGVzIGEgY29weSBvZiBib3RoIGBiZWZvcmVgIGFuZCBgYWZ0ZXJgIGFuZCBydW5zIGluIE8obiBsb2dcbiAqIG4pLCB3aGVyZSBuIGlzIHRoZSBzaXplIG9mIHRoZSB0d28gbGlzdHMuXG4gKlxuICogQHBhcmFtIGJlZm9yZSAtIFRoZSBlbGVtZW50cyB0aGF0IGV4aXN0IGluIHRoZSBvcmlnaW5hbCBzZXQuXG4gKiBAcGFyYW0gYWZ0ZXIgLSBUaGUgZWxlbWVudHMgdG8gZGlmZiBhZ2FpbnN0IHRoZSBvcmlnaW5hbCBzZXQuXG4gKiBAcGFyYW0gY29tcGFyYXRvciAtIFRoZSBjb21wYXJhdG9yIGZvciB0aGUgZWxlbWVudHMgaW4gYmVmb3JlIGFuZCBhZnRlci5cbiAqIEBwYXJhbSBvbkFkZCAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZiBgXG4gKiBhZnRlcmAgYnV0IG5vdCBgYmVmb3JlYC5cbiAqIEBwYXJhbSBvblJlbW92ZSAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZlxuICogYGJlZm9yZWAgYnV0IG5vdCBgYWZ0ZXJgLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIG5leHQgZWxlbWVudCBmcm9tIHRoZSBpdGVyYXRvciBvciBgdW5kZWZpbmVkYCBpZiBub25lIGF2YWlsYWJsZS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihlKSB7XG4gICAgcmV0dXJuIGUuaGFzTmV4dCgpID8gZS5nZXROZXh0KCkgOiB2b2lkIDA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFByb3ZpZGVzIGEgc2V0IG9mIGZpZWxkcyB0aGF0IGNhbiBiZSB1c2VkIHRvIHBhcnRpYWxseSBwYXRjaCBhIGRvY3VtZW50LlxuICogRmllbGRNYXNrIGlzIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCBPYmplY3RWYWx1ZS5cbiAqIEV4YW1wbGVzOlxuICogICBmb28gLSBPdmVyd3JpdGVzIGZvbyBlbnRpcmVseSB3aXRoIHRoZSBwcm92aWRlZCB2YWx1ZS4gSWYgZm9vIGlzIG5vdFxuICogICAgICAgICBwcmVzZW50IGluIHRoZSBjb21wYW5pb24gT2JqZWN0VmFsdWUsIHRoZSBmaWVsZCBpcyBkZWxldGVkLlxuICogICBmb28uYmFyIC0gT3ZlcndyaXRlcyBvbmx5IHRoZSBmaWVsZCBiYXIgb2YgdGhlIG9iamVjdCBmb28uXG4gKiAgICAgICAgICAgICBJZiBmb28gaXMgbm90IGFuIG9iamVjdCwgZm9vIGlzIHJlcGxhY2VkIHdpdGggYW4gb2JqZWN0XG4gKiAgICAgICAgICAgICBjb250YWluaW5nIGZvb1xuICovIGNsYXNzIEZpZWxkTWFzayB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmZpZWxkcyA9IGUsIFxuICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IHZhbGlkYXRpb24gb2YgRmllbGRNYXNrXG4gICAgICAgIC8vIFNvcnQgdGhlIGZpZWxkIG1hc2sgdG8gc3VwcG9ydCBgRmllbGRNYXNrLmlzRXF1YWwoKWAgYW5kIGFzc2VydCBiZWxvdy5cbiAgICAgICAgZS5zb3J0KEZpZWxkUGF0aCQxLmNvbXBhcmF0b3IpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRNYXNrKFtdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIG5ldyBGaWVsZE1hc2sgb2JqZWN0IHRoYXQgaXMgdGhlIHJlc3VsdCBvZiBhZGRpbmcgYWxsIHRoZSBnaXZlblxuICAgICAqIGZpZWxkcyBwYXRocyB0byB0aGlzIGZpZWxkIG1hc2suXG4gICAgICovICAgIHVuaW9uV2l0aChlKSB7XG4gICAgICAgIGxldCB0ID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuZmllbGRzKSB0ID0gdC5hZGQoZSk7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBlKSB0ID0gdC5hZGQobik7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRNYXNrKHQudG9BcnJheSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmVyaWZpZXMgdGhhdCBgZmllbGRQYXRoYCBpcyBpbmNsdWRlZCBieSBhdCBsZWFzdCBvbmUgZmllbGQgaW4gdGhpcyBmaWVsZFxuICAgICAqIG1hc2suXG4gICAgICpcbiAgICAgKiBUaGlzIGlzIGFuIE8obikgb3BlcmF0aW9uLCB3aGVyZSBgbmAgaXMgdGhlIHNpemUgb2YgdGhlIGZpZWxkIG1hc2suXG4gICAgICovICAgIGNvdmVycyhlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLmZpZWxkcykgaWYgKHQuaXNQcmVmaXhPZihlKSkgcmV0dXJuICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2FycmF5RXF1YWxzKHRoaXMuZmllbGRzLCBlLmZpZWxkcywgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGVycm9yIGVuY291bnRlcmVkIHdoaWxlIGRlY29kaW5nIGJhc2U2NCBzdHJpbmcuXG4gKi8gY2xhc3MgX19QUklWQVRFX0Jhc2U2NERlY29kZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpLCB0aGlzLm5hbWUgPSBcIkJhc2U2NERlY29kZUVycm9yXCI7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIENvbnZlcnRzIGEgQmFzZTY0IGVuY29kZWQgc3RyaW5nIHRvIGEgYmluYXJ5IHN0cmluZy4gKi9cbi8qKiBUcnVlIGlmIGFuZCBvbmx5IGlmIHRoZSBCYXNlNjQgY29udmVyc2lvbiBmdW5jdGlvbnMgYXJlIGF2YWlsYWJsZS4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc0Jhc2U2NEF2YWlsYWJsZSgpIHtcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgYXRvYjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW1tdXRhYmxlIGNsYXNzIHRoYXQgcmVwcmVzZW50cyBhIFwicHJvdG9cIiBieXRlIHN0cmluZy5cbiAqXG4gKiBQcm90byBieXRlIHN0cmluZ3MgY2FuIGVpdGhlciBiZSBCYXNlNjQtZW5jb2RlZCBzdHJpbmdzIG9yIFVpbnQ4QXJyYXlzIHdoZW5cbiAqIHNlbnQgb24gdGhlIHdpcmUuIFRoaXMgY2xhc3MgYWJzdHJhY3RzIGF3YXkgdGhpcyBkaWZmZXJlbnRpYXRpb24gYnkgaG9sZGluZ1xuICogdGhlIHByb3RvIGJ5dGUgc3RyaW5nIGluIGEgY29tbW9uIGNsYXNzIHRoYXQgbXVzdCBiZSBjb252ZXJ0ZWQgaW50byBhIHN0cmluZ1xuICogYmVmb3JlIGJlaW5nIHNlbnQgYXMgYSBwcm90by5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIEJ5dGVTdHJpbmcge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5iaW5hcnlTdHJpbmcgPSBlO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbUJhc2U2NFN0cmluZyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZGVjb2RlQmFzZTY0KGUpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0b2IoZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhhdCBgRE9NRXhjZXB0aW9uYCBpcyBkZWZpbmVkIGJlZm9yZSB1c2luZyBpdCB0byBhdm9pZFxuICAgICAgICAgICAgICAgIC8vIFwiUmVmZXJlbmNlRXJyb3I6IFByb3BlcnR5ICdET01FeGNlcHRpb24nIGRvZXNuJ3QgZXhpc3RcIiBpbiByZWFjdC1uYXRpdmUuXG4gICAgICAgICAgICAgICAgLy8gKGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvaXNzdWVzLzcxMTUpXG4gICAgICAgICAgICAgICAgdGhyb3cgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgRE9NRXhjZXB0aW9uICYmIGUgaW5zdGFuY2VvZiBET01FeGNlcHRpb24gPyBuZXcgX19QUklWQVRFX0Jhc2U2NERlY29kZUVycm9yKFwiSW52YWxpZCBiYXNlNjQgc3RyaW5nOiBcIiArIGUpIDogZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKiogQ29udmVydHMgYSBiaW5hcnkgc3RyaW5nIHRvIGEgQmFzZTY0IGVuY29kZWQgc3RyaW5nLiAqLyAoZSk7XG4gICAgICAgIHJldHVybiBuZXcgQnl0ZVN0cmluZyh0KTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21VaW50OEFycmF5KGUpIHtcbiAgICAgICAgLy8gVE9ETyhpbmRleGluZyk7IFJlbW92ZSB0aGUgY29weSBvZiB0aGUgYnl0ZSBzdHJpbmcgaGVyZSBhcyB0aGlzIG1ldGhvZFxuICAgICAgICAvLyBpcyBmcmVxdWVudGx5IGNhbGxlZCBkdXJpbmcgaW5kZXhpbmcuXG4gICAgICAgIGNvbnN0IHQgPSBcbiAgICAgICAgLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBhbiBVaW50OGFycmF5IHRvIGEgYmluYXJ5IHN0cmluZy5cbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfYmluYXJ5U3RyaW5nRnJvbVVpbnQ4QXJyYXkoZSkge1xuICAgICAgICAgICAgbGV0IHQgPSBcIlwiO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgKytuKSB0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZVtuXSk7XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjb252ZXJ0IGEgYmluYXJ5IHN0cmluZyB0byBhbiBVaW50OEFycmF5LlxuICovIChlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBCeXRlU3RyaW5nKHQpO1xuICAgIH1cbiAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgbGV0IGUgPSAwO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmV4dDogKCkgPT4gZSA8IHRoaXMuYmluYXJ5U3RyaW5nLmxlbmd0aCA/IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5iaW5hcnlTdHJpbmcuY2hhckNvZGVBdChlKyspLFxuICAgICAgICAgICAgICAgIGRvbmU6ICExXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB2b2lkIDAsXG4gICAgICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgdG9CYXNlNjQoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZW5jb2RlQmFzZTY0KGUpIHtcbiAgICAgICAgICAgIHJldHVybiBidG9hKGUpO1xuICAgICAgICB9KHRoaXMuYmluYXJ5U3RyaW5nKTtcbiAgICB9XG4gICAgdG9VaW50OEFycmF5KCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX3VpbnQ4QXJyYXlGcm9tQmluYXJ5U3RyaW5nKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgVWludDhBcnJheShlLmxlbmd0aCk7XG4gICAgICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHRbbl0gPSBlLmNoYXJDb2RlQXQobik7XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgICAgICAvLyBBIFJlZ0V4cCBtYXRjaGluZyBJU08gODYwMSBVVEMgdGltZXN0YW1wcyB3aXRoIG9wdGlvbmFsIGZyYWN0aW9uLlxuICAgICAgICAodGhpcy5iaW5hcnlTdHJpbmcpO1xuICAgIH1cbiAgICBhcHByb3hpbWF0ZUJ5dGVTaXplKCkge1xuICAgICAgICByZXR1cm4gMiAqIHRoaXMuYmluYXJ5U3RyaW5nLmxlbmd0aDtcbiAgICB9XG4gICAgY29tcGFyZVRvKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHRoaXMuYmluYXJ5U3RyaW5nLCBlLmJpbmFyeVN0cmluZyk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iaW5hcnlTdHJpbmcgPT09IGUuYmluYXJ5U3RyaW5nO1xuICAgIH1cbn1cblxuQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklORyA9IG5ldyBCeXRlU3RyaW5nKFwiXCIpO1xuXG5jb25zdCBuZSA9IG5ldyBSZWdFeHAoL15cXGR7NH0tXFxkXFxkLVxcZFxcZFRcXGRcXGQ6XFxkXFxkOlxcZFxcZCg/OlxcLihcXGQrKSk/WiQvKTtcblxuLyoqXG4gKiBDb252ZXJ0cyB0aGUgcG9zc2libGUgUHJvdG8gdmFsdWVzIGZvciBhIHRpbWVzdGFtcCB2YWx1ZSBpbnRvIGEgXCJzZWNvbmRzIGFuZFxuICogbmFub3NcIiByZXByZXNlbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpIHtcbiAgICAvLyBUaGUganNvbiBpbnRlcmZhY2UgKGZvciB0aGUgYnJvd3Nlcikgd2lsbCByZXR1cm4gYW4gaXNvIHRpbWVzdGFtcCBzdHJpbmcsXG4gICAgLy8gd2hpbGUgdGhlIHByb3RvIGpzIGxpYnJhcnkgKGZvciBub2RlKSB3aWxsIHJldHVybiBhXG4gICAgLy8gZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCBpbnN0YW5jZS5cbiAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoISFlKSwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSkge1xuICAgICAgICAvLyBUaGUgZGF0ZSBzdHJpbmcgY2FuIGhhdmUgaGlnaGVyIHByZWNpc2lvbiAobmFub3MpIHRoYW4gdGhlIERhdGUgY2xhc3NcbiAgICAgICAgLy8gKG1pbGxpcyksIHNvIHdlIGRvIHNvbWUgY3VzdG9tIHBhcnNpbmcgaGVyZS5cbiAgICAgICAgLy8gUGFyc2UgdGhlIG5hbm9zIHJpZ2h0IG91dCBvZiB0aGUgc3RyaW5nLlxuICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgIGNvbnN0IG4gPSBuZS5leGVjKGUpO1xuICAgICAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoISFuKSwgblsxXSkge1xuICAgICAgICAgICAgLy8gUGFkIHRoZSBmcmFjdGlvbiBvdXQgdG8gOSBkaWdpdHMgKG5hbm9zKS5cbiAgICAgICAgICAgIGxldCBlID0gblsxXTtcbiAgICAgICAgICAgIGUgPSAoZSArIFwiMDAwMDAwMDAwXCIpLnN1YnN0cigwLCA5KSwgdCA9IE51bWJlcihlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBQYXJzZSB0aGUgZGF0ZSB0byBnZXQgdGhlIHNlY29uZHMuXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG5ldyBEYXRlKGUpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2Vjb25kczogTWF0aC5mbG9vcihyLmdldFRpbWUoKSAvIDFlMyksXG4gICAgICAgICAgICBuYW5vczogdFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzZWNvbmRzOiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuc2Vjb25kcyksXG4gICAgICAgIG5hbm9zOiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubmFub3MpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyB0aGUgcG9zc2libGUgUHJvdG8gdHlwZXMgZm9yIG51bWJlcnMgaW50byBhIEphdmFTY3JpcHQgbnVtYmVyLlxuICogUmV0dXJucyAwIGlmIHRoZSB2YWx1ZSBpcyBub3QgbnVtZXJpYy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUpIHtcbiAgICAvLyBUT0RPKGJqb3JuaWNrKTogSGFuZGxlIGludDY0IGdyZWF0ZXIgdGhhbiA1MyBiaXRzLlxuICAgIHJldHVybiBcIm51bWJlclwiID09IHR5cGVvZiBlID8gZSA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBOdW1iZXIoZSkgOiAwO1xufVxuXG4vKiogQ29udmVydHMgdGhlIHBvc3NpYmxlIFByb3RvIHR5cGVzIGZvciBCbG9icyBpbnRvIGEgQnl0ZVN0cmluZy4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcoZSkge1xuICAgIHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gQnl0ZVN0cmluZy5mcm9tQmFzZTY0U3RyaW5nKGUpIDogQnl0ZVN0cmluZy5mcm9tVWludDhBcnJheShlKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGxvY2FsbHktYXBwbGllZCBTZXJ2ZXJUaW1lc3RhbXAuXG4gKlxuICogU2VydmVyIFRpbWVzdGFtcHMgYXJlIGJhY2tlZCBieSBNYXBWYWx1ZXMgdGhhdCBjb250YWluIGFuIGludGVybmFsIGZpZWxkXG4gKiBgX190eXBlX19gIHdpdGggYSB2YWx1ZSBvZiBgc2VydmVyX3RpbWVzdGFtcGAuIFRoZSBwcmV2aW91cyB2YWx1ZSBhbmQgbG9jYWxcbiAqIHdyaXRlIHRpbWUgYXJlIHN0b3JlZCBpbiBpdHMgYF9fcHJldmlvdXNfdmFsdWVfX2AgYW5kIGBfX2xvY2FsX3dyaXRlX3RpbWVfX2BcbiAqIGZpZWxkcyByZXNwZWN0aXZlbHkuXG4gKlxuICogTm90ZXM6XG4gKiAtIFNlcnZlclRpbWVzdGFtcFZhbHVlIGluc3RhbmNlcyBhcmUgY3JlYXRlZCBhcyB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGFcbiAqICAgdHJhbnNmb3JtLiBUaGV5IGNhbiBvbmx5IGV4aXN0IGluIHRoZSBsb2NhbCB2aWV3IG9mIGEgZG9jdW1lbnQuIFRoZXJlZm9yZVxuICogICB0aGV5IGRvIG5vdCBuZWVkIHRvIGJlIHBhcnNlZCBvciBzZXJpYWxpemVkLlxuICogLSBXaGVuIGV2YWx1YXRlZCBsb2NhbGx5IChlLmcuIGZvciBzbmFwc2hvdC5kYXRhKCkpLCB0aGV5IGJ5IGRlZmF1bHRcbiAqICAgZXZhbHVhdGUgdG8gYG51bGxgLiBUaGlzIGJlaGF2aW9yIGNhbiBiZSBjb25maWd1cmVkIGJ5IHBhc3NpbmcgY3VzdG9tXG4gKiAgIEZpZWxkVmFsdWVPcHRpb25zIHRvIHZhbHVlKCkuXG4gKiAtIFdpdGggcmVzcGVjdCB0byBvdGhlciBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZXMsIHRoZXkgc29ydCBieSB0aGVpclxuICogICBsb2NhbFdyaXRlVGltZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNTZXJ2ZXJUaW1lc3RhbXAoZSkge1xuICAgIHZhciB0LCBuO1xuICAgIHJldHVybiBcInNlcnZlcl90aW1lc3RhbXBcIiA9PT0gKG51bGwgPT09IChuID0gKChudWxsID09PSAodCA9IG51bGwgPT0gZSA/IHZvaWQgMCA6IGUubWFwVmFsdWUpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuZmllbGRzKSB8fCB7fSkuX190eXBlX18pIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uc3RyaW5nVmFsdWUpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgU2VydmVyVGltZXN0YW1wIHByb3RvIHZhbHVlICh1c2luZyB0aGUgaW50ZXJuYWwgZm9ybWF0KS5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQgYmVmb3JlIHRoaXMgU2VydmVyVGltZXN0YW1wIHdhcyBzZXQuXG4gKlxuICogUHJlc2VydmluZyB0aGUgcHJldmlvdXMgdmFsdWVzIGFsbG93cyB0aGUgdXNlciB0byBkaXNwbGF5IHRoZSBsYXN0IHJlc29sZWRcbiAqIHZhbHVlIHVudGlsIHRoZSBiYWNrZW5kIHJlc3BvbmRzIHdpdGggdGhlIHRpbWVzdGFtcC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUoZSkge1xuICAgIGNvbnN0IHQgPSBlLm1hcFZhbHVlLmZpZWxkcy5fX3ByZXZpb3VzX3ZhbHVlX187XG4gICAgcmV0dXJuIF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcCh0KSA/IF9fUFJJVkFURV9nZXRQcmV2aW91c1ZhbHVlKHQpIDogdDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsb2NhbCB0aW1lIGF0IHdoaWNoIHRoaXMgdGltZXN0YW1wIHdhcyBmaXJzdCBzZXQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2dldExvY2FsV3JpdGVUaW1lKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlLm1hcFZhbHVlLmZpZWxkcy5fX2xvY2FsX3dyaXRlX3RpbWVfXy50aW1lc3RhbXBWYWx1ZSk7XG4gICAgcmV0dXJuIG5ldyBUaW1lc3RhbXAodC5zZWNvbmRzLCB0Lm5hbm9zKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgRGF0YWJhc2VJbmZvIHtcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIGEgRGF0YWJhc2VJbmZvIHVzaW5nIHRoZSBwcm92aWRlZCBob3N0LCBkYXRhYmFzZUlkIGFuZFxuICAgICAqIHBlcnNpc3RlbmNlS2V5LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgZGF0YWJhc2UgdG8gdXNlLlxuICAgICAqIEBwYXJhbSBhcHBJZCAtIFRoZSBGaXJlYmFzZSBBcHAgSWQuXG4gICAgICogQHBhcmFtIHBlcnNpc3RlbmNlS2V5IC0gQSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhpcyBGaXJlc3RvcmUncyBsb2NhbFxuICAgICAqIHN0b3JhZ2UgKHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCB0aGUgZGF0YWJhc2VJZCkuXG4gICAgICogQHBhcmFtIGhvc3QgLSBUaGUgRmlyZXN0b3JlIGJhY2tlbmQgaG9zdCB0byBjb25uZWN0IHRvLlxuICAgICAqIEBwYXJhbSBzc2wgLSBXaGV0aGVyIHRvIHVzZSBTU0wgd2hlbiBjb25uZWN0aW5nLlxuICAgICAqIEBwYXJhbSBmb3JjZUxvbmdQb2xsaW5nIC0gV2hldGhlciB0byB1c2UgdGhlIGZvcmNlTG9uZ1BvbGxpbmcgb3B0aW9uXG4gICAgICogd2hlbiB1c2luZyBXZWJDaGFubmVsIGFzIHRoZSBuZXR3b3JrIHRyYW5zcG9ydC5cbiAgICAgKiBAcGFyYW0gYXV0b0RldGVjdExvbmdQb2xsaW5nIC0gV2hldGhlciB0byB1c2UgdGhlIGRldGVjdEJ1ZmZlcmluZ1Byb3h5XG4gICAgICogb3B0aW9uIHdoZW4gdXNpbmcgV2ViQ2hhbm5lbCBhcyB0aGUgbmV0d29yayB0cmFuc3BvcnQuXG4gICAgICogQHBhcmFtIGxvbmdQb2xsaW5nT3B0aW9ucyBPcHRpb25zIHRoYXQgY29uZmlndXJlIGxvbmctcG9sbGluZy5cbiAgICAgKiBAcGFyYW0gdXNlRmV0Y2hTdHJlYW1zIFdoZXRoZXIgdG8gdXNlIHRoZSBGZXRjaCBBUEkgaW5zdGVhZCBvZlxuICAgICAqIFhNTEhUVFBSZXF1ZXN0XG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbywgXywgYSkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlSWQgPSBlLCB0aGlzLmFwcElkID0gdCwgdGhpcy5wZXJzaXN0ZW5jZUtleSA9IG4sIHRoaXMuaG9zdCA9IHIsIHRoaXMuc3NsID0gaSwgXG4gICAgICAgIHRoaXMuZm9yY2VMb25nUG9sbGluZyA9IHMsIHRoaXMuYXV0b0RldGVjdExvbmdQb2xsaW5nID0gbywgdGhpcy5sb25nUG9sbGluZ09wdGlvbnMgPSBfLCBcbiAgICAgICAgdGhpcy51c2VGZXRjaFN0cmVhbXMgPSBhO1xuICAgIH1cbn1cblxuLyoqIFRoZSBkZWZhdWx0IGRhdGFiYXNlIG5hbWUgZm9yIGEgcHJvamVjdC4gKi9cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgZGF0YWJhc2UgSUQgYSBGaXJlc3RvcmUgY2xpZW50IGlzIGFzc29jaWF0ZWQgd2l0aC5cbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBEYXRhYmFzZUlkIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMucHJvamVjdElkID0gZSwgdGhpcy5kYXRhYmFzZSA9IHQgfHwgXCIoZGVmYXVsdClcIjtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGFiYXNlSWQoXCJcIiwgXCJcIik7XG4gICAgfVxuICAgIGdldCBpc0RlZmF1bHREYXRhYmFzZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiKGRlZmF1bHQpXCIgPT09IHRoaXMuZGF0YWJhc2U7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIERhdGFiYXNlSWQgJiYgZS5wcm9qZWN0SWQgPT09IHRoaXMucHJvamVjdElkICYmIGUuZGF0YWJhc2UgPT09IHRoaXMuZGF0YWJhc2U7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgcmUgPSB7XG4gICAgbWFwVmFsdWU6IHtcbiAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICBfX3R5cGVfXzoge1xuICAgICAgICAgICAgICAgIHN0cmluZ1ZhbHVlOiBcIl9fbWF4X19cIlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSwgaWUgPSB7XG4gICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxufTtcblxuLyoqIEV4dHJhY3RzIHRoZSBiYWNrZW5kJ3MgdHlwZSBvcmRlciBmb3IgdGhlIHByb3ZpZGVkIHZhbHVlLiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3R5cGVPcmRlcihlKSB7XG4gICAgcmV0dXJuIFwibnVsbFZhbHVlXCIgaW4gZSA/IDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6IFwiYm9vbGVhblZhbHVlXCIgaW4gZSA/IDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6IFwiaW50ZWdlclZhbHVlXCIgaW4gZSB8fCBcImRvdWJsZVZhbHVlXCIgaW4gZSA/IDIgLyogVHlwZU9yZGVyLk51bWJlclZhbHVlICovIDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUgPyAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6IFwic3RyaW5nVmFsdWVcIiBpbiBlID8gNSAvKiBUeXBlT3JkZXIuU3RyaW5nVmFsdWUgKi8gOiBcImJ5dGVzVmFsdWVcIiBpbiBlID8gNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDogXCJyZWZlcmVuY2VWYWx1ZVwiIGluIGUgPyA3IC8qIFR5cGVPcmRlci5SZWZWYWx1ZSAqLyA6IFwiZ2VvUG9pbnRWYWx1ZVwiIGluIGUgPyA4IC8qIFR5cGVPcmRlci5HZW9Qb2ludFZhbHVlICovIDogXCJhcnJheVZhbHVlXCIgaW4gZSA/IDkgLyogVHlwZU9yZGVyLkFycmF5VmFsdWUgKi8gOiBcIm1hcFZhbHVlXCIgaW4gZSA/IF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcChlKSA/IDQgLyogVHlwZU9yZGVyLlNlcnZlclRpbWVzdGFtcFZhbHVlICovIDogX19QUklWQVRFX2lzTWF4VmFsdWUoZSkgPyA5MDA3MTk5MjU0NzQwOTkxIC8qIFR5cGVPcmRlci5NYXhWYWx1ZSAqLyA6IF9fUFJJVkFURV9pc1ZlY3RvclZhbHVlKGUpID8gMTAgLyogVHlwZU9yZGVyLlZlY3RvclZhbHVlICovIDogMTEgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDogZmFpbCgpO1xufVxuXG4vKiogVGVzdHMgYGxlZnRgIGFuZCBgcmlnaHRgIGZvciBlcXVhbGl0eSBiYXNlZCBvbiB0aGUgYmFja2VuZCBzZW1hbnRpY3MuICovIGZ1bmN0aW9uIF9fUFJJVkFURV92YWx1ZUVxdWFscyhlLCB0KSB7XG4gICAgaWYgKGUgPT09IHQpIHJldHVybiAhMDtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX3R5cGVPcmRlcihlKTtcbiAgICBpZiAobiAhPT0gX19QUklWQVRFX3R5cGVPcmRlcih0KSkgcmV0dXJuICExO1xuICAgIHN3aXRjaCAobikge1xuICAgICAgY2FzZSAwIC8qIFR5cGVPcmRlci5OdWxsVmFsdWUgKi8gOlxuICAgICAgY2FzZSA5MDA3MTk5MjU0NzQwOTkxIC8qIFR5cGVPcmRlci5NYXhWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiAhMDtcblxuICAgICAgY2FzZSAxIC8qIFR5cGVPcmRlci5Cb29sZWFuVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZS5ib29sZWFuVmFsdWUgPT09IHQuYm9vbGVhblZhbHVlO1xuXG4gICAgICBjYXNlIDQgLyogVHlwZU9yZGVyLlNlcnZlclRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9nZXRMb2NhbFdyaXRlVGltZShlKS5pc0VxdWFsKF9fUFJJVkFURV9nZXRMb2NhbFdyaXRlVGltZSh0KSk7XG5cbiAgICAgIGNhc2UgMyAvKiBUeXBlT3JkZXIuVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX3RpbWVzdGFtcEVxdWFscyhlLCB0KSB7XG4gICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZS50aW1lc3RhbXBWYWx1ZSAmJiBcInN0cmluZ1wiID09IHR5cGVvZiB0LnRpbWVzdGFtcFZhbHVlICYmIGUudGltZXN0YW1wVmFsdWUubGVuZ3RoID09PSB0LnRpbWVzdGFtcFZhbHVlLmxlbmd0aCkgXG4gICAgICAgICAgICAvLyBVc2Ugc3RyaW5nIGVxdWFsaXR5IGZvciBJU08gODYwMSB0aW1lc3RhbXBzXG4gICAgICAgICAgICByZXR1cm4gZS50aW1lc3RhbXBWYWx1ZSA9PT0gdC50aW1lc3RhbXBWYWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUudGltZXN0YW1wVmFsdWUpLCByID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcCh0LnRpbWVzdGFtcFZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybiBuLnNlY29uZHMgPT09IHIuc2Vjb25kcyAmJiBuLm5hbm9zID09PSByLm5hbm9zO1xuICAgICAgICB9KGUsIHQpO1xuXG4gICAgICBjYXNlIDUgLyogVHlwZU9yZGVyLlN0cmluZ1ZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGUuc3RyaW5nVmFsdWUgPT09IHQuc3RyaW5nVmFsdWU7XG5cbiAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9ibG9iRXF1YWxzKGUsIHQpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyhlLmJ5dGVzVmFsdWUpLmlzRXF1YWwoX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcodC5ieXRlc1ZhbHVlKSk7XG4gICAgICAgIH0oZSwgdCk7XG5cbiAgICAgIGNhc2UgNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZS5yZWZlcmVuY2VWYWx1ZSA9PT0gdC5yZWZlcmVuY2VWYWx1ZTtcblxuICAgICAgY2FzZSA4IC8qIFR5cGVPcmRlci5HZW9Qb2ludFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9nZW9Qb2ludEVxdWFscyhlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmdlb1BvaW50VmFsdWUubGF0aXR1ZGUpID09PSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKHQuZ2VvUG9pbnRWYWx1ZS5sYXRpdHVkZSkgJiYgX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmdlb1BvaW50VmFsdWUubG9uZ2l0dWRlKSA9PT0gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0Lmdlb1BvaW50VmFsdWUubG9uZ2l0dWRlKTtcbiAgICAgICAgfShlLCB0KTtcblxuICAgICAgY2FzZSAyIC8qIFR5cGVPcmRlci5OdW1iZXJWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbnVtYmVyRXF1YWxzKGUsIHQpIHtcbiAgICAgICAgICAgIGlmIChcImludGVnZXJWYWx1ZVwiIGluIGUgJiYgXCJpbnRlZ2VyVmFsdWVcIiBpbiB0KSByZXR1cm4gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmludGVnZXJWYWx1ZSkgPT09IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIodC5pbnRlZ2VyVmFsdWUpO1xuICAgICAgICAgICAgaWYgKFwiZG91YmxlVmFsdWVcIiBpbiBlICYmIFwiZG91YmxlVmFsdWVcIiBpbiB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5kb3VibGVWYWx1ZSksIHIgPSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKHQuZG91YmxlVmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuID09PSByID8gX19QUklWQVRFX2lzTmVnYXRpdmVaZXJvKG4pID09PSBfX1BSSVZBVEVfaXNOZWdhdGl2ZVplcm8ocikgOiBpc05hTihuKSAmJiBpc05hTihyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgfShlLCB0KTtcblxuICAgICAgY2FzZSA5IC8qIFR5cGVPcmRlci5BcnJheVZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9hcnJheUVxdWFscyhlLmFycmF5VmFsdWUudmFsdWVzIHx8IFtdLCB0LmFycmF5VmFsdWUudmFsdWVzIHx8IFtdLCBfX1BSSVZBVEVfdmFsdWVFcXVhbHMpO1xuXG4gICAgICBjYXNlIDEwIC8qIFR5cGVPcmRlci5WZWN0b3JWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDExIC8qIFR5cGVPcmRlci5PYmplY3RWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfb2JqZWN0RXF1YWxzKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLm1hcFZhbHVlLmZpZWxkcyB8fCB7fSwgciA9IHQubWFwVmFsdWUuZmllbGRzIHx8IHt9O1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9vYmplY3RTaXplKG4pICE9PSBfX1BSSVZBVEVfb2JqZWN0U2l6ZShyKSkgcmV0dXJuICExO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIGluIG4pIGlmIChuLmhhc093blByb3BlcnR5KGUpICYmICh2b2lkIDAgPT09IHJbZV0gfHwgIV9fUFJJVkFURV92YWx1ZUVxdWFscyhuW2VdLCByW2VdKSkpIHJldHVybiAhMTtcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmV0dXJucyB0cnVlIGlmIHRoZSBBcnJheVZhbHVlIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgZWxlbWVudC4gKi8gKGUsIHQpO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyhlLCB0KSB7XG4gICAgcmV0dXJuIHZvaWQgMCAhPT0gKGUudmFsdWVzIHx8IFtdKS5maW5kKChlID0+IF9fUFJJVkFURV92YWx1ZUVxdWFscyhlLCB0KSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKGUsIHQpIHtcbiAgICBpZiAoZSA9PT0gdCkgcmV0dXJuIDA7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV90eXBlT3JkZXIoZSksIHIgPSBfX1BSSVZBVEVfdHlwZU9yZGVyKHQpO1xuICAgIGlmIChuICE9PSByKSByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3Iobiwgcik7XG4gICAgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDkwMDcxOTkyNTQ3NDA5OTEgLyogVHlwZU9yZGVyLk1heFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIDA7XG5cbiAgICAgIGNhc2UgMSAvKiBUeXBlT3JkZXIuQm9vbGVhblZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUuYm9vbGVhblZhbHVlLCB0LmJvb2xlYW5WYWx1ZSk7XG5cbiAgICAgIGNhc2UgMiAvKiBUeXBlT3JkZXIuTnVtYmVyVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVOdW1iZXJzKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuaW50ZWdlclZhbHVlIHx8IGUuZG91YmxlVmFsdWUpLCByID0gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0LmludGVnZXJWYWx1ZSB8fCB0LmRvdWJsZVZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybiBuIDwgciA/IC0xIDogbiA+IHIgPyAxIDogbiA9PT0gciA/IDAgOiBcbiAgICAgICAgICAgIC8vIG9uZSBvciBib3RoIGFyZSBOYU4uXG4gICAgICAgICAgICBpc05hTihuKSA/IGlzTmFOKHIpID8gMCA6IC0xIDogMTtcbiAgICAgICAgfShlLCB0KTtcblxuICAgICAgY2FzZSAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfY29tcGFyZVRpbWVzdGFtcHMoZS50aW1lc3RhbXBWYWx1ZSwgdC50aW1lc3RhbXBWYWx1ZSk7XG5cbiAgICAgIGNhc2UgNCAvKiBUeXBlT3JkZXIuU2VydmVyVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NvbXBhcmVUaW1lc3RhbXBzKF9fUFJJVkFURV9nZXRMb2NhbFdyaXRlVGltZShlKSwgX19QUklWQVRFX2dldExvY2FsV3JpdGVUaW1lKHQpKTtcblxuICAgICAgY2FzZSA1IC8qIFR5cGVPcmRlci5TdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLnN0cmluZ1ZhbHVlLCB0LnN0cmluZ1ZhbHVlKTtcblxuICAgICAgY2FzZSA2IC8qIFR5cGVPcmRlci5CbG9iVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVCbG9icyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcoZSksIHIgPSBfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyh0KTtcbiAgICAgICAgICAgIHJldHVybiBuLmNvbXBhcmVUbyhyKTtcbiAgICAgICAgfShlLmJ5dGVzVmFsdWUsIHQuYnl0ZXNWYWx1ZSk7XG5cbiAgICAgIGNhc2UgNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVSZWZlcmVuY2VzKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLnNwbGl0KFwiL1wiKSwgciA9IHQuc3BsaXQoXCIvXCIpO1xuICAgICAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCBuLmxlbmd0aCAmJiBlIDwgci5sZW5ndGg7IGUrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuW2VdLCByW2VdKTtcbiAgICAgICAgICAgICAgICBpZiAoMCAhPT0gdCkgcmV0dXJuIHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3Iobi5sZW5ndGgsIHIubGVuZ3RoKTtcbiAgICAgICAgfShlLnJlZmVyZW5jZVZhbHVlLCB0LnJlZmVyZW5jZVZhbHVlKTtcblxuICAgICAgY2FzZSA4IC8qIFR5cGVPcmRlci5HZW9Qb2ludFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlR2VvUG9pbnRzKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubGF0aXR1ZGUpLCBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKHQubGF0aXR1ZGUpKTtcbiAgICAgICAgICAgIGlmICgwICE9PSBuKSByZXR1cm4gbjtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubG9uZ2l0dWRlKSwgX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0LmxvbmdpdHVkZSkpO1xuICAgICAgICB9KGUuZ2VvUG9pbnRWYWx1ZSwgdC5nZW9Qb2ludFZhbHVlKTtcblxuICAgICAgY2FzZSA5IC8qIFR5cGVPcmRlci5BcnJheVZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wYXJlQXJyYXlzKGUuYXJyYXlWYWx1ZSwgdC5hcnJheVZhbHVlKTtcblxuICAgICAgY2FzZSAxMCAvKiBUeXBlT3JkZXIuVmVjdG9yVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVWZWN0b3JzKGUsIHQpIHtcbiAgICAgICAgICAgIHZhciBuLCByLCBpLCBzO1xuICAgICAgICAgICAgY29uc3QgbyA9IGUuZmllbGRzIHx8IHt9LCBfID0gdC5maWVsZHMgfHwge30sIGEgPSBudWxsID09PSAobiA9IG8udmFsdWUpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uYXJyYXlWYWx1ZSwgdSA9IG51bGwgPT09IChyID0gXy52YWx1ZSkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5hcnJheVZhbHVlLCBjID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoKG51bGwgPT09IChpID0gbnVsbCA9PSBhID8gdm9pZCAwIDogYS52YWx1ZXMpIHx8IHZvaWQgMCA9PT0gaSA/IHZvaWQgMCA6IGkubGVuZ3RoKSB8fCAwLCAobnVsbCA9PT0gKHMgPSBudWxsID09IHUgPyB2b2lkIDAgOiB1LnZhbHVlcykgfHwgdm9pZCAwID09PSBzID8gdm9pZCAwIDogcy5sZW5ndGgpIHx8IDApO1xuICAgICAgICAgICAgaWYgKDAgIT09IGMpIHJldHVybiBjO1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wYXJlQXJyYXlzKGEsIHUpO1xuICAgICAgICB9KGUubWFwVmFsdWUsIHQubWFwVmFsdWUpO1xuXG4gICAgICBjYXNlIDExIC8qIFR5cGVPcmRlci5PYmplY3RWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZU1hcHMoZSwgdCkge1xuICAgICAgICAgICAgaWYgKGUgPT09IHJlLm1hcFZhbHVlICYmIHQgPT09IHJlLm1hcFZhbHVlKSByZXR1cm4gMDtcbiAgICAgICAgICAgIGlmIChlID09PSByZS5tYXBWYWx1ZSkgcmV0dXJuIDE7XG4gICAgICAgICAgICBpZiAodCA9PT0gcmUubWFwVmFsdWUpIHJldHVybiAtMTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmZpZWxkcyB8fCB7fSwgciA9IE9iamVjdC5rZXlzKG4pLCBpID0gdC5maWVsZHMgfHwge30sIHMgPSBPYmplY3Qua2V5cyhpKTtcbiAgICAgICAgICAgIC8vIEV2ZW4gdGhvdWdoIE1hcFZhbHVlcyBhcmUgbGlrZWx5IHNvcnRlZCBjb3JyZWN0bHkgYmFzZWQgb24gdGhlaXIgaW5zZXJ0aW9uXG4gICAgICAgICAgICAvLyBvcmRlciAoZS5nLiB3aGVuIHJlY2VpdmVkIGZyb20gdGhlIGJhY2tlbmQpLCBsb2NhbCBtb2RpZmljYXRpb25zIGNhbiBicmluZ1xuICAgICAgICAgICAgLy8gZWxlbWVudHMgb3V0IG9mIG9yZGVyLiBXZSBuZWVkIHRvIHJlLXNvcnQgdGhlIGVsZW1lbnRzIHRvIGVuc3VyZSB0aGF0XG4gICAgICAgICAgICAvLyBjYW5vbmljYWwgSURzIGFyZSBpbmRlcGVuZGVudCBvZiBpbnNlcnRpb24gb3JkZXIuXG4gICAgICAgICAgICByLnNvcnQoKSwgcy5zb3J0KCk7XG4gICAgICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHIubGVuZ3RoICYmIGUgPCBzLmxlbmd0aDsgKytlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHJbZV0sIHNbZV0pO1xuICAgICAgICAgICAgICAgIGlmICgwICE9PSB0KSByZXR1cm4gdDtcbiAgICAgICAgICAgICAgICBjb25zdCBvID0gX19QUklWQVRFX3ZhbHVlQ29tcGFyZShuW3JbZV1dLCBpW3NbZV1dKTtcbiAgICAgICAgICAgICAgICBpZiAoMCAhPT0gbykgcmV0dXJuIG87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3Ioci5sZW5ndGgsIHMubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEdlbmVyYXRlcyB0aGUgY2Fub25pY2FsIElEIGZvciB0aGUgcHJvdmlkZWQgZmllbGQgdmFsdWUgKGFzIHVzZWQgaW4gVGFyZ2V0XG4gKiBzZXJpYWxpemF0aW9uKS5cbiAqLyAoZS5tYXBWYWx1ZSwgdC5tYXBWYWx1ZSk7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlVGltZXN0YW1wcyhlLCB0KSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCAmJiBlLmxlbmd0aCA9PT0gdC5sZW5ndGgpIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLCB0KTtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlKSwgciA9IF9fUFJJVkFURV9ub3JtYWxpemVUaW1lc3RhbXAodCksIGkgPSBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuLnNlY29uZHMsIHIuc2Vjb25kcyk7XG4gICAgcmV0dXJuIDAgIT09IGkgPyBpIDogX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3Iobi5uYW5vcywgci5uYW5vcyk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlQXJyYXlzKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZS52YWx1ZXMgfHwgW10sIHIgPSB0LnZhbHVlcyB8fCBbXTtcbiAgICBmb3IgKGxldCBlID0gMDsgZSA8IG4ubGVuZ3RoICYmIGUgPCByLmxlbmd0aDsgKytlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKG5bZV0sIHJbZV0pO1xuICAgICAgICBpZiAodCkgcmV0dXJuIHQ7XG4gICAgfVxuICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuLmxlbmd0aCwgci5sZW5ndGgpO1xufVxuXG5mdW5jdGlvbiBjYW5vbmljYWxJZChlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9jYW5vbmlmeVZhbHVlKGUpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlWYWx1ZShlKSB7XG4gICAgcmV0dXJuIFwibnVsbFZhbHVlXCIgaW4gZSA/IFwibnVsbFwiIDogXCJib29sZWFuVmFsdWVcIiBpbiBlID8gXCJcIiArIGUuYm9vbGVhblZhbHVlIDogXCJpbnRlZ2VyVmFsdWVcIiBpbiBlID8gXCJcIiArIGUuaW50ZWdlclZhbHVlIDogXCJkb3VibGVWYWx1ZVwiIGluIGUgPyBcIlwiICsgZS5kb3VibGVWYWx1ZSA6IFwidGltZXN0YW1wVmFsdWVcIiBpbiBlID8gZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5VGltZXN0YW1wKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9ub3JtYWxpemVUaW1lc3RhbXAoZSk7XG4gICAgICAgIHJldHVybiBgdGltZSgke3Quc2Vjb25kc30sJHt0Lm5hbm9zfSlgO1xuICAgIH0oZS50aW1lc3RhbXBWYWx1ZSkgOiBcInN0cmluZ1ZhbHVlXCIgaW4gZSA/IGUuc3RyaW5nVmFsdWUgOiBcImJ5dGVzVmFsdWVcIiBpbiBlID8gZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5Qnl0ZVN0cmluZyhlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyhlKS50b0Jhc2U2NCgpO1xuICAgIH0oZS5ieXRlc1ZhbHVlKSA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiBlID8gZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5UmVmZXJlbmNlKGUpIHtcbiAgICAgICAgcmV0dXJuIERvY3VtZW50S2V5LmZyb21OYW1lKGUpLnRvU3RyaW5nKCk7XG4gICAgfShlLnJlZmVyZW5jZVZhbHVlKSA6IFwiZ2VvUG9pbnRWYWx1ZVwiIGluIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlHZW9Qb2ludChlKSB7XG4gICAgICAgIHJldHVybiBgZ2VvKCR7ZS5sYXRpdHVkZX0sJHtlLmxvbmdpdHVkZX0pYDtcbiAgICB9KGUuZ2VvUG9pbnRWYWx1ZSkgOiBcImFycmF5VmFsdWVcIiBpbiBlID8gZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5QXJyYXkoZSkge1xuICAgICAgICBsZXQgdCA9IFwiW1wiLCBuID0gITA7XG4gICAgICAgIGZvciAoY29uc3QgciBvZiBlLnZhbHVlcyB8fCBbXSkgbiA/IG4gPSAhMSA6IHQgKz0gXCIsXCIsIHQgKz0gX19QUklWQVRFX2Nhbm9uaWZ5VmFsdWUocik7XG4gICAgICAgIHJldHVybiB0ICsgXCJdXCI7XG4gICAgfVxuICAgIC8qKlxuICogUmV0dXJucyBhbiBhcHByb3hpbWF0ZSAoYW5kIHdpbGRseSBpbmFjY3VyYXRlKSBpbi1tZW1vcnkgc2l6ZSBmb3IgdGhlIGZpZWxkXG4gKiB2YWx1ZS5cbiAqXG4gKiBUaGUgbWVtb3J5IHNpemUgdGFrZXMgaW50byBhY2NvdW50IG9ubHkgdGhlIGFjdHVhbCB1c2VyIGRhdGEgYXMgaXQgcmVzaWRlc1xuICogaW4gbWVtb3J5IGFuZCBpZ25vcmVzIG9iamVjdCBvdmVyaGVhZC5cbiAqLyAoZS5hcnJheVZhbHVlKSA6IFwibWFwVmFsdWVcIiBpbiBlID8gZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5TWFwKGUpIHtcbiAgICAgICAgLy8gSXRlcmF0aW9uIG9yZGVyIGluIEphdmFTY3JpcHQgaXMgbm90IGd1YXJhbnRlZWQuIFRvIGVuc3VyZSB0aGF0IHdlIGdlbmVyYXRlXG4gICAgICAgIC8vIG1hdGNoaW5nIGNhbm9uaWNhbCBJRHMgZm9yIGlkZW50aWNhbCBtYXBzLCB3ZSBuZWVkIHRvIHNvcnQgdGhlIGtleXMuXG4gICAgICAgIGNvbnN0IHQgPSBPYmplY3Qua2V5cyhlLmZpZWxkcyB8fCB7fSkuc29ydCgpO1xuICAgICAgICBsZXQgbiA9IFwie1wiLCByID0gITA7XG4gICAgICAgIGZvciAoY29uc3QgaSBvZiB0KSByID8gciA9ICExIDogbiArPSBcIixcIiwgbiArPSBgJHtpfToke19fUFJJVkFURV9jYW5vbmlmeVZhbHVlKGUuZmllbGRzW2ldKX1gO1xuICAgICAgICByZXR1cm4gbiArIFwifVwiO1xuICAgIH0oZS5tYXBWYWx1ZSkgOiBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9lc3RpbWF0ZUJ5dGVTaXplKGUpIHtcbiAgICBzd2l0Y2ggKF9fUFJJVkFURV90eXBlT3JkZXIoZSkpIHtcbiAgICAgIGNhc2UgMCAvKiBUeXBlT3JkZXIuTnVsbFZhbHVlICovIDpcbiAgICAgIGNhc2UgMSAvKiBUeXBlT3JkZXIuQm9vbGVhblZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIDQ7XG5cbiAgICAgIGNhc2UgMiAvKiBUeXBlT3JkZXIuTnVtYmVyVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gODtcblxuICAgICAgY2FzZSAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDggLyogVHlwZU9yZGVyLkdlb1BvaW50VmFsdWUgKi8gOlxuICAgICAgICAvLyBHZW9Qb2ludHMgYXJlIG1hZGUgdXAgb2YgdHdvIGRpc3RpbmN0IG51bWJlcnMgKGxhdGl0dWRlICsgbG9uZ2l0dWRlKVxuICAgICAgICByZXR1cm4gMTY7XG5cbiAgICAgIGNhc2UgNCAvKiBUeXBlT3JkZXIuU2VydmVyVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUoZSk7XG4gICAgICAgIHJldHVybiB0ID8gMTYgKyBfX1BSSVZBVEVfZXN0aW1hdGVCeXRlU2l6ZSh0KSA6IDE2O1xuXG4gICAgICBjYXNlIDUgLyogVHlwZU9yZGVyLlN0cmluZ1ZhbHVlICovIDpcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvRGF0YV9zdHJ1Y3R1cmVzOlxuICAgICAgICAvLyBcIkphdmFTY3JpcHQncyBTdHJpbmcgdHlwZSBpcyBbLi4uXSBhIHNldCBvZiBlbGVtZW50cyBvZiAxNi1iaXQgdW5zaWduZWRcbiAgICAgICAgLy8gaW50ZWdlciB2YWx1ZXNcIlxuICAgICAgICByZXR1cm4gMiAqIGUuc3RyaW5nVmFsdWUubGVuZ3RoO1xuXG4gICAgICBjYXNlIDYgLyogVHlwZU9yZGVyLkJsb2JWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyhlLmJ5dGVzVmFsdWUpLmFwcHJveGltYXRlQnl0ZVNpemUoKTtcblxuICAgICAgY2FzZSA3IC8qIFR5cGVPcmRlci5SZWZWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBlLnJlZmVyZW5jZVZhbHVlLmxlbmd0aDtcblxuICAgICAgY2FzZSA5IC8qIFR5cGVPcmRlci5BcnJheVZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9lc3RpbWF0ZUFycmF5Qnl0ZVNpemUoZSkge1xuICAgICAgICAgICAgcmV0dXJuIChlLnZhbHVlcyB8fCBbXSkucmVkdWNlKCgoZSwgdCkgPT4gZSArIF9fUFJJVkFURV9lc3RpbWF0ZUJ5dGVTaXplKHQpKSwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqIFJldHVybnMgYSByZWZlcmVuY2UgdmFsdWUgZm9yIHRoZSBwcm92aWRlZCBkYXRhYmFzZSBhbmQga2V5LiAqLyAoZS5hcnJheVZhbHVlKTtcblxuICAgICAgY2FzZSAxMCAvKiBUeXBlT3JkZXIuVmVjdG9yVmFsdWUgKi8gOlxuICAgICAgY2FzZSAxMSAvKiBUeXBlT3JkZXIuT2JqZWN0VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2VzdGltYXRlTWFwQnl0ZVNpemUoZSkge1xuICAgICAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICAgICAgcmV0dXJuIGZvckVhY2goZS5maWVsZHMsICgoZSwgbikgPT4ge1xuICAgICAgICAgICAgICAgIHQgKz0gZS5sZW5ndGggKyBfX1BSSVZBVEVfZXN0aW1hdGVCeXRlU2l6ZShuKTtcbiAgICAgICAgICAgIH0pKSwgdDtcbiAgICAgICAgfShlLm1hcFZhbHVlKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3JlZlZhbHVlKGUsIHQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZWZlcmVuY2VWYWx1ZTogYHByb2plY3RzLyR7ZS5wcm9qZWN0SWR9L2RhdGFiYXNlcy8ke2UuZGF0YWJhc2V9L2RvY3VtZW50cy8ke3QucGF0aC5jYW5vbmljYWxTdHJpbmcoKX1gXG4gICAgfTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGFuIEludGVnZXJWYWx1ZSAuICovIGZ1bmN0aW9uIGlzSW50ZWdlcihlKSB7XG4gICAgcmV0dXJuICEhZSAmJiBcImludGVnZXJWYWx1ZVwiIGluIGU7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhIERvdWJsZVZhbHVlLiAqL1xuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGFuIEFycmF5VmFsdWUuICovXG5mdW5jdGlvbiBpc0FycmF5KGUpIHtcbiAgICByZXR1cm4gISFlICYmIFwiYXJyYXlWYWx1ZVwiIGluIGU7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhIE51bGxWYWx1ZS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2lzTnVsbFZhbHVlKGUpIHtcbiAgICByZXR1cm4gISFlICYmIFwibnVsbFZhbHVlXCIgaW4gZTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIE5hTi4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2lzTmFuVmFsdWUoZSkge1xuICAgIHJldHVybiAhIWUgJiYgXCJkb3VibGVWYWx1ZVwiIGluIGUgJiYgaXNOYU4oTnVtYmVyKGUuZG91YmxlVmFsdWUpKTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGEgTWFwVmFsdWUuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc01hcFZhbHVlKGUpIHtcbiAgICByZXR1cm4gISFlICYmIFwibWFwVmFsdWVcIiBpbiBlO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYSBWZXRvclZhbHVlLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNWZWN0b3JWYWx1ZShlKSB7XG4gICAgdmFyIHQsIG47XG4gICAgcmV0dXJuIFwiX192ZWN0b3JfX1wiID09PSAobnVsbCA9PT0gKG4gPSAoKG51bGwgPT09ICh0ID0gbnVsbCA9PSBlID8gdm9pZCAwIDogZS5tYXBWYWx1ZSkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC5maWVsZHMpIHx8IHt9KS5fX3R5cGVfXykgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5zdHJpbmdWYWx1ZSk7XG59XG5cbi8qKiBDcmVhdGVzIGEgZGVlcCBjb3B5IG9mIGBzb3VyY2VgLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGVlcENsb25lKGUpIHtcbiAgICBpZiAoZS5nZW9Qb2ludFZhbHVlKSByZXR1cm4ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiBPYmplY3QuYXNzaWduKHt9LCBlLmdlb1BvaW50VmFsdWUpXG4gICAgfTtcbiAgICBpZiAoZS50aW1lc3RhbXBWYWx1ZSAmJiBcIm9iamVjdFwiID09IHR5cGVvZiBlLnRpbWVzdGFtcFZhbHVlKSByZXR1cm4ge1xuICAgICAgICB0aW1lc3RhbXBWYWx1ZTogT2JqZWN0LmFzc2lnbih7fSwgZS50aW1lc3RhbXBWYWx1ZSlcbiAgICB9O1xuICAgIGlmIChlLm1hcFZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczoge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGZvckVhY2goZS5tYXBWYWx1ZS5maWVsZHMsICgoZSwgbikgPT4gdC5tYXBWYWx1ZS5maWVsZHNbZV0gPSBfX1BSSVZBVEVfZGVlcENsb25lKG4pKSksIFxuICAgICAgICB0O1xuICAgIH1cbiAgICBpZiAoZS5hcnJheVZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IChlLmFycmF5VmFsdWUudmFsdWVzIHx8IFtdKS5sZW5ndGg7ICsrbikgdC5hcnJheVZhbHVlLnZhbHVlc1tuXSA9IF9fUFJJVkFURV9kZWVwQ2xvbmUoZS5hcnJheVZhbHVlLnZhbHVlc1tuXSk7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgZSk7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIFZhbHVlIHJlcHJlc2VudHMgdGhlIGNhbm9uaWNhbCB7QGxpbmsgI01BWF9WQUxVRX0gLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNNYXhWYWx1ZShlKSB7XG4gICAgcmV0dXJuIFwiX19tYXhfX1wiID09PSAoKChlLm1hcFZhbHVlIHx8IHt9KS5maWVsZHMgfHwge30pLl9fdHlwZV9fIHx8IHt9KS5zdHJpbmdWYWx1ZTtcbn1cblxuY29uc3Qgc2UgPSB7XG4gICAgbWFwVmFsdWU6IHtcbiAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICBfX3R5cGVfXzoge1xuICAgICAgICAgICAgICAgIHN0cmluZ1ZhbHVlOiBcIl9fdmVjdG9yX19cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgYXJyYXlWYWx1ZToge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn07XG5cbi8qKiBSZXR1cm5zIHRoZSBsb3dlc3QgdmFsdWUgZm9yIHRoZSBnaXZlbiB2YWx1ZSB0eXBlIChpbmNsdXNpdmUpLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsdWVzR2V0TG93ZXJCb3VuZChlKSB7XG4gICAgcmV0dXJuIFwibnVsbFZhbHVlXCIgaW4gZSA/IGllIDogXCJib29sZWFuVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBib29sZWFuVmFsdWU6ICExXG4gICAgfSA6IFwiaW50ZWdlclZhbHVlXCIgaW4gZSB8fCBcImRvdWJsZVZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgZG91YmxlVmFsdWU6IE5hTlxuICAgIH0gOiBcInRpbWVzdGFtcFZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgdGltZXN0YW1wVmFsdWU6IHtcbiAgICAgICAgICAgIHNlY29uZHM6IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSXG4gICAgICAgIH1cbiAgICB9IDogXCJzdHJpbmdWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIHN0cmluZ1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwiYnl0ZXNWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIGJ5dGVzVmFsdWU6IFwiXCJcbiAgICB9IDogXCJyZWZlcmVuY2VWYWx1ZVwiIGluIGUgPyBfX1BSSVZBVEVfcmVmVmFsdWUoRGF0YWJhc2VJZC5lbXB0eSgpLCBEb2N1bWVudEtleS5lbXB0eSgpKSA6IFwiZ2VvUG9pbnRWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIGdlb1BvaW50VmFsdWU6IHtcbiAgICAgICAgICAgIGxhdGl0dWRlOiAtOTAsXG4gICAgICAgICAgICBsb25naXR1ZGU6IC0xODBcbiAgICAgICAgfVxuICAgIH0gOiBcImFycmF5VmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBhcnJheVZhbHVlOiB7fVxuICAgIH0gOiBcIm1hcFZhbHVlXCIgaW4gZSA/IF9fUFJJVkFURV9pc1ZlY3RvclZhbHVlKGUpID8gc2UgOiB7XG4gICAgICAgIG1hcFZhbHVlOiB7fVxuICAgIH0gOiBmYWlsKCk7XG59XG5cbi8qKiBSZXR1cm5zIHRoZSBsYXJnZXN0IHZhbHVlIGZvciB0aGUgZ2l2ZW4gdmFsdWUgdHlwZSAoZXhjbHVzaXZlKS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlc0dldFVwcGVyQm91bmQoZSkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIGJvb2xlYW5WYWx1ZTogITFcbiAgICB9IDogXCJib29sZWFuVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBkb3VibGVWYWx1ZTogTmFOXG4gICAgfSA6IFwiaW50ZWdlclZhbHVlXCIgaW4gZSB8fCBcImRvdWJsZVZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgdGltZXN0YW1wVmFsdWU6IHtcbiAgICAgICAgICAgIHNlY29uZHM6IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSXG4gICAgICAgIH1cbiAgICB9IDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIHN0cmluZ1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwic3RyaW5nVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBieXRlc1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwiYnl0ZXNWYWx1ZVwiIGluIGUgPyBfX1BSSVZBVEVfcmVmVmFsdWUoRGF0YWJhc2VJZC5lbXB0eSgpLCBEb2N1bWVudEtleS5lbXB0eSgpKSA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiB7XG4gICAgICAgICAgICBsYXRpdHVkZTogLTkwLFxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTgwXG4gICAgICAgIH1cbiAgICB9IDogXCJnZW9Qb2ludFZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgYXJyYXlWYWx1ZToge31cbiAgICB9IDogXCJhcnJheVZhbHVlXCIgaW4gZSA/IHNlIDogXCJtYXBWYWx1ZVwiIGluIGUgPyBfX1BSSVZBVEVfaXNWZWN0b3JWYWx1ZShlKSA/IHtcbiAgICAgICAgbWFwVmFsdWU6IHt9XG4gICAgfSA6IHJlIDogZmFpbCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG93ZXJCb3VuZENvbXBhcmUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKGUudmFsdWUsIHQudmFsdWUpO1xuICAgIHJldHVybiAwICE9PSBuID8gbiA6IGUuaW5jbHVzaXZlICYmICF0LmluY2x1c2l2ZSA/IC0xIDogIWUuaW5jbHVzaXZlICYmIHQuaW5jbHVzaXZlID8gMSA6IDA7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV91cHBlckJvdW5kQ29tcGFyZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV92YWx1ZUNvbXBhcmUoZS52YWx1ZSwgdC52YWx1ZSk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogZS5pbmNsdXNpdmUgJiYgIXQuaW5jbHVzaXZlID8gMSA6ICFlLmluY2x1c2l2ZSAmJiB0LmluY2x1c2l2ZSA/IC0xIDogMDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gT2JqZWN0VmFsdWUgcmVwcmVzZW50cyBhIE1hcFZhbHVlIGluIHRoZSBGaXJlc3RvcmUgUHJvdG8gYW5kIG9mZmVycyB0aGVcbiAqIGFiaWxpdHkgdG8gYWRkIGFuZCByZW1vdmUgZmllbGRzICh2aWEgdGhlIE9iamVjdFZhbHVlQnVpbGRlcikuXG4gKi8gY2xhc3MgT2JqZWN0VmFsdWUge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IGU7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RWYWx1ZSh7XG4gICAgICAgICAgICBtYXBWYWx1ZToge31cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHZhbHVlIGF0IHRoZSBnaXZlbiBwYXRoIG9yIG51bGwuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aCAtIHRoZSBwYXRoIHRvIHNlYXJjaFxuICAgICAqIEByZXR1cm5zIFRoZSB2YWx1ZSBhdCB0aGUgcGF0aCBvciBudWxsIGlmIHRoZSBwYXRoIGlzIG5vdCBzZXQuXG4gICAgICovICAgIGZpZWxkKGUpIHtcbiAgICAgICAgaWYgKGUuaXNFbXB0eSgpKSByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAge1xuICAgICAgICAgICAgbGV0IHQgPSB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aCAtIDE7ICsrbikgaWYgKHQgPSAodC5tYXBWYWx1ZS5maWVsZHMgfHwge30pW2UuZ2V0KG4pXSwgXG4gICAgICAgICAgICAhX19QUklWQVRFX2lzTWFwVmFsdWUodCkpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIHQgPSAodC5tYXBWYWx1ZS5maWVsZHMgfHwge30pW2UubGFzdFNlZ21lbnQoKV0sIHQgfHwgbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBmaWVsZCB0byB0aGUgcHJvdmlkZWQgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aCAtIFRoZSBmaWVsZCBwYXRoIHRvIHNldC5cbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LlxuICAgICAqLyAgICBzZXQoZSwgdCkge1xuICAgICAgICB0aGlzLmdldEZpZWxkc01hcChlLnBvcExhc3QoKSlbZS5sYXN0U2VnbWVudCgpXSA9IF9fUFJJVkFURV9kZWVwQ2xvbmUodCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHByb3ZpZGVkIGZpZWxkcyB0byB0aGUgcHJvdmlkZWQgdmFsdWVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGEgLSBBIG1hcCBvZiBmaWVsZHMgdG8gdmFsdWVzIChvciBudWxsIGZvciBkZWxldGVzKS5cbiAgICAgKi8gICAgc2V0QWxsKGUpIHtcbiAgICAgICAgbGV0IHQgPSBGaWVsZFBhdGgkMS5lbXB0eVBhdGgoKSwgbiA9IHt9LCByID0gW107XG4gICAgICAgIGUuZm9yRWFjaCgoKGUsIGkpID0+IHtcbiAgICAgICAgICAgIGlmICghdC5pc0ltbWVkaWF0ZVBhcmVudE9mKGkpKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IHRoZSBhY2N1bXVsYXRlZCBjaGFuZ2VzIGF0IHRoaXMgcGFyZW50IGxvY2F0aW9uXG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuZ2V0RmllbGRzTWFwKHQpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlDaGFuZ2VzKGUsIG4sIHIpLCBuID0ge30sIHIgPSBbXSwgdCA9IGkucG9wTGFzdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZSA/IG5baS5sYXN0U2VnbWVudCgpXSA9IF9fUFJJVkFURV9kZWVwQ2xvbmUoZSkgOiByLnB1c2goaS5sYXN0U2VnbWVudCgpKTtcbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCBpID0gdGhpcy5nZXRGaWVsZHNNYXAodCk7XG4gICAgICAgIHRoaXMuYXBwbHlDaGFuZ2VzKGksIG4sIHIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBmaWVsZCBhdCB0aGUgc3BlY2lmaWVkIHBhdGguIElmIHRoZXJlIGlzIG5vIGZpZWxkIGF0IHRoZVxuICAgICAqIHNwZWNpZmllZCBwYXRoLCBub3RoaW5nIGlzIGNoYW5nZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aCAtIFRoZSBmaWVsZCBwYXRoIHRvIHJlbW92ZS5cbiAgICAgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZmllbGQoZS5wb3BMYXN0KCkpO1xuICAgICAgICBfX1BSSVZBVEVfaXNNYXBWYWx1ZSh0KSAmJiB0Lm1hcFZhbHVlLmZpZWxkcyAmJiBkZWxldGUgdC5tYXBWYWx1ZS5maWVsZHNbZS5sYXN0U2VnbWVudCgpXTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdmFsdWVFcXVhbHModGhpcy52YWx1ZSwgZS52YWx1ZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIG1hcCB0aGF0IGNvbnRhaW5zIHRoZSBsZWFmIGVsZW1lbnQgb2YgYHBhdGhgLiBJZiB0aGUgcGFyZW50XG4gICAgICogZW50cnkgZG9lcyBub3QgeWV0IGV4aXN0LCBvciBpZiBpdCBpcyBub3QgYSBtYXAsIGEgbmV3IG1hcCB3aWxsIGJlIGNyZWF0ZWQuXG4gICAgICovICAgIGdldEZpZWxkc01hcChlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy52YWx1ZTtcbiAgICAgICAgdC5tYXBWYWx1ZS5maWVsZHMgfHwgKHQubWFwVmFsdWUgPSB7XG4gICAgICAgICAgICBmaWVsZHM6IHt9XG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUubGVuZ3RoOyArK24pIHtcbiAgICAgICAgICAgIGxldCByID0gdC5tYXBWYWx1ZS5maWVsZHNbZS5nZXQobildO1xuICAgICAgICAgICAgX19QUklWQVRFX2lzTWFwVmFsdWUocikgJiYgci5tYXBWYWx1ZS5maWVsZHMgfHwgKHIgPSB7XG4gICAgICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzOiB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHQubWFwVmFsdWUuZmllbGRzW2UuZ2V0KG4pXSA9IHIpLCB0ID0gcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdC5tYXBWYWx1ZS5maWVsZHM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1vZGlmaWVzIGBmaWVsZHNNYXBgIGJ5IGFkZGluZywgcmVwbGFjaW5nIG9yIGRlbGV0aW5nIHRoZSBzcGVjaWZpZWRcbiAgICAgKiBlbnRyaWVzLlxuICAgICAqLyAgICBhcHBseUNoYW5nZXMoZSwgdCwgbikge1xuICAgICAgICBmb3JFYWNoKHQsICgodCwgbikgPT4gZVt0XSA9IG4pKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIG4pIGRlbGV0ZSBlW3RdO1xuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RWYWx1ZShfX1BSSVZBVEVfZGVlcENsb25lKHRoaXMudmFsdWUpKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIEZpZWxkTWFzayBidWlsdCBmcm9tIGFsbCBmaWVsZHMgaW4gYSBNYXBWYWx1ZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZXh0cmFjdEZpZWxkTWFzayhlKSB7XG4gICAgY29uc3QgdCA9IFtdO1xuICAgIHJldHVybiBmb3JFYWNoKGUuZmllbGRzLCAoKGUsIG4pID0+IHtcbiAgICAgICAgY29uc3QgciA9IG5ldyBGaWVsZFBhdGgkMShbIGUgXSk7XG4gICAgICAgIGlmIChfX1BSSVZBVEVfaXNNYXBWYWx1ZShuKSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9leHRyYWN0RmllbGRNYXNrKG4ubWFwVmFsdWUpLmZpZWxkcztcbiAgICAgICAgICAgIGlmICgwID09PSBlLmxlbmd0aCkgXG4gICAgICAgICAgICAvLyBQcmVzZXJ2ZSB0aGUgZW1wdHkgbWFwIGJ5IGFkZGluZyBpdCB0byB0aGUgRmllbGRNYXNrLlxuICAgICAgICAgICAgdC5wdXNoKHIpOyBlbHNlIFxuICAgICAgICAgICAgLy8gRm9yIG5lc3RlZCBhbmQgbm9uLWVtcHR5IE9iamVjdFZhbHVlcywgYWRkIHRoZSBGaWVsZFBhdGggb2YgdGhlXG4gICAgICAgICAgICAvLyBsZWFmIG5vZGVzLlxuICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIGUpIHQucHVzaChyLmNoaWxkKG4pKTtcbiAgICAgICAgfSBlbHNlIFxuICAgICAgICAvLyBGb3IgbmVzdGVkIGFuZCBub24tZW1wdHkgT2JqZWN0VmFsdWVzLCBhZGQgdGhlIEZpZWxkUGF0aCBvZiB0aGUgbGVhZlxuICAgICAgICAvLyBub2Rlcy5cbiAgICAgICAgdC5wdXNoKHIpO1xuICAgIH0pKSwgbmV3IEZpZWxkTWFzayh0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGRvY3VtZW50IGluIEZpcmVzdG9yZSB3aXRoIGEga2V5LCB2ZXJzaW9uLCBkYXRhIGFuZCB3aGV0aGVyIGl0XG4gKiBoYXMgbG9jYWwgbXV0YXRpb25zIGFwcGxpZWQgdG8gaXQuXG4gKlxuICogRG9jdW1lbnRzIGNhbiB0cmFuc2l0aW9uIGJldHdlZW4gc3RhdGVzIHZpYSBgY29udmVydFRvRm91bmREb2N1bWVudCgpYCxcbiAqIGBjb252ZXJ0VG9Ob0RvY3VtZW50KClgIGFuZCBgY29udmVydFRvVW5rbm93bkRvY3VtZW50KClgLiBJZiBhIGRvY3VtZW50IGRvZXNcbiAqIG5vdCB0cmFuc2l0aW9uIHRvIG9uZSBvZiB0aGVzZSBzdGF0ZXMgZXZlbiBhZnRlciBhbGwgbXV0YXRpb25zIGhhdmUgYmVlblxuICogYXBwbGllZCwgYGlzVmFsaWREb2N1bWVudCgpYCByZXR1cm5zIGZhbHNlIGFuZCB0aGUgZG9jdW1lbnQgc2hvdWxkIGJlIHJlbW92ZWRcbiAqIGZyb20gYWxsIHZpZXdzLlxuICovIGNsYXNzIE11dGFibGVEb2N1bWVudCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbykge1xuICAgICAgICB0aGlzLmtleSA9IGUsIHRoaXMuZG9jdW1lbnRUeXBlID0gdCwgdGhpcy52ZXJzaW9uID0gbiwgdGhpcy5yZWFkVGltZSA9IHIsIHRoaXMuY3JlYXRlVGltZSA9IGksIFxuICAgICAgICB0aGlzLmRhdGEgPSBzLCB0aGlzLmRvY3VtZW50U3RhdGUgPSBvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZG9jdW1lbnQgd2l0aCBubyBrbm93biB2ZXJzaW9uIG9yIGRhdGEsIGJ1dCB3aGljaCBjYW4gc2VydmUgYXNcbiAgICAgKiBiYXNlIGRvY3VtZW50IGZvciBtdXRhdGlvbnMuXG4gICAgICovICAgIHN0YXRpYyBuZXdJbnZhbGlkRG9jdW1lbnQoZSkge1xuICAgICAgICByZXR1cm4gbmV3IE11dGFibGVEb2N1bWVudChlLCAwIC8qIERvY3VtZW50VHlwZS5JTlZBTElEICovICwgXG4gICAgICAgIC8qIHZlcnNpb24gKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyogcmVhZFRpbWUgKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyogY3JlYXRlVGltZSAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIE9iamVjdFZhbHVlLmVtcHR5KCksIDAgLyogRG9jdW1lbnRTdGF0ZS5TWU5DRUQgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGRvY3VtZW50IHRoYXQgaXMga25vd24gdG8gZXhpc3Qgd2l0aCB0aGUgZ2l2ZW4gZGF0YSBhdCB0aGVcbiAgICAgKiBnaXZlbiB2ZXJzaW9uLlxuICAgICAqLyAgICBzdGF0aWMgbmV3Rm91bmREb2N1bWVudChlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXV0YWJsZURvY3VtZW50KGUsIDEgLyogRG9jdW1lbnRUeXBlLkZPVU5EX0RPQ1VNRU5UICovICwgXG4gICAgICAgIC8qIHZlcnNpb24gKi8gdCwgXG4gICAgICAgIC8qIHJlYWRUaW1lICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgXG4gICAgICAgIC8qIGNyZWF0ZVRpbWUgKi8gbiwgciwgMCAvKiBEb2N1bWVudFN0YXRlLlNZTkNFRCAqLyk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IGRvY3VtZW50IHRoYXQgaXMga25vd24gdG8gbm90IGV4aXN0IGF0IHRoZSBnaXZlbiB2ZXJzaW9uLiAqLyAgICBzdGF0aWMgbmV3Tm9Eb2N1bWVudChlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgTXV0YWJsZURvY3VtZW50KGUsIDIgLyogRG9jdW1lbnRUeXBlLk5PX0RPQ1VNRU5UICovICwgXG4gICAgICAgIC8qIHZlcnNpb24gKi8gdCwgXG4gICAgICAgIC8qIHJlYWRUaW1lICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgXG4gICAgICAgIC8qIGNyZWF0ZVRpbWUgKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBPYmplY3RWYWx1ZS5lbXB0eSgpLCAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBkb2N1bWVudCB0aGF0IGlzIGtub3duIHRvIGV4aXN0IGF0IHRoZSBnaXZlbiB2ZXJzaW9uIGJ1dFxuICAgICAqIHdob3NlIGRhdGEgaXMgbm90IGtub3duIChlLmcuIGEgZG9jdW1lbnQgdGhhdCB3YXMgdXBkYXRlZCB3aXRob3V0IGEga25vd25cbiAgICAgKiBiYXNlIGRvY3VtZW50KS5cbiAgICAgKi8gICAgc3RhdGljIG5ld1Vua25vd25Eb2N1bWVudChlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgTXV0YWJsZURvY3VtZW50KGUsIDMgLyogRG9jdW1lbnRUeXBlLlVOS05PV05fRE9DVU1FTlQgKi8gLCBcbiAgICAgICAgLyogdmVyc2lvbiAqLyB0LCBcbiAgICAgICAgLyogcmVhZFRpbWUgKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyogY3JlYXRlVGltZSAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIE9iamVjdFZhbHVlLmVtcHR5KCksIDIgLyogRG9jdW1lbnRTdGF0ZS5IQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIGRvY3VtZW50IHR5cGUgdG8gaW5kaWNhdGUgdGhhdCBpdCBleGlzdHMgYW5kIHRoYXQgaXRzIHZlcnNpb25cbiAgICAgKiBhbmQgZGF0YSBhcmUga25vd24uXG4gICAgICovICAgIGNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICAvLyBJZiBhIGRvY3VtZW50IGlzIHN3aXRjaGluZyBzdGF0ZSBmcm9tIGJlaW5nIGFuIGludmFsaWQgb3IgZGVsZXRlZFxuICAgICAgICAvLyBkb2N1bWVudCB0byBhIHZhbGlkIChGT1VORF9ET0NVTUVOVCkgZG9jdW1lbnQsIGVpdGhlciBkdWUgdG8gcmVjZWl2aW5nIGFuXG4gICAgICAgIC8vIHVwZGF0ZSBmcm9tIFdhdGNoIG9yIGR1ZSB0byBhcHBseWluZyBhIGxvY2FsIHNldCBtdXRhdGlvbiBvbiB0b3BcbiAgICAgICAgLy8gb2YgYSBkZWxldGVkIGRvY3VtZW50LCBvdXIgYmVzdCBndWVzcyBhYm91dCBpdHMgY3JlYXRlVGltZSB3b3VsZCBiZSB0aGVcbiAgICAgICAgLy8gdmVyc2lvbiBhdCB3aGljaCB0aGUgZG9jdW1lbnQgdHJhbnNpdGlvbmVkIHRvIGEgRk9VTkRfRE9DVU1FTlQuXG4gICAgICAgIHJldHVybiAhdGhpcy5jcmVhdGVUaW1lLmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSB8fCAyIC8qIERvY3VtZW50VHlwZS5OT19ET0NVTUVOVCAqLyAhPT0gdGhpcy5kb2N1bWVudFR5cGUgJiYgMCAvKiBEb2N1bWVudFR5cGUuSU5WQUxJRCAqLyAhPT0gdGhpcy5kb2N1bWVudFR5cGUgfHwgKHRoaXMuY3JlYXRlVGltZSA9IGUpLCBcbiAgICAgICAgdGhpcy52ZXJzaW9uID0gZSwgdGhpcy5kb2N1bWVudFR5cGUgPSAxIC8qIERvY3VtZW50VHlwZS5GT1VORF9ET0NVTUVOVCAqLyAsIHRoaXMuZGF0YSA9IHQsIFxuICAgICAgICB0aGlzLmRvY3VtZW50U3RhdGUgPSAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovICwgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgZG9jdW1lbnQgdHlwZSB0byBpbmRpY2F0ZSB0aGF0IGl0IGRvZXNuJ3QgZXhpc3QgYXQgdGhlIGdpdmVuXG4gICAgICogdmVyc2lvbi5cbiAgICAgKi8gICAgY29udmVydFRvTm9Eb2N1bWVudChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZlcnNpb24gPSBlLCB0aGlzLmRvY3VtZW50VHlwZSA9IDIgLyogRG9jdW1lbnRUeXBlLk5PX0RPQ1VNRU5UICovICwgXG4gICAgICAgIHRoaXMuZGF0YSA9IE9iamVjdFZhbHVlLmVtcHR5KCksIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDAgLyogRG9jdW1lbnRTdGF0ZS5TWU5DRUQgKi8gLCBcbiAgICAgICAgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgZG9jdW1lbnQgdHlwZSB0byBpbmRpY2F0ZSB0aGF0IGl0IGV4aXN0cyBhdCBhIGdpdmVuIHZlcnNpb24gYnV0XG4gICAgICogdGhhdCBpdHMgZGF0YSBpcyBub3Qga25vd24gKGUuZy4gYSBkb2N1bWVudCB0aGF0IHdhcyB1cGRhdGVkIHdpdGhvdXQgYSBrbm93blxuICAgICAqIGJhc2UgZG9jdW1lbnQpLlxuICAgICAqLyAgICBjb252ZXJ0VG9Vbmtub3duRG9jdW1lbnQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uID0gZSwgdGhpcy5kb2N1bWVudFR5cGUgPSAzIC8qIERvY3VtZW50VHlwZS5VTktOT1dOX0RPQ1VNRU5UICovICwgXG4gICAgICAgIHRoaXMuZGF0YSA9IE9iamVjdFZhbHVlLmVtcHR5KCksIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDIgLyogRG9jdW1lbnRTdGF0ZS5IQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyAsIFxuICAgICAgICB0aGlzO1xuICAgIH1cbiAgICBzZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50U3RhdGUgPSAyIC8qIERvY3VtZW50U3RhdGUuSEFTX0NPTU1JVFRFRF9NVVRBVElPTlMgKi8gLCB0aGlzO1xuICAgIH1cbiAgICBzZXRIYXNMb2NhbE11dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDEgLyogRG9jdW1lbnRTdGF0ZS5IQVNfTE9DQUxfTVVUQVRJT05TICovICwgdGhpcy52ZXJzaW9uID0gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgdGhpcztcbiAgICB9XG4gICAgc2V0UmVhZFRpbWUoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWFkVGltZSA9IGUsIHRoaXM7XG4gICAgfVxuICAgIGdldCBoYXNMb2NhbE11dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIDEgLyogRG9jdW1lbnRTdGF0ZS5IQVNfTE9DQUxfTVVUQVRJT05TICovID09PSB0aGlzLmRvY3VtZW50U3RhdGU7XG4gICAgfVxuICAgIGdldCBoYXNDb21taXR0ZWRNdXRhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiAyIC8qIERvY3VtZW50U3RhdGUuSEFTX0NPTU1JVFRFRF9NVVRBVElPTlMgKi8gPT09IHRoaXMuZG9jdW1lbnRTdGF0ZTtcbiAgICB9XG4gICAgZ2V0IGhhc1BlbmRpbmdXcml0ZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0xvY2FsTXV0YXRpb25zIHx8IHRoaXMuaGFzQ29tbWl0dGVkTXV0YXRpb25zO1xuICAgIH1cbiAgICBpc1ZhbGlkRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAwIC8qIERvY3VtZW50VHlwZS5JTlZBTElEICovICE9PSB0aGlzLmRvY3VtZW50VHlwZTtcbiAgICB9XG4gICAgaXNGb3VuZERvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gMSAvKiBEb2N1bWVudFR5cGUuRk9VTkRfRE9DVU1FTlQgKi8gPT09IHRoaXMuZG9jdW1lbnRUeXBlO1xuICAgIH1cbiAgICBpc05vRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAyIC8qIERvY3VtZW50VHlwZS5OT19ET0NVTUVOVCAqLyA9PT0gdGhpcy5kb2N1bWVudFR5cGU7XG4gICAgfVxuICAgIGlzVW5rbm93bkRvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gMyAvKiBEb2N1bWVudFR5cGUuVU5LTk9XTl9ET0NVTUVOVCAqLyA9PT0gdGhpcy5kb2N1bWVudFR5cGU7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIE11dGFibGVEb2N1bWVudCAmJiB0aGlzLmtleS5pc0VxdWFsKGUua2V5KSAmJiB0aGlzLnZlcnNpb24uaXNFcXVhbChlLnZlcnNpb24pICYmIHRoaXMuZG9jdW1lbnRUeXBlID09PSBlLmRvY3VtZW50VHlwZSAmJiB0aGlzLmRvY3VtZW50U3RhdGUgPT09IGUuZG9jdW1lbnRTdGF0ZSAmJiB0aGlzLmRhdGEuaXNFcXVhbChlLmRhdGEpO1xuICAgIH1cbiAgICBtdXRhYmxlQ29weSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNdXRhYmxlRG9jdW1lbnQodGhpcy5rZXksIHRoaXMuZG9jdW1lbnRUeXBlLCB0aGlzLnZlcnNpb24sIHRoaXMucmVhZFRpbWUsIHRoaXMuY3JlYXRlVGltZSwgdGhpcy5kYXRhLmNsb25lKCksIHRoaXMuZG9jdW1lbnRTdGF0ZSk7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYERvY3VtZW50KCR7dGhpcy5rZXl9LCAke3RoaXMudmVyc2lvbn0sICR7SlNPTi5zdHJpbmdpZnkodGhpcy5kYXRhLnZhbHVlKX0sIHtjcmVhdGVUaW1lOiAke3RoaXMuY3JlYXRlVGltZX19KSwge2RvY3VtZW50VHlwZTogJHt0aGlzLmRvY3VtZW50VHlwZX19KSwge2RvY3VtZW50U3RhdGU6ICR7dGhpcy5kb2N1bWVudFN0YXRlfX0pYDtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdGhlIHZhbHVlIGZvciBmaWVsZCBgZmllbGRgIGluIHRoZSBwcm92aWRlZCBkb2N1bWVudHMuIFRocm93cyBpZlxuICogdGhlIGZpZWxkIGRvZXMgbm90IGV4aXN0IGluIGJvdGggZG9jdW1lbnRzLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGEgYm91bmQgb2YgYSBxdWVyeS5cbiAqXG4gKiBUaGUgYm91bmQgaXMgc3BlY2lmaWVkIHdpdGggdGhlIGdpdmVuIGNvbXBvbmVudHMgcmVwcmVzZW50aW5nIGEgcG9zaXRpb24gYW5kXG4gKiB3aGV0aGVyIGl0J3MganVzdCBiZWZvcmUgb3IganVzdCBhZnRlciB0aGUgcG9zaXRpb24gKHJlbGF0aXZlIHRvIHdoYXRldmVyIHRoZVxuICogcXVlcnkgb3JkZXIgaXMpLlxuICpcbiAqIFRoZSBwb3NpdGlvbiByZXByZXNlbnRzIGEgbG9naWNhbCBpbmRleCBwb3NpdGlvbiBmb3IgYSBxdWVyeS4gSXQncyBhIHByZWZpeFxuICogb2YgdmFsdWVzIGZvciB0aGUgKHBvdGVudGlhbGx5IGltcGxpY2l0KSBvcmRlciBieSBjbGF1c2VzIG9mIGEgcXVlcnkuXG4gKlxuICogQm91bmQgcHJvdmlkZXMgYSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgd2hldGhlciBhIGRvY3VtZW50IGNvbWVzIGJlZm9yZSBvclxuICogYWZ0ZXIgYSBib3VuZC4gVGhpcyBpcyBpbmZsdWVuY2VkIGJ5IHdoZXRoZXIgdGhlIHBvc2l0aW9uIGlzIGp1c3QgYmVmb3JlIG9yXG4gKiBqdXN0IGFmdGVyIHRoZSBwcm92aWRlZCB2YWx1ZXMuXG4gKi9cbmNsYXNzIEJvdW5kIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBlLCB0aGlzLmluY2x1c2l2ZSA9IHQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfYm91bmRDb21wYXJlVG9Eb2N1bWVudChlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZS5wb3NpdGlvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBzID0gdFtpXSwgbyA9IGUucG9zaXRpb25baV07XG4gICAgICAgIGlmIChzLmZpZWxkLmlzS2V5RmllbGQoKSkgciA9IERvY3VtZW50S2V5LmNvbXBhcmF0b3IoRG9jdW1lbnRLZXkuZnJvbU5hbWUoby5yZWZlcmVuY2VWYWx1ZSksIG4ua2V5KTsgZWxzZSB7XG4gICAgICAgICAgICByID0gX19QUklWQVRFX3ZhbHVlQ29tcGFyZShvLCBuLmRhdGEuZmllbGQocy5maWVsZCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChcImRlc2NcIiAvKiBEaXJlY3Rpb24uREVTQ0VORElORyAqLyA9PT0gcy5kaXIgJiYgKHIgKj0gLTEpLCAwICE9PSByKSBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHI7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGEgZG9jdW1lbnQgc29ydHMgYWZ0ZXIgYSBib3VuZCB1c2luZyB0aGUgcHJvdmlkZWQgc29ydFxuICogb3JkZXIuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2JvdW5kRXF1YWxzKGUsIHQpIHtcbiAgICBpZiAobnVsbCA9PT0gZSkgcmV0dXJuIG51bGwgPT09IHQ7XG4gICAgaWYgKG51bGwgPT09IHQpIHJldHVybiAhMTtcbiAgICBpZiAoZS5pbmNsdXNpdmUgIT09IHQuaW5jbHVzaXZlIHx8IGUucG9zaXRpb24ubGVuZ3RoICE9PSB0LnBvc2l0aW9uLmxlbmd0aCkgcmV0dXJuICExO1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5wb3NpdGlvbi5sZW5ndGg7IG4rKykge1xuICAgICAgICBpZiAoIV9fUFJJVkFURV92YWx1ZUVxdWFscyhlLnBvc2l0aW9uW25dLCB0LnBvc2l0aW9uW25dKSkgcmV0dXJuICExO1xuICAgIH1cbiAgICByZXR1cm4gITA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIG9yZGVyaW5nIG9uIGEgZmllbGQsIGluIHNvbWUgRGlyZWN0aW9uLiBEaXJlY3Rpb24gZGVmYXVsdHMgdG8gQVNDRU5ESU5HLlxuICovIGNsYXNzIE9yZGVyQnkge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQgPSBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8pIHtcbiAgICAgICAgdGhpcy5maWVsZCA9IGUsIHRoaXMuZGlyID0gdDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9vcmRlckJ5RXF1YWxzKGUsIHQpIHtcbiAgICByZXR1cm4gZS5kaXIgPT09IHQuZGlyICYmIGUuZmllbGQuaXNFcXVhbCh0LmZpZWxkKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgRmlsdGVyIHt9XG5cbmNsYXNzIEZpZWxkRmlsdGVyIGV4dGVuZHMgRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuZmllbGQgPSBlLCB0aGlzLm9wID0gdCwgdGhpcy52YWx1ZSA9IG47XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmaWx0ZXIgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGFyZ3VtZW50cy5cbiAgICAgKi8gICAgc3RhdGljIGNyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBlLmlzS2V5RmllbGQoKSA/IFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA9PT0gdCB8fCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA9PT0gdCA/IHRoaXMuY3JlYXRlS2V5RmllbGRJbkZpbHRlcihlLCB0LCBuKSA6IG5ldyBfX1BSSVZBVEVfS2V5RmllbGRGaWx0ZXIoZSwgdCwgbikgOiBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gPT09IHQgPyBuZXcgX19QUklWQVRFX0FycmF5Q29udGFpbnNGaWx0ZXIoZSwgbikgOiBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IHQgPyBuZXcgX19QUklWQVRFX0luRmlsdGVyKGUsIG4pIDogXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gPT09IHQgPyBuZXcgX19QUklWQVRFX05vdEluRmlsdGVyKGUsIG4pIDogXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gPT09IHQgPyBuZXcgX19QUklWQVRFX0FycmF5Q29udGFpbnNBbnlGaWx0ZXIoZSwgbikgOiBuZXcgRmllbGRGaWx0ZXIoZSwgdCwgbik7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVhdGVLZXlGaWVsZEluRmlsdGVyKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA9PT0gdCA/IG5ldyBfX1BSSVZBVEVfS2V5RmllbGRJbkZpbHRlcihlLCBuKSA6IG5ldyBfX1BSSVZBVEVfS2V5RmllbGROb3RJbkZpbHRlcihlLCBuKTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIC8vIFR5cGVzIGRvIG5vdCBoYXZlIHRvIG1hdGNoIGluIE5PVF9FUVVBTCBmaWx0ZXJzLlxuICAgICAgICAgICAgICAgIHJldHVybiBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovID09PSB0aGlzLm9wID8gbnVsbCAhPT0gdCAmJiB0aGlzLm1hdGNoZXNDb21wYXJpc29uKF9fUFJJVkFURV92YWx1ZUNvbXBhcmUodCwgdGhpcy52YWx1ZSkpIDogbnVsbCAhPT0gdCAmJiBfX1BSSVZBVEVfdHlwZU9yZGVyKHRoaXMudmFsdWUpID09PSBfX1BSSVZBVEVfdHlwZU9yZGVyKHQpICYmIHRoaXMubWF0Y2hlc0NvbXBhcmlzb24oX19QUklWQVRFX3ZhbHVlQ29tcGFyZSh0LCB0aGlzLnZhbHVlKSk7XG4gICAgICAgIC8vIE9ubHkgY29tcGFyZSB0eXBlcyB3aXRoIG1hdGNoaW5nIGJhY2tlbmQgb3JkZXIgKHN1Y2ggYXMgZG91YmxlIGFuZCBpbnQpLlxuICAgICAgICB9XG4gICAgbWF0Y2hlc0NvbXBhcmlzb24oZSkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMub3ApIHtcbiAgICAgICAgICBjYXNlIFwiPFwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZSA8IDA7XG5cbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIGUgPD0gMDtcblxuICAgICAgICAgIGNhc2UgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiAwID09PSBlO1xuXG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiAwICE9PSBlO1xuXG4gICAgICAgICAgY2FzZSBcIj5cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIGUgPiAwO1xuXG4gICAgICAgICAgY2FzZSBcIj49XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiBlID49IDA7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc0luZXF1YWxpdHkoKSB7XG4gICAgICAgIHJldHVybiBbIFwiPFwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTiAqLyAsIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi8gLCBcIj5cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU4gKi8gLCBcIj49XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOX09SX0VRVUFMICovICwgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyAsIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovIF0uaW5kZXhPZih0aGlzLm9wKSA+PSAwO1xuICAgIH1cbiAgICBnZXRGbGF0dGVuZWRGaWx0ZXJzKCkge1xuICAgICAgICByZXR1cm4gWyB0aGlzIF07XG4gICAgfVxuICAgIGdldEZpbHRlcnMoKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMgXTtcbiAgICB9XG59XG5cbmNsYXNzIENvbXBvc2l0ZUZpbHRlciBleHRlbmRzIEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpbHRlcnMgPSBlLCB0aGlzLm9wID0gdCwgdGhpcy5hZSA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBmaWx0ZXIgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGFyZ3VtZW50cy5cbiAgICAgKi8gICAgc3RhdGljIGNyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29tcG9zaXRlRmlsdGVyKGUsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKHRoaXMpID8gdm9pZCAwID09PSB0aGlzLmZpbHRlcnMuZmluZCgodCA9PiAhdC5tYXRjaGVzKGUpKSkgOiB2b2lkIDAgIT09IHRoaXMuZmlsdGVycy5maW5kKCh0ID0+IHQubWF0Y2hlcyhlKSkpO1xuICAgIH1cbiAgICBnZXRGbGF0dGVuZWRGaWx0ZXJzKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5hZSB8fCAodGhpcy5hZSA9IHRoaXMuZmlsdGVycy5yZWR1Y2UoKChlLCB0KSA9PiBlLmNvbmNhdCh0LmdldEZsYXR0ZW5lZEZpbHRlcnMoKSkpLCBbXSkpLCBcbiAgICAgICAgdGhpcy5hZTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIG11dGFibGUgY29weSBvZiBgdGhpcy5maWx0ZXJzYFxuICAgIGdldEZpbHRlcnMoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFtdLCB0aGlzLmZpbHRlcnMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzQ29uanVuY3Rpb24oZSkge1xuICAgIHJldHVybiBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyA9PT0gZS5vcDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRGlzanVuY3Rpb24oZSkge1xuICAgIHJldHVybiBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8gPT09IGUub3A7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgZmlsdGVyIGlzIGEgY29uanVuY3Rpb24gb2YgZmllbGQgZmlsdGVycyBvbmx5LiBSZXR1cm5zIGZhbHNlIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0Q29uanVuY3Rpb24oZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0KGUpICYmIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKGUpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGZpbHRlciBkb2VzIG5vdCBjb250YWluIGFueSBjb21wb3NpdGUgZmlsdGVycy4gUmV0dXJucyBmYWxzZSBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdChlKSB7XG4gICAgZm9yIChjb25zdCB0IG9mIGUuZmlsdGVycykgaWYgKHQgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIpIHJldHVybiAhMTtcbiAgICByZXR1cm4gITA7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeUZpbHRlcihlKSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlcikgXG4gICAgLy8gVE9ETyhiLzI5MTgzMTY1KTogVGVjaG5pY2FsbHksIHRoaXMgd29uJ3QgYmUgdW5pcXVlIGlmIHR3byB2YWx1ZXMgaGF2ZVxuICAgIC8vIHRoZSBzYW1lIGRlc2NyaXB0aW9uLCBzdWNoIGFzIHRoZSBpbnQgMyBhbmQgdGhlIHN0cmluZyBcIjNcIi4gU28gd2Ugc2hvdWxkXG4gICAgLy8gYWRkIHRoZSB0eXBlcyBpbiBoZXJlIHNvbWVob3csIHRvby5cbiAgICByZXR1cm4gZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSArIGUub3AudG9TdHJpbmcoKSArIGNhbm9uaWNhbElkKGUudmFsdWUpO1xuICAgIGlmIChfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0Q29uanVuY3Rpb24oZSkpIFxuICAgIC8vIE9sZGVyIFNESyB2ZXJzaW9ucyB1c2UgYW4gaW1wbGljaXQgQU5EIG9wZXJhdGlvbiBiZXR3ZWVuIHRoZWlyIGZpbHRlcnMuXG4gICAgLy8gSW4gdGhlIG5ldyBTREsgdmVyc2lvbnMsIHRoZSBkZXZlbG9wZXIgbWF5IHVzZSBhbiBleHBsaWNpdCBBTkQgZmlsdGVyLlxuICAgIC8vIFRvIHN0YXkgY29uc2lzdGVudCB3aXRoIHRoZSBvbGQgdXNhZ2VzLCB3ZSBhZGQgYSBzcGVjaWFsIGNhc2UgdG8gZW5zdXJlXG4gICAgLy8gdGhlIGNhbm9uaWNhbCBJRCBmb3IgdGhlc2UgdHdvIGFyZSB0aGUgc2FtZS4gRm9yIGV4YW1wbGU6XG4gICAgLy8gYGNvbC53aGVyZUVxdWFscyhcImFcIiwgMSkud2hlcmVFcXVhbHMoXCJiXCIsIDIpYCBzaG91bGQgaGF2ZSB0aGUgc2FtZVxuICAgIC8vIGNhbm9uaWNhbCBJRCBhcyBgY29sLndoZXJlKGFuZChlcXVhbHMoXCJhXCIsMSksIGVxdWFscyhcImJcIiwyKSkpYC5cbiAgICByZXR1cm4gZS5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlGaWx0ZXIoZSkpKS5qb2luKFwiLFwiKTtcbiAgICB7XG4gICAgICAgIC8vIGZpbHRlciBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlclxuICAgICAgICBjb25zdCB0ID0gZS5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlGaWx0ZXIoZSkpKS5qb2luKFwiLFwiKTtcbiAgICAgICAgcmV0dXJuIGAke2Uub3B9KCR7dH0pYDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maWx0ZXJFcXVhbHMoZSwgdCkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRGaWx0ZXJFcXVhbHMoZSwgdCkge1xuICAgICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyICYmIGUub3AgPT09IHQub3AgJiYgZS5maWVsZC5pc0VxdWFsKHQuZmllbGQpICYmIF9fUFJJVkFURV92YWx1ZUVxdWFscyhlLnZhbHVlLCB0LnZhbHVlKTtcbiAgICB9KGUsIHQpIDogZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJFcXVhbHMoZSwgdCkge1xuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiBlLm9wID09PSB0Lm9wICYmIGUuZmlsdGVycy5sZW5ndGggPT09IHQuZmlsdGVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBlLmZpbHRlcnMucmVkdWNlKCgoZSwgbiwgcikgPT4gZSAmJiBfX1BSSVZBVEVfZmlsdGVyRXF1YWxzKG4sIHQuZmlsdGVyc1tyXSkpLCAhMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvKipcbiAqIFJldHVybnMgYSBuZXcgY29tcG9zaXRlIGZpbHRlciB0aGF0IGNvbnRhaW5zIGFsbCBmaWx0ZXIgZnJvbVxuICogYGNvbXBvc2l0ZUZpbHRlcmAgcGx1cyBhbGwgdGhlIGdpdmVuIGZpbHRlcnMgaW4gYG90aGVyRmlsdGVyc2AuXG4gKi8gKGUsIHQpIDogdm9pZCBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJXaXRoQWRkZWRGaWx0ZXJzKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZS5maWx0ZXJzLmNvbmNhdCh0KTtcbiAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShuLCBlLm9wKTtcbn1cblxuLyoqIFJldHVybnMgYSBkZWJ1ZyBkZXNjcmlwdGlvbiBmb3IgYGZpbHRlcmAuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9zdHJpbmdpZnlGaWx0ZXIoZSkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5RmllbGRGaWx0ZXIoZSkge1xuICAgICAgICByZXR1cm4gYCR7ZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKX0gJHtlLm9wfSAke2Nhbm9uaWNhbElkKGUudmFsdWUpfWA7XG4gICAgfVxuICAgIC8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgKGkuZS4gJ19fbmFtZV9fJykuICovIChlKSA6IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5Q29tcG9zaXRlRmlsdGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIGUub3AudG9TdHJpbmcoKSArIFwiIHtcIiArIGUuZ2V0RmlsdGVycygpLm1hcChfX1BSSVZBVEVfc3RyaW5naWZ5RmlsdGVyKS5qb2luKFwiICxcIikgKyBcIn1cIjtcbiAgICB9KGUpIDogXCJGaWx0ZXJcIjtcbn1cblxuY2xhc3MgX19QUklWQVRFX0tleUZpZWxkRmlsdGVyIGV4dGVuZHMgRmllbGRGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoZSwgdCwgbiksIHRoaXMua2V5ID0gRG9jdW1lbnRLZXkuZnJvbU5hbWUobi5yZWZlcmVuY2VWYWx1ZSk7XG4gICAgfVxuICAgIG1hdGNoZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gRG9jdW1lbnRLZXkuY29tcGFyYXRvcihlLmtleSwgdGhpcy5rZXkpO1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRjaGVzQ29tcGFyaXNvbih0KTtcbiAgICB9XG59XG5cbi8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgd2l0aGluIGFuIGFycmF5LiAqLyBjbGFzcyBfX1BSSVZBVEVfS2V5RmllbGRJbkZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIHQpLCB0aGlzLmtleXMgPSBfX1BSSVZBVEVfZXh0cmFjdERvY3VtZW50S2V5c0Zyb21BcnJheVZhbHVlKFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua2V5cy5zb21lKCh0ID0+IHQuaXNFcXVhbChlLmtleSkpKTtcbiAgICB9XG59XG5cbi8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgbm90IHByZXNlbnQgd2l0aGluIGFuIGFycmF5LiAqLyBjbGFzcyBfX1BSSVZBVEVfS2V5RmllbGROb3RJbkZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovICwgdCksIHRoaXMua2V5cyA9IF9fUFJJVkFURV9leHRyYWN0RG9jdW1lbnRLZXlzRnJvbUFycmF5VmFsdWUoXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5rZXlzLnNvbWUoKHQgPT4gdC5pc0VxdWFsKGUua2V5KSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2V4dHJhY3REb2N1bWVudEtleXNGcm9tQXJyYXlWYWx1ZShlLCB0KSB7XG4gICAgdmFyIG47XG4gICAgcmV0dXJuICgobnVsbCA9PT0gKG4gPSB0LmFycmF5VmFsdWUpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4udmFsdWVzKSB8fCBbXSkubWFwKChlID0+IERvY3VtZW50S2V5LmZyb21OYW1lKGUucmVmZXJlbmNlVmFsdWUpKSk7XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIGFycmF5LWNvbnRhaW5zIG9wZXJhdG9yLiAqLyBjbGFzcyBfX1BSSVZBVEVfQXJyYXlDb250YWluc0ZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIGlzQXJyYXkodCkgJiYgX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyh0LmFycmF5VmFsdWUsIHRoaXMudmFsdWUpO1xuICAgIH1cbn1cblxuLyoqIEEgRmlsdGVyIHRoYXQgaW1wbGVtZW50cyB0aGUgSU4gb3BlcmF0b3IuICovIGNsYXNzIF9fUFJJVkFURV9JbkZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHQgJiYgX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyh0aGlzLnZhbHVlLmFycmF5VmFsdWUsIHQpO1xuICAgIH1cbn1cblxuLyoqIEEgRmlsdGVyIHRoYXQgaW1wbGVtZW50cyB0aGUgbm90LWluIG9wZXJhdG9yLiAqLyBjbGFzcyBfX1BSSVZBVEVfTm90SW5GaWx0ZXIgZXh0ZW5kcyBGaWVsZEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAsIHQpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgaWYgKF9fUFJJVkFURV9hcnJheVZhbHVlQ29udGFpbnModGhpcy52YWx1ZS5hcnJheVZhbHVlLCB7XG4gICAgICAgICAgICBudWxsVmFsdWU6IFwiTlVMTF9WQUxVRVwiXG4gICAgICAgIH0pKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0ICYmICFfX1BSSVZBVEVfYXJyYXlWYWx1ZUNvbnRhaW5zKHRoaXMudmFsdWUuYXJyYXlWYWx1ZSwgdCk7XG4gICAgfVxufVxuXG4vKiogQSBGaWx0ZXIgdGhhdCBpbXBsZW1lbnRzIHRoZSBhcnJheS1jb250YWlucy1hbnkgb3BlcmF0b3IuICovIGNsYXNzIF9fUFJJVkFURV9BcnJheUNvbnRhaW5zQW55RmlsdGVyIGV4dGVuZHMgRmllbGRGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoZSwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiAhKCFpc0FycmF5KHQpIHx8ICF0LmFycmF5VmFsdWUudmFsdWVzKSAmJiB0LmFycmF5VmFsdWUudmFsdWVzLnNvbWUoKGUgPT4gX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyh0aGlzLnZhbHVlLmFycmF5VmFsdWUsIGUpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgX19QUklWQVRFX1RhcmdldEltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQgPSBudWxsLCBuID0gW10sIHIgPSBbXSwgaSA9IG51bGwsIHMgPSBudWxsLCBvID0gbnVsbCkge1xuICAgICAgICB0aGlzLnBhdGggPSBlLCB0aGlzLmNvbGxlY3Rpb25Hcm91cCA9IHQsIHRoaXMub3JkZXJCeSA9IG4sIHRoaXMuZmlsdGVycyA9IHIsIHRoaXMubGltaXQgPSBpLCBcbiAgICAgICAgdGhpcy5zdGFydEF0ID0gcywgdGhpcy5lbmRBdCA9IG8sIHRoaXMudWUgPSBudWxsO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhIFRhcmdldCB3aXRoIGEgcGF0aCBhbmQgb3B0aW9uYWwgYWRkaXRpb25hbCBxdWVyeSBjb25zdHJhaW50cy5cbiAqIFBhdGggbXVzdCBjdXJyZW50bHkgYmUgZW1wdHkgaWYgdGhpcyBpcyBhIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcnkuXG4gKlxuICogTk9URTogeW91IHNob3VsZCBhbHdheXMgY29uc3RydWN0IGBUYXJnZXRgIGZyb20gYFF1ZXJ5LnRvVGFyZ2V0YCBpbnN0ZWFkIG9mXG4gKiB1c2luZyB0aGlzIGZhY3RvcnkgbWV0aG9kLCBiZWNhdXNlIGBRdWVyeWAgcHJvdmlkZXMgYW4gaW1wbGljaXQgYG9yZGVyQnlgXG4gKiBwcm9wZXJ0eS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3VGFyZ2V0KGUsIHQgPSBudWxsLCBuID0gW10sIHIgPSBbXSwgaSA9IG51bGwsIHMgPSBudWxsLCBvID0gbnVsbCkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1RhcmdldEltcGwoZSwgdCwgbiwgciwgaSwgcywgbyk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeVRhcmdldChlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgaWYgKG51bGwgPT09IHQudWUpIHtcbiAgICAgICAgbGV0IGUgPSB0LnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgICAgIG51bGwgIT09IHQuY29sbGVjdGlvbkdyb3VwICYmIChlICs9IFwifGNnOlwiICsgdC5jb2xsZWN0aW9uR3JvdXApLCBlICs9IFwifGY6XCIsIGUgKz0gdC5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlGaWx0ZXIoZSkpKS5qb2luKFwiLFwiKSwgXG4gICAgICAgIGUgKz0gXCJ8b2I6XCIsIGUgKz0gdC5vcmRlckJ5Lm1hcCgoZSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlPcmRlckJ5KGUpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oYi8yOTE4MzE2NSk6IE1ha2UgdGhpcyBjb2xsaXNpb24gcm9idXN0LlxuICAgICAgICAgICAgcmV0dXJuIGUuZmllbGQuY2Fub25pY2FsU3RyaW5nKCkgKyBlLmRpcjtcbiAgICAgICAgfShlKSkpLmpvaW4oXCIsXCIpLCBfX1BSSVZBVEVfaXNOdWxsT3JVbmRlZmluZWQodC5saW1pdCkgfHwgKGUgKz0gXCJ8bDpcIiwgZSArPSB0LmxpbWl0KSwgXG4gICAgICAgIHQuc3RhcnRBdCAmJiAoZSArPSBcInxsYjpcIiwgZSArPSB0LnN0YXJ0QXQuaW5jbHVzaXZlID8gXCJiOlwiIDogXCJhOlwiLCBlICs9IHQuc3RhcnRBdC5wb3NpdGlvbi5tYXAoKGUgPT4gY2Fub25pY2FsSWQoZSkpKS5qb2luKFwiLFwiKSksIFxuICAgICAgICB0LmVuZEF0ICYmIChlICs9IFwifHViOlwiLCBlICs9IHQuZW5kQXQuaW5jbHVzaXZlID8gXCJhOlwiIDogXCJiOlwiLCBlICs9IHQuZW5kQXQucG9zaXRpb24ubWFwKChlID0+IGNhbm9uaWNhbElkKGUpKSkuam9pbihcIixcIikpLCBcbiAgICAgICAgdC51ZSA9IGU7XG4gICAgfVxuICAgIHJldHVybiB0LnVlO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0RXF1YWxzKGUsIHQpIHtcbiAgICBpZiAoZS5saW1pdCAhPT0gdC5saW1pdCkgcmV0dXJuICExO1xuICAgIGlmIChlLm9yZGVyQnkubGVuZ3RoICE9PSB0Lm9yZGVyQnkubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLm9yZGVyQnkubGVuZ3RoOyBuKyspIGlmICghX19QUklWQVRFX29yZGVyQnlFcXVhbHMoZS5vcmRlckJ5W25dLCB0Lm9yZGVyQnlbbl0pKSByZXR1cm4gITE7XG4gICAgaWYgKGUuZmlsdGVycy5sZW5ndGggIT09IHQuZmlsdGVycy5sZW5ndGgpIHJldHVybiAhMTtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUuZmlsdGVycy5sZW5ndGg7IG4rKykgaWYgKCFfX1BSSVZBVEVfZmlsdGVyRXF1YWxzKGUuZmlsdGVyc1tuXSwgdC5maWx0ZXJzW25dKSkgcmV0dXJuICExO1xuICAgIHJldHVybiBlLmNvbGxlY3Rpb25Hcm91cCA9PT0gdC5jb2xsZWN0aW9uR3JvdXAgJiYgKCEhZS5wYXRoLmlzRXF1YWwodC5wYXRoKSAmJiAoISFfX1BSSVZBVEVfYm91bmRFcXVhbHMoZS5zdGFydEF0LCB0LnN0YXJ0QXQpICYmIF9fUFJJVkFURV9ib3VuZEVxdWFscyhlLmVuZEF0LCB0LmVuZEF0KSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0SXNEb2N1bWVudFRhcmdldChlKSB7XG4gICAgcmV0dXJuIERvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkoZS5wYXRoKSAmJiBudWxsID09PSBlLmNvbGxlY3Rpb25Hcm91cCAmJiAwID09PSBlLmZpbHRlcnMubGVuZ3RoO1xufVxuXG4vKiogUmV0dXJucyB0aGUgZmllbGQgZmlsdGVycyB0aGF0IHRhcmdldCB0aGUgZ2l2ZW4gZmllbGQgcGF0aC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldEZpZWxkRmlsdGVyc0ZvclBhdGgoZSwgdCkge1xuICAgIHJldHVybiBlLmZpbHRlcnMuZmlsdGVyKChlID0+IGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciAmJiBlLmZpZWxkLmlzRXF1YWwodCkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZXMgdGhhdCBhcmUgdXNlZCBpbiBBUlJBWV9DT05UQUlOUyBvciBBUlJBWV9DT05UQUlOU19BTllcbiAqIGZpbHRlcnMuIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGFyZSBubyBzdWNoIGZpbHRlcnMuXG4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWUgdG8gdXNlIGFzIHRoZSBsb3dlciBib3VuZCBmb3IgYXNjZW5kaW5nIGluZGV4IHNlZ21lbnQgYXRcbiAqIHRoZSBwcm92aWRlZCBgZmllbGRQYXRoYCAob3IgdGhlIHVwcGVyIGJvdW5kIGZvciBhbiBkZXNjZW5kaW5nIHNlZ21lbnQpLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0R2V0QXNjZW5kaW5nQm91bmQoZSwgdCwgbikge1xuICAgIGxldCByID0gaWUsIGkgPSAhMDtcbiAgICAvLyBQcm9jZXNzIGFsbCBmaWx0ZXJzIHRvIGZpbmQgYSB2YWx1ZSBmb3IgdGhlIGN1cnJlbnQgZmllbGQgc2VnbWVudFxuICAgIGZvciAoY29uc3QgbiBvZiBfX1BSSVZBVEVfdGFyZ2V0R2V0RmllbGRGaWx0ZXJzRm9yUGF0aChlLCB0KSkge1xuICAgICAgICBsZXQgZSA9IGllLCB0ID0gITA7XG4gICAgICAgIHN3aXRjaCAobi5vcCkge1xuICAgICAgICAgIGNhc2UgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovIDpcbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgZSA9IF9fUFJJVkFURV92YWx1ZXNHZXRMb3dlckJvdW5kKG4udmFsdWUpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gOlxuICAgICAgICAgIGNhc2UgXCI+PVwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgICBlID0gbi52YWx1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj5cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU4gKi8gOlxuICAgICAgICAgICAgZSA9IG4udmFsdWUsIHQgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovIDpcbiAgICAgICAgICAgIGUgPSBpZTtcbiAvLyBSZW1haW5pbmcgZmlsdGVycyBjYW5ub3QgYmUgdXNlZCBhcyBsb3dlciBib3VuZHMuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICBfX1BSSVZBVEVfbG93ZXJCb3VuZENvbXBhcmUoe1xuICAgICAgICAgICAgdmFsdWU6IHIsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgdmFsdWU6IGUsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IHRcbiAgICAgICAgfSkgPCAwICYmIChyID0gZSwgaSA9IHQpO1xuICAgIH1cbiAgICAvLyBJZiB0aGVyZSBpcyBhbiBhZGRpdGlvbmFsIGJvdW5kLCBjb21wYXJlIHRoZSB2YWx1ZXMgYWdhaW5zdCB0aGUgZXhpc3RpbmdcbiAgICAvLyByYW5nZSB0byBzZWUgaWYgd2UgY2FuIG5hcnJvdyB0aGUgc2NvcGUuXG4gICAgICAgIGlmIChudWxsICE9PSBuKSBmb3IgKGxldCBzID0gMDsgcyA8IGUub3JkZXJCeS5sZW5ndGg7ICsrcykge1xuICAgICAgICBpZiAoZS5vcmRlckJ5W3NdLmZpZWxkLmlzRXF1YWwodCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuLnBvc2l0aW9uW3NdO1xuICAgICAgICAgICAgX19QUklWQVRFX2xvd2VyQm91bmRDb21wYXJlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogcixcbiAgICAgICAgICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogZSxcbiAgICAgICAgICAgICAgICBpbmNsdXNpdmU6IG4uaW5jbHVzaXZlXG4gICAgICAgICAgICB9KSA8IDAgJiYgKHIgPSBlLCBpID0gbi5pbmNsdXNpdmUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IHIsXG4gICAgICAgIGluY2x1c2l2ZTogaVxuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWUgdG8gdXNlIGFzIHRoZSB1cHBlciBib3VuZCBmb3IgYXNjZW5kaW5nIGluZGV4IHNlZ21lbnQgYXRcbiAqIHRoZSBwcm92aWRlZCBgZmllbGRQYXRoYCAob3IgdGhlIGxvd2VyIGJvdW5kIGZvciBhIGRlc2NlbmRpbmcgc2VnbWVudCkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldERlc2NlbmRpbmdCb3VuZChlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSByZSwgaSA9ICEwO1xuICAgIC8vIFByb2Nlc3MgYWxsIGZpbHRlcnMgdG8gZmluZCBhIHZhbHVlIGZvciB0aGUgY3VycmVudCBmaWVsZCBzZWdtZW50XG4gICAgZm9yIChjb25zdCBuIG9mIF9fUFJJVkFURV90YXJnZXRHZXRGaWVsZEZpbHRlcnNGb3JQYXRoKGUsIHQpKSB7XG4gICAgICAgIGxldCBlID0gcmUsIHQgPSAhMDtcbiAgICAgICAgc3dpdGNoIChuLm9wKSB7XG4gICAgICAgICAgY2FzZSBcIj49XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLyA6XG4gICAgICAgICAgICBlID0gX19QUklWQVRFX3ZhbHVlc0dldFVwcGVyQm91bmQobi52YWx1ZSksIHQgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gOlxuICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgZSA9IG4udmFsdWU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovIDpcbiAgICAgICAgICAgIGUgPSBuLnZhbHVlLCB0ID0gITE7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA6XG4gICAgICAgICAgICBlID0gcmU7XG4gLy8gUmVtYWluaW5nIGZpbHRlcnMgY2Fubm90IGJlIHVzZWQgYXMgdXBwZXIgYm91bmRzLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgX19QUklWQVRFX3VwcGVyQm91bmRDb21wYXJlKHtcbiAgICAgICAgICAgIHZhbHVlOiByLFxuICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHZhbHVlOiBlLFxuICAgICAgICAgICAgaW5jbHVzaXZlOiB0XG4gICAgICAgIH0pID4gMCAmJiAociA9IGUsIGkgPSB0KTtcbiAgICB9XG4gICAgLy8gSWYgdGhlcmUgaXMgYW4gYWRkaXRpb25hbCBib3VuZCwgY29tcGFyZSB0aGUgdmFsdWVzIGFnYWluc3QgdGhlIGV4aXN0aW5nXG4gICAgLy8gcmFuZ2UgdG8gc2VlIGlmIHdlIGNhbiBuYXJyb3cgdGhlIHNjb3BlLlxuICAgICAgICBpZiAobnVsbCAhPT0gbikgZm9yIChsZXQgcyA9IDA7IHMgPCBlLm9yZGVyQnkubGVuZ3RoOyArK3MpIHtcbiAgICAgICAgaWYgKGUub3JkZXJCeVtzXS5maWVsZC5pc0VxdWFsKHQpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbi5wb3NpdGlvbltzXTtcbiAgICAgICAgICAgIF9fUFJJVkFURV91cHBlckJvdW5kQ29tcGFyZSh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHIsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGUsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBuLmluY2x1c2l2ZVxuICAgICAgICAgICAgfSkgPiAwICYmIChyID0gZSwgaSA9IG4uaW5jbHVzaXZlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiByLFxuICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICB9O1xufVxuXG4vKiogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHNlZ21lbnRzIG9mIGEgcGVyZmVjdCBpbmRleCBmb3IgdGhpcyB0YXJnZXQuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBRdWVyeSBlbmNhcHN1bGF0ZXMgYWxsIHRoZSBxdWVyeSBhdHRyaWJ1dGVzIHdlIHN1cHBvcnQgaW4gdGhlIFNESy4gSXQgY2FuXG4gKiBiZSBydW4gYWdhaW5zdCB0aGUgTG9jYWxTdG9yZSwgYXMgd2VsbCBhcyBiZSBjb252ZXJ0ZWQgdG8gYSBgVGFyZ2V0YCB0b1xuICogcXVlcnkgdGhlIFJlbW90ZVN0b3JlIHJlc3VsdHMuXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5SW1wbCB7XG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgYSBRdWVyeSB3aXRoIGEgcGF0aCBhbmQgb3B0aW9uYWwgYWRkaXRpb25hbCBxdWVyeSBjb25zdHJhaW50cy5cbiAgICAgKiBQYXRoIG11c3QgY3VycmVudGx5IGJlIGVtcHR5IGlmIHRoaXMgaXMgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5LlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQgPSBudWxsLCBuID0gW10sIHIgPSBbXSwgaSA9IG51bGwsIHMgPSBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gLCBvID0gbnVsbCwgXyA9IG51bGwpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gZSwgdGhpcy5jb2xsZWN0aW9uR3JvdXAgPSB0LCB0aGlzLmV4cGxpY2l0T3JkZXJCeSA9IG4sIHRoaXMuZmlsdGVycyA9IHIsIFxuICAgICAgICB0aGlzLmxpbWl0ID0gaSwgdGhpcy5saW1pdFR5cGUgPSBzLCB0aGlzLnN0YXJ0QXQgPSBvLCB0aGlzLmVuZEF0ID0gXywgdGhpcy5jZSA9IG51bGwsIFxuICAgICAgICAvLyBUaGUgY29ycmVzcG9uZGluZyBgVGFyZ2V0YCBvZiB0aGlzIGBRdWVyeWAgaW5zdGFuY2UsIGZvciB1c2Ugd2l0aFxuICAgICAgICAvLyBub24tYWdncmVnYXRlIHF1ZXJpZXMuXG4gICAgICAgIHRoaXMubGUgPSBudWxsLCBcbiAgICAgICAgLy8gVGhlIGNvcnJlc3BvbmRpbmcgYFRhcmdldGAgb2YgdGhpcyBgUXVlcnlgIGluc3RhbmNlLCBmb3IgdXNlIHdpdGhcbiAgICAgICAgLy8gYWdncmVnYXRlIHF1ZXJpZXMuIFVubGlrZSB0YXJnZXRzIGZvciBub24tYWdncmVnYXRlIHF1ZXJpZXMsXG4gICAgICAgIC8vIGFnZ3JlZ2F0ZSBxdWVyeSB0YXJnZXRzIGRvIG5vdCBjb250YWluIG5vcm1hbGl6ZWQgb3JkZXItYnlzLCB0aGV5IG9ubHlcbiAgICAgICAgLy8gY29udGFpbiBleHBsaWNpdCBvcmRlci1ieXMuXG4gICAgICAgIHRoaXMuaGUgPSBudWxsLCB0aGlzLnN0YXJ0QXQsIHRoaXMuZW5kQXQ7XG4gICAgfVxufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBRdWVyeSBpbnN0YW5jZSB3aXRoIHRoZSBvcHRpb25zIHByb3ZpZGVkLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnkoZSwgdCwgbiwgciwgaSwgcywgbywgXykge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlLCB0LCBuLCByLCBpLCBzLCBvLCBfKTtcbn1cblxuLyoqIENyZWF0ZXMgYSBuZXcgUXVlcnkgZm9yIGEgcXVlcnkgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHMgYXQgYHBhdGhgICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gY29udmVydCBhIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcnkgaW50byBhIGNvbGxlY3Rpb24gcXVlcnkgYXQgYVxuICogc3BlY2lmaWMgcGF0aC4gVGhpcyBpcyB1c2VkIHdoZW4gZXhlY3V0aW5nIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcmllcywgc2luY2VcbiAqIHdlIGhhdmUgdG8gc3BsaXQgdGhlIHF1ZXJ5IGludG8gYSBzZXQgb2YgY29sbGVjdGlvbiBxdWVyaWVzIGF0IG11bHRpcGxlXG4gKiBwYXRocy5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBxdWVyeSBkb2VzIG5vdCBzcGVjaWZ5IGFueSBxdWVyeSBjb25zdHJhaW50cyB0aGF0XG4gKiBjb3VsZCByZW1vdmUgcmVzdWx0cy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlc0FsbERvY3VtZW50cyhlKSB7XG4gICAgcmV0dXJuIDAgPT09IGUuZmlsdGVycy5sZW5ndGggJiYgbnVsbCA9PT0gZS5saW1pdCAmJiBudWxsID09IGUuc3RhcnRBdCAmJiBudWxsID09IGUuZW5kQXQgJiYgKDAgPT09IGUuZXhwbGljaXRPcmRlckJ5Lmxlbmd0aCB8fCAxID09PSBlLmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggJiYgZS5leHBsaWNpdE9yZGVyQnlbMF0uZmllbGQuaXNLZXlGaWVsZCgpKTtcbn1cblxuLy8gUmV0dXJucyB0aGUgc29ydGVkIHNldCBvZiBpbmVxdWFsaXR5IGZpbHRlciBmaWVsZHMgdXNlZCBpbiB0aGlzIHF1ZXJ5LlxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHF1ZXJ5IG1hdGNoZXMgYSBjb2xsZWN0aW9uIGdyb3VwIHJhdGhlciB0aGFuIGEgc3BlY2lmaWNcbiAqIGNvbGxlY3Rpb24uXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc0NvbGxlY3Rpb25Hcm91cFF1ZXJ5KGUpIHtcbiAgICByZXR1cm4gbnVsbCAhPT0gZS5jb2xsZWN0aW9uR3JvdXA7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgbm9ybWFsaXplZCBvcmRlci1ieSBjb25zdHJhaW50IHRoYXQgaXMgdXNlZCB0byBleGVjdXRlIHRoZSBRdWVyeSxcbiAqIHdoaWNoIGNhbiBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgb3JkZXItYnkgY29uc3RyYWludHMgdGhlIHVzZXIgcHJvdmlkZWQgKGUuZy5cbiAqIHRoZSBTREsgYW5kIGJhY2tlbmQgYWx3YXlzIG9yZGVycyBieSBgX19uYW1lX19gKS4gVGhlIG5vcm1hbGl6ZWQgb3JkZXItYnlcbiAqIGluY2x1ZGVzIGltcGxpY2l0IG9yZGVyLWJ5cyBpbiBhZGRpdGlvbiB0byB0aGUgZXhwbGljaXQgdXNlciBwcm92aWRlZFxuICogb3JkZXItYnlzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU5vcm1hbGl6ZWRPcmRlckJ5KGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBpZiAobnVsbCA9PT0gdC5jZSkge1xuICAgICAgICB0LmNlID0gW107XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgU2V0O1xuICAgICAgICAvLyBBbnkgZXhwbGljaXQgb3JkZXIgYnkgZmllbGRzIHNob3VsZCBiZSBhZGRlZCBhcyBpcy5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdC5leHBsaWNpdE9yZGVyQnkpIHQuY2UucHVzaChuKSwgZS5hZGQobi5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSk7XG4gICAgICAgIC8vIFRoZSBvcmRlciBvZiB0aGUgaW1wbGljaXQgb3JkZXJpbmcgYWx3YXlzIG1hdGNoZXMgdGhlIGxhc3QgZXhwbGljaXQgb3JkZXIgYnkuXG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IHQuZXhwbGljaXRPcmRlckJ5Lmxlbmd0aCA+IDAgPyB0LmV4cGxpY2l0T3JkZXJCeVt0LmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggLSAxXS5kaXIgOiBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8gLCByID0gZnVuY3Rpb24gX19QUklWQVRFX2dldEluZXF1YWxpdHlGaWx0ZXJGaWVsZHMoZSkge1xuICAgICAgICAgICAgbGV0IHQgPSBuZXcgU29ydGVkU2V0KEZpZWxkUGF0aCQxLmNvbXBhcmF0b3IpO1xuICAgICAgICAgICAgcmV0dXJuIGUuZmlsdGVycy5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICBlLmdldEZsYXR0ZW5lZEZpbHRlcnMoKS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZS5pc0luZXF1YWxpdHkoKSAmJiAodCA9IHQuYWRkKGUuZmllbGQpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSksIHQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBDcmVhdGVzIGEgbmV3IFF1ZXJ5IGZvciBhIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcnkgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHNcbiAqIHdpdGhpbiB0aGUgcHJvdmlkZWQgY29sbGVjdGlvbiBncm91cC5cbiAqLyAodCk7XG4gICAgICAgIC8vIEFueSBpbmVxdWFsaXR5IGZpZWxkcyBub3QgZXhwbGljaXRseSBvcmRlcmVkIHNob3VsZCBiZSBpbXBsaWNpdGx5IG9yZGVyZWQgaW4gYSBsZXhpY29ncmFwaGljYWxcbiAgICAgICAgLy8gb3JkZXIuIFdoZW4gdGhlcmUgYXJlIG11bHRpcGxlIGluZXF1YWxpdHkgZmlsdGVycyBvbiB0aGUgc2FtZSBmaWVsZCwgdGhlIGZpZWxkIHNob3VsZCBiZSBhZGRlZFxuICAgICAgICAvLyBvbmx5IG9uY2UuXG4gICAgICAgIC8vIE5vdGU6IGBTb3J0ZWRTZXQ8RmllbGRQYXRoPmAgc29ydHMgdGhlIGtleSBmaWVsZCBiZWZvcmUgb3RoZXIgZmllbGRzLiBIb3dldmVyLCB3ZSB3YW50IHRoZSBrZXlcbiAgICAgICAgLy8gZmllbGQgdG8gYmUgc29ydGVkIGxhc3QuXG4gICAgICAgICAgICAgICAgci5mb3JFYWNoKChyID0+IHtcbiAgICAgICAgICAgIGUuaGFzKHIuY2Fub25pY2FsU3RyaW5nKCkpIHx8IHIuaXNLZXlGaWVsZCgpIHx8IHQuY2UucHVzaChuZXcgT3JkZXJCeShyLCBuKSk7XG4gICAgICAgIH0pKSwgXG4gICAgICAgIC8vIEFkZCB0aGUgZG9jdW1lbnQga2V5IGZpZWxkIHRvIHRoZSBsYXN0IGlmIGl0IGlzIG5vdCBleHBsaWNpdGx5IG9yZGVyZWQuXG4gICAgICAgIGUuaGFzKEZpZWxkUGF0aCQxLmtleUZpZWxkKCkuY2Fub25pY2FsU3RyaW5nKCkpIHx8IHQuY2UucHVzaChuZXcgT3JkZXJCeShGaWVsZFBhdGgkMS5rZXlGaWVsZCgpLCBuKSk7XG4gICAgfVxuICAgIHJldHVybiB0LmNlO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIHRoaXMgYFF1ZXJ5YCBpbnN0YW5jZSB0byBpdHMgY29ycmVzcG9uZGluZyBgVGFyZ2V0YCByZXByZXNlbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIHQubGUgfHwgKHQubGUgPSBfX1BSSVZBVEVfX3F1ZXJ5VG9UYXJnZXQodCwgX19QUklWQVRFX3F1ZXJ5Tm9ybWFsaXplZE9yZGVyQnkoZSkpKSwgXG4gICAgdC5sZTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyB0aGlzIGBRdWVyeWAgaW5zdGFuY2UgdG8gaXRzIGNvcnJlc3BvbmRpbmcgYFRhcmdldGAgcmVwcmVzZW50YXRpb24sXG4gKiBmb3IgdXNlIHdpdGhpbiBhbiBhZ2dyZWdhdGUgcXVlcnkuIFVubGlrZSB0YXJnZXRzIGZvciBub24tYWdncmVnYXRlIHF1ZXJpZXMsXG4gKiBhZ2dyZWdhdGUgcXVlcnkgdGFyZ2V0cyBkbyBub3QgY29udGFpbiBub3JtYWxpemVkIG9yZGVyLWJ5cywgdGhleSBvbmx5XG4gKiBjb250YWluIGV4cGxpY2l0IG9yZGVyLWJ5cy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlUb0FnZ3JlZ2F0ZVRhcmdldChlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIHQuaGUgfHwgKFxuICAgIC8vIERvIG5vdCBpbmNsdWRlIGltcGxpY2l0IG9yZGVyLWJ5cyBmb3IgYWdncmVnYXRlIHF1ZXJpZXMuXG4gICAgdC5oZSA9IF9fUFJJVkFURV9fcXVlcnlUb1RhcmdldCh0LCBlLmV4cGxpY2l0T3JkZXJCeSkpLCB0LmhlO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfX3F1ZXJ5VG9UYXJnZXQoZSwgdCkge1xuICAgIGlmIChcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gPT09IGUubGltaXRUeXBlKSByZXR1cm4gX19QUklWQVRFX25ld1RhcmdldChlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCB0LCBlLmZpbHRlcnMsIGUubGltaXQsIGUuc3RhcnRBdCwgZS5lbmRBdCk7XG4gICAge1xuICAgICAgICAvLyBGbGlwIHRoZSBvcmRlckJ5IGRpcmVjdGlvbnMgc2luY2Ugd2Ugd2FudCB0aGUgbGFzdCByZXN1bHRzXG4gICAgICAgIHQgPSB0Lm1hcCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi8gPT09IGUuZGlyID8gXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovIDogXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi87XG4gICAgICAgICAgICByZXR1cm4gbmV3IE9yZGVyQnkoZS5maWVsZCwgdCk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgLy8gV2UgbmVlZCB0byBzd2FwIHRoZSBjdXJzb3JzIHRvIG1hdGNoIHRoZSBub3ctZmxpcHBlZCBxdWVyeSBvcmRlcmluZy5cbiAgICAgICAgY29uc3QgbiA9IGUuZW5kQXQgPyBuZXcgQm91bmQoZS5lbmRBdC5wb3NpdGlvbiwgZS5lbmRBdC5pbmNsdXNpdmUpIDogbnVsbCwgciA9IGUuc3RhcnRBdCA/IG5ldyBCb3VuZChlLnN0YXJ0QXQucG9zaXRpb24sIGUuc3RhcnRBdC5pbmNsdXNpdmUpIDogbnVsbDtcbiAgICAgICAgLy8gTm93IHJldHVybiBhcyBhIExpbWl0VHlwZS5GaXJzdCBxdWVyeS5cbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9uZXdUYXJnZXQoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgdCwgZS5maWx0ZXJzLCBlLmxpbWl0LCBuLCByKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeVdpdGhBZGRlZEZpbHRlcihlLCB0KSB7XG4gICAgY29uc3QgbiA9IGUuZmlsdGVycy5jb25jYXQoWyB0IF0pO1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCBlLmV4cGxpY2l0T3JkZXJCeS5zbGljZSgpLCBuLCBlLmxpbWl0LCBlLmxpbWl0VHlwZSwgZS5zdGFydEF0LCBlLmVuZEF0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5V2l0aExpbWl0KGUsIHQsIG4pIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgZS5maWx0ZXJzLnNsaWNlKCksIHQsIG4sIGUuc3RhcnRBdCwgZS5lbmRBdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeUVxdWFscyhlLCB0KSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV90YXJnZXRFcXVhbHMoX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoZSksIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpKSAmJiBlLmxpbWl0VHlwZSA9PT0gdC5saW1pdFR5cGU7XG59XG5cbi8vIFRPRE8oYi8yOTE4MzE2NSk6IFRoaXMgaXMgdXNlZCB0byBnZXQgYSB1bmlxdWUgc3RyaW5nIGZyb20gYSBxdWVyeSB0bywgZm9yXG4vLyBleGFtcGxlLCB1c2UgYXMgYSBkaWN0aW9uYXJ5IGtleSwgYnV0IHRoZSBpbXBsZW1lbnRhdGlvbiBpcyBzdWJqZWN0IHRvXG4vLyBjb2xsaXNpb25zLiBNYWtlIGl0IGNvbGxpc2lvbi1mcmVlLlxuZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5UXVlcnkoZSkge1xuICAgIHJldHVybiBgJHtfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQoX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoZSkpfXxsdDoke2UubGltaXRUeXBlfWA7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zdHJpbmdpZnlRdWVyeShlKSB7XG4gICAgcmV0dXJuIGBRdWVyeSh0YXJnZXQ9JHtmdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5VGFyZ2V0KGUpIHtcbiAgICAgICAgbGV0IHQgPSBlLnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBlLmNvbGxlY3Rpb25Hcm91cCAmJiAodCArPSBcIiBjb2xsZWN0aW9uR3JvdXA9XCIgKyBlLmNvbGxlY3Rpb25Hcm91cCksIFxuICAgICAgICBlLmZpbHRlcnMubGVuZ3RoID4gMCAmJiAodCArPSBgLCBmaWx0ZXJzOiBbJHtlLmZpbHRlcnMubWFwKChlID0+IF9fUFJJVkFURV9zdHJpbmdpZnlGaWx0ZXIoZSkpKS5qb2luKFwiLCBcIil9XWApLCBcbiAgICAgICAgX19QUklWQVRFX2lzTnVsbE9yVW5kZWZpbmVkKGUubGltaXQpIHx8ICh0ICs9IFwiLCBsaW1pdDogXCIgKyBlLmxpbWl0KSwgZS5vcmRlckJ5Lmxlbmd0aCA+IDAgJiYgKHQgKz0gYCwgb3JkZXJCeTogWyR7ZS5vcmRlckJ5Lm1hcCgoZSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5T3JkZXJCeShlKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7ZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKX0gKCR7ZS5kaXJ9KWA7XG4gICAgICAgIH0oZSkpKS5qb2luKFwiLCBcIil9XWApLCBlLnN0YXJ0QXQgJiYgKHQgKz0gXCIsIHN0YXJ0QXQ6IFwiLCB0ICs9IGUuc3RhcnRBdC5pbmNsdXNpdmUgPyBcImI6XCIgOiBcImE6XCIsIFxuICAgICAgICB0ICs9IGUuc3RhcnRBdC5wb3NpdGlvbi5tYXAoKGUgPT4gY2Fub25pY2FsSWQoZSkpKS5qb2luKFwiLFwiKSksIGUuZW5kQXQgJiYgKHQgKz0gXCIsIGVuZEF0OiBcIiwgXG4gICAgICAgIHQgKz0gZS5lbmRBdC5pbmNsdXNpdmUgPyBcImE6XCIgOiBcImI6XCIsIHQgKz0gZS5lbmRBdC5wb3NpdGlvbi5tYXAoKGUgPT4gY2Fub25pY2FsSWQoZSkpKS5qb2luKFwiLFwiKSksIFxuICAgICAgICBgVGFyZ2V0KCR7dH0pYDtcbiAgICB9KF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KGUpKX07IGxpbWl0VHlwZT0ke2UubGltaXRUeXBlfSlgO1xufVxuXG4vKiogUmV0dXJucyB3aGV0aGVyIGBkb2NgIG1hdGNoZXMgdGhlIGNvbnN0cmFpbnRzIG9mIGBxdWVyeWAuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU1hdGNoZXMoZSwgdCkge1xuICAgIHJldHVybiB0LmlzRm91bmREb2N1bWVudCgpICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU1hdGNoZXNQYXRoQW5kQ29sbGVjdGlvbkdyb3VwKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQua2V5LnBhdGg7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBlLmNvbGxlY3Rpb25Hcm91cCA/IHQua2V5Lmhhc0NvbGxlY3Rpb25JZChlLmNvbGxlY3Rpb25Hcm91cCkgJiYgZS5wYXRoLmlzUHJlZml4T2YobikgOiBEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KGUucGF0aCkgPyBlLnBhdGguaXNFcXVhbChuKSA6IGUucGF0aC5pc0ltbWVkaWF0ZVBhcmVudE9mKG4pO1xuICAgIH1cbiAgICAvKipcbiAqIEEgZG9jdW1lbnQgbXVzdCBoYXZlIGEgdmFsdWUgZm9yIGV2ZXJ5IG9yZGVyaW5nIGNsYXVzZSBpbiBvcmRlciB0byBzaG93IHVwXG4gKiBpbiB0aGUgcmVzdWx0cy5cbiAqLyAoZSwgdCkgJiYgZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlc09yZGVyQnkoZSwgdCkge1xuICAgICAgICAvLyBXZSBtdXN0IHVzZSBgcXVlcnlOb3JtYWxpemVkT3JkZXJCeSgpYCB0byBnZXQgdGhlIGxpc3Qgb2YgYWxsIG9yZGVyQnlzIChib3RoIGltcGxpY2l0IGFuZCBleHBsaWNpdCkuXG4gICAgICAgIC8vIE5vdGUgdGhhdCBmb3IgT1IgcXVlcmllcywgb3JkZXJCeSBhcHBsaWVzIHRvIGFsbCBkaXNqdW5jdGlvbiB0ZXJtcyBhbmQgaW1wbGljaXQgb3JkZXJCeXMgbXVzdFxuICAgICAgICAvLyBiZSB0YWtlbiBpbnRvIGFjY291bnQuIEZvciBleGFtcGxlLCB0aGUgcXVlcnkgXCJhID4gMSB8fCBiPT0xXCIgaGFzIGFuIGltcGxpY2l0IFwib3JkZXJCeSBhXCIgZHVlXG4gICAgICAgIC8vIHRvIHRoZSBpbmVxdWFsaXR5LCBhbmQgaXMgZXZhbHVhdGVkIGFzIFwiYSA+IDEgb3JkZXJCeSBhIHx8IGI9PTEgb3JkZXJCeSBhXCIuXG4gICAgICAgIC8vIEEgZG9jdW1lbnQgd2l0aCBjb250ZW50IG9mIHtiOjF9IG1hdGNoZXMgdGhlIGZpbHRlcnMsIGJ1dCBkb2VzIG5vdCBtYXRjaCB0aGUgb3JkZXJCeSBiZWNhdXNlXG4gICAgICAgIC8vIGl0J3MgbWlzc2luZyB0aGUgZmllbGQgJ2EnLlxuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgX19QUklWQVRFX3F1ZXJ5Tm9ybWFsaXplZE9yZGVyQnkoZSkpIFxuICAgICAgICAvLyBvcmRlci1ieSBrZXkgYWx3YXlzIG1hdGNoZXNcbiAgICAgICAgaWYgKCFuLmZpZWxkLmlzS2V5RmllbGQoKSAmJiBudWxsID09PSB0LmRhdGEuZmllbGQobi5maWVsZCkpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH0oZSwgdCkgJiYgZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlc0ZpbHRlcnMoZSwgdCkge1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZS5maWx0ZXJzKSBpZiAoIW4ubWF0Y2hlcyh0KSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIC8qKiBNYWtlcyBzdXJlIGEgZG9jdW1lbnQgaXMgd2l0aGluIHRoZSBib3VuZHMsIGlmIHByb3ZpZGVkLiAqLyAoZSwgdCkgJiYgZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlc0JvdW5kcyhlLCB0KSB7XG4gICAgICAgIGlmIChlLnN0YXJ0QXQgJiYgIVxuICAgICAgICAvKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBhIGRvY3VtZW50IHNvcnRzIGJlZm9yZSBhIGJvdW5kIHVzaW5nIHRoZSBwcm92aWRlZCBzb3J0XG4gKiBvcmRlci5cbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfYm91bmRTb3J0c0JlZm9yZURvY3VtZW50KGUsIHQsIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfYm91bmRDb21wYXJlVG9Eb2N1bWVudChlLCB0LCBuKTtcbiAgICAgICAgICAgIHJldHVybiBlLmluY2x1c2l2ZSA/IHIgPD0gMCA6IHIgPCAwO1xuICAgICAgICB9KGUuc3RhcnRBdCwgX19QUklWQVRFX3F1ZXJ5Tm9ybWFsaXplZE9yZGVyQnkoZSksIHQpKSByZXR1cm4gITE7XG4gICAgICAgIGlmIChlLmVuZEF0ICYmICFmdW5jdGlvbiBfX1BSSVZBVEVfYm91bmRTb3J0c0FmdGVyRG9jdW1lbnQoZSwgdCwgbikge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9ib3VuZENvbXBhcmVUb0RvY3VtZW50KGUsIHQsIG4pO1xuICAgICAgICAgICAgcmV0dXJuIGUuaW5jbHVzaXZlID8gciA+PSAwIDogciA+IDA7XG4gICAgICAgIH0oZS5lbmRBdCwgX19QUklWQVRFX3F1ZXJ5Tm9ybWFsaXplZE9yZGVyQnkoZSksIHQpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIHRoZSBjb2xsZWN0aW9uIGdyb3VwIHRoYXQgdGhpcyBxdWVyeSB0YXJnZXRzLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgaW4gdGhlIFdlYiBTREsgdG8gZmFjaWxpdGF0ZSBtdWx0aS10YWJcbiAqIHN5bmNocm9uaXphdGlvbiBmb3IgcXVlcnkgcmVzdWx0cy5cbiAqLyAoZSwgdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeUNvbGxlY3Rpb25Hcm91cChlKSB7XG4gICAgcmV0dXJuIGUuY29sbGVjdGlvbkdyb3VwIHx8IChlLnBhdGgubGVuZ3RoICUgMiA9PSAxID8gZS5wYXRoLmxhc3RTZWdtZW50KCkgOiBlLnBhdGguZ2V0KGUucGF0aC5sZW5ndGggLSAyKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIG5ldyBjb21wYXJhdG9yIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gY29tcGFyZSB0d28gZG9jdW1lbnRzXG4gKiBiYXNlZCBvbiB0aGUgUXVlcnkncyBvcmRlcmluZyBjb25zdHJhaW50LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeUNvbXBhcmF0b3IoZSkge1xuICAgIHJldHVybiAodCwgbikgPT4ge1xuICAgICAgICBsZXQgciA9ICExO1xuICAgICAgICBmb3IgKGNvbnN0IGkgb2YgX19QUklWQVRFX3F1ZXJ5Tm9ybWFsaXplZE9yZGVyQnkoZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBfX1BSSVZBVEVfY29tcGFyZURvY3MoaSwgdCwgbik7XG4gICAgICAgICAgICBpZiAoMCAhPT0gZSkgcmV0dXJuIGU7XG4gICAgICAgICAgICByID0gciB8fCBpLmZpZWxkLmlzS2V5RmllbGQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZURvY3MoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBlLmZpZWxkLmlzS2V5RmllbGQoKSA/IERvY3VtZW50S2V5LmNvbXBhcmF0b3IodC5rZXksIG4ua2V5KSA6IGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlRG9jdW1lbnRzQnlGaWVsZChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSB0LmRhdGEuZmllbGQoZSksIGkgPSBuLmRhdGEuZmllbGQoZSk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSByICYmIG51bGwgIT09IGkgPyBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKHIsIGkpIDogZmFpbCgpO1xuICAgIH0oZS5maWVsZCwgdCwgbik7XG4gICAgc3dpdGNoIChlLmRpcikge1xuICAgICAgY2FzZSBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8gOlxuICAgICAgICByZXR1cm4gcjtcblxuICAgICAgY2FzZSBcImRlc2NcIiAvKiBEaXJlY3Rpb24uREVTQ0VORElORyAqLyA6XG4gICAgICAgIHJldHVybiAtMSAqIHI7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIG1hcCBpbXBsZW1lbnRhdGlvbiB0aGF0IHVzZXMgb2JqZWN0cyBhcyBrZXlzLiBPYmplY3RzIG11c3QgaGF2ZSBhblxuICogYXNzb2NpYXRlZCBlcXVhbHMgZnVuY3Rpb24gYW5kIG11c3QgYmUgaW1tdXRhYmxlLiBFbnRyaWVzIGluIHRoZSBtYXAgYXJlXG4gKiBzdG9yZWQgdG9nZXRoZXIgd2l0aCB0aGUga2V5IGJlaW5nIHByb2R1Y2VkIGZyb20gdGhlIG1hcEtleUZuLiBUaGlzIG1hcFxuICogYXV0b21hdGljYWxseSBoYW5kbGVzIGNvbGxpc2lvbnMgb2Yga2V5cy5cbiAqLyBjbGFzcyBPYmplY3RNYXAge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5tYXBLZXlGbiA9IGUsIHRoaXMuZXF1YWxzRm4gPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpbm5lciBtYXAgZm9yIGEga2V5L3ZhbHVlIHBhaXIuIER1ZSB0byB0aGUgcG9zc2liaWxpdHkgb2YgY29sbGlzaW9ucyB3ZVxuICAgICAgICAgKiBrZWVwIGEgbGlzdCBvZiBlbnRyaWVzIHRoYXQgd2UgZG8gYSBsaW5lYXIgc2VhcmNoIHRocm91Z2ggdG8gZmluZCBhbiBhY3R1YWxcbiAgICAgICAgICogbWF0Y2guIE5vdGUgdGhhdCBjb2xsaXNpb25zIHNob3VsZCBiZSByYXJlLCBzbyB3ZSBzdGlsbCBleHBlY3QgbmVhclxuICAgICAgICAgKiBjb25zdGFudCB0aW1lIGxvb2t1cHMgaW4gcHJhY3RpY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlubmVyID0ge30sIFxuICAgICAgICAvKiogVGhlIG51bWJlciBvZiBlbnRyaWVzIHN0b3JlZCBpbiB0aGUgbWFwICovXG4gICAgICAgIHRoaXMuaW5uZXJTaXplID0gMDtcbiAgICB9XG4gICAgLyoqIEdldCBhIHZhbHVlIGZvciB0aGlzIGtleSwgb3IgdW5kZWZpbmVkIGlmIGl0IGRvZXMgbm90IGV4aXN0LiAqLyAgICBnZXQoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5tYXBLZXlGbihlKSwgbiA9IHRoaXMuaW5uZXJbdF07XG4gICAgICAgIGlmICh2b2lkIDAgIT09IG4pIGZvciAoY29uc3QgW3QsIHJdIG9mIG4pIGlmICh0aGlzLmVxdWFsc0ZuKHQsIGUpKSByZXR1cm4gcjtcbiAgICB9XG4gICAgaGFzKGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5nZXQoZSk7XG4gICAgfVxuICAgIC8qKiBQdXQgdGhpcyBrZXkgYW5kIHZhbHVlIGluIHRoZSBtYXAuICovICAgIHNldChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLm1hcEtleUZuKGUpLCByID0gdGhpcy5pbm5lcltuXTtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gcikgcmV0dXJuIHRoaXMuaW5uZXJbbl0gPSBbIFsgZSwgdCBdIF0sIHZvaWQgdGhpcy5pbm5lclNpemUrKztcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCByLmxlbmd0aDsgbisrKSBpZiAodGhpcy5lcXVhbHNGbihyW25dWzBdLCBlKSkgXG4gICAgICAgIC8vIFRoaXMgaXMgdXBkYXRpbmcgYW4gZXhpc3RpbmcgZW50cnkgYW5kIGRvZXMgbm90IGluY3JlYXNlIGBpbm5lclNpemVgLlxuICAgICAgICByZXR1cm4gdm9pZCAocltuXSA9IFsgZSwgdCBdKTtcbiAgICAgICAgci5wdXNoKFsgZSwgdCBdKSwgdGhpcy5pbm5lclNpemUrKztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIHRoaXMga2V5IGZyb20gdGhlIG1hcC4gUmV0dXJucyBhIGJvb2xlYW4gaWYgYW55dGhpbmcgd2FzIGRlbGV0ZWQuXG4gICAgICovICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLm1hcEtleUZuKGUpLCBuID0gdGhpcy5pbm5lclt0XTtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbikgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IG4ubGVuZ3RoOyByKyspIGlmICh0aGlzLmVxdWFsc0ZuKG5bcl1bMF0sIGUpKSByZXR1cm4gMSA9PT0gbi5sZW5ndGggPyBkZWxldGUgdGhpcy5pbm5lclt0XSA6IG4uc3BsaWNlKHIsIDEpLCBcbiAgICAgICAgdGhpcy5pbm5lclNpemUtLSwgITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgZm9yRWFjaChlKSB7XG4gICAgICAgIGZvckVhY2godGhpcy5pbm5lciwgKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFt0LCByXSBvZiBuKSBlKHQsIHIpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBpc0VtcHR5KHRoaXMuaW5uZXIpO1xuICAgIH1cbiAgICBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbm5lclNpemU7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBvZSA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSB7XG4gICAgcmV0dXJuIG9lO1xufVxuXG5jb25zdCBfZSA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG5cbmZ1bmN0aW9uIGRvY3VtZW50TWFwKC4uLmUpIHtcbiAgICBsZXQgdCA9IF9lO1xuICAgIGZvciAoY29uc3QgbiBvZiBlKSB0ID0gdC5pbnNlcnQobi5rZXksIG4pO1xuICAgIHJldHVybiB0O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29udmVydE92ZXJsYXllZERvY3VtZW50TWFwVG9Eb2N1bWVudE1hcChlKSB7XG4gICAgbGV0IHQgPSBfZTtcbiAgICByZXR1cm4gZS5mb3JFYWNoKCgoZSwgbikgPT4gdCA9IHQuaW5zZXJ0KGUsIG4ub3ZlcmxheWVkRG9jdW1lbnQpKSksIHQ7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfbmV3RG9jdW1lbnRLZXlNYXAoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX25ld011dGF0aW9uTWFwKCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfbmV3RG9jdW1lbnRLZXlNYXAoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0TWFwKChlID0+IGUudG9TdHJpbmcoKSksICgoZSwgdCkgPT4gZS5pc0VxdWFsKHQpKSk7XG59XG5cbmNvbnN0IGFlID0gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcblxuY29uc3QgdWUgPSBuZXcgU29ydGVkU2V0KERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoLi4uZSkge1xuICAgIGxldCB0ID0gdWU7XG4gICAgZm9yIChjb25zdCBuIG9mIGUpIHQgPSB0LmFkZChuKTtcbiAgICByZXR1cm4gdDtcbn1cblxuY29uc3QgY2UgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcblxuZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldElkU2V0KCkge1xuICAgIHJldHVybiBjZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmV0dXJucyBhbiBEb3VibGVWYWx1ZSBmb3IgYHZhbHVlYCB0aGF0IGlzIGVuY29kZWQgYmFzZWQgdGhlIHNlcmlhbGl6ZXInc1xuICogYHVzZVByb3RvM0pzb25gIHNldHRpbmcuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RvRG91YmxlKGUsIHQpIHtcbiAgICBpZiAoZS51c2VQcm90bzNKc29uKSB7XG4gICAgICAgIGlmIChpc05hTih0KSkgcmV0dXJuIHtcbiAgICAgICAgICAgIGRvdWJsZVZhbHVlOiBcIk5hTlwiXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0ID09PSAxIC8gMCkgcmV0dXJuIHtcbiAgICAgICAgICAgIGRvdWJsZVZhbHVlOiBcIkluZmluaXR5XCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHQgPT09IC0xIC8gMCkgcmV0dXJuIHtcbiAgICAgICAgICAgIGRvdWJsZVZhbHVlOiBcIi1JbmZpbml0eVwiXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGRvdWJsZVZhbHVlOiBfX1BSSVZBVEVfaXNOZWdhdGl2ZVplcm8odCkgPyBcIi0wXCIgOiB0XG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGFuIEludGVnZXJWYWx1ZSBmb3IgYHZhbHVlYC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9JbnRlZ2VyKGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbnRlZ2VyVmFsdWU6IFwiXCIgKyBlXG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgdmFsdWUgZm9yIGEgbnVtYmVyIHRoYXQncyBhcHByb3ByaWF0ZSB0byBwdXQgaW50byBhIHByb3RvLlxuICogVGhlIHJldHVybiB2YWx1ZSBpcyBhbiBJbnRlZ2VyVmFsdWUgaWYgaXQgY2FuIHNhZmVseSByZXByZXNlbnQgdGhlIHZhbHVlLFxuICogb3RoZXJ3aXNlIGEgRG91YmxlVmFsdWUgaXMgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gdG9OdW1iZXIoZSwgdCkge1xuICAgIHJldHVybiBpc1NhZmVJbnRlZ2VyKHQpID8gX19QUklWQVRFX3RvSW50ZWdlcih0KSA6IF9fUFJJVkFURV90b0RvdWJsZShlLCB0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBVc2VkIHRvIHJlcHJlc2VudCBhIGZpZWxkIHRyYW5zZm9ybSBvbiBhIG11dGF0aW9uLiAqLyBjbGFzcyBUcmFuc2Zvcm1PcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgc3RydWN0dXJhbCB0eXBlIG9mIGBUcmFuc2Zvcm1PcGVyYXRpb25gIGlzIHVuaXF1ZS5cbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvNTQ1MVxuICAgICAgICB0aGlzLl8gPSB2b2lkIDA7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbXB1dGVzIHRoZSBsb2NhbCB0cmFuc2Zvcm0gcmVzdWx0IGFnYWluc3QgdGhlIHByb3ZpZGVkIGBwcmV2aW91c1ZhbHVlYCxcbiAqIG9wdGlvbmFsbHkgdXNpbmcgdGhlIHByb3ZpZGVkIGxvY2FsV3JpdGVUaW1lLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseVRyYW5zZm9ybU9wZXJhdGlvblRvTG9jYWxWaWV3KGUsIHQsIG4pIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBUcmFuc2Zvcm0gPyBmdW5jdGlvbiBzZXJ2ZXJUaW1lc3RhbXAkMShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB7XG4gICAgICAgICAgICBmaWVsZHM6IHtcbiAgICAgICAgICAgICAgICBfX3R5cGVfXzoge1xuICAgICAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZTogXCJzZXJ2ZXJfdGltZXN0YW1wXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF9fbG9jYWxfd3JpdGVfdGltZV9fOiB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzOiBlLnNlY29uZHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW5vczogZS5uYW5vc2Vjb25kc1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLyBXZSBzaG91bGQgYXZvaWQgc3RvcmluZyBkZWVwbHkgbmVzdGVkIHNlcnZlciB0aW1lc3RhbXAgbWFwIHZhbHVlc1xuICAgICAgICAvLyBiZWNhdXNlIHdlIG5ldmVyIHVzZSB0aGUgaW50ZXJtZWRpYXRlIFwicHJldmlvdXMgdmFsdWVzXCIuXG4gICAgICAgIC8vIEZvciBleGFtcGxlOlxuICAgICAgICAvLyBwcmV2aW91czogNDJMLCBhZGQ6IHQxLCByZXN1bHQ6IHQxIC0+IDQyTFxuICAgICAgICAvLyBwcmV2aW91czogdDEsICBhZGQ6IHQyLCByZXN1bHQ6IHQyIC0+IDQyTCAoTk9UIHQyIC0+IHQxIC0+IDQyTClcbiAgICAgICAgLy8gcHJldmlvdXM6IHQyLCAgYWRkOiB0MywgcmVzdWx0OiB0MyAtPiA0MkwgKE5PVCB0MyAtPiB0MiAtPiB0MSAtPiA0MkwpXG4gICAgICAgIC8vIGBnZXRQcmV2aW91c1ZhbHVlYCByZWN1cnNpdmVseSB0cmF2ZXJzZXMgc2VydmVyIHRpbWVzdGFtcHMgdG8gZmluZCB0aGVcbiAgICAgICAgLy8gbGVhc3QgcmVjZW50IFZhbHVlLlxuICAgICAgICAgICAgICAgIHJldHVybiB0ICYmIF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcCh0KSAmJiAodCA9IF9fUFJJVkFURV9nZXRQcmV2aW91c1ZhbHVlKHQpKSwgXG4gICAgICAgIHQgJiYgKG4uZmllbGRzLl9fcHJldmlvdXNfdmFsdWVfXyA9IHQpLCB7XG4gICAgICAgICAgICBtYXBWYWx1ZTogblxuICAgICAgICB9O1xuICAgIH0obiwgdCkgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfYXBwbHlBcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIDogZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbiA/IF9fUFJJVkFURV9hcHBseUFycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIDogZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5TnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvblRvTG9jYWxWaWV3KGUsIHQpIHtcbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBTaW5jZSBKYXZhU2NyaXB0J3MgaW50ZWdlciBhcml0aG1ldGljIGlzIGxpbWl0ZWQgdG8gNTMgYml0XG4gICAgICAgIC8vIHByZWNpc2lvbiBhbmQgcmVzb2x2ZXMgb3ZlcmZsb3dzIGJ5IHJlZHVjaW5nIHByZWNpc2lvbiwgd2UgZG8gbm90XG4gICAgICAgIC8vIG1hbnVhbGx5IGNhcCBvdmVyZmxvd3MgYXQgMl42My5cbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9jb21wdXRlVHJhbnNmb3JtT3BlcmF0aW9uQmFzZVZhbHVlKGUsIHQpLCByID0gYXNOdW1iZXIobikgKyBhc051bWJlcihlLlBlKTtcbiAgICAgICAgcmV0dXJuIGlzSW50ZWdlcihuKSAmJiBpc0ludGVnZXIoZS5QZSkgPyBfX1BSSVZBVEVfdG9JbnRlZ2VyKHIpIDogX19QUklWQVRFX3RvRG91YmxlKGUuc2VyaWFsaXplciwgcik7XG4gICAgfShlLCB0KTtcbn1cblxuLyoqXG4gKiBDb21wdXRlcyBhIGZpbmFsIHRyYW5zZm9ybSByZXN1bHQgYWZ0ZXIgdGhlIHRyYW5zZm9ybSBoYXMgYmVlbiBhY2tub3dsZWRnZWRcbiAqIGJ5IHRoZSBzZXJ2ZXIsIHBvdGVudGlhbGx5IHVzaW5nIHRoZSBzZXJ2ZXItcHJvdmlkZWQgdHJhbnNmb3JtUmVzdWx0LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseVRyYW5zZm9ybU9wZXJhdGlvblRvUmVtb3RlRG9jdW1lbnQoZSwgdCwgbikge1xuICAgIC8vIFRoZSBzZXJ2ZXIganVzdCBzZW5kcyBudWxsIGFzIHRoZSB0cmFuc2Zvcm0gcmVzdWx0IGZvciBhcnJheSBvcGVyYXRpb25zLFxuICAgIC8vIHNvIHdlIGhhdmUgdG8gY2FsY3VsYXRlIGEgcmVzdWx0IHRoZSBzYW1lIGFzIHdlIGRvIGZvciBsb2NhbFxuICAgIC8vIGFwcGxpY2F0aW9ucy5cbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uID8gX19QUklWQVRFX2FwcGx5QXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbihlLCB0KSA6IGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfYXBwbHlBcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbihlLCB0KSA6IG47XG59XG5cbi8qKlxuICogSWYgdGhpcyB0cmFuc2Zvcm0gb3BlcmF0aW9uIGlzIG5vdCBpZGVtcG90ZW50LCByZXR1cm5zIHRoZSBiYXNlIHZhbHVlIHRvXG4gKiBwZXJzaXN0IGZvciB0aGlzIHRyYW5zZm9ybS4gSWYgYSBiYXNlIHZhbHVlIGlzIHJldHVybmVkLCB0aGUgdHJhbnNmb3JtXG4gKiBvcGVyYXRpb24gaXMgYWx3YXlzIGFwcGxpZWQgdG8gdGhpcyBiYXNlIHZhbHVlLCBldmVuIGlmIGRvY3VtZW50IGhhc1xuICogYWxyZWFkeSBiZWVuIHVwZGF0ZWQuXG4gKlxuICogQmFzZSB2YWx1ZXMgcHJvdmlkZSBjb25zaXN0ZW50IGJlaGF2aW9yIGZvciBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1zIGFuZFxuICogYWxsb3cgdXMgdG8gcmV0dXJuIHRoZSBzYW1lIGxhdGVuY3ktY29tcGVuc2F0ZWQgdmFsdWUgZXZlbiBpZiB0aGUgYmFja2VuZFxuICogaGFzIGFscmVhZHkgYXBwbGllZCB0aGUgdHJhbnNmb3JtIG9wZXJhdGlvbi4gVGhlIGJhc2UgdmFsdWUgaXMgbnVsbCBmb3JcbiAqIGlkZW1wb3RlbnQgdHJhbnNmb3JtcywgYXMgdGhleSBjYW4gYmUgcmUtcGxheWVkIGV2ZW4gaWYgdGhlIGJhY2tlbmQgaGFzXG4gKiBhbHJlYWR5IGFwcGxpZWQgdGhlbS5cbiAqXG4gKiBAcmV0dXJucyBhIGJhc2UgdmFsdWUgdG8gc3RvcmUgYWxvbmcgd2l0aCB0aGUgbXV0YXRpb24sIG9yIG51bGwgZm9yXG4gKiBpZGVtcG90ZW50IHRyYW5zZm9ybXMuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbXB1dGVUcmFuc2Zvcm1PcGVyYXRpb25CYXNlVmFsdWUoZSwgdCkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRUcmFuc2Zvcm1PcGVyYXRpb24gPyBcbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgZWl0aGVyIGFuIEludGVnZXJWYWx1ZSBvciBhIERvdWJsZVZhbHVlLiAqL1xuICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9pc051bWJlcihlKSB7XG4gICAgICAgIHJldHVybiBpc0ludGVnZXIoZSkgfHwgZnVuY3Rpb24gX19QUklWQVRFX2lzRG91YmxlKGUpIHtcbiAgICAgICAgICAgIHJldHVybiAhIWUgJiYgXCJkb3VibGVWYWx1ZVwiIGluIGU7XG4gICAgICAgIH0oZSk7XG4gICAgfSh0KSA/IHQgOiB7XG4gICAgICAgIGludGVnZXJWYWx1ZTogMFxuICAgIH0gOiBudWxsO1xufVxuXG4vKiogVHJhbnNmb3JtcyBhIHZhbHVlIGludG8gYSBzZXJ2ZXItZ2VuZXJhdGVkIHRpbWVzdGFtcC4gKi9cbmNsYXNzIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBUcmFuc2Zvcm0gZXh0ZW5kcyBUcmFuc2Zvcm1PcGVyYXRpb24ge31cblxuLyoqIFRyYW5zZm9ybXMgYW4gYXJyYXkgdmFsdWUgdmlhIGEgdW5pb24gb3BlcmF0aW9uLiAqLyBjbGFzcyBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbiBleHRlbmRzIFRyYW5zZm9ybU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmVsZW1lbnRzID0gZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseUFycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfY29lcmNlZEZpZWxkVmFsdWVzQXJyYXkodCk7XG4gICAgZm9yIChjb25zdCB0IG9mIGUuZWxlbWVudHMpIG4uc29tZSgoZSA9PiBfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZSwgdCkpKSB8fCBuLnB1c2godCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgdmFsdWVzOiBuXG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vKiogVHJhbnNmb3JtcyBhbiBhcnJheSB2YWx1ZSB2aWEgYSByZW1vdmUgb3BlcmF0aW9uLiAqLyBjbGFzcyBfX1BSSVZBVEVfQXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24gZXh0ZW5kcyBUcmFuc2Zvcm1PcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5lbGVtZW50cyA9IGU7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlBcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbihlLCB0KSB7XG4gICAgbGV0IG4gPSBfX1BSSVZBVEVfY29lcmNlZEZpZWxkVmFsdWVzQXJyYXkodCk7XG4gICAgZm9yIChjb25zdCB0IG9mIGUuZWxlbWVudHMpIG4gPSBuLmZpbHRlcigoZSA9PiAhX19QUklWQVRFX3ZhbHVlRXF1YWxzKGUsIHQpKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgdmFsdWVzOiBuXG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vKipcbiAqIEltcGxlbWVudHMgdGhlIGJhY2tlbmQgc2VtYW50aWNzIGZvciBsb2NhbGx5IGNvbXB1dGVkIE5VTUVSSUNfQUREIChpbmNyZW1lbnQpXG4gKiB0cmFuc2Zvcm1zLiBDb252ZXJ0cyBhbGwgZmllbGQgdmFsdWVzIHRvIGludGVnZXJzIG9yIGRvdWJsZXMsIGJ1dCB1bmxpa2UgdGhlXG4gKiBiYWNrZW5kIGRvZXMgbm90IGNhcCBpbnRlZ2VyIHZhbHVlcyBhdCAyXjYzLiBJbnN0ZWFkLCBKYXZhU2NyaXB0IG51bWJlclxuICogYXJpdGhtZXRpYyBpcyB1c2VkIGFuZCBwcmVjaXNpb24gbG9zcyBjYW4gb2NjdXIgZm9yIHZhbHVlcyBncmVhdGVyIHRoYW4gMl41My5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbiBleHRlbmRzIFRyYW5zZm9ybU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnNlcmlhbGl6ZXIgPSBlLCB0aGlzLlBlID0gdDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFzTnVtYmVyKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmludGVnZXJWYWx1ZSB8fCBlLmRvdWJsZVZhbHVlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvZXJjZWRGaWVsZFZhbHVlc0FycmF5KGUpIHtcbiAgICByZXR1cm4gaXNBcnJheShlKSAmJiBlLmFycmF5VmFsdWUudmFsdWVzID8gZS5hcnJheVZhbHVlLnZhbHVlcy5zbGljZSgpIDogW107XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogQSBmaWVsZCBwYXRoIGFuZCB0aGUgVHJhbnNmb3JtT3BlcmF0aW9uIHRvIHBlcmZvcm0gdXBvbiBpdC4gKi8gY2xhc3MgRmllbGRUcmFuc2Zvcm0ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5maWVsZCA9IGUsIHRoaXMudHJhbnNmb3JtID0gdDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maWVsZFRyYW5zZm9ybUVxdWFscyhlLCB0KSB7XG4gICAgcmV0dXJuIGUuZmllbGQuaXNFcXVhbCh0LmZpZWxkKSAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfdHJhbnNmb3JtT3BlcmF0aW9uRXF1YWxzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbiAmJiB0IGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24gfHwgZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbiAmJiB0IGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uID8gX19QUklWQVRFX2FycmF5RXF1YWxzKGUuZWxlbWVudHMsIHQuZWxlbWVudHMsIF9fUFJJVkFURV92YWx1ZUVxdWFscykgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRUcmFuc2Zvcm1PcGVyYXRpb24gJiYgdCBpbnN0YW5jZW9mIF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uID8gX19QUklWQVRFX3ZhbHVlRXF1YWxzKGUuUGUsIHQuUGUpIDogZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBUcmFuc2Zvcm0gJiYgdCBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBUcmFuc2Zvcm07XG4gICAgfShlLnRyYW5zZm9ybSwgdC50cmFuc2Zvcm0pO1xufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBzdWNjZXNzZnVsbHkgYXBwbHlpbmcgYSBtdXRhdGlvbiB0byB0aGUgYmFja2VuZC4gKi9cbmNsYXNzIE11dGF0aW9uUmVzdWx0IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgdmVyc2lvbiBhdCB3aGljaCB0aGUgbXV0YXRpb24gd2FzIGNvbW1pdHRlZDpcbiAgICAgKlxuICAgICAqIC0gRm9yIG1vc3Qgb3BlcmF0aW9ucywgdGhpcyBpcyB0aGUgdXBkYXRlVGltZSBpbiB0aGUgV3JpdGVSZXN1bHQuXG4gICAgICogLSBGb3IgZGVsZXRlcywgdGhlIGNvbW1pdFRpbWUgb2YgdGhlIFdyaXRlUmVzcG9uc2UgKGJlY2F1c2UgZGVsZXRlcyBhcmVcbiAgICAgKiAgIG5vdCBzdG9yZWQgYW5kIGhhdmUgbm8gdXBkYXRlVGltZSkuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgdGhlc2UgdmVyc2lvbnMgY2FuIGJlIGRpZmZlcmVudDogTm8tb3Agd3JpdGVzIHdpbGwgbm90IGNoYW5nZVxuICAgICAqIHRoZSB1cGRhdGVUaW1lIGV2ZW4gdGhvdWdoIHRoZSBjb21taXRUaW1lIGFkdmFuY2VzLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSByZXN1bHRpbmcgZmllbGRzIHJldHVybmVkIGZyb20gdGhlIGJhY2tlbmQgYWZ0ZXIgYSBtdXRhdGlvblxuICAgICAqIGNvbnRhaW5pbmcgZmllbGQgdHJhbnNmb3JtcyBoYXMgYmVlbiBjb21taXR0ZWQuIENvbnRhaW5zIG9uZSBGaWVsZFZhbHVlXG4gICAgICogZm9yIGVhY2ggRmllbGRUcmFuc2Zvcm0gdGhhdCB3YXMgaW4gdGhlIG11dGF0aW9uLlxuICAgICAqXG4gICAgICogV2lsbCBiZSBlbXB0eSBpZiB0aGUgbXV0YXRpb24gZGlkIG5vdCBjb250YWluIGFueSBmaWVsZCB0cmFuc2Zvcm1zLlxuICAgICAqL1xuICAgIHQpIHtcbiAgICAgICAgdGhpcy52ZXJzaW9uID0gZSwgdGhpcy50cmFuc2Zvcm1SZXN1bHRzID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogRW5jb2RlcyBhIHByZWNvbmRpdGlvbiBmb3IgYSBtdXRhdGlvbi4gVGhpcyBmb2xsb3dzIHRoZSBtb2RlbCB0aGF0IHRoZVxuICogYmFja2VuZCBhY2NlcHRzIHdpdGggdGhlIHNwZWNpYWwgY2FzZSBvZiBhbiBleHBsaWNpdCBcImVtcHR5XCIgcHJlY29uZGl0aW9uXG4gKiAobWVhbmluZyBubyBwcmVjb25kaXRpb24pLlxuICovIGNsYXNzIFByZWNvbmRpdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVRpbWUgPSBlLCB0aGlzLmV4aXN0cyA9IHQ7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IGVtcHR5IFByZWNvbmRpdGlvbi4gKi8gICAgc3RhdGljIG5vbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJlY29uZGl0aW9uO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBQcmVjb25kaXRpb24gd2l0aCBhbiBleGlzdHMgZmxhZy4gKi8gICAgc3RhdGljIGV4aXN0cyhlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJlY29uZGl0aW9uKHZvaWQgMCwgZSk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IFByZWNvbmRpdGlvbiBiYXNlZCBvbiBhIHZlcnNpb24gYSBkb2N1bWVudCBleGlzdHMgYXQuICovICAgIHN0YXRpYyB1cGRhdGVUaW1lKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcmVjb25kaXRpb24oZSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBQcmVjb25kaXRpb24gaXMgZW1wdHkuICovICAgIGdldCBpc05vbmUoKSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgPT09IHRoaXMudXBkYXRlVGltZSAmJiB2b2lkIDAgPT09IHRoaXMuZXhpc3RzO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXhpc3RzID09PSBlLmV4aXN0cyAmJiAodGhpcy51cGRhdGVUaW1lID8gISFlLnVwZGF0ZVRpbWUgJiYgdGhpcy51cGRhdGVUaW1lLmlzRXF1YWwoZS51cGRhdGVUaW1lKSA6ICFlLnVwZGF0ZVRpbWUpO1xuICAgIH1cbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcHJlY29uZGl0aW9ucyBpcyB2YWxpZCBmb3IgdGhlIGdpdmVuIGRvY3VtZW50LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcHJlY29uZGl0aW9uSXNWYWxpZEZvckRvY3VtZW50KGUsIHQpIHtcbiAgICByZXR1cm4gdm9pZCAwICE9PSBlLnVwZGF0ZVRpbWUgPyB0LmlzRm91bmREb2N1bWVudCgpICYmIHQudmVyc2lvbi5pc0VxdWFsKGUudXBkYXRlVGltZSkgOiB2b2lkIDAgPT09IGUuZXhpc3RzIHx8IGUuZXhpc3RzID09PSB0LmlzRm91bmREb2N1bWVudCgpO1xufVxuXG4vKipcbiAqIEEgbXV0YXRpb24gZGVzY3JpYmVzIGEgc2VsZi1jb250YWluZWQgY2hhbmdlIHRvIGEgZG9jdW1lbnQuIE11dGF0aW9ucyBjYW5cbiAqIGNyZWF0ZSwgcmVwbGFjZSwgZGVsZXRlLCBhbmQgdXBkYXRlIHN1YnNldHMgb2YgZG9jdW1lbnRzLlxuICpcbiAqIE11dGF0aW9ucyBub3Qgb25seSBhY3Qgb24gdGhlIHZhbHVlIG9mIHRoZSBkb2N1bWVudCBidXQgYWxzbyBpdHMgdmVyc2lvbi5cbiAqXG4gKiBGb3IgbG9jYWwgbXV0YXRpb25zIChtdXRhdGlvbnMgdGhhdCBoYXZlbid0IGJlZW4gY29tbWl0dGVkIHlldCksIHdlIHByZXNlcnZlXG4gKiB0aGUgZXhpc3RpbmcgdmVyc2lvbiBmb3IgU2V0IGFuZCBQYXRjaCBtdXRhdGlvbnMuIEZvciBEZWxldGUgbXV0YXRpb25zLCB3ZVxuICogcmVzZXQgdGhlIHZlcnNpb24gdG8gMC5cbiAqXG4gKiBIZXJlJ3MgdGhlIGV4cGVjdGVkIHRyYW5zaXRpb24gdGFibGUuXG4gKlxuICogTVVUQVRJT04gICAgICAgICAgIEFQUExJRUQgVE8gICAgICAgICAgICBSRVNVTFRTIElOXG4gKlxuICogU2V0TXV0YXRpb24gICAgICAgIERvY3VtZW50KHYzKSAgICAgICAgICBEb2N1bWVudCh2MylcbiAqIFNldE11dGF0aW9uICAgICAgICBOb0RvY3VtZW50KHYzKSAgICAgICAgRG9jdW1lbnQodjApXG4gKiBTZXRNdXRhdGlvbiAgICAgICAgSW52YWxpZERvY3VtZW50KHYwKSAgIERvY3VtZW50KHYwKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIERvY3VtZW50KHYzKSAgICAgICAgICBEb2N1bWVudCh2MylcbiAqIFBhdGNoTXV0YXRpb24gICAgICBOb0RvY3VtZW50KHYzKSAgICAgICAgTm9Eb2N1bWVudCh2MylcbiAqIFBhdGNoTXV0YXRpb24gICAgICBJbnZhbGlkRG9jdW1lbnQodjApICAgVW5rbm93bkRvY3VtZW50KHYzKVxuICogRGVsZXRlTXV0YXRpb24gICAgIERvY3VtZW50KHYzKSAgICAgICAgICBOb0RvY3VtZW50KHYwKVxuICogRGVsZXRlTXV0YXRpb24gICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBOb0RvY3VtZW50KHYwKVxuICogRGVsZXRlTXV0YXRpb24gICAgIEludmFsaWREb2N1bWVudCh2MCkgICBOb0RvY3VtZW50KHYwKVxuICpcbiAqIEZvciBhY2tub3dsZWRnZWQgbXV0YXRpb25zLCB3ZSB1c2UgdGhlIHVwZGF0ZVRpbWUgb2YgdGhlIFdyaXRlUmVzcG9uc2UgYXNcbiAqIHRoZSByZXN1bHRpbmcgdmVyc2lvbiBmb3IgU2V0IGFuZCBQYXRjaCBtdXRhdGlvbnMuIEFzIGRlbGV0ZXMgaGF2ZSBub1xuICogZXhwbGljaXQgdXBkYXRlIHRpbWUsIHdlIHVzZSB0aGUgY29tbWl0VGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSBmb3JcbiAqIERlbGV0ZSBtdXRhdGlvbnMuXG4gKlxuICogSWYgYSBtdXRhdGlvbiBpcyBhY2tub3dsZWRnZWQgYnkgdGhlIGJhY2tlbmQgYnV0IGZhaWxzIHRoZSBwcmVjb25kaXRpb24gY2hlY2tcbiAqIGxvY2FsbHksIHdlIHRyYW5zaXRpb24gdG8gYW4gYFVua25vd25Eb2N1bWVudGAgYW5kIHJlbHkgb24gV2F0Y2ggdG8gc2VuZCB1c1xuICogdGhlIHVwZGF0ZWQgdmVyc2lvbi5cbiAqXG4gKiBGaWVsZCB0cmFuc2Zvcm1zIGFyZSB1c2VkIG9ubHkgd2l0aCBQYXRjaCBhbmQgU2V0IE11dGF0aW9ucy4gV2UgdXNlIHRoZVxuICogYHVwZGF0ZVRyYW5zZm9ybXNgIG1lc3NhZ2UgdG8gc3RvcmUgdHJhbnNmb3JtcywgcmF0aGVyIHRoYW4gdGhlIGB0cmFuc2Zvcm1zYHNcbiAqIG1lc3NhZ2VzLlxuICpcbiAqICMjIFN1YmNsYXNzaW5nIE5vdGVzXG4gKlxuICogRXZlcnkgdHlwZSBvZiBtdXRhdGlvbiBuZWVkcyB0byBpbXBsZW1lbnQgaXRzIG93biBhcHBseVRvUmVtb3RlRG9jdW1lbnQoKSBhbmRcbiAqIGFwcGx5VG9Mb2NhbFZpZXcoKSB0byBpbXBsZW1lbnQgdGhlIGFjdHVhbCBiZWhhdmlvciBvZiBhcHBseWluZyB0aGUgbXV0YXRpb25cbiAqIHRvIHNvbWUgc291cmNlIGRvY3VtZW50IChzZWUgYHNldE11dGF0aW9uQXBwbHlUb1JlbW90ZURvY3VtZW50KClgIGZvciBhblxuICogZXhhbXBsZSkuXG4gKi8gY2xhc3MgTXV0YXRpb24ge31cblxuLyoqXG4gKiBBIHV0aWxpdHkgbWV0aG9kIHRvIGNhbGN1bGF0ZSBhIGBNdXRhdGlvbmAgcmVwcmVzZW50aW5nIHRoZSBvdmVybGF5IGZyb20gdGhlXG4gKiBmaW5hbCBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQsIGFuZCBhIGBGaWVsZE1hc2tgIHJlcHJlc2VudGluZyB0aGUgZmllbGRzIHRoYXRcbiAqIGFyZSBtdXRhdGVkIGJ5IHRoZSBsb2NhbCBtdXRhdGlvbnMuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NhbGN1bGF0ZU92ZXJsYXlNdXRhdGlvbihlLCB0KSB7XG4gICAgaWYgKCFlLmhhc0xvY2FsTXV0YXRpb25zIHx8IHQgJiYgMCA9PT0gdC5maWVsZHMubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICAvLyBtYXNrIGlzIG51bGwgd2hlbiBzZXRzIG9yIGRlbGV0ZXMgYXJlIGFwcGxpZWQgdG8gdGhlIGN1cnJlbnQgZG9jdW1lbnQuXG4gICAgICAgIGlmIChudWxsID09PSB0KSByZXR1cm4gZS5pc05vRG9jdW1lbnQoKSA/IG5ldyBfX1BSSVZBVEVfRGVsZXRlTXV0YXRpb24oZS5rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpIDogbmV3IF9fUFJJVkFURV9TZXRNdXRhdGlvbihlLmtleSwgZS5kYXRhLCBQcmVjb25kaXRpb24ubm9uZSgpKTtcbiAgICB7XG4gICAgICAgIGNvbnN0IG4gPSBlLmRhdGEsIHIgPSBPYmplY3RWYWx1ZS5lbXB0eSgpO1xuICAgICAgICBsZXQgaSA9IG5ldyBTb3J0ZWRTZXQoRmllbGRQYXRoJDEuY29tcGFyYXRvcik7XG4gICAgICAgIGZvciAobGV0IGUgb2YgdC5maWVsZHMpIGlmICghaS5oYXMoZSkpIHtcbiAgICAgICAgICAgIGxldCB0ID0gbi5maWVsZChlKTtcbiAgICAgICAgICAgIC8vIElmIHdlIGFyZSBkZWxldGluZyBhIG5lc3RlZCBmaWVsZCwgd2UgdGFrZSB0aGUgaW1tZWRpYXRlIHBhcmVudCBhc1xuICAgICAgICAgICAgLy8gdGhlIG1hc2sgdXNlZCB0byBjb25zdHJ1Y3QgdGhlIHJlc3VsdGluZyBtdXRhdGlvbi5cbiAgICAgICAgICAgIC8vIEp1c3RpZmljYXRpb246IE5lc3RlZCBmaWVsZHMgY2FuIGNyZWF0ZSBwYXJlbnQgZmllbGRzIGltcGxpY2l0bHkuIElmXG4gICAgICAgICAgICAvLyBvbmx5IGEgbGVhZiBlbnRyeSBpcyBkZWxldGVkIGluIGxhdGVyIG11dGF0aW9ucywgdGhlIHBhcmVudCBmaWVsZFxuICAgICAgICAgICAgLy8gc2hvdWxkIHN0aWxsIHJlbWFpbiwgYnV0IHdlIG1heSBoYXZlIGxvc3QgdGhpcyBpbmZvcm1hdGlvbi5cbiAgICAgICAgICAgIC8vIENvbnNpZGVyIG11dGF0aW9uIChmb28uYmFyIDEpLCB0aGVuIG11dGF0aW9uIChmb28uYmFyIGRlbGV0ZSgpKS5cbiAgICAgICAgICAgIC8vIFRoaXMgbGVhdmVzIHRoZSBmaW5hbCByZXN1bHQgKGZvbywge30pLiBEZXNwaXRlIHRoZSBmYWN0IHRoYXQgYGRvY2BcbiAgICAgICAgICAgIC8vIGhhcyB0aGUgY29ycmVjdCByZXN1bHQsIGBmb29gIGlzIG5vdCBpbiBgbWFza2AsIGFuZCB0aGUgcmVzdWx0aW5nXG4gICAgICAgICAgICAvLyBtdXRhdGlvbiB3b3VsZCBtaXNzIGBmb29gLlxuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA9PT0gdCAmJiBlLmxlbmd0aCA+IDEgJiYgKGUgPSBlLnBvcExhc3QoKSwgdCA9IG4uZmllbGQoZSkpLCBudWxsID09PSB0ID8gci5kZWxldGUoZSkgOiByLnNldChlLCB0KSwgXG4gICAgICAgICAgICBpID0gaS5hZGQoZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUGF0Y2hNdXRhdGlvbihlLmtleSwgciwgbmV3IEZpZWxkTWFzayhpLnRvQXJyYXkoKSksIFByZWNvbmRpdGlvbi5ub25lKCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBcHBsaWVzIHRoaXMgbXV0YXRpb24gdG8gdGhlIGdpdmVuIGRvY3VtZW50IGZvciB0aGUgcHVycG9zZXMgb2YgY29tcHV0aW5nIGFcbiAqIG5ldyByZW1vdGUgZG9jdW1lbnQuIElmIHRoZSBpbnB1dCBkb2N1bWVudCBkb2Vzbid0IG1hdGNoIHRoZSBleHBlY3RlZCBzdGF0ZVxuICogKGUuZy4gaXQgaXMgaW52YWxpZCBvciBvdXRkYXRlZCksIHRoZSBkb2N1bWVudCB0eXBlIG1heSB0cmFuc2l0aW9uIHRvXG4gKiB1bmtub3duLlxuICpcbiAqIEBwYXJhbSBtdXRhdGlvbiAtIFRoZSBtdXRhdGlvbiB0byBhcHBseS5cbiAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBtdXRhdGUuIFRoZSBpbnB1dCBkb2N1bWVudCBjYW4gYmUgYW5cbiAqICAgICBpbnZhbGlkIGRvY3VtZW50IGlmIHRoZSBjbGllbnQgaGFzIG5vIGtub3dsZWRnZSBvZiB0aGUgcHJlLW11dGF0aW9uIHN0YXRlXG4gKiAgICAgb2YgdGhlIGRvY3VtZW50LlxuICogQHBhcmFtIG11dGF0aW9uUmVzdWx0IC0gVGhlIHJlc3VsdCBvZiBhcHBseWluZyB0aGUgbXV0YXRpb24gZnJvbSB0aGUgYmFja2VuZC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoZSwgdCwgbikge1xuICAgIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfU2V0TXV0YXRpb24gPyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0TXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoZSwgdCwgbikge1xuICAgICAgICAvLyBVbmxpa2Ugc2V0TXV0YXRpb25BcHBseVRvTG9jYWxWaWV3LCBpZiB3ZSdyZSBhcHBseWluZyBhIG11dGF0aW9uIHRvIGFcbiAgICAgICAgLy8gcmVtb3RlIGRvY3VtZW50IHRoZSBzZXJ2ZXIgaGFzIGFjY2VwdGVkIHRoZSBtdXRhdGlvbiBzbyB0aGUgcHJlY29uZGl0aW9uXG4gICAgICAgIC8vIG11c3QgaGF2ZSBoZWxkLlxuICAgICAgICBjb25zdCByID0gZS52YWx1ZS5jbG9uZSgpLCBpID0gX19QUklWQVRFX3NlcnZlclRyYW5zZm9ybVJlc3VsdHMoZS5maWVsZFRyYW5zZm9ybXMsIHQsIG4udHJhbnNmb3JtUmVzdWx0cyk7XG4gICAgICAgIHIuc2V0QWxsKGkpLCB0LmNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQobi52ZXJzaW9uLCByKS5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKTtcbiAgICB9KGUsIHQsIG4pIDogZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9QYXRjaE11dGF0aW9uID8gZnVuY3Rpb24gX19QUklWQVRFX3BhdGNoTXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoZSwgdCwgbikge1xuICAgICAgICBpZiAoIV9fUFJJVkFURV9wcmVjb25kaXRpb25Jc1ZhbGlkRm9yRG9jdW1lbnQoZS5wcmVjb25kaXRpb24sIHQpKSBcbiAgICAgICAgLy8gU2luY2UgdGhlIG11dGF0aW9uIHdhcyBub3QgcmVqZWN0ZWQsIHdlIGtub3cgdGhhdCB0aGUgcHJlY29uZGl0aW9uXG4gICAgICAgIC8vIG1hdGNoZWQgb24gdGhlIGJhY2tlbmQuIFdlIHRoZXJlZm9yZSBtdXN0IG5vdCBoYXZlIHRoZSBleHBlY3RlZCB2ZXJzaW9uXG4gICAgICAgIC8vIG9mIHRoZSBkb2N1bWVudCBpbiBvdXIgY2FjaGUgYW5kIGNvbnZlcnQgdG8gYW4gVW5rbm93bkRvY3VtZW50IHdpdGggYVxuICAgICAgICAvLyBrbm93biB1cGRhdGVUaW1lLlxuICAgICAgICByZXR1cm4gdm9pZCB0LmNvbnZlcnRUb1Vua25vd25Eb2N1bWVudChuLnZlcnNpb24pO1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3NlcnZlclRyYW5zZm9ybVJlc3VsdHMoZS5maWVsZFRyYW5zZm9ybXMsIHQsIG4udHJhbnNmb3JtUmVzdWx0cyksIGkgPSB0LmRhdGE7XG4gICAgICAgIGkuc2V0QWxsKF9fUFJJVkFURV9nZXRQYXRjaChlKSksIGkuc2V0QWxsKHIpLCB0LmNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQobi52ZXJzaW9uLCBpKS5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKTtcbiAgICB9KGUsIHQsIG4pIDogZnVuY3Rpb24gX19QUklWQVRFX2RlbGV0ZU11dGF0aW9uQXBwbHlUb1JlbW90ZURvY3VtZW50KGUsIHQsIG4pIHtcbiAgICAgICAgLy8gVW5saWtlIGFwcGx5VG9Mb2NhbFZpZXcsIGlmIHdlJ3JlIGFwcGx5aW5nIGEgbXV0YXRpb24gdG8gYSByZW1vdGVcbiAgICAgICAgLy8gZG9jdW1lbnQgdGhlIHNlcnZlciBoYXMgYWNjZXB0ZWQgdGhlIG11dGF0aW9uIHNvIHRoZSBwcmVjb25kaXRpb24gbXVzdFxuICAgICAgICAvLyBoYXZlIGhlbGQuXG4gICAgICAgIHQuY29udmVydFRvTm9Eb2N1bWVudChuLnZlcnNpb24pLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0oMCwgdCwgbik7XG59XG5cbi8qKlxuICogQXBwbGllcyB0aGlzIG11dGF0aW9uIHRvIHRoZSBnaXZlbiBkb2N1bWVudCBmb3IgdGhlIHB1cnBvc2VzIG9mIGNvbXB1dGluZ1xuICogdGhlIG5ldyBsb2NhbCB2aWV3IG9mIGEgZG9jdW1lbnQuIElmIHRoZSBpbnB1dCBkb2N1bWVudCBkb2Vzbid0IG1hdGNoIHRoZVxuICogZXhwZWN0ZWQgc3RhdGUsIHRoZSBkb2N1bWVudCBpcyBub3QgbW9kaWZpZWQuXG4gKlxuICogQHBhcmFtIG11dGF0aW9uIC0gVGhlIG11dGF0aW9uIHRvIGFwcGx5LlxuICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIG11dGF0ZS4gVGhlIGlucHV0IGRvY3VtZW50IGNhbiBiZSBhblxuICogICAgIGludmFsaWQgZG9jdW1lbnQgaWYgdGhlIGNsaWVudCBoYXMgbm8ga25vd2xlZGdlIG9mIHRoZSBwcmUtbXV0YXRpb24gc3RhdGVcbiAqICAgICBvZiB0aGUgZG9jdW1lbnQuXG4gKiBAcGFyYW0gcHJldmlvdXNNYXNrIC0gVGhlIGZpZWxkcyB0aGF0IGhhdmUgYmVlbiB1cGRhdGVkIGJlZm9yZSBhcHBseWluZyB0aGlzIG11dGF0aW9uLlxuICogQHBhcmFtIGxvY2FsV3JpdGVUaW1lIC0gQSB0aW1lc3RhbXAgaW5kaWNhdGluZyB0aGUgbG9jYWwgd3JpdGUgdGltZSBvZiB0aGVcbiAqICAgICBiYXRjaCB0aGlzIG11dGF0aW9uIGlzIGEgcGFydCBvZi5cbiAqIEByZXR1cm5zIEEgYEZpZWxkTWFza2AgcmVwcmVzZW50aW5nIHRoZSBmaWVsZHMgdGhhdCBhcmUgY2hhbmdlZCBieSBhcHBseWluZyB0aGlzIG11dGF0aW9uLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcoZSwgdCwgbiwgcikge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgX19QUklWQVRFX1NldE11dGF0aW9uID8gZnVuY3Rpb24gX19QUklWQVRFX3NldE11dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhlLCB0LCBuLCByKSB7XG4gICAgICAgIGlmICghX19QUklWQVRFX3ByZWNvbmRpdGlvbklzVmFsaWRGb3JEb2N1bWVudChlLnByZWNvbmRpdGlvbiwgdCkpIFxuICAgICAgICAvLyBUaGUgbXV0YXRpb24gZmFpbGVkIHRvIGFwcGx5IChlLmcuIGEgZG9jdW1lbnQgSUQgY3JlYXRlZCB3aXRoIGFkZCgpXG4gICAgICAgIC8vIGNhdXNlZCBhIG5hbWUgY29sbGlzaW9uKS5cbiAgICAgICAgcmV0dXJuIG47XG4gICAgICAgIGNvbnN0IGkgPSBlLnZhbHVlLmNsb25lKCksIHMgPSBfX1BSSVZBVEVfbG9jYWxUcmFuc2Zvcm1SZXN1bHRzKGUuZmllbGRUcmFuc2Zvcm1zLCByLCB0KTtcbiAgICAgICAgcmV0dXJuIGkuc2V0QWxsKHMpLCB0LmNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQodC52ZXJzaW9uLCBpKS5zZXRIYXNMb2NhbE11dGF0aW9ucygpLCBcbiAgICAgICAgbnVsbDtcbiAvLyBTZXRNdXRhdGlvbiBvdmVyd3JpdGVzIGFsbCBmaWVsZHMuXG4gICAgICAgIH1cbiAgICAvKipcbiAqIEEgbXV0YXRpb24gdGhhdCBtb2RpZmllcyBmaWVsZHMgb2YgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkgd2l0aCB0aGVcbiAqIGdpdmVuIHZhbHVlcy4gVGhlIHZhbHVlcyBhcmUgYXBwbGllZCB0aHJvdWdoIGEgZmllbGQgbWFzazpcbiAqXG4gKiAgKiBXaGVuIGEgZmllbGQgaXMgaW4gYm90aCB0aGUgbWFzayBhbmQgdGhlIHZhbHVlcywgdGhlIGNvcnJlc3BvbmRpbmcgZmllbGRcbiAqICAgIGlzIHVwZGF0ZWQuXG4gKiAgKiBXaGVuIGEgZmllbGQgaXMgaW4gbmVpdGhlciB0aGUgbWFzayBub3IgdGhlIHZhbHVlcywgdGhlIGNvcnJlc3BvbmRpbmdcbiAqICAgIGZpZWxkIGlzIHVubW9kaWZpZWQuXG4gKiAgKiBXaGVuIGEgZmllbGQgaXMgaW4gdGhlIG1hc2sgYnV0IG5vdCBpbiB0aGUgdmFsdWVzLCB0aGUgY29ycmVzcG9uZGluZyBmaWVsZFxuICogICAgaXMgZGVsZXRlZC5cbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBub3QgaW4gdGhlIG1hc2sgYnV0IGlzIGluIHRoZSB2YWx1ZXMsIHRoZSB2YWx1ZXMgbWFwIGlzXG4gKiAgICBpZ25vcmVkLlxuICovIChlLCB0LCBuLCByKSA6IGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfUGF0Y2hNdXRhdGlvbiA/IGZ1bmN0aW9uIF9fUFJJVkFURV9wYXRjaE11dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhlLCB0LCBuLCByKSB7XG4gICAgICAgIGlmICghX19QUklWQVRFX3ByZWNvbmRpdGlvbklzVmFsaWRGb3JEb2N1bWVudChlLnByZWNvbmRpdGlvbiwgdCkpIHJldHVybiBuO1xuICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2xvY2FsVHJhbnNmb3JtUmVzdWx0cyhlLmZpZWxkVHJhbnNmb3JtcywgciwgdCksIHMgPSB0LmRhdGE7XG4gICAgICAgIGlmIChzLnNldEFsbChfX1BSSVZBVEVfZ2V0UGF0Y2goZSkpLCBzLnNldEFsbChpKSwgdC5jb252ZXJ0VG9Gb3VuZERvY3VtZW50KHQudmVyc2lvbiwgcykuc2V0SGFzTG9jYWxNdXRhdGlvbnMoKSwgXG4gICAgICAgIG51bGwgPT09IG4pIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gbi51bmlvbldpdGgoZS5maWVsZE1hc2suZmllbGRzKS51bmlvbldpdGgoZS5maWVsZFRyYW5zZm9ybXMubWFwKChlID0+IGUuZmllbGQpKSk7XG4gICAgfVxuICAgIC8qKlxuICogUmV0dXJucyBhIEZpZWxkUGF0aC9WYWx1ZSBtYXAgd2l0aCB0aGUgY29udGVudCBvZiB0aGUgUGF0Y2hNdXRhdGlvbi5cbiAqLyAoZSwgdCwgbiwgcikgOiBmdW5jdGlvbiBfX1BSSVZBVEVfZGVsZXRlTXV0YXRpb25BcHBseVRvTG9jYWxWaWV3KGUsIHQsIG4pIHtcbiAgICAgICAgaWYgKF9fUFJJVkFURV9wcmVjb25kaXRpb25Jc1ZhbGlkRm9yRG9jdW1lbnQoZS5wcmVjb25kaXRpb24sIHQpKSByZXR1cm4gdC5jb252ZXJ0VG9Ob0RvY3VtZW50KHQudmVyc2lvbikuc2V0SGFzTG9jYWxNdXRhdGlvbnMoKSwgXG4gICAgICAgIG51bGw7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbiAgICAvKipcbiAqIEEgbXV0YXRpb24gdGhhdCB2ZXJpZmllcyB0aGUgZXhpc3RlbmNlIG9mIHRoZSBkb2N1bWVudCBhdCB0aGUgZ2l2ZW4ga2V5IHdpdGhcbiAqIHRoZSBwcm92aWRlZCBwcmVjb25kaXRpb24uXG4gKlxuICogVGhlIGB2ZXJpZnlgIG9wZXJhdGlvbiBpcyBvbmx5IHVzZWQgaW4gVHJhbnNhY3Rpb25zLCBhbmQgdGhpcyBjbGFzcyBzZXJ2ZXNcbiAqIHByaW1hcmlseSB0byBmYWNpbGl0YXRlIHNlcmlhbGl6YXRpb24gaW50byBwcm90b3MuXG4gKi8gKGUsIHQsIG4pO1xufVxuXG4vKipcbiAqIElmIHRoaXMgbXV0YXRpb24gaXMgbm90IGlkZW1wb3RlbnQsIHJldHVybnMgdGhlIGJhc2UgdmFsdWUgdG8gcGVyc2lzdCB3aXRoXG4gKiB0aGlzIG11dGF0aW9uLiBJZiBhIGJhc2UgdmFsdWUgaXMgcmV0dXJuZWQsIHRoZSBtdXRhdGlvbiBpcyBhbHdheXMgYXBwbGllZFxuICogdG8gdGhpcyBiYXNlIHZhbHVlLCBldmVuIGlmIGRvY3VtZW50IGhhcyBhbHJlYWR5IGJlZW4gdXBkYXRlZC5cbiAqXG4gKiBUaGUgYmFzZSB2YWx1ZSBpcyBhIHNwYXJzZSBvYmplY3QgdGhhdCBjb25zaXN0cyBvZiBvbmx5IHRoZSBkb2N1bWVudFxuICogZmllbGRzIGZvciB3aGljaCB0aGlzIG11dGF0aW9uIGNvbnRhaW5zIGEgbm9uLWlkZW1wb3RlbnQgdHJhbnNmb3JtYXRpb25cbiAqIChlLmcuIGEgbnVtZXJpYyBpbmNyZW1lbnQpLiBUaGUgcHJvdmlkZWQgdmFsdWUgZ3VhcmFudGVlcyBjb25zaXN0ZW50XG4gKiBiZWhhdmlvciBmb3Igbm9uLWlkZW1wb3RlbnQgdHJhbnNmb3JtcyBhbmQgYWxsb3cgdXMgdG8gcmV0dXJuIHRoZSBzYW1lXG4gKiBsYXRlbmN5LWNvbXBlbnNhdGVkIHZhbHVlIGV2ZW4gaWYgdGhlIGJhY2tlbmQgaGFzIGFscmVhZHkgYXBwbGllZCB0aGVcbiAqIG11dGF0aW9uLiBUaGUgYmFzZSB2YWx1ZSBpcyBudWxsIGZvciBpZGVtcG90ZW50IG11dGF0aW9ucywgYXMgdGhleSBjYW4gYmVcbiAqIHJlLXBsYXllZCBldmVuIGlmIHRoZSBiYWNrZW5kIGhhcyBhbHJlYWR5IGFwcGxpZWQgdGhlbS5cbiAqXG4gKiBAcmV0dXJucyBhIGJhc2UgdmFsdWUgdG8gc3RvcmUgYWxvbmcgd2l0aCB0aGUgbXV0YXRpb24sIG9yIG51bGwgZm9yXG4gKiBpZGVtcG90ZW50IG11dGF0aW9ucy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25FeHRyYWN0QmFzZVZhbHVlKGUsIHQpIHtcbiAgICBsZXQgbiA9IG51bGw7XG4gICAgZm9yIChjb25zdCByIG9mIGUuZmllbGRUcmFuc2Zvcm1zKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LmRhdGEuZmllbGQoci5maWVsZCksIGkgPSBfX1BSSVZBVEVfY29tcHV0ZVRyYW5zZm9ybU9wZXJhdGlvbkJhc2VWYWx1ZShyLnRyYW5zZm9ybSwgZSB8fCBudWxsKTtcbiAgICAgICAgbnVsbCAhPSBpICYmIChudWxsID09PSBuICYmIChuID0gT2JqZWN0VmFsdWUuZW1wdHkoKSksIG4uc2V0KHIuZmllbGQsIGkpKTtcbiAgICB9XG4gICAgcmV0dXJuIG4gfHwgbnVsbDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX211dGF0aW9uRXF1YWxzKGUsIHQpIHtcbiAgICByZXR1cm4gZS50eXBlID09PSB0LnR5cGUgJiYgKCEhZS5rZXkuaXNFcXVhbCh0LmtleSkgJiYgKCEhZS5wcmVjb25kaXRpb24uaXNFcXVhbCh0LnByZWNvbmRpdGlvbikgJiYgKCEhZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkVHJhbnNmb3Jtc0FyZUVxdWFsKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiB2b2lkIDAgPT09IHQgfHwgISghZSB8fCAhdCkgJiYgX19QUklWQVRFX2FycmF5RXF1YWxzKGUsIHQsICgoZSwgdCkgPT4gX19QUklWQVRFX2ZpZWxkVHJhbnNmb3JtRXF1YWxzKGUsIHQpKSk7XG4gICAgfShlLmZpZWxkVHJhbnNmb3JtcywgdC5maWVsZFRyYW5zZm9ybXMpICYmICgwIC8qIE11dGF0aW9uVHlwZS5TZXQgKi8gPT09IGUudHlwZSA/IGUudmFsdWUuaXNFcXVhbCh0LnZhbHVlKSA6IDEgLyogTXV0YXRpb25UeXBlLlBhdGNoICovICE9PSBlLnR5cGUgfHwgZS5kYXRhLmlzRXF1YWwodC5kYXRhKSAmJiBlLmZpZWxkTWFzay5pc0VxdWFsKHQuZmllbGRNYXNrKSkpKSk7XG59XG5cbi8qKlxuICogQSBtdXRhdGlvbiB0aGF0IGNyZWF0ZXMgb3IgcmVwbGFjZXMgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkgd2l0aCB0aGVcbiAqIG9iamVjdCB2YWx1ZSBjb250ZW50cy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU2V0TXV0YXRpb24gZXh0ZW5kcyBNdXRhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciA9IFtdKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMua2V5ID0gZSwgdGhpcy52YWx1ZSA9IHQsIHRoaXMucHJlY29uZGl0aW9uID0gbiwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSByLCBcbiAgICAgICAgdGhpcy50eXBlID0gMCAvKiBNdXRhdGlvblR5cGUuU2V0ICovO1xuICAgIH1cbiAgICBnZXRGaWVsZE1hc2soKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX1BhdGNoTXV0YXRpb24gZXh0ZW5kcyBNdXRhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSA9IFtdKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMua2V5ID0gZSwgdGhpcy5kYXRhID0gdCwgdGhpcy5maWVsZE1hc2sgPSBuLCB0aGlzLnByZWNvbmRpdGlvbiA9IHIsIFxuICAgICAgICB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IGksIHRoaXMudHlwZSA9IDEgLyogTXV0YXRpb25UeXBlLlBhdGNoICovO1xuICAgIH1cbiAgICBnZXRGaWVsZE1hc2soKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpZWxkTWFzaztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRQYXRjaChlKSB7XG4gICAgY29uc3QgdCA9IG5ldyBNYXA7XG4gICAgcmV0dXJuIGUuZmllbGRNYXNrLmZpZWxkcy5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgaWYgKCFuLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgY29uc3QgciA9IGUuZGF0YS5maWVsZChuKTtcbiAgICAgICAgICAgIHQuc2V0KG4sIHIpO1xuICAgICAgICB9XG4gICAgfSkpLCB0O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBsaXN0IG9mIFwidHJhbnNmb3JtIHJlc3VsdHNcIiAoYSB0cmFuc2Zvcm0gcmVzdWx0IGlzIGEgZmllbGQgdmFsdWVcbiAqIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGEgdHJhbnNmb3JtKSBmb3IgdXNlIGFmdGVyIGEgbXV0YXRpb25cbiAqIGNvbnRhaW5pbmcgdHJhbnNmb3JtcyBoYXMgYmVlbiBhY2tub3dsZWRnZWQgYnkgdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0gZmllbGRUcmFuc2Zvcm1zIC0gVGhlIGZpZWxkIHRyYW5zZm9ybXMgdG8gYXBwbHkgdGhlIHJlc3VsdCB0by5cbiAqIEBwYXJhbSBtdXRhYmxlRG9jdW1lbnQgLSBUaGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQgYWZ0ZXIgYXBwbHlpbmcgYWxsXG4gKiBwcmV2aW91cyBtdXRhdGlvbnMuXG4gKiBAcGFyYW0gc2VydmVyVHJhbnNmb3JtUmVzdWx0cyAtIFRoZSB0cmFuc2Zvcm0gcmVzdWx0cyByZWNlaXZlZCBieSB0aGUgc2VydmVyLlxuICogQHJldHVybnMgVGhlIHRyYW5zZm9ybSByZXN1bHRzIGxpc3QuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3NlcnZlclRyYW5zZm9ybVJlc3VsdHMoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBuZXcgTWFwO1xuICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUubGVuZ3RoID09PSBuLmxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHMgPSBlW2ldLCBvID0gcy50cmFuc2Zvcm0sIF8gPSB0LmRhdGEuZmllbGQocy5maWVsZCk7XG4gICAgICAgIHIuc2V0KHMuZmllbGQsIF9fUFJJVkFURV9hcHBseVRyYW5zZm9ybU9wZXJhdGlvblRvUmVtb3RlRG9jdW1lbnQobywgXywgbltpXSkpO1xuICAgIH1cbiAgICByZXR1cm4gcjtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbGlzdCBvZiBcInRyYW5zZm9ybSByZXN1bHRzXCIgKGEgdHJhbnNmb3JtIHJlc3VsdCBpcyBhIGZpZWxkIHZhbHVlXG4gKiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdCBvZiBhcHBseWluZyBhIHRyYW5zZm9ybSkgZm9yIHVzZSB3aGVuIGFwcGx5aW5nIGFcbiAqIHRyYW5zZm9ybSBsb2NhbGx5LlxuICpcbiAqIEBwYXJhbSBmaWVsZFRyYW5zZm9ybXMgLSBUaGUgZmllbGQgdHJhbnNmb3JtcyB0byBhcHBseSB0aGUgcmVzdWx0IHRvLlxuICogQHBhcmFtIGxvY2FsV3JpdGVUaW1lIC0gVGhlIGxvY2FsIHRpbWUgb2YgdGhlIG11dGF0aW9uICh1c2VkIHRvXG4gKiAgICAgZ2VuZXJhdGUgU2VydmVyVGltZXN0YW1wVmFsdWVzKS5cbiAqIEBwYXJhbSBtdXRhYmxlRG9jdW1lbnQgLSBUaGUgZG9jdW1lbnQgdG8gYXBwbHkgdHJhbnNmb3JtcyBvbi5cbiAqIEByZXR1cm5zIFRoZSB0cmFuc2Zvcm0gcmVzdWx0cyBsaXN0LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFRyYW5zZm9ybVJlc3VsdHMoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBuZXcgTWFwO1xuICAgIGZvciAoY29uc3QgaSBvZiBlKSB7XG4gICAgICAgIGNvbnN0IGUgPSBpLnRyYW5zZm9ybSwgcyA9IG4uZGF0YS5maWVsZChpLmZpZWxkKTtcbiAgICAgICAgci5zZXQoaS5maWVsZCwgX19QUklWQVRFX2FwcGx5VHJhbnNmb3JtT3BlcmF0aW9uVG9Mb2NhbFZpZXcoZSwgcywgdCkpO1xuICAgIH1cbiAgICByZXR1cm4gcjtcbn1cblxuLyoqIEEgbXV0YXRpb24gdGhhdCBkZWxldGVzIHRoZSBkb2N1bWVudCBhdCB0aGUgZ2l2ZW4ga2V5LiAqLyBjbGFzcyBfX1BSSVZBVEVfRGVsZXRlTXV0YXRpb24gZXh0ZW5kcyBNdXRhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmtleSA9IGUsIHRoaXMucHJlY29uZGl0aW9uID0gdCwgdGhpcy50eXBlID0gMiAvKiBNdXRhdGlvblR5cGUuRGVsZXRlICovICwgXG4gICAgICAgIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gW107XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfVmVyaWZ5TXV0YXRpb24gZXh0ZW5kcyBNdXRhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmtleSA9IGUsIHRoaXMucHJlY29uZGl0aW9uID0gdCwgdGhpcy50eXBlID0gMyAvKiBNdXRhdGlvblR5cGUuVmVyaWZ5ICovICwgXG4gICAgICAgIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gW107XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGJhdGNoIG9mIG11dGF0aW9ucyB0aGF0IHdpbGwgYmUgc2VudCBhcyBvbmUgdW5pdCB0byB0aGUgYmFja2VuZC5cbiAqLyBjbGFzcyBNdXRhdGlvbkJhdGNoIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gYmF0Y2hJZCAtIFRoZSB1bmlxdWUgSUQgb2YgdGhpcyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgKiBAcGFyYW0gbG9jYWxXcml0ZVRpbWUgLSBUaGUgb3JpZ2luYWwgd3JpdGUgdGltZSBvZiB0aGlzIG11dGF0aW9uLlxuICAgICAqIEBwYXJhbSBiYXNlTXV0YXRpb25zIC0gTXV0YXRpb25zIHRoYXQgYXJlIHVzZWQgdG8gcG9wdWxhdGUgdGhlIGJhc2VcbiAgICAgKiB2YWx1ZXMgd2hlbiB0aGlzIG11dGF0aW9uIGlzIGFwcGxpZWQgbG9jYWxseS4gVGhpcyBjYW4gYmUgdXNlZCB0byBsb2NhbGx5XG4gICAgICogb3ZlcndyaXRlIHZhbHVlcyB0aGF0IGFyZSBwZXJzaXN0ZWQgaW4gdGhlIHJlbW90ZSBkb2N1bWVudCBjYWNoZS4gQmFzZVxuICAgICAqIG11dGF0aW9ucyBhcmUgbmV2ZXIgc2VudCB0byB0aGUgYmFja2VuZC5cbiAgICAgKiBAcGFyYW0gbXV0YXRpb25zIC0gVGhlIHVzZXItcHJvdmlkZWQgbXV0YXRpb25zIGluIHRoaXMgbXV0YXRpb24gYmF0Y2guXG4gICAgICogVXNlci1wcm92aWRlZCBtdXRhdGlvbnMgYXJlIGFwcGxpZWQgYm90aCBsb2NhbGx5IGFuZCByZW1vdGVseSBvbiB0aGVcbiAgICAgKiBiYWNrZW5kLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5iYXRjaElkID0gZSwgdGhpcy5sb2NhbFdyaXRlVGltZSA9IHQsIHRoaXMuYmFzZU11dGF0aW9ucyA9IG4sIHRoaXMubXV0YXRpb25zID0gcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyBhbGwgdGhlIG11dGF0aW9ucyBpbiB0aGlzIE11dGF0aW9uQmF0Y2ggdG8gdGhlIHNwZWNpZmllZCBkb2N1bWVudFxuICAgICAqIHRvIGNvbXB1dGUgdGhlIHN0YXRlIG9mIHRoZSByZW1vdGUgZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBhcHBseSBtdXRhdGlvbnMgdG8uXG4gICAgICogQHBhcmFtIGJhdGNoUmVzdWx0IC0gVGhlIHJlc3VsdCBvZiBhcHBseWluZyB0aGUgTXV0YXRpb25CYXRjaCB0byB0aGVcbiAgICAgKiBiYWNrZW5kLlxuICAgICAqLyAgICBhcHBseVRvUmVtb3RlRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdC5tdXRhdGlvblJlc3VsdHM7XG4gICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgdGhpcy5tdXRhdGlvbnMubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLm11dGF0aW9uc1t0XTtcbiAgICAgICAgICAgIGlmIChyLmtleS5pc0VxdWFsKGUua2V5KSkge1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9SZW1vdGVEb2N1bWVudChyLCBlLCBuW3RdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbG9jYWwgdmlldyBvZiBhIGRvY3VtZW50IGdpdmVuIGFsbCB0aGUgbXV0YXRpb25zIGluIHRoaXNcbiAgICAgKiBiYXRjaC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBhcHBseSBtdXRhdGlvbnMgdG8uXG4gICAgICogQHBhcmFtIG11dGF0ZWRGaWVsZHMgLSBGaWVsZHMgdGhhdCBoYXZlIGJlZW4gdXBkYXRlZCBiZWZvcmUgYXBwbHlpbmcgdGhpcyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgKiBAcmV0dXJucyBBIGBGaWVsZE1hc2tgIHJlcHJlc2VudGluZyBhbGwgdGhlIGZpZWxkcyB0aGF0IGFyZSBtdXRhdGVkLlxuICAgICAqLyAgICBhcHBseVRvTG9jYWxWaWV3KGUsIHQpIHtcbiAgICAgICAgLy8gRmlyc3QsIGFwcGx5IHRoZSBiYXNlIHN0YXRlLiBUaGlzIGFsbG93cyB1cyB0byBhcHBseSBub24taWRlbXBvdGVudFxuICAgICAgICAvLyB0cmFuc2Zvcm0gYWdhaW5zdCBhIGNvbnNpc3RlbnQgc2V0IG9mIHZhbHVlcy5cbiAgICAgICAgZm9yIChjb25zdCBuIG9mIHRoaXMuYmFzZU11dGF0aW9ucykgbi5rZXkuaXNFcXVhbChlLmtleSkgJiYgKHQgPSBfX1BSSVZBVEVfbXV0YXRpb25BcHBseVRvTG9jYWxWaWV3KG4sIGUsIHQsIHRoaXMubG9jYWxXcml0ZVRpbWUpKTtcbiAgICAgICAgLy8gU2Vjb25kLCBhcHBseSBhbGwgdXNlci1wcm92aWRlZCBtdXRhdGlvbnMuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHRoaXMubXV0YXRpb25zKSBuLmtleS5pc0VxdWFsKGUua2V5KSAmJiAodCA9IF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcobiwgZSwgdCwgdGhpcy5sb2NhbFdyaXRlVGltZSkpO1xuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tcHV0ZXMgdGhlIGxvY2FsIHZpZXcgZm9yIGFsbCBwcm92aWRlZCBkb2N1bWVudHMgZ2l2ZW4gdGhlIG11dGF0aW9ucyBpblxuICAgICAqIHRoaXMgYmF0Y2guIFJldHVybnMgYSBgRG9jdW1lbnRLZXlgIHRvIGBNdXRhdGlvbmAgbWFwIHdoaWNoIGNhbiBiZSB1c2VkIHRvXG4gICAgICogcmVwbGFjZSBhbGwgdGhlIG11dGF0aW9uIGFwcGxpY2F0aW9ucy5cbiAgICAgKi8gICAgYXBwbHlUb0xvY2FsRG9jdW1lbnRTZXQoZSwgdCkge1xuICAgICAgICAvLyBUT0RPKG1yc2NobWlkdCk6IFRoaXMgaW1wbGVtZW50YXRpb24gaXMgTyhuXjIpLiBJZiB3ZSBhcHBseSB0aGUgbXV0YXRpb25zXG4gICAgICAgIC8vIGRpcmVjdGx5IChhcyBkb25lIGluIGBhcHBseVRvTG9jYWxWaWV3KClgKSwgd2UgY2FuIHJlZHVjZSB0aGUgY29tcGxleGl0eVxuICAgICAgICAvLyB0byBPKG4pLlxuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25ld011dGF0aW9uTWFwKCk7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9ucy5mb3JFYWNoKChyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBlLmdldChyLmtleSksIHMgPSBpLm92ZXJsYXllZERvY3VtZW50O1xuICAgICAgICAgICAgLy8gVE9ETyhtdXRhYmxlZG9jdW1lbnRzKTogVGhpcyBtZXRob2Qgc2hvdWxkIHRha2UgYSBNdXRhYmxlRG9jdW1lbnRNYXBcbiAgICAgICAgICAgIC8vIGFuZCB3ZSBzaG91bGQgcmVtb3ZlIHRoaXMgY2FzdC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvID0gdGhpcy5hcHBseVRvTG9jYWxWaWV3KHMsIGkubXV0YXRlZEZpZWxkcyk7XG4gICAgICAgICAgICAvLyBTZXQgbXV0YXRlZEZpZWxkcyB0byBudWxsIGlmIHRoZSBkb2N1bWVudCBpcyBvbmx5IGZyb20gbG9jYWwgbXV0YXRpb25zLlxuICAgICAgICAgICAgLy8gVGhpcyBjcmVhdGVzIGEgU2V0IG9yIERlbGV0ZSBtdXRhdGlvbiwgaW5zdGVhZCBvZiB0cnlpbmcgdG8gY3JlYXRlIGFcbiAgICAgICAgICAgIC8vIHBhdGNoIG11dGF0aW9uIGFzIHRoZSBvdmVybGF5LlxuICAgICAgICAgICAgICAgICAgICAgICAgbyA9IHQuaGFzKHIua2V5KSA/IG51bGwgOiBvO1xuICAgICAgICAgICAgY29uc3QgXyA9IF9fUFJJVkFURV9jYWxjdWxhdGVPdmVybGF5TXV0YXRpb24ocywgbyk7XG4gICAgICAgICAgICBudWxsICE9PSBfICYmIG4uc2V0KHIua2V5LCBfKSwgcy5pc1ZhbGlkRG9jdW1lbnQoKSB8fCBzLmNvbnZlcnRUb05vRG9jdW1lbnQoU25hcHNob3RWZXJzaW9uLm1pbigpKTtcbiAgICAgICAgfSkpLCBuO1xuICAgIH1cbiAgICBrZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvbnMucmVkdWNlKCgoZSwgdCkgPT4gZS5hZGQodC5rZXkpKSwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCkpO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmF0Y2hJZCA9PT0gZS5iYXRjaElkICYmIF9fUFJJVkFURV9hcnJheUVxdWFscyh0aGlzLm11dGF0aW9ucywgZS5tdXRhdGlvbnMsICgoZSwgdCkgPT4gX19QUklWQVRFX211dGF0aW9uRXF1YWxzKGUsIHQpKSkgJiYgX19QUklWQVRFX2FycmF5RXF1YWxzKHRoaXMuYmFzZU11dGF0aW9ucywgZS5iYXNlTXV0YXRpb25zLCAoKGUsIHQpID0+IF9fUFJJVkFURV9tdXRhdGlvbkVxdWFscyhlLCB0KSkpO1xuICAgIH1cbn1cblxuLyoqIFRoZSByZXN1bHQgb2YgYXBwbHlpbmcgYSBtdXRhdGlvbiBiYXRjaCB0byB0aGUgYmFja2VuZC4gKi8gY2xhc3MgTXV0YXRpb25CYXRjaFJlc3VsdCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgXG4gICAgLyoqXG4gICAgICogQSBwcmUtY29tcHV0ZWQgbWFwcGluZyBmcm9tIGVhY2ggbXV0YXRlZCBkb2N1bWVudCB0byB0aGUgcmVzdWx0aW5nXG4gICAgICogdmVyc2lvbi5cbiAgICAgKi9cbiAgICByKSB7XG4gICAgICAgIHRoaXMuYmF0Y2ggPSBlLCB0aGlzLmNvbW1pdFZlcnNpb24gPSB0LCB0aGlzLm11dGF0aW9uUmVzdWx0cyA9IG4sIHRoaXMuZG9jVmVyc2lvbnMgPSByO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE11dGF0aW9uQmF0Y2hSZXN1bHQgZm9yIHRoZSBnaXZlbiBiYXRjaCBhbmQgcmVzdWx0cy4gVGhlcmVcbiAgICAgKiBtdXN0IGJlIG9uZSByZXN1bHQgZm9yIGVhY2ggbXV0YXRpb24gaW4gdGhlIGJhdGNoLiBUaGlzIHN0YXRpYyBmYWN0b3J5XG4gICAgICogY2FjaGVzIGEgZG9jdW1lbnQ9Jmd0O3ZlcnNpb24gbWFwcGluZyAoZG9jVmVyc2lvbnMpLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbShlLCB0LCBuKSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUubXV0YXRpb25zLmxlbmd0aCA9PT0gbi5sZW5ndGgpO1xuICAgICAgICBsZXQgciA9IGZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudFZlcnNpb25NYXAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYWU7XG4gICAgICAgIH0oKTtcbiAgICAgICAgY29uc3QgaSA9IGUubXV0YXRpb25zO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IGkubGVuZ3RoOyBlKyspIHIgPSByLmluc2VydChpW2VdLmtleSwgbltlXS52ZXJzaW9uKTtcbiAgICAgICAgcmV0dXJuIG5ldyBNdXRhdGlvbkJhdGNoUmVzdWx0KGUsIHQsIG4sIHIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50YXRpb24gb2YgYW4gb3ZlcmxheSBjb21wdXRlZCBieSBGaXJlc3RvcmUuXG4gKlxuICogSG9sZHMgaW5mb3JtYXRpb24gYWJvdXQgYSBtdXRhdGlvbiBhbmQgdGhlIGxhcmdlc3QgYmF0Y2ggaWQgaW4gRmlyZXN0b3JlIHdoZW5cbiAqIHRoZSBtdXRhdGlvbiB3YXMgY3JlYXRlZC5cbiAqLyBjbGFzcyBPdmVybGF5IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMubGFyZ2VzdEJhdGNoSWQgPSBlLCB0aGlzLm11dGF0aW9uID0gdDtcbiAgICB9XG4gICAgZ2V0S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvbi5rZXk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZSAmJiB0aGlzLm11dGF0aW9uID09PSBlLm11dGF0aW9uO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIGBPdmVybGF5e1xcbiAgICAgIGxhcmdlc3RCYXRjaElkOiAke3RoaXMubGFyZ2VzdEJhdGNoSWR9LFxcbiAgICAgIG11dGF0aW9uOiAke3RoaXMubXV0YXRpb24udG9TdHJpbmcoKX1cXG4gICAgfWA7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDb25jcmV0ZSBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgQWdncmVnYXRlIHR5cGUuXG4gKi8gY2xhc3MgX19QUklWQVRFX0FnZ3JlZ2F0ZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5hbGlhcyA9IGUsIHRoaXMuYWdncmVnYXRlVHlwZSA9IHQsIHRoaXMuZmllbGRQYXRoID0gbjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIEV4aXN0ZW5jZUZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmNvdW50ID0gZSwgdGhpcy51bmNoYW5nZWROYW1lcyA9IHQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBFcnJvciBDb2RlcyBkZXNjcmliaW5nIHRoZSBkaWZmZXJlbnQgd2F5cyBHUlBDIGNhbiBmYWlsLiBUaGVzZSBhcmUgY29waWVkXG4gKiBkaXJlY3RseSBmcm9tIEdSUEMncyBzb3VyY2VzIGhlcmU6XG4gKlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYy9ibG9iL2JjZWVjOTRlYTRmYzVmMDA4NWQ4MTIzNWQ4ZTFjMDY3OThkYzM0MWEvaW5jbHVkZS9ncnBjJTJCJTJCL2ltcGwvY29kZWdlbi9zdGF0dXNfY29kZV9lbnVtLmhcbiAqXG4gKiBJbXBvcnRhbnQhIFRoZSBuYW1lcyBvZiB0aGVzZSBpZGVudGlmaWVycyBtYXR0ZXIgYmVjYXVzZSB0aGUgc3RyaW5nIGZvcm1zXG4gKiBhcmUgdXNlZCBmb3IgcmV2ZXJzZSBsb29rdXBzIGZyb20gdGhlIHdlYmNoYW5uZWwgc3RyZWFtLiBEbyBOT1QgY2hhbmdlIHRoZVxuICogbmFtZXMgb2YgdGhlc2UgaWRlbnRpZmllcnMgb3IgY2hhbmdlIHRoaXMgaW50byBhIGNvbnN0IGVudW0uXG4gKi8gdmFyIGxlLCBoZTtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gZXJyb3IgY29kZSByZXByZXNlbnRzIGEgcGVybWFuZW50IGVycm9yIHdoZW4gcmVjZWl2ZWRcbiAqIGluIHJlc3BvbnNlIHRvIGEgbm9uLXdyaXRlIG9wZXJhdGlvbi5cbiAqXG4gKiBTZWUgaXNQZXJtYW5lbnRXcml0ZUVycm9yIGZvciBjbGFzc2lmeWluZyB3cml0ZSBlcnJvcnMuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc1Blcm1hbmVudEVycm9yKGUpIHtcbiAgICBzd2l0Y2ggKGUpIHtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWlsKCk7XG5cbiAgICAgIGNhc2UgRC5DQU5DRUxMRUQ6XG4gICAgICBjYXNlIEQuVU5LTk9XTjpcbiAgICAgIGNhc2UgRC5ERUFETElORV9FWENFRURFRDpcbiAgICAgIGNhc2UgRC5SRVNPVVJDRV9FWEhBVVNURUQ6XG4gICAgICBjYXNlIEQuSU5URVJOQUw6XG4gICAgICBjYXNlIEQuVU5BVkFJTEFCTEU6XG4gLy8gVW5hdXRoZW50aWNhdGVkIG1lYW5zIHNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggb3VyIHRva2VuIGFuZCB3ZSBuZWVkXG4gICAgICAgIC8vIHRvIHJldHJ5IHdpdGggbmV3IGNyZWRlbnRpYWxzIHdoaWNoIHdpbGwgaGFwcGVuIGF1dG9tYXRpY2FsbHkuXG4gICAgICAgICAgICAgIGNhc2UgRC5VTkFVVEhFTlRJQ0FURUQ6XG4gICAgICAgIHJldHVybiAhMTtcblxuICAgICAgY2FzZSBELklOVkFMSURfQVJHVU1FTlQ6XG4gICAgICBjYXNlIEQuTk9UX0ZPVU5EOlxuICAgICAgY2FzZSBELkFMUkVBRFlfRVhJU1RTOlxuICAgICAgY2FzZSBELlBFUk1JU1NJT05fREVOSUVEOlxuICAgICAgY2FzZSBELkZBSUxFRF9QUkVDT05ESVRJT046XG4gLy8gQWJvcnRlZCBtaWdodCBiZSByZXRyaWVkIGluIHNvbWUgc2NlbmFyaW9zLCBidXQgdGhhdCBpcyBkZXBlbmRlbnQgb25cbiAgICAgICAgLy8gdGhlIGNvbnRleHQgYW5kIHNob3VsZCBoYW5kbGVkIGluZGl2aWR1YWxseSBieSB0aGUgY2FsbGluZyBjb2RlLlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2FwaXMvZGVzaWduL2Vycm9ycy5cbiAgICAgICAgICAgICAgY2FzZSBELkFCT1JURUQ6XG4gICAgICBjYXNlIEQuT1VUX09GX1JBTkdFOlxuICAgICAgY2FzZSBELlVOSU1QTEVNRU5URUQ6XG4gICAgICBjYXNlIEQuREFUQV9MT1NTOlxuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxufVxuXG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBhbiBlcnJvciBjb2RlIHJlcHJlc2VudHMgYSBwZXJtYW5lbnQgZXJyb3Igd2hlbiByZWNlaXZlZFxuICogaW4gcmVzcG9uc2UgdG8gYSB3cml0ZSBvcGVyYXRpb24uXG4gKlxuICogV3JpdGUgb3BlcmF0aW9ucyBtdXN0IGJlIGhhbmRsZWQgc3BlY2lhbGx5IGJlY2F1c2UgYXMgb2YgYi8xMTk0Mzc3NjQsIEFCT1JURURcbiAqIGVycm9ycyBvbiB0aGUgd3JpdGUgc3RyZWFtIHNob3VsZCBiZSByZXRyaWVkIHRvbyAoZXZlbiB0aG91Z2ggQUJPUlRFRCBlcnJvcnNcbiAqIGFyZSBub3QgZ2VuZXJhbGx5IHJldHJ5YWJsZSkuXG4gKlxuICogTm90ZSB0aGF0IGR1cmluZyB0aGUgaW5pdGlhbCBoYW5kc2hha2Ugb24gdGhlIHdyaXRlIHN0cmVhbSBhbiBBQk9SVEVEIGVycm9yXG4gKiBzaWduYWxzIHRoYXQgd2Ugc2hvdWxkIGRpc2NhcmQgb3VyIHN0cmVhbSB0b2tlbiAoaS5lLiBpdCBpcyBwZXJtYW5lbnQpLiBUaGlzXG4gKiBtZWFucyBhIGhhbmRzaGFrZSBlcnJvciBzaG91bGQgYmUgY2xhc3NpZmllZCB3aXRoIGlzUGVybWFuZW50RXJyb3IsIGFib3ZlLlxuICovXG4vKipcbiAqIE1hcHMgYW4gZXJyb3IgQ29kZSBmcm9tIEdSUEMgc3RhdHVzIGNvZGUgbnVtYmVyLCBsaWtlIDAsIDEsIG9yIDE0LiBUaGVzZVxuICogYXJlIG5vdCB0aGUgc2FtZSBhcyBIVFRQIHN0YXR1cyBjb2Rlcy5cbiAqXG4gKiBAcmV0dXJucyBUaGUgQ29kZSBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiBHUlBDIHN0YXR1cyBjb2RlLiBGYWlscyBpZiB0aGVyZVxuICogICAgIGlzIG5vIG1hdGNoLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbWFwQ29kZUZyb21ScGNDb2RlKGUpIHtcbiAgICBpZiAodm9pZCAwID09PSBlKSBcbiAgICAvLyBUaGlzIHNob3VsZG4ndCBub3JtYWxseSBoYXBwZW4sIGJ1dCBpbiBjZXJ0YWluIGVycm9yIGNhc2VzIChsaWtlIHRyeWluZ1xuICAgIC8vIHRvIHNlbmQgaW52YWxpZCBwcm90byBtZXNzYWdlcykgd2UgbWF5IGdldCBhbiBlcnJvciB3aXRoIG5vIEdSUEMgY29kZS5cbiAgICByZXR1cm4gX19QUklWQVRFX2xvZ0Vycm9yKFwiR1JQQyBlcnJvciBoYXMgbm8gLmNvZGVcIiksIEQuVU5LTk9XTjtcbiAgICBzd2l0Y2ggKGUpIHtcbiAgICAgIGNhc2UgbGUuT0s6XG4gICAgICAgIHJldHVybiBELk9LO1xuXG4gICAgICBjYXNlIGxlLkNBTkNFTExFRDpcbiAgICAgICAgcmV0dXJuIEQuQ0FOQ0VMTEVEO1xuXG4gICAgICBjYXNlIGxlLlVOS05PV046XG4gICAgICAgIHJldHVybiBELlVOS05PV047XG5cbiAgICAgIGNhc2UgbGUuREVBRExJTkVfRVhDRUVERUQ6XG4gICAgICAgIHJldHVybiBELkRFQURMSU5FX0VYQ0VFREVEO1xuXG4gICAgICBjYXNlIGxlLlJFU09VUkNFX0VYSEFVU1RFRDpcbiAgICAgICAgcmV0dXJuIEQuUkVTT1VSQ0VfRVhIQVVTVEVEO1xuXG4gICAgICBjYXNlIGxlLklOVEVSTkFMOlxuICAgICAgICByZXR1cm4gRC5JTlRFUk5BTDtcblxuICAgICAgY2FzZSBsZS5VTkFWQUlMQUJMRTpcbiAgICAgICAgcmV0dXJuIEQuVU5BVkFJTEFCTEU7XG5cbiAgICAgIGNhc2UgbGUuVU5BVVRIRU5USUNBVEVEOlxuICAgICAgICByZXR1cm4gRC5VTkFVVEhFTlRJQ0FURUQ7XG5cbiAgICAgIGNhc2UgbGUuSU5WQUxJRF9BUkdVTUVOVDpcbiAgICAgICAgcmV0dXJuIEQuSU5WQUxJRF9BUkdVTUVOVDtcblxuICAgICAgY2FzZSBsZS5OT1RfRk9VTkQ6XG4gICAgICAgIHJldHVybiBELk5PVF9GT1VORDtcblxuICAgICAgY2FzZSBsZS5BTFJFQURZX0VYSVNUUzpcbiAgICAgICAgcmV0dXJuIEQuQUxSRUFEWV9FWElTVFM7XG5cbiAgICAgIGNhc2UgbGUuUEVSTUlTU0lPTl9ERU5JRUQ6XG4gICAgICAgIHJldHVybiBELlBFUk1JU1NJT05fREVOSUVEO1xuXG4gICAgICBjYXNlIGxlLkZBSUxFRF9QUkVDT05ESVRJT046XG4gICAgICAgIHJldHVybiBELkZBSUxFRF9QUkVDT05ESVRJT047XG5cbiAgICAgIGNhc2UgbGUuQUJPUlRFRDpcbiAgICAgICAgcmV0dXJuIEQuQUJPUlRFRDtcblxuICAgICAgY2FzZSBsZS5PVVRfT0ZfUkFOR0U6XG4gICAgICAgIHJldHVybiBELk9VVF9PRl9SQU5HRTtcblxuICAgICAgY2FzZSBsZS5VTklNUExFTUVOVEVEOlxuICAgICAgICByZXR1cm4gRC5VTklNUExFTUVOVEVEO1xuXG4gICAgICBjYXNlIGxlLkRBVEFfTE9TUzpcbiAgICAgICAgcmV0dXJuIEQuREFUQV9MT1NTO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhbiBIVFRQIHJlc3BvbnNlJ3MgZXJyb3Igc3RhdHVzIHRvIHRoZSBlcXVpdmFsZW50IGVycm9yIGNvZGUuXG4gKlxuICogQHBhcmFtIHN0YXR1cyAtIEFuIEhUVFAgZXJyb3IgcmVzcG9uc2Ugc3RhdHVzIChcIkZBSUxFRF9QUkVDT05ESVRJT05cIixcbiAqIFwiVU5LTk9XTlwiLCBldGMuKVxuICogQHJldHVybnMgVGhlIGVxdWl2YWxlbnQgQ29kZS4gTm9uLW1hdGNoaW5nIHJlc3BvbnNlcyBhcmUgbWFwcGVkIHRvXG4gKiAgICAgQ29kZS5VTktOT1dOLlxuICovIChoZSA9IGxlIHx8IChsZSA9IHt9KSlbaGUuT0sgPSAwXSA9IFwiT0tcIiwgaGVbaGUuQ0FOQ0VMTEVEID0gMV0gPSBcIkNBTkNFTExFRFwiLCBcbmhlW2hlLlVOS05PV04gPSAyXSA9IFwiVU5LTk9XTlwiLCBoZVtoZS5JTlZBTElEX0FSR1VNRU5UID0gM10gPSBcIklOVkFMSURfQVJHVU1FTlRcIiwgXG5oZVtoZS5ERUFETElORV9FWENFRURFRCA9IDRdID0gXCJERUFETElORV9FWENFRURFRFwiLCBoZVtoZS5OT1RfRk9VTkQgPSA1XSA9IFwiTk9UX0ZPVU5EXCIsIFxuaGVbaGUuQUxSRUFEWV9FWElTVFMgPSA2XSA9IFwiQUxSRUFEWV9FWElTVFNcIiwgaGVbaGUuUEVSTUlTU0lPTl9ERU5JRUQgPSA3XSA9IFwiUEVSTUlTU0lPTl9ERU5JRURcIiwgXG5oZVtoZS5VTkFVVEhFTlRJQ0FURUQgPSAxNl0gPSBcIlVOQVVUSEVOVElDQVRFRFwiLCBoZVtoZS5SRVNPVVJDRV9FWEhBVVNURUQgPSA4XSA9IFwiUkVTT1VSQ0VfRVhIQVVTVEVEXCIsIFxuaGVbaGUuRkFJTEVEX1BSRUNPTkRJVElPTiA9IDldID0gXCJGQUlMRURfUFJFQ09ORElUSU9OXCIsIGhlW2hlLkFCT1JURUQgPSAxMF0gPSBcIkFCT1JURURcIiwgXG5oZVtoZS5PVVRfT0ZfUkFOR0UgPSAxMV0gPSBcIk9VVF9PRl9SQU5HRVwiLCBoZVtoZS5VTklNUExFTUVOVEVEID0gMTJdID0gXCJVTklNUExFTUVOVEVEXCIsIFxuaGVbaGUuSU5URVJOQUwgPSAxM10gPSBcIklOVEVSTkFMXCIsIGhlW2hlLlVOQVZBSUxBQkxFID0gMTRdID0gXCJVTkFWQUlMQUJMRVwiLCBoZVtoZS5EQVRBX0xPU1MgPSAxNV0gPSBcIkRBVEFfTE9TU1wiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgZ2xvYmFsLCBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgVGVzdGluZ0hvb2tzU3BpLlxuICpcbiAqIFRoaXMgdmFyaWFibGUgd2lsbCBiZSBgbnVsbGAgaW4gYWxsIGNhc2VzIF9leGNlcHRfIHdoZW4gcnVubmluZyBmcm9tXG4gKiBpbnRlZ3JhdGlvbiB0ZXN0cyB0aGF0IGhhdmUgcmVnaXN0ZXJlZCBjYWxsYmFja3MgdG8gYmUgbm90aWZpZWQgb2YgZXZlbnRzXG4gKiB0aGF0IGhhcHBlbiBkdXJpbmcgdGhlIHRlc3QgZXhlY3V0aW9uLlxuICovXG5sZXQgUGUgPSBudWxsO1xuXG4vKipcbiAqIFNldHMgdGhlIHZhbHVlIG9mIHRoZSBgdGVzdGluZ0hvb2tzU3BpYCBvYmplY3QuXG4gKiBAcGFyYW0gaW5zdGFuY2UgdGhlIGluc3RhbmNlIHRvIHNldC5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW5zdGFuY2Ugb2YgdGhlIFBsYXRmb3JtJ3MgJ1RleHRFbmNvZGVyJyBpbXBsZW1lbnRhdGlvbi5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX25ld1RleHRFbmNvZGVyKCkge1xuICAgIHJldHVybiBuZXcgVGV4dEVuY29kZXI7XG59XG5cbi8qKlxuICogQW4gaW5zdGFuY2Ugb2YgdGhlIFBsYXRmb3JtJ3MgJ1RleHREZWNvZGVyJyBpbXBsZW1lbnRhdGlvbi5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IEllID0gbmV3IEludGVnZXIoWyA0Mjk0OTY3Mjk1LCA0Mjk0OTY3Mjk1IF0sIDApO1xuXG4vLyBIYXNoIGEgc3RyaW5nIHVzaW5nIG1kNSBoYXNoaW5nIGFsZ29yaXRobS5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRNZDVIYXNoVmFsdWUoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbmV3VGV4dEVuY29kZXIoKS5lbmNvZGUoZSksIG4gPSBuZXcgTWQ1O1xuICAgIHJldHVybiBuLnVwZGF0ZSh0KSwgbmV3IFVpbnQ4QXJyYXkobi5kaWdlc3QoKSk7XG59XG5cbi8vIEludGVycHJldCB0aGUgMTYgYnl0ZXMgYXJyYXkgYXMgdHdvIDY0LWJpdCB1bnNpZ25lZCBpbnRlZ2VycywgZW5jb2RlZCB1c2luZ1xuLy8gMuKAmXMgY29tcGxlbWVudCB1c2luZyBsaXR0bGUgZW5kaWFuLlxuZnVuY3Rpb24gX19QUklWQVRFX2dldDY0Qml0VWludHMoZSkge1xuICAgIGNvbnN0IHQgPSBuZXcgRGF0YVZpZXcoZS5idWZmZXIpLCBuID0gdC5nZXRVaW50MzIoMCwgLyogbGl0dGxlRW5kaWFuPSAqLyAhMCksIHIgPSB0LmdldFVpbnQzMig0LCAvKiBsaXR0bGVFbmRpYW49ICovICEwKSwgaSA9IHQuZ2V0VWludDMyKDgsIC8qIGxpdHRsZUVuZGlhbj0gKi8gITApLCBzID0gdC5nZXRVaW50MzIoMTIsIC8qIGxpdHRsZUVuZGlhbj0gKi8gITApO1xuICAgIHJldHVybiBbIG5ldyBJbnRlZ2VyKFsgbiwgciBdLCAwKSwgbmV3IEludGVnZXIoWyBpLCBzIF0sIDApIF07XG59XG5cbmNsYXNzIEJsb29tRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIGlmICh0aGlzLmJpdG1hcCA9IGUsIHRoaXMucGFkZGluZyA9IHQsIHRoaXMuaGFzaENvdW50ID0gbiwgdCA8IDAgfHwgdCA+PSA4KSB0aHJvdyBuZXcgX19QUklWQVRFX0Jsb29tRmlsdGVyRXJyb3IoYEludmFsaWQgcGFkZGluZzogJHt0fWApO1xuICAgICAgICBpZiAobiA8IDApIHRocm93IG5ldyBfX1BSSVZBVEVfQmxvb21GaWx0ZXJFcnJvcihgSW52YWxpZCBoYXNoIGNvdW50OiAke259YCk7XG4gICAgICAgIGlmIChlLmxlbmd0aCA+IDAgJiYgMCA9PT0gdGhpcy5oYXNoQ291bnQpIFxuICAgICAgICAvLyBPbmx5IGVtcHR5IGJsb29tIGZpbHRlciBjYW4gaGF2ZSAwIGhhc2ggY291bnQuXG4gICAgICAgIHRocm93IG5ldyBfX1BSSVZBVEVfQmxvb21GaWx0ZXJFcnJvcihgSW52YWxpZCBoYXNoIGNvdW50OiAke259YCk7XG4gICAgICAgIGlmICgwID09PSBlLmxlbmd0aCAmJiAwICE9PSB0KSBcbiAgICAgICAgLy8gRW1wdHkgYmxvb20gZmlsdGVyIHNob3VsZCBoYXZlIDAgcGFkZGluZy5cbiAgICAgICAgdGhyb3cgbmV3IF9fUFJJVkFURV9CbG9vbUZpbHRlckVycm9yKGBJbnZhbGlkIHBhZGRpbmcgd2hlbiBiaXRtYXAgbGVuZ3RoIGlzIDA6ICR7dH1gKTtcbiAgICAgICAgdGhpcy5JZSA9IDggKiBlLmxlbmd0aCAtIHQsIFxuICAgICAgICAvLyBTZXQgdGhlIGJpdCBjb3VudCBpbiBJbnRlZ2VyIHRvIGF2b2lkIHJlcGV0aXRpb24gaW4gbWlnaHRDb250YWluKCkuXG4gICAgICAgIHRoaXMuVGUgPSBJbnRlZ2VyLmZyb21OdW1iZXIodGhpcy5JZSk7XG4gICAgfVxuICAgIC8vIENhbGN1bGF0ZSB0aGUgaXRoIGhhc2ggdmFsdWUgYmFzZWQgb24gdGhlIGhhc2hlZCA2NGJpdCBpbnRlZ2VycyxcbiAgICAvLyBhbmQgY2FsY3VsYXRlIGl0cyBjb3JyZXNwb25kaW5nIGJpdCBpbmRleCBpbiB0aGUgYml0bWFwIHRvIGJlIGNoZWNrZWQuXG4gICAgRWUoZSwgdCwgbikge1xuICAgICAgICAvLyBDYWxjdWxhdGUgaGFzaGVkIHZhbHVlIGgoaSkgPSBoMSArIChpICogaDIpLlxuICAgICAgICBsZXQgciA9IGUuYWRkKHQubXVsdGlwbHkoSW50ZWdlci5mcm9tTnVtYmVyKG4pKSk7XG4gICAgICAgIC8vIFdyYXAgaWYgaGFzaCB2YWx1ZSBvdmVyZmxvdyA2NGJpdC5cbiAgICAgICAgICAgICAgICByZXR1cm4gMSA9PT0gci5jb21wYXJlKEllKSAmJiAociA9IG5ldyBJbnRlZ2VyKFsgci5nZXRCaXRzKDApLCByLmdldEJpdHMoMSkgXSwgMCkpLCBcbiAgICAgICAgci5tb2R1bG8odGhpcy5UZSkudG9OdW1iZXIoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJuIHdoZXRoZXIgdGhlIGJpdCBvbiB0aGUgZ2l2ZW4gaW5kZXggaW4gdGhlIGJpdG1hcCBpcyBzZXQgdG8gMS5cbiAgICBkZShlKSB7XG4gICAgICAgIHJldHVybiAwICE9ICh0aGlzLmJpdG1hcFtNYXRoLmZsb29yKGUgLyA4KV0gJiAxIDw8IGUgJSA4KTtcbiAgICB9XG4gICAgbWlnaHRDb250YWluKGUpIHtcbiAgICAgICAgLy8gRW1wdHkgYml0bWFwIHNob3VsZCBhbHdheXMgcmV0dXJuIGZhbHNlIG9uIG1lbWJlcnNoaXAgY2hlY2suXG4gICAgICAgIGlmICgwID09PSB0aGlzLkllKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0TWQ1SGFzaFZhbHVlKGUpLCBbbiwgcl0gPSBfX1BSSVZBVEVfZ2V0NjRCaXRVaW50cyh0KTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLmhhc2hDb3VudDsgZSsrKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5FZShuLCByLCBlKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5kZSh0KSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgLyoqIENyZWF0ZSBibG9vbSBmaWx0ZXIgZm9yIHRlc3RpbmcgcHVycG9zZXMgb25seS4gKi8gICAgc3RhdGljIGNyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBlICUgOCA9PSAwID8gMCA6IDggLSBlICUgOCwgaSA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChlIC8gOCkpLCBzID0gbmV3IEJsb29tRmlsdGVyKGksIHIsIHQpO1xuICAgICAgICByZXR1cm4gbi5mb3JFYWNoKChlID0+IHMuaW5zZXJ0KGUpKSksIHM7XG4gICAgfVxuICAgIGluc2VydChlKSB7XG4gICAgICAgIGlmICgwID09PSB0aGlzLkllKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0TWQ1SGFzaFZhbHVlKGUpLCBbbiwgcl0gPSBfX1BSSVZBVEVfZ2V0NjRCaXRVaW50cyh0KTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLmhhc2hDb3VudDsgZSsrKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5FZShuLCByLCBlKTtcbiAgICAgICAgICAgIHRoaXMuQWUodCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgQWUoZSkge1xuICAgICAgICBjb25zdCB0ID0gTWF0aC5mbG9vcihlIC8gOCksIG4gPSBlICUgODtcbiAgICAgICAgdGhpcy5iaXRtYXBbdF0gfD0gMSA8PCBuO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0Jsb29tRmlsdGVyRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyksIHRoaXMubmFtZSA9IFwiQmxvb21GaWx0ZXJFcnJvclwiO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gZXZlbnQgZnJvbSB0aGUgUmVtb3RlU3RvcmUuIEl0IGlzIHNwbGl0IGludG8gdGFyZ2V0Q2hhbmdlcyAoY2hhbmdlcyB0byB0aGVcbiAqIHN0YXRlIG9yIHRoZSBzZXQgb2YgZG9jdW1lbnRzIGluIG91ciB3YXRjaGVkIHRhcmdldHMpIGFuZCBkb2N1bWVudFVwZGF0ZXNcbiAqIChjaGFuZ2VzIHRvIHRoZSBhY3R1YWwgZG9jdW1lbnRzKS5cbiAqLyBjbGFzcyBSZW1vdGVFdmVudCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIHNuYXBzaG90IHZlcnNpb24gdGhpcyBldmVudCBicmluZ3MgdXMgdXAgdG8sIG9yIE1JTiBpZiBub3Qgc2V0LlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIEEgbWFwIGZyb20gdGFyZ2V0IHRvIGNoYW5nZXMgdG8gdGhlIHRhcmdldC4gU2VlIFRhcmdldENoYW5nZS5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBBIG1hcCBvZiB0YXJnZXRzIHRoYXQgaXMga25vd24gdG8gYmUgaW5jb25zaXN0ZW50LCBhbmQgdGhlIHB1cnBvc2UgZm9yXG4gICAgICogcmUtbGlzdGVuaW5nLiBMaXN0ZW5zIGZvciB0aGVzZSB0YXJnZXRzIHNob3VsZCBiZSByZS1lc3RhYmxpc2hlZCB3aXRob3V0XG4gICAgICogcmVzdW1lIHRva2Vucy5cbiAgICAgKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBBIHNldCBvZiB3aGljaCBkb2N1bWVudHMgaGF2ZSBjaGFuZ2VkIG9yIGJlZW4gZGVsZXRlZCwgYWxvbmcgd2l0aCB0aGVcbiAgICAgKiBkb2MncyBuZXcgdmFsdWVzIChpZiBub3QgZGVsZXRlZCkuXG4gICAgICovXG4gICAgciwgXG4gICAgLyoqXG4gICAgICogQSBzZXQgb2Ygd2hpY2ggZG9jdW1lbnQgdXBkYXRlcyBhcmUgZHVlIG9ubHkgdG8gbGltYm8gcmVzb2x1dGlvbiB0YXJnZXRzLlxuICAgICAqL1xuICAgIGkpIHtcbiAgICAgICAgdGhpcy5zbmFwc2hvdFZlcnNpb24gPSBlLCB0aGlzLnRhcmdldENoYW5nZXMgPSB0LCB0aGlzLnRhcmdldE1pc21hdGNoZXMgPSBuLCB0aGlzLmRvY3VtZW50VXBkYXRlcyA9IHIsIFxuICAgICAgICB0aGlzLnJlc29sdmVkTGltYm9Eb2N1bWVudHMgPSBpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIQUNLOiBWaWV3cyByZXF1aXJlIFJlbW90ZUV2ZW50cyBpbiBvcmRlciB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgdmlldyBpc1xuICAgICAqIENVUlJFTlQsIGJ1dCBzZWNvbmRhcnkgdGFicyBkb24ndCByZWNlaXZlIHJlbW90ZSBldmVudHMuIFNvIHRoaXMgbWV0aG9kIGlzXG4gICAgICogdXNlZCB0byBjcmVhdGUgYSBzeW50aGVzaXplZCBSZW1vdGVFdmVudCB0aGF0IGNhbiBiZSB1c2VkIHRvIGFwcGx5IGFcbiAgICAgKiBDVVJSRU5UIHN0YXR1cyBjaGFuZ2UgdG8gYSBWaWV3LCBmb3IgcXVlcmllcyBleGVjdXRlZCBpbiBhIGRpZmZlcmVudCB0YWIuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seVxuICAgIHN0YXRpYyBjcmVhdGVTeW50aGVzaXplZFJlbW90ZUV2ZW50Rm9yQ3VycmVudENoYW5nZShlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgTWFwO1xuICAgICAgICByZXR1cm4gci5zZXQoZSwgVGFyZ2V0Q2hhbmdlLmNyZWF0ZVN5bnRoZXNpemVkVGFyZ2V0Q2hhbmdlRm9yQ3VycmVudENoYW5nZShlLCB0LCBuKSksIFxuICAgICAgICBuZXcgUmVtb3RlRXZlbnQoU25hcHNob3RWZXJzaW9uLm1pbigpLCByLCBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKSwgX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgVGFyZ2V0Q2hhbmdlIHNwZWNpZmllcyB0aGUgc2V0IG9mIGNoYW5nZXMgZm9yIGEgc3BlY2lmaWMgdGFyZ2V0IGFzIHBhcnQgb2ZcbiAqIGEgUmVtb3RlRXZlbnQuIFRoZXNlIGNoYW5nZXMgdHJhY2sgd2hpY2ggZG9jdW1lbnRzIGFyZSBhZGRlZCwgbW9kaWZpZWQgb3JcbiAqIHJlbW92ZWQsIGFzIHdlbGwgYXMgdGhlIHRhcmdldCdzIHJlc3VtZSB0b2tlbiBhbmQgd2hldGhlciB0aGUgdGFyZ2V0IGlzXG4gKiBtYXJrZWQgQ1VSUkVOVC5cbiAqIFRoZSBhY3R1YWwgY2hhbmdlcyAqdG8qIGRvY3VtZW50cyBhcmUgbm90IHBhcnQgb2YgdGhlIFRhcmdldENoYW5nZSBzaW5jZVxuICogZG9jdW1lbnRzIG1heSBiZSBwYXJ0IG9mIG11bHRpcGxlIHRhcmdldHMuXG4gKi8gY2xhc3MgVGFyZ2V0Q2hhbmdlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHF1ZXJ5IHRvIGJlIHJlc3VtZWRcbiAgICAgKiBhZnRlciBkaXNjb25uZWN0aW5nIHdpdGhvdXQgcmV0cmFuc21pdHRpbmcgYWxsIHRoZSBkYXRhIHRoYXQgbWF0Y2hlcyB0aGVcbiAgICAgKiBxdWVyeS4gVGhlIHJlc3VtZSB0b2tlbiBlc3NlbnRpYWxseSBpZGVudGlmaWVzIGEgcG9pbnQgaW4gdGltZSBmcm9tIHdoaWNoXG4gICAgICogdGhlIHNlcnZlciBzaG91bGQgcmVzdW1lIHNlbmRpbmcgcmVzdWx0cy5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgXCJjdXJyZW50XCIgKHN5bmNlZCkgc3RhdHVzIG9mIHRoaXMgdGFyZ2V0LiBOb3RlIHRoYXQgXCJjdXJyZW50XCJcbiAgICAgKiBoYXMgc3BlY2lhbCBtZWFuaW5nIGluIHRoZSBSUEMgcHJvdG9jb2wgdGhhdCBpbXBsaWVzIHRoYXQgYSB0YXJnZXQgaXNcbiAgICAgKiBib3RoIHVwLXRvLWRhdGUgYW5kIGNvbnNpc3RlbnQgd2l0aCB0aGUgcmVzdCBvZiB0aGUgd2F0Y2ggc3RyZWFtLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgd2VyZSBuZXdseSBhc3NpZ25lZCB0byB0aGlzIHRhcmdldCBhcyBwYXJ0IG9mXG4gICAgICogdGhpcyByZW1vdGUgZXZlbnQuXG4gICAgICovXG4gICAgbiwgXG4gICAgLyoqXG4gICAgICogVGhlIHNldCBvZiBkb2N1bWVudHMgdGhhdCB3ZXJlIGFscmVhZHkgYXNzaWduZWQgdG8gdGhpcyB0YXJnZXQgYnV0IHJlY2VpdmVkXG4gICAgICogYW4gdXBkYXRlIGR1cmluZyB0aGlzIHJlbW90ZSBldmVudC5cbiAgICAgKi9cbiAgICByLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2V0IG9mIGRvY3VtZW50cyB0aGF0IHdlcmUgcmVtb3ZlZCBmcm9tIHRoaXMgdGFyZ2V0IGFzIHBhcnQgb2YgdGhpc1xuICAgICAqIHJlbW90ZSBldmVudC5cbiAgICAgKi9cbiAgICBpKSB7XG4gICAgICAgIHRoaXMucmVzdW1lVG9rZW4gPSBlLCB0aGlzLmN1cnJlbnQgPSB0LCB0aGlzLmFkZGVkRG9jdW1lbnRzID0gbiwgdGhpcy5tb2RpZmllZERvY3VtZW50cyA9IHIsIFxuICAgICAgICB0aGlzLnJlbW92ZWREb2N1bWVudHMgPSBpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGNyZWF0ZSBhIHN5bnRoZXNpemVkIFRhcmdldENoYW5nZXMgdGhhdCBjYW4gYmUgdXNlZCB0b1xuICAgICAqIGFwcGx5IGEgQ1VSUkVOVCBzdGF0dXMgY2hhbmdlIHRvIGEgVmlldyAoZm9yIHF1ZXJpZXMgZXhlY3V0ZWQgaW4gYSBkaWZmZXJlbnRcbiAgICAgKiB0YWIpIG9yIGZvciBuZXcgcXVlcmllcyAodG8gcmFpc2Ugc25hcHNob3RzIHdpdGggY29ycmVjdCBDVVJSRU5UIHN0YXR1cykuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGVTeW50aGVzaXplZFRhcmdldENoYW5nZUZvckN1cnJlbnRDaGFuZ2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFRhcmdldENoYW5nZShuLCB0LCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBjaGFuZ2VkIGRvY3VtZW50IGFuZCBhIGxpc3Qgb2YgdGFyZ2V0IGlkcyB0byB3aGljaCB0aGlzIGNoYW5nZVxuICogYXBwbGllcy5cbiAqXG4gKiBJZiBkb2N1bWVudCBoYXMgYmVlbiBkZWxldGVkIE5vRG9jdW1lbnQgd2lsbCBiZSBwcm92aWRlZC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfRG9jdW1lbnRXYXRjaENoYW5nZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSBuZXcgZG9jdW1lbnQgYXBwbGllcyB0byBhbGwgb2YgdGhlc2UgdGFyZ2V0cy4gKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIG5ldyBkb2N1bWVudCBpcyByZW1vdmVkIGZyb20gYWxsIG9mIHRoZXNlIHRhcmdldHMuICovXG4gICAgdCwgXG4gICAgLyoqIFRoZSBrZXkgb2YgdGhlIGRvY3VtZW50IGZvciB0aGlzIGNoYW5nZS4gKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBUaGUgbmV3IGRvY3VtZW50IG9yIE5vRG9jdW1lbnQgaWYgaXQgd2FzIGRlbGV0ZWQuIElzIG51bGwgaWYgdGhlXG4gICAgICogZG9jdW1lbnQgd2VudCBvdXQgb2YgdmlldyB3aXRob3V0IHRoZSBzZXJ2ZXIgc2VuZGluZyBhIG5ldyBkb2N1bWVudC5cbiAgICAgKi9cbiAgICByKSB7XG4gICAgICAgIHRoaXMuUmUgPSBlLCB0aGlzLnJlbW92ZWRUYXJnZXRJZHMgPSB0LCB0aGlzLmtleSA9IG4sIHRoaXMuVmUgPSByO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0V4aXN0ZW5jZUZpbHRlckNoYW5nZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnRhcmdldElkID0gZSwgdGhpcy5tZSA9IHQ7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfV2F0Y2hUYXJnZXRDaGFuZ2Uge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBXaGF0IGtpbmQgb2YgY2hhbmdlIG9jY3VycmVkIHRvIHRoZSB3YXRjaCB0YXJnZXQuICovXG4gICAgZSwgXG4gICAgLyoqIFRoZSB0YXJnZXQgSURzIHRoYXQgd2VyZSBhZGRlZC9yZW1vdmVkL3NldC4gKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHRhcmdldCB0byBiZVxuICAgICAqIHJlc3VtZWQgYWZ0ZXIgZGlzY29ubmVjdGluZyB3aXRob3V0IHJldHJhbnNtaXR0aW5nIGFsbCB0aGUgZGF0YSB0aGF0XG4gICAgICogbWF0Y2hlcyB0aGUgdGFyZ2V0LiBUaGUgcmVzdW1lIHRva2VuIGVzc2VudGlhbGx5IGlkZW50aWZpZXMgYSBwb2ludCBpblxuICAgICAqIHRpbWUgZnJvbSB3aGljaCB0aGUgc2VydmVyIHNob3VsZCByZXN1bWUgc2VuZGluZyByZXN1bHRzLlxuICAgICAqL1xuICAgIG4gPSBCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HXG4gICAgLyoqIEFuIFJQQyBlcnJvciBpbmRpY2F0aW5nIHdoeSB0aGUgd2F0Y2ggZmFpbGVkLiAqLyAsIHIgPSBudWxsKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBlLCB0aGlzLnRhcmdldElkcyA9IHQsIHRoaXMucmVzdW1lVG9rZW4gPSBuLCB0aGlzLmNhdXNlID0gcjtcbiAgICB9XG59XG5cbi8qKiBUcmFja3MgdGhlIGludGVybmFsIHN0YXRlIG9mIGEgV2F0Y2ggdGFyZ2V0LiAqLyBjbGFzcyBfX1BSSVZBVEVfVGFyZ2V0U3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG51bWJlciBvZiBwZW5kaW5nIHJlc3BvbnNlcyAoYWRkcyBvciByZW1vdmVzKSB0aGF0IHdlIGFyZSB3YWl0aW5nIG9uLlxuICAgICAgICAgKiBXZSBvbmx5IGNvbnNpZGVyIHRhcmdldHMgYWN0aXZlIHRoYXQgaGF2ZSBubyBwZW5kaW5nIHJlc3BvbnNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZmUgPSAwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXBzIHRyYWNrIG9mIHRoZSBkb2N1bWVudCBjaGFuZ2VzIHNpbmNlIHRoZSBsYXN0IHJhaXNlZCBzbmFwc2hvdC5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhlc2UgY2hhbmdlcyBhcmUgY29udGludW91c2x5IHVwZGF0ZWQgYXMgd2UgcmVjZWl2ZSBkb2N1bWVudCB1cGRhdGVzIGFuZFxuICAgICAgICAgKiBhbHdheXMgcmVmbGVjdCB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcyBhZ2FpbnN0IHRoZSBsYXN0IGlzc3VlZCBzbmFwc2hvdC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2UgPSBfX1BSSVZBVEVfc25hcHNob3RDaGFuZ2VzTWFwKCksIFxuICAgICAgICAvKiogU2VlIHB1YmxpYyBnZXR0ZXJzIGZvciBleHBsYW5hdGlvbnMgb2YgdGhlc2UgZmllbGRzLiAqL1xuICAgICAgICB0aGlzLnBlID0gQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklORywgdGhpcy55ZSA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhpcyB0YXJnZXQgc3RhdGUgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBuZXh0IHNuYXBzaG90LiBXZVxuICAgICAgICAgKiBpbml0aWFsaXplIHRvIHRydWUgc28gdGhhdCBuZXdseS1hZGRlZCB0YXJnZXRzIGFyZSBpbmNsdWRlZCBpbiB0aGUgbmV4dFxuICAgICAgICAgKiBSZW1vdGVFdmVudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2UgPSAhMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGlzIHRhcmdldCBoYXMgYmVlbiBtYXJrZWQgJ2N1cnJlbnQnLlxuICAgICAqXG4gICAgICogJ0N1cnJlbnQnIGhhcyBzcGVjaWFsIG1lYW5pbmcgaW4gdGhlIFJQQyBwcm90b2NvbDogSXQgaW1wbGllcyB0aGF0IHRoZVxuICAgICAqIFdhdGNoIGJhY2tlbmQgaGFzIHNlbnQgdXMgYWxsIGNoYW5nZXMgdXAgdG8gdGhlIHBvaW50IGF0IHdoaWNoIHRoZSB0YXJnZXRcbiAgICAgKiB3YXMgYWRkZWQgYW5kIHRoYXQgdGhlIHRhcmdldCBpcyBjb25zaXN0ZW50IHdpdGggdGhlIHJlc3Qgb2YgdGhlIHdhdGNoXG4gICAgICogc3RyZWFtLlxuICAgICAqLyAgICBnZXQgY3VycmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMueWU7XG4gICAgfVxuICAgIC8qKiBUaGUgbGFzdCByZXN1bWUgdG9rZW4gc2VudCB0byB1cyBmb3IgdGhpcyB0YXJnZXQuICovICAgIGdldCByZXN1bWVUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGU7XG4gICAgfVxuICAgIC8qKiBXaGV0aGVyIHRoaXMgdGFyZ2V0IGhhcyBwZW5kaW5nIHRhcmdldCBhZGRzIG9yIHRhcmdldCByZW1vdmVzLiAqLyAgICBnZXQgU2UoKSB7XG4gICAgICAgIHJldHVybiAwICE9PSB0aGlzLmZlO1xuICAgIH1cbiAgICAvKiogV2hldGhlciB3ZSBoYXZlIG1vZGlmaWVkIGFueSBzdGF0ZSB0aGF0IHNob3VsZCB0cmlnZ2VyIGEgc25hcHNob3QuICovICAgIGdldCBiZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgdGhlIHJlc3VtZSB0b2tlbiB0byB0aGUgVGFyZ2V0Q2hhbmdlLCBidXQgb25seSB3aGVuIGl0IGhhcyBhIG5ld1xuICAgICAqIHZhbHVlLiBFbXB0eSByZXN1bWVUb2tlbnMgYXJlIGRpc2NhcmRlZC5cbiAgICAgKi8gICAgRGUoZSkge1xuICAgICAgICBlLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDAgJiYgKHRoaXMud2UgPSAhMCwgdGhpcy5wZSA9IGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgdGFyZ2V0IGNoYW5nZSBmcm9tIHRoZSBjdXJyZW50IHNldCBvZiBjaGFuZ2VzLlxuICAgICAqXG4gICAgICogVG8gcmVzZXQgdGhlIGRvY3VtZW50IGNoYW5nZXMgYWZ0ZXIgcmFpc2luZyB0aGlzIHNuYXBzaG90LCBjYWxsXG4gICAgICogYGNsZWFyUGVuZGluZ0NoYW5nZXMoKWAuXG4gICAgICovICAgIHZlKCkge1xuICAgICAgICBsZXQgZSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCB0ID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2UuZm9yRWFjaCgoKHIsIGkpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoaSkge1xuICAgICAgICAgICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICAgICAgZSA9IGUuYWRkKHIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDpcbiAgICAgICAgICAgICAgICB0ID0gdC5hZGQocik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgICAgICAgICAgbiA9IG4uYWRkKHIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSksIG5ldyBUYXJnZXRDaGFuZ2UodGhpcy5wZSwgdGhpcy55ZSwgZSwgdCwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgZG9jdW1lbnQgY2hhbmdlcyBhbmQgc2V0cyBgaGFzUGVuZGluZ0NoYW5nZXNgIHRvIGZhbHNlLlxuICAgICAqLyAgICBDZSgpIHtcbiAgICAgICAgdGhpcy53ZSA9ICExLCB0aGlzLmdlID0gX19QUklWQVRFX3NuYXBzaG90Q2hhbmdlc01hcCgpO1xuICAgIH1cbiAgICBGZShlLCB0KSB7XG4gICAgICAgIHRoaXMud2UgPSAhMCwgdGhpcy5nZSA9IHRoaXMuZ2UuaW5zZXJ0KGUsIHQpO1xuICAgIH1cbiAgICBNZShlKSB7XG4gICAgICAgIHRoaXMud2UgPSAhMCwgdGhpcy5nZSA9IHRoaXMuZ2UucmVtb3ZlKGUpO1xuICAgIH1cbiAgICB4ZSgpIHtcbiAgICAgICAgdGhpcy5mZSArPSAxO1xuICAgIH1cbiAgICBPZSgpIHtcbiAgICAgICAgdGhpcy5mZSAtPSAxLCBfX1BSSVZBVEVfaGFyZEFzc2VydCh0aGlzLmZlID49IDApO1xuICAgIH1cbiAgICBOZSgpIHtcbiAgICAgICAgdGhpcy53ZSA9ICEwLCB0aGlzLnllID0gITA7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgaGVscGVyIGNsYXNzIHRvIGFjY3VtdWxhdGUgd2F0Y2ggY2hhbmdlcyBpbnRvIGEgUmVtb3RlRXZlbnQuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9XYXRjaENoYW5nZUFnZ3JlZ2F0b3Ige1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5MZSA9IGUsIFxuICAgICAgICAvKiogVGhlIGludGVybmFsIHN0YXRlIG9mIGFsbCB0cmFja2VkIHRhcmdldHMuICovXG4gICAgICAgIHRoaXMuQmUgPSBuZXcgTWFwLCBcbiAgICAgICAgLyoqIEtlZXBzIHRyYWNrIG9mIHRoZSBkb2N1bWVudHMgdG8gdXBkYXRlIHNpbmNlIHRoZSBsYXN0IHJhaXNlZCBzbmFwc2hvdC4gKi9cbiAgICAgICAgdGhpcy5rZSA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSwgXG4gICAgICAgIC8qKiBBIG1hcHBpbmcgb2YgZG9jdW1lbnQga2V5cyB0byB0aGVpciBzZXQgb2YgdGFyZ2V0IElEcy4gKi9cbiAgICAgICAgdGhpcy5xZSA9IF9fUFJJVkFURV9kb2N1bWVudFRhcmdldE1hcCgpLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgbWFwIG9mIHRhcmdldHMgd2l0aCBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuIFRoZXNlIHRhcmdldHMgYXJlXG4gICAgICAgICAqIGtub3duIHRvIGJlIGluY29uc2lzdGVudCBhbmQgdGhlaXIgbGlzdGVucyBuZWVkcyB0byBiZSByZS1lc3RhYmxpc2hlZCBieVxuICAgICAgICAgKiBSZW1vdGVTdG9yZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuUWUgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHJvY2Vzc2VzIGFuZCBhZGRzIHRoZSBEb2N1bWVudFdhdGNoQ2hhbmdlIHRvIHRoZSBjdXJyZW50IHNldCBvZiBjaGFuZ2VzLlxuICAgICAqLyAgICBLZShlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlLlJlKSBlLlZlICYmIGUuVmUuaXNGb3VuZERvY3VtZW50KCkgPyB0aGlzLiRlKHQsIGUuVmUpIDogdGhpcy5VZSh0LCBlLmtleSwgZS5WZSk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlLnJlbW92ZWRUYXJnZXRJZHMpIHRoaXMuVWUodCwgZS5rZXksIGUuVmUpO1xuICAgIH1cbiAgICAvKiogUHJvY2Vzc2VzIGFuZCBhZGRzIHRoZSBXYXRjaFRhcmdldENoYW5nZSB0byB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcy4gKi8gICAgV2UoZSkge1xuICAgICAgICB0aGlzLmZvckVhY2hUYXJnZXQoZSwgKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuR2UodCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGUuc3RhdGUpIHtcbiAgICAgICAgICAgICAgY2FzZSAwIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuTm9DaGFuZ2UgKi8gOlxuICAgICAgICAgICAgICAgIHRoaXMuemUodCkgJiYgbi5EZShlLnJlc3VtZVRva2VuKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDEgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwZW5kaW5nIGFja3MgbmVlZGVkIGZyb20gd2F0Y2hcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyB0YXJnZXRJZC5cbiAgICAgICAgICAgICAgICBuLk9lKCksIG4uU2UgfHwgXG4gICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIGZyZXNobHkgYWRkZWQgdGFyZ2V0LCBzbyB3ZSBuZWVkIHRvIHJlc2V0IGFueSBzdGF0ZVxuICAgICAgICAgICAgICAgIC8vIHRoYXQgd2UgaGFkIHByZXZpb3VzbHkuIFRoaXMgY2FuIGhhcHBlbiBlLmcuIHdoZW4gcmVtb3ZlIGFuZCBhZGRcbiAgICAgICAgICAgICAgICAvLyBiYWNrIGEgdGFyZ2V0IGZvciBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuXG4gICAgICAgICAgICAgICAgbi5DZSgpLCBuLkRlKGUucmVzdW1lVG9rZW4pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLlJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiByZW1vdmVkIHRhcmdldHMgdG8gd2UgY2FuIHBvc3QtZmlsdGVyIGFuZFxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBhbnkgdGFyZ2V0IGNoYW5nZXMuXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwZW5kaW5nIGFja3MgbmVlZGVkIGZyb20gd2F0Y2hcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyB0YXJnZXRJZC5cbiAgICAgICAgICAgICAgICBuLk9lKCksIG4uU2UgfHwgdGhpcy5yZW1vdmVUYXJnZXQodCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAzIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuQ3VycmVudCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy56ZSh0KSAmJiAobi5OZSgpLCBuLkRlKGUucmVzdW1lVG9rZW4pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDQgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZXNldCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy56ZSh0KSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIHRhcmdldCBhbmQgc3ludGhlc2l6ZXMgcmVtb3ZlcyBmb3IgYWxsIGV4aXN0aW5nXG4gICAgICAgICAgICAgICAgLy8gZG9jdW1lbnRzLiBUaGUgYmFja2VuZCB3aWxsIHJlLWFkZCBhbnkgZG9jdW1lbnRzIHRoYXQgc3RpbGxcbiAgICAgICAgICAgICAgICAvLyBtYXRjaCB0aGUgdGFyZ2V0IGJlZm9yZSBpdCBzZW5kcyB0aGUgbmV4dCBnbG9iYWwgc25hcHNob3QuXG4gICAgICAgICAgICAgICAgdGhpcy5qZSh0KSwgbi5EZShlLnJlc3VtZVRva2VuKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBmYWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBhbGwgdGFyZ2V0SWRzIHRoYXQgdGhlIHdhdGNoIGNoYW5nZSBhcHBsaWVzIHRvOiBlaXRoZXIgdGhlXG4gICAgICogdGFyZ2V0SWRzIGV4cGxpY2l0bHkgbGlzdGVkIGluIHRoZSBjaGFuZ2Ugb3IgdGhlIHRhcmdldElkcyBvZiBhbGwgY3VycmVudGx5XG4gICAgICogYWN0aXZlIHRhcmdldHMuXG4gICAgICovICAgIGZvckVhY2hUYXJnZXQoZSwgdCkge1xuICAgICAgICBlLnRhcmdldElkcy5sZW5ndGggPiAwID8gZS50YXJnZXRJZHMuZm9yRWFjaCh0KSA6IHRoaXMuQmUuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIHRoaXMuemUobikgJiYgdChuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIGV4aXN0ZW5jZSBmaWx0ZXJzIGFuZCBzeW50aGVzaXplcyBkZWxldGVzIGZvciBmaWx0ZXIgbWlzbWF0Y2hlcy5cbiAgICAgKiBUYXJnZXRzIHRoYXQgYXJlIGludmFsaWRhdGVkIGJ5IGZpbHRlciBtaXNtYXRjaGVzIGFyZSBhZGRlZCB0b1xuICAgICAqIGBwZW5kaW5nVGFyZ2V0UmVzZXRzYC5cbiAgICAgKi8gICAgSGUoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS50YXJnZXRJZCwgbiA9IGUubWUuY291bnQsIHIgPSB0aGlzLkplKHQpO1xuICAgICAgICBpZiAocikge1xuICAgICAgICAgICAgY29uc3QgaSA9IHIudGFyZ2V0O1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV90YXJnZXRJc0RvY3VtZW50VGFyZ2V0KGkpKSBpZiAoMCA9PT0gbikge1xuICAgICAgICAgICAgICAgIC8vIFRoZSBleGlzdGVuY2UgZmlsdGVyIHRvbGQgdXMgdGhlIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0LiBXZSBkZWR1Y2VcbiAgICAgICAgICAgICAgICAvLyB0aGF0IHRoaXMgZG9jdW1lbnQgZG9lcyBub3QgZXhpc3QgYW5kIGFwcGx5IGEgZGVsZXRlZCBkb2N1bWVudCB0b1xuICAgICAgICAgICAgICAgIC8vIG91ciB1cGRhdGVzLiBXaXRob3V0IGFwcGx5aW5nIHRoaXMgZGVsZXRlZCBkb2N1bWVudCB0aGVyZSBtaWdodCBiZVxuICAgICAgICAgICAgICAgIC8vIGFub3RoZXIgcXVlcnkgdGhhdCB3aWxsIHJhaXNlIHRoaXMgZG9jdW1lbnQgYXMgcGFydCBvZiBhIHNuYXBzaG90XG4gICAgICAgICAgICAgICAgLy8gdW50aWwgaXQgaXMgcmVzb2x2ZWQsIGVzc2VudGlhbGx5IGV4cG9zaW5nIGluY29uc2lzdGVuY3kgYmV0d2VlblxuICAgICAgICAgICAgICAgIC8vIHF1ZXJpZXMuXG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBEb2N1bWVudEtleShpLnBhdGgpO1xuICAgICAgICAgICAgICAgIHRoaXMuVWUodCwgZSwgTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQoZSwgU25hcHNob3RWZXJzaW9uLm1pbigpKSk7XG4gICAgICAgICAgICB9IGVsc2UgX19QUklWQVRFX2hhcmRBc3NlcnQoMSA9PT0gbik7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLlllKHQpO1xuICAgICAgICAgICAgICAgIC8vIEV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2guIE1hcmsgdGhlIGRvY3VtZW50cyBhcyBiZWluZyBpbiBsaW1ibywgYW5kXG4gICAgICAgICAgICAgICAgLy8gcmFpc2UgYSBzbmFwc2hvdCB3aXRoIGBpc0Zyb21DYWNoZTp0cnVlYC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIgIT09IG4pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgYmxvb20gZmlsdGVyIHRvIGlkZW50aWZ5IGFuZCBtYXJrIHJlbW92ZWQgZG9jdW1lbnRzLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gdGhpcy5aZShlKSwgaSA9IG4gPyB0aGlzLlhlKG4sIGUsIHIpIDogMSAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLlNraXBwZWQgKi87XG4gICAgICAgICAgICAgICAgICAgIGlmICgwIC8qIEJsb29tRmlsdGVyQXBwbGljYXRpb25TdGF0dXMuU3VjY2VzcyAqLyAhPT0gaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgYmxvb20gZmlsdGVyIGFwcGxpY2F0aW9uIGZhaWxzLCB3ZSByZXNldCB0aGUgbWFwcGluZyBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyaWdnZXIgcmUtcnVuIG9mIHRoZSBxdWVyeS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuamUodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gMiAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLkZhbHNlUG9zaXRpdmUgKi8gPT09IGkgPyBcIlRhcmdldFB1cnBvc2VFeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaEJsb29tXCIgLyogVGFyZ2V0UHVycG9zZS5FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaEJsb29tICovIDogXCJUYXJnZXRQdXJwb3NlRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2hcIiAvKiBUYXJnZXRQdXJwb3NlLkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoICovO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5RZSA9IHRoaXMuUWUuaW5zZXJ0KHQsIGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG51bGwgPT0gUGUgfHwgUGUuZXQoZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZUV4aXN0ZW5jZUZpbHRlck1pc21hdGNoSW5mb0ZvclRlc3RpbmdIb29rcyhlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcywgbywgXywgYSwgdSwgYztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGwgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxDYWNoZUNvdW50OiBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0ZW5jZUZpbHRlckNvdW50OiB0LmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlSWQ6IG4uZGF0YWJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBuLnByb2plY3RJZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgaCA9IHQudW5jaGFuZ2VkTmFtZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBoICYmIChsLmJsb29tRmlsdGVyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpZWQ6IDAgLyogQmxvb21GaWx0ZXJBcHBsaWNhdGlvblN0YXR1cy5TdWNjZXNzICovID09PSBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc2hDb3VudDogbnVsbCAhPT0gKHMgPSBudWxsID09IGggPyB2b2lkIDAgOiBoLmhhc2hDb3VudCkgJiYgdm9pZCAwICE9PSBzID8gcyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYml0bWFwTGVuZ3RoOiBudWxsICE9PSAoYSA9IG51bGwgPT09IChfID0gbnVsbCA9PT0gKG8gPSBudWxsID09IGggPyB2b2lkIDAgOiBoLmJpdHMpIHx8IHZvaWQgMCA9PT0gbyA/IHZvaWQgMCA6IG8uYml0bWFwKSB8fCB2b2lkIDAgPT09IF8gPyB2b2lkIDAgOiBfLmxlbmd0aCkgJiYgdm9pZCAwICE9PSBhID8gYSA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogbnVsbCAhPT0gKGMgPSBudWxsID09PSAodSA9IG51bGwgPT0gaCA/IHZvaWQgMCA6IGguYml0cykgfHwgdm9pZCAwID09PSB1ID8gdm9pZCAwIDogdS5wYWRkaW5nKSAmJiB2b2lkIDAgIT09IGMgPyBjIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWdodENvbnRhaW46IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09ICh0ID0gbnVsbCA9PSByID8gdm9pZCAwIDogci5taWdodENvbnRhaW4oZSkpICYmIHZvaWQgMCAhPT0gdCAmJiB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKHIsIGUubWUsIHRoaXMuTGUudHQoKSwgbiwgaSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZSB0aGUgYmxvb20gZmlsdGVyIGZyb20gdGhlIFwidW5jaGFuZ2VkX25hbWVzXCIgZmllbGQgb2YgYW4gZXhpc3RlbmNlXG4gICAgICogZmlsdGVyLlxuICAgICAqLyAgICBaZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLm1lLnVuY2hhbmdlZE5hbWVzO1xuICAgICAgICBpZiAoIXQgfHwgIXQuYml0cykgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IHtiaXRzOiB7Yml0bWFwOiBuID0gXCJcIiwgcGFkZGluZzogciA9IDB9LCBoYXNoQ291bnQ6IGkgPSAwfSA9IHQ7XG4gICAgICAgIGxldCBzLCBvO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcyA9IF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKG4pLnRvVWludDhBcnJheSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9CYXNlNjREZWNvZGVFcnJvcikgcmV0dXJuIF9fUFJJVkFURV9sb2dXYXJuKFwiRGVjb2RpbmcgdGhlIGJhc2U2NCBibG9vbSBmaWx0ZXIgaW4gZXhpc3RlbmNlIGZpbHRlciBmYWlsZWQgKFwiICsgZS5tZXNzYWdlICsgXCIpOyBpZ25vcmluZyB0aGUgYmxvb20gZmlsdGVyIGFuZCBmYWxsaW5nIGJhY2sgdG8gZnVsbCByZS1xdWVyeS5cIiksIFxuICAgICAgICAgICAgbnVsbDtcbiAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEJsb29tRmlsdGVyIHRocm93cyBlcnJvciBpZiB0aGUgaW5wdXRzIGFyZSBpbnZhbGlkLlxuICAgICAgICAgICAgbyA9IG5ldyBCbG9vbUZpbHRlcihzLCByLCBpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dXYXJuKGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQmxvb21GaWx0ZXJFcnJvciA/IFwiQmxvb21GaWx0ZXIgZXJyb3I6IFwiIDogXCJBcHBseWluZyBibG9vbSBmaWx0ZXIgZmFpbGVkOiBcIiwgZSksIFxuICAgICAgICAgICAgbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMCA9PT0gby5JZSA/IG51bGwgOiBvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBseSBibG9vbSBmaWx0ZXIgdG8gcmVtb3ZlIHRoZSBkZWxldGVkIGRvY3VtZW50cywgYW5kIHJldHVybiB0aGVcbiAgICAgKiBhcHBsaWNhdGlvbiBzdGF0dXMuXG4gICAgICovICAgIFhlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHQubWUuY291bnQgPT09IG4gLSB0aGlzLm50KGUsIHQudGFyZ2V0SWQpID8gMCAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLlN1Y2Nlc3MgKi8gOiAyIC8qIEJsb29tRmlsdGVyQXBwbGljYXRpb25TdGF0dXMuRmFsc2VQb3NpdGl2ZSAqLztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmlsdGVyIG91dCByZW1vdmVkIGRvY3VtZW50cyBiYXNlZCBvbiBibG9vbSBmaWx0ZXIgbWVtYmVyc2hpcCByZXN1bHQgYW5kXG4gICAgICogcmV0dXJuIG51bWJlciBvZiBkb2N1bWVudHMgcmVtb3ZlZC5cbiAgICAgKi8gICAgbnQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5MZS5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KHQpO1xuICAgICAgICBsZXQgciA9IDA7XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKG4gPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuTGUudHQoKSwgcyA9IGBwcm9qZWN0cy8ke2kucHJvamVjdElkfS9kYXRhYmFzZXMvJHtpLmRhdGFiYXNlfS9kb2N1bWVudHMvJHtuLnBhdGguY2Fub25pY2FsU3RyaW5nKCl9YDtcbiAgICAgICAgICAgIGUubWlnaHRDb250YWluKHMpIHx8ICh0aGlzLlVlKHQsIG4sIC8qdXBkYXRlZERvY3VtZW50PSovIG51bGwpLCByKyspO1xuICAgICAgICB9KSksIHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBjdXJyZW50bHkgYWNjdW11bGF0ZWQgc3RhdGUgaW50byBhIHJlbW90ZSBldmVudCBhdCB0aGVcbiAgICAgKiBwcm92aWRlZCBzbmFwc2hvdCB2ZXJzaW9uLiBSZXNldHMgdGhlIGFjY3VtdWxhdGVkIGNoYW5nZXMgYmVmb3JlIHJldHVybmluZy5cbiAgICAgKi8gICAgcnQoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IE1hcDtcbiAgICAgICAgdGhpcy5CZS5mb3JFYWNoKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuSmUocik7XG4gICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgIGlmIChuLmN1cnJlbnQgJiYgX19QUklWQVRFX3RhcmdldElzRG9jdW1lbnRUYXJnZXQoaS50YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERvY3VtZW50IHF1ZXJpZXMgZm9yIGRvY3VtZW50IHRoYXQgZG9uJ3QgZXhpc3QgY2FuIHByb2R1Y2UgYW4gZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzdWx0IHNldC4gVG8gdXBkYXRlIG91ciBsb2NhbCBjYWNoZSwgd2Ugc3ludGhlc2l6ZSBhIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBpZiB3ZSBoYXZlIG5vdCBwcmV2aW91c2x5IHJlY2VpdmVkIHRoZSBkb2N1bWVudC4gVGhpc1xuICAgICAgICAgICAgICAgICAgICAvLyByZXNvbHZlcyB0aGUgbGltYm8gc3RhdGUgb2YgdGhlIGRvY3VtZW50LCByZW1vdmluZyBpdCBmcm9tXG4gICAgICAgICAgICAgICAgICAgIC8vIGxpbWJvRG9jdW1lbnRSZWZzLlxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElkZWFsbHkgd2Ugd291bGQgaGF2ZSBhbiBleHBsaWNpdCBsb29rdXAgdGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIC8vIGluc3RlYWQgcmVzdWx0aW5nIGluIGFuIGV4cGxpY2l0IGRlbGV0ZSBtZXNzYWdlIGFuZCB3ZSBjb3VsZFxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhpcyBzcGVjaWFsIGxvZ2ljLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IERvY3VtZW50S2V5KGkudGFyZ2V0LnBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBudWxsICE9PSB0aGlzLmtlLmdldCh0KSB8fCB0aGlzLml0KHIsIHQpIHx8IHRoaXMuVWUociwgdCwgTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQodCwgZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuLmJlICYmICh0LnNldChyLCBuLnZlKCkpLCBuLkNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIGxldCBuID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIC8vIFdlIGV4dHJhY3QgdGhlIHNldCBvZiBsaW1iby1vbmx5IGRvY3VtZW50IHVwZGF0ZXMgYXMgdGhlIEdDIGxvZ2ljXG4gICAgICAgIC8vIHNwZWNpYWwtY2FzZXMgZG9jdW1lbnRzIHRoYXQgZG8gbm90IGFwcGVhciBpbiB0aGUgdGFyZ2V0IGNhY2hlLlxuICAgICAgICBcbiAgICAgICAgLy8gVE9ETyhnc29sdGlzKTogRXhwYW5kIG9uIHRoaXMgY29tbWVudCBvbmNlIEdDIGlzIGF2YWlsYWJsZSBpbiB0aGUgSlNcbiAgICAgICAgLy8gY2xpZW50LlxuICAgICAgICAgICAgICAgIHRoaXMucWUuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGxldCByID0gITA7XG4gICAgICAgICAgICB0LmZvckVhY2hXaGlsZSgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuSmUoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICF0IHx8IFwiVGFyZ2V0UHVycG9zZUxpbWJvUmVzb2x1dGlvblwiIC8qIFRhcmdldFB1cnBvc2UuTGltYm9SZXNvbHV0aW9uICovID09PSB0LnB1cnBvc2UgfHwgKHIgPSAhMSwgXG4gICAgICAgICAgICAgICAgITEpO1xuICAgICAgICAgICAgfSkpLCByICYmIChuID0gbi5hZGQoZSkpO1xuICAgICAgICB9KSksIHRoaXMua2UuZm9yRWFjaCgoKHQsIG4pID0+IG4uc2V0UmVhZFRpbWUoZSkpKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBSZW1vdGVFdmVudChlLCB0LCB0aGlzLlFlLCB0aGlzLmtlLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMua2UgPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCksIHRoaXMucWUgPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRNYXAoKSwgXG4gICAgICAgIHRoaXMuUWUgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKSwgcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgdG8gdGhlIGludGVybmFsIGxpc3Qgb2YgZG9jdW1lbnQgdXBkYXRlcyBhbmRcbiAgICAgKiBpdHMgZG9jdW1lbnQga2V5IHRvIHRoZSBnaXZlbiB0YXJnZXQncyBtYXBwaW5nLlxuICAgICAqL1xuICAgIC8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gICAgJGUoZSwgdCkge1xuICAgICAgICBpZiAoIXRoaXMuemUoZSkpIHJldHVybjtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuaXQoZSwgdC5rZXkpID8gMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDogMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovO1xuICAgICAgICB0aGlzLkdlKGUpLkZlKHQua2V5LCBuKSwgdGhpcy5rZSA9IHRoaXMua2UuaW5zZXJ0KHQua2V5LCB0KSwgdGhpcy5xZSA9IHRoaXMucWUuaW5zZXJ0KHQua2V5LCB0aGlzLnN0KHQua2V5KS5hZGQoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBwcm92aWRlZCBkb2N1bWVudCBmcm9tIHRoZSB0YXJnZXQgbWFwcGluZy4gSWYgdGhlXG4gICAgICogZG9jdW1lbnQgbm8gbG9uZ2VyIG1hdGNoZXMgdGhlIHRhcmdldCwgYnV0IHRoZSBkb2N1bWVudCdzIHN0YXRlIGlzIHN0aWxsXG4gICAgICoga25vd24gKGUuZy4gd2Uga25vdyB0aGF0IHRoZSBkb2N1bWVudCB3YXMgZGVsZXRlZCBvciB3ZSByZWNlaXZlZCB0aGUgY2hhbmdlXG4gICAgICogdGhhdCBjYXVzZWQgdGhlIGZpbHRlciBtaXNtYXRjaCksIHRoZSBuZXcgZG9jdW1lbnQgY2FuIGJlIHByb3ZpZGVkXG4gICAgICogdG8gdXBkYXRlIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUuXG4gICAgICovXG4gICAgLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAgICBVZShlLCB0LCBuKSB7XG4gICAgICAgIGlmICghdGhpcy56ZShlKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCByID0gdGhpcy5HZShlKTtcbiAgICAgICAgdGhpcy5pdChlLCB0KSA/IHIuRmUodCwgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8pIDogXG4gICAgICAgIC8vIFRoZSBkb2N1bWVudCBtYXkgaGF2ZSBlbnRlcmVkIGFuZCBsZWZ0IHRoZSB0YXJnZXQgYmVmb3JlIHdlIHJhaXNlZCBhXG4gICAgICAgIC8vIHNuYXBzaG90LCBzbyB3ZSBjYW4ganVzdCBpZ25vcmUgdGhlIGNoYW5nZS5cbiAgICAgICAgci5NZSh0KSwgdGhpcy5xZSA9IHRoaXMucWUuaW5zZXJ0KHQsIHRoaXMuc3QodCkuZGVsZXRlKGUpKSwgbiAmJiAodGhpcy5rZSA9IHRoaXMua2UuaW5zZXJ0KHQsIG4pKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KGUpIHtcbiAgICAgICAgdGhpcy5CZS5kZWxldGUoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgY291bnQgb2YgZG9jdW1lbnRzIGluIHRoZSB0YXJnZXQuIFRoaXMgaW5jbHVkZXMgYm90aFxuICAgICAqIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHRoYXQgdGhlIExvY2FsU3RvcmUgY29uc2lkZXJzIHRvIGJlIHBhcnQgb2YgdGhlXG4gICAgICogdGFyZ2V0IGFzIHdlbGwgYXMgYW55IGFjY3VtdWxhdGVkIGNoYW5nZXMuXG4gICAgICovICAgIFllKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuR2UoZSkudmUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuTGUuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldChlKS5zaXplICsgdC5hZGRlZERvY3VtZW50cy5zaXplIC0gdC5yZW1vdmVkRG9jdW1lbnRzLnNpemU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluY3JlbWVudCB0aGUgbnVtYmVyIG9mIGFja3MgbmVlZGVkIGZyb20gd2F0Y2ggYmVmb3JlIHdlIGNhbiBjb25zaWRlciB0aGVcbiAgICAgKiBzZXJ2ZXIgdG8gYmUgJ2luLXN5bmMnIHdpdGggdGhlIGNsaWVudCdzIGFjdGl2ZSB0YXJnZXRzLlxuICAgICAqLyAgICB4ZShlKSB7XG4gICAgICAgIHRoaXMuR2UoZSkueGUoKTtcbiAgICB9XG4gICAgR2UoZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXMuQmUuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdCB8fCAodCA9IG5ldyBfX1BSSVZBVEVfVGFyZ2V0U3RhdGUsIHRoaXMuQmUuc2V0KGUsIHQpKSwgdDtcbiAgICB9XG4gICAgc3QoZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXMucWUuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdCB8fCAodCA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCB0aGlzLnFlID0gdGhpcy5xZS5pbnNlcnQoZSwgdCkpLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmVyaWZpZXMgdGhhdCB0aGUgdXNlciBpcyBzdGlsbCBpbnRlcmVzdGVkIGluIHRoaXMgdGFyZ2V0IChieSBjYWxsaW5nXG4gICAgICogYGdldFRhcmdldERhdGFGb3JUYXJnZXQoKWApIGFuZCB0aGF0IHdlIGFyZSBub3Qgd2FpdGluZyBmb3IgcGVuZGluZyBBRERzXG4gICAgICogZnJvbSB3YXRjaC5cbiAgICAgKi8gICAgemUoZSkge1xuICAgICAgICBjb25zdCB0ID0gbnVsbCAhPT0gdGhpcy5KZShlKTtcbiAgICAgICAgcmV0dXJuIHQgfHwgX19QUklWQVRFX2xvZ0RlYnVnKFwiV2F0Y2hDaGFuZ2VBZ2dyZWdhdG9yXCIsIFwiRGV0ZWN0ZWQgaW5hY3RpdmUgdGFyZ2V0XCIsIGUpLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgVGFyZ2V0RGF0YSBmb3IgYW4gYWN0aXZlIHRhcmdldCAoaS5lLiBhIHRhcmdldCB0aGF0IHRoZSB1c2VyXG4gICAgICogaXMgc3RpbGwgaW50ZXJlc3RlZCBpbiB0aGF0IGhhcyBubyBvdXRzdGFuZGluZyB0YXJnZXQgY2hhbmdlIHJlcXVlc3RzKS5cbiAgICAgKi8gICAgSmUoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5CZS5nZXQoZSk7XG4gICAgICAgIHJldHVybiB0ICYmIHQuU2UgPyBudWxsIDogdGhpcy5MZS5vdChlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBzdGF0ZSBvZiBhIFdhdGNoIHRhcmdldCB0byBpdHMgaW5pdGlhbCBzdGF0ZSAoZS5nLiBzZXRzXG4gICAgICogJ2N1cnJlbnQnIHRvIGZhbHNlLCBjbGVhcnMgdGhlIHJlc3VtZSB0b2tlbiBhbmQgcmVtb3ZlcyBpdHMgdGFyZ2V0IG1hcHBpbmdcbiAgICAgKiBmcm9tIGFsbCBkb2N1bWVudHMpLlxuICAgICAqLyAgICBqZShlKSB7XG4gICAgICAgIHRoaXMuQmUuc2V0KGUsIG5ldyBfX1BSSVZBVEVfVGFyZ2V0U3RhdGUpO1xuICAgICAgICB0aGlzLkxlLmdldFJlbW90ZUtleXNGb3JUYXJnZXQoZSkuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICB0aGlzLlVlKGUsIHQsIC8qdXBkYXRlZERvY3VtZW50PSovIG51bGwpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgTG9jYWxTdG9yZSBjb25zaWRlcnMgdGhlIGRvY3VtZW50IHRvIGJlIHBhcnQgb2YgdGhlXG4gICAgICogc3BlY2lmaWVkIHRhcmdldC5cbiAgICAgKi8gICAgaXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5MZS5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUpLmhhcyh0KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudFRhcmdldE1hcCgpIHtcbiAgICByZXR1cm4gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3NuYXBzaG90Q2hhbmdlc01hcCgpIHtcbiAgICByZXR1cm4gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcbn1cblxuY29uc3QgVGUgPSAoKCkgPT4ge1xuICAgIGNvbnN0IGUgPSB7XG4gICAgICAgIGFzYzogXCJBU0NFTkRJTkdcIixcbiAgICAgICAgZGVzYzogXCJERVNDRU5ESU5HXCJcbiAgICB9O1xuICAgIHJldHVybiBlO1xufSkoKSwgRWUgPSAoKCkgPT4ge1xuICAgIGNvbnN0IGUgPSB7XG4gICAgICAgIFwiPFwiOiBcIkxFU1NfVEhBTlwiLFxuICAgICAgICBcIjw9XCI6IFwiTEVTU19USEFOX09SX0VRVUFMXCIsXG4gICAgICAgIFwiPlwiOiBcIkdSRUFURVJfVEhBTlwiLFxuICAgICAgICBcIj49XCI6IFwiR1JFQVRFUl9USEFOX09SX0VRVUFMXCIsXG4gICAgICAgIFwiPT1cIjogXCJFUVVBTFwiLFxuICAgICAgICBcIiE9XCI6IFwiTk9UX0VRVUFMXCIsXG4gICAgICAgIFwiYXJyYXktY29udGFpbnNcIjogXCJBUlJBWV9DT05UQUlOU1wiLFxuICAgICAgICBpbjogXCJJTlwiLFxuICAgICAgICBcIm5vdC1pblwiOiBcIk5PVF9JTlwiLFxuICAgICAgICBcImFycmF5LWNvbnRhaW5zLWFueVwiOiBcIkFSUkFZX0NPTlRBSU5TX0FOWVwiXG4gICAgfTtcbiAgICByZXR1cm4gZTtcbn0pKCksIGRlID0gKCgpID0+IHtcbiAgICBjb25zdCBlID0ge1xuICAgICAgICBhbmQ6IFwiQU5EXCIsXG4gICAgICAgIG9yOiBcIk9SXCJcbiAgICB9O1xuICAgIHJldHVybiBlO1xufSkoKTtcblxuLyoqXG4gKiBUaGlzIGNsYXNzIGdlbmVyYXRlcyBKc29uT2JqZWN0IHZhbHVlcyBmb3IgdGhlIERhdGFzdG9yZSBBUEkgc3VpdGFibGUgZm9yXG4gKiBzZW5kaW5nIHRvIGVpdGhlciBHUlBDIHN0dWIgbWV0aG9kcyBvciB2aWEgdGhlIEpTT04vSFRUUCBSRVNUIEFQSS5cbiAqXG4gKiBUaGUgc2VyaWFsaXplciBzdXBwb3J0cyBib3RoIFByb3RvYnVmLmpzIGFuZCBQcm90bzMgSlNPTiBmb3JtYXRzLiBCeVxuICogc2V0dGluZyBgdXNlUHJvdG8zSnNvbmAgdG8gdHJ1ZSwgdGhlIHNlcmlhbGl6ZXIgd2lsbCB1c2UgdGhlIFByb3RvMyBKU09OXG4gKiBmb3JtYXQuXG4gKlxuICogRm9yIGEgZGVzY3JpcHRpb24gb2YgdGhlIFByb3RvMyBKU09OIGZvcm1hdCBjaGVja1xuICogaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vcHJvdG9jb2wtYnVmZmVycy9kb2NzL3Byb3RvMyNqc29uXG4gKlxuICogVE9ETyhrbGltdCk6IFdlIGNhbiByZW1vdmUgdGhlIGRhdGFiYXNlSWQgYXJndW1lbnQgaWYgd2Uga2VlcCB0aGUgZnVsbFxuICogcmVzb3VyY2UgbmFtZSBpbiBkb2N1bWVudHMuXG4gKi9cbmNsYXNzIEpzb25Qcm90b1NlcmlhbGl6ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUlkID0gZSwgdGhpcy51c2VQcm90bzNKc29uID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIG51bWJlciAob3IgbnVsbCkgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvXG4gKiBhIGdvb2dsZS5wcm90b2J1Zi5JbnQzMlZhbHVlIHByb3RvLlxuICogRE8gTk9UIFVTRSBUSElTIEZPUiBBTllUSElORyBFTFNFLlxuICogVGhpcyBtZXRob2QgY2hlYXRzLiBJdCdzIHR5cGVkIGFzIHJldHVybmluZyBcIm51bWJlclwiIGJlY2F1c2UgdGhhdCdzIHdoYXRcbiAqIG91ciBnZW5lcmF0ZWQgcHJvdG8gaW50ZXJmYWNlcyBzYXkgSW50MzJWYWx1ZSBtdXN0IGJlLiBCdXQgR1JQQyBhY3R1YWxseVxuICogZXhwZWN0cyBhIHsgdmFsdWU6IDxudW1iZXI+IH0gc3RydWN0LlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9JbnQzMlByb3RvKGUsIHQpIHtcbiAgICByZXR1cm4gZS51c2VQcm90bzNKc29uIHx8IF9fUFJJVkFURV9pc051bGxPclVuZGVmaW5lZCh0KSA/IHQgOiB7XG4gICAgICAgIHZhbHVlOiB0XG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgbnVtYmVyIChvciBudWxsKSBmcm9tIGEgZ29vZ2xlLnByb3RvYnVmLkludDMyVmFsdWUgcHJvdG8uXG4gKi9cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIERhdGUgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvIGEgcHJvdG8uXG4gKi9cbmZ1bmN0aW9uIHRvVGltZXN0YW1wKGUsIHQpIHtcbiAgICBpZiAoZS51c2VQcm90bzNKc29uKSB7XG4gICAgICAgIHJldHVybiBgJHtuZXcgRGF0ZSgxZTMgKiB0LnNlY29uZHMpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvXFwuXFxkKi8sIFwiXCIpLnJlcGxhY2UoXCJaXCIsIFwiXCIpfS4keyhcIjAwMDAwMDAwMFwiICsgdC5uYW5vc2Vjb25kcykuc2xpY2UoLTkpfVpgO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzZWNvbmRzOiBcIlwiICsgdC5zZWNvbmRzLFxuICAgICAgICBuYW5vczogdC5uYW5vc2Vjb25kc1xuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBieXRlcyB0aGF0J3MgYXBwcm9wcmlhdGUgdG8gcHV0IGluIGEgcHJvdG8uXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3RvQnl0ZXMoZSwgdCkge1xuICAgIHJldHVybiBlLnVzZVByb3RvM0pzb24gPyB0LnRvQmFzZTY0KCkgOiB0LnRvVWludDhBcnJheSgpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBCeXRlU3RyaW5nIGJhc2VkIG9uIHRoZSBwcm90byBzdHJpbmcgdmFsdWUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RvVmVyc2lvbihlLCB0KSB7XG4gICAgcmV0dXJuIHRvVGltZXN0YW1wKGUsIHQudG9UaW1lc3RhbXAoKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tVmVyc2lvbihlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZSksIFNuYXBzaG90VmVyc2lvbi5mcm9tVGltZXN0YW1wKGZ1bmN0aW9uIGZyb21UaW1lc3RhbXAoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBUaW1lc3RhbXAodC5zZWNvbmRzLCB0Lm5hbm9zKTtcbiAgICB9KGUpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvUmVzb3VyY2VOYW1lKGUsIHQpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX3RvUmVzb3VyY2VQYXRoKGUsIHQpLmNhbm9uaWNhbFN0cmluZygpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9SZXNvdXJjZVBhdGgoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnVsbHlRdWFsaWZpZWRQcmVmaXhQYXRoKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNvdXJjZVBhdGgoWyBcInByb2plY3RzXCIsIGUucHJvamVjdElkLCBcImRhdGFiYXNlc1wiLCBlLmRhdGFiYXNlIF0pO1xuICAgIH0oZSkuY2hpbGQoXCJkb2N1bWVudHNcIik7XG4gICAgcmV0dXJuIHZvaWQgMCA9PT0gdCA/IG4gOiBuLmNoaWxkKHQpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVJlc291cmNlTmFtZShlKSB7XG4gICAgY29uc3QgdCA9IFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGUpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChfX1BSSVZBVEVfaXNWYWxpZFJlc291cmNlTmFtZSh0KSksIHQ7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b05hbWUoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdG9SZXNvdXJjZU5hbWUoZS5kYXRhYmFzZUlkLCB0LnBhdGgpO1xufVxuXG5mdW5jdGlvbiBmcm9tTmFtZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9mcm9tUmVzb3VyY2VOYW1lKHQpO1xuICAgIGlmIChuLmdldCgxKSAhPT0gZS5kYXRhYmFzZUlkLnByb2plY3RJZCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJUcmllZCB0byBkZXNlcmlhbGl6ZSBrZXkgZnJvbSBkaWZmZXJlbnQgcHJvamVjdDogXCIgKyBuLmdldCgxKSArIFwiIHZzIFwiICsgZS5kYXRhYmFzZUlkLnByb2plY3RJZCk7XG4gICAgaWYgKG4uZ2V0KDMpICE9PSBlLmRhdGFiYXNlSWQuZGF0YWJhc2UpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiVHJpZWQgdG8gZGVzZXJpYWxpemUga2V5IGZyb20gZGlmZmVyZW50IGRhdGFiYXNlOiBcIiArIG4uZ2V0KDMpICsgXCIgdnMgXCIgKyBlLmRhdGFiYXNlSWQuZGF0YWJhc2UpO1xuICAgIHJldHVybiBuZXcgRG9jdW1lbnRLZXkoX19QUklWQVRFX2V4dHJhY3RMb2NhbFBhdGhGcm9tUmVzb3VyY2VOYW1lKG4pKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvUXVlcnlQYXRoKGUsIHQpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX3RvUmVzb3VyY2VOYW1lKGUuZGF0YWJhc2VJZCwgdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tUXVlcnlQYXRoKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2Zyb21SZXNvdXJjZU5hbWUoZSk7XG4gICAgLy8gSW4gdjFiZXRhMSBxdWVyaWVzIGZvciBjb2xsZWN0aW9ucyBhdCB0aGUgcm9vdCBkaWQgbm90IGhhdmUgYSB0cmFpbGluZ1xuICAgIC8vIFwiL2RvY3VtZW50c1wiLiBJbiB2MSBhbGwgcmVzb3VyY2UgcGF0aHMgY29udGFpbiBcIi9kb2N1bWVudHNcIi4gUHJlc2VydmUgdGhlXG4gICAgLy8gYWJpbGl0eSB0byByZWFkIHRoZSB2MWJldGExIGZvcm0gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBxdWVyaWVzIHBlcnNpc3RlZFxuICAgIC8vIGluIHRoZSBsb2NhbCB0YXJnZXQgY2FjaGUuXG4gICAgICAgIHJldHVybiA0ID09PSB0Lmxlbmd0aCA/IFJlc291cmNlUGF0aC5lbXB0eVBhdGgoKSA6IF9fUFJJVkFURV9leHRyYWN0TG9jYWxQYXRoRnJvbVJlc291cmNlTmFtZSh0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldEVuY29kZWREYXRhYmFzZUlkKGUpIHtcbiAgICByZXR1cm4gbmV3IFJlc291cmNlUGF0aChbIFwicHJvamVjdHNcIiwgZS5kYXRhYmFzZUlkLnByb2plY3RJZCwgXCJkYXRhYmFzZXNcIiwgZS5kYXRhYmFzZUlkLmRhdGFiYXNlIF0pLmNhbm9uaWNhbFN0cmluZygpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZXh0cmFjdExvY2FsUGF0aEZyb21SZXNvdXJjZU5hbWUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChlLmxlbmd0aCA+IDQgJiYgXCJkb2N1bWVudHNcIiA9PT0gZS5nZXQoNCkpLCBlLnBvcEZpcnN0KDUpO1xufVxuXG4vKiogQ3JlYXRlcyBhIERvY3VtZW50IHByb3RvIGZyb20ga2V5IGFuZCBmaWVsZHMgKGJ1dCBubyBjcmVhdGUvdXBkYXRlIHRpbWUpICovIGZ1bmN0aW9uIF9fUFJJVkFURV90b011dGF0aW9uRG9jdW1lbnQoZSwgdCwgbikge1xuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IF9fUFJJVkFURV90b05hbWUoZSwgdCksXG4gICAgICAgIGZpZWxkczogbi52YWx1ZS5tYXBWYWx1ZS5maWVsZHNcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURvY3VtZW50KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gZnJvbU5hbWUoZSwgdC5uYW1lKSwgaSA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0LnVwZGF0ZVRpbWUpLCBzID0gdC5jcmVhdGVUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQuY3JlYXRlVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCksIG8gPSBuZXcgT2JqZWN0VmFsdWUoe1xuICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgZmllbGRzOiB0LmZpZWxkc1xuICAgICAgICB9XG4gICAgfSksIF8gPSBNdXRhYmxlRG9jdW1lbnQubmV3Rm91bmREb2N1bWVudChyLCBpLCBzLCBvKTtcbiAgICByZXR1cm4gbiAmJiBfLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpLCBuID8gXy5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKSA6IF87XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tQmF0Y2hHZXREb2N1bWVudHNSZXNwb25zZShlLCB0KSB7XG4gICAgcmV0dXJuIFwiZm91bmRcIiBpbiB0ID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Gb3VuZChlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhdC5mb3VuZCksIHQuZm91bmQubmFtZSwgdC5mb3VuZC51cGRhdGVUaW1lO1xuICAgICAgICBjb25zdCBuID0gZnJvbU5hbWUoZSwgdC5mb3VuZC5uYW1lKSwgciA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0LmZvdW5kLnVwZGF0ZVRpbWUpLCBpID0gdC5mb3VuZC5jcmVhdGVUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQuZm91bmQuY3JlYXRlVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCksIHMgPSBuZXcgT2JqZWN0VmFsdWUoe1xuICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHQuZm91bmQuZmllbGRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gTXV0YWJsZURvY3VtZW50Lm5ld0ZvdW5kRG9jdW1lbnQobiwgciwgaSwgcyk7XG4gICAgfShlLCB0KSA6IFwibWlzc2luZ1wiIGluIHQgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbU1pc3NpbmcoZSwgdCkge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCghIXQubWlzc2luZyksIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhdC5yZWFkVGltZSk7XG4gICAgICAgIGNvbnN0IG4gPSBmcm9tTmFtZShlLCB0Lm1pc3NpbmcpLCByID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQucmVhZFRpbWUpO1xuICAgICAgICByZXR1cm4gTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQobiwgcik7XG4gICAgfShlLCB0KSA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21XYXRjaENoYW5nZShlLCB0KSB7XG4gICAgbGV0IG47XG4gICAgaWYgKFwidGFyZ2V0Q2hhbmdlXCIgaW4gdCkge1xuICAgICAgICB0LnRhcmdldENoYW5nZTtcbiAgICAgICAgLy8gcHJvdG8zIGRlZmF1bHQgdmFsdWUgaXMgdW5zZXQgaW4gSlNPTiAodW5kZWZpbmVkKSwgc28gdXNlICdOT19DSEFOR0UnXG4gICAgICAgIC8vIGlmIHVuc2V0XG4gICAgICAgIGNvbnN0IHIgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUoZSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiTk9fQ0hBTkdFXCIgPT09IGUgPyAwIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuTm9DaGFuZ2UgKi8gOiBcIkFERFwiID09PSBlID8gMSAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLkFkZGVkICovIDogXCJSRU1PVkVcIiA9PT0gZSA/IDIgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZW1vdmVkICovIDogXCJDVVJSRU5UXCIgPT09IGUgPyAzIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuQ3VycmVudCAqLyA6IFwiUkVTRVRcIiA9PT0gZSA/IDQgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZXNldCAqLyA6IGZhaWwoKTtcbiAgICAgICAgfSh0LnRhcmdldENoYW5nZS50YXJnZXRDaGFuZ2VUeXBlIHx8IFwiTk9fQ0hBTkdFXCIpLCBpID0gdC50YXJnZXRDaGFuZ2UudGFyZ2V0SWRzIHx8IFtdLCBzID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21CeXRlcyhlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gZS51c2VQcm90bzNKc29uID8gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KHZvaWQgMCA9PT0gdCB8fCBcInN0cmluZ1wiID09IHR5cGVvZiB0KSwgXG4gICAgICAgICAgICBCeXRlU3RyaW5nLmZyb21CYXNlNjRTdHJpbmcodCB8fCBcIlwiKSkgOiAoX19QUklWQVRFX2hhcmRBc3NlcnQodm9pZCAwID09PSB0IHx8IFxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIGFuIGluc3RhbmNlIG9mIGJvdGggQnVmZmVyIGFuZCBVaW50OEFycmF5LFxuICAgICAgICAgICAgLy8gZGVzcGl0ZSB0aGUgZmFjdCB0aGF0IEJ1ZmZlciBleHRlbmRzIFVpbnQ4QXJyYXkuIEluIHNvbWVcbiAgICAgICAgICAgIC8vIGVudmlyb25tZW50cywgc3VjaCBhcyBqc2RvbSwgdGhlIHByb3RvdHlwZSBjaGFpbiBvZiBCdWZmZXJcbiAgICAgICAgICAgIC8vIGRvZXMgbm90IGluZGljYXRlIHRoYXQgaXQgZXh0ZW5kcyBVaW50OEFycmF5LlxuICAgICAgICAgICAgdCBpbnN0YW5jZW9mIEJ1ZmZlciB8fCB0IGluc3RhbmNlb2YgVWludDhBcnJheSksIEJ5dGVTdHJpbmcuZnJvbVVpbnQ4QXJyYXkodCB8fCBuZXcgVWludDhBcnJheSkpO1xuICAgICAgICB9KGUsIHQudGFyZ2V0Q2hhbmdlLnJlc3VtZVRva2VuKSwgbyA9IHQudGFyZ2V0Q2hhbmdlLmNhdXNlLCBfID0gbyAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVJwY1N0YXR1cyhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdm9pZCAwID09PSBlLmNvZGUgPyBELlVOS05PV04gOiBfX1BSSVZBVEVfbWFwQ29kZUZyb21ScGNDb2RlKGUuY29kZSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpcmVzdG9yZUVycm9yKHQsIGUubWVzc2FnZSB8fCBcIlwiKTtcbiAgICAgICAgfShvKTtcbiAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfV2F0Y2hUYXJnZXRDaGFuZ2UociwgaSwgcywgXyB8fCBudWxsKTtcbiAgICB9IGVsc2UgaWYgKFwiZG9jdW1lbnRDaGFuZ2VcIiBpbiB0KSB7XG4gICAgICAgIHQuZG9jdW1lbnRDaGFuZ2U7XG4gICAgICAgIGNvbnN0IHIgPSB0LmRvY3VtZW50Q2hhbmdlO1xuICAgICAgICByLmRvY3VtZW50LCByLmRvY3VtZW50Lm5hbWUsIHIuZG9jdW1lbnQudXBkYXRlVGltZTtcbiAgICAgICAgY29uc3QgaSA9IGZyb21OYW1lKGUsIHIuZG9jdW1lbnQubmFtZSksIHMgPSBfX1BSSVZBVEVfZnJvbVZlcnNpb24oci5kb2N1bWVudC51cGRhdGVUaW1lKSwgbyA9IHIuZG9jdW1lbnQuY3JlYXRlVGltZSA/IF9fUFJJVkFURV9mcm9tVmVyc2lvbihyLmRvY3VtZW50LmNyZWF0ZVRpbWUpIDogU25hcHNob3RWZXJzaW9uLm1pbigpLCBfID0gbmV3IE9iamVjdFZhbHVlKHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgZmllbGRzOiByLmRvY3VtZW50LmZpZWxkc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSwgYSA9IE11dGFibGVEb2N1bWVudC5uZXdGb3VuZERvY3VtZW50KGksIHMsIG8sIF8pLCB1ID0gci50YXJnZXRJZHMgfHwgW10sIGMgPSByLnJlbW92ZWRUYXJnZXRJZHMgfHwgW107XG4gICAgICAgIG4gPSBuZXcgX19QUklWQVRFX0RvY3VtZW50V2F0Y2hDaGFuZ2UodSwgYywgYS5rZXksIGEpO1xuICAgIH0gZWxzZSBpZiAoXCJkb2N1bWVudERlbGV0ZVwiIGluIHQpIHtcbiAgICAgICAgdC5kb2N1bWVudERlbGV0ZTtcbiAgICAgICAgY29uc3QgciA9IHQuZG9jdW1lbnREZWxldGU7XG4gICAgICAgIHIuZG9jdW1lbnQ7XG4gICAgICAgIGNvbnN0IGkgPSBmcm9tTmFtZShlLCByLmRvY3VtZW50KSwgcyA9IHIucmVhZFRpbWUgPyBfX1BSSVZBVEVfZnJvbVZlcnNpb24oci5yZWFkVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCksIG8gPSBNdXRhYmxlRG9jdW1lbnQubmV3Tm9Eb2N1bWVudChpLCBzKSwgXyA9IHIucmVtb3ZlZFRhcmdldElkcyB8fCBbXTtcbiAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfRG9jdW1lbnRXYXRjaENoYW5nZShbXSwgXywgby5rZXksIG8pO1xuICAgIH0gZWxzZSBpZiAoXCJkb2N1bWVudFJlbW92ZVwiIGluIHQpIHtcbiAgICAgICAgdC5kb2N1bWVudFJlbW92ZTtcbiAgICAgICAgY29uc3QgciA9IHQuZG9jdW1lbnRSZW1vdmU7XG4gICAgICAgIHIuZG9jdW1lbnQ7XG4gICAgICAgIGNvbnN0IGkgPSBmcm9tTmFtZShlLCByLmRvY3VtZW50KSwgcyA9IHIucmVtb3ZlZFRhcmdldElkcyB8fCBbXTtcbiAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfRG9jdW1lbnRXYXRjaENoYW5nZShbXSwgcywgaSwgbnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCEoXCJmaWx0ZXJcIiBpbiB0KSkgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAge1xuICAgICAgICAgICAgdC5maWx0ZXI7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5maWx0ZXI7XG4gICAgICAgICAgICBlLnRhcmdldElkO1xuICAgICAgICAgICAgY29uc3Qge2NvdW50OiByID0gMCwgdW5jaGFuZ2VkTmFtZXM6IGl9ID0gZSwgcyA9IG5ldyBFeGlzdGVuY2VGaWx0ZXIociwgaSksIG8gPSBlLnRhcmdldElkO1xuICAgICAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfRXhpc3RlbmNlRmlsdGVyQ2hhbmdlKG8sIHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuO1xufVxuXG5mdW5jdGlvbiB0b011dGF0aW9uKGUsIHQpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAodCBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXRNdXRhdGlvbikgbiA9IHtcbiAgICAgICAgdXBkYXRlOiBfX1BSSVZBVEVfdG9NdXRhdGlvbkRvY3VtZW50KGUsIHQua2V5LCB0LnZhbHVlKVxuICAgIH07IGVsc2UgaWYgKHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfRGVsZXRlTXV0YXRpb24pIG4gPSB7XG4gICAgICAgIGRlbGV0ZTogX19QUklWQVRFX3RvTmFtZShlLCB0LmtleSlcbiAgICB9OyBlbHNlIGlmICh0IGluc3RhbmNlb2YgX19QUklWQVRFX1BhdGNoTXV0YXRpb24pIG4gPSB7XG4gICAgICAgIHVwZGF0ZTogX19QUklWQVRFX3RvTXV0YXRpb25Eb2N1bWVudChlLCB0LmtleSwgdC5kYXRhKSxcbiAgICAgICAgdXBkYXRlTWFzazogX19QUklWQVRFX3RvRG9jdW1lbnRNYXNrKHQuZmllbGRNYXNrKVxuICAgIH07IGVsc2Uge1xuICAgICAgICBpZiAoISh0IGluc3RhbmNlb2YgX19QUklWQVRFX1ZlcmlmeU11dGF0aW9uKSkgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgbiA9IHtcbiAgICAgICAgICAgIHZlcmlmeTogX19QUklWQVRFX3RvTmFtZShlLCB0LmtleSlcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHQuZmllbGRUcmFuc2Zvcm1zLmxlbmd0aCA+IDAgJiYgKG4udXBkYXRlVHJhbnNmb3JtcyA9IHQuZmllbGRUcmFuc2Zvcm1zLm1hcCgoZSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfdG9GaWVsZFRyYW5zZm9ybShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnRyYW5zZm9ybTtcbiAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBfX1BSSVZBVEVfU2VydmVyVGltZXN0YW1wVHJhbnNmb3JtKSByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRQYXRoOiB0LmZpZWxkLmNhbm9uaWNhbFN0cmluZygpLFxuICAgICAgICAgICAgc2V0VG9TZXJ2ZXJWYWx1ZTogXCJSRVFVRVNUX1RJTUVcIlxuICAgICAgICB9O1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uKSByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRQYXRoOiB0LmZpZWxkLmNhbm9uaWNhbFN0cmluZygpLFxuICAgICAgICAgICAgYXBwZW5kTWlzc2luZ0VsZW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBuLmVsZW1lbnRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKSByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRQYXRoOiB0LmZpZWxkLmNhbm9uaWNhbFN0cmluZygpLFxuICAgICAgICAgICAgcmVtb3ZlQWxsRnJvbUFycmF5OiB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBuLmVsZW1lbnRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRUcmFuc2Zvcm1PcGVyYXRpb24pIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZFBhdGg6IHQuZmllbGQuY2Fub25pY2FsU3RyaW5nKCksXG4gICAgICAgICAgICBpbmNyZW1lbnQ6IG4uUGVcbiAgICAgICAgfTtcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH0oMCwgZSkpKSksIHQucHJlY29uZGl0aW9uLmlzTm9uZSB8fCAobi5jdXJyZW50RG9jdW1lbnQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9QcmVjb25kaXRpb24oZSwgdCkge1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSB0LnVwZGF0ZVRpbWUgPyB7XG4gICAgICAgICAgICB1cGRhdGVUaW1lOiBfX1BSSVZBVEVfdG9WZXJzaW9uKGUsIHQudXBkYXRlVGltZSlcbiAgICAgICAgfSA6IHZvaWQgMCAhPT0gdC5leGlzdHMgPyB7XG4gICAgICAgICAgICBleGlzdHM6IHQuZXhpc3RzXG4gICAgICAgIH0gOiBmYWlsKCk7XG4gICAgfShlLCB0LnByZWNvbmRpdGlvbikpLCBuO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbU11dGF0aW9uKGUsIHQpIHtcbiAgICBjb25zdCBuID0gdC5jdXJyZW50RG9jdW1lbnQgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVByZWNvbmRpdGlvbihlKSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IGUudXBkYXRlVGltZSA/IFByZWNvbmRpdGlvbi51cGRhdGVUaW1lKF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLnVwZGF0ZVRpbWUpKSA6IHZvaWQgMCAhPT0gZS5leGlzdHMgPyBQcmVjb25kaXRpb24uZXhpc3RzKGUuZXhpc3RzKSA6IFByZWNvbmRpdGlvbi5ub25lKCk7XG4gICAgfSh0LmN1cnJlbnREb2N1bWVudCkgOiBQcmVjb25kaXRpb24ubm9uZSgpLCByID0gdC51cGRhdGVUcmFuc2Zvcm1zID8gdC51cGRhdGVUcmFuc2Zvcm1zLm1hcCgodCA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUZpZWxkVHJhbnNmb3JtKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBudWxsO1xuICAgICAgICBpZiAoXCJzZXRUb1NlcnZlclZhbHVlXCIgaW4gdCkgX19QUklWQVRFX2hhcmRBc3NlcnQoXCJSRVFVRVNUX1RJTUVcIiA9PT0gdC5zZXRUb1NlcnZlclZhbHVlKSwgXG4gICAgICAgIG4gPSBuZXcgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybTsgZWxzZSBpZiAoXCJhcHBlbmRNaXNzaW5nRWxlbWVudHNcIiBpbiB0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5hcHBlbmRNaXNzaW5nRWxlbWVudHMudmFsdWVzIHx8IFtdO1xuICAgICAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbihlKTtcbiAgICAgICAgfSBlbHNlIGlmIChcInJlbW92ZUFsbEZyb21BcnJheVwiIGluIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LnJlbW92ZUFsbEZyb21BcnJheS52YWx1ZXMgfHwgW107XG4gICAgICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbihlKTtcbiAgICAgICAgfSBlbHNlIFwiaW5jcmVtZW50XCIgaW4gdCA/IG4gPSBuZXcgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRUcmFuc2Zvcm1PcGVyYXRpb24oZSwgdC5pbmNyZW1lbnQpIDogZmFpbCgpO1xuICAgICAgICBjb25zdCByID0gRmllbGRQYXRoJDEuZnJvbVNlcnZlckZvcm1hdCh0LmZpZWxkUGF0aCk7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRUcmFuc2Zvcm0ociwgbik7XG4gICAgfShlLCB0KSkpIDogW107XG4gICAgaWYgKHQudXBkYXRlKSB7XG4gICAgICAgIHQudXBkYXRlLm5hbWU7XG4gICAgICAgIGNvbnN0IGkgPSBmcm9tTmFtZShlLCB0LnVwZGF0ZS5uYW1lKSwgcyA9IG5ldyBPYmplY3RWYWx1ZSh7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczogdC51cGRhdGUuZmllbGRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodC51cGRhdGVNYXNrKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Eb2N1bWVudE1hc2soZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLmZpZWxkUGF0aHMgfHwgW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZE1hc2sodC5tYXAoKGUgPT4gRmllbGRQYXRoJDEuZnJvbVNlcnZlckZvcm1hdChlKSkpKTtcbiAgICAgICAgICAgIH0odC51cGRhdGVNYXNrKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BhdGNoTXV0YXRpb24oaSwgcywgZSwgbiwgcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2V0TXV0YXRpb24oaSwgcywgbiwgcik7XG4gICAgfVxuICAgIGlmICh0LmRlbGV0ZSkge1xuICAgICAgICBjb25zdCByID0gZnJvbU5hbWUoZSwgdC5kZWxldGUpO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihyLCBuKTtcbiAgICB9XG4gICAgaWYgKHQudmVyaWZ5KSB7XG4gICAgICAgIGNvbnN0IHIgPSBmcm9tTmFtZShlLCB0LnZlcmlmeSk7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1ZlcmlmeU11dGF0aW9uKHIsIG4pO1xuICAgIH1cbiAgICByZXR1cm4gZmFpbCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVdyaXRlUmVzdWx0cyhlLCB0KSB7XG4gICAgcmV0dXJuIGUgJiYgZS5sZW5ndGggPiAwID8gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KHZvaWQgMCAhPT0gdCksIGUubWFwKChlID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tV3JpdGVSZXN1bHQoZSwgdCkge1xuICAgICAgICAvLyBOT1RFOiBEZWxldGVzIGRvbid0IGhhdmUgYW4gdXBkYXRlVGltZS5cbiAgICAgICAgbGV0IG4gPSBlLnVwZGF0ZVRpbWUgPyBfX1BSSVZBVEVfZnJvbVZlcnNpb24oZS51cGRhdGVUaW1lKSA6IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0KTtcbiAgICAgICAgcmV0dXJuIG4uaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpICYmIChcbiAgICAgICAgLy8gVGhlIEZpcmVzdG9yZSBFbXVsYXRvciBjdXJyZW50bHkgcmV0dXJucyBhbiB1cGRhdGUgdGltZSBvZiAwIGZvclxuICAgICAgICAvLyBkZWxldGVzIG9mIG5vbi1leGlzdGluZyBkb2N1bWVudHMgKHJhdGhlciB0aGFuIG51bGwpLiBUaGlzIGJyZWFrcyB0aGVcbiAgICAgICAgLy8gdGVzdCBcImdldCBkZWxldGVkIGRvYyB3aGlsZSBvZmZsaW5lIHdpdGggc291cmNlPWNhY2hlXCIgYXMgTm9Eb2N1bWVudHNcbiAgICAgICAgLy8gd2l0aCB2ZXJzaW9uIDAgYXJlIGZpbHRlcmVkIGJ5IEluZGV4ZWREYidzIFJlbW90ZURvY3VtZW50Q2FjaGUuXG4gICAgICAgIC8vIFRPRE8oIzIxNDkpOiBSZW1vdmUgdGhpcyB3aGVuIEVtdWxhdG9yIGlzIGZpeGVkXG4gICAgICAgIG4gPSBfX1BSSVZBVEVfZnJvbVZlcnNpb24odCkpLCBuZXcgTXV0YXRpb25SZXN1bHQobiwgZS50cmFuc2Zvcm1SZXN1bHRzIHx8IFtdKTtcbiAgICB9KGUsIHQpKSkpIDogW107XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0RvY3VtZW50c1RhcmdldChlLCB0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG9jdW1lbnRzOiBbIF9fUFJJVkFURV90b1F1ZXJ5UGF0aChlLCB0LnBhdGgpIF1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9RdWVyeVRhcmdldChlLCB0KSB7XG4gICAgLy8gRGlzc2VjdCB0aGUgcGF0aCBpbnRvIHBhcmVudCwgY29sbGVjdGlvbklkLCBhbmQgb3B0aW9uYWwga2V5IGZpbHRlci5cbiAgICBjb25zdCBuID0ge1xuICAgICAgICBzdHJ1Y3R1cmVkUXVlcnk6IHt9XG4gICAgfSwgciA9IHQucGF0aDtcbiAgICBsZXQgaTtcbiAgICBudWxsICE9PSB0LmNvbGxlY3Rpb25Hcm91cCA/IChpID0gciwgbi5zdHJ1Y3R1cmVkUXVlcnkuZnJvbSA9IFsge1xuICAgICAgICBjb2xsZWN0aW9uSWQ6IHQuY29sbGVjdGlvbkdyb3VwLFxuICAgICAgICBhbGxEZXNjZW5kYW50czogITBcbiAgICB9IF0pIDogKGkgPSByLnBvcExhc3QoKSwgbi5zdHJ1Y3R1cmVkUXVlcnkuZnJvbSA9IFsge1xuICAgICAgICBjb2xsZWN0aW9uSWQ6IHIubGFzdFNlZ21lbnQoKVxuICAgIH0gXSksIG4ucGFyZW50ID0gX19QUklWQVRFX3RvUXVlcnlQYXRoKGUsIGkpO1xuICAgIGNvbnN0IHMgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9GaWx0ZXJzKGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdG9GaWx0ZXIoQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShlLCBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLykpO1xuICAgIH0odC5maWx0ZXJzKTtcbiAgICBzICYmIChuLnN0cnVjdHVyZWRRdWVyeS53aGVyZSA9IHMpO1xuICAgIGNvbnN0IG8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9PcmRlcihlKSB7XG4gICAgICAgIGlmICgwID09PSBlLmxlbmd0aCkgcmV0dXJuO1xuICAgICAgICByZXR1cm4gZS5tYXAoKGUgPT4gXG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX3RvUHJvcGVydHlPcmRlcihlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBfX1BSSVZBVEVfdG9EaXJlY3Rpb24oZS5kaXIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KGUpKSk7XG4gICAgfSh0Lm9yZGVyQnkpO1xuICAgIG8gJiYgKG4uc3RydWN0dXJlZFF1ZXJ5Lm9yZGVyQnkgPSBvKTtcbiAgICBjb25zdCBfID0gX19QUklWQVRFX3RvSW50MzJQcm90byhlLCB0LmxpbWl0KTtcbiAgICByZXR1cm4gbnVsbCAhPT0gXyAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkubGltaXQgPSBfKSwgdC5zdGFydEF0ICYmIChuLnN0cnVjdHVyZWRRdWVyeS5zdGFydEF0ID0gZnVuY3Rpb24gX19QUklWQVRFX3RvU3RhcnRBdEN1cnNvcihlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBiZWZvcmU6IGUuaW5jbHVzaXZlLFxuICAgICAgICAgICAgdmFsdWVzOiBlLnBvc2l0aW9uXG4gICAgICAgIH07XG4gICAgfSh0LnN0YXJ0QXQpKSwgdC5lbmRBdCAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkuZW5kQXQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9FbmRBdEN1cnNvcihlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBiZWZvcmU6ICFlLmluY2x1c2l2ZSxcbiAgICAgICAgICAgIHZhbHVlczogZS5wb3NpdGlvblxuICAgICAgICB9O1xuICAgIH0odC5lbmRBdCkpLCB7XG4gICAgICAgIF90OiBuLFxuICAgICAgICBwYXJlbnQ6IGlcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9SdW5BZ2dyZWdhdGlvblF1ZXJ5UmVxdWVzdChlLCB0LCBuLCByKSB7XG4gICAgY29uc3Qge190OiBpLCBwYXJlbnQ6IHN9ID0gX19QUklWQVRFX3RvUXVlcnlUYXJnZXQoZSwgdCksIG8gPSB7fSwgXyA9IFtdO1xuICAgIGxldCBhID0gMDtcbiAgICByZXR1cm4gbi5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgLy8gTWFwIGFsbCBjbGllbnQtc2lkZSBhbGlhc2VzIHRvIGEgdW5pcXVlIHNob3J0LWZvcm1cbiAgICAgICAgLy8gYWxpYXMuIFRoaXMgYXZvaWRzIGlzc3VlcyB3aXRoIGNsaWVudC1zaWRlIGFsaWFzZXMgdGhhdFxuICAgICAgICAvLyBleGNlZWQgdGhlIDE1MDAtYnl0ZSBzdHJpbmcgc2l6ZSBsaW1pdC5cbiAgICAgICAgY29uc3QgdCA9IHIgPyBlLmFsaWFzIDogXCJhZ2dyZWdhdGVfXCIgKyBhKys7XG4gICAgICAgIG9bdF0gPSBlLmFsaWFzLCBcImNvdW50XCIgPT09IGUuYWdncmVnYXRlVHlwZSA/IF8ucHVzaCh7XG4gICAgICAgICAgICBhbGlhczogdCxcbiAgICAgICAgICAgIGNvdW50OiB7fVxuICAgICAgICB9KSA6IFwiYXZnXCIgPT09IGUuYWdncmVnYXRlVHlwZSA/IF8ucHVzaCh7XG4gICAgICAgICAgICBhbGlhczogdCxcbiAgICAgICAgICAgIGF2Zzoge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZFBhdGgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pIDogXCJzdW1cIiA9PT0gZS5hZ2dyZWdhdGVUeXBlICYmIF8ucHVzaCh7XG4gICAgICAgICAgICBhbGlhczogdCxcbiAgICAgICAgICAgIHN1bToge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZFBhdGgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pKSwge1xuICAgICAgICByZXF1ZXN0OiB7XG4gICAgICAgICAgICBzdHJ1Y3R1cmVkQWdncmVnYXRpb25RdWVyeToge1xuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0aW9uczogXyxcbiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmVkUXVlcnk6IGkuc3RydWN0dXJlZFF1ZXJ5XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGFyZW50OiBpLnBhcmVudFxuICAgICAgICB9LFxuICAgICAgICB1dDogbyxcbiAgICAgICAgcGFyZW50OiBzXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbnZlcnRRdWVyeVRhcmdldFRvUXVlcnkoZSkge1xuICAgIGxldCB0ID0gX19QUklWQVRFX2Zyb21RdWVyeVBhdGgoZS5wYXJlbnQpO1xuICAgIGNvbnN0IG4gPSBlLnN0cnVjdHVyZWRRdWVyeSwgciA9IG4uZnJvbSA/IG4uZnJvbS5sZW5ndGggOiAwO1xuICAgIGxldCBpID0gbnVsbDtcbiAgICBpZiAociA+IDApIHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoMSA9PT0gcik7XG4gICAgICAgIGNvbnN0IGUgPSBuLmZyb21bMF07XG4gICAgICAgIGUuYWxsRGVzY2VuZGFudHMgPyBpID0gZS5jb2xsZWN0aW9uSWQgOiB0ID0gdC5jaGlsZChlLmNvbGxlY3Rpb25JZCk7XG4gICAgfVxuICAgIGxldCBzID0gW107XG4gICAgbi53aGVyZSAmJiAocyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRmlsdGVycyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbUZpbHRlcihlKTtcbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgJiYgX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdENvbmp1bmN0aW9uKHQpKSByZXR1cm4gdC5nZXRGaWx0ZXJzKCk7XG4gICAgICAgIHJldHVybiBbIHQgXTtcbiAgICB9KG4ud2hlcmUpKTtcbiAgICBsZXQgbyA9IFtdO1xuICAgIG4ub3JkZXJCeSAmJiAobyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tT3JkZXIoZSkge1xuICAgICAgICByZXR1cm4gZS5tYXAoKGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Qcm9wZXJ0eU9yZGVyKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgT3JkZXJCeShfX1BSSVZBVEVfZnJvbUZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSwgXG4gICAgICAgICAgICAvLyB2aXNpYmxlIGZvciB0ZXN0aW5nXG4gICAgICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURpcmVjdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICBjYXNlIFwiQVNDRU5ESU5HXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi87XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgXCJERVNDRU5ESU5HXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImRlc2NcIiAvKiBEaXJlY3Rpb24uREVTQ0VORElORyAqLztcblxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgICAgIChlLmRpcmVjdGlvbikpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgKGUpKSk7XG4gICAgfShuLm9yZGVyQnkpKTtcbiAgICBsZXQgXyA9IG51bGw7XG4gICAgbi5saW1pdCAmJiAoXyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tSW50MzJQcm90byhlKSB7XG4gICAgICAgIGxldCB0O1xuICAgICAgICByZXR1cm4gdCA9IFwib2JqZWN0XCIgPT0gdHlwZW9mIGUgPyBlLnZhbHVlIDogZSwgX19QUklWQVRFX2lzTnVsbE9yVW5kZWZpbmVkKHQpID8gbnVsbCA6IHQ7XG4gICAgfShuLmxpbWl0KSk7XG4gICAgbGV0IGEgPSBudWxsO1xuICAgIG4uc3RhcnRBdCAmJiAoYSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tU3RhcnRBdEN1cnNvcihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSAhIWUuYmVmb3JlLCBuID0gZS52YWx1ZXMgfHwgW107XG4gICAgICAgIHJldHVybiBuZXcgQm91bmQobiwgdCk7XG4gICAgfShuLnN0YXJ0QXQpKTtcbiAgICBsZXQgdSA9IG51bGw7XG4gICAgcmV0dXJuIG4uZW5kQXQgJiYgKHUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUVuZEF0Q3Vyc29yKGUpIHtcbiAgICAgICAgY29uc3QgdCA9ICFlLmJlZm9yZSwgbiA9IGUudmFsdWVzIHx8IFtdO1xuICAgICAgICByZXR1cm4gbmV3IEJvdW5kKG4sIHQpO1xuICAgIH1cbiAgICAvLyB2aXNpYmxlIGZvciB0ZXN0aW5nXG4gICAgKG4uZW5kQXQpKSwgX19QUklWQVRFX25ld1F1ZXJ5KHQsIGksIG8sIHMsIF8sIFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyAsIGEsIHUpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9MaXN0ZW5SZXF1ZXN0TGFiZWxzKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZnVuY3Rpb24gX19QUklWQVRFX3RvTGFiZWwoZSkge1xuICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICBjYXNlIFwiVGFyZ2V0UHVycG9zZUxpc3RlblwiIC8qIFRhcmdldFB1cnBvc2UuTGlzdGVuICovIDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgICAgY2FzZSBcIlRhcmdldFB1cnBvc2VFeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaFwiIC8qIFRhcmdldFB1cnBvc2UuRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2ggKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFwiZXhpc3RlbmNlLWZpbHRlci1taXNtYXRjaFwiO1xuXG4gICAgICAgICAgY2FzZSBcIlRhcmdldFB1cnBvc2VFeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaEJsb29tXCIgLyogVGFyZ2V0UHVycG9zZS5FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaEJsb29tICovIDpcbiAgICAgICAgICAgIHJldHVybiBcImV4aXN0ZW5jZS1maWx0ZXItbWlzbWF0Y2gtYmxvb21cIjtcblxuICAgICAgICAgIGNhc2UgXCJUYXJnZXRQdXJwb3NlTGltYm9SZXNvbHV0aW9uXCIgLyogVGFyZ2V0UHVycG9zZS5MaW1ib1Jlc29sdXRpb24gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFwibGltYm8tZG9jdW1lbnRcIjtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgICAgICB9XG4gICAgfSh0LnB1cnBvc2UpO1xuICAgIHJldHVybiBudWxsID09IG4gPyBudWxsIDoge1xuICAgICAgICBcImdvb2ctbGlzdGVuLXRhZ3NcIjogblxuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRmlsdGVyKGUpIHtcbiAgICByZXR1cm4gdm9pZCAwICE9PSBlLnVuYXJ5RmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21VbmFyeUZpbHRlcihlKSB7XG4gICAgICAgIHN3aXRjaCAoZS51bmFyeUZpbHRlci5vcCkge1xuICAgICAgICAgIGNhc2UgXCJJU19OQU5cIjpcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbUZpZWxkUGF0aFJlZmVyZW5jZShlLnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgICAgIHJldHVybiBGaWVsZEZpbHRlci5jcmVhdGUodCwgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovICwge1xuICAgICAgICAgICAgICAgIGRvdWJsZVZhbHVlOiBOYU5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY2FzZSBcIklTX05VTExcIjpcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZnJvbUZpZWxkUGF0aFJlZmVyZW5jZShlLnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgICAgIHJldHVybiBGaWVsZEZpbHRlci5jcmVhdGUobiwgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovICwge1xuICAgICAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY2FzZSBcIklTX05PVF9OQU5cIjpcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZnJvbUZpZWxkUGF0aFJlZmVyZW5jZShlLnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgICAgIHJldHVybiBGaWVsZEZpbHRlci5jcmVhdGUociwgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyAsIHtcbiAgICAgICAgICAgICAgICBkb3VibGVWYWx1ZTogTmFOXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNhc2UgXCJJU19OT1RfTlVMTFwiOlxuICAgICAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZShpLCBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovICwge1xuICAgICAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgIH1cbiAgICB9KGUpIDogdm9pZCAwICE9PSBlLmZpZWxkRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWVsZEZpbHRlcihlKSB7XG4gICAgICAgIHJldHVybiBGaWVsZEZpbHRlci5jcmVhdGUoX19QUklWQVRFX2Zyb21GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZEZpbHRlci5maWVsZCksIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tT3BlcmF0b3JOYW1lKGUpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZSkge1xuICAgICAgICAgICAgICBjYXNlIFwiRVFVQUxcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJOT1RfRVFVQUxcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiR1JFQVRFUl9USEFOXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiR1JFQVRFUl9USEFOX09SX0VRVUFMXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPj1cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkxFU1NfVEhBTlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIjxcIiAvKiBPcGVyYXRvci5MRVNTX1RIQU4gKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkxFU1NfVEhBTl9PUl9FUVVBTFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIjw9XCIgLyogT3BlcmF0b3IuTEVTU19USEFOX09SX0VRVUFMICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJBUlJBWV9DT05UQUlOU1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIklOXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiTk9UX0lOXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJBUlJBWV9DT05UQUlOU19BTllcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi87XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KGUuZmllbGRGaWx0ZXIub3ApLCBlLmZpZWxkRmlsdGVyLnZhbHVlKTtcbiAgICB9KGUpIDogdm9pZCAwICE9PSBlLmNvbXBvc2l0ZUZpbHRlciA/IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tQ29tcG9zaXRlRmlsdGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUoZS5jb21wb3NpdGVGaWx0ZXIuZmlsdGVycy5tYXAoKGUgPT4gX19QUklWQVRFX2Zyb21GaWx0ZXIoZSkpKSwgZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Db21wb3NpdGVPcGVyYXRvck5hbWUoZSkge1xuICAgICAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJBTkRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIk9SXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwib3JcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5PUiAqLztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oZS5jb21wb3NpdGVGaWx0ZXIub3ApKTtcbiAgICB9KGUpIDogZmFpbCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9EaXJlY3Rpb24oZSkge1xuICAgIHJldHVybiBUZVtlXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvT3BlcmF0b3JOYW1lKGUpIHtcbiAgICByZXR1cm4gRWVbZV07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0NvbXBvc2l0ZU9wZXJhdG9yTmFtZShlKSB7XG4gICAgcmV0dXJuIGRlW2VdO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGZpZWxkUGF0aDogZS5jYW5vbmljYWxTdHJpbmcoKVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUpIHtcbiAgICByZXR1cm4gRmllbGRQYXRoJDEuZnJvbVNlcnZlckZvcm1hdChlLmZpZWxkUGF0aCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0ZpbHRlcihlKSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciA/IGZ1bmN0aW9uIF9fUFJJVkFURV90b1VuYXJ5T3JGaWVsZEZpbHRlcihlKSB7XG4gICAgICAgIGlmIChcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gPT09IGUub3ApIHtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfaXNOYW5WYWx1ZShlLnZhbHVlKSkgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB1bmFyeUZpbHRlcjoge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogX19QUklWQVRFX3RvRmllbGRQYXRoUmVmZXJlbmNlKGUuZmllbGQpLFxuICAgICAgICAgICAgICAgICAgICBvcDogXCJJU19OQU5cIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2lzTnVsbFZhbHVlKGUudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVuYXJ5RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05VTExcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSBpZiAoXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA9PT0gZS5vcCkge1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9pc05hblZhbHVlKGUudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVuYXJ5RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05PVF9OQU5cIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2lzTnVsbFZhbHVlKGUudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVuYXJ5RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05PVF9OVUxMXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZEZpbHRlcjoge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgb3A6IF9fUFJJVkFURV90b09wZXJhdG9yTmFtZShlLm9wKSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogZS52YWx1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0oZSkgOiBlIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX3RvQ29tcG9zaXRlRmlsdGVyKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZ2V0RmlsdGVycygpLm1hcCgoZSA9PiBfX1BSSVZBVEVfdG9GaWx0ZXIoZSkpKTtcbiAgICAgICAgaWYgKDEgPT09IHQubGVuZ3RoKSByZXR1cm4gdFswXTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBvc2l0ZUZpbHRlcjoge1xuICAgICAgICAgICAgICAgIG9wOiBfX1BSSVZBVEVfdG9Db21wb3NpdGVPcGVyYXRvck5hbWUoZS5vcCksXG4gICAgICAgICAgICAgICAgZmlsdGVyczogdFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0oZSkgOiBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0RvY3VtZW50TWFzayhlKSB7XG4gICAgY29uc3QgdCA9IFtdO1xuICAgIHJldHVybiBlLmZpZWxkcy5mb3JFYWNoKChlID0+IHQucHVzaChlLmNhbm9uaWNhbFN0cmluZygpKSkpLCB7XG4gICAgICAgIGZpZWxkUGF0aHM6IHRcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfaXNWYWxpZFJlc291cmNlTmFtZShlKSB7XG4gICAgLy8gUmVzb3VyY2UgbmFtZXMgaGF2ZSBhdCBsZWFzdCA0IGNvbXBvbmVudHMgKHByb2plY3QgSUQsIGRhdGFiYXNlIElEKVxuICAgIHJldHVybiBlLmxlbmd0aCA+PSA0ICYmIFwicHJvamVjdHNcIiA9PT0gZS5nZXQoMCkgJiYgXCJkYXRhYmFzZXNcIiA9PT0gZS5nZXQoMik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGltbXV0YWJsZSBzZXQgb2YgbWV0YWRhdGEgdGhhdCB0aGUgbG9jYWwgc3RvcmUgdHJhY2tzIGZvciBlYWNoIHRhcmdldC5cbiAqLyBjbGFzcyBUYXJnZXREYXRhIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIHRhcmdldCBiZWluZyBsaXN0ZW5lZCB0by4gKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgdGFyZ2V0IElEIHRvIHdoaWNoIHRoZSB0YXJnZXQgY29ycmVzcG9uZHM7IEFzc2lnbmVkIGJ5IHRoZVxuICAgICAqIExvY2FsU3RvcmUgZm9yIHVzZXIgbGlzdGVucyBhbmQgYnkgdGhlIFN5bmNFbmdpbmUgZm9yIGxpbWJvIHdhdGNoZXMuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqIFRoZSBwdXJwb3NlIG9mIHRoZSB0YXJnZXQuICovXG4gICAgbiwgXG4gICAgLyoqXG4gICAgICogVGhlIHNlcXVlbmNlIG51bWJlciBvZiB0aGUgbGFzdCB0cmFuc2FjdGlvbiBkdXJpbmcgd2hpY2ggdGhpcyB0YXJnZXQgZGF0YVxuICAgICAqIHdhcyBtb2RpZmllZC5cbiAgICAgKi9cbiAgICByLCBcbiAgICAvKiogVGhlIGxhdGVzdCBzbmFwc2hvdCB2ZXJzaW9uIHNlZW4gZm9yIHRoaXMgdGFyZ2V0LiAqL1xuICAgIGkgPSBTbmFwc2hvdFZlcnNpb24ubWluKClcbiAgICAvKipcbiAgICAgKiBUaGUgbWF4aW11bSBzbmFwc2hvdCB2ZXJzaW9uIGF0IHdoaWNoIHRoZSBhc3NvY2lhdGVkIHZpZXdcbiAgICAgKiBjb250YWluZWQgbm8gbGltYm8gZG9jdW1lbnRzLlxuICAgICAqLyAsIHMgPSBTbmFwc2hvdFZlcnNpb24ubWluKClcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHRhcmdldCB0byBiZVxuICAgICAqIHJlc3VtZWQgYWZ0ZXIgZGlzY29ubmVjdGluZyB3aXRob3V0IHJldHJhbnNtaXR0aW5nIGFsbCB0aGUgZGF0YSB0aGF0XG4gICAgICogbWF0Y2hlcyB0aGUgdGFyZ2V0LiBUaGUgcmVzdW1lIHRva2VuIGVzc2VudGlhbGx5IGlkZW50aWZpZXMgYSBwb2ludCBpblxuICAgICAqIHRpbWUgZnJvbSB3aGljaCB0aGUgc2VydmVyIHNob3VsZCByZXN1bWUgc2VuZGluZyByZXN1bHRzLlxuICAgICAqLyAsIG8gPSBCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HXG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBkb2N1bWVudHMgdGhhdCBsYXN0IG1hdGNoZWQgdGhlIHF1ZXJ5IGF0IHRoZSByZXN1bWUgdG9rZW4gb3JcbiAgICAgKiByZWFkIHRpbWUuIERvY3VtZW50cyBhcmUgY291bnRlZCBvbmx5IHdoZW4gbWFraW5nIGEgbGlzdGVuIHJlcXVlc3Qgd2l0aFxuICAgICAqIHJlc3VtZSB0b2tlbiBvciByZWFkIHRpbWUsIG90aGVyd2lzZSwga2VlcCBpdCBudWxsLlxuICAgICAqLyAsIF8gPSBudWxsKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0ID0gZSwgdGhpcy50YXJnZXRJZCA9IHQsIHRoaXMucHVycG9zZSA9IG4sIHRoaXMuc2VxdWVuY2VOdW1iZXIgPSByLCB0aGlzLnNuYXBzaG90VmVyc2lvbiA9IGksIFxuICAgICAgICB0aGlzLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24gPSBzLCB0aGlzLnJlc3VtZVRva2VuID0gbywgdGhpcy5leHBlY3RlZENvdW50ID0gXztcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IGRhdGEgaW5zdGFuY2Ugd2l0aCBhbiB1cGRhdGVkIHNlcXVlbmNlIG51bWJlci4gKi8gICAgd2l0aFNlcXVlbmNlTnVtYmVyKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXREYXRhKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldElkLCB0aGlzLnB1cnBvc2UsIGUsIHRoaXMuc25hcHNob3RWZXJzaW9uLCB0aGlzLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24sIHRoaXMucmVzdW1lVG9rZW4sIHRoaXMuZXhwZWN0ZWRDb3VudCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IGRhdGEgaW5zdGFuY2Ugd2l0aCBhbiB1cGRhdGVkIHJlc3VtZSB0b2tlbiBhbmRcbiAgICAgKiBzbmFwc2hvdCB2ZXJzaW9uLlxuICAgICAqLyAgICB3aXRoUmVzdW1lVG9rZW4oZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IFRhcmdldERhdGEodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgdGhpcy5zZXF1ZW5jZU51bWJlciwgdCwgdGhpcy5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uLCBlLCBcbiAgICAgICAgLyogZXhwZWN0ZWRDb3VudD0gKi8gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IGRhdGEgaW5zdGFuY2Ugd2l0aCBhbiB1cGRhdGVkIGV4cGVjdGVkIGNvdW50LlxuICAgICAqLyAgICB3aXRoRXhwZWN0ZWRDb3VudChlKSB7XG4gICAgICAgIHJldHVybiBuZXcgVGFyZ2V0RGF0YSh0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRJZCwgdGhpcy5wdXJwb3NlLCB0aGlzLnNlcXVlbmNlTnVtYmVyLCB0aGlzLnNuYXBzaG90VmVyc2lvbiwgdGhpcy5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uLCB0aGlzLnJlc3VtZVRva2VuLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgZGF0YSBpbnN0YW5jZSB3aXRoIGFuIHVwZGF0ZWQgbGFzdCBsaW1ibyBmcmVlXG4gICAgICogc25hcHNob3QgdmVyc2lvbiBudW1iZXIuXG4gICAgICovICAgIHdpdGhMYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXREYXRhKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldElkLCB0aGlzLnB1cnBvc2UsIHRoaXMuc2VxdWVuY2VOdW1iZXIsIHRoaXMuc25hcHNob3RWZXJzaW9uLCBlLCB0aGlzLnJlc3VtZVRva2VuLCB0aGlzLmV4cGVjdGVkQ291bnQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBTZXJpYWxpemVyIGZvciB2YWx1ZXMgc3RvcmVkIGluIHRoZSBMb2NhbFN0b3JlLiAqLyBjbGFzcyBfX1BSSVZBVEVfTG9jYWxTZXJpYWxpemVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuY3QgPSBlO1xuICAgIH1cbn1cblxuLyoqIERlY29kZXMgYSByZW1vdGUgZG9jdW1lbnQgZnJvbSBzdG9yYWdlIGxvY2FsbHkgdG8gYSBEb2N1bWVudC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21EYlJlbW90ZURvY3VtZW50KGUsIHQpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAodC5kb2N1bWVudCkgbiA9IF9fUFJJVkFURV9mcm9tRG9jdW1lbnQoZS5jdCwgdC5kb2N1bWVudCwgISF0Lmhhc0NvbW1pdHRlZE11dGF0aW9ucyk7IGVsc2UgaWYgKHQubm9Eb2N1bWVudCkge1xuICAgICAgICBjb25zdCBlID0gRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKHQubm9Eb2N1bWVudC5wYXRoKSwgciA9IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAodC5ub0RvY3VtZW50LnJlYWRUaW1lKTtcbiAgICAgICAgbiA9IE11dGFibGVEb2N1bWVudC5uZXdOb0RvY3VtZW50KGUsIHIpLCB0Lmhhc0NvbW1pdHRlZE11dGF0aW9ucyAmJiBuLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghdC51bmtub3duRG9jdW1lbnQpIHJldHVybiBmYWlsKCk7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBEb2N1bWVudEtleS5mcm9tU2VnbWVudHModC51bmtub3duRG9jdW1lbnQucGF0aCksIHIgPSBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wKHQudW5rbm93bkRvY3VtZW50LnZlcnNpb24pO1xuICAgICAgICAgICAgbiA9IE11dGFibGVEb2N1bWVudC5uZXdVbmtub3duRG9jdW1lbnQoZSwgcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHQucmVhZFRpbWUgJiYgbi5zZXRSZWFkVGltZShmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wS2V5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBUaW1lc3RhbXAoZVswXSwgZVsxXSk7XG4gICAgICAgIHJldHVybiBTbmFwc2hvdFZlcnNpb24uZnJvbVRpbWVzdGFtcCh0KTtcbiAgICB9KHQucmVhZFRpbWUpKSwgbjtcbn1cblxuLyoqIEVuY29kZXMgYSBkb2N1bWVudCBmb3Igc3RvcmFnZSBsb2NhbGx5LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYlJlbW90ZURvY3VtZW50KGUsIHQpIHtcbiAgICBjb25zdCBuID0gdC5rZXksIHIgPSB7XG4gICAgICAgIHByZWZpeFBhdGg6IG4uZ2V0Q29sbGVjdGlvblBhdGgoKS5wb3BMYXN0KCkudG9BcnJheSgpLFxuICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IG4uY29sbGVjdGlvbkdyb3VwLFxuICAgICAgICBkb2N1bWVudElkOiBuLnBhdGgubGFzdFNlZ21lbnQoKSxcbiAgICAgICAgcmVhZFRpbWU6IF9fUFJJVkFURV90b0RiVGltZXN0YW1wS2V5KHQucmVhZFRpbWUpLFxuICAgICAgICBoYXNDb21taXR0ZWRNdXRhdGlvbnM6IHQuaGFzQ29tbWl0dGVkTXV0YXRpb25zXG4gICAgfTtcbiAgICBpZiAodC5pc0ZvdW5kRG9jdW1lbnQoKSkgci5kb2N1bWVudCA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b0RvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IF9fUFJJVkFURV90b05hbWUoZSwgdC5rZXkpLFxuICAgICAgICAgICAgZmllbGRzOiB0LmRhdGEudmFsdWUubWFwVmFsdWUuZmllbGRzLFxuICAgICAgICAgICAgdXBkYXRlVGltZTogdG9UaW1lc3RhbXAoZSwgdC52ZXJzaW9uLnRvVGltZXN0YW1wKCkpLFxuICAgICAgICAgICAgY3JlYXRlVGltZTogdG9UaW1lc3RhbXAoZSwgdC5jcmVhdGVUaW1lLnRvVGltZXN0YW1wKCkpXG4gICAgICAgIH07XG4gICAgfShlLmN0LCB0KTsgZWxzZSBpZiAodC5pc05vRG9jdW1lbnQoKSkgci5ub0RvY3VtZW50ID0ge1xuICAgICAgICBwYXRoOiBuLnBhdGgudG9BcnJheSgpLFxuICAgICAgICByZWFkVGltZTogX19QUklWQVRFX3RvRGJUaW1lc3RhbXAodC52ZXJzaW9uKVxuICAgIH07IGVsc2Uge1xuICAgICAgICBpZiAoIXQuaXNVbmtub3duRG9jdW1lbnQoKSkgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgci51bmtub3duRG9jdW1lbnQgPSB7XG4gICAgICAgICAgICBwYXRoOiBuLnBhdGgudG9BcnJheSgpLFxuICAgICAgICAgICAgdmVyc2lvbjogX19QUklWQVRFX3RvRGJUaW1lc3RhbXAodC52ZXJzaW9uKVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gcjtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRGJUaW1lc3RhbXBLZXkoZSkge1xuICAgIGNvbnN0IHQgPSBlLnRvVGltZXN0YW1wKCk7XG4gICAgcmV0dXJuIFsgdC5zZWNvbmRzLCB0Lm5hbm9zZWNvbmRzIF07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0RiVGltZXN0YW1wKGUpIHtcbiAgICBjb25zdCB0ID0gZS50b1RpbWVzdGFtcCgpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHNlY29uZHM6IHQuc2Vjb25kcyxcbiAgICAgICAgbmFub3NlY29uZHM6IHQubmFub3NlY29uZHNcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wKGUpIHtcbiAgICBjb25zdCB0ID0gbmV3IFRpbWVzdGFtcChlLnNlY29uZHMsIGUubmFub3NlY29uZHMpO1xuICAgIHJldHVybiBTbmFwc2hvdFZlcnNpb24uZnJvbVRpbWVzdGFtcCh0KTtcbn1cblxuLyoqIEVuY29kZXMgYSBiYXRjaCBvZiBtdXRhdGlvbnMgaW50byBhIERiTXV0YXRpb25CYXRjaCBmb3IgbG9jYWwgc3RvcmFnZS4gKi9cbi8qKiBEZWNvZGVzIGEgRGJNdXRhdGlvbkJhdGNoIGludG8gYSBNdXRhdGlvbkJhdGNoICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaChlLCB0KSB7XG4gICAgY29uc3QgbiA9ICh0LmJhc2VNdXRhdGlvbnMgfHwgW10pLm1hcCgodCA9PiBfX1BSSVZBVEVfZnJvbU11dGF0aW9uKGUuY3QsIHQpKSk7XG4gICAgLy8gU3F1YXNoIG9sZCB0cmFuc2Zvcm0gbXV0YXRpb25zIGludG8gZXhpc3RpbmcgcGF0Y2ggb3Igc2V0IG11dGF0aW9ucy5cbiAgICAvLyBUaGUgcmVwbGFjZW1lbnQgb2YgcmVwcmVzZW50aW5nIGB0cmFuc2Zvcm1zYCB3aXRoIGB1cGRhdGVfdHJhbnNmb3Jtc2BcbiAgICAvLyBvbiB0aGUgU0RLIG1lYW5zIHRoYXQgb2xkIGB0cmFuc2Zvcm1gIG11dGF0aW9ucyBzdG9yZWQgaW4gSW5kZXhlZERCIG5lZWRcbiAgICAvLyB0byBiZSB1cGRhdGVkIHRvIGB1cGRhdGVfdHJhbnNmb3Jtc2AuXG4gICAgLy8gVE9ETyhiLzE3NDYwODM3NCk6IFJlbW92ZSB0aGlzIGNvZGUgb25jZSB3ZSBwZXJmb3JtIGEgc2NoZW1hIG1pZ3JhdGlvbi5cbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0Lm11dGF0aW9ucy5sZW5ndGggLSAxOyArK2UpIHtcbiAgICAgICAgY29uc3QgbiA9IHQubXV0YXRpb25zW2VdO1xuICAgICAgICBpZiAoZSArIDEgPCB0Lm11dGF0aW9ucy5sZW5ndGggJiYgdm9pZCAwICE9PSB0Lm11dGF0aW9uc1tlICsgMV0udHJhbnNmb3JtKSB7XG4gICAgICAgICAgICBjb25zdCByID0gdC5tdXRhdGlvbnNbZSArIDFdO1xuICAgICAgICAgICAgbi51cGRhdGVUcmFuc2Zvcm1zID0gci50cmFuc2Zvcm0uZmllbGRUcmFuc2Zvcm1zLCB0Lm11dGF0aW9ucy5zcGxpY2UoZSArIDEsIDEpLCBcbiAgICAgICAgICAgICsrZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCByID0gdC5tdXRhdGlvbnMubWFwKCh0ID0+IF9fUFJJVkFURV9mcm9tTXV0YXRpb24oZS5jdCwgdCkpKSwgaSA9IFRpbWVzdGFtcC5mcm9tTWlsbGlzKHQubG9jYWxXcml0ZVRpbWVNcyk7XG4gICAgcmV0dXJuIG5ldyBNdXRhdGlvbkJhdGNoKHQuYmF0Y2hJZCwgaSwgbiwgcik7XG59XG5cbi8qKiBEZWNvZGVzIGEgRGJUYXJnZXQgaW50byBUYXJnZXREYXRhICovIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJUYXJnZXQoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wKGUucmVhZFRpbWUpLCBuID0gdm9pZCAwICE9PSBlLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24gPyBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wKGUubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbikgOiBTbmFwc2hvdFZlcnNpb24ubWluKCk7XG4gICAgbGV0IHI7XG4gICAgcmV0dXJuIHIgPSBcbiAgICAvKipcbiAqIEEgaGVscGVyIGZ1bmN0aW9uIGZvciBmaWd1cmluZyBvdXQgd2hhdCBraW5kIG9mIHF1ZXJ5IGhhcyBiZWVuIHN0b3JlZC5cbiAqL1xuICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9pc0RvY3VtZW50UXVlcnkoZSkge1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBlLmRvY3VtZW50cztcbiAgICB9XG4gICAgLyoqIEVuY29kZXMgYSBEYkJ1bmRsZSB0byBhIEJ1bmRsZU1ldGFkYXRhIG9iamVjdC4gKi8gKGUucXVlcnkpID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Eb2N1bWVudHNUYXJnZXQoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2hhcmRBc3NlcnQoMSA9PT0gZS5kb2N1bWVudHMubGVuZ3RoKSwgX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoX19QUklWQVRFX25ld1F1ZXJ5Rm9yUGF0aChfX1BSSVZBVEVfZnJvbVF1ZXJ5UGF0aChlLmRvY3VtZW50c1swXSkpKTtcbiAgICB9KGUucXVlcnkpIDogZnVuY3Rpb24gX19QUklWQVRFX2Zyb21RdWVyeVRhcmdldChlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChfX1BSSVZBVEVfY29udmVydFF1ZXJ5VGFyZ2V0VG9RdWVyeShlKSk7XG4gICAgfShlLnF1ZXJ5KSwgbmV3IFRhcmdldERhdGEociwgZS50YXJnZXRJZCwgXCJUYXJnZXRQdXJwb3NlTGlzdGVuXCIgLyogVGFyZ2V0UHVycG9zZS5MaXN0ZW4gKi8gLCBlLmxhc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciwgdCwgbiwgQnl0ZVN0cmluZy5mcm9tQmFzZTY0U3RyaW5nKGUucmVzdW1lVG9rZW4pKTtcbn1cblxuLyoqIEVuY29kZXMgVGFyZ2V0RGF0YSBpbnRvIGEgRGJUYXJnZXQgZm9yIHN0b3JhZ2UgbG9jYWxseS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RvRGJUYXJnZXQoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcCh0LnNuYXBzaG90VmVyc2lvbiksIHIgPSBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcCh0Lmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24pO1xuICAgIGxldCBpO1xuICAgIGkgPSBfX1BSSVZBVEVfdGFyZ2V0SXNEb2N1bWVudFRhcmdldCh0LnRhcmdldCkgPyBfX1BSSVZBVEVfdG9Eb2N1bWVudHNUYXJnZXQoZS5jdCwgdC50YXJnZXQpIDogX19QUklWQVRFX3RvUXVlcnlUYXJnZXQoZS5jdCwgdC50YXJnZXQpLl90O1xuICAgIC8vIFdlIGNhbid0IHN0b3JlIHRoZSByZXN1bWVUb2tlbiBhcyBhIEJ5dGVTdHJpbmcgaW4gSW5kZXhlZERiLCBzbyB3ZVxuICAgIC8vIGNvbnZlcnQgaXQgdG8gYSBiYXNlNjQgc3RyaW5nIGZvciBzdG9yYWdlLlxuICAgICAgICBjb25zdCBzID0gdC5yZXN1bWVUb2tlbi50b0Jhc2U2NCgpO1xuICAgIC8vIGxhc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciBpcyBhbHdheXMgMCB1bnRpbCB3ZSBkbyByZWFsIEdDLlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICB0YXJnZXRJZDogdC50YXJnZXRJZCxcbiAgICAgICAgY2Fub25pY2FsSWQ6IF9fUFJJVkFURV9jYW5vbmlmeVRhcmdldCh0LnRhcmdldCksXG4gICAgICAgIHJlYWRUaW1lOiBuLFxuICAgICAgICByZXN1bWVUb2tlbjogcyxcbiAgICAgICAgbGFzdExpc3RlblNlcXVlbmNlTnVtYmVyOiB0LnNlcXVlbmNlTnVtYmVyLFxuICAgICAgICBsYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uOiByLFxuICAgICAgICBxdWVyeTogaVxuICAgIH07XG59XG5cbi8qKlxuICogRW5jb2RlcyBhIGBCdW5kbGVkUXVlcnlgIGZyb20gYnVuZGxlIHByb3RvIHRvIGEgUXVlcnkgb2JqZWN0LlxuICpcbiAqIFRoaXMgcmVjb25zdHJ1Y3RzIHRoZSBvcmlnaW5hbCBxdWVyeSB1c2VkIHRvIGJ1aWxkIHRoZSBidW5kbGUgYmVpbmcgbG9hZGVkLFxuICogaW5jbHVkaW5nIGZlYXR1cmVzIGV4aXN0cyBvbmx5IGluIFNES3MgKGZvciBleGFtcGxlOiBsaW1pdC10by1sYXN0KS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21CdW5kbGVkUXVlcnkoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY29udmVydFF1ZXJ5VGFyZ2V0VG9RdWVyeSh7XG4gICAgICAgIHBhcmVudDogZS5wYXJlbnQsXG4gICAgICAgIHN0cnVjdHVyZWRRdWVyeTogZS5zdHJ1Y3R1cmVkUXVlcnlcbiAgICB9KTtcbiAgICByZXR1cm4gXCJMQVNUXCIgPT09IGUubGltaXRUeXBlID8gX19QUklWQVRFX3F1ZXJ5V2l0aExpbWl0KHQsIHQubGltaXQsIFwiTFwiIC8qIExpbWl0VHlwZS5MYXN0ICovKSA6IHQ7XG59XG5cbi8qKiBFbmNvZGVzIGEgTmFtZWRRdWVyeSBwcm90byBvYmplY3QgdG8gYSBOYW1lZFF1ZXJ5IG1vZGVsIG9iamVjdC4gKi9cbi8qKiBFbmNvZGVzIGEgRGJEb2N1bWVudE92ZXJsYXkgb2JqZWN0IHRvIGFuIE92ZXJsYXkgbW9kZWwgb2JqZWN0LiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21EYkRvY3VtZW50T3ZlcmxheShlLCB0KSB7XG4gICAgcmV0dXJuIG5ldyBPdmVybGF5KHQubGFyZ2VzdEJhdGNoSWQsIF9fUFJJVkFURV9mcm9tTXV0YXRpb24oZS5jdCwgdC5vdmVybGF5TXV0YXRpb24pKTtcbn1cblxuLyoqIERlY29kZXMgYW4gT3ZlcmxheSBtb2RlbCBvYmplY3QgaW50byBhIERiRG9jdW1lbnRPdmVybGF5IG9iamVjdC4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgRGJEb2N1bWVudE92ZXJsYXlLZXkgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gdXNlciBhbmRcbiAqIGRvY3VtZW50IGtleS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3RvRGJEb2N1bWVudE92ZXJsYXlLZXkoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICByZXR1cm4gWyBlLCBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHQucGF0aC5wb3BMYXN0KCkpLCBuIF07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0RiSW5kZXhTdGF0ZShlLCB0LCBuLCByKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5kZXhJZDogZSxcbiAgICAgICAgdWlkOiB0LFxuICAgICAgICBzZXF1ZW5jZU51bWJlcjogbixcbiAgICAgICAgcmVhZFRpbWU6IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKHIucmVhZFRpbWUpLFxuICAgICAgICBkb2N1bWVudEtleTogX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChyLmRvY3VtZW50S2V5LnBhdGgpLFxuICAgICAgICBsYXJnZXN0QmF0Y2hJZDogci5sYXJnZXN0QmF0Y2hJZFxuICAgIH07XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJCdW5kbGVDYWNoZSB7XG4gICAgZ2V0QnVuZGxlTWV0YWRhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2J1bmRsZXNTdG9yZShlKS5nZXQodCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBpZiAoZSkgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJCdW5kbGUoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBlLmJ1bmRsZUlkLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVUaW1lOiBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wKGUuY3JlYXRlVGltZSksXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb246IGUudmVyc2lvblxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKiogRW5jb2RlcyBhIEJ1bmRsZU1ldGFkYXRhIHRvIGEgRGJCdW5kbGUuICovIChlKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzYXZlQnVuZGxlTWV0YWRhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2J1bmRsZXNTdG9yZShlKS5wdXQoZnVuY3Rpb24gX19QUklWQVRFX3RvRGJCdW5kbGUoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBidW5kbGVJZDogZS5pZCxcbiAgICAgICAgICAgICAgICBjcmVhdGVUaW1lOiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcChfX1BSSVZBVEVfZnJvbVZlcnNpb24oZS5jcmVhdGVUaW1lKSksXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogZS52ZXJzaW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8qKiBFbmNvZGVzIGEgRGJOYW1lZFF1ZXJ5IHRvIGEgTmFtZWRRdWVyeS4gKi8gKHQpKTtcbiAgICB9XG4gICAgZ2V0TmFtZWRRdWVyeShlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbmFtZWRRdWVyaWVzU3RvcmUoZSkuZ2V0KHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUpIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiTmFtZWRRdWVyeShlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBxdWVyeTogX19QUklWQVRFX2Zyb21CdW5kbGVkUXVlcnkoZS5idW5kbGVkUXVlcnkpLFxuICAgICAgICAgICAgICAgICAgICByZWFkVGltZTogX19QUklWQVRFX2Zyb21EYlRpbWVzdGFtcChlLnJlYWRUaW1lKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKiogRW5jb2RlcyBhIE5hbWVkUXVlcnkgZnJvbSBhIGJ1bmRsZSBwcm90byB0byBhIERiTmFtZWRRdWVyeS4gKi8gKGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNhdmVOYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9uYW1lZFF1ZXJpZXNTdG9yZShlKS5wdXQoZnVuY3Rpb24gX19QUklWQVRFX3RvRGJOYW1lZFF1ZXJ5KGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbmFtZTogZS5uYW1lLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcChfX1BSSVZBVEVfZnJvbVZlcnNpb24oZS5yZWFkVGltZSkpLFxuICAgICAgICAgICAgICAgIGJ1bmRsZWRRdWVyeTogZS5idW5kbGVkUXVlcnlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0odCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGJ1bmRsZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9idW5kbGVzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJidW5kbGVzXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgbmFtZWRRdWVyaWVzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmFtZWRRdWVyaWVzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJuYW1lZFF1ZXJpZXNcIik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIERvY3VtZW50T3ZlcmxheUNhY2hlIHVzaW5nIEluZGV4ZWREYi5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiRG9jdW1lbnRPdmVybGF5Q2FjaGUge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIGRvY3VtZW50IHNlcmlhbGl6ZXIuXG4gICAgICogQHBhcmFtIHVzZXJJZCAtIFRoZSB1c2VySWQgZm9yIHdoaWNoIHdlIGFyZSBhY2Nlc3Npbmcgb3ZlcmxheXMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBlLCB0aGlzLnVzZXJJZCA9IHQ7XG4gICAgfVxuICAgIHN0YXRpYyBsdChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnVpZCB8fCBcIlwiO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJEb2N1bWVudE92ZXJsYXlDYWNoZShlLCBuKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheShlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRPdmVybGF5U3RvcmUoZSkuZ2V0KF9fUFJJVkFURV90b0RiRG9jdW1lbnRPdmVybGF5S2V5KHRoaXMudXNlcklkLCB0KSkubmV4dCgoZSA9PiBlID8gX19QUklWQVRFX2Zyb21EYkRvY3VtZW50T3ZlcmxheSh0aGlzLnNlcmlhbGl6ZXIsIGUpIDogbnVsbCkpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKHQgPT4gdGhpcy5nZXRPdmVybGF5KGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgbnVsbCAhPT0gZSAmJiBuLnNldCh0LCBlKTtcbiAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBzYXZlT3ZlcmxheXMoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKChuLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gbmV3IE92ZXJsYXkodCwgaSk7XG4gICAgICAgICAgICByLnB1c2godGhpcy5odChlLCBzKSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3Iocik7XG4gICAgfVxuICAgIHJlbW92ZU92ZXJsYXlzRm9yQmF0Y2hJZChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgU2V0O1xuICAgICAgICAvLyBHZXQgdGhlIHNldCBvZiB1bmlxdWUgY29sbGVjdGlvbiBwYXRocy5cbiAgICAgICAgICAgICAgICB0LmZvckVhY2goKGUgPT4gci5hZGQoX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlLmdldENvbGxlY3Rpb25QYXRoKCkpKSkpO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiByLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIHQsIG4gXSwgWyB0aGlzLnVzZXJJZCwgdCwgbiArIDEgXSwgXG4gICAgICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgICAgICBpLnB1c2goX19QUklWQVRFX2RvY3VtZW50T3ZlcmxheVN0b3JlKGUpLmooXCJjb2xsZWN0aW9uUGF0aE92ZXJsYXlJbmRleFwiLCByKSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IoaSk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpLCBpID0gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0KSwgcyA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIGksIG4gXSwgWyB0aGlzLnVzZXJJZCwgaSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRPdmVybGF5U3RvcmUoZSkuVShcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIHMpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX2Zyb21EYkRvY3VtZW50T3ZlcmxheSh0aGlzLnNlcmlhbGl6ZXIsIHQpO1xuICAgICAgICAgICAgICAgIHIuc2V0KGUuZ2V0S2V5KCksIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAoZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKTtcbiAgICAgICAgbGV0IHM7XG4gICAgICAgIC8vIFdlIHdhbnQgYmF0Y2ggSURzIGxhcmdlciB0aGFuIGBzaW5jZUJhdGNoSWRgLCBhbmQgc28gdGhlIGxvd2VyIGJvdW5kXG4gICAgICAgIC8vIGlzIG5vdCBpbmNsdXNpdmUuXG4gICAgICAgICAgICAgICAgY29uc3QgbyA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIHQsIG4gXSwgWyB0aGlzLnVzZXJJZCwgdCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRPdmVybGF5U3RvcmUoZSkuSih7XG4gICAgICAgICAgICBpbmRleDogXCJjb2xsZWN0aW9uR3JvdXBPdmVybGF5SW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiBvXG4gICAgICAgIH0sICgoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgLy8gV2UgZG8gbm90IHdhbnQgdG8gcmV0dXJuIHBhcnRpYWwgYmF0Y2ggb3ZlcmxheXMsIGV2ZW4gaWYgdGhlIHNpemVcbiAgICAgICAgICAgIC8vIG9mIHRoZSByZXN1bHQgc2V0IGV4Y2VlZHMgdGhlIGdpdmVuIGBjb3VudGAgYXJndW1lbnQuIFRoZXJlZm9yZSwgd2VcbiAgICAgICAgICAgIC8vIGNvbnRpbnVlIHRvIGFnZ3JlZ2F0ZSByZXN1bHRzIGV2ZW4gYWZ0ZXIgdGhlIHJlc3VsdCBzaXplIGV4Y2VlZHNcbiAgICAgICAgICAgIC8vIGBjb3VudGAgaWYgdGhlcmUgYXJlIG1vcmUgb3ZlcmxheXMgZnJvbSB0aGUgYGN1cnJlbnRCYXRjaElkYC5cbiAgICAgICAgICAgIGNvbnN0IG8gPSBfX1BSSVZBVEVfZnJvbURiRG9jdW1lbnRPdmVybGF5KHRoaXMuc2VyaWFsaXplciwgdCk7XG4gICAgICAgICAgICBpLnNpemUoKSA8IHIgfHwgby5sYXJnZXN0QmF0Y2hJZCA9PT0gcyA/IChpLnNldChvLmdldEtleSgpLCBvKSwgcyA9IG8ubGFyZ2VzdEJhdGNoSWQpIDogbi5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIGh0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE92ZXJsYXlTdG9yZShlKS5wdXQoZnVuY3Rpb24gX19QUklWQVRFX3RvRGJEb2N1bWVudE92ZXJsYXkoZSwgdCwgbikge1xuICAgICAgICAgICAgY29uc3QgW3IsIGksIHNdID0gX19QUklWQVRFX3RvRGJEb2N1bWVudE92ZXJsYXlLZXkodCwgbi5tdXRhdGlvbi5rZXkpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHQsXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvblBhdGg6IGksXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRJZDogcyxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IG4ubXV0YXRpb24ua2V5LmdldENvbGxlY3Rpb25Hcm91cCgpLFxuICAgICAgICAgICAgICAgIGxhcmdlc3RCYXRjaElkOiBuLmxhcmdlc3RCYXRjaElkLFxuICAgICAgICAgICAgICAgIG92ZXJsYXlNdXRhdGlvbjogdG9NdXRhdGlvbihlLmN0LCBuLm11dGF0aW9uKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0aGlzLnNlcmlhbGl6ZXIsIHRoaXMudXNlcklkLCB0KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgZG9jdW1lbnQgb3ZlcmxheSBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50T3ZlcmxheVN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwiZG9jdW1lbnRPdmVybGF5c1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjQgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYkdsb2JhbHNDYWNoZSB7XG4gICAgUHQoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwiZ2xvYmFsc1wiKTtcbiAgICB9XG4gICAgZ2V0U2Vzc2lvblRva2VuKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUHQoZSkuZ2V0KFwic2Vzc2lvblRva2VuXCIpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IG51bGwgPT0gZSA/IHZvaWQgMCA6IGUudmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdCA/IEJ5dGVTdHJpbmcuZnJvbVVpbnQ4QXJyYXkodCkgOiBCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNldFNlc3Npb25Ub2tlbihlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlB0KGUpLnB1dCh7XG4gICAgICAgICAgICBuYW1lOiBcInNlc3Npb25Ub2tlblwiLFxuICAgICAgICAgICAgdmFsdWU6IHQudG9VaW50OEFycmF5KClcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gTm90ZTogVGhpcyBjb2RlIGlzIGNvcGllZCBmcm9tIHRoZSBiYWNrZW5kLiBDb2RlIHRoYXQgaXMgbm90IHVzZWQgYnlcbi8vIEZpcmVzdG9yZSB3YXMgcmVtb3ZlZC5cbi8qKiBGaXJlc3RvcmUgaW5kZXggdmFsdWUgd3JpdGVyLiAgKi9cbmNsYXNzIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHt9XG4gICAgLy8gVGhlIHdyaXRlIG1ldGhvZHMgYmVsb3cgc2hvcnQtY2lyY3VpdCB3cml0aW5nIHRlcm1pbmF0b3JzIGZvciB2YWx1ZXNcbiAgICAvLyBjb250YWluaW5nIGEgKHRlcm1pbmF0aW5nKSB0cnVuY2F0ZWQgdmFsdWUuXG4gICAgLy8gQXMgYW4gZXhhbXBsZSwgY29uc2lkZXIgdGhlIHJlc3VsdGluZyBlbmNvZGluZyBmb3I6XG4gICAgLy8gW1wiYmFyXCIsIFsyLCBcImZvb1wiXV0gLT4gKFNUUklORywgXCJiYXJcIiwgVEVSTSwgQVJSQVksIE5VTUJFUiwgMiwgU1RSSU5HLCBcImZvb1wiLCBURVJNLCBURVJNLCBURVJNKVxuICAgIC8vIFtcImJhclwiLCBbMiwgdHJ1bmNhdGVkKFwiZm9vXCIpXV0gLT4gKFNUUklORywgXCJiYXJcIiwgVEVSTSwgQVJSQVksIE5VTUJFUiwgMiwgU1RSSU5HLCBcImZvb1wiLCBUUlVOQylcbiAgICAvLyBbXCJiYXJcIiwgdHJ1bmNhdGVkKFtcImZvb1wiXSldIC0+IChTVFJJTkcsIFwiYmFyXCIsIFRFUk0sIEFSUkFZLiBTVFJJTkcsIFwiZm9vXCIsIFRFUk0sIFRSVU5DKVxuICAgIC8qKiBXcml0ZXMgYW4gaW5kZXggdmFsdWUuICAqL1xuICAgIEl0KGUsIHQpIHtcbiAgICAgICAgdGhpcy5UdChlLCB0KSwgXG4gICAgICAgIC8vIFdyaXRlIHNlcGFyYXRvciB0byBzcGxpdCBpbmRleCB2YWx1ZXNcbiAgICAgICAgLy8gKHNlZSBnby9maXJlc3RvcmUtc3RvcmFnZS1mb3JtYXQjZW5jb2RpbmdzKS5cbiAgICAgICAgdC5FdCgpO1xuICAgIH1cbiAgICBUdChlLCB0KSB7XG4gICAgICAgIGlmIChcIm51bGxWYWx1ZVwiIGluIGUpIHRoaXMuZHQodCwgNSk7IGVsc2UgaWYgKFwiYm9vbGVhblZhbHVlXCIgaW4gZSkgdGhpcy5kdCh0LCAxMCksIFxuICAgICAgICB0LkF0KGUuYm9vbGVhblZhbHVlID8gMSA6IDApOyBlbHNlIGlmIChcImludGVnZXJWYWx1ZVwiIGluIGUpIHRoaXMuZHQodCwgMTUpLCB0LkF0KF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5pbnRlZ2VyVmFsdWUpKTsgZWxzZSBpZiAoXCJkb3VibGVWYWx1ZVwiIGluIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuZG91YmxlVmFsdWUpO1xuICAgICAgICAgICAgaXNOYU4obikgPyB0aGlzLmR0KHQsIDEzKSA6ICh0aGlzLmR0KHQsIDE1KSwgX19QUklWQVRFX2lzTmVnYXRpdmVaZXJvKG4pID8gXG4gICAgICAgICAgICAvLyAtMC4wLCAwIGFuZCAwLjAgYXJlIGFsbCBjb25zaWRlcmVkIHRoZSBzYW1lXG4gICAgICAgICAgICB0LkF0KDApIDogdC5BdChuKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUpIHtcbiAgICAgICAgICAgIGxldCBuID0gZS50aW1lc3RhbXBWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMuZHQodCwgMjApLCBcInN0cmluZ1wiID09IHR5cGVvZiBuICYmIChuID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChuKSksIHQuUnQoYCR7bi5zZWNvbmRzIHx8IFwiXCJ9YCksIFxuICAgICAgICAgICAgdC5BdChuLm5hbm9zIHx8IDApO1xuICAgICAgICB9IGVsc2UgaWYgKFwic3RyaW5nVmFsdWVcIiBpbiBlKSB0aGlzLlZ0KGUuc3RyaW5nVmFsdWUsIHQpLCB0aGlzLmZ0KHQpOyBlbHNlIGlmIChcImJ5dGVzVmFsdWVcIiBpbiBlKSB0aGlzLmR0KHQsIDMwKSwgXG4gICAgICAgIHQuZ3QoX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcoZS5ieXRlc1ZhbHVlKSksIHRoaXMuZnQodCk7IGVsc2UgaWYgKFwicmVmZXJlbmNlVmFsdWVcIiBpbiBlKSB0aGlzLnl0KGUucmVmZXJlbmNlVmFsdWUsIHQpOyBlbHNlIGlmIChcImdlb1BvaW50VmFsdWVcIiBpbiBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5nZW9Qb2ludFZhbHVlO1xuICAgICAgICAgICAgdGhpcy5kdCh0LCA0NSksIHQuQXQobi5sYXRpdHVkZSB8fCAwKSwgdC5BdChuLmxvbmdpdHVkZSB8fCAwKTtcbiAgICAgICAgfSBlbHNlIFwibWFwVmFsdWVcIiBpbiBlID8gX19QUklWQVRFX2lzTWF4VmFsdWUoZSkgPyB0aGlzLmR0KHQsIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKSA6IF9fUFJJVkFURV9pc1ZlY3RvclZhbHVlKGUpID8gdGhpcy53dChlLm1hcFZhbHVlLCB0KSA6ICh0aGlzLlN0KGUubWFwVmFsdWUsIHQpLCBcbiAgICAgICAgdGhpcy5mdCh0KSkgOiBcImFycmF5VmFsdWVcIiBpbiBlID8gKHRoaXMuYnQoZS5hcnJheVZhbHVlLCB0KSwgdGhpcy5mdCh0KSkgOiBmYWlsKCk7XG4gICAgfVxuICAgIFZ0KGUsIHQpIHtcbiAgICAgICAgdGhpcy5kdCh0LCAyNSksIHRoaXMuRHQoZSwgdCk7XG4gICAgfVxuICAgIER0KGUsIHQpIHtcbiAgICAgICAgdC5SdChlKTtcbiAgICB9XG4gICAgU3QoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gZS5maWVsZHMgfHwge307XG4gICAgICAgIHRoaXMuZHQodCwgNTUpO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgT2JqZWN0LmtleXMobikpIHRoaXMuVnQoZSwgdCksIHRoaXMuVHQobltlXSwgdCk7XG4gICAgfVxuICAgIHd0KGUsIHQpIHtcbiAgICAgICAgdmFyIG4sIHI7XG4gICAgICAgIGNvbnN0IGkgPSBlLmZpZWxkcyB8fCB7fTtcbiAgICAgICAgdGhpcy5kdCh0LCA1Myk7XG4gICAgICAgIC8vIFZlY3RvcnMgc29ydCBmaXJzdCBieSBsZW5ndGhcbiAgICAgICAgY29uc3QgcyA9IFwidmFsdWVcIiwgbyA9IChudWxsID09PSAociA9IG51bGwgPT09IChuID0gaVtzXS5hcnJheVZhbHVlKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLnZhbHVlcykgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5sZW5ndGgpIHx8IDA7XG4gICAgICAgIHRoaXMuZHQodCwgMTUpLCB0LkF0KF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIobykpLCBcbiAgICAgICAgLy8gVmVjdG9ycyB0aGVuIHNvcnQgYnkgcG9zaXRpb24gdmFsdWVcbiAgICAgICAgdGhpcy5WdChzLCB0KSwgdGhpcy5UdChpW3NdLCB0KTtcbiAgICB9XG4gICAgYnQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gZS52YWx1ZXMgfHwgW107XG4gICAgICAgIHRoaXMuZHQodCwgNTApO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgbikgdGhpcy5UdChlLCB0KTtcbiAgICB9XG4gICAgeXQoZSwgdCkge1xuICAgICAgICB0aGlzLmR0KHQsIDM3KTtcbiAgICAgICAgRG9jdW1lbnRLZXkuZnJvbU5hbWUoZSkucGF0aC5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuZHQodCwgNjApLCB0aGlzLkR0KGUsIHQpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGR0KGUsIHQpIHtcbiAgICAgICAgZS5BdCh0KTtcbiAgICB9XG4gICAgZnQoZSkge1xuICAgICAgICAvLyBXaGlsZSB0aGUgU0RLIGRvZXMgbm90IGltcGxlbWVudCB0cnVuY2F0aW9uLCB0aGUgdHJ1bmNhdGlvbiBtYXJrZXIgaXNcbiAgICAgICAgLy8gdXNlZCB0byB0ZXJtaW5hdGUgYWxsIHZhcmlhYmxlIGxlbmd0aCB2YWx1ZXMgKHdoaWNoIGFyZSBzdHJpbmdzLCBieXRlcyxcbiAgICAgICAgLy8gcmVmZXJlbmNlcywgYXJyYXlzIGFuZCBtYXBzKS5cbiAgICAgICAgZS5BdCgyKTtcbiAgICB9XG59XG5cbl9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLnZ0ID0gbmV3IF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyO1xuXG4vKipcbiAqIENvdW50cyB0aGUgbnVtYmVyIG9mIHplcm9zIGluIGEgYnl0ZS5cbiAqXG4gKiBWaXNpYmxlIGZvciB0ZXN0aW5nLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbnVtYmVyT2ZMZWFkaW5nWmVyb3NJbkJ5dGUoZSkge1xuICAgIGlmICgwID09PSBlKSByZXR1cm4gODtcbiAgICBsZXQgdCA9IDA7XG4gICAgcmV0dXJuIGUgPj4gNCA9PSAwICYmIChcbiAgICAvLyBUZXN0IGlmIHRoZSBmaXJzdCBmb3VyIGJpdHMgYXJlIHplcm8uXG4gICAgdCArPSA0LCBlIDw8PSA0KSwgZSA+PiA2ID09IDAgJiYgKFxuICAgIC8vIFRlc3QgaWYgdGhlIGZpcnN0IHR3byAob3IgbmV4dCB0d28pIGJpdHMgYXJlIHplcm8uXG4gICAgdCArPSAyLCBlIDw8PSAyKSwgZSA+PiA3ID09IDAgJiYgKFxuICAgIC8vIFRlc3QgaWYgdGhlIHJlbWFpbmluZyBiaXQgaXMgemVyby5cbiAgICB0ICs9IDEpLCB0O1xufVxuXG4vKiogQ291bnRzIHRoZSBudW1iZXIgb2YgbGVhZGluZyB6ZXJvcyBpbiB0aGUgZ2l2ZW4gYnl0ZSBhcnJheS4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHJlcXVpcmVkIHRvIHN0b3JlIFwidmFsdWVcIi4gTGVhZGluZyB6ZXJvIGJ5dGVzXG4gKiBhcmUgc2tpcHBlZC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3Vuc2lnbmVkTnVtTGVuZ3RoKGUpIHtcbiAgICAvLyBUaGlzIGlzIGp1c3QgdGhlIG51bWJlciBvZiBieXRlcyBmb3IgdGhlIHVuc2lnbmVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBudW1iZXIuXG4gICAgY29uc3QgdCA9IDY0IC0gZnVuY3Rpb24gX19QUklWQVRFX251bWJlck9mTGVhZGluZ1plcm9zKGUpIHtcbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IDg7ICsrbikge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9udW1iZXJPZkxlYWRpbmdaZXJvc0luQnl0ZSgyNTUgJiBlW25dKTtcbiAgICAgICAgICAgIGlmICh0ICs9IHIsIDggIT09IHIpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0O1xuICAgIH0oZSk7XG4gICAgcmV0dXJuIE1hdGguY2VpbCh0IC8gOCk7XG59XG5cbi8qKlxuICogT3JkZXJlZENvZGVXcml0ZXIgaXMgYSBtaW5pbWFsLWFsbG9jYXRpb24gaW1wbGVtZW50YXRpb24gb2YgdGhlIHdyaXRpbmdcbiAqIGJlaGF2aW9yIGRlZmluZWQgYnkgdGhlIGJhY2tlbmQuXG4gKlxuICogVGhlIGNvZGUgaXMgcG9ydGVkIGZyb20gaXRzIEphdmEgY291bnRlcnBhcnQuXG4gKi8gY2xhc3MgX19QUklWQVRFX09yZGVyZWRDb2RlV3JpdGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxMDI0KSwgdGhpcy5wb3NpdGlvbiA9IDA7XG4gICAgfVxuICAgIEN0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGVbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICBsZXQgbiA9IHQubmV4dCgpO1xuICAgICAgICBmb3IgKDshbi5kb25lOyApIHRoaXMuRnQobi52YWx1ZSksIG4gPSB0Lm5leHQoKTtcbiAgICAgICAgdGhpcy5NdCgpO1xuICAgIH1cbiAgICB4dChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgbGV0IG4gPSB0Lm5leHQoKTtcbiAgICAgICAgZm9yICg7IW4uZG9uZTsgKSB0aGlzLk90KG4udmFsdWUpLCBuID0gdC5uZXh0KCk7XG4gICAgICAgIHRoaXMuTnQoKTtcbiAgICB9XG4gICAgLyoqIFdyaXRlcyB1dGY4IGJ5dGVzIGludG8gdGhpcyBieXRlIHNlcXVlbmNlLCBhc2NlbmRpbmcuICovICAgIEx0KGUpIHtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICBpZiAoZSA8IDEyOCkgdGhpcy5GdChlKTsgZWxzZSBpZiAoZSA8IDIwNDgpIHRoaXMuRnQoOTYwIHwgZSA+Pj4gNiksIHRoaXMuRnQoMTI4IHwgNjMgJiBlKTsgZWxzZSBpZiAodCA8IFwiXFx1ZDgwMFwiIHx8IFwiXFx1ZGJmZlwiIDwgdCkgdGhpcy5GdCg0ODAgfCBlID4+PiAxMiksIFxuICAgICAgICAgICAgdGhpcy5GdCgxMjggfCA2MyAmIGUgPj4+IDYpLCB0aGlzLkZ0KDEyOCB8IDYzICYgZSk7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LmNvZGVQb2ludEF0KDApO1xuICAgICAgICAgICAgICAgIHRoaXMuRnQoMjQwIHwgZSA+Pj4gMTgpLCB0aGlzLkZ0KDEyOCB8IDYzICYgZSA+Pj4gMTIpLCB0aGlzLkZ0KDEyOCB8IDYzICYgZSA+Pj4gNiksIFxuICAgICAgICAgICAgICAgIHRoaXMuRnQoMTI4IHwgNjMgJiBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLk10KCk7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgdXRmOCBieXRlcyBpbnRvIHRoaXMgYnl0ZSBzZXF1ZW5jZSwgZGVzY2VuZGluZyAqLyAgICBCdChlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgaWYgKGUgPCAxMjgpIHRoaXMuT3QoZSk7IGVsc2UgaWYgKGUgPCAyMDQ4KSB0aGlzLk90KDk2MCB8IGUgPj4+IDYpLCB0aGlzLk90KDEyOCB8IDYzICYgZSk7IGVsc2UgaWYgKHQgPCBcIlxcdWQ4MDBcIiB8fCBcIlxcdWRiZmZcIiA8IHQpIHRoaXMuT3QoNDgwIHwgZSA+Pj4gMTIpLCBcbiAgICAgICAgICAgIHRoaXMuT3QoMTI4IHwgNjMgJiBlID4+PiA2KSwgdGhpcy5PdCgxMjggfCA2MyAmIGUpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdC5jb2RlUG9pbnRBdCgwKTtcbiAgICAgICAgICAgICAgICB0aGlzLk90KDI0MCB8IGUgPj4+IDE4KSwgdGhpcy5PdCgxMjggfCA2MyAmIGUgPj4+IDEyKSwgdGhpcy5PdCgxMjggfCA2MyAmIGUgPj4+IDYpLCBcbiAgICAgICAgICAgICAgICB0aGlzLk90KDEyOCB8IDYzICYgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5OdCgpO1xuICAgIH1cbiAgICBrdChlKSB7XG4gICAgICAgIC8vIFZhbHVlcyBhcmUgZW5jb2RlZCB3aXRoIGEgc2luZ2xlIGJ5dGUgbGVuZ3RoIHByZWZpeCwgZm9sbG93ZWQgYnkgdGhlXG4gICAgICAgIC8vIGFjdHVhbCB2YWx1ZSBpbiBiaWctZW5kaWFuIGZvcm1hdCB3aXRoIGxlYWRpbmcgMCBieXRlcyBkcm9wcGVkLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5xdChlKSwgbiA9IF9fUFJJVkFURV91bnNpZ25lZE51bUxlbmd0aCh0KTtcbiAgICAgICAgdGhpcy5RdCgxICsgbiksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSAyNTUgJiBuO1xuICAgICAgICAvLyBXcml0ZSB0aGUgbGVuZ3RoXG4gICAgICAgIGZvciAobGV0IGUgPSB0Lmxlbmd0aCAtIG47IGUgPCB0Lmxlbmd0aDsgKytlKSB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gMjU1ICYgdFtlXTtcbiAgICB9XG4gICAgS3QoZSkge1xuICAgICAgICAvLyBWYWx1ZXMgYXJlIGVuY29kZWQgd2l0aCBhIHNpbmdsZSBieXRlIGxlbmd0aCBwcmVmaXgsIGZvbGxvd2VkIGJ5IHRoZVxuICAgICAgICAvLyBpbnZlcnRlZCB2YWx1ZSBpbiBiaWctZW5kaWFuIGZvcm1hdCB3aXRoIGxlYWRpbmcgMCBieXRlcyBkcm9wcGVkLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5xdChlKSwgbiA9IF9fUFJJVkFURV91bnNpZ25lZE51bUxlbmd0aCh0KTtcbiAgICAgICAgdGhpcy5RdCgxICsgbiksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSB+KDI1NSAmIG4pO1xuICAgICAgICAvLyBXcml0ZSB0aGUgbGVuZ3RoXG4gICAgICAgIGZvciAobGV0IGUgPSB0Lmxlbmd0aCAtIG47IGUgPCB0Lmxlbmd0aDsgKytlKSB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gfigyNTUgJiB0W2VdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV3JpdGVzIHRoZSBcImluZmluaXR5XCIgYnl0ZSBzZXF1ZW5jZSB0aGF0IHNvcnRzIGFmdGVyIGFsbCBvdGhlciBieXRlXG4gICAgICogc2VxdWVuY2VzIHdyaXR0ZW4gaW4gYXNjZW5kaW5nIG9yZGVyLlxuICAgICAqLyAgICAkdCgpIHtcbiAgICAgICAgdGhpcy5VdCgyNTUpLCB0aGlzLlV0KDI1NSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlcyB0aGUgXCJpbmZpbml0eVwiIGJ5dGUgc2VxdWVuY2UgdGhhdCBzb3J0cyBiZWZvcmUgYWxsIG90aGVyIGJ5dGVcbiAgICAgKiBzZXF1ZW5jZXMgd3JpdHRlbiBpbiBkZXNjZW5kaW5nIG9yZGVyLlxuICAgICAqLyAgICBXdCgpIHtcbiAgICAgICAgdGhpcy5HdCgyNTUpLCB0aGlzLkd0KDI1NSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgYnVmZmVyIHN1Y2ggdGhhdCBpdCBpcyB0aGUgc2FtZSBhcyB3aGVuIGl0IHdhcyBuZXdseVxuICAgICAqIGNvbnN0cnVjdGVkLlxuICAgICAqLyAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IDA7XG4gICAgfVxuICAgIHNlZWQoZSkge1xuICAgICAgICB0aGlzLlF0KGUubGVuZ3RoKSwgdGhpcy5idWZmZXIuc2V0KGUsIHRoaXMucG9zaXRpb24pLCB0aGlzLnBvc2l0aW9uICs9IGUubGVuZ3RoO1xuICAgIH1cbiAgICAvKiogTWFrZXMgYSBjb3B5IG9mIHRoZSBlbmNvZGVkIGJ5dGVzIGluIHRoaXMgYnVmZmVyLiAgKi8gICAgenQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5zbGljZSgwLCB0aGlzLnBvc2l0aW9uKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5jb2RlcyBgdmFsYCBpbnRvIGFuIGVuY29kaW5nIHNvIHRoYXQgdGhlIG9yZGVyIG1hdGNoZXMgdGhlIElFRUUgNzU0XG4gICAgICogZmxvYXRpbmctcG9pbnQgY29tcGFyaXNvbiByZXN1bHRzIHdpdGggdGhlIGZvbGxvd2luZyBleGNlcHRpb25zOlxuICAgICAqICAgLTAuMCA8IDAuMFxuICAgICAqICAgYWxsIG5vbi1OYU4gPCBOYU5cbiAgICAgKiAgIE5hTiA9IE5hTlxuICAgICAqLyAgICBxdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBcbiAgICAgICAgLyoqIENvbnZlcnRzIGEgSmF2YVNjcmlwdCBudW1iZXIgdG8gYSBieXRlIGFycmF5ICh1c2luZyBiaWcgZW5kaWFuIGVuY29kaW5nKS4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2RvdWJsZVRvTG9uZ0JpdHMoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoOCkpO1xuICAgICAgICAgICAgcmV0dXJuIHQuc2V0RmxvYXQ2NCgwLCBlLCAvKiBsaXR0bGVFbmRpYW49ICovICExKSwgbmV3IFVpbnQ4QXJyYXkodC5idWZmZXIpO1xuICAgICAgICB9KGUpLCBuID0gMCAhPSAoMTI4ICYgdFswXSk7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBmaXJzdCBiaXQgaXMgc2V0LiBXZSB1c2UgYSBiaXQgbWFzayBzaW5jZSB2YWx1ZVswXSBpc1xuICAgICAgICAvLyBlbmNvZGVkIGFzIGEgbnVtYmVyIGZyb20gMCB0byAyNTUuXG4gICAgICAgICAgICAgICAgLy8gUmV2ZXJ0IHRoZSB0d28gY29tcGxlbWVudCB0byBnZXQgbmF0dXJhbCBvcmRlcmluZ1xuICAgICAgICB0WzBdIF49IG4gPyAyNTUgOiAxMjg7XG4gICAgICAgIGZvciAobGV0IGUgPSAxOyBlIDwgdC5sZW5ndGg7ICsrZSkgdFtlXSBePSBuID8gMjU1IDogMDtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgYSBzaW5nbGUgYnl0ZSBhc2NlbmRpbmcgdG8gdGhlIGJ1ZmZlci4gKi8gICAgRnQoZSkge1xuICAgICAgICBjb25zdCB0ID0gMjU1ICYgZTtcbiAgICAgICAgMCA9PT0gdCA/ICh0aGlzLlV0KDApLCB0aGlzLlV0KDI1NSkpIDogMjU1ID09PSB0ID8gKHRoaXMuVXQoMjU1KSwgdGhpcy5VdCgwKSkgOiB0aGlzLlV0KHQpO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGEgc2luZ2xlIGJ5dGUgZGVzY2VuZGluZyB0byB0aGUgYnVmZmVyLiAgKi8gICAgT3QoZSkge1xuICAgICAgICBjb25zdCB0ID0gMjU1ICYgZTtcbiAgICAgICAgMCA9PT0gdCA/ICh0aGlzLkd0KDApLCB0aGlzLkd0KDI1NSkpIDogMjU1ID09PSB0ID8gKHRoaXMuR3QoMjU1KSwgdGhpcy5HdCgwKSkgOiB0aGlzLkd0KGUpO1xuICAgIH1cbiAgICBNdCgpIHtcbiAgICAgICAgdGhpcy5VdCgwKSwgdGhpcy5VdCgxKTtcbiAgICB9XG4gICAgTnQoKSB7XG4gICAgICAgIHRoaXMuR3QoMCksIHRoaXMuR3QoMSk7XG4gICAgfVxuICAgIFV0KGUpIHtcbiAgICAgICAgdGhpcy5RdCgxKSwgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IGU7XG4gICAgfVxuICAgIEd0KGUpIHtcbiAgICAgICAgdGhpcy5RdCgxKSwgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IH5lO1xuICAgIH1cbiAgICBRdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlICsgdGhpcy5wb3NpdGlvbjtcbiAgICAgICAgaWYgKHQgPD0gdGhpcy5idWZmZXIubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIC8vIFRyeSBkb3VibGluZy5cbiAgICAgICAgICAgICAgICBsZXQgbiA9IDIgKiB0aGlzLmJ1ZmZlci5sZW5ndGg7XG4gICAgICAgIC8vIFN0aWxsIG5vdCBiaWcgZW5vdWdoPyBKdXN0IGFsbG9jYXRlIHRoZSByaWdodCBzaXplLlxuICAgICAgICAgICAgICAgIG4gPCB0ICYmIChuID0gdCk7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgbmV3IGJ1ZmZlci5cbiAgICAgICAgICAgICAgICBjb25zdCByID0gbmV3IFVpbnQ4QXJyYXkobik7XG4gICAgICAgIHIuc2V0KHRoaXMuYnVmZmVyKSwgLy8gY29weSBvbGQgZGF0YVxuICAgICAgICB0aGlzLmJ1ZmZlciA9IHI7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfQXNjZW5kaW5nSW5kZXhCeXRlRW5jb2RlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmp0ID0gZTtcbiAgICB9XG4gICAgZ3QoZSkge1xuICAgICAgICB0aGlzLmp0LkN0KGUpO1xuICAgIH1cbiAgICBSdChlKSB7XG4gICAgICAgIHRoaXMuanQuTHQoZSk7XG4gICAgfVxuICAgIEF0KGUpIHtcbiAgICAgICAgdGhpcy5qdC5rdChlKTtcbiAgICB9XG4gICAgRXQoKSB7XG4gICAgICAgIHRoaXMuanQuJHQoKTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9EZXNjZW5kaW5nSW5kZXhCeXRlRW5jb2RlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmp0ID0gZTtcbiAgICB9XG4gICAgZ3QoZSkge1xuICAgICAgICB0aGlzLmp0Lnh0KGUpO1xuICAgIH1cbiAgICBSdChlKSB7XG4gICAgICAgIHRoaXMuanQuQnQoZSk7XG4gICAgfVxuICAgIEF0KGUpIHtcbiAgICAgICAgdGhpcy5qdC5LdChlKTtcbiAgICB9XG4gICAgRXQoKSB7XG4gICAgICAgIHRoaXMuanQuV3QoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyBgRGlyZWN0aW9uYWxJbmRleEJ5dGVFbmNvZGVyYCB1c2luZyBgT3JkZXJlZENvZGVXcml0ZXJgIGZvciB0aGVcbiAqIGFjdHVhbCBlbmNvZGluZy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhCeXRlRW5jb2RlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuanQgPSBuZXcgX19QUklWQVRFX09yZGVyZWRDb2RlV3JpdGVyLCB0aGlzLkh0ID0gbmV3IF9fUFJJVkFURV9Bc2NlbmRpbmdJbmRleEJ5dGVFbmNvZGVyKHRoaXMuanQpLCBcbiAgICAgICAgdGhpcy5KdCA9IG5ldyBfX1BSSVZBVEVfRGVzY2VuZGluZ0luZGV4Qnl0ZUVuY29kZXIodGhpcy5qdCk7XG4gICAgfVxuICAgIHNlZWQoZSkge1xuICAgICAgICB0aGlzLmp0LnNlZWQoZSk7XG4gICAgfVxuICAgIFl0KGUpIHtcbiAgICAgICAgcmV0dXJuIDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA9PT0gZSA/IHRoaXMuSHQgOiB0aGlzLkp0O1xuICAgIH1cbiAgICB6dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuanQuenQoKTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuanQucmVzZXQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogUmVwcmVzZW50cyBhbiBpbmRleCBlbnRyeSBzYXZlZCBieSB0aGUgU0RLIGluIHBlcnNpc3RlZCBzdG9yYWdlLiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhFbnRyeSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLmluZGV4SWQgPSBlLCB0aGlzLmRvY3VtZW50S2V5ID0gdCwgdGhpcy5hcnJheVZhbHVlID0gbiwgdGhpcy5kaXJlY3Rpb25hbFZhbHVlID0gcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBJbmRleEVudHJ5IGVudHJ5IHRoYXQgc29ydHMgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIGN1cnJlbnRcbiAgICAgKiBkaXJlY3Rpb25hbCB2YWx1ZS5cbiAgICAgKi8gICAgWnQoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmRpcmVjdGlvbmFsVmFsdWUubGVuZ3RoLCB0ID0gMCA9PT0gZSB8fCAyNTUgPT09IHRoaXMuZGlyZWN0aW9uYWxWYWx1ZVtlIC0gMV0gPyBlICsgMSA6IGUsIG4gPSBuZXcgVWludDhBcnJheSh0KTtcbiAgICAgICAgcmV0dXJuIG4uc2V0KHRoaXMuZGlyZWN0aW9uYWxWYWx1ZSwgMCksIHQgIT09IGUgPyBuLnNldChbIDAgXSwgdGhpcy5kaXJlY3Rpb25hbFZhbHVlLmxlbmd0aCkgOiArK25bbi5sZW5ndGggLSAxXSwgXG4gICAgICAgIG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeSh0aGlzLmluZGV4SWQsIHRoaXMuZG9jdW1lbnRLZXksIHRoaXMuYXJyYXlWYWx1ZSwgbik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoZSwgdCkge1xuICAgIGxldCBuID0gZS5pbmRleElkIC0gdC5pbmRleElkO1xuICAgIHJldHVybiAwICE9PSBuID8gbiA6IChuID0gX19QUklWQVRFX2NvbXBhcmVCeXRlQXJyYXlzKGUuYXJyYXlWYWx1ZSwgdC5hcnJheVZhbHVlKSwgXG4gICAgMCAhPT0gbiA/IG4gOiAobiA9IF9fUFJJVkFURV9jb21wYXJlQnl0ZUFycmF5cyhlLmRpcmVjdGlvbmFsVmFsdWUsIHQuZGlyZWN0aW9uYWxWYWx1ZSksIFxuICAgIDAgIT09IG4gPyBuIDogRG9jdW1lbnRLZXkuY29tcGFyYXRvcihlLmRvY3VtZW50S2V5LCB0LmRvY3VtZW50S2V5KSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUJ5dGVBcnJheXMoZSwgdCkge1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGggJiYgbiA8IHQubGVuZ3RoOyArK24pIHtcbiAgICAgICAgY29uc3QgciA9IGVbbl0gLSB0W25dO1xuICAgICAgICBpZiAoMCAhPT0gcikgcmV0dXJuIHI7XG4gICAgfVxuICAgIHJldHVybiBlLmxlbmd0aCAtIHQubGVuZ3RoO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGxpZ2h0IHF1ZXJ5IHBsYW5uZXIgZm9yIEZpcmVzdG9yZS5cbiAqXG4gKiBUaGlzIGNsYXNzIG1hdGNoZXMgYSBgRmllbGRJbmRleGAgYWdhaW5zdCBhIEZpcmVzdG9yZSBRdWVyeSBgVGFyZ2V0YC4gSXRcbiAqIGRldGVybWluZXMgd2hldGhlciBhIGdpdmVuIGluZGV4IGNhbiBiZSB1c2VkIHRvIHNlcnZlIHRoZSBzcGVjaWZpZWQgdGFyZ2V0LlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgdGFibGUgc2hvd2Nhc2VzIHNvbWUgcG9zc2libGUgaW5kZXggY29uZmlndXJhdGlvbnM6XG4gKlxuICogUXVlcnkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgSW5kZXhcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiB3aGVyZSgnYScsICc9PScsICdhJykud2hlcmUoJ2InLCAnPT0nLCAnYicpICAgICAgICAgfCBhIEFTQywgYiBERVNDXG4gKiB3aGVyZSgnYScsICc9PScsICdhJykud2hlcmUoJ2InLCAnPT0nLCAnYicpICAgICAgICAgfCBhIEFTQ1xuICogd2hlcmUoJ2EnLCAnPT0nLCAnYScpLndoZXJlKCdiJywgJz09JywgJ2InKSAgICAgICAgIHwgYiBERVNDXG4gKiB3aGVyZSgnYScsICc+PScsICdhJykub3JkZXJCeSgnYScpICAgICAgICAgICAgICAgICAgfCBhIEFTQ1xuICogd2hlcmUoJ2EnLCAnPj0nLCAnYScpLm9yZGVyQnkoJ2EnLCAnZGVzYycpICAgICAgICAgIHwgYSBERVNDXG4gKiB3aGVyZSgnYScsICc+PScsICdhJykub3JkZXJCeSgnYScpLm9yZGVyQnkoJ2InKSAgICAgfCBhIEFTQywgYiBBU0NcbiAqIHdoZXJlKCdhJywgJz49JywgJ2EnKS5vcmRlckJ5KCdhJykub3JkZXJCeSgnYicpICAgICB8IGEgQVNDXG4gKiB3aGVyZSgnYScsICdhcnJheS1jb250YWlucycsICdhJykub3JkZXJCeSgnYicpICAgICAgfCBhIENPTlRBSU5TLCBiIEFTQ0VORElOR1xuICogd2hlcmUoJ2EnLCAnYXJyYXktY29udGFpbnMnLCAnYScpLm9yZGVyQnkoJ2InKSAgICAgIHwgYSBDT05UQUlOU1xuICovIGNsYXNzIF9fUFJJVkFURV9UYXJnZXRJbmRleE1hdGNoZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgLy8gVGhlIGluZXF1YWxpdHkgZmlsdGVycyBvZiB0aGUgdGFyZ2V0IChpZiBpdCBleGlzdHMpLlxuICAgICAgICAvLyBOb3RlOiBUaGUgc29ydCBvbiBGaWVsZEZpbHRlcnMgaXMgbm90IHJlcXVpcmVkLiBVc2luZyBTb3J0ZWRTZXQgaGVyZSBqdXN0IHRvIHV0aWxpemUgdGhlIGN1c3RvbVxuICAgICAgICAvLyBjb21wYXJhdG9yLlxuICAgICAgICB0aGlzLlh0ID0gbmV3IFNvcnRlZFNldCgoKGUsIHQpID0+IEZpZWxkUGF0aCQxLmNvbXBhcmF0b3IoZS5maWVsZCwgdC5maWVsZCkpKSwgdGhpcy5jb2xsZWN0aW9uSWQgPSBudWxsICE9IGUuY29sbGVjdGlvbkdyb3VwID8gZS5jb2xsZWN0aW9uR3JvdXAgOiBlLnBhdGgubGFzdFNlZ21lbnQoKSwgXG4gICAgICAgIHRoaXMuZW4gPSBlLm9yZGVyQnksIHRoaXMudG4gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUuZmlsdGVycykge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQ7XG4gICAgICAgICAgICBlLmlzSW5lcXVhbGl0eSgpID8gdGhpcy5YdCA9IHRoaXMuWHQuYWRkKGUpIDogdGhpcy50bi5wdXNoKGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBubigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuWHQuc2l6ZSA+IDE7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgaW5kZXggY2FuIGJlIHVzZWQgdG8gc2VydmUgdGhlIFRhcmdldEluZGV4TWF0Y2hlcidzXG4gICAgICogdGFyZ2V0LlxuICAgICAqXG4gICAgICogQW4gaW5kZXggaXMgY29uc2lkZXJlZCBjYXBhYmxlIG9mIHNlcnZpbmcgdGhlIHRhcmdldCB3aGVuOlxuICAgICAqIC0gVGhlIHRhcmdldCB1c2VzIGFsbCBpbmRleCBzZWdtZW50cyBmb3IgaXRzIGZpbHRlcnMgYW5kIG9yZGVyQnkgY2xhdXNlcy5cbiAgICAgKiAgIFRoZSB0YXJnZXQgY2FuIGhhdmUgYWRkaXRpb25hbCBmaWx0ZXIgYW5kIG9yZGVyQnkgY2xhdXNlcywgYnV0IG5vdFxuICAgICAqICAgZmV3ZXIuXG4gICAgICogLSBJZiBhbiBBcnJheUNvbnRhaW5zL0FycmF5Q29udGFpbnNBbnlmaWx0ZXIgaXMgdXNlZCwgdGhlIGluZGV4IG11c3QgYWxzb1xuICAgICAqICAgaGF2ZSBhIGNvcnJlc3BvbmRpbmcgYENPTlRBSU5TYCBzZWdtZW50LlxuICAgICAqIC0gQWxsIGRpcmVjdGlvbmFsIGluZGV4IHNlZ21lbnRzIGNhbiBiZSBtYXBwZWQgdG8gdGhlIHRhcmdldCBhcyBhIHNlcmllcyBvZlxuICAgICAqICAgZXF1YWxpdHkgZmlsdGVycywgYSBzaW5nbGUgaW5lcXVhbGl0eSBmaWx0ZXIgYW5kIGEgc2VyaWVzIG9mIG9yZGVyQnlcbiAgICAgKiAgIGNsYXVzZXMuXG4gICAgICogLSBUaGUgc2VnbWVudHMgdGhhdCByZXByZXNlbnQgdGhlIGVxdWFsaXR5IGZpbHRlcnMgbWF5IGFwcGVhciBvdXQgb2Ygb3JkZXIuXG4gICAgICogLSBUaGUgb3B0aW9uYWwgc2VnbWVudCBmb3IgdGhlIGluZXF1YWxpdHkgZmlsdGVyIG11c3QgYXBwZWFyIGFmdGVyIGFsbFxuICAgICAqICAgZXF1YWxpdHkgc2VnbWVudHMuXG4gICAgICogLSBUaGUgc2VnbWVudHMgdGhhdCByZXByZXNlbnQgdGhhdCBvcmRlckJ5IGNsYXVzZSBvZiB0aGUgdGFyZ2V0IG11c3QgYXBwZWFyXG4gICAgICogICBpbiBvcmRlciBhZnRlciBhbGwgZXF1YWxpdHkgYW5kIGluZXF1YWxpdHkgc2VnbWVudHMuIFNpbmdsZSBvcmRlckJ5XG4gICAgICogICBjbGF1c2VzIGNhbm5vdCBiZSBza2lwcGVkLCBidXQgYSBjb250aW51b3VzIG9yZGVyQnkgc3VmZml4IG1heSBiZVxuICAgICAqICAgb21pdHRlZC5cbiAgICAgKi8gICAgcm4oZSkge1xuICAgICAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoZS5jb2xsZWN0aW9uR3JvdXAgPT09IHRoaXMuY29sbGVjdGlvbklkKSwgdGhpcy5ubikgXG4gICAgICAgIC8vIE9ubHkgc2luZ2xlIGluZXF1YWxpdHkgaXMgc3VwcG9ydGVkIGZvciBub3cuXG4gICAgICAgIC8vIFRPRE8oQWRkIHN1cHBvcnQgZm9yIG11bHRpcGxlIGluZXF1YWxpdHkgcXVlcnkpOiBiLzI5ODQ0MTA0M1xuICAgICAgICByZXR1cm4gITE7XG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGFycmF5IGVsZW1lbnQsIGZpbmQgYSBtYXRjaGluZyBmaWx0ZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9maWVsZEluZGV4R2V0QXJyYXlTZWdtZW50KGUpO1xuICAgICAgICBpZiAodm9pZCAwICE9PSB0ICYmICF0aGlzLnNuKHQpKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHMoZSk7XG4gICAgICAgIGxldCByID0gbmV3IFNldCwgaSA9IDAsIHMgPSAwO1xuICAgICAgICAvLyBQcm9jZXNzIGFsbCBlcXVhbGl0aWVzIGZpcnN0LiBFcXVhbGl0aWVzIGNhbiBhcHBlYXIgb3V0IG9mIG9yZGVyLlxuICAgICAgICBmb3IgKDtpIDwgbi5sZW5ndGggJiYgdGhpcy5zbihuW2ldKTsgKytpKSByID0gci5hZGQobltpXS5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCkpO1xuICAgICAgICAvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgcHJvY2Vzc2VkIGFsbCBzZWdtZW50cywgYWxsIHNlZ21lbnRzIGFyZSB1c2VkIHRvIHNlcnZlXG4gICAgICAgIC8vIHRoZSBlcXVhbGl0eSBmaWx0ZXJzIGFuZCB3ZSBkbyBub3QgbmVlZCB0byBtYXAgYW55IHNlZ21lbnRzIHRvIHRoZVxuICAgICAgICAvLyB0YXJnZXQncyBpbmVxdWFsaXR5IGFuZCBvcmRlckJ5IGNsYXVzZXMuXG4gICAgICAgICAgICAgICAgaWYgKGkgPT09IG4ubGVuZ3RoKSByZXR1cm4gITA7XG4gICAgICAgIGlmICh0aGlzLlh0LnNpemUgPiAwKSB7XG4gICAgICAgICAgICAvLyBPbmx5IGEgc2luZ2xlIGluZXF1YWxpdHkgaXMgY3VycmVudGx5IHN1cHBvcnRlZC4gR2V0IHRoZSBvbmx5IGVudHJ5IGluIHRoZSBzZXQuXG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5YdC5nZXRJdGVyYXRvcigpLmdldE5leHQoKTtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGluZXF1YWxpdHkgZmlsdGVyIGFuZCB0aGUgZmllbGQgd2FzIG5vdCBpbiBvbmUgb2YgdGhlXG4gICAgICAgICAgICAvLyBlcXVhbGl0eSBmaWx0ZXJzIGFib3ZlLCB0aGUgbmV4dCBzZWdtZW50IG11c3QgbWF0Y2ggYm90aCB0aGUgZmlsdGVyXG4gICAgICAgICAgICAvLyBhbmQgdGhlIGZpcnN0IG9yZGVyQnkgY2xhdXNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyLmhhcyhlLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBuW2ldO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5vbihlLCB0KSB8fCAhdGhpcy5fbih0aGlzLmVuW3MrK10sIHQpKSByZXR1cm4gITE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICArK2k7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWxsIHJlbWFpbmluZyBzZWdtZW50cyBuZWVkIHRvIHJlcHJlc2VudCB0aGUgcHJlZml4IG9mIHRoZSB0YXJnZXQnc1xuICAgICAgICAvLyBvcmRlckJ5LlxuICAgICAgICAgICAgICAgIGZvciAoO2kgPCBuLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbltpXTtcbiAgICAgICAgICAgIGlmIChzID49IHRoaXMuZW4ubGVuZ3RoIHx8ICF0aGlzLl9uKHRoaXMuZW5bcysrXSwgZSkpIHJldHVybiAhMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBmdWxsIG1hdGNoZWQgZmllbGQgaW5kZXggZm9yIHRoaXMgdGFyZ2V0LiBDdXJyZW50bHkgbXVsdGlwbGVcbiAgICAgKiBpbmVxdWFsaXR5IHF1ZXJ5IGlzIG5vdCBzdXBwb3J0ZWQgc28gZnVuY3Rpb24gcmV0dXJucyBudWxsLlxuICAgICAqLyAgICBhbigpIHtcbiAgICAgICAgaWYgKHRoaXMubm4pIHJldHVybiBudWxsO1xuICAgICAgICAvLyBXZSB3YW50IHRvIG1ha2Ugc3VyZSBvbmx5IG9uZSBzZWdtZW50IGNyZWF0ZWQgZm9yIG9uZSBmaWVsZC4gRm9yIGV4YW1wbGUsXG4gICAgICAgIC8vIGluIGNhc2UgbGlrZSBhID09IDMgYW5kIGEgPiAyLCBJbmRleCB7YSBBU0NFTkRJTkd9IHdpbGwgb25seSBiZSBjcmVhdGVkXG4gICAgICAgIC8vIG9uY2UuXG4gICAgICAgICAgICAgICAgbGV0IGUgPSBuZXcgU29ydGVkU2V0KEZpZWxkUGF0aCQxLmNvbXBhcmF0b3IpO1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB0aGlzLnRuKSB7XG4gICAgICAgICAgICBpZiAobi5maWVsZC5pc0tleUZpZWxkKCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgaWYgKFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA9PT0gbi5vcCB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gbi5vcCkgdC5wdXNoKG5ldyBJbmRleFNlZ21lbnQobi5maWVsZCwgMiAvKiBJbmRleEtpbmQuQ09OVEFJTlMgKi8pKTsgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuaGFzKG4uZmllbGQpKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBlID0gZS5hZGQobi5maWVsZCksIHQucHVzaChuZXcgSW5kZXhTZWdtZW50KG4uZmllbGQsIDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIE5vdGU6IFdlIGRvIG5vdCBleHBsaWNpdGx5IGNoZWNrIGB0aGlzLmluZXF1YWxpdHlGaWx0ZXJgIGJ1dCByYXRoZXIgcmVseVxuICAgICAgICAvLyBvbiB0aGUgdGFyZ2V0IGRlZmluaW5nIGFuIGFwcHJvcHJpYXRlIFwib3JkZXIgYnlcIiB0byBlbnN1cmUgdGhhdCB0aGVcbiAgICAgICAgLy8gcmVxdWlyZWQgaW5kZXggc2VnbWVudCBpcyBhZGRlZC4gVGhlIHF1ZXJ5IGVuZ2luZSB3b3VsZCByZWplY3QgYSBxdWVyeVxuICAgICAgICAvLyB3aXRoIGFuIGluZXF1YWxpdHkgZmlsdGVyIHRoYXQgbGFja3MgdGhlIHJlcXVpcmVkIG9yZGVyLWJ5IGNsYXVzZS5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5lbikgXG4gICAgICAgIC8vIFN0b3AgYWRkaW5nIG1vcmUgc2VnbWVudHMgaWYgd2Ugc2VlIGEgb3JkZXItYnkgb24ga2V5LiBUeXBpY2FsbHkgdGhpc1xuICAgICAgICAvLyBpcyB0aGUgZGVmYXVsdCBpbXBsaWNpdCBvcmRlci1ieSB3aGljaCBpcyBjb3ZlcmVkIGluIHRoZSBpbmRleF9lbnRyeVxuICAgICAgICAvLyB0YWJsZSBhcyBhIHNlcGFyYXRlIGNvbHVtbi4gSWYgaXQgaXMgbm90IHRoZSBkZWZhdWx0IG9yZGVyLWJ5LCB0aGVcbiAgICAgICAgLy8gZ2VuZXJhdGVkIGluZGV4IHdpbGwgYmUgbWlzc2luZyBzb21lIHNlZ21lbnRzIG9wdGltaXplZCBmb3Igb3JkZXItYnlzLFxuICAgICAgICAvLyB3aGljaCBpcyBwcm9iYWJseSBmaW5lLlxuICAgICAgICBuLmZpZWxkLmlzS2V5RmllbGQoKSB8fCBlLmhhcyhuLmZpZWxkKSB8fCAoZSA9IGUuYWRkKG4uZmllbGQpLCB0LnB1c2gobmV3IEluZGV4U2VnbWVudChuLmZpZWxkLCBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8gPT09IG4uZGlyID8gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovIDogMSAvKiBJbmRleEtpbmQuREVTQ0VORElORyAqLykpKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZEluZGV4KEZpZWxkSW5kZXguVU5LTk9XTl9JRCwgdGhpcy5jb2xsZWN0aW9uSWQsIHQsIEluZGV4U3RhdGUuZW1wdHkoKSk7XG4gICAgfVxuICAgIHNuKGUpIHtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHRoaXMudG4pIGlmICh0aGlzLm9uKHQsIGUpKSByZXR1cm4gITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgb24oZSwgdCkge1xuICAgICAgICBpZiAodm9pZCAwID09PSBlIHx8ICFlLmZpZWxkLmlzRXF1YWwodC5maWVsZFBhdGgpKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IG4gPSBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gPT09IGUub3AgfHwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gPT09IGUub3A7XG4gICAgICAgIHJldHVybiAyIC8qIEluZGV4S2luZC5DT05UQUlOUyAqLyA9PT0gdC5raW5kID09PSBuO1xuICAgIH1cbiAgICBfbihlLCB0KSB7XG4gICAgICAgIHJldHVybiAhIWUuZmllbGQuaXNFcXVhbCh0LmZpZWxkUGF0aCkgJiYgKDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA9PT0gdC5raW5kICYmIFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLyA9PT0gZS5kaXIgfHwgMSAvKiBJbmRleEtpbmQuREVTQ0VORElORyAqLyA9PT0gdC5raW5kICYmIFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovID09PSBlLmRpcik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlcyB1dGlsaXR5IGZ1bmN0aW9ucyB0aGF0IGhlbHAgd2l0aCBib29sZWFuIGxvZ2ljIHRyYW5zZm9ybWF0aW9ucyBuZWVkZWQgZm9yIGhhbmRsaW5nXG4gKiBjb21wbGV4IGZpbHRlcnMgdXNlZCBpbiBxdWVyaWVzLlxuICovXG4vKipcbiAqIFRoZSBgaW5gIGZpbHRlciBpcyBvbmx5IGEgc3ludGFjdGljIHN1Z2FyIG92ZXIgYSBkaXNqdW5jdGlvbiBvZiBlcXVhbGl0aWVzLiBGb3IgaW5zdGFuY2U6IGBhIGluXG4gKiBbMSwyLDNdYCBpcyBpbiBmYWN0IGBhPT0xIHx8IGE9PTIgfHwgYT09M2AuIFRoaXMgbWV0aG9kIGV4cGFuZHMgYW55IGBpbmAgZmlsdGVyIGluIHRoZSBnaXZlblxuICogaW5wdXQgaW50byBhIGRpc2p1bmN0aW9uIG9mIGVxdWFsaXR5IGZpbHRlcnMgYW5kIHJldHVybnMgdGhlIGV4cGFuZGVkIGZpbHRlci5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcHV0ZUluRXhwYW5zaW9uKGUpIHtcbiAgICB2YXIgdCwgbjtcbiAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyIHx8IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIpLCBcbiAgICBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIpIHtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfSW5GaWx0ZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSAobnVsbCA9PT0gKG4gPSBudWxsID09PSAodCA9IGUudmFsdWUuYXJyYXlWYWx1ZSkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC52YWx1ZXMpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4ubWFwKCh0ID0+IEZpZWxkRmlsdGVyLmNyZWF0ZShlLmZpZWxkLCBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gLCB0KSkpKSB8fCBbXTtcbiAgICAgICAgICAgIHJldHVybiBDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKHIsIFwib3JcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5PUiAqLyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgaGF2ZSByZWFjaGVkIG90aGVyIGtpbmRzIG9mIGZpZWxkIGZpbHRlcnMuXG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICAvLyBXZSBoYXZlIGEgY29tcG9zaXRlIGZpbHRlci5cbiAgICAgICAgY29uc3QgciA9IGUuZmlsdGVycy5tYXAoKGUgPT4gX19QUklWQVRFX2NvbXB1dGVJbkV4cGFuc2lvbihlKSkpO1xuICAgIHJldHVybiBDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKHIsIGUub3ApO1xufVxuXG4vKipcbiAqIEdpdmVuIGEgY29tcG9zaXRlIGZpbHRlciwgcmV0dXJucyB0aGUgbGlzdCBvZiB0ZXJtcyBpbiBpdHMgZGlzanVuY3RpdmUgbm9ybWFsIGZvcm0uXG4gKlxuICogPHA+RWFjaCBlbGVtZW50IGluIHRoZSByZXR1cm4gdmFsdWUgaXMgb25lIHRlcm0gb2YgdGhlIHJlc3VsdGluZyBETkYuIEZvciBpbnN0YW5jZTogRm9yIHRoZVxuICogaW5wdXQ6IChBIHx8IEIpICYmIEMsIHRoZSBETkYgZm9ybSBpczogKEEgJiYgQykgfHwgKEIgJiYgQyksIGFuZCB0aGUgcmV0dXJuIHZhbHVlIGlzIGEgbGlzdFxuICogd2l0aCB0d28gZWxlbWVudHM6IGEgY29tcG9zaXRlIGZpbHRlciB0aGF0IHBlcmZvcm1zIChBICYmIEMpLCBhbmQgYSBjb21wb3NpdGUgZmlsdGVyIHRoYXRcbiAqIHBlcmZvcm1zIChCICYmIEMpLlxuICpcbiAqIEBwYXJhbSBmaWx0ZXIgdGhlIGNvbXBvc2l0ZSBmaWx0ZXIgdG8gY2FsY3VsYXRlIERORiB0cmFuc2Zvcm0gZm9yLlxuICogQHJldHVybiB0aGUgdGVybXMgaW4gdGhlIERORiB0cmFuc2Zvcm0uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2dldERuZlRlcm1zKGUpIHtcbiAgICBpZiAoMCA9PT0gZS5nZXRGaWx0ZXJzKCkubGVuZ3RoKSByZXR1cm4gW107XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jb21wdXRlRGlzdHJpYnV0ZWROb3JtYWxGb3JtKF9fUFJJVkFURV9jb21wdXRlSW5FeHBhbnNpb24oZSkpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChfX1BSSVZBVEVfaXNEaXNqdW5jdGl2ZU5vcm1hbEZvcm0odCkpLCBfX1BSSVZBVEVfaXNTaW5nbGVGaWVsZEZpbHRlcih0KSB8fCBfX1BSSVZBVEVfaXNGbGF0Q29uanVuY3Rpb24odCkgPyBbIHQgXSA6IHQuZ2V0RmlsdGVycygpO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBmaWx0ZXIgaXMgYSBzaW5nbGUgZmllbGQgZmlsdGVyLiBlLmcuIChhID09IDEwKS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2lzU2luZ2xlRmllbGRGaWx0ZXIoZSkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXI7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBmaWx0ZXIgaXMgdGhlIGNvbmp1bmN0aW9uIG9mIG9uZSBvciBtb3JlIGZpZWxkIGZpbHRlcnMuIGUuZy4gKGEgPT0gMTBcbiAqICYmIGIgPT0gMjApXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2lzRmxhdENvbmp1bmN0aW9uKGUpIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0Q29uanVuY3Rpb24oZSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgZ2l2ZW4gZmlsdGVyIGlzIGluIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtIChETkYpLlxuICpcbiAqIDxwPkluIGJvb2xlYW4gbG9naWMsIGEgZGlzanVuY3RpdmUgbm9ybWFsIGZvcm0gKERORikgaXMgYSBjYW5vbmljYWwgbm9ybWFsIGZvcm0gb2YgYSBsb2dpY2FsXG4gKiBmb3JtdWxhIGNvbnNpc3Rpbmcgb2YgYSBkaXNqdW5jdGlvbiBvZiBjb25qdW5jdGlvbnM7IGl0IGNhbiBhbHNvIGJlIGRlc2NyaWJlZCBhcyBhbiBPUiBvZiBBTkRzLlxuICpcbiAqIDxwPkZvciBtb3JlIGluZm8sIHZpc2l0OiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9EaXNqdW5jdGl2ZV9ub3JtYWxfZm9ybVxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc0Rpc2p1bmN0aXZlTm9ybWFsRm9ybShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9pc1NpbmdsZUZpZWxkRmlsdGVyKGUpIHx8IF9fUFJJVkFURV9pc0ZsYXRDb25qdW5jdGlvbihlKSB8fCBcbiAgICAvKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsdGVyIGlzIHRoZSBkaXNqdW5jdGlvbiBvZiBvbmUgb3IgbW9yZSBcImZsYXQgY29uanVuY3Rpb25zXCIgYW5kXG4gKiBmaWVsZCBmaWx0ZXJzLiBlLmcuIChhID09IDEwKSB8fCAoYj09MjAgJiYgYz09MzApXG4gKi9cbiAgICBmdW5jdGlvbiBfX1BSSVZBVEVfaXNEaXNqdW5jdGlvbk9mRmllbGRGaWx0ZXJzQW5kRmxhdENvbmp1bmN0aW9ucyhlKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyICYmIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Rpc2p1bmN0aW9uKGUpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZS5nZXRGaWx0ZXJzKCkpIGlmICghX19QUklWQVRFX2lzU2luZ2xlRmllbGRGaWx0ZXIodCkgJiYgIV9fUFJJVkFURV9pc0ZsYXRDb25qdW5jdGlvbih0KSkgcmV0dXJuICExO1xuICAgICAgICAgICAgcmV0dXJuICEwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9KGUpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29tcHV0ZURpc3RyaWJ1dGVkTm9ybWFsRm9ybShlKSB7XG4gICAgaWYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciB8fCBlIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSwgXG4gICAgZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyKSByZXR1cm4gZTtcbiAgICBpZiAoMSA9PT0gZS5maWx0ZXJzLmxlbmd0aCkgcmV0dXJuIF9fUFJJVkFURV9jb21wdXRlRGlzdHJpYnV0ZWROb3JtYWxGb3JtKGUuZmlsdGVyc1swXSk7XG4gICAgLy8gQ29tcHV0ZSBETkYgZm9yIGVhY2ggb2YgdGhlIHN1YmZpbHRlcnMgZmlyc3RcbiAgICAgICAgY29uc3QgdCA9IGUuZmlsdGVycy5tYXAoKGUgPT4gX19QUklWQVRFX2NvbXB1dGVEaXN0cmlidXRlZE5vcm1hbEZvcm0oZSkpKTtcbiAgICBsZXQgbiA9IENvbXBvc2l0ZUZpbHRlci5jcmVhdGUodCwgZS5vcCk7XG4gICAgcmV0dXJuIG4gPSBfX1BSSVZBVEVfYXBwbHlBc3NvY2lhdGlvbihuKSwgX19QUklWQVRFX2lzRGlzanVuY3RpdmVOb3JtYWxGb3JtKG4pID8gbiA6IChfX1BSSVZBVEVfaGFyZEFzc2VydChuIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSwgXG4gICAgX19QUklWQVRFX2hhcmRBc3NlcnQoX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzQ29uanVuY3Rpb24obikpLCBfX1BSSVZBVEVfaGFyZEFzc2VydChuLmZpbHRlcnMubGVuZ3RoID4gMSksIFxuICAgIG4uZmlsdGVycy5yZWR1Y2UoKChlLCB0KSA9PiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb24oZSwgdCkpKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseURpc3RyaWJ1dGlvbihlLCB0KSB7XG4gICAgbGV0IG47XG4gICAgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciB8fCBlIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSwgXG4gICAgX19QUklWQVRFX2hhcmRBc3NlcnQodCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyIHx8IHQgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIpLCBcbiAgICAvLyBGaWVsZEZpbHRlciBGaWVsZEZpbHRlclxuICAgIG4gPSBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgPyB0IGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb25GaWVsZEZpbHRlcnMoZSwgdCkge1xuICAgICAgICAvLyBDb25qdW5jdGlvbiBkaXN0cmlidXRpb24gZm9yIHR3byBmaWVsZCBmaWx0ZXJzIGlzIHRoZSBjb25qdW5jdGlvbiBvZiB0aGVtLlxuICAgICAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShbIGUsIHQgXSwgXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8pO1xuICAgIH0oZSwgdCkgOiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb25GaWVsZEFuZENvbXBvc2l0ZUZpbHRlcnMoZSwgdCkgOiB0IGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgPyBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb25GaWVsZEFuZENvbXBvc2l0ZUZpbHRlcnModCwgZSkgOiBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb25Db21wb3NpdGVGaWx0ZXJzKGUsIHQpIHtcbiAgICAgICAgLy8gVGhlcmUgYXJlIGZvdXIgY2FzZXM6XG4gICAgICAgIC8vIChBICYgQikgJiAoQyAmIEQpIC0tPiAoQSAmIEIgJiBDICYgRClcbiAgICAgICAgLy8gKEEgJiBCKSAmIChDIHwgRCkgLS0+IChBICYgQiAmIEMpIHwgKEEgJiBCICYgRClcbiAgICAgICAgLy8gKEEgfCBCKSAmIChDICYgRCkgLS0+IChDICYgRCAmIEEpIHwgKEMgJiBEICYgQilcbiAgICAgICAgLy8gKEEgfCBCKSAmIChDIHwgRCkgLS0+IChBICYgQykgfCAoQSAmIEQpIHwgKEIgJiBDKSB8IChCICYgRClcbiAgICAgICAgLy8gQ2FzZSAxIGlzIGEgbWVyZ2UuXG4gICAgICAgIGlmIChfX1BSSVZBVEVfaGFyZEFzc2VydChlLmZpbHRlcnMubGVuZ3RoID4gMCAmJiB0LmZpbHRlcnMubGVuZ3RoID4gMCksIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKGUpICYmIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKHQpKSByZXR1cm4gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcldpdGhBZGRlZEZpbHRlcnMoZSwgdC5nZXRGaWx0ZXJzKCkpO1xuICAgICAgICAvLyBDYXNlIDIsMyw0IGFsbCBoYXZlIGF0IGxlYXN0IG9uZSBzaWRlIChsaHMgb3IgcmhzKSB0aGF0IGlzIGEgZGlzanVuY3Rpb24uIEluIGFsbCB0aHJlZSBjYXNlc1xuICAgICAgICAvLyB3ZSBzaG91bGQgdGFrZSBlYWNoIGVsZW1lbnQgb2YgdGhlIGRpc2p1bmN0aW9uIGFuZCBkaXN0cmlidXRlIGl0IG92ZXIgdGhlIG90aGVyIHNpZGUsIGFuZFxuICAgICAgICAvLyByZXR1cm4gdGhlIGRpc2p1bmN0aW9uIG9mIHRoZSBkaXN0cmlidXRpb24gcmVzdWx0cy5cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRGlzanVuY3Rpb24oZSkgPyBlIDogdCwgciA9IF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Rpc2p1bmN0aW9uKGUpID8gdCA6IGUsIGkgPSBuLmZpbHRlcnMubWFwKChlID0+IF9fUFJJVkFURV9hcHBseURpc3RyaWJ1dGlvbihlLCByKSkpO1xuICAgICAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShpLCBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8pO1xuICAgIH0oZSwgdCksIF9fUFJJVkFURV9hcHBseUFzc29jaWF0aW9uKG4pO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb25GaWVsZEFuZENvbXBvc2l0ZUZpbHRlcnMoZSwgdCkge1xuICAgIC8vIFRoZXJlIGFyZSB0d28gY2FzZXM6XG4gICAgLy8gQSAmIChCICYgQykgLS0+IChBICYgQiAmIEMpXG4gICAgLy8gQSAmIChCIHwgQykgLS0+IChBICYgQikgfCAoQSAmIEMpXG4gICAgaWYgKF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKHQpKSBcbiAgICAvLyBDYXNlIDFcbiAgICByZXR1cm4gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcldpdGhBZGRlZEZpbHRlcnModCwgZS5nZXRGaWx0ZXJzKCkpO1xuICAgIHtcbiAgICAgICAgLy8gQ2FzZSAyXG4gICAgICAgIGNvbnN0IG4gPSB0LmZpbHRlcnMubWFwKCh0ID0+IF9fUFJJVkFURV9hcHBseURpc3RyaWJ1dGlvbihlLCB0KSkpO1xuICAgICAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShuLCBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBcHBsaWVzIHRoZSBhc3NvY2lhdGl2aXR5IHByb3BlcnR5IHRvIHRoZSBnaXZlbiBmaWx0ZXIgYW5kIHJldHVybnMgdGhlIHJlc3VsdGluZyBmaWx0ZXIuXG4gKlxuICogPHVsPlxuICogICA8bGk+QSB8IChCIHwgQykgPT0gKEEgfCBCKSB8IEMgPT0gKEEgfCBCIHwgQylcbiAqICAgPGxpPkEgJiAoQiAmIEMpID09IChBICYgQikgJiBDID09IChBICYgQiAmIEMpXG4gKiA8L3VsPlxuICpcbiAqIDxwPkZvciBtb3JlIGluZm8sIHZpc2l0OiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Bc3NvY2lhdGl2ZV9wcm9wZXJ0eSNQcm9wb3NpdGlvbmFsX2xvZ2ljXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5QXNzb2NpYXRpb24oZSkge1xuICAgIGlmIChfX1BSSVZBVEVfaGFyZEFzc2VydChlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgfHwgZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciksIFxuICAgIGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlcikgcmV0dXJuIGU7XG4gICAgY29uc3QgdCA9IGUuZ2V0RmlsdGVycygpO1xuICAgIC8vIElmIHRoZSBjb21wb3NpdGUgZmlsdGVyIG9ubHkgY29udGFpbnMgMSBmaWx0ZXIsIGFwcGx5IGFzc29jaWF0aXZpdHkgdG8gaXQuXG4gICAgICAgIGlmICgxID09PSB0Lmxlbmd0aCkgcmV0dXJuIF9fUFJJVkFURV9hcHBseUFzc29jaWF0aW9uKHRbMF0pO1xuICAgIC8vIEFzc29jaWF0aXZpdHkgYXBwbGllZCB0byBhIGZsYXQgY29tcG9zaXRlIGZpbHRlciByZXN1bHRzIGlzIGl0c2VsZi5cbiAgICAgICAgaWYgKF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0ZsYXQoZSkpIHJldHVybiBlO1xuICAgIC8vIEZpcnN0IGFwcGx5IGFzc29jaWF0aXZpdHkgdG8gYWxsIHN1YmZpbHRlcnMuIFRoaXMgd2lsbCBpbiB0dXJuIHJlY3Vyc2l2ZWx5IGFwcGx5XG4gICAgLy8gYXNzb2NpYXRpdml0eSB0byBhbGwgbmVzdGVkIGNvbXBvc2l0ZSBmaWx0ZXJzIGFuZCBmaWVsZCBmaWx0ZXJzLlxuICAgICAgICBjb25zdCBuID0gdC5tYXAoKGUgPT4gX19QUklWQVRFX2FwcGx5QXNzb2NpYXRpb24oZSkpKSwgciA9IFtdO1xuICAgIC8vIEZvciBjb21wb3NpdGUgc3ViZmlsdGVycyB0aGF0IHBlcmZvcm0gdGhlIHNhbWUga2luZCBvZiBsb2dpY2FsIG9wZXJhdGlvbiBhcyBgY29tcG9zaXRlRmlsdGVyYFxuICAgIC8vIHRha2Ugb3V0IHRoZWlyIGZpbHRlcnMgYW5kIGFkZCB0aGVtIHRvIGBjb21wb3NpdGVGaWx0ZXJgLiBGb3IgZXhhbXBsZTpcbiAgICAvLyBjb21wb3NpdGVGaWx0ZXIgPSAoQSB8IChCIHwgQyB8IEQpKVxuICAgIC8vIGNvbXBvc2l0ZVN1YmZpbHRlciA9IChCIHwgQyB8IEQpXG4gICAgLy8gUmVzdWx0OiAoQSB8IEIgfCBDIHwgRClcbiAgICAvLyBOb3RlIHRoYXQgdGhlIGBjb21wb3NpdGVTdWJmaWx0ZXJgIGhhcyBiZWVuIGVsaW1pbmF0ZWQsIGFuZCBpdHMgZmlsdGVycyAoQiwgQywgRCkgaGF2ZSBiZWVuXG4gICAgLy8gYWRkZWQgdG8gdGhlIHRvcC1sZXZlbCBcImNvbXBvc2l0ZUZpbHRlclwiLlxuICAgICAgICByZXR1cm4gbi5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgdCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gci5wdXNoKHQpIDogdCBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiAodC5vcCA9PT0gZS5vcCA/IFxuICAgICAgICAvLyBjb21wb3NpdGVGaWx0ZXI6IChBIHwgKEIgfCBDKSlcbiAgICAgICAgLy8gY29tcG9zaXRlU3ViZmlsdGVyOiAoQiB8IEMpXG4gICAgICAgIC8vIFJlc3VsdDogKEEgfCBCIHwgQylcbiAgICAgICAgci5wdXNoKC4uLnQuZmlsdGVycykgOiBcbiAgICAgICAgLy8gY29tcG9zaXRlRmlsdGVyOiAoQSB8IChCICYgQykpXG4gICAgICAgIC8vIGNvbXBvc2l0ZVN1YmZpbHRlcjogKEIgJiBDKVxuICAgICAgICAvLyBSZXN1bHQ6IChBIHwgKEIgJiBDKSlcbiAgICAgICAgci5wdXNoKHQpKTtcbiAgICB9KSksIDEgPT09IHIubGVuZ3RoID8gclswXSA6IENvbXBvc2l0ZUZpbHRlci5jcmVhdGUociwgZS5vcCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluLW1lbW9yeSBpbXBsZW1lbnRhdGlvbiBvZiBJbmRleE1hbmFnZXIuXG4gKi8gY2xhc3MgX19QUklWQVRFX01lbW9yeUluZGV4TWFuYWdlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudW4gPSBuZXcgX19QUklWQVRFX01lbW9yeUNvbGxlY3Rpb25QYXJlbnRJbmRleDtcbiAgICB9XG4gICAgYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy51bi5hZGQodCksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldENvbGxlY3Rpb25QYXJlbnRzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMudW4uZ2V0RW50cmllcyh0KSk7XG4gICAgfVxuICAgIGFkZEZpZWxkSW5kZXgoZSwgdCkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZGVsZXRlRmllbGRJbmRleChlLCB0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBkZWxldGVBbGxGaWVsZEluZGV4ZXMoZSkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgY3JlYXRlVGFyZ2V0SW5kZXhlcyhlLCB0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXREb2N1bWVudHNNYXRjaGluZ1RhcmdldChlLCB0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgZ2V0SW5kZXhUeXBlKGUsIHQpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKDAgLyogSW5kZXhUeXBlLk5PTkUgKi8pO1xuICAgIH1cbiAgICBnZXRGaWVsZEluZGV4ZXMoZSwgdCkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoW10pO1xuICAgIH1cbiAgICBnZXROZXh0Q29sbGVjdGlvbkdyb3VwVG9VcGRhdGUoZSkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldChlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShJbmRleE9mZnNldC5taW4oKSk7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldEZyb21Db2xsZWN0aW9uR3JvdXAoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoSW5kZXhPZmZzZXQubWluKCkpO1xuICAgIH1cbiAgICB1cGRhdGVDb2xsZWN0aW9uR3JvdXAoZSwgdCwgbikge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlSW5kZXhFbnRyaWVzKGUsIHQpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIHRoZSBjb2xsZWN0aW9uLXBhcmVudCBpbmRleCBleHBvc2VkIGJ5IE1lbW9yeUluZGV4TWFuYWdlci5cbiAqIEFsc28gdXNlZCBmb3IgaW4tbWVtb3J5IGNhY2hpbmcgYnkgSW5kZXhlZERiSW5kZXhNYW5hZ2VyIGFuZCBpbml0aWFsIGluZGV4IHBvcHVsYXRpb25cbiAqIGluIGluZGV4ZWRkYl9zY2hlbWEudHNcbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5Q29sbGVjdGlvblBhcmVudEluZGV4IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5pbmRleCA9IHt9O1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGZhbHNlIGlmIHRoZSBlbnRyeSBhbHJlYWR5IGV4aXN0ZWQuXG4gICAgYWRkKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUubGFzdFNlZ21lbnQoKSwgbiA9IGUucG9wTGFzdCgpLCByID0gdGhpcy5pbmRleFt0XSB8fCBuZXcgU29ydGVkU2V0KFJlc291cmNlUGF0aC5jb21wYXJhdG9yKSwgaSA9ICFyLmhhcyhuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhbdF0gPSByLmFkZChuKSwgaTtcbiAgICB9XG4gICAgaGFzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUubGFzdFNlZ21lbnQoKSwgbiA9IGUucG9wTGFzdCgpLCByID0gdGhpcy5pbmRleFt0XTtcbiAgICAgICAgcmV0dXJuIHIgJiYgci5oYXMobik7XG4gICAgfVxuICAgIGdldEVudHJpZXMoZSkge1xuICAgICAgICByZXR1cm4gKHRoaXMuaW5kZXhbZV0gfHwgbmV3IFNvcnRlZFNldChSZXNvdXJjZVBhdGguY29tcGFyYXRvcikpLnRvQXJyYXkoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IEFlID0gbmV3IFVpbnQ4QXJyYXkoMCk7XG5cbi8qKlxuICogQSBwZXJzaXN0ZWQgaW1wbGVtZW50YXRpb24gb2YgSW5kZXhNYW5hZ2VyLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVW5saWtlIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdlYiBTREsgZG9lcyBub3QgbWVtb2l6ZSBpbmRleFxuICogZGF0YSBhcyBpdCBzdXBwb3J0cyBtdWx0aS10YWIgYWNjZXNzLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiSW5kZXhNYW5hZ2VyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJZCA9IHQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gaW4tbWVtb3J5IGNvcHkgb2YgdGhlIGluZGV4IGVudHJpZXMgd2UndmUgYWxyZWFkeSB3cml0dGVuIHNpbmNlIHRoZSBTREtcbiAgICAgICAgICogbGF1bmNoZWQuIFVzZWQgdG8gYXZvaWQgcmUtd3JpdGluZyB0aGUgc2FtZSBlbnRyeSByZXBlYXRlZGx5LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIGlzICpOT1QqIGEgY29tcGxldGUgY2FjaGUgb2Ygd2hhdCdzIGluIHBlcnNpc3RlbmNlIGFuZCBzbyBjYW4gbmV2ZXIgYmVcbiAgICAgICAgICogdXNlZCB0byBzYXRpc2Z5IHJlYWRzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jbiA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5Q29sbGVjdGlvblBhcmVudEluZGV4LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcHMgZnJvbSBhIHRhcmdldCB0byBpdHMgZXF1aXZhbGVudCBsaXN0IG9mIHN1Yi10YXJnZXRzLiBFYWNoIHN1Yi10YXJnZXRcbiAgICAgICAgICogY29udGFpbnMgb25seSBvbmUgdGVybSBmcm9tIHRoZSB0YXJnZXQncyBkaXNqdW5jdGl2ZSBub3JtYWwgZm9ybSAoRE5GKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG4gPSBuZXcgT2JqZWN0TWFwKChlID0+IF9fUFJJVkFURV9jYW5vbmlmeVRhcmdldChlKSksICgoZSwgdCkgPT4gX19QUklWQVRFX3RhcmdldEVxdWFscyhlLCB0KSkpLCBcbiAgICAgICAgdGhpcy51aWQgPSBlLnVpZCB8fCBcIlwiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbmV3IGVudHJ5IHRvIHRoZSBjb2xsZWN0aW9uIHBhcmVudCBpbmRleC5cbiAgICAgKlxuICAgICAqIFJlcGVhdGVkIGNhbGxzIGZvciB0aGUgc2FtZSBjb2xsZWN0aW9uUGF0aCBzaG91bGQgYmUgYXZvaWRlZCB3aXRoaW4gYVxuICAgICAqIHRyYW5zYWN0aW9uIGFzIEluZGV4ZWREYkluZGV4TWFuYWdlciBvbmx5IGNhY2hlcyB3cml0ZXMgb25jZSBhIHRyYW5zYWN0aW9uXG4gICAgICogaGFzIGJlZW4gY29tbWl0dGVkLlxuICAgICAqLyAgICBhZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCB0KSB7XG4gICAgICAgIGlmICghdGhpcy5jbi5oYXModCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0Lmxhc3RTZWdtZW50KCksIHIgPSB0LnBvcExhc3QoKTtcbiAgICAgICAgICAgIGUuYWRkT25Db21taXR0ZWRMaXN0ZW5lcigoKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgY29sbGVjdGlvbiB0byB0aGUgaW4gbWVtb3J5IGNhY2hlIG9ubHkgaWYgdGhlIHRyYW5zYWN0aW9uIHdhc1xuICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxseSBjb21taXR0ZWQuXG4gICAgICAgICAgICAgICAgdGhpcy5jbi5hZGQodCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCBpID0ge1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JZDogbixcbiAgICAgICAgICAgICAgICBwYXJlbnQ6IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgocilcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2NvbGxlY3Rpb25QYXJlbnRzU3RvcmUoZSkucHV0KGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRDb2xsZWN0aW9uUGFyZW50cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdCwgXCJcIiBdLCBbIF9fUFJJVkFURV9pbW1lZGlhdGVTdWNjZXNzb3IodCksIFwiXCIgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NvbGxlY3Rpb25QYXJlbnRzU3RvcmUoZSkuVShyKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBlKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBjb2xsZWN0aW9uSWQgZ3VhcmQgc2hvdWxkbid0IGJlIG5lY2Vzc2FyeSAoYW5kIGlzbid0IGFzIGxvbmdcbiAgICAgICAgICAgICAgICAvLyBhcyB3ZSdyZSBydW5uaW5nIGluIGEgcmVhbCBicm93c2VyKSwgYnV0IHRoZXJlJ3MgYSBidWcgaW5cbiAgICAgICAgICAgICAgICAvLyBpbmRleGVkZGJzaGltIHRoYXQgYnJlYWtzIG91ciByYW5nZSBpbiBvdXIgdGVzdHMgcnVubmluZyBpbiBub2RlOlxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9heGVtY2xpb24vSW5kZXhlZERCU2hpbS9pc3N1ZXMvMzM0XG4gICAgICAgICAgICAgICAgaWYgKHIuY29sbGVjdGlvbklkICE9PSB0KSBicmVhaztcbiAgICAgICAgICAgICAgICBuLnB1c2goX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChyLnBhcmVudCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgYWRkRmllbGRJbmRleChlLCB0KSB7XG4gICAgICAgIC8vIFRPRE8oaW5kZXhpbmcpOiBWZXJpZnkgdGhhdCB0aGUgYXV0by1pbmNyZW1lbnRpbmcgaW5kZXggSUQgd29ya3MgaW5cbiAgICAgICAgLy8gU2FmYXJpICYgRmlyZWZveC5cbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9pbmRleENvbmZpZ3VyYXRpb25TdG9yZShlKSwgciA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b0RiSW5kZXhDb25maWd1cmF0aW9uKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW5kZXhJZDogZS5pbmRleElkLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25Hcm91cDogZS5jb2xsZWN0aW9uR3JvdXAsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBlLmZpZWxkcy5tYXAoKGUgPT4gWyBlLmZpZWxkUGF0aC5jYW5vbmljYWxTdHJpbmcoKSwgZS5raW5kIF0pKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KTtcbiAgICAgICAgZGVsZXRlIHIuaW5kZXhJZDtcbiAgICAgICAgLy8gYGluZGV4SWRgIGlzIGF1dG8tcG9wdWxhdGVkIGJ5IEluZGV4ZWREYlxuICAgICAgICBjb25zdCBpID0gbi5hZGQocik7XG4gICAgICAgIGlmICh0LmluZGV4U3RhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpO1xuICAgICAgICAgICAgcmV0dXJuIGkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgbi5wdXQoX19QUklWQVRFX3RvRGJJbmRleFN0YXRlKGUsIHRoaXMudWlkLCB0LmluZGV4U3RhdGUuc2VxdWVuY2VOdW1iZXIsIHQuaW5kZXhTdGF0ZS5vZmZzZXQpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaS5uZXh0KCk7XG4gICAgfVxuICAgIGRlbGV0ZUZpZWxkSW5kZXgoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpLCByID0gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKSwgaSA9IF9fUFJJVkFURV9pbmRleEVudHJpZXNTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIG4uZGVsZXRlKHQuaW5kZXhJZCkubmV4dCgoKCkgPT4gci5kZWxldGUoSURCS2V5UmFuZ2UuYm91bmQoWyB0LmluZGV4SWQgXSwgWyB0LmluZGV4SWQgKyAxIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKSkpKS5uZXh0KCgoKSA9PiBpLmRlbGV0ZShJREJLZXlSYW5nZS5ib3VuZChbIHQuaW5kZXhJZCBdLCBbIHQuaW5kZXhJZCArIDEgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApKSkpO1xuICAgIH1cbiAgICBkZWxldGVBbGxGaWVsZEluZGV4ZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpLCBuID0gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpLCByID0gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIHQuaigpLm5leHQoKCgpID0+IG4uaigpKSkubmV4dCgoKCkgPT4gci5qKCkpKTtcbiAgICB9XG4gICAgY3JlYXRlVGFyZ2V0SW5kZXhlcyhlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0aGlzLmhuKHQpLCAodCA9PiB0aGlzLmdldEluZGV4VHlwZShlLCB0KS5uZXh0KChuID0+IHtcbiAgICAgICAgICAgIGlmICgwIC8qIEluZGV4VHlwZS5OT05FICovID09PSBuIHx8IDEgLyogSW5kZXhUeXBlLlBBUlRJQUwgKi8gPT09IG4pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9UYXJnZXRJbmRleE1hdGNoZXIodCkuYW4oKTtcbiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBuKSByZXR1cm4gdGhpcy5hZGRGaWVsZEluZGV4KGUsIG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdUYXJnZXQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpO1xuICAgICAgICBsZXQgciA9ICEwO1xuICAgICAgICBjb25zdCBpID0gbmV3IE1hcDtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHRoaXMuaG4odCksICh0ID0+IHRoaXMuUG4oZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICByICYmIChyID0gISFlKSwgaS5zZXQodCwgZSk7XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChyKSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKGksICgoaSwgcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJJbmRleGVkRGJJbmRleE1hbmFnZXJcIiwgYFVzaW5nIGluZGV4ICR7ZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhUb1N0cmluZyhlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYGlkPSR7ZS5pbmRleElkfXxjZz0ke2UuY29sbGVjdGlvbkdyb3VwfXxmPSR7ZS5maWVsZHMubWFwKChlID0+IGAke2UuZmllbGRQYXRofToke2Uua2luZH1gKSkuam9pbihcIixcIil9YDtcbiAgICAgICAgICAgICAgICAgICAgfShpKX0gdG8gZXhlY3V0ZSAke19fUFJJVkFURV9jYW5vbmlmeVRhcmdldCh0KX1gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbyA9IGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRHZXRBcnJheVZhbHVlcyhlLCB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXRBcnJheVNlZ21lbnQodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBuKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBfX1BSSVZBVEVfdGFyZ2V0R2V0RmllbGRGaWx0ZXJzRm9yUGF0aChlLCBuLmZpZWxkUGF0aCkpIHN3aXRjaCAodC5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC52YWx1ZS5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgdC52YWx1ZSBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGFyZSBub3QgYXJyYXkgZmlsdGVycy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyB0aGUgbGlzdCBvZiB2YWx1ZXMgdGhhdCBhcmUgdXNlZCBpbiAhPSBvciBOT1RfSU4gZmlsdGVycy4gUmV0dXJuc1xuICogYG51bGxgIGlmIHRoZXJlIGFyZSBubyBzdWNoIGZpbHRlcnMuXG4gKi8gKHMsIGkpLCBfID0gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldE5vdEluVmFsdWVzKGUsIHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgTWFwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCByIG9mIF9fUFJJVkFURV9maWVsZEluZGV4R2V0RGlyZWN0aW9uYWxTZWdtZW50cyh0KSkgZm9yIChjb25zdCB0IG9mIF9fUFJJVkFURV90YXJnZXRHZXRGaWVsZEZpbHRlcnNGb3JQYXRoKGUsIHIuZmllbGRQYXRoKSkgc3dpdGNoICh0Lm9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuY29kZSBlcXVhbGl0eSBwcmVmaXgsIHdoaWNoIGlzIGVuY29kZWQgaW4gdGhlIGluZGV4IHZhbHVlIGJlZm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBpbmVxdWFsaXR5IChlLmcuIGBhID09ICdhJyAmJiBiICE9ICdiJ2AgaXMgZW5jb2RlZCB0b1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGB2YWx1ZSAhPSAnYWInYCkuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5zZXQoci5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIHQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdEluL05vdEVxdWFsIGlzIGFsd2F5cyBhIHN1ZmZpeC4gVGhlcmUgY2Fubm90IGJlIGFueSByZW1haW5pbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZWdtZW50cyBhbmQgaGVuY2Ugd2UgY2FuIHJldHVybiBlYXJseSBoZXJlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLnNldChyLmZpZWxkUGF0aC5jYW5vbmljYWxTdHJpbmcoKSwgdC52YWx1ZSksIEFycmF5LmZyb20obi52YWx1ZXMoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtYWluaW5nIGZpbHRlcnMgY2Fubm90IGJlIHVzZWQgYXMgbm90SW4gYm91bmRzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGEgbG93ZXIgYm91bmQgb2YgZmllbGQgdmFsdWVzIHRoYXQgY2FuIGJlIHVzZWQgYXMgYSBzdGFydGluZyBwb2ludCB0b1xuICogc2NhbiB0aGUgaW5kZXggZGVmaW5lZCBieSBgZmllbGRJbmRleGAuIFJldHVybnMgYE1JTl9WQUxVRWAgaWYgbm8gbG93ZXIgYm91bmRcbiAqIGV4aXN0cy5cbiAqLyAocywgaSksIGEgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0R2V0TG93ZXJCb3VuZChlLCB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgciA9ICEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggc2VnbWVudCwgcmV0cmlldmUgYSBsb3dlciBib3VuZCBpZiB0aGVyZSBpcyBhIHN1aXRhYmxlIGZpbHRlciBvclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnRBdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHModCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovID09PSBpLmtpbmQgPyBfX1BSSVZBVEVfdGFyZ2V0R2V0QXNjZW5kaW5nQm91bmQoZSwgaS5maWVsZFBhdGgsIGUuc3RhcnRBdCkgOiBfX1BSSVZBVEVfdGFyZ2V0R2V0RGVzY2VuZGluZ0JvdW5kKGUsIGkuZmllbGRQYXRoLCBlLnN0YXJ0QXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ucHVzaCh0LnZhbHVlKSwgciAmJiAociA9IHQuaW5jbHVzaXZlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQm91bmQobiwgcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGFuIHVwcGVyIGJvdW5kIG9mIGZpZWxkIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIGFzIGFuIGVuZGluZyBwb2ludFxuICogd2hlbiBzY2FubmluZyB0aGUgaW5kZXggZGVmaW5lZCBieSBgZmllbGRJbmRleGAuIFJldHVybnMgYE1BWF9WQUxVRWAgaWYgbm9cbiAqIHVwcGVyIGJvdW5kIGV4aXN0cy5cbiAqLyAocywgaSksIHUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0R2V0VXBwZXJCb3VuZChlLCB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgciA9ICEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggc2VnbWVudCwgcmV0cmlldmUgYW4gdXBwZXIgYm91bmQgaWYgdGhlcmUgaXMgYSBzdWl0YWJsZSBmaWx0ZXIgb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuZEF0LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBpIG9mIF9fUFJJVkFURV9maWVsZEluZGV4R2V0RGlyZWN0aW9uYWxTZWdtZW50cyh0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSAwIC8qIEluZGV4S2luZC5BU0NFTkRJTkcgKi8gPT09IGkua2luZCA/IF9fUFJJVkFURV90YXJnZXRHZXREZXNjZW5kaW5nQm91bmQoZSwgaS5maWVsZFBhdGgsIGUuZW5kQXQpIDogX19QUklWQVRFX3RhcmdldEdldEFzY2VuZGluZ0JvdW5kKGUsIGkuZmllbGRQYXRoLCBlLmVuZEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnB1c2godC52YWx1ZSksIHIgJiYgKHIgPSB0LmluY2x1c2l2ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJvdW5kKG4sIHIpO1xuICAgICAgICAgICAgICAgICAgICB9KHMsIGkpLCBjID0gdGhpcy5JbihpLCBzLCBhKSwgbCA9IHRoaXMuSW4oaSwgcywgdSksIGggPSB0aGlzLlRuKGksIHMsIF8pLCBQID0gdGhpcy5FbihpLmluZGV4SWQsIG8sIGMsIGEuaW5jbHVzaXZlLCBsLCB1LmluY2x1c2l2ZSwgaCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChQLCAoaSA9PiBuLkcoaSwgdC5saW1pdCkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBEb2N1bWVudEtleS5mcm9tU2VnbWVudHModC5kb2N1bWVudEtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5oYXMobikgfHwgKGUgPSBlLmFkZChuKSwgci5wdXNoKG4pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IHIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBobihlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5sbi5nZXQoZSk7XG4gICAgICAgIGlmICh0KSByZXR1cm4gdDtcbiAgICAgICAgaWYgKDAgPT09IGUuZmlsdGVycy5sZW5ndGgpIHQgPSBbIGUgXTsgZWxzZSB7XG4gICAgICAgICAgICB0ID0gX19QUklWQVRFX2dldERuZlRlcm1zKENvbXBvc2l0ZUZpbHRlci5jcmVhdGUoZS5maWx0ZXJzLCBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLykpLm1hcCgodCA9PiBfX1BSSVZBVEVfbmV3VGFyZ2V0KGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIGUub3JkZXJCeSwgdC5nZXRGaWx0ZXJzKCksIGUubGltaXQsIGUuc3RhcnRBdCwgZS5lbmRBdCkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sbi5zZXQoZSwgdCksIHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgYSBrZXkgcmFuZ2UgcXVlcnkgb24gYERiSW5kZXhFbnRyeVN0b3JlYCB0aGF0IHVuaW9ucyBhbGxcbiAgICAgKiBib3VuZHMuXG4gICAgICovICAgIEVuKGUsIHQsIG4sIHIsIGksIHMsIG8pIHtcbiAgICAgICAgLy8gVGhlIG51bWJlciBvZiB0b3RhbCBpbmRleCBzY2FucyB3ZSB1bmlvbiB0b2dldGhlci4gVGhpcyBpcyBzaW1pbGFyIHRvIGFcbiAgICAgICAgLy8gZGlzdHJpYnV0ZWQgbm9ybWFsIGZvcm0sIGJ1dCBhZGFwdGVkIGZvciBhcnJheSB2YWx1ZXMuIFdlIGNyZWF0ZSBhIHNpbmdsZVxuICAgICAgICAvLyBpbmRleCByYW5nZSBwZXIgdmFsdWUgaW4gYW4gQVJSQVlfQ09OVEFJTlMgb3IgQVJSQVlfQ09OVEFJTlNfQU5ZIGZpbHRlclxuICAgICAgICAvLyBjb21iaW5lZCB3aXRoIHRoZSB2YWx1ZXMgZnJvbSB0aGUgcXVlcnkgYm91bmRzLlxuICAgICAgICBjb25zdCBfID0gKG51bGwgIT0gdCA/IHQubGVuZ3RoIDogMSkgKiBNYXRoLm1heChuLmxlbmd0aCwgaS5sZW5ndGgpLCBhID0gXyAvIChudWxsICE9IHQgPyB0Lmxlbmd0aCA6IDEpLCB1ID0gW107XG4gICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgXzsgKytjKSB7XG4gICAgICAgICAgICBjb25zdCBfID0gdCA/IHRoaXMuZG4odFtjIC8gYV0pIDogQWUsIGwgPSB0aGlzLkFuKGUsIF8sIG5bYyAlIGFdLCByKSwgaCA9IHRoaXMuUm4oZSwgXywgaVtjICUgYV0sIHMpLCBQID0gby5tYXAoKHQgPT4gdGhpcy5BbihlLCBfLCB0LCBcbiAgICAgICAgICAgIC8qIGluY2x1c2l2ZT0gKi8gITApKSk7XG4gICAgICAgICAgICB1LnB1c2goLi4udGhpcy5jcmVhdGVSYW5nZShsLCBoLCBQKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHU7XG4gICAgfVxuICAgIC8qKiBHZW5lcmF0ZXMgdGhlIGxvd2VyIGJvdW5kIGZvciBgYXJyYXlWYWx1ZWAgYW5kIGBkaXJlY3Rpb25hbFZhbHVlYC4gKi8gICAgQW4oZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gbmV3IF9fUFJJVkFURV9JbmRleEVudHJ5KGUsIERvY3VtZW50S2V5LmVtcHR5KCksIHQsIG4pO1xuICAgICAgICByZXR1cm4gciA/IGkgOiBpLlp0KCk7XG4gICAgfVxuICAgIC8qKiBHZW5lcmF0ZXMgdGhlIHVwcGVyIGJvdW5kIGZvciBgYXJyYXlWYWx1ZWAgYW5kIGBkaXJlY3Rpb25hbFZhbHVlYC4gKi8gICAgUm4oZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gbmV3IF9fUFJJVkFURV9JbmRleEVudHJ5KGUsIERvY3VtZW50S2V5LmVtcHR5KCksIHQsIG4pO1xuICAgICAgICByZXR1cm4gciA/IGkuWnQoKSA6IGk7XG4gICAgfVxuICAgIFBuKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfVGFyZ2V0SW5kZXhNYXRjaGVyKHQpLCByID0gbnVsbCAhPSB0LmNvbGxlY3Rpb25Hcm91cCA/IHQuY29sbGVjdGlvbkdyb3VwIDogdC5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkSW5kZXhlcyhlLCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgaW5kZXggd2l0aCB0aGUgbW9zdCBudW1iZXIgb2Ygc2VnbWVudHMuXG4gICAgICAgICAgICBsZXQgdCA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHIgb2YgZSkge1xuICAgICAgICAgICAgICAgIG4ucm4ocikgJiYgKCF0IHx8IHIuZmllbGRzLmxlbmd0aCA+IHQuZmllbGRzLmxlbmd0aCkgJiYgKHQgPSByKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldEluZGV4VHlwZShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gMiAvKiBJbmRleFR5cGUuRlVMTCAqLztcbiAgICAgICAgY29uc3QgciA9IHRoaXMuaG4odCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChyLCAodCA9PiB0aGlzLlBuKGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgZSA/IDAgLyogSW5kZXhUeXBlLk5PTkUgKi8gIT09IG4gJiYgZS5maWVsZHMubGVuZ3RoIDwgZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldFNlZ21lbnRDb3VudChlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHQgPSBuZXcgU29ydGVkU2V0KEZpZWxkUGF0aCQxLmNvbXBhcmF0b3IpLCBuID0gITE7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCByIG9mIGUuZmlsdGVycykgZm9yIChjb25zdCBlIG9mIHIuZ2V0RmxhdHRlbmVkRmlsdGVycygpKSBcbiAgICAgICAgICAgICAgICAvLyBfX25hbWVfXyBpcyBub3QgYW4gZXhwbGljaXQgc2VnbWVudCBvZiBhbnkgaW5kZXgsIHNvIHdlIGRvbid0IG5lZWQgdG9cbiAgICAgICAgICAgICAgICAvLyBjb3VudCBpdC5cbiAgICAgICAgICAgICAgICBlLmZpZWxkLmlzS2V5RmllbGQoKSB8fCAoXG4gICAgICAgICAgICAgICAgLy8gQVJSQVlfQ09OVEFJTlMgb3IgQVJSQVlfQ09OVEFJTlNfQU5ZIGZpbHRlcnMgbXVzdCBiZSBjb3VudGVkIHNlcGFyYXRlbHkuXG4gICAgICAgICAgICAgICAgLy8gRm9yIGluc3RhbmNlLCBpdCBpcyBwb3NzaWJsZSB0byBoYXZlIGFuIGluZGV4IGZvciBcImEgQVJSQVkgYSBBU0NcIi4gRXZlblxuICAgICAgICAgICAgICAgIC8vIHRob3VnaCB0aGVzZSBhcmUgb24gdGhlIHNhbWUgZmllbGQsIHRoZXkgc2hvdWxkIGJlIGNvdW50ZWQgYXMgdHdvXG4gICAgICAgICAgICAgICAgLy8gc2VwYXJhdGUgc2VnbWVudHMgaW4gYW4gaW5kZXguXG4gICAgICAgICAgICAgICAgXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovID09PSBlLm9wIHx8IFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovID09PSBlLm9wID8gbiA9ICEwIDogdCA9IHQuYWRkKGUuZmllbGQpKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZS5vcmRlckJ5KSBcbiAgICAgICAgICAgICAgICAvLyBfX25hbWVfXyBpcyBub3QgYW4gZXhwbGljaXQgc2VnbWVudCBvZiBhbnkgaW5kZXgsIHNvIHdlIGRvbid0IG5lZWQgdG9cbiAgICAgICAgICAgICAgICAvLyBjb3VudCBpdC5cbiAgICAgICAgICAgICAgICBuLmZpZWxkLmlzS2V5RmllbGQoKSB8fCAodCA9IHQuYWRkKG4uZmllbGQpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5zaXplICsgKG4gPyAxIDogMCk7XG4gICAgICAgICAgICB9KHQpICYmIChuID0gMSAvKiBJbmRleFR5cGUuUEFSVElBTCAqLykgOiBuID0gMCAvKiBJbmRleFR5cGUuTk9ORSAqLztcbiAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gXG4gICAgICAgIC8vIE9SIHF1ZXJpZXMgaGF2ZSBtb3JlIHRoYW4gb25lIHN1Yi10YXJnZXQgKG9uZSBzdWItdGFyZ2V0IHBlciBETkYgdGVybSkuIFdlIGN1cnJlbnRseSBjb25zaWRlclxuICAgICAgICAvLyBPUiBxdWVyaWVzIHRoYXQgaGF2ZSBhIGBsaW1pdGAgdG8gaGF2ZSBhIHBhcnRpYWwgaW5kZXguIEZvciBzdWNoIHF1ZXJpZXMgd2UgcGVyZm9ybSBzb3J0aW5nXG4gICAgICAgIC8vIGFuZCBhcHBseSB0aGUgbGltaXQgaW4gbWVtb3J5IGFzIGEgcG9zdC1wcm9jZXNzaW5nIHN0ZXAuXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRIYXNMaW1pdChlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbCAhPT0gZS5saW1pdDtcbiAgICAgICAgfSh0KSAmJiByLmxlbmd0aCA+IDEgJiYgMiAvKiBJbmRleFR5cGUuRlVMTCAqLyA9PT0gbiA/IDEgLyogSW5kZXhUeXBlLlBBUlRJQUwgKi8gOiBuKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGJ5dGUgZW5jb2RlZCBmb3JtIG9mIHRoZSBkaXJlY3Rpb25hbCB2YWx1ZXMgaW4gdGhlIGZpZWxkIGluZGV4LlxuICAgICAqIFJldHVybnMgYG51bGxgIGlmIHRoZSBkb2N1bWVudCBkb2VzIG5vdCBoYXZlIGFsbCBmaWVsZHMgc3BlY2lmaWVkIGluIHRoZVxuICAgICAqIGluZGV4LlxuICAgICAqLyAgICBWbihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0luZGV4Qnl0ZUVuY29kZXI7XG4gICAgICAgIGZvciAoY29uc3QgciBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHMoZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmRhdGEuZmllbGQoci5maWVsZFBhdGgpO1xuICAgICAgICAgICAgaWYgKG51bGwgPT0gZSkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBjb25zdCBpID0gbi5ZdChyLmtpbmQpO1xuICAgICAgICAgICAgX19QUklWQVRFX0ZpcmVzdG9yZUluZGV4VmFsdWVXcml0ZXIudnQuSXQoZSwgaSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG4uenQoKTtcbiAgICB9XG4gICAgLyoqIEVuY29kZXMgYSBzaW5nbGUgdmFsdWUgdG8gdGhlIGFzY2VuZGluZyBpbmRleCBmb3JtYXQuICovICAgIGRuKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfSW5kZXhCeXRlRW5jb2RlcjtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLnZ0Lkl0KGUsIHQuWXQoMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovKSksIFxuICAgICAgICB0Lnp0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gZW5jb2RlZCBmb3JtIG9mIHRoZSBkb2N1bWVudCBrZXkgdGhhdCBzb3J0cyBiYXNlZCBvbiB0aGUga2V5XG4gICAgICogb3JkZXJpbmcgb2YgdGhlIGZpZWxkIGluZGV4LlxuICAgICAqLyAgICBtbihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0luZGV4Qnl0ZUVuY29kZXI7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfRmlyZXN0b3JlSW5kZXhWYWx1ZVdyaXRlci52dC5JdChfX1BSSVZBVEVfcmVmVmFsdWUodGhpcy5kYXRhYmFzZUlkLCB0KSwgbi5ZdChmdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRJbmRleEdldEtleU9yZGVyKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHMoZSk7XG4gICAgICAgICAgICByZXR1cm4gMCA9PT0gdC5sZW5ndGggPyAwIC8qIEluZGV4S2luZC5BU0NFTkRJTkcgKi8gOiB0W3QubGVuZ3RoIC0gMV0ua2luZDtcbiAgICAgICAgfShlKSkpLCBuLnp0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuY29kZXMgdGhlIGdpdmVuIGZpZWxkIHZhbHVlcyBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmljYXRpb24gaW4gYHRhcmdldGAuXG4gICAgICogRm9yIElOIHF1ZXJpZXMsIGEgbGlzdCBvZiBwb3NzaWJsZSB2YWx1ZXMgaXMgcmV0dXJuZWQuXG4gICAgICovICAgIFRuKGUsIHQsIG4pIHtcbiAgICAgICAgaWYgKG51bGwgPT09IG4pIHJldHVybiBbXTtcbiAgICAgICAgbGV0IHIgPSBbXTtcbiAgICAgICAgci5wdXNoKG5ldyBfX1BSSVZBVEVfSW5kZXhCeXRlRW5jb2Rlcik7XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBzIG9mIF9fUFJJVkFURV9maWVsZEluZGV4R2V0RGlyZWN0aW9uYWxTZWdtZW50cyhlKSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IG5baSsrXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiByKSBpZiAodGhpcy5mbih0LCBzLmZpZWxkUGF0aCkgJiYgaXNBcnJheShlKSkgciA9IHRoaXMuZ24ociwgcywgZSk7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBuLll0KHMua2luZCk7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX0ZpcmVzdG9yZUluZGV4VmFsdWVXcml0ZXIudnQuSXQoZSwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucG4ocik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuY29kZXMgdGhlIGdpdmVuIGJvdW5kcyBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmljYXRpb24gaW4gYHRhcmdldGAuIEZvciBJTlxuICAgICAqIHF1ZXJpZXMsIGEgbGlzdCBvZiBwb3NzaWJsZSB2YWx1ZXMgaXMgcmV0dXJuZWQuXG4gICAgICovICAgIEluKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVG4oZSwgdCwgbi5wb3NpdGlvbik7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBieXRlIHJlcHJlc2VudGF0aW9uIGZvciB0aGUgcHJvdmlkZWQgZW5jb2RlcnMuICovICAgIHBuKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUubGVuZ3RoOyArK24pIHRbbl0gPSBlW25dLnp0KCk7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgc2VwYXJhdGUgZW5jb2RlciBmb3IgZWFjaCBlbGVtZW50IG9mIGFuIGFycmF5LlxuICAgICAqXG4gICAgICogVGhlIG1ldGhvZCBhcHBlbmRzIGVhY2ggdmFsdWUgdG8gYWxsIGV4aXN0aW5nIGVuY29kZXJzIChlLmcuIGZpbHRlcihcImFcIixcbiAgICAgKiBcIj09XCIsIFwiYTFcIikuZmlsdGVyKFwiYlwiLCBcImluXCIsIFtcImIxXCIsIFwiYjJcIl0pIGJlY29tZXMgW1wiYTEsYjFcIiwgXCJhMSxiMlwiXSkuIEFcbiAgICAgKiBsaXN0IG9mIG5ldyBlbmNvZGVycyBpcyByZXR1cm5lZC5cbiAgICAgKi8gICAgZ24oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gWyAuLi5lIF0sIGkgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIG4uYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10pIGZvciAoY29uc3QgbiBvZiByKSB7XG4gICAgICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9JbmRleEJ5dGVFbmNvZGVyO1xuICAgICAgICAgICAgci5zZWVkKG4uenQoKSksIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLnZ0Lkl0KGUsIHIuWXQodC5raW5kKSksIGkucHVzaChyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaTtcbiAgICB9XG4gICAgZm4oZSwgdCkge1xuICAgICAgICByZXR1cm4gISFlLmZpbHRlcnMuZmluZCgoZSA9PiBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgJiYgZS5maWVsZC5pc0VxdWFsKHQpICYmIChcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IGUub3AgfHwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gPT09IGUub3ApKSk7XG4gICAgfVxuICAgIGdldEZpZWxkSW5kZXhlcyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhDb25maWd1cmF0aW9uU3RvcmUoZSksIHIgPSBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpO1xuICAgICAgICByZXR1cm4gKHQgPyBuLlUoXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLCBJREJLZXlSYW5nZS5ib3VuZCh0LCB0KSkgOiBuLlUoKSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2goZSwgKGUgPT4gci5nZXQoWyBlLmluZGV4SWQsIHRoaXMudWlkIF0pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgICAgIHQucHVzaChmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiSW5kZXhDb25maWd1cmF0aW9uKGUsIHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHQgPyBuZXcgSW5kZXhTdGF0ZSh0LnNlcXVlbmNlTnVtYmVyLCBuZXcgSW5kZXhPZmZzZXQoX19QUklWQVRFX2Zyb21EYlRpbWVzdGFtcCh0LnJlYWRUaW1lKSwgbmV3IERvY3VtZW50S2V5KF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgodC5kb2N1bWVudEtleSkpLCB0Lmxhcmdlc3RCYXRjaElkKSkgOiBJbmRleFN0YXRlLmVtcHR5KCksIHIgPSBlLmZpZWxkcy5tYXAoKChbZSwgdF0pID0+IG5ldyBJbmRleFNlZ21lbnQoRmllbGRQYXRoJDEuZnJvbVNlcnZlckZvcm1hdChlKSwgdCkpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZEluZGV4KGUuaW5kZXhJZCwgZS5jb2xsZWN0aW9uR3JvdXAsIHIsIG4pO1xuICAgICAgICAgICAgICAgIH0oZSwgbikpO1xuICAgICAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gdCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldE5leHRDb2xsZWN0aW9uR3JvdXBUb1VwZGF0ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkSW5kZXhlcyhlKS5uZXh0KChlID0+IDAgPT09IGUubGVuZ3RoID8gbnVsbCA6IChlLnNvcnQoKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5pbmRleFN0YXRlLnNlcXVlbmNlTnVtYmVyIC0gdC5pbmRleFN0YXRlLnNlcXVlbmNlTnVtYmVyO1xuICAgICAgICAgICAgcmV0dXJuIDAgIT09IG4gPyBuIDogX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5jb2xsZWN0aW9uR3JvdXAsIHQuY29sbGVjdGlvbkdyb3VwKTtcbiAgICAgICAgfSkpLCBlWzBdLmNvbGxlY3Rpb25Hcm91cCkpKTtcbiAgICB9XG4gICAgdXBkYXRlQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9pbmRleENvbmZpZ3VyYXRpb25TdG9yZShlKSwgaSA9IF9fUFJJVkFURV9pbmRleFN0YXRlU3RvcmUoZSk7XG4gICAgICAgIHJldHVybiB0aGlzLnluKGUpLm5leHQoKGUgPT4gci5VKFwiY29sbGVjdGlvbkdyb3VwSW5kZXhcIiwgSURCS2V5UmFuZ2UuYm91bmQodCwgdCkpLm5leHQoKHQgPT4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKHQgPT4gaS5wdXQoX19QUklWQVRFX3RvRGJJbmRleFN0YXRlKHQuaW5kZXhJZCwgdGhpcy51aWQsIGUsIG4pKSkpKSkpKTtcbiAgICB9XG4gICAgdXBkYXRlSW5kZXhFbnRyaWVzKGUsIHQpIHtcbiAgICAgICAgLy8gUG9ydGluZyBOb3RlOiBgZ2V0RmllbGRJbmRleGVzKClgIG9uIFdlYiBkb2VzIG5vdCBjYWNoZSBpbmRleCBsb29rdXBzIGFzXG4gICAgICAgIC8vIGl0IGNvdWxkIGJlIHVzZWQgYWNyb3NzIGRpZmZlcmVudCBJbmRleGVkREIgdHJhbnNhY3Rpb25zLiBBcyBhbnkgY2FjaGVkXG4gICAgICAgIC8vIGRhdGEgbWlnaHQgYmUgaW52YWxpZGF0ZWQgYnkgb3RoZXIgbXVsdGktdGFiIGNsaWVudHMsIHdlIGNhbiBvbmx5IHRydXN0XG4gICAgICAgIC8vIGRhdGEgd2l0aGluIGEgc2luZ2xlIEluZGV4ZWREQiB0cmFuc2FjdGlvbi4gV2UgdGhlcmVmb3JlIGFkZCBhIGNhY2hlXG4gICAgICAgIC8vIGhlcmUuXG4gICAgICAgIGNvbnN0IG4gPSBuZXcgTWFwO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKCh0LCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gbi5nZXQodC5jb2xsZWN0aW9uR3JvdXApO1xuICAgICAgICAgICAgcmV0dXJuIChpID8gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoaSkgOiB0aGlzLmdldEZpZWxkSW5kZXhlcyhlLCB0LmNvbGxlY3Rpb25Hcm91cCkpLm5leHQoKGkgPT4gKG4uc2V0KHQuY29sbGVjdGlvbkdyb3VwLCBpKSwgXG4gICAgICAgICAgICBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChpLCAobiA9PiB0aGlzLnduKGUsIHQsIG4pLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLlNuKHIsIG4pO1xuICAgICAgICAgICAgICAgIHJldHVybiB0LmlzRXF1YWwoaSkgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpIDogdGhpcy5ibihlLCByLCBuLCB0LCBpKTtcbiAgICAgICAgICAgIH0pKSkpKSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIERuKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9pbmRleEVudHJpZXNTdG9yZShlKS5wdXQoe1xuICAgICAgICAgICAgaW5kZXhJZDogci5pbmRleElkLFxuICAgICAgICAgICAgdWlkOiB0aGlzLnVpZCxcbiAgICAgICAgICAgIGFycmF5VmFsdWU6IHIuYXJyYXlWYWx1ZSxcbiAgICAgICAgICAgIGRpcmVjdGlvbmFsVmFsdWU6IHIuZGlyZWN0aW9uYWxWYWx1ZSxcbiAgICAgICAgICAgIG9yZGVyZWREb2N1bWVudEtleTogdGhpcy5tbihuLCB0LmtleSksXG4gICAgICAgICAgICBkb2N1bWVudEtleTogdC5rZXkucGF0aC50b0FycmF5KClcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHZuKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9pbmRleEVudHJpZXNTdG9yZShlKS5kZWxldGUoWyByLmluZGV4SWQsIHRoaXMudWlkLCByLmFycmF5VmFsdWUsIHIuZGlyZWN0aW9uYWxWYWx1ZSwgdGhpcy5tbihuLCB0LmtleSksIHQua2V5LnBhdGgudG9BcnJheSgpIF0pO1xuICAgIH1cbiAgICB3bihlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfaW5kZXhFbnRyaWVzU3RvcmUoZSk7XG4gICAgICAgIGxldCBpID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gci5KKHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50S2V5SW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS5vbmx5KFsgbi5pbmRleElkLCB0aGlzLnVpZCwgdGhpcy5tbihuLCB0KSBdKVxuICAgICAgICB9LCAoKGUsIHIpID0+IHtcbiAgICAgICAgICAgIGkgPSBpLmFkZChuZXcgX19QUklWQVRFX0luZGV4RW50cnkobi5pbmRleElkLCB0LCByLmFycmF5VmFsdWUsIHIuZGlyZWN0aW9uYWxWYWx1ZSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyB0aGUgaW5kZXggZW50cmllcyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50LiAqLyAgICBTbihlLCB0KSB7XG4gICAgICAgIGxldCBuID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IpO1xuICAgICAgICBjb25zdCByID0gdGhpcy5Wbih0LCBlKTtcbiAgICAgICAgaWYgKG51bGwgPT0gcikgcmV0dXJuIG47XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZmllbGRJbmRleEdldEFycmF5U2VnbWVudCh0KTtcbiAgICAgICAgaWYgKG51bGwgIT0gaSkge1xuICAgICAgICAgICAgY29uc3QgcyA9IGUuZGF0YS5maWVsZChpLmZpZWxkUGF0aCk7XG4gICAgICAgICAgICBpZiAoaXNBcnJheShzKSkgZm9yIChjb25zdCBpIG9mIHMuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10pIG4gPSBuLmFkZChuZXcgX19QUklWQVRFX0luZGV4RW50cnkodC5pbmRleElkLCBlLmtleSwgdGhpcy5kbihpKSwgcikpO1xuICAgICAgICB9IGVsc2UgbiA9IG4uYWRkKG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeSh0LmluZGV4SWQsIGUua2V5LCBBZSwgcikpO1xuICAgICAgICByZXR1cm4gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgaW5kZXggZW50cmllcyBmb3IgdGhlIHByb3ZpZGVkIGRvY3VtZW50IGJ5IGRlbGV0aW5nIGVudHJpZXNcbiAgICAgKiB0aGF0IGFyZSBubyBsb25nZXIgcmVmZXJlbmNlZCBpbiBgbmV3RW50cmllc2AgYW5kIGFkZGluZyBhbGwgbmV3bHkgYWRkZWRcbiAgICAgKiBlbnRyaWVzLlxuICAgICAqLyAgICBibihlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4ZWREYkluZGV4TWFuYWdlclwiLCBcIlVwZGF0aW5nIGluZGV4IGVudHJpZXMgZm9yIGRvY3VtZW50ICclcydcIiwgdC5rZXkpO1xuICAgICAgICBjb25zdCBzID0gW107XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZGlmZlNvcnRlZFNldHMoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICAgICAgY29uc3QgcyA9IGUuZ2V0SXRlcmF0b3IoKSwgbyA9IHQuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgICAgIGxldCBfID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihzKSwgYSA9IF9fUFJJVkFURV9hZHZhbmNlSXRlcmF0b3Iobyk7XG4gICAgICAgICAgICAvLyBXYWxrIHRocm91Z2ggdGhlIHR3byBzZXRzIGF0IHRoZSBzYW1lIHRpbWUsIHVzaW5nIHRoZSBvcmRlcmluZyBkZWZpbmVkIGJ5XG4gICAgICAgICAgICAvLyBgY29tcGFyYXRvcmAuXG4gICAgICAgICAgICBmb3IgKDtfIHx8IGE7ICkge1xuICAgICAgICAgICAgICAgIGxldCBlID0gITEsIHQgPSAhMTtcbiAgICAgICAgICAgICAgICBpZiAoXyAmJiBhKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBuKF8sIGEpO1xuICAgICAgICAgICAgICAgICAgICByIDwgMCA/IFxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudCB3YXMgcmVtb3ZlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkXG4gICAgICAgICAgICAgICAgICAgIC8vIHdhbGt0aHJvdWdoIGlzIG9ubHkgaW4gYGJlZm9yZWAuXG4gICAgICAgICAgICAgICAgICAgIHQgPSAhMCA6IHIgPiAwICYmIChcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVsZW1lbnQgd2FzIGFkZGVkIGlmIHRoZSBuZXh0IGVsZW1lbnQgaW4gb3VyIG9yZGVyZWQgd2Fsa3Rocm91Z2hcbiAgICAgICAgICAgICAgICAgICAgLy8gaXMgb25seSBpbiBgYWZ0ZXJgLlxuICAgICAgICAgICAgICAgICAgICBlID0gITApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBudWxsICE9IF8gPyB0ID0gITAgOiBlID0gITA7XG4gICAgICAgICAgICAgICAgZSA/IChyKGEpLCBhID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihvKSkgOiB0ID8gKGkoXyksIF8gPSBfX1BSSVZBVEVfYWR2YW5jZUl0ZXJhdG9yKHMpKSA6IChfID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihzKSwgXG4gICAgICAgICAgICAgICAgYSA9IF9fUFJJVkFURV9hZHZhbmNlSXRlcmF0b3IobykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KHIsIGksIF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvciwgKFxuICAgICAgICAvKiBvbkFkZD0gKi8gciA9PiB7XG4gICAgICAgICAgICBzLnB1c2godGhpcy5EbihlLCB0LCBuLCByKSk7XG4gICAgICAgIH0pLCAoXG4gICAgICAgIC8qIG9uUmVtb3ZlPSAqLyByID0+IHtcbiAgICAgICAgICAgIHMucHVzaCh0aGlzLnZuKGUsIHQsIG4sIHIpKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihzKTtcbiAgICB9XG4gICAgeW4oZSkge1xuICAgICAgICBsZXQgdCA9IDE7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpLkooe1xuICAgICAgICAgICAgaW5kZXg6IFwic2VxdWVuY2VOdW1iZXJJbmRleFwiLFxuICAgICAgICAgICAgcmV2ZXJzZTogITAsXG4gICAgICAgICAgICByYW5nZTogSURCS2V5UmFuZ2UudXBwZXJCb3VuZChbIHRoaXMudWlkLCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiBdKVxuICAgICAgICB9LCAoKGUsIG4sIHIpID0+IHtcbiAgICAgICAgICAgIHIuZG9uZSgpLCB0ID0gbi5zZXF1ZW5jZU51bWJlciArIDE7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBuZXcgc2V0IG9mIElEQiByYW5nZXMgdGhhdCBzcGxpdHMgdGhlIGV4aXN0aW5nIHJhbmdlIGFuZCBleGNsdWRlc1xuICAgICAqIGFueSB2YWx1ZXMgdGhhdCBtYXRjaCB0aGUgYG5vdEluVmFsdWVgIGZyb20gdGhlc2UgcmFuZ2VzLiBBcyBhbiBleGFtcGxlLFxuICAgICAqICdbZm9vID4gMiAmJiBmb28gIT0gM11gIGJlY29tZXMgIGBbZm9vID4gMiAmJiA8IDMsIGZvbyA+IDNdYC5cbiAgICAgKi8gICAgY3JlYXRlUmFuZ2UoZSwgdCwgbikge1xuICAgICAgICAvLyBUaGUgbm90SW4gdmFsdWVzIG5lZWQgdG8gYmUgc29ydGVkIGFuZCB1bmlxdWUgc28gdGhhdCB3ZSBjYW4gcmV0dXJuIGFcbiAgICAgICAgLy8gc29ydGVkIHNldCBvZiBub24tb3ZlcmxhcHBpbmcgcmFuZ2VzLlxuICAgICAgICBuID0gbi5zb3J0KCgoZSwgdCkgPT4gX19QUklWQVRFX2luZGV4RW50cnlDb21wYXJhdG9yKGUsIHQpKSkuZmlsdGVyKCgoZSwgdCwgbikgPT4gIXQgfHwgMCAhPT0gX19QUklWQVRFX2luZGV4RW50cnlDb21wYXJhdG9yKGUsIG5bdCAtIDFdKSkpO1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHIucHVzaChlKTtcbiAgICAgICAgZm9yIChjb25zdCBpIG9mIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoaSwgZSksIHMgPSBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoaSwgdCk7XG4gICAgICAgICAgICBpZiAoMCA9PT0gbikgXG4gICAgICAgICAgICAvLyBgbm90SW5WYWx1ZWAgaXMgdGhlIGxvd2VyIGJvdW5kLiBXZSB0aGVyZWZvcmUgbmVlZCB0byByYWlzZSB0aGUgYm91bmRcbiAgICAgICAgICAgIC8vIHRvIHRoZSBuZXh0IHZhbHVlLlxuICAgICAgICAgICAgclswXSA9IGUuWnQoKTsgZWxzZSBpZiAobiA+IDAgJiYgcyA8IDApIFxuICAgICAgICAgICAgLy8gYG5vdEluVmFsdWVgIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICByLnB1c2goaSksIHIucHVzaChpLlp0KCkpOyBlbHNlIGlmIChzID4gMCkgXG4gICAgICAgICAgICAvLyBgbm90SW5WYWx1ZWAgKGFuZCBhbGwgZm9sbG93aW5nIHZhbHVlcykgYXJlIG91dCBvZiB0aGUgcmFuZ2VcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHIucHVzaCh0KTtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHIubGVuZ3RoOyBlICs9IDIpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIGVuY291bnRlciB0d28gYm91bmRzIHRoYXQgd2lsbCBjcmVhdGUgYW4gdW5tYXRjaGFibGUga2V5IHJhbmdlLFxuICAgICAgICAgICAgLy8gdGhlbiB3ZSByZXR1cm4gYW4gZW1wdHkgc2V0IG9mIGtleSByYW5nZXMuXG4gICAgICAgICAgICBpZiAodGhpcy5DbihyW2VdLCByW2UgKyAxXSkpIHJldHVybiBbXTtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBbIHJbZV0uaW5kZXhJZCwgdGhpcy51aWQsIHJbZV0uYXJyYXlWYWx1ZSwgcltlXS5kaXJlY3Rpb25hbFZhbHVlLCBBZSwgW10gXSwgbiA9IFsgcltlICsgMV0uaW5kZXhJZCwgdGhpcy51aWQsIHJbZSArIDFdLmFycmF5VmFsdWUsIHJbZSArIDFdLmRpcmVjdGlvbmFsVmFsdWUsIEFlLCBbXSBdO1xuICAgICAgICAgICAgaS5wdXNoKElEQktleVJhbmdlLmJvdW5kKHQsIG4pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaTtcbiAgICB9XG4gICAgQ24oZSwgdCkge1xuICAgICAgICAvLyBJZiBsb3dlciBib3VuZCBpcyBncmVhdGVyIHRoYW4gdGhlIHVwcGVyIGJvdW5kLCB0aGVuIHRoZSBrZXlcbiAgICAgICAgLy8gcmFuZ2UgY2FuIG5ldmVyIGJlIG1hdGNoZWQuXG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoZSwgdCkgPiAwO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXRGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGRJbmRleGVzKGUsIHQpLm5leHQoX19QUklWQVRFX2dldE1pbk9mZnNldEZyb21GaWVsZEluZGV4ZXMpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLm1hcEFycmF5KHRoaXMuaG4odCksICh0ID0+IHRoaXMuUG4oZSwgdCkubmV4dCgoZSA9PiBlIHx8IGZhaWwoKSkpKSkubmV4dChfX1BSSVZBVEVfZ2V0TWluT2Zmc2V0RnJvbUZpZWxkSW5kZXhlcyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgY29sbGVjdGlvblBhcmVudHNcbiAqIGRvY3VtZW50IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jb2xsZWN0aW9uUGFyZW50c1N0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwiY29sbGVjdGlvblBhcmVudHNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBpbmRleCBlbnRyeSBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwiaW5kZXhFbnRyaWVzXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgaW5kZXggY29uZmlndXJhdGlvbiBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwiaW5kZXhDb25maWd1cmF0aW9uXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgaW5kZXggc3RhdGUgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pbmRleFN0YXRlU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJpbmRleFN0YXRlXCIpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0TWluT2Zmc2V0RnJvbUZpZWxkSW5kZXhlcyhlKSB7XG4gICAgX19QUklWQVRFX2hhcmRBc3NlcnQoMCAhPT0gZS5sZW5ndGgpO1xuICAgIGxldCB0ID0gZVswXS5pbmRleFN0YXRlLm9mZnNldCwgbiA9IHQubGFyZ2VzdEJhdGNoSWQ7XG4gICAgZm9yIChsZXQgciA9IDE7IHIgPCBlLmxlbmd0aDsgcisrKSB7XG4gICAgICAgIGNvbnN0IGkgPSBlW3JdLmluZGV4U3RhdGUub2Zmc2V0O1xuICAgICAgICBfX1BSSVZBVEVfaW5kZXhPZmZzZXRDb21wYXJhdG9yKGksIHQpIDwgMCAmJiAodCA9IGkpLCBuIDwgaS5sYXJnZXN0QmF0Y2hJZCAmJiAobiA9IGkubGFyZ2VzdEJhdGNoSWQpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEluZGV4T2Zmc2V0KHQucmVhZFRpbWUsIHQuZG9jdW1lbnRLZXksIG4pO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBSZSA9IHtcbiAgICBkaWRSdW46ICExLFxuICAgIHNlcXVlbmNlTnVtYmVyc0NvbGxlY3RlZDogMCxcbiAgICB0YXJnZXRzUmVtb3ZlZDogMCxcbiAgICBkb2N1bWVudHNSZW1vdmVkOiAwXG59O1xuXG5jbGFzcyBMcnVQYXJhbXMge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8vIFdoZW4gd2UgYXR0ZW1wdCB0byBjb2xsZWN0LCB3ZSB3aWxsIG9ubHkgZG8gc28gaWYgdGhlIGNhY2hlIHNpemUgaXMgZ3JlYXRlciB0aGFuIHRoaXNcbiAgICAvLyB0aHJlc2hvbGQuIFBhc3NpbmcgYENPTExFQ1RJT05fRElTQUJMRURgIGhlcmUgd2lsbCBjYXVzZSBjb2xsZWN0aW9uIHRvIGFsd2F5cyBiZSBza2lwcGVkLlxuICAgIGUsIFxuICAgIC8vIFRoZSBwZXJjZW50YWdlIG9mIHNlcXVlbmNlIG51bWJlcnMgdGhhdCB3ZSB3aWxsIGF0dGVtcHQgdG8gY29sbGVjdFxuICAgIHQsIFxuICAgIC8vIEEgY2FwIG9uIHRoZSB0b3RhbCBudW1iZXIgb2Ygc2VxdWVuY2UgbnVtYmVycyB0aGF0IHdpbGwgYmUgY29sbGVjdGVkLiBUaGlzIHByZXZlbnRzXG4gICAgLy8gdXMgZnJvbSBjb2xsZWN0aW5nIGEgaHVnZSBudW1iZXIgb2Ygc2VxdWVuY2UgbnVtYmVycyBpZiB0aGUgY2FjaGUgaGFzIGdyb3duIHZlcnkgbGFyZ2UuXG4gICAgbikge1xuICAgICAgICB0aGlzLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQgPSBlLCB0aGlzLnBlcmNlbnRpbGVUb0NvbGxlY3QgPSB0LCB0aGlzLm1heGltdW1TZXF1ZW5jZU51bWJlcnNUb0NvbGxlY3QgPSBuO1xuICAgIH1cbiAgICBzdGF0aWMgd2l0aENhY2hlU2l6ZShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTHJ1UGFyYW1zKGUsIExydVBhcmFtcy5ERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSwgTHJ1UGFyYW1zLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBEZWxldGUgYSBtdXRhdGlvbiBiYXRjaCBhbmQgdGhlIGFzc29jaWF0ZWQgZG9jdW1lbnQgbXV0YXRpb25zLlxuICogQHJldHVybnMgQSBQZXJzaXN0ZW5jZVByb21pc2Ugb2YgdGhlIGRvY3VtZW50IG11dGF0aW9ucyB0aGF0IHdlcmUgcmVtb3ZlZC5cbiAqL1xuZnVuY3Rpb24gcmVtb3ZlTXV0YXRpb25CYXRjaChlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IGUuc3RvcmUoXCJtdXRhdGlvbnNcIiksIGkgPSBlLnN0b3JlKFwiZG9jdW1lbnRNdXRhdGlvbnNcIiksIHMgPSBbXSwgbyA9IElEQktleVJhbmdlLm9ubHkobi5iYXRjaElkKTtcbiAgICBsZXQgXyA9IDA7XG4gICAgY29uc3QgYSA9IHIuSih7XG4gICAgICAgIHJhbmdlOiBvXG4gICAgfSwgKChlLCB0LCBuKSA9PiAoXysrLCBuLmRlbGV0ZSgpKSkpO1xuICAgIHMucHVzaChhLm5leHQoKCgpID0+IHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoMSA9PT0gXyk7XG4gICAgfSkpKTtcbiAgICBjb25zdCB1ID0gW107XG4gICAgZm9yIChjb25zdCBlIG9mIG4ubXV0YXRpb25zKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uS2V5KHQsIGUua2V5LnBhdGgsIG4uYmF0Y2hJZCk7XG4gICAgICAgIHMucHVzaChpLmRlbGV0ZShyKSksIHUucHVzaChlLmtleSk7XG4gICAgfVxuICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihzKS5uZXh0KCgoKSA9PiB1KSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhbiBhcHByb3hpbWF0ZSBzaXplIGZvciB0aGUgZ2l2ZW4gZG9jdW1lbnQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2RiRG9jdW1lbnRTaXplKGUpIHtcbiAgICBpZiAoIWUpIHJldHVybiAwO1xuICAgIGxldCB0O1xuICAgIGlmIChlLmRvY3VtZW50KSB0ID0gZS5kb2N1bWVudDsgZWxzZSBpZiAoZS51bmtub3duRG9jdW1lbnQpIHQgPSBlLnVua25vd25Eb2N1bWVudDsgZWxzZSB7XG4gICAgICAgIGlmICghZS5ub0RvY3VtZW50KSB0aHJvdyBmYWlsKCk7XG4gICAgICAgIHQgPSBlLm5vRG9jdW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0KS5sZW5ndGg7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogQSBtdXRhdGlvbiBxdWV1ZSBmb3IgYSBzcGVjaWZpYyB1c2VyLCBiYWNrZWQgYnkgSW5kZXhlZERCLiAqLyBMcnVQYXJhbXMuREVGQVVMVF9DT0xMRUNUSU9OX1BFUkNFTlRJTEUgPSAxMCwgXG5McnVQYXJhbXMuREVGQVVMVF9NQVhfU0VRVUVOQ0VfTlVNQkVSU19UT19DT0xMRUNUID0gMWUzLCBMcnVQYXJhbXMuREVGQVVMVCA9IG5ldyBMcnVQYXJhbXMoNDE5NDMwNDAsIExydVBhcmFtcy5ERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSwgTHJ1UGFyYW1zLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCksIFxuTHJ1UGFyYW1zLkRJU0FCTEVEID0gbmV3IExydVBhcmFtcygtMSwgMCwgMCk7XG5cbmNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJNdXRhdGlvblF1ZXVlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgbm9ybWFsaXplZCB1c2VySWQgKGUuZy4gbnVsbCBVSUQgPT4gXCJcIiB1c2VySWQpIHVzZWQgdG8gc3RvcmUgL1xuICAgICAqIHJldHJpZXZlIG11dGF0aW9ucy5cbiAgICAgKi9cbiAgICBlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMudXNlcklkID0gZSwgdGhpcy5zZXJpYWxpemVyID0gdCwgdGhpcy5pbmRleE1hbmFnZXIgPSBuLCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gciwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWNoZXMgdGhlIGRvY3VtZW50IGtleXMgZm9yIHBlbmRpbmcgbXV0YXRpb24gYmF0Y2hlcy4gSWYgdGhlIG11dGF0aW9uXG4gICAgICAgICAqIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBJbmRleGVkRGIsIHRoZSBjYWNoZWQgdmFsdWUgbWF5IGNvbnRpbnVlIHRvXG4gICAgICAgICAqIGJlIHVzZWQgdG8gcmV0cmlldmUgdGhlIGJhdGNoJ3MgZG9jdW1lbnQga2V5cy4gVG8gcmVtb3ZlIGEgY2FjaGVkIHZhbHVlXG4gICAgICAgICAqIGxvY2FsbHksIGByZW1vdmVDYWNoZWRNdXRhdGlvbktleXMoKWAgc2hvdWxkIGJlIGludm9rZWQgZWl0aGVyIGRpcmVjdGx5XG4gICAgICAgICAqIG9yIHRocm91Z2ggYHJlbW92ZU11dGF0aW9uQmF0Y2hlcygpYC5cbiAgICAgICAgICpcbiAgICAgICAgICogV2l0aCBtdWx0aS10YWIsIHdoZW4gdGhlIHByaW1hcnkgY2xpZW50IGFja25vd2xlZGdlcyBvciByZWplY3RzIGEgbXV0YXRpb24sXG4gICAgICAgICAqIHRoaXMgY2FjaGUgaXMgdXNlZCBieSBzZWNvbmRhcnkgY2xpZW50cyB0byBpbnZhbGlkYXRlIHRoZSBsb2NhbFxuICAgICAgICAgKiB2aWV3IG9mIHRoZSBkb2N1bWVudHMgdGhhdCB3ZXJlIHByZXZpb3VzbHkgYWZmZWN0ZWQgYnkgdGhlIG11dGF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICAgICAgdGhpcy5GbiA9IHt9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IG11dGF0aW9uIHF1ZXVlIGZvciB0aGUgZ2l2ZW4gdXNlci5cbiAgICAgKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyIGZvciB3aGljaCB0byBjcmVhdGUgYSBtdXRhdGlvbiBxdWV1ZS5cbiAgICAgKiBAcGFyYW0gc2VyaWFsaXplciAtIFRoZSBzZXJpYWxpemVyIHRvIHVzZSB3aGVuIHBlcnNpc3RpbmcgdG8gSW5kZXhlZERiLlxuICAgICAqLyAgICBzdGF0aWMgbHQoZSwgdCwgbiwgcikge1xuICAgICAgICAvLyBUT0RPKG1jZyk6IEZpZ3VyZSBvdXQgd2hhdCBjb25zdHJhaW50cyB0aGVyZSBhcmUgb24gdXNlcklEc1xuICAgICAgICAvLyBJbiBwYXJ0aWN1bGFyLCBhcmUgdGhlcmUgYW55IHJlc2VydmVkIGNoYXJhY3RlcnM/IGFyZSBlbXB0eSBpZHMgYWxsb3dlZD9cbiAgICAgICAgLy8gRm9yIHRoZSBtb21lbnQgc3RvcmUgdGhlc2UgdG9nZXRoZXIgaW4gdGhlIHNhbWUgbXV0YXRpb25zIHRhYmxlIGFzc3VtaW5nXG4gICAgICAgIC8vIHRoYXQgZW1wdHkgdXNlcklEcyBhcmVuJ3QgYWxsb3dlZC5cbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoXCJcIiAhPT0gZS51aWQpO1xuICAgICAgICBjb25zdCBpID0gZS5pc0F1dGhlbnRpY2F0ZWQoKSA/IGUudWlkIDogXCJcIjtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiTXV0YXRpb25RdWV1ZShpLCB0LCBuLCByKTtcbiAgICB9XG4gICAgY2hlY2tFbXB0eShlKSB7XG4gICAgICAgIGxldCB0ID0gITA7XG4gICAgICAgIGNvbnN0IG4gPSBJREJLZXlSYW5nZS5ib3VuZChbIHRoaXMudXNlcklkLCBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgXSwgWyB0aGlzLnVzZXJJZCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLkooe1xuICAgICAgICAgICAgaW5kZXg6IFwidXNlck11dGF0aW9uc0luZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogblxuICAgICAgICB9LCAoKGUsIG4sIHIpID0+IHtcbiAgICAgICAgICAgIHQgPSAhMSwgci5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0KSk7XG4gICAgfVxuICAgIGFkZE11dGF0aW9uQmF0Y2goZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2RvY3VtZW50TXV0YXRpb25zU3RvcmUoZSksIHMgPSBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSk7XG4gICAgICAgIC8vIFRoZSBJbmRleGVkRGIgaW1wbGVtZW50YXRpb24gaW4gQ2hyb21lIChhbmQgRmlyZWZveCkgZG9lcyBub3QgaGFuZGxlXG4gICAgICAgIC8vIGNvbXBvdW5kIGluZGljZXMgdGhhdCBpbmNsdWRlIGF1dG8tZ2VuZXJhdGVkIGtleXMgY29ycmVjdGx5LiBUbyBlbnN1cmVcbiAgICAgICAgLy8gdGhhdCB0aGUgaW5kZXggZW50cnkgaXMgYWRkZWQgY29ycmVjdGx5IGluIGFsbCBicm93c2Vycywgd2UgcGVyZm9ybSB0d29cbiAgICAgICAgLy8gd3JpdGVzOiBUaGUgZmlyc3Qgd3JpdGUgaXMgdXNlZCB0byByZXRyaWV2ZSB0aGUgbmV4dCBhdXRvLWdlbmVyYXRlZCBCYXRjaFxuICAgICAgICAvLyBJRCwgYW5kIHRoZSBzZWNvbmQgd3JpdGUgcG9wdWxhdGVzIHRoZSBpbmRleCBhbmQgc3RvcmVzIHRoZSBhY3R1YWxcbiAgICAgICAgLy8gbXV0YXRpb24gYmF0Y2guXG4gICAgICAgIC8vIFNlZTogaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9NzAxOTcyXG4gICAgICAgIC8vIFdlIHdyaXRlIGFuIGVtcHR5IG9iamVjdCB0byBvYnRhaW4ga2V5XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIHJldHVybiBzLmFkZCh7fSkubmV4dCgobyA9PiB7XG4gICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChcIm51bWJlclwiID09IHR5cGVvZiBvKTtcbiAgICAgICAgICAgIGNvbnN0IF8gPSBuZXcgTXV0YXRpb25CYXRjaChvLCB0LCBuLCByKSwgYSA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b0RiTXV0YXRpb25CYXRjaChlLCB0LCBuKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG4uYmFzZU11dGF0aW9ucy5tYXAoKHQgPT4gdG9NdXRhdGlvbihlLmN0LCB0KSkpLCBpID0gbi5tdXRhdGlvbnMubWFwKCh0ID0+IHRvTXV0YXRpb24oZS5jdCwgdCkpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHQsXG4gICAgICAgICAgICAgICAgICAgIGJhdGNoSWQ6IG4uYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxXcml0ZVRpbWVNczogbi5sb2NhbFdyaXRlVGltZS50b01pbGxpcygpLFxuICAgICAgICAgICAgICAgICAgICBiYXNlTXV0YXRpb25zOiByLFxuICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbnM6IGlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSh0aGlzLnNlcmlhbGl6ZXIsIHRoaXMudXNlcklkLCBfKSwgdSA9IFtdO1xuICAgICAgICAgICAgbGV0IGMgPSBuZXcgU29ydGVkU2V0KCgoZSwgdCkgPT4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5jYW5vbmljYWxTdHJpbmcoKSwgdC5jYW5vbmljYWxTdHJpbmcoKSkpKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiByKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9uZXdEYkRvY3VtZW50TXV0YXRpb25LZXkodGhpcy51c2VySWQsIGUua2V5LnBhdGgsIG8pO1xuICAgICAgICAgICAgICAgIGMgPSBjLmFkZChlLmtleS5wYXRoLnBvcExhc3QoKSksIHUucHVzaChzLnB1dChhKSksIHUucHVzaChpLnB1dCh0LCB4KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYy5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgICAgICB1LnB1c2godGhpcy5pbmRleE1hbmFnZXIuYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgoZSwgdCkpO1xuICAgICAgICAgICAgfSkpLCBlLmFkZE9uQ29tbWl0dGVkTGlzdGVuZXIoKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLkZuW29dID0gXy5rZXlzKCk7XG4gICAgICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHUpLm5leHQoKCgpID0+IF8pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBsb29rdXBNdXRhdGlvbkJhdGNoKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvbnNTdG9yZShlKS5nZXQodCkubmV4dCgoZSA9PiBlID8gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUudXNlcklkID09PSB0aGlzLnVzZXJJZCksIFxuICAgICAgICBfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIGUpKSA6IG51bGwpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgZG9jdW1lbnQga2V5cyBmb3IgdGhlIG11dGF0aW9uIGJhdGNoIHdpdGggdGhlIGdpdmVuIGJhdGNoSWQuXG4gICAgICogRm9yIHByaW1hcnkgY2xpZW50cywgdGhpcyBtZXRob2QgcmV0dXJucyBgbnVsbGAgYWZ0ZXJcbiAgICAgKiBgcmVtb3ZlTXV0YXRpb25CYXRjaGVzKClgIGhhcyBiZWVuIGNhbGxlZC4gU2Vjb25kYXJ5IGNsaWVudHMgcmV0dXJuIGFcbiAgICAgKiBjYWNoZWQgcmVzdWx0IHVudGlsIGByZW1vdmVDYWNoZWRNdXRhdGlvbktleXMoKWAgaXMgaW52b2tlZC5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgIE1uKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRm5bdF0gPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLkZuW3RdKSA6IHRoaXMubG9va3VwTXV0YXRpb25CYXRjaChlLCB0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IGUua2V5cygpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkZuW3RdID0gbiwgbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldE5leHRNdXRhdGlvbkJhdGNoQWZ0ZXJCYXRjaElkKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQgKyAxLCByID0gSURCS2V5UmFuZ2UubG93ZXJCb3VuZChbIHRoaXMudXNlcklkLCBuIF0pO1xuICAgICAgICBsZXQgaSA9IG51bGw7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkuSih7XG4gICAgICAgICAgICBpbmRleDogXCJ1c2VyTXV0YXRpb25zSW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiByXG4gICAgICAgIH0sICgoZSwgdCwgcikgPT4ge1xuICAgICAgICAgICAgdC51c2VySWQgPT09IHRoaXMudXNlcklkICYmIChfX1BSSVZBVEVfaGFyZEFzc2VydCh0LmJhdGNoSWQgPj0gbiksIGkgPSBfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIHQpKSwgXG4gICAgICAgICAgICByLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgZ2V0SGlnaGVzdFVuYWNrbm93bGVkZ2VkQmF0Y2hJZChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBJREJLZXlSYW5nZS51cHBlckJvdW5kKFsgdGhpcy51c2VySWQsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdKTtcbiAgICAgICAgbGV0IG4gPSAtMTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvbnNTdG9yZShlKS5KKHtcbiAgICAgICAgICAgIGluZGV4OiBcInVzZXJNdXRhdGlvbnNJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IHQsXG4gICAgICAgICAgICByZXZlcnNlOiAhMFxuICAgICAgICB9LCAoKGUsIHQsIHIpID0+IHtcbiAgICAgICAgICAgIG4gPSB0LmJhdGNoSWQsIHIuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0aGlzLnVzZXJJZCwgLTEgXSwgWyB0aGlzLnVzZXJJZCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLlUoXCJ1c2VyTXV0YXRpb25zSW5kZXhcIiwgdCkubmV4dCgoZSA9PiBlLm1hcCgoZSA9PiBfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIGUpKSkpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXkoZSwgdCkge1xuICAgICAgICAvLyBTY2FuIHRoZSBkb2N1bWVudC1tdXRhdGlvbiBpbmRleCBzdGFydGluZyB3aXRoIGEgcHJlZml4IHN0YXJ0aW5nIHdpdGhcbiAgICAgICAgLy8gdGhlIGdpdmVuIGRvY3VtZW50S2V5LlxuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvblByZWZpeEZvclBhdGgodGhpcy51c2VySWQsIHQucGF0aCksIHIgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKG4pLCBpID0gW107XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKS5KKHtcbiAgICAgICAgICAgIHJhbmdlOiByXG4gICAgICAgIH0sICgobiwgciwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgW28sIF8sIGFdID0gbiwgdSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgoXyk7XG4gICAgICAgICAgICAvLyBPbmx5IGNvbnNpZGVyIHJvd3MgbWF0Y2hpbmcgZXhhY3RseSB0aGUgc3BlY2lmaWMga2V5IG9mXG4gICAgICAgICAgICAvLyBpbnRlcmVzdC4gTm90ZSB0aGF0IGJlY2F1c2Ugd2Ugb3JkZXIgYnkgcGF0aCBmaXJzdCwgYW5kIHdlXG4gICAgICAgICAgICAvLyBvcmRlciB0ZXJtaW5hdG9ycyBiZWZvcmUgcGF0aCBzZXBhcmF0b3JzLCB3ZSdsbCBlbmNvdW50ZXIgYWxsXG4gICAgICAgICAgICAvLyB0aGUgaW5kZXggcm93cyBmb3IgZG9jdW1lbnRLZXkgY29udGlndW91c2x5LiBJbiBwYXJ0aWN1bGFyLCBhbGxcbiAgICAgICAgICAgIC8vIHRoZSByb3dzIGZvciBkb2N1bWVudEtleSB3aWxsIG9jY3VyIGJlZm9yZSBhbnkgcm93cyBmb3JcbiAgICAgICAgICAgIC8vIGRvY3VtZW50cyBuZXN0ZWQgaW4gYSBzdWJjb2xsZWN0aW9uIGJlbmVhdGggZG9jdW1lbnRLZXkgc28gd2VcbiAgICAgICAgICAgIC8vIGNhbiBzdG9wIGFzIHNvb24gYXMgd2UgaGl0IGFueSBzdWNoIHJvdy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvID09PSB0aGlzLnVzZXJJZCAmJiB0LnBhdGguaXNFcXVhbCh1KSkgXG4gICAgICAgICAgICAvLyBMb29rIHVwIHRoZSBtdXRhdGlvbiBiYXRjaCBpbiB0aGUgc3RvcmUuXG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLmdldChhKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWUpIHRocm93IGZhaWwoKTtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChlLnVzZXJJZCA9PT0gdGhpcy51c2VySWQpLCBpLnB1c2goX19QUklWQVRFX2Zyb21EYk11dGF0aW9uQmF0Y2godGhpcy5zZXJpYWxpemVyLCBlKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBzLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXlzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICAgICAgY29uc3QgciA9IFtdO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aCh0aGlzLnVzZXJJZCwgdC5wYXRoKSwgcyA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoaSksIG8gPSBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKS5KKHtcbiAgICAgICAgICAgICAgICByYW5nZTogc1xuICAgICAgICAgICAgfSwgKChlLCByLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3MsIG8sIF9dID0gZSwgYSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgobyk7XG4gICAgICAgICAgICAgICAgLy8gT25seSBjb25zaWRlciByb3dzIG1hdGNoaW5nIGV4YWN0bHkgdGhlIHNwZWNpZmljIGtleSBvZlxuICAgICAgICAgICAgICAgIC8vIGludGVyZXN0LiBOb3RlIHRoYXQgYmVjYXVzZSB3ZSBvcmRlciBieSBwYXRoIGZpcnN0LCBhbmQgd2VcbiAgICAgICAgICAgICAgICAvLyBvcmRlciB0ZXJtaW5hdG9ycyBiZWZvcmUgcGF0aCBzZXBhcmF0b3JzLCB3ZSdsbCBlbmNvdW50ZXIgYWxsXG4gICAgICAgICAgICAgICAgLy8gdGhlIGluZGV4IHJvd3MgZm9yIGRvY3VtZW50S2V5IGNvbnRpZ3VvdXNseS4gSW4gcGFydGljdWxhciwgYWxsXG4gICAgICAgICAgICAgICAgLy8gdGhlIHJvd3MgZm9yIGRvY3VtZW50S2V5IHdpbGwgb2NjdXIgYmVmb3JlIGFueSByb3dzIGZvclxuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50cyBuZXN0ZWQgaW4gYSBzdWJjb2xsZWN0aW9uIGJlbmVhdGggZG9jdW1lbnRLZXkgc28gd2VcbiAgICAgICAgICAgICAgICAvLyBjYW4gc3RvcCBhcyBzb29uIGFzIHdlIGhpdCBhbnkgc3VjaCByb3cuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPT09IHRoaXMudXNlcklkICYmIHQucGF0aC5pc0VxdWFsKGEpID8gbiA9IG4uYWRkKF8pIDogaS5kb25lKCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICByLnB1c2gobyk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IocikubmV4dCgoKCkgPT4gdGhpcy54bihlLCBuKSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdRdWVyeShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnBhdGgsIHIgPSBuLmxlbmd0aCArIDEsIGkgPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aCh0aGlzLnVzZXJJZCwgbiksIHMgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKGkpO1xuICAgICAgICAvLyBDb2xsZWN0IHVwIHVuaXF1ZSBiYXRjaElEcyBlbmNvdW50ZXJlZCBkdXJpbmcgYSBzY2FuIG9mIHRoZSBpbmRleC4gVXNlIGFcbiAgICAgICAgLy8gU29ydGVkU2V0IHRvIGFjY3VtdWxhdGUgYmF0Y2ggSURzIHNvIHRoZXkgY2FuIGJlIHRyYXZlcnNlZCBpbiBvcmRlciBpbiBhXG4gICAgICAgIC8vIHNjYW4gb2YgdGhlIG1haW4gdGFibGUuXG4gICAgICAgIGxldCBvID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKS5KKHtcbiAgICAgICAgICAgIHJhbmdlOiBzXG4gICAgICAgIH0sICgoZSwgdCwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW3MsIF8sIGFdID0gZSwgdSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgoXyk7XG4gICAgICAgICAgICBzID09PSB0aGlzLnVzZXJJZCAmJiBuLmlzUHJlZml4T2YodSkgPyBcbiAgICAgICAgICAgIC8vIFJvd3Mgd2l0aCBkb2N1bWVudCBrZXlzIG1vcmUgdGhhbiBvbmUgc2VnbWVudCBsb25nZXIgdGhhbiB0aGVcbiAgICAgICAgICAgIC8vIHF1ZXJ5IHBhdGggY2FuJ3QgYmUgbWF0Y2hlcy4gRm9yIGV4YW1wbGUsIGEgcXVlcnkgb24gJ3Jvb21zJ1xuICAgICAgICAgICAgLy8gY2FuJ3QgbWF0Y2ggdGhlIGRvY3VtZW50IC9yb29tcy9hYmMvbWVzc2FnZXMveHl4LlxuICAgICAgICAgICAgLy8gVE9ETyhtY2cpOiB3ZSdsbCBuZWVkIGEgZGlmZmVyZW50IHNjYW5uZXIgd2hlbiB3ZSBpbXBsZW1lbnRcbiAgICAgICAgICAgIC8vIGFuY2VzdG9yIHF1ZXJpZXMuXG4gICAgICAgICAgICB1Lmxlbmd0aCA9PT0gciAmJiAobyA9IG8uYWRkKGEpKSA6IGkuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdGhpcy54bihlLCBvKSkpO1xuICAgIH1cbiAgICB4bihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXSwgciA9IFtdO1xuICAgICAgICAvLyBUT0RPKHJvY2t3b29kKTogSW1wbGVtZW50IHRoaXMgdXNpbmcgaXRlcmF0ZS5cbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICByLnB1c2goX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLmdldCh0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PT0gZSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUudXNlcklkID09PSB0aGlzLnVzZXJJZCksIG4ucHVzaChfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIGUpKTtcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IocikubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICByZW1vdmVNdXRhdGlvbkJhdGNoKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHJlbW92ZU11dGF0aW9uQmF0Y2goZS5fZSwgdGhpcy51c2VySWQsIHQpLm5leHQoKG4gPT4gKGUuYWRkT25Db21taXR0ZWRMaXN0ZW5lcigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5Pbih0LmJhdGNoSWQpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKG4sICh0ID0+IHRoaXMucmVmZXJlbmNlRGVsZWdhdGUubWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgdCkpKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRoZSBjYWNoZWQga2V5cyBmb3IgYSBtdXRhdGlvbiBiYXRjaC4gVGhpcyBtZXRob2Qgc2hvdWxkIGJlXG4gICAgICogY2FsbGVkIGJ5IHNlY29uZGFyeSBjbGllbnRzIGFmdGVyIHRoZXkgcHJvY2VzcyBtdXRhdGlvbiB1cGRhdGVzLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IGhhdmUgdG8gYmUgY2FsbGVkIGZyb20gcHJpbWFyeSBjbGllbnRzIGFzXG4gICAgICogdGhlIGNvcnJlc3BvbmRpbmcgY2FjaGUgZW50cmllcyBhcmUgY2xlYXJlZCB3aGVuIGFuIGFja25vd2xlZGdlZCBvclxuICAgICAqIHJlamVjdGVkIGJhdGNoIGlzIHJlbW92ZWQgZnJvbSB0aGUgbXV0YXRpb24gcXVldWUuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seVxuICAgIE9uKGUpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuRm5bZV07XG4gICAgfVxuICAgIHBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFbXB0eShlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmICghdCkgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgICAgICAvLyBWZXJpZnkgdGhhdCB0aGVyZSBhcmUgbm8gZW50cmllcyBpbiB0aGUgZG9jdW1lbnRNdXRhdGlvbnMgaW5kZXggaWZcbiAgICAgICAgICAgIC8vIHRoZSBxdWV1ZSBpcyBlbXB0eS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKFxuICAgICAgICAgICAgLyoqXG4gKiBDcmVhdGVzIGEgW3VzZXJJZF0ga2V5IGZvciB1c2UgaW4gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnMgaW5kZXggdG8gaXRlcmF0ZVxuICogb3ZlciBhbGwgb2YgYSB1c2VyJ3MgZG9jdW1lbnQgbXV0YXRpb25zLlxuICovXG4gICAgICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yVXNlcihlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsgZSBdO1xuICAgICAgICAgICAgfSh0aGlzLnVzZXJJZCkpLCByID0gW107XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50TXV0YXRpb25zU3RvcmUoZSkuSih7XG4gICAgICAgICAgICAgICAgcmFuZ2U6IG5cbiAgICAgICAgICAgIH0sICgoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlWzBdID09PSB0aGlzLnVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChlWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgci5wdXNoKHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBuLmRvbmUoKTtcbiAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoMCA9PT0gci5sZW5ndGgpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlQ29udGFpbnNLZXkoZSwgdGhpcy51c2VySWQsIHQpO1xuICAgIH1cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5IChzdGF0ZSBpcyBoZWxkIGluIG1lbW9yeSBpbiBvdGhlciBjbGllbnRzKS5cbiAgICAvKiogUmV0dXJucyB0aGUgbXV0YXRpb24gcXVldWUncyBtZXRhZGF0YSBmcm9tIEluZGV4ZWREYi4gKi9cbiAgICBObihlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25RdWV1ZXNTdG9yZShlKS5nZXQodGhpcy51c2VySWQpLm5leHQoKGUgPT4gZSB8fCB7XG4gICAgICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkLFxuICAgICAgICAgICAgbGFzdEFja25vd2xlZGdlZEJhdGNoSWQ6IC0xLFxuICAgICAgICAgICAgbGFzdFN0cmVhbVRva2VuOiBcIlwiXG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgbXV0YXRpb24gcXVldWUgZm9yIHRoZSBnaXZlbiB1c2VyIGNvbnRhaW5zIGEgcGVuZGluZ1xuICogICAgICAgICBtdXRhdGlvbiBmb3IgdGhlIGdpdmVuIGtleS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25RdWV1ZUNvbnRhaW5zS2V5KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvblByZWZpeEZvclBhdGgodCwgbi5wYXRoKSwgaSA9IHJbMV0sIHMgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKHIpO1xuICAgIGxldCBvID0gITE7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE11dGF0aW9uc1N0b3JlKGUpLkooe1xuICAgICAgICByYW5nZTogcyxcbiAgICAgICAgSDogITBcbiAgICB9LCAoKGUsIG4sIHIpID0+IHtcbiAgICAgICAgY29uc3QgW3MsIF8sIC8qYmF0Y2hJRCovIGFdID0gZTtcbiAgICAgICAgcyA9PT0gdCAmJiBfID09PSBpICYmIChvID0gITApLCByLmRvbmUoKTtcbiAgICB9KSkubmV4dCgoKCkgPT4gbykpO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGFueSBtdXRhdGlvbiBxdWV1ZSBjb250YWlucyB0aGUgZ2l2ZW4gZG9jdW1lbnQuICovXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgbXV0YXRpb25zIG9iamVjdCBzdG9yZS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwibXV0YXRpb25zXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgbXV0YXRpb25RdWV1ZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudE11dGF0aW9uc1N0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwiZG9jdW1lbnRNdXRhdGlvbnNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvblF1ZXVlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX211dGF0aW9uUXVldWVzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJtdXRhdGlvblF1ZXVlc1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBPZmZzZXQgdG8gZW5zdXJlIG5vbi1vdmVybGFwcGluZyB0YXJnZXQgaWRzLiAqL1xuLyoqXG4gKiBHZW5lcmF0ZXMgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nIHRhcmdldCBJRHMgZm9yIHNlbmRpbmcgdGFyZ2V0cyB0byB0aGVcbiAqIHdhdGNoIHN0cmVhbS5cbiAqXG4gKiBUaGUgY2xpZW50IGNvbnN0cnVjdHMgdHdvIGdlbmVyYXRvcnMsIG9uZSBmb3IgdGhlIHRhcmdldCBjYWNoZSwgYW5kIG9uZSBmb3JcbiAqIGZvciB0aGUgc3luYyBlbmdpbmUgKHRvIGdlbmVyYXRlIGxpbWJvIGRvY3VtZW50cyB0YXJnZXRzKS4gVGhlc2VcbiAqIGdlbmVyYXRvcnMgcHJvZHVjZSBub24tb3ZlcmxhcHBpbmcgSURzIChieSB1c2luZyBldmVuIGFuZCBvZGQgSURzXG4gKiByZXNwZWN0aXZlbHkpLlxuICpcbiAqIEJ5IHNlcGFyYXRpbmcgdGhlIHRhcmdldCBJRCBzcGFjZSwgdGhlIHF1ZXJ5IGNhY2hlIGNhbiBnZW5lcmF0ZSB0YXJnZXQgSURzXG4gKiB0aGF0IHBlcnNpc3QgYWNyb3NzIGNsaWVudCByZXN0YXJ0cywgd2hpbGUgc3luYyBlbmdpbmUgY2FuIGluZGVwZW5kZW50bHlcbiAqIGdlbmVyYXRlIGluLW1lbW9yeSB0YXJnZXQgSURzIHRoYXQgYXJlIHRyYW5zaWVudCBhbmQgY2FuIGJlIHJldXNlZCBhZnRlciBhXG4gKiByZXN0YXJ0LlxuICovXG5jbGFzcyBfX1BSSVZBVEVfVGFyZ2V0SWRHZW5lcmF0b3Ige1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5MbiA9IGU7XG4gICAgfVxuICAgIG5leHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxuICs9IDIsIHRoaXMuTG47XG4gICAgfVxuICAgIHN0YXRpYyBCbigpIHtcbiAgICAgICAgLy8gVGhlIHRhcmdldCBjYWNoZSBnZW5lcmF0b3IgbXVzdCByZXR1cm4gJzInIGluIGl0cyBmaXJzdCBjYWxsIHRvIGBuZXh0KClgXG4gICAgICAgIC8vIGFzIHRoZXJlIGlzIG5vIGRpZmZlcmVudGlhdGlvbiBpbiB0aGUgcHJvdG9jb2wgbGF5ZXIgYmV0d2VlbiBhbiB1bnNldFxuICAgICAgICAvLyBudW1iZXIgYW5kIHRoZSBudW1iZXIgJzAnLiBJZiB3ZSB3ZXJlIHRvIHNlbnQgYSB0YXJnZXQgd2l0aCB0YXJnZXQgSURcbiAgICAgICAgLy8gJzAnLCB0aGUgYmFja2VuZCB3b3VsZCBjb25zaWRlciBpdCB1bnNldCBhbmQgcmVwbGFjZSBpdCB3aXRoIGl0cyBvd24gSUQuXG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1RhcmdldElkR2VuZXJhdG9yKDApO1xuICAgIH1cbiAgICBzdGF0aWMga24oKSB7XG4gICAgICAgIC8vIFN5bmMgZW5naW5lIGFzc2lnbnMgdGFyZ2V0IElEcyBmb3IgbGltYm8gZG9jdW1lbnQgZGV0ZWN0aW9uLlxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9UYXJnZXRJZEdlbmVyYXRvcigtMSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiVGFyZ2V0Q2FjaGUge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IGUsIHRoaXMuc2VyaWFsaXplciA9IHQ7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogV2UgZG9uJ3QgY2FjaGUgZ2xvYmFsIG1ldGFkYXRhIGZvciB0aGUgdGFyZ2V0IGNhY2hlLCBzaW5jZVxuICAgIC8vIHNvbWUgb2YgaXQgKGluIHBhcnRpY3VsYXIgYGhpZ2hlc3RUYXJnZXRJZGApIGNhbiBiZSBtb2RpZmllZCBieSBzZWNvbmRhcnlcbiAgICAvLyB0YWJzLiBXZSBjb3VsZCBwZXJoYXBzIGJlIG1vcmUgZ3JhbnVsYXIgKGFuZCBlLmcuIHN0aWxsIGNhY2hlXG4gICAgLy8gYGxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb25gIGluIG1lbW9yeSkgYnV0IGZvciBzaW1wbGljaXR5IHdlIGN1cnJlbnRseSBnb1xuICAgIC8vIHRvIEluZGV4ZWREYiB3aGVuZXZlciB3ZSBuZWVkIHRvIHJlYWQgbWV0YWRhdGEuIFdlIGNhbiByZXZpc2l0IGlmIGl0IHR1cm5zXG4gICAgLy8gb3V0IHRvIGhhdmUgYSBtZWFuaW5nZnVsIHBlcmZvcm1hbmNlIGltcGFjdC5cbiAgICBhbGxvY2F0ZVRhcmdldElkKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucW4oZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9UYXJnZXRJZEdlbmVyYXRvcih0LmhpZ2hlc3RUYXJnZXRJZCk7XG4gICAgICAgICAgICByZXR1cm4gdC5oaWdoZXN0VGFyZ2V0SWQgPSBuLm5leHQoKSwgdGhpcy5RbihlLCB0KS5uZXh0KCgoKSA9PiB0LmhpZ2hlc3RUYXJnZXRJZCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5xbihlKS5uZXh0KChlID0+IFNuYXBzaG90VmVyc2lvbi5mcm9tVGltZXN0YW1wKG5ldyBUaW1lc3RhbXAoZS5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uLnNlY29uZHMsIGUubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbi5uYW5vc2Vjb25kcykpKSk7XG4gICAgfVxuICAgIGdldEhpZ2hlc3RTZXF1ZW5jZU51bWJlcihlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnFuKGUpLm5leHQoKGUgPT4gZS5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIpKTtcbiAgICB9XG4gICAgc2V0VGFyZ2V0c01ldGFkYXRhKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucW4oZSkubmV4dCgociA9PiAoci5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgPSB0LCBuICYmIChyLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24gPSBuLnRvVGltZXN0YW1wKCkpLCBcbiAgICAgICAgdCA+IHIuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyICYmIChyLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciA9IHQpLCB0aGlzLlFuKGUsIHIpKSkpO1xuICAgIH1cbiAgICBhZGRUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuS24oZSwgdCkubmV4dCgoKCkgPT4gdGhpcy5xbihlKS5uZXh0KChuID0+IChuLnRhcmdldENvdW50ICs9IDEsIHRoaXMuJG4odCwgbiksIFxuICAgICAgICB0aGlzLlFuKGUsIG4pKSkpKSk7XG4gICAgfVxuICAgIHVwZGF0ZVRhcmdldERhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5LbihlLCB0KTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW92ZU1hdGNoaW5nS2V5c0ZvclRhcmdldElkKGUsIHQudGFyZ2V0SWQpLm5leHQoKCgpID0+IF9fUFJJVkFURV90YXJnZXRzU3RvcmUoZSkuZGVsZXRlKHQudGFyZ2V0SWQpKSkubmV4dCgoKCkgPT4gdGhpcy5xbihlKSkpLm5leHQoKHQgPT4gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KHQudGFyZ2V0Q291bnQgPiAwKSwgXG4gICAgICAgIHQudGFyZ2V0Q291bnQgLT0gMSwgdGhpcy5RbihlLCB0KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRHJvcHMgYW55IHRhcmdldHMgd2l0aCBzZXF1ZW5jZSBudW1iZXIgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSB1cHBlciBib3VuZCwgZXhjZXB0aW5nIHRob3NlXG4gICAgICogcHJlc2VudCBpbiBgYWN0aXZlVGFyZ2V0SWRzYC4gRG9jdW1lbnQgYXNzb2NpYXRpb25zIGZvciB0aGUgcmVtb3ZlZCB0YXJnZXRzIGFyZSBhbHNvIHJlbW92ZWQuXG4gICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRhcmdldHMgcmVtb3ZlZC5cbiAgICAgKi8gICAgcmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKSB7XG4gICAgICAgIGxldCByID0gMDtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5KKCgocywgbykgPT4ge1xuICAgICAgICAgICAgY29uc3QgXyA9IF9fUFJJVkFURV9mcm9tRGJUYXJnZXQobyk7XG4gICAgICAgICAgICBfLnNlcXVlbmNlTnVtYmVyIDw9IHQgJiYgbnVsbCA9PT0gbi5nZXQoXy50YXJnZXRJZCkgJiYgKHIrKywgaS5wdXNoKHRoaXMucmVtb3ZlVGFyZ2V0RGF0YShlLCBfKSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IoaSkpKS5uZXh0KCgoKSA9PiByKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGwgcHJvdmlkZWQgZnVuY3Rpb24gd2l0aCBlYWNoIGBUYXJnZXREYXRhYCB0aGF0IHdlIGhhdmUgY2FjaGVkLlxuICAgICAqLyAgICBmb3JFYWNoVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV90YXJnZXRzU3RvcmUoZSkuSigoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZnJvbURiVGFyZ2V0KG4pO1xuICAgICAgICAgICAgdChyKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBxbihlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZ2xvYmFsVGFyZ2V0U3RvcmUoZSkuZ2V0KFwidGFyZ2V0R2xvYmFsS2V5XCIpLm5leHQoKGUgPT4gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KG51bGwgIT09IGUpLCBcbiAgICAgICAgZSkpKTtcbiAgICB9XG4gICAgUW4oZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2dsb2JhbFRhcmdldFN0b3JlKGUpLnB1dChcInRhcmdldEdsb2JhbEtleVwiLCB0KTtcbiAgICB9XG4gICAgS24oZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5wdXQoX19QUklWQVRFX3RvRGJUYXJnZXQodGhpcy5zZXJpYWxpemVyLCB0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluLXBsYWNlIHVwZGF0ZXMgdGhlIHByb3ZpZGVkIG1ldGFkYXRhIHRvIGFjY291bnQgZm9yIHZhbHVlcyBpbiB0aGUgZ2l2ZW5cbiAgICAgKiBUYXJnZXREYXRhLiBTYXZpbmcgaXMgZG9uZSBzZXBhcmF0ZWx5LiBSZXR1cm5zIHRydWUgaWYgdGhlcmUgd2VyZSBhbnlcbiAgICAgKiBjaGFuZ2VzIHRvIHRoZSBtZXRhZGF0YS5cbiAgICAgKi8gICAgJG4oZSwgdCkge1xuICAgICAgICBsZXQgbiA9ICExO1xuICAgICAgICByZXR1cm4gZS50YXJnZXRJZCA+IHQuaGlnaGVzdFRhcmdldElkICYmICh0LmhpZ2hlc3RUYXJnZXRJZCA9IGUudGFyZ2V0SWQsIG4gPSAhMCksIFxuICAgICAgICBlLnNlcXVlbmNlTnVtYmVyID4gdC5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgJiYgKHQuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyID0gZS5zZXF1ZW5jZU51bWJlciwgXG4gICAgICAgIG4gPSAhMCksIG47XG4gICAgfVxuICAgIGdldFRhcmdldENvdW50KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucW4oZSkubmV4dCgoZSA9PiBlLnRhcmdldENvdW50KSk7XG4gICAgfVxuICAgIGdldFRhcmdldERhdGEoZSwgdCkge1xuICAgICAgICAvLyBJdGVyYXRpbmcgYnkgdGhlIGNhbm9uaWNhbElkIG1heSB5aWVsZCBtb3JlIHRoYW4gb25lIHJlc3VsdCBiZWNhdXNlXG4gICAgICAgIC8vIGNhbm9uaWNhbElkIHZhbHVlcyBhcmUgbm90IHJlcXVpcmVkIHRvIGJlIHVuaXF1ZSBwZXIgdGFyZ2V0LiBUaGlzIHF1ZXJ5XG4gICAgICAgIC8vIGRlcGVuZHMgb24gdGhlIHF1ZXJ5VGFyZ2V0cyBpbmRleCB0byBiZSBlZmZpY2llbnQuXG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQodCksIHIgPSBJREJLZXlSYW5nZS5ib3VuZChbIG4sIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSBdLCBbIG4sIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdKTtcbiAgICAgICAgbGV0IGkgPSBudWxsO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5KKHtcbiAgICAgICAgICAgIHJhbmdlOiByLFxuICAgICAgICAgICAgaW5kZXg6IFwicXVlcnlUYXJnZXRzSW5kZXhcIlxuICAgICAgICB9LCAoKGUsIG4sIHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBfX1BSSVZBVEVfZnJvbURiVGFyZ2V0KG4pO1xuICAgICAgICAgICAgLy8gQWZ0ZXIgZmluZGluZyBhIHBvdGVudGlhbCBtYXRjaCwgY2hlY2sgdGhhdCB0aGUgdGFyZ2V0IGlzXG4gICAgICAgICAgICAvLyBhY3R1YWxseSBlcXVhbCB0byB0aGUgcmVxdWVzdGVkIHRhcmdldC5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV90YXJnZXRFcXVhbHModCwgcy50YXJnZXQpICYmIChpID0gcywgci5kb25lKCkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBhZGRNYXRjaGluZ0tleXMoZSwgdCwgbikge1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IFRoZSByZXZlcnNlIGluZGV4IChkb2N1bWVudHNUYXJnZXRzKSBpcyBtYWludGFpbmVkIGJ5XG4gICAgICAgIC8vIEluZGV4ZWREYi5cbiAgICAgICAgY29uc3QgciA9IFtdLCBpID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSk7XG4gICAgICAgIHJldHVybiB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodC5wYXRoKTtcbiAgICAgICAgICAgIHIucHVzaChpLnB1dCh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0SWQ6IG4sXG4gICAgICAgICAgICAgICAgcGF0aDogc1xuICAgICAgICAgICAgfSkpLCByLnB1c2godGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5hZGRSZWZlcmVuY2UoZSwgbiwgdCkpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHIpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXMoZSwgdCwgbikge1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IFRoZSByZXZlcnNlIGluZGV4IChkb2N1bWVudHNUYXJnZXRzKSBpcyBtYWludGFpbmVkIGJ5XG4gICAgICAgIC8vIEluZGV4ZWREYi5cbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kb2N1bWVudFRhcmdldFN0b3JlKGUpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodC5wYXRoKTtcbiAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihbIHIuZGVsZXRlKFsgbiwgaSBdKSwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5yZW1vdmVSZWZlcmVuY2UoZSwgbiwgdCkgXSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgcmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSksIHIgPSBJREJLZXlSYW5nZS5ib3VuZChbIHQgXSwgWyB0ICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgIHJldHVybiBuLmRlbGV0ZShyKTtcbiAgICB9XG4gICAgZ2V0TWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0IF0sIFsgdCArIDEgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApLCByID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSk7XG4gICAgICAgIGxldCBpID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIHJldHVybiByLkooe1xuICAgICAgICAgICAgcmFuZ2U6IG4sXG4gICAgICAgICAgICBIOiAhMFxuICAgICAgICB9LCAoKGUsIHQsIG4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKGVbMV0pLCBzID0gbmV3IERvY3VtZW50S2V5KHIpO1xuICAgICAgICAgICAgaSA9IGkuYWRkKHMpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBjb250YWluc0tleShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHQucGF0aCksIHIgPSBJREJLZXlSYW5nZS5ib3VuZChbIG4gXSwgWyBfX1BSSVZBVEVfaW1tZWRpYXRlU3VjY2Vzc29yKG4pIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKTtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSkuSih7XG4gICAgICAgICAgICBpbmRleDogXCJkb2N1bWVudFRhcmdldHNJbmRleFwiLFxuICAgICAgICAgICAgSDogITAsXG4gICAgICAgICAgICByYW5nZTogclxuICAgICAgICB9LCAoKFtlLCB0XSwgbiwgcikgPT4ge1xuICAgICAgICAgICAgLy8gSGF2aW5nIGEgc2VudGluZWwgcm93IGZvciBhIGRvY3VtZW50IGRvZXMgbm90IGNvdW50IGFzIGNvbnRhaW5pbmcgdGhhdCBkb2N1bWVudDtcbiAgICAgICAgICAgIC8vIEZvciB0aGUgdGFyZ2V0IGNhY2hlLCBjb250YWluaW5nIHRoZSBkb2N1bWVudCBtZWFucyB0aGUgZG9jdW1lbnQgaXMgcGFydCBvZiBzb21lXG4gICAgICAgICAgICAvLyB0YXJnZXQuXG4gICAgICAgICAgICAwICE9PSBlICYmIChpKyssIHIuZG9uZSgpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkgPiAwKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIGEgVGFyZ2V0RGF0YSBlbnRyeSBieSB0YXJnZXQgSUQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFyZ2V0SWQgLSBUaGUgdGFyZ2V0IElEIG9mIHRoZSBUYXJnZXREYXRhIGVudHJ5IHRvIGxvb2sgdXAuXG4gICAgICogQHJldHVybnMgVGhlIGNhY2hlZCBUYXJnZXREYXRhIGVudHJ5LCBvciBudWxsIGlmIHRoZSBjYWNoZSBoYXMgbm8gZW50cnkgZm9yXG4gICAgICogdGhlIHRhcmdldC5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgIG90KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV90YXJnZXRzU3RvcmUoZSkuZ2V0KHQpLm5leHQoKGUgPT4gZSA/IF9fUFJJVkFURV9mcm9tRGJUYXJnZXQoZSkgOiBudWxsKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgcXVlcmllcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcInRhcmdldHNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSB0YXJnZXQgZ2xvYmFscyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2dsb2JhbFRhcmdldFN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIFwidGFyZ2V0R2xvYmFsXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgZG9jdW1lbnQgdGFyZ2V0IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcInRhcmdldERvY3VtZW50c1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2J1ZmZlckVudHJ5Q29tcGFyYXRvcihbZSwgdF0sIFtuLCByXSkge1xuICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLCBuKTtcbiAgICByZXR1cm4gMCA9PT0gaSA/IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHQsIHIpIDogaTtcbn1cblxuLyoqXG4gKiBVc2VkIHRvIGNhbGN1bGF0ZSB0aGUgbnRoIHNlcXVlbmNlIG51bWJlci4gS2VlcHMgYSByb2xsaW5nIGJ1ZmZlciBvZiB0aGVcbiAqIGxvd2VzdCBuIHZhbHVlcyBwYXNzZWQgdG8gYGFkZEVsZW1lbnRgLCBhbmQgZmluYWxseSByZXBvcnRzIHRoZSBsYXJnZXN0IG9mXG4gKiB0aGVtIGluIGBtYXhWYWx1ZWAuXG4gKi8gY2xhc3MgX19QUklWQVRFX1JvbGxpbmdTZXF1ZW5jZU51bWJlckJ1ZmZlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLlVuID0gZSwgdGhpcy5idWZmZXIgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9idWZmZXJFbnRyeUNvbXBhcmF0b3IpLCB0aGlzLlduID0gMDtcbiAgICB9XG4gICAgR24oKSB7XG4gICAgICAgIHJldHVybiArK3RoaXMuV247XG4gICAgfVxuICAgIHpuKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFsgZSwgdGhpcy5HbigpIF07XG4gICAgICAgIGlmICh0aGlzLmJ1ZmZlci5zaXplIDwgdGhpcy5VbikgdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5hZGQodCk7IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuYnVmZmVyLmxhc3QoKTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9idWZmZXJFbnRyeUNvbXBhcmF0b3IodCwgZSkgPCAwICYmICh0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLmRlbGV0ZShlKS5hZGQodCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBtYXhWYWx1ZSgpIHtcbiAgICAgICAgLy8gR3VhcmFudGVlZCB0byBiZSBub24tZW1wdHkuIElmIHdlIGRlY2lkZSB3ZSBhcmUgbm90IGNvbGxlY3RpbmcgYW55XG4gICAgICAgIC8vIHNlcXVlbmNlIG51bWJlcnMsIG50aFNlcXVlbmNlTnVtYmVyIGJlbG93IHNob3J0LWNpcmN1aXRzLiBJZiB3ZSBoYXZlXG4gICAgICAgIC8vIGRlY2lkZWQgdGhhdCB3ZSBhcmUgY29sbGVjdGluZyBuIHNlcXVlbmNlIG51bWJlcnMsIGl0J3MgYmVjYXVzZSBuIGlzIHNvbWVcbiAgICAgICAgLy8gcGVyY2VudGFnZSBvZiB0aGUgZXhpc3Rpbmcgc2VxdWVuY2UgbnVtYmVycy4gVGhhdCBtZWFucyB3ZSBzaG91bGQgbmV2ZXJcbiAgICAgICAgLy8gYmUgaW4gYSBzaXR1YXRpb24gd2hlcmUgd2UgYXJlIGNvbGxlY3Rpbmcgc2VxdWVuY2UgbnVtYmVycyBidXQgZG9uJ3RcbiAgICAgICAgLy8gYWN0dWFsbHkgaGF2ZSBhbnkuXG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5sYXN0KClbMF07XG4gICAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIHRoZSBzY2hlZHVsaW5nIG9mIExSVSBnYXJiYWdlIGNvbGxlY3Rpb24uIEl0IGhhbmRsZXMgY2hlY2tpbmdcbiAqIHdoZXRoZXIgb3Igbm90IEdDIGlzIGVuYWJsZWQsIGFzIHdlbGwgYXMgd2hpY2ggZGVsYXkgdG8gdXNlIGJlZm9yZSB0aGUgbmV4dCBydW4uXG4gKi8gY2xhc3MgX19QUklWQVRFX0xydVNjaGVkdWxlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICB0aGlzLmdhcmJhZ2VDb2xsZWN0b3IgPSBlLCB0aGlzLmFzeW5jUXVldWUgPSB0LCB0aGlzLmxvY2FsU3RvcmUgPSBuLCB0aGlzLmpuID0gbnVsbDtcbiAgICB9XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIC0xICE9PSB0aGlzLmdhcmJhZ2VDb2xsZWN0b3IucGFyYW1zLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQgJiYgdGhpcy5Ibig2ZTQpO1xuICAgIH1cbiAgICBzdG9wKCkge1xuICAgICAgICB0aGlzLmpuICYmICh0aGlzLmpuLmNhbmNlbCgpLCB0aGlzLmpuID0gbnVsbCk7XG4gICAgfVxuICAgIGdldCBzdGFydGVkKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5qbjtcbiAgICB9XG4gICAgSG4oZSkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBHYXJiYWdlIGNvbGxlY3Rpb24gc2NoZWR1bGVkIGluICR7ZX1tc2ApLCBcbiAgICAgICAgdGhpcy5qbiA9IHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQWZ0ZXJEZWxheShcImxydV9nYXJiYWdlX2NvbGxlY3Rpb25cIiAvKiBUaW1lcklkLkxydUdhcmJhZ2VDb2xsZWN0aW9uICovICwgZSwgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuam4gPSBudWxsO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvY2FsU3RvcmUuY29sbGVjdEdhcmJhZ2UodGhpcy5nYXJiYWdlQ29sbGVjdG9yKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUpID8gX19QUklWQVRFX2xvZ0RlYnVnKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBcIklnbm9yaW5nIEluZGV4ZWREQiBlcnJvciBkdXJpbmcgZ2FyYmFnZSBjb2xsZWN0aW9uOiBcIiwgZSkgOiBhd2FpdCBfX1BSSVZBVEVfaWdub3JlSWZQcmltYXJ5TGVhc2VMb3NzKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5IbigzZTUpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEltcGxlbWVudHMgdGhlIHN0ZXBzIGZvciBMUlUgZ2FyYmFnZSBjb2xsZWN0aW9uLlxuICovIGNsYXNzIF9fUFJJVkFURV9McnVHYXJiYWdlQ29sbGVjdG9ySW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLkpuID0gZSwgdGhpcy5wYXJhbXMgPSB0O1xuICAgIH1cbiAgICBjYWxjdWxhdGVUYXJnZXRDb3VudChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkpuLlluKGUpLm5leHQoKGUgPT4gTWF0aC5mbG9vcih0IC8gMTAwICogZSkpKTtcbiAgICB9XG4gICAgbnRoU2VxdWVuY2VOdW1iZXIoZSwgdCkge1xuICAgICAgICBpZiAoMCA9PT0gdCkgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5vZSk7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX1JvbGxpbmdTZXF1ZW5jZU51bWJlckJ1ZmZlcih0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuSm4uZm9yRWFjaFRhcmdldChlLCAoZSA9PiBuLnpuKGUuc2VxdWVuY2VOdW1iZXIpKSkubmV4dCgoKCkgPT4gdGhpcy5Kbi5abihlLCAoZSA9PiBuLnpuKGUpKSkpKS5uZXh0KCgoKSA9PiBuLm1heFZhbHVlKSk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldHMoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5Kbi5yZW1vdmVUYXJnZXRzKGUsIHQsIG4pO1xuICAgIH1cbiAgICByZW1vdmVPcnBoYW5lZERvY3VtZW50cyhlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkpuLnJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKGUsIHQpO1xuICAgIH1cbiAgICBjb2xsZWN0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIC0xID09PSB0aGlzLnBhcmFtcy5jYWNoZVNpemVDb2xsZWN0aW9uVGhyZXNob2xkID8gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgXCJHYXJiYWdlIGNvbGxlY3Rpb24gc2tpcHBlZDsgZGlzYWJsZWRcIiksIFxuICAgICAgICBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShSZSkpIDogdGhpcy5nZXRDYWNoZVNpemUoZSkubmV4dCgobiA9PiBuIDwgdGhpcy5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZCA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBHYXJiYWdlIGNvbGxlY3Rpb24gc2tpcHBlZDsgQ2FjaGUgc2l6ZSAke259IGlzIGxvd2VyIHRoYW4gdGhyZXNob2xkICR7dGhpcy5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZH1gKSwgXG4gICAgICAgIFJlKSA6IHRoaXMuWG4oZSwgdCkpKTtcbiAgICB9XG4gICAgZ2V0Q2FjaGVTaXplKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSm4uZ2V0Q2FjaGVTaXplKGUpO1xuICAgIH1cbiAgICBYbihlLCB0KSB7XG4gICAgICAgIGxldCBuLCByLCBpLCBzLCBvLCBhLCB1O1xuICAgICAgICBjb25zdCBjID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsY3VsYXRlVGFyZ2V0Q291bnQoZSwgdGhpcy5wYXJhbXMucGVyY2VudGlsZVRvQ29sbGVjdCkubmV4dCgodCA9PiAoXG4gICAgICAgIC8vIENhcCBhdCB0aGUgY29uZmlndXJlZCBtYXhcbiAgICAgICAgdCA+IHRoaXMucGFyYW1zLm1heGltdW1TZXF1ZW5jZU51bWJlcnNUb0NvbGxlY3QgPyAoX19QUklWQVRFX2xvZ0RlYnVnKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBgQ2FwcGluZyBzZXF1ZW5jZSBudW1iZXJzIHRvIGNvbGxlY3QgZG93biB0byB0aGUgbWF4aW11bSBvZiAke3RoaXMucGFyYW1zLm1heGltdW1TZXF1ZW5jZU51bWJlcnNUb0NvbGxlY3R9IGZyb20gJHt0fWApLCBcbiAgICAgICAgciA9IHRoaXMucGFyYW1zLm1heGltdW1TZXF1ZW5jZU51bWJlcnNUb0NvbGxlY3QpIDogciA9IHQsIHMgPSBEYXRlLm5vdygpLCB0aGlzLm50aFNlcXVlbmNlTnVtYmVyKGUsIHIpKSkpLm5leHQoKHIgPT4gKG4gPSByLCBcbiAgICAgICAgbyA9IERhdGUubm93KCksIHRoaXMucmVtb3ZlVGFyZ2V0cyhlLCBuLCB0KSkpKS5uZXh0KCh0ID0+IChpID0gdCwgYSA9IERhdGUubm93KCksIFxuICAgICAgICB0aGlzLnJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKGUsIG4pKSkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKHUgPSBEYXRlLm5vdygpLCBfX1BSSVZBVEVfZ2V0TG9nTGV2ZWwoKSA8PSBMb2dMZXZlbC5ERUJVRykge1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgYExSVSBHYXJiYWdlIENvbGxlY3Rpb25cXG5cXHRDb3VudGVkIHRhcmdldHMgaW4gJHtzIC0gY31tc1xcblxcdERldGVybWluZWQgbGVhc3QgcmVjZW50bHkgdXNlZCAke3J9IGluIGAgKyAobyAtIHMpICsgXCJtc1xcblwiICsgYFxcdFJlbW92ZWQgJHtpfSB0YXJnZXRzIGluIGAgKyAoYSAtIG8pICsgXCJtc1xcblwiICsgYFxcdFJlbW92ZWQgJHtlfSBkb2N1bWVudHMgaW4gYCArICh1IC0gYSkgKyBcIm1zXFxuXCIgKyBgVG90YWwgRHVyYXRpb246ICR7dSAtIGN9bXNgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgZGlkUnVuOiAhMCxcbiAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlcnNDb2xsZWN0ZWQ6IHIsXG4gICAgICAgICAgICAgICAgdGFyZ2V0c1JlbW92ZWQ6IGksXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRzUmVtb3ZlZDogZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9uZXdMcnVHYXJiYWdlQ29sbGVjdG9yKGUsIHQpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9McnVHYXJiYWdlQ29sbGVjdG9ySW1wbChlLCB0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBQcm92aWRlcyBMUlUgZnVuY3Rpb25hbGl0eSBmb3IgSW5kZXhlZERCIHBlcnNpc3RlbmNlLiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiTHJ1RGVsZWdhdGVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuZGIgPSBlLCB0aGlzLmdhcmJhZ2VDb2xsZWN0b3IgPSBfX1BSSVZBVEVfbmV3THJ1R2FyYmFnZUNvbGxlY3Rvcih0aGlzLCB0KTtcbiAgICB9XG4gICAgWW4oZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5lcihlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0VGFyZ2V0Q2FjaGUoKS5nZXRUYXJnZXRDb3VudChlKS5uZXh0KChlID0+IHQubmV4dCgodCA9PiBlICsgdCkpKSk7XG4gICAgfVxuICAgIGVyKGUpIHtcbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcy5abihlLCAoZSA9PiB7XG4gICAgICAgICAgICB0Kys7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0KSk7XG4gICAgfVxuICAgIGZvckVhY2hUYXJnZXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLmZvckVhY2hUYXJnZXQoZSwgdCk7XG4gICAgfVxuICAgIFpuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHIoZSwgKChlLCBuKSA9PiB0KG4pKSk7XG4gICAgfVxuICAgIGFkZFJlZmVyZW5jZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JpdGVTZW50aW5lbEtleShlLCBuKTtcbiAgICB9XG4gICAgcmVtb3ZlUmVmZXJlbmNlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cml0ZVNlbnRpbmVsS2V5KGUsIG4pO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXRzKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0VGFyZ2V0Q2FjaGUoKS5yZW1vdmVUYXJnZXRzKGUsIHQsIG4pO1xuICAgIH1cbiAgICBtYXJrUG90ZW50aWFsbHlPcnBoYW5lZChlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JpdGVTZW50aW5lbEtleShlLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIGFueXRoaW5nIHdvdWxkIHByZXZlbnQgdGhpcyBkb2N1bWVudCBmcm9tIGJlaW5nIGdhcmJhZ2VcbiAgICAgKiBjb2xsZWN0ZWQsIGdpdmVuIHRoYXQgdGhlIGRvY3VtZW50IGluIHF1ZXN0aW9uIGlzIG5vdCBwcmVzZW50IGluIGFueVxuICAgICAqIHRhcmdldHMgYW5kIGhhcyBhIHNlcXVlbmNlIG51bWJlciBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHVwcGVyIGJvdW5kIGZvclxuICAgICAqIHRoZSBjb2xsZWN0aW9uIHJ1bi5cbiAgICAgKi8gICAgbnIoZSwgdCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX211dGF0aW9uUXVldWVzQ29udGFpbktleShlLCB0KSB7XG4gICAgICAgICAgICBsZXQgbiA9ICExO1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlc1N0b3JlKGUpLlkoKHIgPT4gX19QUklWQVRFX211dGF0aW9uUXVldWVDb250YWluc0tleShlLCByLCB0KS5uZXh0KChlID0+IChlICYmIChuID0gITApLCBcbiAgICAgICAgICAgIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCFlKSkpKSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICAgICAgfShlLCB0KTtcbiAgICB9XG4gICAgcmVtb3ZlT3JwaGFuZWREb2N1bWVudHMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5kYi5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCkubmV3Q2hhbmdlQnVmZmVyKCksIHIgPSBbXTtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcy50cihlLCAoKHMsIG8pID0+IHtcbiAgICAgICAgICAgIGlmIChvIDw9IHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5ucihlLCBzKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0KSBcbiAgICAgICAgICAgICAgICAgICAgLy8gT3VyIHNpemUgYWNjb3VudGluZyByZXF1aXJlcyB1cyB0byByZWFkIGFsbCBkb2N1bWVudHMgYmVmb3JlXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbW92aW5nIHRoZW0uXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpKyssIG4uZ2V0RW50cnkoZSwgcykubmV4dCgoKCkgPT4gKG4ucmVtb3ZlRW50cnkocywgU25hcHNob3RWZXJzaW9uLm1pbigpKSwgXG4gICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9kb2N1bWVudFRhcmdldFN0b3JlKGUpLmRlbGV0ZShmdW5jdGlvbiBfX1BSSVZBVEVfc2VudGluZWxLZXkkMShlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyAwLCBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKGUucGF0aCkgXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvKipcbiAqIEByZXR1cm5zIEEgdmFsdWUgc3VpdGFibGUgZm9yIHdyaXRpbmcgYSBzZW50aW5lbCByb3cgaW4gdGhlIHRhcmdldC1kb2N1bWVudFxuICogc3RvcmUuXG4gKi8gKHMpKSkpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgci5wdXNoKHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSkubmV4dCgoKCkgPT4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IocikpKS5uZXh0KCgoKSA9PiBuLmFwcGx5KGUpKSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdC53aXRoU2VxdWVuY2VOdW1iZXIoZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIpO1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLnVwZGF0ZVRhcmdldERhdGEoZSwgbik7XG4gICAgfVxuICAgIHVwZGF0ZUxpbWJvRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyaXRlU2VudGluZWxLZXkoZSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGwgcHJvdmlkZWQgZnVuY3Rpb24gZm9yIGVhY2ggZG9jdW1lbnQgaW4gdGhlIGNhY2hlIHRoYXQgaXMgJ29ycGhhbmVkJy4gT3JwaGFuZWRcbiAgICAgKiBtZWFucyBub3QgYSBwYXJ0IG9mIGFueSB0YXJnZXQsIHNvIHRoZSBvbmx5IGVudHJ5IGluIHRoZSB0YXJnZXQtZG9jdW1lbnQgaW5kZXggZm9yXG4gICAgICogdGhhdCBkb2N1bWVudCB3aWxsIGJlIHRoZSBzZW50aW5lbCByb3cgKHRhcmdldElkIDApLCB3aGljaCB3aWxsIGFsc28gaGF2ZSB0aGUgc2VxdWVuY2VcbiAgICAgKiBudW1iZXIgZm9yIHRoZSBsYXN0IHRpbWUgdGhlIGRvY3VtZW50IHdhcyBhY2Nlc3NlZC5cbiAgICAgKi8gICAgdHIoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSk7XG4gICAgICAgIGxldCByLCBpID0gX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLm9lO1xuICAgICAgICByZXR1cm4gbi5KKHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50VGFyZ2V0c0luZGV4XCJcbiAgICAgICAgfSwgKChbZSwgbl0sIHtwYXRoOiBzLCBzZXF1ZW5jZU51bWJlcjogb30pID0+IHtcbiAgICAgICAgICAgIDAgPT09IGUgPyAoXG4gICAgICAgICAgICAvLyBpZiBuZXh0VG9SZXBvcnQgaXMgdmFsaWQsIHJlcG9ydCBpdCwgdGhpcyBpcyBhIG5ldyBrZXkgc28gdGhlXG4gICAgICAgICAgICAvLyBsYXN0IG9uZSBtdXN0IG5vdCBiZSBhIG1lbWJlciBvZiBhbnkgdGFyZ2V0cy5cbiAgICAgICAgICAgIGkgIT09IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5vZSAmJiB0KG5ldyBEb2N1bWVudEtleShfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKHIpKSwgaSksIFxuICAgICAgICAgICAgLy8gc2V0IG5leHRUb1JlcG9ydCB0byBiZSB0aGlzIHNlcXVlbmNlIG51bWJlci4gSXQncyB0aGUgbmV4dCBvbmUgd2VcbiAgICAgICAgICAgIC8vIG1pZ2h0IHJlcG9ydCwgaWYgd2UgZG9uJ3QgZmluZCBhbnkgdGFyZ2V0cyBmb3IgdGhpcyBkb2N1bWVudC5cbiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGUgc2VxdWVuY2UgbnVtYmVyIG11c3QgYmUgZGVmaW5lZCB3aGVuIHRoZSB0YXJnZXRJZFxuICAgICAgICAgICAgLy8gaXMgMC5cbiAgICAgICAgICAgIGkgPSBvLCByID0gcykgOiBcbiAgICAgICAgICAgIC8vIHNldCBuZXh0VG9SZXBvcnQgdG8gYmUgaW52YWxpZCwgd2Uga25vdyB3ZSBkb24ndCBuZWVkIHRvIHJlcG9ydFxuICAgICAgICAgICAgLy8gdGhpcyBvbmUgc2luY2Ugd2UgZm91bmQgYSB0YXJnZXQgZm9yIGl0LlxuICAgICAgICAgICAgaSA9IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5vZTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFNpbmNlIHdlIHJlcG9ydCBzZXF1ZW5jZSBudW1iZXJzIGFmdGVyIGdldHRpbmcgdG8gdGhlIG5leHQga2V5LCB3ZVxuICAgICAgICAgICAgLy8gbmVlZCB0byBjaGVjayBpZiB0aGUgbGFzdCBrZXkgd2UgaXRlcmF0ZWQgb3ZlciB3YXMgYW4gb3JwaGFuZWRcbiAgICAgICAgICAgIC8vIGRvY3VtZW50IGFuZCByZXBvcnQgaXQuXG4gICAgICAgICAgICBpICE9PSBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2Uub2UgJiYgdChuZXcgRG9jdW1lbnRLZXkoX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChyKSksIGkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldENhY2hlU2l6ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5nZXRTaXplKGUpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3dyaXRlU2VudGluZWxLZXkoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKS5wdXQoZnVuY3Rpb24gX19QUklWQVRFX3NlbnRpbmVsUm93KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRhcmdldElkOiAwLFxuICAgICAgICAgICAgcGF0aDogX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlLnBhdGgpLFxuICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXI6IHRcbiAgICAgICAgfTtcbiAgICB9KHQsIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluLW1lbW9yeSBidWZmZXIgb2YgZW50cmllcyB0byBiZSB3cml0dGVuIHRvIGEgUmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAqIEl0IGNhbiBiZSB1c2VkIHRvIGJhdGNoIHVwIGEgc2V0IG9mIGNoYW5nZXMgdG8gYmUgd3JpdHRlbiB0byB0aGUgY2FjaGUsIGJ1dFxuICogYWRkaXRpb25hbGx5IHN1cHBvcnRzIHJlYWRpbmcgZW50cmllcyBiYWNrIHdpdGggdGhlIGBnZXRFbnRyeSgpYCBtZXRob2QsXG4gKiBmYWxsaW5nIGJhY2sgdG8gdGhlIHVuZGVybHlpbmcgUmVtb3RlRG9jdW1lbnRDYWNoZSBpZiBubyBlbnRyeSBpc1xuICogYnVmZmVyZWQuXG4gKlxuICogRW50cmllcyBhZGRlZCB0byB0aGUgY2FjaGUgKm11c3QqIGJlIHJlYWQgZmlyc3QuIFRoaXMgaXMgdG8gZmFjaWxpdGF0ZVxuICogY2FsY3VsYXRpbmcgdGhlIHNpemUgZGVsdGEgb2YgdGhlIHBlbmRpbmcgY2hhbmdlcy5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFRoaXMgY2xhc3Mgd2FzIGltcGxlbWVudGVkIHRoZW4gcmVtb3ZlZCBmcm9tIG90aGVyIHBsYXRmb3Jtcy5cbiAqIElmIGJ5dGUtY291bnRpbmcgZW5kcyB1cCBiZWluZyBuZWVkZWQgb24gdGhlIG90aGVyIHBsYXRmb3JtcywgY29uc2lkZXJcbiAqIHBvcnRpbmcgdGhpcyBjbGFzcyBhcyBwYXJ0IG9mIHRoYXQgaW1wbGVtZW50YXRpb24gd29yay5cbiAqLyBjbGFzcyBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIEEgbWFwcGluZyBvZiBkb2N1bWVudCBrZXkgdG8gdGhlIG5ldyBjYWNoZSBlbnRyeSB0aGF0IHNob3VsZCBiZSB3cml0dGVuLlxuICAgICAgICB0aGlzLmNoYW5nZXMgPSBuZXcgT2JqZWN0TWFwKChlID0+IGUudG9TdHJpbmcoKSksICgoZSwgdCkgPT4gZS5pc0VxdWFsKHQpKSksIHRoaXMuY2hhbmdlc0FwcGxpZWQgPSAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQnVmZmVycyBhIGBSZW1vdGVEb2N1bWVudENhY2hlLmFkZEVudHJ5KClgIGNhbGwuXG4gICAgICpcbiAgICAgKiBZb3UgY2FuIG9ubHkgbW9kaWZ5IGRvY3VtZW50cyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCB2aWFcbiAgICAgKiBgZ2V0RW50cnkoKS9nZXRFbnRyaWVzKClgIChlbmZvcmNlZCB2aWEgSW5kZXhlZERicyBgYXBwbHkoKWApLlxuICAgICAqLyAgICBhZGRFbnRyeShlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90QXBwbGllZCgpLCB0aGlzLmNoYW5nZXMuc2V0KGUua2V5LCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQnVmZmVycyBhIGBSZW1vdGVEb2N1bWVudENhY2hlLnJlbW92ZUVudHJ5KClgIGNhbGwuXG4gICAgICpcbiAgICAgKiBZb3UgY2FuIG9ubHkgcmVtb3ZlIGRvY3VtZW50cyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCB2aWFcbiAgICAgKiBgZ2V0RW50cnkoKS9nZXRFbnRyaWVzKClgIChlbmZvcmNlZCB2aWEgSW5kZXhlZERicyBgYXBwbHkoKWApLlxuICAgICAqLyAgICByZW1vdmVFbnRyeShlLCB0KSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90QXBwbGllZCgpLCB0aGlzLmNoYW5nZXMuc2V0KGUsIE11dGFibGVEb2N1bWVudC5uZXdJbnZhbGlkRG9jdW1lbnQoZSkuc2V0UmVhZFRpbWUodCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBhbiBlbnRyeSBpbiB0aGUgY2FjaGUuIFRoZSBidWZmZXJlZCBjaGFuZ2VzIHdpbGwgZmlyc3QgYmUgY2hlY2tlZCxcbiAgICAgKiBhbmQgaWYgbm8gYnVmZmVyZWQgY2hhbmdlIGFwcGxpZXMsIHRoaXMgd2lsbCBmb3J3YXJkIHRvXG4gICAgICogYFJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0RW50cnkoKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gLSBUaGUgdHJhbnNhY3Rpb24gaW4gd2hpY2ggdG8gcGVyZm9ybSBhbnkgcGVyc2lzdGVuY2VcbiAgICAgKiAgICAgb3BlcmF0aW9ucy5cbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXkgLSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYWNoZWQgZG9jdW1lbnQgb3IgYW4gaW52YWxpZCBkb2N1bWVudCBpZiB3ZSBoYXZlIG5vdGhpbmdcbiAgICAgKiBjYWNoZWQuXG4gICAgICovICAgIGdldEVudHJ5KGUsIHQpIHtcbiAgICAgICAgdGhpcy5hc3NlcnROb3RBcHBsaWVkKCk7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmNoYW5nZXMuZ2V0KHQpO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBuID8gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobikgOiB0aGlzLmdldEZyb21DYWNoZShlLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgc2V2ZXJhbCBlbnRyaWVzIGluIHRoZSBjYWNoZSwgZm9yd2FyZGluZyB0b1xuICAgICAqIGBSZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJ5KClgLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uIC0gVGhlIHRyYW5zYWN0aW9uIGluIHdoaWNoIHRvIHBlcmZvcm0gYW55IHBlcnNpc3RlbmNlXG4gICAgICogICAgIG9wZXJhdGlvbnMuXG4gICAgICogQHBhcmFtIGRvY3VtZW50S2V5cyAtIFRoZSBrZXlzIG9mIHRoZSBlbnRyaWVzIHRvIGxvb2sgdXAuXG4gICAgICogQHJldHVybnMgQSBtYXAgb2YgY2FjaGVkIGRvY3VtZW50cywgaW5kZXhlZCBieSBrZXkuIElmIGFuIGVudHJ5IGNhbm5vdCBiZVxuICAgICAqICAgICBmb3VuZCwgdGhlIGNvcnJlc3BvbmRpbmcga2V5IHdpbGwgYmUgbWFwcGVkIHRvIGFuIGludmFsaWQgZG9jdW1lbnQuXG4gICAgICovICAgIGdldEVudHJpZXMoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxGcm9tQ2FjaGUoZSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYnVmZmVyZWQgY2hhbmdlcyB0byB0aGUgdW5kZXJseWluZyBSZW1vdGVEb2N1bWVudENhY2hlLCB1c2luZ1xuICAgICAqIHRoZSBwcm92aWRlZCB0cmFuc2FjdGlvbi5cbiAgICAgKi8gICAgYXBwbHkoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hc3NlcnROb3RBcHBsaWVkKCksIHRoaXMuY2hhbmdlc0FwcGxpZWQgPSAhMCwgdGhpcy5hcHBseUNoYW5nZXMoZSk7XG4gICAgfVxuICAgIC8qKiBIZWxwZXIgdG8gYXNzZXJ0IHRoaXMuY2hhbmdlcyBpcyBub3QgbnVsbCAgKi8gICAgYXNzZXJ0Tm90QXBwbGllZCgpIHt9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBSZW1vdGVEb2N1bWVudENhY2hlIGZvciBJbmRleGVkRGIuIFRvIGNvbnN0cnVjdCwgaW52b2tlXG4gKiBgbmV3SW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZSgpYC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gZTtcbiAgICB9XG4gICAgc2V0SW5kZXhNYW5hZ2VyKGUpIHtcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIHRoZSBzdXBwbGllZCBlbnRyaWVzIHRvIHRoZSBjYWNoZS5cbiAgICAgKlxuICAgICAqIEFsbCBjYWxscyBvZiBgYWRkRW50cnlgIGFyZSByZXF1aXJlZCB0byBnbyB0aHJvdWdoIHRoZSBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlclxuICAgICAqIHJldHVybmVkIGJ5IGBuZXdDaGFuZ2VCdWZmZXIoKWAgdG8gZW5zdXJlIHByb3BlciBhY2NvdW50aW5nIG9mIG1ldGFkYXRhLlxuICAgICAqLyAgICBhZGRFbnRyeShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkucHV0KG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgZG9jdW1lbnQgZnJvbSB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYHJlbW92ZUVudHJ5YCAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYCB0byBlbnN1cmUgcHJvcGVyIGFjY291bnRpbmcgb2YgbWV0YWRhdGEuXG4gICAgICovICAgIHJlbW92ZUVudHJ5KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKS5kZWxldGUoXG4gICAgICAgIC8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIHZpYSB0aGUgcHJpbWFyeSBrZXkgb2ZcbiAqIHRoZSBEYlJlbW90ZURvY3VtZW50IG9iamVjdCBzdG9yZS5cbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfZGJSZWFkVGltZUtleShlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5wYXRoLnRvQXJyYXkoKTtcbiAgICAgICAgICAgIHJldHVybiBbIFxuICAgICAgICAgICAgLyogcHJlZml4IHBhdGggKi8gbi5zbGljZSgwLCBuLmxlbmd0aCAtIDIpLCBcbiAgICAgICAgICAgIC8qIGNvbGxlY3Rpb24gaWQgKi8gbltuLmxlbmd0aCAtIDJdLCBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcEtleSh0KSwgXG4gICAgICAgICAgICAvKiBkb2N1bWVudCBpZCAqLyBuW24ubGVuZ3RoIC0gMV0gXTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIFJldHVybnMgYSBrZXkgdGhhdCBjYW4gYmUgdXNlZCBmb3IgZG9jdW1lbnQgbG9va3VwcyBvbiB0aGVcbiAqIGBEYlJlbW90ZURvY3VtZW50RG9jdW1lbnRDb2xsZWN0aW9uR3JvdXBJbmRleGAgaW5kZXguXG4gKi8gKHQsIG4pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgY3VycmVudCBjYWNoZSBzaXplLlxuICAgICAqXG4gICAgICogQ2FsbGVycyB0byBgYWRkRW50cnkoKWAgYW5kIGByZW1vdmVFbnRyeSgpYCAqbXVzdCogY2FsbCB0aGlzIGFmdGVyd2FyZHMgdG8gdXBkYXRlIHRoZVxuICAgICAqIGNhY2hlJ3MgbWV0YWRhdGEuXG4gICAgICovICAgIHVwZGF0ZU1ldGFkYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWV0YWRhdGEoZSkubmV4dCgobiA9PiAobi5ieXRlU2l6ZSArPSB0LCB0aGlzLnJyKGUsIG4pKSkpO1xuICAgIH1cbiAgICBnZXRFbnRyeShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudCh0KTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKS5KKHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50S2V5SW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS5vbmx5KF9fUFJJVkFURV9kYktleSh0KSlcbiAgICAgICAgfSwgKChlLCByKSA9PiB7XG4gICAgICAgICAgICBuID0gdGhpcy5pcih0LCByKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgYW4gZW50cnkgaW4gdGhlIGNhY2hlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50S2V5IC0gVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBUaGUgY2FjaGVkIGRvY3VtZW50IGVudHJ5IGFuZCBpdHMgc2l6ZS5cbiAgICAgKi8gICAgc3IoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IHtcbiAgICAgICAgICAgIHNpemU6IDAsXG4gICAgICAgICAgICBkb2N1bWVudDogTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudCh0KVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLkooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRLZXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLm9ubHkoX19QUklWQVRFX2RiS2V5KHQpKVxuICAgICAgICB9LCAoKGUsIHIpID0+IHtcbiAgICAgICAgICAgIG4gPSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQ6IHRoaXMuaXIodCwgciksXG4gICAgICAgICAgICAgICAgc2l6ZTogX19QUklWQVRFX2RiRG9jdW1lbnRTaXplKHIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9yKGUsIHQsICgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuaXIoZSwgdCk7XG4gICAgICAgICAgICBuID0gbi5pbnNlcnQoZSwgcik7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIHNldmVyYWwgZW50cmllcyBpbiB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXlzIC0gVGhlIHNldCBvZiBrZXlzIGVudHJpZXMgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBBIG1hcCBvZiBkb2N1bWVudHMgaW5kZXhlZCBieSBrZXkgYW5kIGEgbWFwIG9mIHNpemVzIGluZGV4ZWQgYnlcbiAgICAgKiAgICAga2V5ICh6ZXJvIGlmIHRoZSBkb2N1bWVudCBkb2VzIG5vdCBleGlzdCkuXG4gICAgICovICAgIGFyKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCksIHIgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gdGhpcy5fcihlLCB0LCAoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLmlyKGUsIHQpO1xuICAgICAgICAgICAgbiA9IG4uaW5zZXJ0KGUsIGkpLCByID0gci5pbnNlcnQoZSwgX19QUklWQVRFX2RiRG9jdW1lbnRTaXplKHQpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+ICh7XG4gICAgICAgICAgICBkb2N1bWVudHM6IG4sXG4gICAgICAgICAgICB1cjogclxuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICBfcihlLCB0LCBuKSB7XG4gICAgICAgIGlmICh0LmlzRW1wdHkoKSkgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIGxldCByID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfZGJLZXlDb21wYXJhdG9yKTtcbiAgICAgICAgdC5mb3JFYWNoKChlID0+IHIgPSByLmFkZChlKSkpO1xuICAgICAgICBjb25zdCBpID0gSURCS2V5UmFuZ2UuYm91bmQoX19QUklWQVRFX2RiS2V5KHIuZmlyc3QoKSksIF9fUFJJVkFURV9kYktleShyLmxhc3QoKSkpLCBzID0gci5nZXRJdGVyYXRvcigpO1xuICAgICAgICBsZXQgbyA9IHMuZ2V0TmV4dCgpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLkooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRLZXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IGlcbiAgICAgICAgfSwgKChlLCB0LCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKFsgLi4udC5wcmVmaXhQYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5kb2N1bWVudElkIF0pO1xuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCBrZXlzIG5vdCBmb3VuZCBpbiBjYWNoZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoO28gJiYgX19QUklWQVRFX2RiS2V5Q29tcGFyYXRvcihvLCBpKSA8IDA7ICkgbihvLCBudWxsKSwgbyA9IHMuZ2V0TmV4dCgpO1xuICAgICAgICAgICAgbyAmJiBvLmlzRXF1YWwoaSkgJiYgKFxuICAgICAgICAgICAgLy8gS2V5IGZvdW5kIGluIGNhY2hlLlxuICAgICAgICAgICAgbihvLCB0KSwgbyA9IHMuaGFzTmV4dCgpID8gcy5nZXROZXh0KCkgOiBudWxsKSwgXG4gICAgICAgICAgICAvLyBTa2lwIHRvIHRoZSBuZXh0IGtleSAoaWYgdGhlcmUgaXMgb25lKS5cbiAgICAgICAgICAgIG8gPyByLiQoX19QUklWQVRFX2RiS2V5KG8pKSA6IHIuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gVGhlIHJlc3Qgb2YgdGhlIGtleXMgYXJlIG5vdCBpbiB0aGUgY2FjaGUuIE9uZSBjYXNlIHdoZXJlIGBpdGVyYXRlYFxuICAgICAgICAgICAgLy8gYWJvdmUgd29uJ3QgZ28gdGhyb3VnaCB0aGVtIGlzIHdoZW4gdGhlIGNhY2hlIGlzIGVtcHR5LlxuICAgICAgICAgICAgZm9yICg7bzsgKSBuKG8sIG51bGwpLCBvID0gcy5oYXNOZXh0KCkgPyBzLmdldE5leHQoKSA6IG51bGw7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdRdWVyeShlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0LnBhdGgsIG8gPSBbIHMucG9wTGFzdCgpLnRvQXJyYXkoKSwgcy5sYXN0U2VnbWVudCgpLCBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcEtleShuLnJlYWRUaW1lKSwgbi5kb2N1bWVudEtleS5wYXRoLmlzRW1wdHkoKSA/IFwiXCIgOiBuLmRvY3VtZW50S2V5LnBhdGgubGFzdFNlZ21lbnQoKSBdLCBfID0gWyBzLnBvcExhc3QoKS50b0FycmF5KCksIHMubGFzdFNlZ21lbnQoKSwgWyBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgXSwgXCJcIiBdO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLlUoSURCS2V5UmFuZ2UuYm91bmQobywgXywgITApKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIG51bGwgPT0gaSB8fCBpLmluY3JlbWVudERvY3VtZW50UmVhZENvdW50KGUubGVuZ3RoKTtcbiAgICAgICAgICAgIGxldCBuID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBpIG9mIGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5pcihEb2N1bWVudEtleS5mcm9tU2VnbWVudHMoaS5wcmVmaXhQYXRoLmNvbmNhdChpLmNvbGxlY3Rpb25Hcm91cCwgaS5kb2N1bWVudElkKSksIGkpO1xuICAgICAgICAgICAgICAgIGUuaXNGb3VuZERvY3VtZW50KCkgJiYgKF9fUFJJVkFURV9xdWVyeU1hdGNoZXModCwgZSkgfHwgci5oYXMoZS5rZXkpKSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gRWl0aGVyIHRoZSBkb2N1bWVudCBtYXRjaGVzIHRoZSBnaXZlbiBxdWVyeSwgb3IgaXQgaXMgbXV0YXRlZC5cbiAgICAgICAgICAgICAgICBuID0gbi5pbnNlcnQoZS5rZXksIGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldEFsbEZyb21Db2xsZWN0aW9uR3JvdXAoZSwgdCwgbiwgcikge1xuICAgICAgICBsZXQgaSA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKTtcbiAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9kYkNvbGxlY3Rpb25Hcm91cEtleSh0LCBuKSwgbyA9IF9fUFJJVkFURV9kYkNvbGxlY3Rpb25Hcm91cEtleSh0LCBJbmRleE9mZnNldC5tYXgoKSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkuSih7XG4gICAgICAgICAgICBpbmRleDogXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLmJvdW5kKHMsIG8sICEwKVxuICAgICAgICB9LCAoKGUsIHQsIG4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLmlyKERvY3VtZW50S2V5LmZyb21TZWdtZW50cyh0LnByZWZpeFBhdGguY29uY2F0KHQuY29sbGVjdGlvbkdyb3VwLCB0LmRvY3VtZW50SWQpKSwgdCk7XG4gICAgICAgICAgICBpID0gaS5pbnNlcnQocy5rZXksIHMpLCBpLnNpemUgPT09IHIgJiYgbi5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIG5ld0NoYW5nZUJ1ZmZlcihlKSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyKHRoaXMsICEhZSAmJiBlLnRyYWNrUmVtb3ZhbHMpO1xuICAgIH1cbiAgICBnZXRTaXplKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWV0YWRhdGEoZSkubmV4dCgoZSA9PiBlLmJ5dGVTaXplKSk7XG4gICAgfVxuICAgIGdldE1ldGFkYXRhKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudEdsb2JhbFN0b3JlKGUpLmdldChcInJlbW90ZURvY3VtZW50R2xvYmFsS2V5XCIpLm5leHQoKGUgPT4gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZSksIFxuICAgICAgICBlKSkpO1xuICAgIH1cbiAgICBycihlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRHbG9iYWxTdG9yZShlKS5wdXQoXCJyZW1vdGVEb2N1bWVudEdsb2JhbEtleVwiLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVjb2RlcyBgZGJSZW1vdGVEb2NgIGFuZCByZXR1cm5zIHRoZSBkb2N1bWVudCAob3IgYW4gaW52YWxpZCBkb2N1bWVudCBpZlxuICAgICAqIHRoZSBkb2N1bWVudCBjb3JyZXNwb25kcyB0byB0aGUgZm9ybWF0IHVzZWQgZm9yIHNlbnRpbmVsIGRlbGV0ZXMpLlxuICAgICAqLyAgICBpcihlLCB0KSB7XG4gICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX2Zyb21EYlJlbW90ZURvY3VtZW50KHRoaXMuc2VyaWFsaXplciwgdCk7XG4gICAgICAgICAgICAvLyBXaGV0aGVyIHRoZSBkb2N1bWVudCBpcyBhIHNlbnRpbmVsIHJlbW92YWwgYW5kIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gdGhlXG4gICAgICAgICAgICAvLyBgZ2V0TmV3RG9jdW1lbnRDaGFuZ2VzKClgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlLmlzTm9Eb2N1bWVudCgpICYmIGUudmVyc2lvbi5pc0VxdWFsKFNuYXBzaG90VmVyc2lvbi5taW4oKSkpKSByZXR1cm4gZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudChlKTtcbiAgICB9XG59XG5cbi8qKiBDcmVhdGVzIGEgbmV3IEluZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlSW1wbChlKTtcbn1cblxuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXRhaWxzIG9mIGFkZGluZyBhbmQgdXBkYXRpbmcgZG9jdW1lbnRzIGluIHRoZSBJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlLlxuICpcbiAqIFVubGlrZSB0aGUgTWVtb3J5UmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIsIHRoZSBJbmRleGVkRGIgaW1wbGVtZW50YXRpb24gY29tcHV0ZXMgdGhlIHNpemVcbiAqIGRlbHRhIGZvciBhbGwgc3VibWl0dGVkIGNoYW5nZXMuIFRoaXMgYXZvaWRzIGhhdmluZyB0byByZS1yZWFkIGFsbCBkb2N1bWVudHMgZnJvbSBJbmRleGVkRGJcbiAqIHdoZW4gd2UgYXBwbHkgdGhlIGNoYW5nZXMuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyIGV4dGVuZHMgUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudENhY2hlIC0gVGhlIEluZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUgdG8gYXBwbHkgdGhlIGNoYW5nZXMgdG8uXG4gICAgICogQHBhcmFtIHRyYWNrUmVtb3ZhbHMgLSBXaGV0aGVyIHRvIGNyZWF0ZSBzZW50aW5lbCBkZWxldGVzIHRoYXQgY2FuIGJlIHRyYWNrZWQgYnlcbiAgICAgKiBgZ2V0TmV3RG9jdW1lbnRDaGFuZ2VzKClgLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5jciA9IGUsIHRoaXMudHJhY2tSZW1vdmFscyA9IHQsIFxuICAgICAgICAvLyBBIG1hcCBvZiBkb2N1bWVudCBzaXplcyBhbmQgcmVhZCB0aW1lcyBwcmlvciB0byBhcHBseWluZyB0aGUgY2hhbmdlcyBpblxuICAgICAgICAvLyB0aGlzIGJ1ZmZlci5cbiAgICAgICAgdGhpcy5sciA9IG5ldyBPYmplY3RNYXAoKGUgPT4gZS50b1N0cmluZygpKSwgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKTtcbiAgICB9XG4gICAgYXBwbHlDaGFuZ2VzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBsZXQgbiA9IDAsIHIgPSBuZXcgU29ydGVkU2V0KCgoZSwgdCkgPT4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5jYW5vbmljYWxTdHJpbmcoKSwgdC5jYW5vbmljYWxTdHJpbmcoKSkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlcy5mb3JFYWNoKCgoaSwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgbyA9IHRoaXMubHIuZ2V0KGkpO1xuICAgICAgICAgICAgaWYgKHQucHVzaCh0aGlzLmNyLnJlbW92ZUVudHJ5KGUsIGksIG8ucmVhZFRpbWUpKSwgcy5pc1ZhbGlkRG9jdW1lbnQoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfdG9EYlJlbW90ZURvY3VtZW50KHRoaXMuY3Iuc2VyaWFsaXplciwgcyk7XG4gICAgICAgICAgICAgICAgciA9IHIuYWRkKGkucGF0aC5wb3BMYXN0KCkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBfX1BSSVZBVEVfZGJEb2N1bWVudFNpemUoXyk7XG4gICAgICAgICAgICAgICAgbiArPSBhIC0gby5zaXplLCB0LnB1c2godGhpcy5jci5hZGRFbnRyeShlLCBpLCBfKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG4gLT0gby5zaXplLCB0aGlzLnRyYWNrUmVtb3ZhbHMpIHtcbiAgICAgICAgICAgICAgICAvLyBJbiBvcmRlciB0byB0cmFjayByZW1vdmFscywgd2Ugc3RvcmUgYSBcInNlbnRpbmVsIGRlbGV0ZVwiIGluIHRoZVxuICAgICAgICAgICAgICAgIC8vIFJlbW90ZURvY3VtZW50Q2FjaGUuIFRoaXMgZW50cnkgaXMgcmVwcmVzZW50ZWQgYnkgYSBOb0RvY3VtZW50XG4gICAgICAgICAgICAgICAgLy8gd2l0aCBhIHZlcnNpb24gb2YgMCBhbmQgaWdub3JlZCBieSBgbWF5YmVEZWNvZGVEb2N1bWVudCgpYCBidXRcbiAgICAgICAgICAgICAgICAvLyBwcmVzZXJ2ZWQgaW4gYGdldE5ld0RvY3VtZW50Q2hhbmdlcygpYC5cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX3RvRGJSZW1vdGVEb2N1bWVudCh0aGlzLmNyLnNlcmlhbGl6ZXIsIHMuY29udmVydFRvTm9Eb2N1bWVudChTbmFwc2hvdFZlcnNpb24ubWluKCkpKTtcbiAgICAgICAgICAgICAgICB0LnB1c2godGhpcy5jci5hZGRFbnRyeShlLCBpLCBuKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgci5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgICAgIHQucHVzaCh0aGlzLmNyLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCBuKSk7XG4gICAgICAgIH0pKSwgdC5wdXNoKHRoaXMuY3IudXBkYXRlTWV0YWRhdGEoZSwgbikpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcih0KTtcbiAgICB9XG4gICAgZ2V0RnJvbUNhY2hlKGUsIHQpIHtcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBzaXplIG9mIGV2ZXJ5dGhpbmcgd2UgbG9hZCBmcm9tIHRoZSBjYWNoZSBzbyB3ZSBjYW4gY29tcHV0ZSBhIGRlbHRhIGxhdGVyLlxuICAgICAgICByZXR1cm4gdGhpcy5jci5zcihlLCB0KS5uZXh0KChlID0+ICh0aGlzLmxyLnNldCh0LCB7XG4gICAgICAgICAgICBzaXplOiBlLnNpemUsXG4gICAgICAgICAgICByZWFkVGltZTogZS5kb2N1bWVudC5yZWFkVGltZVxuICAgICAgICB9KSwgZS5kb2N1bWVudCkpKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNhY2hlKGUsIHQpIHtcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBzaXplIG9mIGV2ZXJ5dGhpbmcgd2UgbG9hZCBmcm9tIHRoZSBjYWNoZSBzbyB3ZSBjYW4gY29tcHV0ZVxuICAgICAgICAvLyBhIGRlbHRhIGxhdGVyLlxuICAgICAgICByZXR1cm4gdGhpcy5jci5hcihlLCB0KS5uZXh0KCgoe2RvY3VtZW50czogZSwgdXI6IHR9KSA9PiAoXG4gICAgICAgIC8vIE5vdGU6IGBnZXRBbGxGcm9tQ2FjaGVgIHJldHVybnMgdHdvIG1hcHMgaW5zdGVhZCBvZiBhIHNpbmdsZSBtYXAgZnJvbVxuICAgICAgICAvLyBrZXlzIHRvIGBEb2N1bWVudFNpemVFbnRyeWBzLiBUaGlzIGlzIHRvIGFsbG93IHJldHVybmluZyB0aGVcbiAgICAgICAgLy8gYE11dGFibGVEb2N1bWVudE1hcGAgZGlyZWN0bHksIHdpdGhvdXQgYSBjb252ZXJzaW9uLlxuICAgICAgICB0LmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxyLnNldCh0LCB7XG4gICAgICAgICAgICAgICAgc2l6ZTogbixcbiAgICAgICAgICAgICAgICByZWFkVGltZTogZS5nZXQodCkucmVhZFRpbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSksIGUpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZG9jdW1lbnRHbG9iYWxTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcInJlbW90ZURvY3VtZW50R2xvYmFsXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgcmVtb3RlRG9jdW1lbnRzIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJyZW1vdGVEb2N1bWVudHNWMTRcIik7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIG9uIHRoZVxuICogYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudEtleUluZGV4YCBpbmRleC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGJLZXkoZSkge1xuICAgIGNvbnN0IHQgPSBlLnBhdGgudG9BcnJheSgpO1xuICAgIHJldHVybiBbIFxuICAgIC8qIHByZWZpeCBwYXRoICovIHQuc2xpY2UoMCwgdC5sZW5ndGggLSAyKSwgXG4gICAgLyogY29sbGVjdGlvbiBpZCAqLyB0W3QubGVuZ3RoIC0gMl0sIFxuICAgIC8qIGRvY3VtZW50IGlkICovIHRbdC5sZW5ndGggLSAxXSBdO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZGJDb2xsZWN0aW9uR3JvdXBLZXkoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LmRvY3VtZW50S2V5LnBhdGgudG9BcnJheSgpO1xuICAgIHJldHVybiBbIFxuICAgIC8qIGNvbGxlY3Rpb24gaWQgKi8gZSwgX19QUklWQVRFX3RvRGJUaW1lc3RhbXBLZXkodC5yZWFkVGltZSksIFxuICAgIC8qIHByZWZpeCBwYXRoICovIG4uc2xpY2UoMCwgbi5sZW5ndGggLSAyKSwgXG4gICAgLyogZG9jdW1lbnQgaWQgKi8gbi5sZW5ndGggPiAwID8gbltuLmxlbmd0aCAtIDFdIDogXCJcIiBdO1xufVxuXG4vKipcbiAqIENvbXBhcmF0b3IgdGhhdCBjb21wYXJlcyBkb2N1bWVudCBrZXlzIGFjY29yZGluZyB0byB0aGUgcHJpbWFyeSBrZXkgc29ydGluZ1xuICogdXNlZCBieSB0aGUgYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudGAgc3RvcmUgKGJ5IHByZWZpeCBwYXRoLCBjb2xsZWN0aW9uIGlkXG4gKiBhbmQgdGhlbiBkb2N1bWVudCBJRCkuXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGJLZXlDb21wYXJhdG9yKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZS5wYXRoLnRvQXJyYXkoKSwgciA9IHQucGF0aC50b0FycmF5KCk7XG4gICAgLy8gVGhlIG9yZGVyaW5nIGlzIGJhc2VkIG9uIGh0dHBzOi8vY2hyb21pdW0uZ29vZ2xlc291cmNlLmNvbS9jaHJvbWl1bS9ibGluay8rL2ZlNWMyMWZlZjk0ZGFlNzFjMWMzMzQ0Nzc1YjhkOGE3ZjdlNmQ5ZWMvU291cmNlL21vZHVsZXMvaW5kZXhlZGRiL0lEQktleS5jcHAjNzRcbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChsZXQgZSA9IDA7IGUgPCBuLmxlbmd0aCAtIDIgJiYgZSA8IHIubGVuZ3RoIC0gMjsgKytlKSBpZiAoaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG5bZV0sIHJbZV0pLCBcbiAgICBpKSByZXR1cm4gaTtcbiAgICByZXR1cm4gaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4ubGVuZ3RoLCByLmxlbmd0aCksIGkgfHwgKGkgPSBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuW24ubGVuZ3RoIC0gMl0sIHJbci5sZW5ndGggLSAyXSksIFxuICAgIGkgfHwgX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IobltuLmxlbmd0aCAtIDFdLCByW3IubGVuZ3RoIC0gMV0pKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogU2NoZW1hIFZlcnNpb24gZm9yIHRoZSBXZWIgY2xpZW50OlxuICogMS4gIEluaXRpYWwgdmVyc2lvbiBpbmNsdWRpbmcgTXV0YXRpb24gUXVldWUsIFF1ZXJ5IENhY2hlLCBhbmQgUmVtb3RlXG4gKiAgICAgRG9jdW1lbnQgQ2FjaGVcbiAqIDIuICBVc2VkIHRvIGVuc3VyZSBhIHRhcmdldEdsb2JhbCBvYmplY3QgZXhpc3RzIGFuZCBhZGQgdGFyZ2V0Q291bnQgdG8gaXQuIE5vXG4gKiAgICAgbG9uZ2VyIHJlcXVpcmVkIGJlY2F1c2UgbWlncmF0aW9uIDMgdW5jb25kaXRpb25hbGx5IGNsZWFycyBpdC5cbiAqIDMuICBEcm9wcGVkIGFuZCByZS1jcmVhdGVkIFF1ZXJ5IENhY2hlIHRvIGRlYWwgd2l0aCBjYWNoZSBjb3JydXB0aW9uIHJlbGF0ZWRcbiAqICAgICB0byBsaW1ibyByZXNvbHV0aW9uLiBBZGRyZXNzZXNcbiAqICAgICBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtaW9zLXNkay9pc3N1ZXMvMTU0OFxuICogNC4gIE11bHRpLVRhYiBTdXBwb3J0LlxuICogNS4gIFJlbW92YWwgb2YgaGVsZCB3cml0ZSBhY2tzLlxuICogNi4gIENyZWF0ZSBkb2N1bWVudCBnbG9iYWwgZm9yIHRyYWNraW5nIGRvY3VtZW50IGNhY2hlIHNpemUuXG4gKiA3LiAgRW5zdXJlIGV2ZXJ5IGNhY2hlZCBkb2N1bWVudCBoYXMgYSBzZW50aW5lbCByb3cgd2l0aCBhIHNlcXVlbmNlIG51bWJlci5cbiAqIDguICBBZGQgY29sbGVjdGlvbi1wYXJlbnQgaW5kZXggZm9yIENvbGxlY3Rpb24gR3JvdXAgcXVlcmllcy5cbiAqIDkuICBDaGFuZ2UgUmVtb3RlRG9jdW1lbnRDaGFuZ2VzIHN0b3JlIHRvIGJlIGtleWVkIGJ5IHJlYWRUaW1lIHJhdGhlciB0aGFuXG4gKiAgICAgYW4gYXV0by1pbmNyZW1lbnRpbmcgSUQuIFRoaXMgaXMgcmVxdWlyZWQgZm9yIEluZGV4LUZyZWUgcXVlcmllcy5cbiAqIDEwLiBSZXdyaXRlIHRoZSBjYW5vbmljYWwgSURzIHRvIHRoZSBleHBsaWNpdCBQcm90b2J1Zi1iYXNlZCBmb3JtYXQuXG4gKiAxMS4gQWRkIGJ1bmRsZXMgYW5kIG5hbWVkX3F1ZXJpZXMgZm9yIGJ1bmRsZSBzdXBwb3J0LlxuICogMTIuIEFkZCBkb2N1bWVudCBvdmVybGF5cy5cbiAqIDEzLiBSZXdyaXRlIHRoZSBrZXlzIG9mIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUgdG8gYWxsb3cgZm9yIGVmZmljaWVudFxuICogICAgIGRvY3VtZW50IGxvb2t1cCB2aWEgYGdldEFsbCgpYC5cbiAqIDE0LiBBZGQgb3ZlcmxheXMuXG4gKiAxNS4gQWRkIGluZGV4aW5nIHN1cHBvcnQuXG4gKiAxNi4gUGFyc2UgdGltZXN0YW1wIHN0cmluZ3MgYmVmb3JlIGNyZWF0aW5nIGluZGV4IGVudHJpZXMuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBsb2NhbCB2aWV3IChvdmVybGF5KSBvZiBhIGRvY3VtZW50LCBhbmQgdGhlIGZpZWxkcyB0aGF0IGFyZVxuICogbG9jYWxseSBtdXRhdGVkLlxuICovXG5jbGFzcyBPdmVybGF5ZWREb2N1bWVudCB7XG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGZpZWxkcyB0aGF0IGFyZSBsb2NhbGx5IG11dGF0ZWQgYnkgcGF0Y2ggbXV0YXRpb25zLlxuICAgICAqXG4gICAgICogSWYgdGhlIG92ZXJsYXllZFx0ZG9jdW1lbnQgaXMgZnJvbSBzZXQgb3IgZGVsZXRlIG11dGF0aW9ucywgdGhpcyBpcyBgbnVsbGAuXG4gICAgICogSWYgdGhlcmUgaXMgbm8gb3ZlcmxheSAobXV0YXRpb24pIGZvciB0aGUgZG9jdW1lbnQsIHRoaXMgaXMgYW4gZW1wdHkgYEZpZWxkTWFza2AuXG4gICAgICovXG4gICAgdCkge1xuICAgICAgICB0aGlzLm92ZXJsYXllZERvY3VtZW50ID0gZSwgdGhpcy5tdXRhdGVkRmllbGRzID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgcmVhZG9ubHkgdmlldyBvZiB0aGUgbG9jYWwgc3RhdGUgb2YgYWxsIGRvY3VtZW50cyB3ZSdyZSB0cmFja2luZyAoaS5lLiB3ZVxuICogaGF2ZSBhIGNhY2hlZCB2ZXJzaW9uIGluIHJlbW90ZURvY3VtZW50Q2FjaGUgb3IgbG9jYWwgbXV0YXRpb25zIGZvciB0aGVcbiAqIGRvY3VtZW50KS4gVGhlIHZpZXcgaXMgY29tcHV0ZWQgYnkgYXBwbHlpbmcgdGhlIG11dGF0aW9ucyBpbiB0aGVcbiAqIE11dGF0aW9uUXVldWUgdG8gdGhlIFJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKi8gY2xhc3MgTG9jYWxEb2N1bWVudHNWaWV3IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZSA9IGUsIHRoaXMubXV0YXRpb25RdWV1ZSA9IHQsIHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUgPSBuLCBcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSByO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGxvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50IGlkZW50aWZpZWQgYnkgYGtleWAuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBMb2NhbCB2aWV3IG9mIHRoZSBkb2N1bWVudCBvciBudWxsIGlmIHdlIGRvbid0IGhhdmUgYW55IGNhY2hlZFxuICAgICAqIHN0YXRlIGZvciBpdC5cbiAgICAgKi8gICAgZ2V0RG9jdW1lbnQoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IG51bGw7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50T3ZlcmxheUNhY2hlLmdldE92ZXJsYXkoZSwgdCkubmV4dCgociA9PiAobiA9IHIsIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyeShlLCB0KSkpKS5uZXh0KChlID0+IChudWxsICE9PSBuICYmIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcobi5tdXRhdGlvbiwgZSwgRmllbGRNYXNrLmVtcHR5KCksIFRpbWVzdGFtcC5ub3coKSksIFxuICAgICAgICBlKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBsb2NhbCB2aWV3IG9mIHRoZSBkb2N1bWVudHMgaWRlbnRpZmllZCBieSBga2V5c2AuXG4gICAgICpcbiAgICAgKiBJZiB3ZSBkb24ndCBoYXZlIGNhY2hlZCBzdGF0ZSBmb3IgYSBkb2N1bWVudCBpbiBga2V5c2AsIGEgTm9Eb2N1bWVudCB3aWxsXG4gICAgICogYmUgc3RvcmVkIGZvciB0aGF0IGtleSBpbiB0aGUgcmVzdWx0aW5nIHNldC5cbiAgICAgKi8gICAgZ2V0RG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyaWVzKGUsIHQpLm5leHQoKHQgPT4gdGhpcy5nZXRMb2NhbFZpZXdPZkRvY3VtZW50cyhlLCB0LCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkubmV4dCgoKCkgPT4gdCkpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNpbWlsYXIgdG8gYGdldERvY3VtZW50c2AsIGJ1dCBjcmVhdGVzIHRoZSBsb2NhbCB2aWV3IGZyb20gdGhlIGdpdmVuXG4gICAgICogYGJhc2VEb2NzYCB3aXRob3V0IHJldHJpZXZpbmcgZG9jdW1lbnRzIGZyb20gdGhlIGxvY2FsIHN0b3JlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uIC0gVGhlIHRyYW5zYWN0aW9uIHRoaXMgb3BlcmF0aW9uIGlzIHNjb3BlZCB0by5cbiAgICAgKiBAcGFyYW0gZG9jcyAtIFRoZSBkb2N1bWVudHMgdG8gYXBwbHkgbG9jYWwgbXV0YXRpb25zIHRvIGdldCB0aGUgbG9jYWwgdmlld3MuXG4gICAgICogQHBhcmFtIGV4aXN0ZW5jZVN0YXRlQ2hhbmdlZCAtIFRoZSBzZXQgb2YgZG9jdW1lbnQga2V5cyB3aG9zZSBleGlzdGVuY2Ugc3RhdGVcbiAgICAgKiAgIGlzIGNoYW5nZWQuIFRoaXMgaXMgdXNlZnVsIHRvIGRldGVybWluZSBpZiBzb21lIGRvY3VtZW50cyBvdmVybGF5IG5lZWRzXG4gICAgICogICB0byBiZSByZWNhbGN1bGF0ZWQuXG4gICAgICovICAgIGdldExvY2FsVmlld09mRG9jdW1lbnRzKGUsIHQsIG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9wdWxhdGVPdmVybGF5cyhlLCByLCB0KS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyhlLCB0LCByLCBuKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGxldCB0ID0gZG9jdW1lbnRNYXAoKTtcbiAgICAgICAgICAgIHJldHVybiBlLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgdCA9IHQuaW5zZXJ0KGUsIG4ub3ZlcmxheWVkRG9jdW1lbnQpO1xuICAgICAgICAgICAgfSkpLCB0O1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgb3ZlcmxheWVkIGRvY3VtZW50cyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50IG1hcCwgd2hpY2ggd2lsbCBpbmNsdWRlXG4gICAgICogdGhlIGxvY2FsIHZpZXcgb2YgdGhvc2UgZG9jdW1lbnRzIGFuZCBhIGBGaWVsZE1hc2tgIGluZGljYXRpbmcgd2hpY2ggZmllbGRzXG4gICAgICogYXJlIG11dGF0ZWQgbG9jYWxseSwgYG51bGxgIGlmIG92ZXJsYXkgaXMgYSBTZXQgb3IgRGVsZXRlIG11dGF0aW9uLlxuICAgICAqLyAgICBnZXRPdmVybGF5ZWREb2N1bWVudHMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9wdWxhdGVPdmVybGF5cyhlLCBuLCB0KS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyhlLCB0LCBuLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyB0aGUgb3ZlcmxheXMgZm9yIHtAY29kZSBkb2NzfSBhbmQgYWRkcyB0aGVtIHRvIHByb3ZpZGVkIG92ZXJsYXkgbWFwXG4gICAgICogaWYgdGhlIG1hcCBkb2VzIG5vdCBhbHJlYWR5IGNvbnRhaW4gYW4gZW50cnkgZm9yIHRoZSBnaXZlbiBkb2N1bWVudCBrZXkuXG4gICAgICovICAgIHBvcHVsYXRlT3ZlcmxheXMoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdC5oYXMoZSkgfHwgci5wdXNoKGUpO1xuICAgICAgICB9KSksIHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuZ2V0T3ZlcmxheXMoZSwgcikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBlLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgdC5zZXQoZSwgbik7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tcHV0ZXMgdGhlIGxvY2FsIHZpZXcgZm9yIHRoZSBnaXZlbiBkb2N1bWVudHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jcyAtIFRoZSBkb2N1bWVudHMgdG8gY29tcHV0ZSB2aWV3cyBmb3IuIEl0IGFsc28gaGFzIHRoZSBiYXNlXG4gICAgICogICB2ZXJzaW9uIG9mIHRoZSBkb2N1bWVudHMuXG4gICAgICogQHBhcmFtIG92ZXJsYXlzIC0gVGhlIG92ZXJsYXlzIHRoYXQgbmVlZCB0byBiZSBhcHBsaWVkIHRvIHRoZSBnaXZlbiBiYXNlXG4gICAgICogICB2ZXJzaW9uIG9mIHRoZSBkb2N1bWVudHMuXG4gICAgICogQHBhcmFtIGV4aXN0ZW5jZVN0YXRlQ2hhbmdlZCAtIEEgc2V0IG9mIGRvY3VtZW50cyB3aG9zZSBleGlzdGVuY2Ugc3RhdGVzXG4gICAgICogICBtaWdodCBoYXZlIGNoYW5nZWQuIFRoaXMgaXMgdXNlZCB0byBkZXRlcm1pbmUgaWYgd2UgbmVlZCB0byByZS1jYWxjdWxhdGVcbiAgICAgKiAgIG92ZXJsYXlzIGZyb20gbXV0YXRpb24gcXVldWVzLlxuICAgICAqIEByZXR1cm4gQSBtYXAgcmVwcmVzZW50cyB0aGUgbG9jYWwgZG9jdW1lbnRzIHZpZXcuXG4gICAgICovICAgIGNvbXB1dGVWaWV3cyhlLCB0LCBuLCByKSB7XG4gICAgICAgIGxldCBpID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCksIG8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3T3ZlcmxheWVkRG9jdW1lbnRNYXAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCk7XG4gICAgICAgIH0oKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG8gPSBuLmdldCh0LmtleSk7XG4gICAgICAgICAgICAvLyBSZWNhbGN1bGF0ZSBhbiBvdmVybGF5IGlmIHRoZSBkb2N1bWVudCdzIGV4aXN0ZW5jZSBzdGF0ZSBjaGFuZ2VkIGR1ZSB0b1xuICAgICAgICAgICAgLy8gYSByZW1vdGUgZXZlbnQgKmFuZCogdGhlIG92ZXJsYXkgaXMgYSBQYXRjaE11dGF0aW9uLiBUaGlzIGlzIGJlY2F1c2VcbiAgICAgICAgICAgIC8vIGRvY3VtZW50IGV4aXN0ZW5jZSBzdGF0ZSBjYW4gY2hhbmdlIGlmIHNvbWUgcGF0Y2ggbXV0YXRpb24nc1xuICAgICAgICAgICAgLy8gcHJlY29uZGl0aW9ucyBhcmUgbWV0LlxuICAgICAgICAgICAgLy8gTk9URTogd2UgcmVjYWxjdWxhdGUgd2hlbiBgb3ZlcmxheWAgaXMgdW5kZWZpbmVkIGFzIHdlbGwsIGJlY2F1c2UgdGhlcmVcbiAgICAgICAgICAgIC8vIG1pZ2h0IGJlIGEgcGF0Y2ggbXV0YXRpb24gd2hvc2UgcHJlY29uZGl0aW9uIGRvZXMgbm90IG1hdGNoIGJlZm9yZSB0aGVcbiAgICAgICAgICAgIC8vIGNoYW5nZSAoaGVuY2Ugb3ZlcmxheSBpcyB1bmRlZmluZWQpLCBidXQgd291bGQgbm93IG1hdGNoLlxuICAgICAgICAgICAgICAgICAgICAgICAgci5oYXModC5rZXkpICYmICh2b2lkIDAgPT09IG8gfHwgby5tdXRhdGlvbiBpbnN0YW5jZW9mIF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKSA/IGkgPSBpLmluc2VydCh0LmtleSwgdCkgOiB2b2lkIDAgIT09IG8gPyAocy5zZXQodC5rZXksIG8ubXV0YXRpb24uZ2V0RmllbGRNYXNrKCkpLCBcbiAgICAgICAgICAgIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcoby5tdXRhdGlvbiwgdCwgby5tdXRhdGlvbi5nZXRGaWVsZE1hc2soKSwgVGltZXN0YW1wLm5vdygpKSkgOiBcbiAgICAgICAgICAgIC8vIG5vIG92ZXJsYXkgZXhpc3RzXG4gICAgICAgICAgICAvLyBVc2luZyBFTVBUWSB0byBpbmRpY2F0ZSB0aGVyZSBpcyBubyBvdmVybGF5IGZvciB0aGUgZG9jdW1lbnQuXG4gICAgICAgICAgICBzLnNldCh0LmtleSwgRmllbGRNYXNrLmVtcHR5KCkpO1xuICAgICAgICB9KSksIHRoaXMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXMoZSwgaSkubmV4dCgoZSA9PiAoZS5mb3JFYWNoKCgoZSwgdCkgPT4gcy5zZXQoZSwgdCkpKSwgXG4gICAgICAgIHQuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIHZhciBuO1xuICAgICAgICAgICAgcmV0dXJuIG8uc2V0KGUsIG5ldyBPdmVybGF5ZWREb2N1bWVudCh0LCBudWxsICE9PSAobiA9IHMuZ2V0KGUpKSAmJiB2b2lkIDAgIT09IG4gPyBuIDogbnVsbCkpO1xuICAgICAgICB9KSksIG8pKSk7XG4gICAgfVxuICAgIHJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9uZXdEb2N1bWVudEtleU1hcCgpO1xuICAgICAgICAvLyBBIHJldmVyc2UgbG9va3VwIG1hcCBmcm9tIGJhdGNoIGlkIHRvIHRoZSBkb2N1bWVudHMgd2l0aGluIHRoYXQgYmF0Y2guXG4gICAgICAgICAgICAgICAgbGV0IHIgPSBuZXcgU29ydGVkTWFwKCgoZSwgdCkgPT4gZSAtIHQpKSwgaSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvblF1ZXVlLmdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ0RvY3VtZW50S2V5cyhlLCB0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBlKSBpLmtleXMoKS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gdC5nZXQoZSk7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IHMpIHJldHVybjtcbiAgICAgICAgICAgICAgICBsZXQgbyA9IG4uZ2V0KGUpIHx8IEZpZWxkTWFzay5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIG8gPSBpLmFwcGx5VG9Mb2NhbFZpZXcocywgbyksIG4uc2V0KGUsIG8pO1xuICAgICAgICAgICAgICAgIGNvbnN0IF8gPSAoci5nZXQoaS5iYXRjaElkKSB8fCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkuYWRkKGUpO1xuICAgICAgICAgICAgICAgIHIgPSByLmluc2VydChpLmJhdGNoSWQsIF8pO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IFtdLCBvID0gci5nZXRSZXZlcnNlSXRlcmF0b3IoKTtcbiAgICAgICAgICAgIC8vIEl0ZXJhdGUgaW4gZGVzY2VuZGluZyBvcmRlciBvZiBiYXRjaCBJRHMsIGFuZCBza2lwIGRvY3VtZW50cyB0aGF0IGFyZVxuICAgICAgICAgICAgLy8gYWxyZWFkeSBzYXZlZC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoO28uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gby5nZXROZXh0KCksIF8gPSByLmtleSwgYSA9IHIudmFsdWUsIHUgPSBfX1BSSVZBVEVfbmV3TXV0YXRpb25NYXAoKTtcbiAgICAgICAgICAgICAgICBhLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWkuaGFzKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2NhbGN1bGF0ZU92ZXJsYXlNdXRhdGlvbih0LmdldChlKSwgbi5nZXQoZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gciAmJiB1LnNldChlLCByKSwgaSA9IGkuYWRkKGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpLCBzLnB1c2godGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZS5zYXZlT3ZlcmxheXMoZSwgXywgdSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHMpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWNhbGN1bGF0ZXMgb3ZlcmxheXMgYnkgcmVhZGluZyB0aGUgZG9jdW1lbnRzIGZyb20gcmVtb3RlIGRvY3VtZW50IGNhY2hlXG4gICAgICogZmlyc3QsIGFuZCBzYXZlcyB0aGVtIGFmdGVyIHRoZXkgYXJlIGNhbGN1bGF0ZWQuXG4gICAgICovICAgIHJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzRm9yRG9jdW1lbnRLZXlzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyaWVzKGUsIHQpLm5leHQoKHQgPT4gdGhpcy5yZWNhbGN1bGF0ZUFuZFNhdmVPdmVybGF5cyhlLCB0KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHZpZXcgb2YgYWxsIGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSBwZXJzaXN0ZW5jZSB0cmFuc2FjdGlvbi5cbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkgdG8gbWF0Y2ggZG9jdW1lbnRzIGFnYWluc3QuXG4gICAgICogQHBhcmFtIG9mZnNldCAtIFJlYWQgdGltZSBhbmQga2V5IHRvIHN0YXJ0IHNjYW5uaW5nIGJ5IChleGNsdXNpdmUpLlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gQSBvcHRpb25hbCB0cmFja2VyIHRvIGtlZXAgYSByZWNvcmQgb2YgaW1wb3J0YW50IGRldGFpbHNcbiAgICAgKiAgIGR1cmluZyBkYXRhYmFzZSBsb2NhbCBxdWVyeSBleGVjdXRpb24uXG4gICAgICovICAgIGdldERvY3VtZW50c01hdGNoaW5nUXVlcnkoZSwgdCwgbiwgcikge1xuICAgICAgICAvKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgcXVlcnkgbWF0Y2hlcyBhIHNpbmdsZSBkb2N1bWVudCBieSBwYXRoIChyYXRoZXIgdGhhbiBhXG4gKiBjb2xsZWN0aW9uKS5cbiAqL1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2lzRG9jdW1lbnRRdWVyeSQxKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KGUucGF0aCkgJiYgbnVsbCA9PT0gZS5jb2xsZWN0aW9uR3JvdXAgJiYgMCA9PT0gZS5maWx0ZXJzLmxlbmd0aDtcbiAgICAgICAgfSh0KSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdEb2N1bWVudFF1ZXJ5KGUsIHQucGF0aCkgOiBfX1BSSVZBVEVfaXNDb2xsZWN0aW9uR3JvdXBRdWVyeSh0KSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uR3JvdXBRdWVyeShlLCB0LCBuLCByKSA6IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uUXVlcnkoZSwgdCwgbiwgcik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdpdmVuIGEgY29sbGVjdGlvbiBncm91cCwgcmV0dXJucyB0aGUgbmV4dCBkb2N1bWVudHMgdGhhdCBmb2xsb3cgdGhlIHByb3ZpZGVkIG9mZnNldCwgYWxvbmdcbiAgICAgKiB3aXRoIGFuIHVwZGF0ZWQgYmF0Y2ggSUQuXG4gICAgICpcbiAgICAgKiA8cD5UaGUgZG9jdW1lbnRzIHJldHVybmVkIGJ5IHRoaXMgbWV0aG9kIGFyZSBvcmRlcmVkIGJ5IHJlbW90ZSB2ZXJzaW9uIGZyb20gdGhlIHByb3ZpZGVkXG4gICAgICogb2Zmc2V0LiBJZiB0aGVyZSBhcmUgbm8gbW9yZSByZW1vdGUgZG9jdW1lbnRzIGFmdGVyIHRoZSBwcm92aWRlZCBvZmZzZXQsIGRvY3VtZW50cyB3aXRoXG4gICAgICogbXV0YXRpb25zIGluIG9yZGVyIG9mIGJhdGNoIGlkIGZyb20gdGhlIG9mZnNldCBhcmUgcmV0dXJuZWQuIFNpbmNlIGFsbCBkb2N1bWVudHMgaW4gYSBiYXRjaCBhcmVcbiAgICAgKiByZXR1cm5lZCB0b2dldGhlciwgdGhlIHRvdGFsIG51bWJlciBvZiBkb2N1bWVudHMgcmV0dXJuZWQgY2FuIGV4Y2VlZCB7QGNvZGUgY291bnR9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uXG4gICAgICogQHBhcmFtIGNvbGxlY3Rpb25Hcm91cCBUaGUgY29sbGVjdGlvbiBncm91cCBmb3IgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gb2Zmc2V0IFRoZSBvZmZzZXQgdG8gaW5kZXggaW50by5cbiAgICAgKiBAcGFyYW0gY291bnQgVGhlIG51bWJlciBvZiBkb2N1bWVudHMgdG8gcmV0dXJuXG4gICAgICogQHJldHVybiBBIExvY2FsV3JpdGVSZXN1bHQgd2l0aCB0aGUgZG9jdW1lbnRzIHRoYXQgZm9sbG93IHRoZSBwcm92aWRlZCBvZmZzZXQgYW5kIHRoZSBsYXN0IHByb2Nlc3NlZCBiYXRjaCBpZC5cbiAgICAgKi8gICAgZ2V0TmV4dERvY3VtZW50cyhlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cChlLCB0LCBuLCByKS5uZXh0KChpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSByIC0gaS5zaXplID4gMCA/IHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAoZSwgdCwgbi5sYXJnZXN0QmF0Y2hJZCwgciAtIGkuc2l6ZSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpKTtcbiAgICAgICAgICAgIC8vIFRoZSBjYWxsc2l0ZSB3aWxsIHVzZSB0aGUgbGFyZ2VzdCBiYXRjaCBJRCB0b2dldGhlciB3aXRoIHRoZSBsYXRlc3QgcmVhZCB0aW1lIHRvIGNyZWF0ZVxuICAgICAgICAgICAgLy8gYSBuZXcgaW5kZXggb2Zmc2V0LiBTaW5jZSB3ZSBvbmx5IHByb2Nlc3MgYmF0Y2ggSURzIGlmIGFsbCByZW1vdGUgZG9jdW1lbnRzIGhhdmUgYmVlbiByZWFkLFxuICAgICAgICAgICAgLy8gbm8gb3ZlcmxheSB3aWxsIGluY3JlYXNlIHRoZSBvdmVyYWxsIHJlYWQgdGltZS4gVGhpcyBpcyB3aHkgd2Ugb25seSBuZWVkIHRvIHNwZWNpYWwgY2FzZVxuICAgICAgICAgICAgLy8gdGhlIGJhdGNoIGlkLlxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG8gPSAtMSwgXyA9IGk7XG4gICAgICAgICAgICByZXR1cm4gcy5uZXh0KCh0ID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQsICgodCwgbikgPT4gKG8gPCBuLmxhcmdlc3RCYXRjaElkICYmIChvID0gbi5sYXJnZXN0QmF0Y2hJZCksIFxuICAgICAgICAgICAgaS5nZXQodCkgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpIDogdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJ5KGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIF8gPSBfLmluc2VydCh0LCBlKTtcbiAgICAgICAgICAgIH0pKSkpKS5uZXh0KCgoKSA9PiB0aGlzLnBvcHVsYXRlT3ZlcmxheXMoZSwgdCwgaSkpKS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyhlLCBfLCB0LCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkpKS5uZXh0KChlID0+ICh7XG4gICAgICAgICAgICAgICAgYmF0Y2hJZDogbyxcbiAgICAgICAgICAgICAgICBjaGFuZ2VzOiBfX1BSSVZBVEVfY29udmVydE92ZXJsYXllZERvY3VtZW50TWFwVG9Eb2N1bWVudE1hcChlKVxuICAgICAgICAgICAgfSkpKSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nRG9jdW1lbnRRdWVyeShlLCB0KSB7XG4gICAgICAgIC8vIEp1c3QgZG8gYSBzaW1wbGUgZG9jdW1lbnQgbG9va3VwLlxuICAgICAgICByZXR1cm4gdGhpcy5nZXREb2N1bWVudChlLCBuZXcgRG9jdW1lbnRLZXkodCkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgbGV0IHQgPSBkb2N1bWVudE1hcCgpO1xuICAgICAgICAgICAgcmV0dXJuIGUuaXNGb3VuZERvY3VtZW50KCkgJiYgKHQgPSB0Lmluc2VydChlLmtleSwgZSkpLCB0O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nQ29sbGVjdGlvbkdyb3VwUXVlcnkoZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gdC5jb2xsZWN0aW9uR3JvdXA7XG4gICAgICAgIGxldCBzID0gZG9jdW1lbnRNYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYW5hZ2VyLmdldENvbGxlY3Rpb25QYXJlbnRzKGUsIGkpLm5leHQoKG8gPT4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gobywgKG8gPT4ge1xuICAgICAgICAgICAgY29uc3QgXyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9hc0NvbGxlY3Rpb25RdWVyeUF0UGF0aChlLCB0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKHQsIFxuICAgICAgICAgICAgICAgIC8qY29sbGVjdGlvbkdyb3VwPSovIG51bGwsIGUuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIGUuZmlsdGVycy5zbGljZSgpLCBlLmxpbWl0LCBlLmxpbWl0VHlwZSwgZS5zdGFydEF0LCBlLmVuZEF0KTtcbiAgICAgICAgICAgIH0odCwgby5jaGlsZChpKSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREb2N1bWVudHNNYXRjaGluZ0NvbGxlY3Rpb25RdWVyeShlLCBfLCBuLCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBlLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHMgPSBzLmluc2VydChlLCB0KTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBzKSkpKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uUXVlcnkoZSwgdCwgbiwgcikge1xuICAgICAgICAvLyBRdWVyeSB0aGUgcmVtb3RlIGRvY3VtZW50cyBhbmQgb3ZlcmxheSBtdXRhdGlvbnMuXG4gICAgICAgIGxldCBpO1xuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZS5nZXRPdmVybGF5c0ZvckNvbGxlY3Rpb24oZSwgdC5wYXRoLCBuLmxhcmdlc3RCYXRjaElkKS5uZXh0KChzID0+IChpID0gcywgXG4gICAgICAgIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4sIGksIHIpKSkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgLy8gQXMgZG9jdW1lbnRzIG1pZ2h0IG1hdGNoIHRoZSBxdWVyeSBiZWNhdXNlIG9mIHRoZWlyIG92ZXJsYXkgd2UgbmVlZCB0b1xuICAgICAgICAgICAgLy8gaW5jbHVkZSBkb2N1bWVudHMgZm9yIGFsbCBvdmVybGF5cyBpbiB0aGUgaW5pdGlhbCBkb2N1bWVudCBzZXQuXG4gICAgICAgICAgICBpLmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG4uZ2V0S2V5KCk7XG4gICAgICAgICAgICAgICAgbnVsbCA9PT0gZS5nZXQocikgJiYgKGUgPSBlLmluc2VydChyLCBNdXRhYmxlRG9jdW1lbnQubmV3SW52YWxpZERvY3VtZW50KHIpKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAvLyBBcHBseSB0aGUgb3ZlcmxheXMgYW5kIG1hdGNoIGFnYWluc3QgdGhlIHF1ZXJ5LlxuICAgICAgICAgICAgbGV0IG4gPSBkb2N1bWVudE1hcCgpO1xuICAgICAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoKGUsIHIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gaS5nZXQoZSk7XG4gICAgICAgICAgICAgICAgdm9pZCAwICE9PSBzICYmIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcocy5tdXRhdGlvbiwgciwgRmllbGRNYXNrLmVtcHR5KCksIFRpbWVzdGFtcC5ub3coKSksIFxuICAgICAgICAgICAgICAgIC8vIEZpbmFsbHksIGluc2VydCB0aGUgZG9jdW1lbnRzIHRoYXQgc3RpbGwgbWF0Y2ggdGhlIHF1ZXJ5XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX3F1ZXJ5TWF0Y2hlcyh0LCByKSAmJiAobiA9IG4uaW5zZXJ0KGUsIHIpKTtcbiAgICAgICAgICAgIH0pKSwgbjtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX01lbW9yeUJ1bmRsZUNhY2hlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGUsIHRoaXMuaHIgPSBuZXcgTWFwLCB0aGlzLlByID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0QnVuZGxlTWV0YWRhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5oci5nZXQodCkpO1xuICAgIH1cbiAgICBzYXZlQnVuZGxlTWV0YWRhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oci5zZXQodC5pZCwgXG4gICAgICAgIC8qKiBEZWNvZGVzIGEgQnVuZGxlTWV0YWRhdGEgcHJvdG8gaW50byBhIEJ1bmRsZU1ldGFkYXRhIG9iamVjdC4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2Zyb21CdW5kbGVNZXRhZGF0YShlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiBlLmlkLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IGUudmVyc2lvbixcbiAgICAgICAgICAgICAgICBjcmVhdGVUaW1lOiBfX1BSSVZBVEVfZnJvbVZlcnNpb24oZS5jcmVhdGVUaW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldE5hbWVkUXVlcnkoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5Qci5nZXQodCkpO1xuICAgIH1cbiAgICBzYXZlTmFtZWRRdWVyeShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlByLnNldCh0Lm5hbWUsIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tUHJvdG9OYW1lZFF1ZXJ5KGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbmFtZTogZS5uYW1lLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiBfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeShlLmJ1bmRsZWRRdWVyeSksXG4gICAgICAgICAgICAgICAgcmVhZFRpbWU6IF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLnJlYWRUaW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb24gb2YgRG9jdW1lbnRPdmVybGF5Q2FjaGUuXG4gKi8gY2xhc3MgX19QUklWQVRFX01lbW9yeURvY3VtZW50T3ZlcmxheUNhY2hlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gQSBtYXAgc29ydGVkIGJ5IERvY3VtZW50S2V5LCB3aG9zZSB2YWx1ZSBpcyBhIHBhaXIgb2YgdGhlIGxhcmdlc3QgYmF0Y2ggaWRcbiAgICAgICAgLy8gZm9yIHRoZSBvdmVybGF5IGFuZCB0aGUgb3ZlcmxheSBpdHNlbGYuXG4gICAgICAgIHRoaXMub3ZlcmxheXMgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpLCB0aGlzLklyID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheShlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLm92ZXJsYXlzLmdldCh0KSk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiB0aGlzLmdldE92ZXJsYXkoZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBudWxsICE9PSBlICYmIG4uc2V0KHQsIGUpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIHNhdmVPdmVybGF5cyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmh0KGUsIHQsIHIpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZU92ZXJsYXlzRm9yQmF0Y2hJZChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLklyLmdldChuKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gciAmJiAoci5mb3JFYWNoKChlID0+IHRoaXMub3ZlcmxheXMgPSB0aGlzLm92ZXJsYXlzLnJlbW92ZShlKSkpLCBcbiAgICAgICAgdGhpcy5Jci5kZWxldGUobikpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5c0ZvckNvbGxlY3Rpb24oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKSwgaSA9IHQubGVuZ3RoICsgMSwgcyA9IG5ldyBEb2N1bWVudEtleSh0LmNoaWxkKFwiXCIpKSwgbyA9IHRoaXMub3ZlcmxheXMuZ2V0SXRlcmF0b3JGcm9tKHMpO1xuICAgICAgICBmb3IgKDtvLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gby5nZXROZXh0KCkudmFsdWUsIHMgPSBlLmdldEtleSgpO1xuICAgICAgICAgICAgaWYgKCF0LmlzUHJlZml4T2Yocy5wYXRoKSkgYnJlYWs7XG4gICAgICAgICAgICAvLyBEb2N1bWVudHMgZnJvbSBzdWItY29sbGVjdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgIHMucGF0aC5sZW5ndGggPT09IGkgJiYgKGUubGFyZ2VzdEJhdGNoSWQgPiBuICYmIHIuc2V0KGUuZ2V0S2V5KCksIGUpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUocik7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgbGV0IGkgPSBuZXcgU29ydGVkTWFwKCgoZSwgdCkgPT4gZSAtIHQpKTtcbiAgICAgICAgY29uc3QgcyA9IHRoaXMub3ZlcmxheXMuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgZm9yICg7cy5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHMuZ2V0TmV4dCgpLnZhbHVlO1xuICAgICAgICAgICAgaWYgKGUuZ2V0S2V5KCkuZ2V0Q29sbGVjdGlvbkdyb3VwKCkgPT09IHQgJiYgZS5sYXJnZXN0QmF0Y2hJZCA+IG4pIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9IGkuZ2V0KGUubGFyZ2VzdEJhdGNoSWQpO1xuICAgICAgICAgICAgICAgIG51bGwgPT09IHQgJiYgKHQgPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpLCBpID0gaS5pbnNlcnQoZS5sYXJnZXN0QmF0Y2hJZCwgdCkpLCBcbiAgICAgICAgICAgICAgICB0LnNldChlLmdldEtleSgpLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKSwgXyA9IGkuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgZm9yICg7Xy5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgaWYgKF8uZ2V0TmV4dCgpLnZhbHVlLmZvckVhY2goKChlLCB0KSA9PiBvLnNldChlLCB0KSkpLCBvLnNpemUoKSA+PSByKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobyk7XG4gICAgfVxuICAgIGh0KGUsIHQsIG4pIHtcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBhc3NvY2lhdGlvbiBvZiB0aGUgb3ZlcmxheSB0byBpdHMgYmF0Y2ggaWQuXG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLm92ZXJsYXlzLmdldChuLmtleSk7XG4gICAgICAgIGlmIChudWxsICE9PSByKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5Jci5nZXQoci5sYXJnZXN0QmF0Y2hJZCkuZGVsZXRlKG4ua2V5KTtcbiAgICAgICAgICAgIHRoaXMuSXIuc2V0KHIubGFyZ2VzdEJhdGNoSWQsIGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3ZlcmxheXMgPSB0aGlzLm92ZXJsYXlzLmluc2VydChuLmtleSwgbmV3IE92ZXJsYXkodCwgbikpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGFzc29jaWF0aW9uIG9mIHRoaXMgb3ZlcmxheSB0byB0aGUgZ2l2ZW4gbGFyZ2VzdEJhdGNoSWQuXG4gICAgICAgIGxldCBpID0gdGhpcy5Jci5nZXQodCk7XG4gICAgICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCB0aGlzLklyLnNldCh0LCBpKSksIHRoaXMuSXIuc2V0KHQsIGkuYWRkKG4ua2V5KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5R2xvYmFsc0NhY2hlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5zZXNzaW9uVG9rZW4gPSBCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HO1xuICAgIH1cbiAgICBnZXRTZXNzaW9uVG9rZW4oZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5zZXNzaW9uVG9rZW4pO1xuICAgIH1cbiAgICBzZXRTZXNzaW9uVG9rZW4oZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uVG9rZW4gPSB0LCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBjb2xsZWN0aW9uIG9mIHJlZmVyZW5jZXMgdG8gYSBkb2N1bWVudCBmcm9tIHNvbWUga2luZCBvZiBudW1iZXJlZCBlbnRpdHlcbiAqIChlaXRoZXIgYSB0YXJnZXQgSUQgb3IgYmF0Y2ggSUQpLiBBcyByZWZlcmVuY2VzIGFyZSBhZGRlZCB0byBvciByZW1vdmVkIGZyb21cbiAqIHRoZSBzZXQgY29ycmVzcG9uZGluZyBldmVudHMgYXJlIGVtaXR0ZWQgdG8gYSByZWdpc3RlcmVkIGdhcmJhZ2UgY29sbGVjdG9yLlxuICpcbiAqIEVhY2ggcmVmZXJlbmNlIGlzIHJlcHJlc2VudGVkIGJ5IGEgRG9jdW1lbnRSZWZlcmVuY2Ugb2JqZWN0LiBFYWNoIG9mIHRoZW1cbiAqIGNvbnRhaW5zIGVub3VnaCBpbmZvcm1hdGlvbiB0byB1bmlxdWVseSBpZGVudGlmeSB0aGUgcmVmZXJlbmNlLiBUaGV5IGFyZSBhbGxcbiAqIHN0b3JlZCBwcmltYXJpbHkgaW4gYSBzZXQgc29ydGVkIGJ5IGtleS4gQSBkb2N1bWVudCBpcyBjb25zaWRlcmVkIGdhcmJhZ2UgaWZcbiAqIHRoZXJlJ3Mgbm8gcmVmZXJlbmNlcyBpbiB0aGF0IHNldCAodGhpcyBjYW4gYmUgZWZmaWNpZW50bHkgY2hlY2tlZCB0aGFua3MgdG9cbiAqIHNvcnRpbmcgYnkga2V5KS5cbiAqXG4gKiBSZWZlcmVuY2VTZXQgYWxzbyBrZWVwcyBhIHNlY29uZGFyeSBzZXQgdGhhdCBjb250YWlucyByZWZlcmVuY2VzIHNvcnRlZCBieVxuICogSURzLiBUaGlzIG9uZSBpcyB1c2VkIHRvIGVmZmljaWVudGx5IGltcGxlbWVudCByZW1vdmFsIG9mIGFsbCByZWZlcmVuY2VzIGJ5XG4gKiBzb21lIHRhcmdldCBJRC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUmVmZXJlbmNlU2V0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gQSBzZXQgb2Ygb3V0c3RhbmRpbmcgcmVmZXJlbmNlcyB0byBhIGRvY3VtZW50IHNvcnRlZCBieSBrZXkuXG4gICAgICAgIHRoaXMuVHIgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UuRXIpLCBcbiAgICAgICAgLy8gQSBzZXQgb2Ygb3V0c3RhbmRpbmcgcmVmZXJlbmNlcyB0byBhIGRvY3VtZW50IHNvcnRlZCBieSB0YXJnZXQgaWQuXG4gICAgICAgIHRoaXMuZHIgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UuQXIpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIHRoZSByZWZlcmVuY2Ugc2V0IGNvbnRhaW5zIG5vIHJlZmVyZW5jZXMuICovICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlRyLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLyoqIEFkZHMgYSByZWZlcmVuY2UgdG8gdGhlIGdpdmVuIGRvY3VtZW50IGtleSBmb3IgdGhlIGdpdmVuIElELiAqLyAgICBhZGRSZWZlcmVuY2UoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UoZSwgdCk7XG4gICAgICAgIHRoaXMuVHIgPSB0aGlzLlRyLmFkZChuKSwgdGhpcy5kciA9IHRoaXMuZHIuYWRkKG4pO1xuICAgIH1cbiAgICAvKiogQWRkIHJlZmVyZW5jZXMgdG8gdGhlIGdpdmVuIGRvY3VtZW50IGtleXMgZm9yIHRoZSBnaXZlbiBJRC4gKi8gICAgUnIoZSwgdCkge1xuICAgICAgICBlLmZvckVhY2goKGUgPT4gdGhpcy5hZGRSZWZlcmVuY2UoZSwgdCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5IGZvciB0aGUgZ2l2ZW5cbiAgICAgKiBJRC5cbiAgICAgKi8gICAgcmVtb3ZlUmVmZXJlbmNlKGUsIHQpIHtcbiAgICAgICAgdGhpcy5WcihuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShlLCB0KSk7XG4gICAgfVxuICAgIG1yKGUsIHQpIHtcbiAgICAgICAgZS5mb3JFYWNoKChlID0+IHRoaXMucmVtb3ZlUmVmZXJlbmNlKGUsIHQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsZWFycyBhbGwgcmVmZXJlbmNlcyB3aXRoIGEgZ2l2ZW4gSUQuIENhbGxzIHJlbW92ZVJlZigpIGZvciBlYWNoIGtleVxuICAgICAqIHJlbW92ZWQuXG4gICAgICovICAgIGdyKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBEb2N1bWVudEtleShuZXcgUmVzb3VyY2VQYXRoKFtdKSksIG4gPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZSh0LCBlKSwgciA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQsIGUgKyAxKSwgaSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5kci5mb3JFYWNoSW5SYW5nZShbIG4sIHIgXSwgKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5WcihlKSwgaS5wdXNoKGUua2V5KTtcbiAgICAgICAgfSkpLCBpO1xuICAgIH1cbiAgICBwcigpIHtcbiAgICAgICAgdGhpcy5Uci5mb3JFYWNoKChlID0+IHRoaXMuVnIoZSkpKTtcbiAgICB9XG4gICAgVnIoZSkge1xuICAgICAgICB0aGlzLlRyID0gdGhpcy5Uci5kZWxldGUoZSksIHRoaXMuZHIgPSB0aGlzLmRyLmRlbGV0ZShlKTtcbiAgICB9XG4gICAgeXIoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IERvY3VtZW50S2V5KG5ldyBSZXNvdXJjZVBhdGgoW10pKSwgbiA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQsIGUpLCByID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgZSArIDEpO1xuICAgICAgICBsZXQgaSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5kci5mb3JFYWNoSW5SYW5nZShbIG4sIHIgXSwgKGUgPT4ge1xuICAgICAgICAgICAgaSA9IGkuYWRkKGUua2V5KTtcbiAgICAgICAgfSkpLCBpO1xuICAgIH1cbiAgICBjb250YWluc0tleShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShlLCAwKSwgbiA9IHRoaXMuVHIuZmlyc3RBZnRlck9yRXF1YWwodCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBuICYmIGUuaXNFcXVhbChuLmtleSk7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMua2V5ID0gZSwgdGhpcy53ciA9IHQ7XG4gICAgfVxuICAgIC8qKiBDb21wYXJlIGJ5IGtleSB0aGVuIGJ5IElEICovICAgIHN0YXRpYyBFcihlLCB0KSB7XG4gICAgICAgIHJldHVybiBEb2N1bWVudEtleS5jb21wYXJhdG9yKGUua2V5LCB0LmtleSkgfHwgX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS53ciwgdC53cik7XG4gICAgfVxuICAgIC8qKiBDb21wYXJlIGJ5IElEIHRoZW4gYnkga2V5ICovICAgIHN0YXRpYyBBcihlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLndyLCB0LndyKSB8fCBEb2N1bWVudEtleS5jb21wYXJhdG9yKGUua2V5LCB0LmtleSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5TXV0YXRpb25RdWV1ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmluZGV4TWFuYWdlciA9IGUsIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXQgb2YgYWxsIG11dGF0aW9ucyB0aGF0IGhhdmUgYmVlbiBzZW50IGJ1dCBub3QgeWV0IGJlZW4gYXBwbGllZCB0b1xuICAgICAgICAgKiB0aGUgYmFja2VuZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubXV0YXRpb25RdWV1ZSA9IFtdLCBcbiAgICAgICAgLyoqIE5leHQgdmFsdWUgdG8gdXNlIHdoZW4gYXNzaWduaW5nIHNlcXVlbnRpYWwgSURzIHRvIGVhY2ggbXV0YXRpb24gYmF0Y2guICovXG4gICAgICAgIHRoaXMuU3IgPSAxLCBcbiAgICAgICAgLyoqIEFuIG9yZGVyZWQgbWFwcGluZyBiZXR3ZWVuIGRvY3VtZW50cyBhbmQgdGhlIG11dGF0aW9ucyBiYXRjaCBJRHMuICovXG4gICAgICAgIHRoaXMuYnIgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UuRXIpO1xuICAgIH1cbiAgICBjaGVja0VtcHR5KGUpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKDAgPT09IHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgpO1xuICAgIH1cbiAgICBhZGRNdXRhdGlvbkJhdGNoKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IHRoaXMuU3I7XG4gICAgICAgIHRoaXMuU3IrKywgdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCA+IDAgJiYgdGhpcy5tdXRhdGlvblF1ZXVlW3RoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGggLSAxXTtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBNdXRhdGlvbkJhdGNoKGksIHQsIG4sIHIpO1xuICAgICAgICB0aGlzLm11dGF0aW9uUXVldWUucHVzaChzKTtcbiAgICAgICAgLy8gVHJhY2sgcmVmZXJlbmNlcyBieSBkb2N1bWVudCBrZXkgYW5kIGluZGV4IGNvbGxlY3Rpb24gcGFyZW50cy5cbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHIpIHRoaXMuYnIgPSB0aGlzLmJyLmFkZChuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZSh0LmtleSwgaSkpLCBcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIuYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgoZSwgdC5rZXkucGF0aC5wb3BMYXN0KCkpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUocyk7XG4gICAgfVxuICAgIGxvb2t1cE11dGF0aW9uQmF0Y2goZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5Ecih0KSk7XG4gICAgfVxuICAgIGdldE5leHRNdXRhdGlvbkJhdGNoQWZ0ZXJCYXRjaElkKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQgKyAxLCByID0gdGhpcy52cihuKSwgaSA9IHIgPCAwID8gMCA6IHI7XG4gICAgICAgIC8vIFRoZSByZXF1ZXN0ZWQgYmF0Y2hJZCBtYXkgc3RpbGwgYmUgb3V0IG9mIHJhbmdlIHNvIG5vcm1hbGl6ZSBpdCB0byB0aGVcbiAgICAgICAgLy8gc3RhcnQgb2YgdGhlIHF1ZXVlLlxuICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoID4gaSA/IHRoaXMubXV0YXRpb25RdWV1ZVtpXSA6IG51bGwpO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoMCA9PT0gdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCA/IC0xIDogdGhpcy5TciAtIDEpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXMoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5tdXRhdGlvblF1ZXVlLnNsaWNlKCkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZSh0LCAwKSwgciA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnIuZm9yRWFjaEluUmFuZ2UoWyBuLCByIF0sIChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLkRyKGUud3IpO1xuICAgICAgICAgICAgaS5wdXNoKHQpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKGkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleXMoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShlLCAwKSwgciA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKGUsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSk7XG4gICAgICAgICAgICB0aGlzLmJyLmZvckVhY2hJblJhbmdlKFsgdCwgciBdLCAoZSA9PiB7XG4gICAgICAgICAgICAgICAgbiA9IG4uYWRkKGUud3IpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMuQ3IobikpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdRdWVyeShlLCB0KSB7XG4gICAgICAgIC8vIFVzZSB0aGUgcXVlcnkgcGF0aCBhcyBhIHByZWZpeCBmb3IgdGVzdGluZyBpZiBhIGRvY3VtZW50IG1hdGNoZXMgdGhlXG4gICAgICAgIC8vIHF1ZXJ5LlxuICAgICAgICBjb25zdCBuID0gdC5wYXRoLCByID0gbi5sZW5ndGggKyAxO1xuICAgICAgICAvLyBDb25zdHJ1Y3QgYSBkb2N1bWVudCByZWZlcmVuY2UgZm9yIGFjdHVhbGx5IHNjYW5uaW5nIHRoZSBpbmRleC4gVW5saWtlXG4gICAgICAgIC8vIHRoZSBwcmVmaXggdGhlIGRvY3VtZW50IGtleSBpbiB0aGlzIHJlZmVyZW5jZSBtdXN0IGhhdmUgYW4gZXZlbiBudW1iZXIgb2ZcbiAgICAgICAgLy8gc2VnbWVudHMuIFRoZSBlbXB0eSBzZWdtZW50IGNhbiBiZSB1c2VkIGEgc3VmZml4IG9mIHRoZSBxdWVyeSBwYXRoXG4gICAgICAgIC8vIGJlY2F1c2UgaXQgcHJlY2VkZXMgYWxsIG90aGVyIHNlZ21lbnRzIGluIGFuIG9yZGVyZWQgdHJhdmVyc2FsLlxuICAgICAgICBsZXQgaSA9IG47XG4gICAgICAgIERvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkoaSkgfHwgKGkgPSBpLmNoaWxkKFwiXCIpKTtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKG5ldyBEb2N1bWVudEtleShpKSwgMCk7XG4gICAgICAgIC8vIEZpbmQgdW5pcXVlIGJhdGNoSURzIHJlZmVyZW5jZWQgYnkgYWxsIGRvY3VtZW50cyBwb3RlbnRpYWxseSBtYXRjaGluZyB0aGVcbiAgICAgICAgLy8gcXVlcnkuXG4gICAgICAgICAgICAgICAgbGV0IG8gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnIuZm9yRWFjaFdoaWxlKChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmtleS5wYXRoO1xuICAgICAgICAgICAgcmV0dXJuICEhbi5pc1ByZWZpeE9mKHQpICYmIChcbiAgICAgICAgICAgIC8vIFJvd3Mgd2l0aCBkb2N1bWVudCBrZXlzIG1vcmUgdGhhbiBvbmUgc2VnbWVudCBsb25nZXIgdGhhbiB0aGUgcXVlcnlcbiAgICAgICAgICAgIC8vIHBhdGggY2FuJ3QgYmUgbWF0Y2hlcy4gRm9yIGV4YW1wbGUsIGEgcXVlcnkgb24gJ3Jvb21zJyBjYW4ndCBtYXRjaFxuICAgICAgICAgICAgLy8gdGhlIGRvY3VtZW50IC9yb29tcy9hYmMvbWVzc2FnZXMveHl4LlxuICAgICAgICAgICAgLy8gVE9ETyhtY2cpOiB3ZSdsbCBuZWVkIGEgZGlmZmVyZW50IHNjYW5uZXIgd2hlbiB3ZSBpbXBsZW1lbnRcbiAgICAgICAgICAgIC8vIGFuY2VzdG9yIHF1ZXJpZXMuXG4gICAgICAgICAgICB0Lmxlbmd0aCA9PT0gciAmJiAobyA9IG8uYWRkKGUud3IpKSwgITApO1xuICAgICAgICB9KSwgcyksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMuQ3IobykpO1xuICAgIH1cbiAgICBDcihlKSB7XG4gICAgICAgIC8vIENvbnN0cnVjdCBhbiBhcnJheSBvZiBtYXRjaGluZyBiYXRjaGVzLCBzb3J0ZWQgYnkgYmF0Y2hJRCB0byBlbnN1cmUgdGhhdFxuICAgICAgICAvLyBtdWx0aXBsZSBtdXRhdGlvbnMgYWZmZWN0aW5nIHRoZSBzYW1lIGRvY3VtZW50IGtleSBhcmUgYXBwbGllZCBpbiBvcmRlci5cbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLkRyKGUpO1xuICAgICAgICAgICAgbnVsbCAhPT0gbiAmJiB0LnB1c2gobik7XG4gICAgICAgIH0pKSwgdDtcbiAgICB9XG4gICAgcmVtb3ZlTXV0YXRpb25CYXRjaChlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KDAgPT09IHRoaXMuRnIodC5iYXRjaElkLCBcInJlbW92ZWRcIikpLCB0aGlzLm11dGF0aW9uUXVldWUuc2hpZnQoKTtcbiAgICAgICAgbGV0IG4gPSB0aGlzLmJyO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godC5tdXRhdGlvbnMsIChyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShyLmtleSwgdC5iYXRjaElkKTtcbiAgICAgICAgICAgIHJldHVybiBuID0gbi5kZWxldGUoaSksIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUubWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgci5rZXkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5iciA9IG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgT24oZSkge1xuICAgICAgICAvLyBOby1vcCBzaW5jZSB0aGUgbWVtb3J5IG11dGF0aW9uIHF1ZXVlIGRvZXMgbm90IG1haW50YWluIGEgc2VwYXJhdGUgY2FjaGUuXG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQsIDApLCByID0gdGhpcy5ici5maXJzdEFmdGVyT3JFcXVhbChuKTtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHQuaXNFcXVhbChyICYmIHIua2V5KSk7XG4gICAgfVxuICAgIHBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgsIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpbmRzIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4gYmF0Y2hJZCBpbiB0aGUgbXV0YXRpb24gcXVldWUgYW5kIGFzc2VydHMgdGhhdFxuICAgICAqIHRoZSByZXN1bHRpbmcgaW5kZXggaXMgd2l0aGluIHRoZSBib3VuZHMgb2YgdGhlIHF1ZXVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGJhdGNoSWQgLSBUaGUgYmF0Y2hJZCB0byBzZWFyY2ggZm9yXG4gICAgICogQHBhcmFtIGFjdGlvbiAtIEEgZGVzY3JpcHRpb24gb2Ygd2hhdCB0aGUgY2FsbGVyIGlzIGRvaW5nLCBwaHJhc2VkIGluIHBhc3NpdmVcbiAgICAgKiBmb3JtIChlLmcuIFwiYWNrbm93bGVkZ2VkXCIgaW4gYSByb3V0aW5lIHRoYXQgYWNrbm93bGVkZ2VzIGJhdGNoZXMpLlxuICAgICAqLyAgICBGcihlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZyKGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaW5kcyB0aGUgaW5kZXggb2YgdGhlIGdpdmVuIGJhdGNoSWQgaW4gdGhlIG11dGF0aW9uIHF1ZXVlLiBUaGlzIG9wZXJhdGlvblxuICAgICAqIGlzIE8oMSkuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgY29tcHV0ZWQgaW5kZXggb2YgdGhlIGJhdGNoIHdpdGggdGhlIGdpdmVuIGJhdGNoSWQsIGJhc2VkIG9uXG4gICAgICogdGhlIHN0YXRlIG9mIHRoZSBxdWV1ZS4gTm90ZSB0aGlzIGluZGV4IGNhbiBiZSBuZWdhdGl2ZSBpZiB0aGUgcmVxdWVzdGVkXG4gICAgICogYmF0Y2hJZCBoYXMgYWxyZWFkeSBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgcXVldWUgb3IgcGFzdCB0aGUgZW5kIG9mIHRoZVxuICAgICAqIHF1ZXVlIGlmIHRoZSBiYXRjaElkIGlzIGxhcmdlciB0aGFuIHRoZSBsYXN0IGFkZGVkIGJhdGNoLlxuICAgICAqLyAgICB2cihlKSB7XG4gICAgICAgIGlmICgwID09PSB0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoKSBcbiAgICAgICAgLy8gQXMgYW4gaW5kZXggdGhpcyBpcyBwYXN0IHRoZSBlbmQgb2YgdGhlIHF1ZXVlXG4gICAgICAgIHJldHVybiAwO1xuICAgICAgICAvLyBFeGFtaW5lIHRoZSBmcm9udCBvZiB0aGUgcXVldWUgdG8gZmlndXJlIG91dCB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZVxuICAgICAgICAvLyBiYXRjaElkIGFuZCBpbmRleGVzIGluIHRoZSBhcnJheS4gTm90ZSB0aGF0IHNpbmNlIHRoZSBxdWV1ZSBpcyBvcmRlcmVkXG4gICAgICAgIC8vIGJ5IGJhdGNoSWQsIGlmIHRoZSBmaXJzdCBiYXRjaCBoYXMgYSBsYXJnZXIgYmF0Y2hJZCB0aGVuIHRoZSByZXF1ZXN0ZWRcbiAgICAgICAgLy8gYmF0Y2hJZCBkb2Vzbid0IGV4aXN0IGluIHRoZSBxdWV1ZS5cbiAgICAgICAgICAgICAgICByZXR1cm4gZSAtIHRoaXMubXV0YXRpb25RdWV1ZVswXS5iYXRjaElkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIHZlcnNpb24gb2YgbG9va3VwTXV0YXRpb25CYXRjaCB0aGF0IGRvZXNuJ3QgcmV0dXJuIGEgcHJvbWlzZSwgdGhpcyBtYWtlc1xuICAgICAqIG90aGVyIGZ1bmN0aW9ucyB0aGF0IHVzZXMgdGhpcyBjb2RlIGVhc2llciB0byByZWFkIGFuZCBtb3JlIGVmZmljaWVudC5cbiAgICAgKi8gICAgRHIoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy52cihlKTtcbiAgICAgICAgaWYgKHQgPCAwIHx8IHQgPj0gdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCkgcmV0dXJuIG51bGw7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9uUXVldWVbdF07XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgbWVtb3J5LW9ubHkgUmVtb3RlRG9jdW1lbnRDYWNoZSBmb3IgSW5kZXhlZERiLiBUbyBjb25zdHJ1Y3QsIGludm9rZVxuICogYG5ld01lbW9yeVJlbW90ZURvY3VtZW50Q2FjaGUoKWAuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlSW1wbCB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHNpemVyIC0gVXNlZCB0byBhc3Nlc3MgdGhlIHNpemUgb2YgYSBkb2N1bWVudC4gRm9yIGVhZ2VyIEdDLCB0aGlzIGlzXG4gICAgICogZXhwZWN0ZWQgdG8ganVzdCByZXR1cm4gMCB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGRvaW5nIHRoZSB3b3JrIG9mXG4gICAgICogY2FsY3VsYXRpbmcgdGhlIHNpemUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLk1yID0gZSwgXG4gICAgICAgIC8qKiBVbmRlcmx5aW5nIGNhY2hlIG9mIGRvY3VtZW50cyBhbmQgdGhlaXIgcmVhZCB0aW1lcy4gKi9cbiAgICAgICAgdGhpcy5kb2NzID0gZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50RW50cnlNYXAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcbiAgICAgICAgfSgpLCBcbiAgICAgICAgLyoqIFNpemUgb2YgYWxsIGNhY2hlZCBkb2N1bWVudHMuICovXG4gICAgICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgfVxuICAgIHNldEluZGV4TWFuYWdlcihlKSB7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgc3VwcGxpZWQgZW50cnkgdG8gdGhlIGNhY2hlIGFuZCB1cGRhdGVzIHRoZSBjYWNoZSBzaXplIGFzIGFwcHJvcHJpYXRlLlxuICAgICAqXG4gICAgICogQWxsIGNhbGxzIG9mIGBhZGRFbnRyeWAgIGFyZSByZXF1aXJlZCB0byBnbyB0aHJvdWdoIHRoZSBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlclxuICAgICAqIHJldHVybmVkIGJ5IGBuZXdDaGFuZ2VCdWZmZXIoKWAuXG4gICAgICovICAgIGFkZEVudHJ5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQua2V5LCByID0gdGhpcy5kb2NzLmdldChuKSwgaSA9IHIgPyByLnNpemUgOiAwLCBzID0gdGhpcy5Ncih0KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jcyA9IHRoaXMuZG9jcy5pbnNlcnQobiwge1xuICAgICAgICAgICAgZG9jdW1lbnQ6IHQubXV0YWJsZUNvcHkoKSxcbiAgICAgICAgICAgIHNpemU6IHNcbiAgICAgICAgfSksIHRoaXMuc2l6ZSArPSBzIC0gaSwgdGhpcy5pbmRleE1hbmFnZXIuYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgoZSwgbi5wYXRoLnBvcExhc3QoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBlbnRyeSBmcm9tIHRoZSBjYWNoZSBhbmQgdXBkYXRlcyB0aGUgY2FjaGUgc2l6ZSBhcyBhcHByb3ByaWF0ZS5cbiAgICAgKlxuICAgICAqIEFsbCBjYWxscyBvZiBgcmVtb3ZlRW50cnlgIGFyZSByZXF1aXJlZCB0byBnbyB0aHJvdWdoIHRoZSBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlclxuICAgICAqIHJldHVybmVkIGJ5IGBuZXdDaGFuZ2VCdWZmZXIoKWAuXG4gICAgICovICAgIHJlbW92ZUVudHJ5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZG9jcy5nZXQoZSk7XG4gICAgICAgIHQgJiYgKHRoaXMuZG9jcyA9IHRoaXMuZG9jcy5yZW1vdmUoZSksIHRoaXMuc2l6ZSAtPSB0LnNpemUpO1xuICAgIH1cbiAgICBnZXRFbnRyeShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmRvY3MuZ2V0KHQpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobiA/IG4uZG9jdW1lbnQubXV0YWJsZUNvcHkoKSA6IE11dGFibGVEb2N1bWVudC5uZXdJbnZhbGlkRG9jdW1lbnQodCkpO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgICAgIHJldHVybiB0LmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuZG9jcy5nZXQoZSk7XG4gICAgICAgICAgICBuID0gbi5pbnNlcnQoZSwgdCA/IHQuZG9jdW1lbnQubXV0YWJsZUNvcHkoKSA6IE11dGFibGVEb2N1bWVudC5uZXdJbnZhbGlkRG9jdW1lbnQoZSkpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKG4pO1xuICAgIH1cbiAgICBnZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgbGV0IGkgPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgICAgIC8vIERvY3VtZW50cyBhcmUgb3JkZXJlZCBieSBrZXksIHNvIHdlIGNhbiB1c2UgYSBwcmVmaXggc2NhbiB0byBuYXJyb3cgZG93blxuICAgICAgICAvLyB0aGUgZG9jdW1lbnRzIHdlIG5lZWQgdG8gbWF0Y2ggdGhlIHF1ZXJ5IGFnYWluc3QuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IHQucGF0aCwgbyA9IG5ldyBEb2N1bWVudEtleShzLmNoaWxkKFwiXCIpKSwgXyA9IHRoaXMuZG9jcy5nZXRJdGVyYXRvckZyb20obyk7XG4gICAgICAgIGZvciAoO18uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHtrZXk6IGUsIHZhbHVlOiB7ZG9jdW1lbnQ6IG99fSA9IF8uZ2V0TmV4dCgpO1xuICAgICAgICAgICAgaWYgKCFzLmlzUHJlZml4T2YoZS5wYXRoKSkgYnJlYWs7XG4gICAgICAgICAgICBlLnBhdGgubGVuZ3RoID4gcy5sZW5ndGggKyAxIHx8IChfX1BSSVZBVEVfaW5kZXhPZmZzZXRDb21wYXJhdG9yKF9fUFJJVkFURV9uZXdJbmRleE9mZnNldEZyb21Eb2N1bWVudChvKSwgbikgPD0gMCB8fCAoci5oYXMoby5rZXkpIHx8IF9fUFJJVkFURV9xdWVyeU1hdGNoZXModCwgbykpICYmIChpID0gaS5pbnNlcnQoby5rZXksIG8ubXV0YWJsZUNvcHkoKSkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoaSk7XG4gICAgfVxuICAgIGdldEFsbEZyb21Db2xsZWN0aW9uR3JvdXAoZSwgdCwgbiwgcikge1xuICAgICAgICAvLyBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWQgZnJvbSB0aGUgSW5kZXhCYWNrZmlsbGVyIGlmIHBlcnNpc3RlbmNlXG4gICAgICAgIC8vIGlzIGVuYWJsZWQuXG4gICAgICAgIGZhaWwoKTtcbiAgICB9XG4gICAgT3IoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godGhpcy5kb2NzLCAoZSA9PiB0KGUpKSk7XG4gICAgfVxuICAgIG5ld0NoYW5nZUJ1ZmZlcihlKSB7XG4gICAgICAgIC8vIGB0cmFja1JlbW92YWxzYCBpcyBpZ25vcmVzIHNpbmNlIHRoZSBNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlIGtlZXBzXG4gICAgICAgIC8vIGEgc2VwYXJhdGUgY2hhbmdlbG9nIGFuZCBkb2VzIG5vdCBuZWVkIHNwZWNpYWwgaGFuZGxpbmcgZm9yIHJlbW92YWxzLlxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlcih0aGlzKTtcbiAgICB9XG4gICAgZ2V0U2l6ZShlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLnNpemUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IG1lbW9yeS1vbmx5IFJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKlxuICogQHBhcmFtIHNpemVyIC0gVXNlZCB0byBhc3Nlc3MgdGhlIHNpemUgb2YgYSBkb2N1bWVudC4gRm9yIGVhZ2VyIEdDLCB0aGlzIGlzXG4gKiBleHBlY3RlZCB0byBqdXN0IHJldHVybiAwIHRvIGF2b2lkIHVubmVjZXNzYXJpbHkgZG9pbmcgdGhlIHdvcmsgb2ZcbiAqIGNhbGN1bGF0aW5nIHRoZSBzaXplLlxuICovXG4vKipcbiAqIEhhbmRsZXMgdGhlIGRldGFpbHMgb2YgYWRkaW5nIGFuZCB1cGRhdGluZyBkb2N1bWVudHMgaW4gdGhlIE1lbW9yeVJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciBleHRlbmRzIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuY3IgPSBlO1xuICAgIH1cbiAgICBhcHBseUNoYW5nZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmNoYW5nZXMuZm9yRWFjaCgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgIHIuaXNWYWxpZERvY3VtZW50KCkgPyB0LnB1c2godGhpcy5jci5hZGRFbnRyeShlLCByKSkgOiB0aGlzLmNyLnJlbW92ZUVudHJ5KG4pO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHQpO1xuICAgIH1cbiAgICBnZXRGcm9tQ2FjaGUoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jci5nZXRFbnRyeShlLCB0KTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNhY2hlKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3IuZ2V0RW50cmllcyhlLCB0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9NZW1vcnlUYXJnZXRDYWNoZSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gZSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNYXBzIGEgdGFyZ2V0IHRvIHRoZSBkYXRhIGFib3V0IHRoYXQgdGFyZ2V0XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLk5yID0gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQoZSkpLCBfX1BSSVZBVEVfdGFyZ2V0RXF1YWxzKSwgXG4gICAgICAgIC8qKiBUaGUgbGFzdCByZWNlaXZlZCBzbmFwc2hvdCB2ZXJzaW9uLiAqL1xuICAgICAgICB0aGlzLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24gPSBTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICAvKiogVGhlIGhpZ2hlc3QgbnVtYmVyZWQgdGFyZ2V0IElEIGVuY291bnRlcmVkLiAqL1xuICAgICAgICB0aGlzLmhpZ2hlc3RUYXJnZXRJZCA9IDAsIFxuICAgICAgICAvKiogVGhlIGhpZ2hlc3Qgc2VxdWVuY2UgbnVtYmVyIGVuY291bnRlcmVkLiAqL1xuICAgICAgICB0aGlzLkxyID0gMCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIG9yZGVyZWQgYmlkaXJlY3Rpb25hbCBtYXBwaW5nIGJldHdlZW4gZG9jdW1lbnRzIGFuZCB0aGUgcmVtb3RlIHRhcmdldFxuICAgICAgICAgKiBJRHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkJyID0gbmV3IF9fUFJJVkFURV9SZWZlcmVuY2VTZXQsIHRoaXMudGFyZ2V0Q291bnQgPSAwLCB0aGlzLmtyID0gX19QUklWQVRFX1RhcmdldElkR2VuZXJhdG9yLkJuKCk7XG4gICAgfVxuICAgIGZvckVhY2hUYXJnZXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5Oci5mb3JFYWNoKCgoZSwgbikgPT4gdChuKSkpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbik7XG4gICAgfVxuICAgIGdldEhpZ2hlc3RTZXF1ZW5jZU51bWJlcihlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLkxyKTtcbiAgICB9XG4gICAgYWxsb2NhdGVUYXJnZXRJZChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpZ2hlc3RUYXJnZXRJZCA9IHRoaXMua3IubmV4dCgpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLmhpZ2hlc3RUYXJnZXRJZCk7XG4gICAgfVxuICAgIHNldFRhcmdldHNNZXRhZGF0YShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuICYmICh0aGlzLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24gPSBuKSwgdCA+IHRoaXMuTHIgJiYgKHRoaXMuTHIgPSB0KSwgXG4gICAgICAgIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIEtuKGUpIHtcbiAgICAgICAgdGhpcy5Oci5zZXQoZS50YXJnZXQsIGUpO1xuICAgICAgICBjb25zdCB0ID0gZS50YXJnZXRJZDtcbiAgICAgICAgdCA+IHRoaXMuaGlnaGVzdFRhcmdldElkICYmICh0aGlzLmtyID0gbmV3IF9fUFJJVkFURV9UYXJnZXRJZEdlbmVyYXRvcih0KSwgdGhpcy5oaWdoZXN0VGFyZ2V0SWQgPSB0KSwgXG4gICAgICAgIGUuc2VxdWVuY2VOdW1iZXIgPiB0aGlzLkxyICYmICh0aGlzLkxyID0gZS5zZXF1ZW5jZU51bWJlcik7XG4gICAgfVxuICAgIGFkZFRhcmdldERhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5Lbih0KSwgdGhpcy50YXJnZXRDb3VudCArPSAxLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICB1cGRhdGVUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuS24odCksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldERhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5Oci5kZWxldGUodC50YXJnZXQpLCB0aGlzLkJyLmdyKHQudGFyZ2V0SWQpLCB0aGlzLnRhcmdldENvdW50IC09IDEsIFxuICAgICAgICBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXRzKGUsIHQsIG4pIHtcbiAgICAgICAgbGV0IHIgPSAwO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLk5yLmZvckVhY2goKChzLCBvKSA9PiB7XG4gICAgICAgICAgICBvLnNlcXVlbmNlTnVtYmVyIDw9IHQgJiYgbnVsbCA9PT0gbi5nZXQoby50YXJnZXRJZCkgJiYgKHRoaXMuTnIuZGVsZXRlKHMpLCBpLnB1c2godGhpcy5yZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCBvLnRhcmdldElkKSksIFxuICAgICAgICAgICAgcisrKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihpKS5uZXh0KCgoKSA9PiByKSk7XG4gICAgfVxuICAgIGdldFRhcmdldENvdW50KGUpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMudGFyZ2V0Q291bnQpO1xuICAgIH1cbiAgICBnZXRUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuTnIuZ2V0KHQpIHx8IG51bGw7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShuKTtcbiAgICB9XG4gICAgYWRkTWF0Y2hpbmdLZXlzKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQnIuUnIodCwgbiksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZU1hdGNoaW5nS2V5cyhlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuQnIubXIodCwgbik7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLCBpID0gW107XG4gICAgICAgIHJldHVybiByICYmIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBpLnB1c2goci5tYXJrUG90ZW50aWFsbHlPcnBoYW5lZChlLCB0KSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IoaSk7XG4gICAgfVxuICAgIHJlbW92ZU1hdGNoaW5nS2V5c0ZvclRhcmdldElkKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQnIuZ3IodCksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldE1hdGNoaW5nS2V5c0ZvclRhcmdldElkKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuQnIueXIodCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShuKTtcbiAgICB9XG4gICAgY29udGFpbnNLZXkoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5Cci5jb250YWluc0tleSh0KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIG1lbW9yeS1iYWNrZWQgaW5zdGFuY2Ugb2YgUGVyc2lzdGVuY2UuIERhdGEgaXMgc3RvcmVkIG9ubHkgaW4gUkFNIGFuZFxuICogbm90IHBlcnNpc3RlZCBhY3Jvc3Mgc2Vzc2lvbnMuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlQZXJzaXN0ZW5jZSB7XG4gICAgLyoqXG4gICAgICogVGhlIGNvbnN0cnVjdG9yIGFjY2VwdHMgYSBmYWN0b3J5IGZvciBjcmVhdGluZyBhIHJlZmVyZW5jZSBkZWxlZ2F0ZS4gVGhpc1xuICAgICAqIGFsbG93cyBib3RoIHRoZSBkZWxlZ2F0ZSBhbmQgdGhpcyBpbnN0YW5jZSB0byBoYXZlIHN0cm9uZyByZWZlcmVuY2VzIHRvXG4gICAgICogZWFjaCBvdGhlciB3aXRob3V0IGhhdmluZyBudWxsYWJsZSBmaWVsZHMgdGhhdCB3b3VsZCB0aGVuIG5lZWQgdG8gYmVcbiAgICAgKiBjaGVja2VkIG9yIGFzc2VydGVkIG9uIGV2ZXJ5IGFjY2Vzcy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMucXIgPSB7fSwgdGhpcy5vdmVybGF5cyA9IHt9LCB0aGlzLlFyID0gbmV3IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZSgwKSwgdGhpcy5LciA9ICExLCBcbiAgICAgICAgdGhpcy5LciA9ICEwLCB0aGlzLiRyID0gbmV3IF9fUFJJVkFURV9NZW1vcnlHbG9iYWxzQ2FjaGUsIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSBlKHRoaXMpLCBcbiAgICAgICAgdGhpcy5VciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5VGFyZ2V0Q2FjaGUodGhpcyk7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gbmV3IF9fUFJJVkFURV9NZW1vcnlJbmRleE1hbmFnZXIsIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeVJlbW90ZURvY3VtZW50Q2FjaGVJbXBsKGUpO1xuICAgICAgICB9KChlID0+IHRoaXMucmVmZXJlbmNlRGVsZWdhdGUuV3IoZSkpKSwgdGhpcy5zZXJpYWxpemVyID0gbmV3IF9fUFJJVkFURV9Mb2NhbFNlcmlhbGl6ZXIodCksIFxuICAgICAgICB0aGlzLkdyID0gbmV3IF9fUFJJVkFURV9NZW1vcnlCdW5kbGVDYWNoZSh0aGlzLnNlcmlhbGl6ZXIpO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgLy8gTm8gZHVyYWJsZSBzdGF0ZSB0byBlbnN1cmUgaXMgY2xvc2VkIG9uIHNodXRkb3duLlxuICAgICAgICByZXR1cm4gdGhpcy5LciA9ICExLCBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0IHN0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLktyO1xuICAgIH1cbiAgICBzZXREYXRhYmFzZURlbGV0ZWRMaXN0ZW5lcigpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIHNldE5ldHdvcmtFbmFibGVkKCkge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG4gICAgZ2V0SW5kZXhNYW5hZ2VyKGUpIHtcbiAgICAgICAgLy8gV2UgZG8gbm90IGN1cnJlbnRseSBzdXBwb3J0IGluZGljZXMgZm9yIG1lbW9yeSBwZXJzaXN0ZW5jZSwgc28gd2UgY2FuXG4gICAgICAgIC8vIHJldHVybiB0aGUgc2FtZSBzaGFyZWQgaW5zdGFuY2Ugb2YgdGhlIG1lbW9yeSBpbmRleCBtYW5hZ2VyLlxuICAgICAgICByZXR1cm4gdGhpcy5pbmRleE1hbmFnZXI7XG4gICAgfVxuICAgIGdldERvY3VtZW50T3ZlcmxheUNhY2hlKGUpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLm92ZXJsYXlzW2UudG9LZXkoKV07XG4gICAgICAgIHJldHVybiB0IHx8ICh0ID0gbmV3IF9fUFJJVkFURV9NZW1vcnlEb2N1bWVudE92ZXJsYXlDYWNoZSwgdGhpcy5vdmVybGF5c1tlLnRvS2V5KCldID0gdCksIFxuICAgICAgICB0O1xuICAgIH1cbiAgICBnZXRNdXRhdGlvblF1ZXVlKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSB0aGlzLnFyW2UudG9LZXkoKV07XG4gICAgICAgIHJldHVybiBuIHx8IChuID0gbmV3IF9fUFJJVkFURV9NZW1vcnlNdXRhdGlvblF1ZXVlKHQsIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUpLCB0aGlzLnFyW2UudG9LZXkoKV0gPSBuKSwgXG4gICAgICAgIG47XG4gICAgfVxuICAgIGdldEdsb2JhbHNDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHI7XG4gICAgfVxuICAgIGdldFRhcmdldENhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5VcjtcbiAgICB9XG4gICAgZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZTtcbiAgICB9XG4gICAgZ2V0QnVuZGxlQ2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkdyO1xuICAgIH1cbiAgICBydW5UcmFuc2FjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIk1lbW9yeVBlcnNpc3RlbmNlXCIsIFwiU3RhcnRpbmcgdHJhbnNhY3Rpb246XCIsIGUpO1xuICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9NZW1vcnlUcmFuc2FjdGlvbih0aGlzLlFyLm5leHQoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLnpyKCksIG4ocikubmV4dCgoZSA9PiB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLmpyKHIpLm5leHQoKCgpID0+IGUpKSkpLnRvUHJvbWlzZSgpLnRoZW4oKGUgPT4gKHIucmFpc2VPbkNvbW1pdHRlZEV2ZW50KCksIFxuICAgICAgICBlKSkpO1xuICAgIH1cbiAgICBIcihlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2Uub3IoT2JqZWN0LnZhbHVlcyh0aGlzLnFyKS5tYXAoKG4gPT4gKCkgPT4gbi5jb250YWluc0tleShlLCB0KSkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogTWVtb3J5IHBlcnNpc3RlbmNlIGlzIG5vdCBhY3R1YWxseSB0cmFuc2FjdGlvbmFsLCBidXQgZnV0dXJlIGltcGxlbWVudGF0aW9uc1xuICogbWF5IGhhdmUgdHJhbnNhY3Rpb24tc2NvcGVkIHN0YXRlLlxuICovIGNsYXNzIF9fUFJJVkFURV9NZW1vcnlUcmFuc2FjdGlvbiBleHRlbmRzIFBlcnNpc3RlbmNlVHJhbnNhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5jdXJyZW50U2VxdWVuY2VOdW1iZXIgPSBlO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX01lbW9yeUVhZ2VyRGVsZWdhdGUge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IGUsIFxuICAgICAgICAvKiogVHJhY2tzIGFsbCBkb2N1bWVudHMgdGhhdCBhcmUgYWN0aXZlIGluIFF1ZXJ5IHZpZXdzLiAqL1xuICAgICAgICB0aGlzLkpyID0gbmV3IF9fUFJJVkFURV9SZWZlcmVuY2VTZXQsIFxuICAgICAgICAvKiogVGhlIGxpc3Qgb2YgZG9jdW1lbnRzIHRoYXQgYXJlIHBvdGVudGlhbGx5IEdDZWQgYWZ0ZXIgZWFjaCB0cmFuc2FjdGlvbi4gKi9cbiAgICAgICAgdGhpcy5ZciA9IG51bGw7XG4gICAgfVxuICAgIHN0YXRpYyBacihlKSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeUVhZ2VyRGVsZWdhdGUoZSk7XG4gICAgfVxuICAgIGdldCBYcigpIHtcbiAgICAgICAgaWYgKHRoaXMuWXIpIHJldHVybiB0aGlzLllyO1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxuICAgIGFkZFJlZmVyZW5jZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkpyLmFkZFJlZmVyZW5jZShuLCB0KSwgdGhpcy5Yci5kZWxldGUobi50b1N0cmluZygpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlUmVmZXJlbmNlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSnIucmVtb3ZlUmVmZXJlbmNlKG4sIHQpLCB0aGlzLlhyLmFkZChuLnRvU3RyaW5nKCkpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBtYXJrUG90ZW50aWFsbHlPcnBoYW5lZChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlhyLmFkZCh0LnRvU3RyaW5nKCkpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXQoZSwgdCkge1xuICAgICAgICB0aGlzLkpyLmdyKHQudGFyZ2V0SWQpLmZvckVhY2goKGUgPT4gdGhpcy5Yci5hZGQoZS50b1N0cmluZygpKSkpO1xuICAgICAgICBjb25zdCBuID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpO1xuICAgICAgICByZXR1cm4gbi5nZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0LnRhcmdldElkKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGUuZm9yRWFjaCgoZSA9PiB0aGlzLlhyLmFkZChlLnRvU3RyaW5nKCkpKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuLnJlbW92ZVRhcmdldERhdGEoZSwgdCkpKTtcbiAgICB9XG4gICAgenIoKSB7XG4gICAgICAgIHRoaXMuWXIgPSBuZXcgU2V0O1xuICAgIH1cbiAgICBqcihlKSB7XG4gICAgICAgIC8vIFJlbW92ZSBuZXdseSBvcnBoYW5lZCBkb2N1bWVudHMuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnBlcnNpc3RlbmNlLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5uZXdDaGFuZ2VCdWZmZXIoKTtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHRoaXMuWHIsIChuID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBEb2N1bWVudEtleS5mcm9tUGF0aChuKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVpKGUsIHIpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIGUgfHwgdC5yZW1vdmVFbnRyeShyLCBTbmFwc2hvdFZlcnNpb24ubWluKCkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gKHRoaXMuWXIgPSBudWxsLCB0LmFwcGx5KGUpKSkpO1xuICAgIH1cbiAgICB1cGRhdGVMaW1ib0RvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWkoZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBlID8gdGhpcy5Yci5kZWxldGUodC50b1N0cmluZygpKSA6IHRoaXMuWHIuYWRkKHQudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgV3IoZSkge1xuICAgICAgICAvLyBGb3IgZWFnZXIgR0MsIHdlIGRvbid0IGNhcmUgYWJvdXQgdGhlIGRvY3VtZW50IHNpemUsIHRoZXJlIGFyZSBubyBzaXplIHRocmVzaG9sZHMuXG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBlaShlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2Uub3IoWyAoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLkpyLmNvbnRhaW5zS2V5KHQpKSwgKCkgPT4gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpLmNvbnRhaW5zS2V5KGUsIHQpLCAoKSA9PiB0aGlzLnBlcnNpc3RlbmNlLkhyKGUsIHQpIF0pO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX01lbW9yeUxydURlbGVnYXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSBlLCB0aGlzLnRpID0gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKGUucGF0aCkpLCAoKGUsIHQpID0+IGUuaXNFcXVhbCh0KSkpLCBcbiAgICAgICAgdGhpcy5nYXJiYWdlQ29sbGVjdG9yID0gX19QUklWQVRFX25ld0xydUdhcmJhZ2VDb2xsZWN0b3IodGhpcywgdCk7XG4gICAgfVxuICAgIHN0YXRpYyBacihlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeUxydURlbGVnYXRlKGUsIHQpO1xuICAgIH1cbiAgICAvLyBOby1vcHMsIHByZXNlbnQgc28gbWVtb3J5IHBlcnNpc3RlbmNlIGRvZXNuJ3QgaGF2ZSB0byBjYXJlIHdoaWNoIGRlbGVnYXRlXG4gICAgLy8gaXQgaGFzLlxuICAgIHpyKCkge31cbiAgICBqcihlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBmb3JFYWNoVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS5mb3JFYWNoVGFyZ2V0KGUsIHQpO1xuICAgIH1cbiAgICBZbihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmVyKGUpO1xuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpLmdldFRhcmdldENvdW50KGUpLm5leHQoKGUgPT4gdC5uZXh0KCh0ID0+IGUgKyB0KSkpKTtcbiAgICB9XG4gICAgZXIoZSkge1xuICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzLlpuKGUsIChlID0+IHtcbiAgICAgICAgICAgIHQrKztcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICB9XG4gICAgWm4oZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godGhpcy50aSwgKChuLCByKSA9PiB0aGlzLm5yKGUsIG4sIHIpLm5leHQoKGUgPT4gZSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCkgOiB0KHIpKSkpKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLmdldFRhcmdldENhY2hlKCkucmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKTtcbiAgICB9XG4gICAgcmVtb3ZlT3JwaGFuZWREb2N1bWVudHMoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IDA7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLnBlcnNpc3RlbmNlLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKSwgaSA9IHIubmV3Q2hhbmdlQnVmZmVyKCk7XG4gICAgICAgIHJldHVybiByLk9yKGUsIChyID0+IHRoaXMubnIoZSwgciwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBlIHx8IChuKyssIGkucmVtb3ZlRW50cnkociwgU25hcHNob3RWZXJzaW9uLm1pbigpKSk7XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IGkuYXBwbHkoZSkpKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIG1hcmtQb3RlbnRpYWxseU9ycGhhbmVkKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGkuc2V0KHQsIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQud2l0aFNlcXVlbmNlTnVtYmVyKGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS51cGRhdGVUYXJnZXREYXRhKGUsIG4pO1xuICAgIH1cbiAgICBhZGRSZWZlcmVuY2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy50aS5zZXQobiwgZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVSZWZlcmVuY2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy50aS5zZXQobiwgZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICB1cGRhdGVMaW1ib0RvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGkuc2V0KHQsIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgV3IoZSkge1xuICAgICAgICBsZXQgdCA9IGUua2V5LnRvU3RyaW5nKCkubGVuZ3RoO1xuICAgICAgICByZXR1cm4gZS5pc0ZvdW5kRG9jdW1lbnQoKSAmJiAodCArPSBfX1BSSVZBVEVfZXN0aW1hdGVCeXRlU2l6ZShlLmRhdGEudmFsdWUpKSwgdDtcbiAgICB9XG4gICAgbnIoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLm9yKFsgKCkgPT4gdGhpcy5wZXJzaXN0ZW5jZS5IcihlLCB0KSwgKCkgPT4gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpLmNvbnRhaW5zS2V5KGUsIHQpLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy50aS5nZXQodCk7XG4gICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodm9pZCAwICE9PSBlICYmIGUgPiBuKTtcbiAgICAgICAgfSBdKTtcbiAgICB9XG4gICAgZ2V0Q2FjaGVTaXplKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpLmdldFNpemUoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFBlcmZvcm1zIGRhdGFiYXNlIGNyZWF0aW9uIGFuZCBzY2hlbWEgdXBncmFkZXMuICovIGNsYXNzIF9fUFJJVkFURV9TY2hlbWFDb252ZXJ0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgZGF0YWJhc2UgY3JlYXRpb24gYW5kIHNjaGVtYSB1cGdyYWRlcy5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCBpbiBwcm9kdWN0aW9uLCB0aGlzIG1ldGhvZCBpcyBvbmx5IGV2ZXIgdXNlZCB0byB1cGdyYWRlIHRoZSBzY2hlbWFcbiAgICAgKiB0byBTQ0hFTUFfVkVSU0lPTi4gRGlmZmVyZW50IHZhbHVlcyBvZiB0b1ZlcnNpb24gYXJlIG9ubHkgdXNlZCBmb3IgdGVzdGluZ1xuICAgICAqIGFuZCBsb2NhbCBmZWF0dXJlIGRldmVsb3BtZW50LlxuICAgICAqLyAgICBPKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfU2ltcGxlRGJUcmFuc2FjdGlvbihcImNyZWF0ZU9yVXBncmFkZVwiLCB0KTtcbiAgICAgICAgbiA8IDEgJiYgciA+PSAxICYmICghZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZVByaW1hcnlDbGllbnRTdG9yZShlKSB7XG4gICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwib3duZXJcIik7XG4gICAgICAgIH0oZSksIGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVNdXRhdGlvblF1ZXVlKGUpIHtcbiAgICAgICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJtdXRhdGlvblF1ZXVlc1wiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogXCJ1c2VySWRcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwibXV0YXRpb25zXCIsIHtcbiAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImJhdGNoSWRcIixcbiAgICAgICAgICAgICAgICBhdXRvSW5jcmVtZW50OiAhMFxuICAgICAgICAgICAgfSkuY3JlYXRlSW5kZXgoXCJ1c2VyTXV0YXRpb25zSW5kZXhcIiwgTSwge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogITBcbiAgICAgICAgICAgIH0pLCBlLmNyZWF0ZU9iamVjdFN0b3JlKFwiZG9jdW1lbnRNdXRhdGlvbnNcIik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBVcGdyYWRlIGZ1bmN0aW9uIHRvIG1pZ3JhdGUgdGhlICdtdXRhdGlvbnMnIHN0b3JlIGZyb20gVjEgdG8gVjMuIExvYWRzXG4gKiBhbmQgcmV3cml0ZXMgYWxsIGRhdGEuXG4gKi8gKGUpLCBfX1BSSVZBVEVfY3JlYXRlUXVlcnlDYWNoZShlKSwgZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZUxlZ2FjeVJlbW90ZURvY3VtZW50Q2FjaGUoZSkge1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50c1wiKTtcbiAgICAgICAgfShlKSk7XG4gICAgICAgIC8vIE1pZ3JhdGlvbiAyIHRvIHBvcHVsYXRlIHRoZSB0YXJnZXRHbG9iYWwgb2JqZWN0IG5vIGxvbmdlciBuZWVkZWQgc2luY2VcbiAgICAgICAgLy8gbWlncmF0aW9uIDMgdW5jb25kaXRpb25hbGx5IGNsZWFycyBpdC5cbiAgICAgICAgICAgICAgICBsZXQgcyA9IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIHJldHVybiBuIDwgMyAmJiByID49IDMgJiYgKFxuICAgICAgICAvLyBCcmFuZCBuZXcgY2xpZW50cyBkb24ndCBuZWVkIHRvIGRyb3AgYW5kIHJlY3JlYXRlLS1vbmx5IGNsaWVudHMgdGhhdFxuICAgICAgICAvLyBwb3RlbnRpYWxseSBoYXZlIGNvcnJ1cHQgZGF0YS5cbiAgICAgICAgMCAhPT0gbiAmJiAoIWZ1bmN0aW9uIF9fUFJJVkFURV9kcm9wUXVlcnlDYWNoZShlKSB7XG4gICAgICAgICAgICBlLmRlbGV0ZU9iamVjdFN0b3JlKFwidGFyZ2V0RG9jdW1lbnRzXCIpLCBlLmRlbGV0ZU9iamVjdFN0b3JlKFwidGFyZ2V0c1wiKSwgZS5kZWxldGVPYmplY3RTdG9yZShcInRhcmdldEdsb2JhbFwiKTtcbiAgICAgICAgfShlKSwgX19QUklWQVRFX2NyZWF0ZVF1ZXJ5Q2FjaGUoZSkpLCBzID0gcy5uZXh0KCgoKSA9PiBcbiAgICAgICAgLyoqXG4gKiBDcmVhdGVzIHRoZSB0YXJnZXQgZ2xvYmFsIHNpbmdsZXRvbiByb3cuXG4gKlxuICogQHBhcmFtIHR4biAtIFRoZSB2ZXJzaW9uIHVwZ3JhZGUgdHJhbnNhY3Rpb24gZm9yIGluZGV4ZWRkYlxuICovXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV93cml0ZUVtcHR5VGFyZ2V0R2xvYmFsRW50cnkoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IGUuc3RvcmUoXCJ0YXJnZXRHbG9iYWxcIiksIG4gPSB7XG4gICAgICAgICAgICAgICAgaGlnaGVzdFRhcmdldElkOiAwLFxuICAgICAgICAgICAgICAgIGhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlcjogMCxcbiAgICAgICAgICAgICAgICBsYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uOiBTbmFwc2hvdFZlcnNpb24ubWluKCkudG9UaW1lc3RhbXAoKSxcbiAgICAgICAgICAgICAgICB0YXJnZXRDb3VudDogMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiB0LnB1dChcInRhcmdldEdsb2JhbEtleVwiLCBuKTtcbiAgICAgICAgfShpKSkpKSwgbiA8IDQgJiYgciA+PSA0ICYmICgwICE9PSBuICYmIChcbiAgICAgICAgLy8gU2NoZW1hIHZlcnNpb24gMyB1c2VzIGF1dG8tZ2VuZXJhdGVkIGtleXMgdG8gZ2VuZXJhdGUgZ2xvYmFsbHkgdW5pcXVlXG4gICAgICAgIC8vIG11dGF0aW9uIGJhdGNoIElEcyAodGhpcyB3YXMgcHJldmlvdXNseSBlbnN1cmVkIGludGVybmFsbHkgYnkgdGhlXG4gICAgICAgIC8vIGNsaWVudCkuIFRvIG1pZ3JhdGUgdG8gdGhlIG5ldyBzY2hlbWEsIHdlIGhhdmUgdG8gcmVhZCBhbGwgbXV0YXRpb25zXG4gICAgICAgIC8vIGFuZCB3cml0ZSB0aGVtIGJhY2sgb3V0LiBXZSBwcmVzZXJ2ZSB0aGUgZXhpc3RpbmcgYmF0Y2ggSURzIHRvIGd1YXJhbnRlZVxuICAgICAgICAvLyBjb25zaXN0ZW5jeSB3aXRoIG90aGVyIG9iamVjdCBzdG9yZXMuIEFueSBmdXJ0aGVyIG11dGF0aW9uIGJhdGNoIElEcyB3aWxsXG4gICAgICAgIC8vIGJlIGF1dG8tZ2VuZXJhdGVkLlxuICAgICAgICBzID0gcy5uZXh0KCgoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfdXBncmFkZU11dGF0aW9uQmF0Y2hTY2hlbWFBbmRNaWdyYXRlRGF0YShlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gdC5zdG9yZShcIm11dGF0aW9uc1wiKS5VKCkubmV4dCgobiA9PiB7XG4gICAgICAgICAgICAgICAgZS5kZWxldGVPYmplY3RTdG9yZShcIm11dGF0aW9uc1wiKTtcbiAgICAgICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwibXV0YXRpb25zXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogXCJiYXRjaElkXCIsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9JbmNyZW1lbnQ6ICEwXG4gICAgICAgICAgICAgICAgfSkuY3JlYXRlSW5kZXgoXCJ1c2VyTXV0YXRpb25zSW5kZXhcIiwgTSwge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICEwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHQuc3RvcmUoXCJtdXRhdGlvbnNcIiksIGkgPSBuLm1hcCgoZSA9PiByLnB1dChlKSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfShlLCBpKSkpKSwgcyA9IHMubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgIWZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVDbGllbnRNZXRhZGF0YVN0b3JlKGUpIHtcbiAgICAgICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwiY2xpZW50TWV0YWRhdGFcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImNsaWVudElkXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0oZSk7XG4gICAgICAgIH0pKSksIG4gPCA1ICYmIHIgPj0gNSAmJiAocyA9IHMubmV4dCgoKCkgPT4gdGhpcy5uaShpKSkpKSwgbiA8IDYgJiYgciA+PSA2ICYmIChzID0gcy5uZXh0KCgoKSA9PiAoZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZURvY3VtZW50R2xvYmFsU3RvcmUoZSkge1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50R2xvYmFsXCIpO1xuICAgICAgICB9KGUpLCB0aGlzLnJpKGkpKSkpKSwgbiA8IDcgJiYgciA+PSA3ICYmIChzID0gcy5uZXh0KCgoKSA9PiB0aGlzLmlpKGkpKSkpLCBuIDwgOCAmJiByID49IDggJiYgKHMgPSBzLm5leHQoKCgpID0+IHRoaXMuc2koZSwgaSkpKSksIFxuICAgICAgICBuIDwgOSAmJiByID49IDkgJiYgKHMgPSBzLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIE11bHRpLVRhYiB1c2VkIHRvIG1hbmFnZSBpdHMgb3duIGNoYW5nZWxvZywgYnV0IHRoaXMgaGFzIGJlZW4gbW92ZWRcbiAgICAgICAgICAgIC8vIHRvIHRoZSBEYlJlbW90ZURvY3VtZW50IG9iamVjdCBzdG9yZSBpdHNlbGYuIFNpbmNlIHRoZSBwcmV2aW91cyBjaGFuZ2VcbiAgICAgICAgICAgIC8vIGxvZyBvbmx5IGNvbnRhaW5lZCB0cmFuc2llbnQgZGF0YSwgd2UgY2FuIGRyb3AgaXRzIG9iamVjdCBzdG9yZS5cbiAgICAgICAgICAgICFmdW5jdGlvbiBfX1BSSVZBVEVfZHJvcFJlbW90ZURvY3VtZW50Q2hhbmdlc1N0b3JlKGUpIHtcbiAgICAgICAgICAgICAgICBlLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoXCJyZW1vdGVEb2N1bWVudENoYW5nZXNcIikgJiYgZS5kZWxldGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50Q2hhbmdlc1wiKTtcbiAgICAgICAgICAgIH0oZSk7XG4gICAgICAgICAgICAvLyBOb3RlOiBTY2hlbWEgdmVyc2lvbiA5IHVzZWQgdG8gY3JlYXRlIGEgcmVhZCB0aW1lIGluZGV4IGZvciB0aGVcbiAgICAgICAgICAgIC8vIFJlbW90ZURvY3VtZW50Q2FjaGUuIFRoaXMgaXMgbm93IGRvbmUgd2l0aCBzY2hlbWEgdmVyc2lvbiAxMy5cbiAgICAgICAgICAgICAgICB9KSkpLCBuIDwgMTAgJiYgciA+PSAxMCAmJiAocyA9IHMubmV4dCgoKCkgPT4gdGhpcy5vaShpKSkpKSwgbiA8IDExICYmIHIgPj0gMTEgJiYgKHMgPSBzLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICFmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlQnVuZGxlc1N0b3JlKGUpIHtcbiAgICAgICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwiYnVuZGxlc1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IFwiYnVuZGxlSWRcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfShlKSwgZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZU5hbWVkUXVlcmllc1N0b3JlKGUpIHtcbiAgICAgICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwibmFtZWRRdWVyaWVzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogXCJuYW1lXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0oZSk7XG4gICAgICAgIH0pKSksIG4gPCAxMiAmJiByID49IDEyICYmIChzID0gcy5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZURvY3VtZW50T3ZlcmxheVN0b3JlKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS5jcmVhdGVPYmplY3RTdG9yZShcImRvY3VtZW50T3ZlcmxheXNcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBHXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdC5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIHosIHtcbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlOiAhMVxuICAgICAgICAgICAgICAgIH0pLCB0LmNyZWF0ZUluZGV4KFwiY29sbGVjdGlvbkdyb3VwT3ZlcmxheUluZGV4XCIsIGosIHtcbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlOiAhMVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfShlKTtcbiAgICAgICAgfSkpKSwgbiA8IDEzICYmIHIgPj0gMTMgJiYgKHMgPSBzLm5leHQoKCgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVSZW1vdGVEb2N1bWVudENhY2hlKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNyZWF0ZU9iamVjdFN0b3JlKFwicmVtb3RlRG9jdW1lbnRzVjE0XCIsIHtcbiAgICAgICAgICAgICAgICBrZXlQYXRoOiBPXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHQuY3JlYXRlSW5kZXgoXCJkb2N1bWVudEtleUluZGV4XCIsIE4pLCB0LmNyZWF0ZUluZGV4KFwiY29sbGVjdGlvbkdyb3VwSW5kZXhcIiwgTCk7XG4gICAgICAgIH0oZSkpKS5uZXh0KCgoKSA9PiB0aGlzLl9pKGUsIGkpKSkubmV4dCgoKCkgPT4gZS5kZWxldGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50c1wiKSkpKSwgXG4gICAgICAgIG4gPCAxNCAmJiByID49IDE0ICYmIChzID0gcy5uZXh0KCgoKSA9PiB0aGlzLmFpKGUsIGkpKSkpLCBuIDwgMTUgJiYgciA+PSAxNSAmJiAocyA9IHMubmV4dCgoKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZUZpZWxkSW5kZXgoZSkge1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcImluZGV4Q29uZmlndXJhdGlvblwiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogXCJpbmRleElkXCIsXG4gICAgICAgICAgICAgICAgYXV0b0luY3JlbWVudDogITBcbiAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwiY29sbGVjdGlvbkdyb3VwSW5kZXhcIiwgXCJjb2xsZWN0aW9uR3JvdXBcIiwge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShcImluZGV4U3RhdGVcIiwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IEtcbiAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwic2VxdWVuY2VOdW1iZXJJbmRleFwiLCAkLCB7XG4gICAgICAgICAgICAgICAgdW5pcXVlOiAhMVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwiaW5kZXhFbnRyaWVzXCIsIHtcbiAgICAgICAgICAgICAgICBrZXlQYXRoOiBVXG4gICAgICAgICAgICB9KS5jcmVhdGVJbmRleChcImRvY3VtZW50S2V5SW5kZXhcIiwgVywge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KGUpKSkpLCBuIDwgMTYgJiYgciA+PSAxNiAmJiAoXG4gICAgICAgIC8vIENsZWFyIHRoZSBvYmplY3Qgc3RvcmVzIHRvIHJlbW92ZSBwb3NzaWJseSBjb3JydXB0ZWQgaW5kZXggZW50cmllc1xuICAgICAgICBzID0gcy5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICB0Lm9iamVjdFN0b3JlKFwiaW5kZXhTdGF0ZVwiKS5jbGVhcigpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgdC5vYmplY3RTdG9yZShcImluZGV4RW50cmllc1wiKS5jbGVhcigpO1xuICAgICAgICB9KSkpLCBuIDwgMTcgJiYgciA+PSAxNyAmJiAocyA9IHMubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgIWZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVHbG9iYWxzU3RvcmUoZSkge1xuICAgICAgICAgICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJnbG9iYWxzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogXCJuYW1lXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0oZSk7XG4gICAgICAgIH0pKSksIHM7XG4gICAgfVxuICAgIHJpKGUpIHtcbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICByZXR1cm4gZS5zdG9yZShcInJlbW90ZURvY3VtZW50c1wiKS5KKCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgdCArPSBfX1BSSVZBVEVfZGJEb2N1bWVudFNpemUobik7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0ge1xuICAgICAgICAgICAgICAgIGJ5dGVTaXplOiB0XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIGUuc3RvcmUoXCJyZW1vdGVEb2N1bWVudEdsb2JhbFwiKS5wdXQoXCJyZW1vdGVEb2N1bWVudEdsb2JhbEtleVwiLCBuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBuaShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLnN0b3JlKFwibXV0YXRpb25RdWV1ZXNcIiksIG4gPSBlLnN0b3JlKFwibXV0YXRpb25zXCIpO1xuICAgICAgICByZXR1cm4gdC5VKCkubmV4dCgodCA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0LnVzZXJJZCwgLTEgXSwgWyB0LnVzZXJJZCwgdC5sYXN0QWNrbm93bGVkZ2VkQmF0Y2hJZCBdKTtcbiAgICAgICAgICAgIHJldHVybiBuLlUoXCJ1c2VyTXV0YXRpb25zSW5kZXhcIiwgcikubmV4dCgobiA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChuLCAobiA9PiB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQobi51c2VySWQgPT09IHQudXNlcklkKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2Zyb21EYk11dGF0aW9uQmF0Y2godGhpcy5zZXJpYWxpemVyLCBuKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVtb3ZlTXV0YXRpb25CYXRjaChlLCB0LnVzZXJJZCwgcikubmV4dCgoKCkgPT4ge30pKTtcbiAgICAgICAgICAgIH0pKSkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5zdXJlcyB0aGF0IGV2ZXJ5IGRvY3VtZW50IGluIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUgaGFzIGEgY29ycmVzcG9uZGluZyBzZW50aW5lbCByb3dcbiAgICAgKiB3aXRoIGEgc2VxdWVuY2UgbnVtYmVyLiBNaXNzaW5nIHJvd3MgYXJlIGdpdmVuIHRoZSBtb3N0IHJlY2VudGx5IHVzZWQgc2VxdWVuY2UgbnVtYmVyLlxuICAgICAqLyAgICBpaShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLnN0b3JlKFwidGFyZ2V0RG9jdW1lbnRzXCIpLCBuID0gZS5zdG9yZShcInJlbW90ZURvY3VtZW50c1wiKTtcbiAgICAgICAgcmV0dXJuIGUuc3RvcmUoXCJ0YXJnZXRHbG9iYWxcIikuZ2V0KFwidGFyZ2V0R2xvYmFsS2V5XCIpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIG4uSigoKG4sIGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gbmV3IFJlc291cmNlUGF0aChuKSwgbyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9zZW50aW5lbEtleShlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbIDAsIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgoZSkgXTtcbiAgICAgICAgICAgICAgICB9KHMpO1xuICAgICAgICAgICAgICAgIHIucHVzaCh0LmdldChvKS5uZXh0KChuID0+IG4gPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpIDogKG4gPT4gdC5wdXQoe1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZDogMCxcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChuKSxcbiAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXI6IGUuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyXG4gICAgICAgICAgICAgICAgfSkpKHMpKSkpO1xuICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHIpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2koZSwgdCkge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGluZGV4LlxuICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwiY29sbGVjdGlvblBhcmVudHNcIiwge1xuICAgICAgICAgICAga2V5UGF0aDogUVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbiA9IHQuc3RvcmUoXCJjb2xsZWN0aW9uUGFyZW50c1wiKSwgciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5Q29sbGVjdGlvblBhcmVudEluZGV4LCBhZGRFbnRyeSA9IGUgPT4ge1xuICAgICAgICAgICAgaWYgKHIuYWRkKGUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGUubGFzdFNlZ21lbnQoKSwgciA9IGUucG9wTGFzdCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLnB1dCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JZDogdCxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHIpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIEhlbHBlciB0byBhZGQgYW4gaW5kZXggZW50cnkgaWZmIHdlIGhhdmVuJ3QgYWxyZWFkeSB3cml0dGVuIGl0LlxuICAgICAgICAgICAgICAgIC8vIEluZGV4IGV4aXN0aW5nIHJlbW90ZSBkb2N1bWVudHMuXG4gICAgICAgIHJldHVybiB0LnN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpLkooe1xuICAgICAgICAgICAgSDogITBcbiAgICAgICAgfSwgKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gbmV3IFJlc291cmNlUGF0aChlKTtcbiAgICAgICAgICAgIHJldHVybiBhZGRFbnRyeShuLnBvcExhc3QoKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0LnN0b3JlKFwiZG9jdW1lbnRNdXRhdGlvbnNcIikuSih7XG4gICAgICAgICAgICBIOiAhMFxuICAgICAgICB9LCAoKFtlLCB0LCBuXSwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgodCk7XG4gICAgICAgICAgICByZXR1cm4gYWRkRW50cnkoaS5wb3BMYXN0KCkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgb2koZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5zdG9yZShcInRhcmdldHNcIik7XG4gICAgICAgIHJldHVybiB0LkooKChlLCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2Zyb21EYlRhcmdldChuKSwgaSA9IF9fUFJJVkFURV90b0RiVGFyZ2V0KHRoaXMuc2VyaWFsaXplciwgcik7XG4gICAgICAgICAgICByZXR1cm4gdC5wdXQoaSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgX2koZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdC5zdG9yZShcInJlbW90ZURvY3VtZW50c1wiKSwgciA9IFtdO1xuICAgICAgICByZXR1cm4gbi5KKCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHQuc3RvcmUoXCJyZW1vdGVEb2N1bWVudHNWMTRcIiksIHMgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZXh0cmFjdEtleShlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuZG9jdW1lbnQgPyBuZXcgRG9jdW1lbnRLZXkoUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZS5kb2N1bWVudC5uYW1lKS5wb3BGaXJzdCg1KSkgOiBlLm5vRG9jdW1lbnQgPyBEb2N1bWVudEtleS5mcm9tU2VnbWVudHMoZS5ub0RvY3VtZW50LnBhdGgpIDogZS51bmtub3duRG9jdW1lbnQgPyBEb2N1bWVudEtleS5mcm9tU2VnbWVudHMoZS51bmtub3duRG9jdW1lbnQucGF0aCkgOiBmYWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAobikucGF0aC50b0FycmF5KCksIG8gPSB7XG4gICAgICAgICAgICAgICAgcHJlZml4UGF0aDogcy5zbGljZSgwLCBzLmxlbmd0aCAtIDIpLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25Hcm91cDogc1tzLmxlbmd0aCAtIDJdLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50SWQ6IHNbcy5sZW5ndGggLSAxXSxcbiAgICAgICAgICAgICAgICByZWFkVGltZTogbi5yZWFkVGltZSB8fCBbIDAsIDAgXSxcbiAgICAgICAgICAgICAgICB1bmtub3duRG9jdW1lbnQ6IG4udW5rbm93bkRvY3VtZW50LFxuICAgICAgICAgICAgICAgIG5vRG9jdW1lbnQ6IG4ubm9Eb2N1bWVudCxcbiAgICAgICAgICAgICAgICBkb2N1bWVudDogbi5kb2N1bWVudCxcbiAgICAgICAgICAgICAgICBoYXNDb21taXR0ZWRNdXRhdGlvbnM6ICEhbi5oYXNDb21taXR0ZWRNdXRhdGlvbnNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByLnB1c2goaS5wdXQobykpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IocikpKTtcbiAgICB9XG4gICAgYWkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdC5zdG9yZShcIm11dGF0aW9uc1wiKSwgciA9IF9fUFJJVkFURV9uZXdJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlKHRoaXMuc2VyaWFsaXplciksIGkgPSBuZXcgX19QUklWQVRFX01lbW9yeVBlcnNpc3RlbmNlKF9fUFJJVkFURV9NZW1vcnlFYWdlckRlbGVnYXRlLlpyLCB0aGlzLnNlcmlhbGl6ZXIuY3QpO1xuICAgICAgICByZXR1cm4gbi5VKCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gbmV3IE1hcDtcbiAgICAgICAgICAgIHJldHVybiBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIHZhciB0O1xuICAgICAgICAgICAgICAgIGxldCByID0gbnVsbCAhPT0gKHQgPSBuLmdldChlLnVzZXJJZCkpICYmIHZvaWQgMCAhPT0gdCA/IHQgOiBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIGUpLmtleXMoKS5mb3JFYWNoKChlID0+IHIgPSByLmFkZChlKSkpLCBcbiAgICAgICAgICAgICAgICBuLnNldChlLnVzZXJJZCwgcik7XG4gICAgICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKG4sICgoZSwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgVXNlcihuKSwgbyA9IF9fUFJJVkFURV9JbmRleGVkRGJEb2N1bWVudE92ZXJsYXlDYWNoZS5sdCh0aGlzLnNlcmlhbGl6ZXIsIHMpLCBfID0gaS5nZXRJbmRleE1hbmFnZXIocyksIGEgPSBfX1BSSVZBVEVfSW5kZXhlZERiTXV0YXRpb25RdWV1ZS5sdChzLCB0aGlzLnNlcmlhbGl6ZXIsIF8sIGkucmVmZXJlbmNlRGVsZWdhdGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTG9jYWxEb2N1bWVudHNWaWV3KHIsIGEsIG8sIF8pLnJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzRm9yRG9jdW1lbnRLZXlzKG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiVHJhbnNhY3Rpb24odCwgX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLm9lKSwgZSkubmV4dCgpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlUXVlcnlDYWNoZShlKSB7XG4gICAgZS5jcmVhdGVPYmplY3RTdG9yZShcInRhcmdldERvY3VtZW50c1wiLCB7XG4gICAgICAgIGtleVBhdGg6IGtcbiAgICB9KS5jcmVhdGVJbmRleChcImRvY3VtZW50VGFyZ2V0c0luZGV4XCIsIHEsIHtcbiAgICAgICAgdW5pcXVlOiAhMFxuICAgIH0pO1xuICAgIC8vIE5PVEU6IFRoaXMgaXMgdW5pcXVlIG9ubHkgYmVjYXVzZSB0aGUgVGFyZ2V0SWQgaXMgdGhlIHN1ZmZpeC5cbiAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFwidGFyZ2V0c1wiLCB7XG4gICAgICAgIGtleVBhdGg6IFwidGFyZ2V0SWRcIlxuICAgIH0pLmNyZWF0ZUluZGV4KFwicXVlcnlUYXJnZXRzSW5kZXhcIiwgQiwge1xuICAgICAgICB1bmlxdWU6ICEwXG4gICAgfSksIGUuY3JlYXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXRHbG9iYWxcIik7XG59XG5cbmNvbnN0IFZlID0gXCJGYWlsZWQgdG8gb2J0YWluIGV4Y2x1c2l2ZSBhY2Nlc3MgdG8gdGhlIHBlcnNpc3RlbmNlIGxheWVyLiBUbyBhbGxvdyBzaGFyZWQgYWNjZXNzLCBtdWx0aS10YWIgc3luY2hyb25pemF0aW9uIGhhcyB0byBiZSBlbmFibGVkIGluIGFsbCB0YWJzLiBJZiB5b3UgYXJlIHVzaW5nIGBleHBlcmltZW50YWxGb3JjZU93bmluZ1RhYjp0cnVlYCwgbWFrZSBzdXJlIHRoYXQgb25seSBvbmUgdGFiIGhhcyBwZXJzaXN0ZW5jZSBlbmFibGVkIGF0IGFueSBnaXZlbiB0aW1lLlwiO1xuXG4vKipcbiAqIE9sZGVzdCBhY2NlcHRhYmxlIGFnZSBpbiBtaWxsaXNlY29uZHMgZm9yIGNsaWVudCBtZXRhZGF0YSBiZWZvcmUgdGhlIGNsaWVudFxuICogaXMgY29uc2lkZXJlZCBpbmFjdGl2ZSBhbmQgaXRzIGFzc29jaWF0ZWQgZGF0YSBpcyBnYXJiYWdlIGNvbGxlY3RlZC5cbiAqL1xuLyoqXG4gKiBBbiBJbmRleGVkREItYmFja2VkIGluc3RhbmNlIG9mIFBlcnNpc3RlbmNlLiBEYXRhIGlzIHN0b3JlZCBwZXJzaXN0ZW50bHlcbiAqIGFjcm9zcyBzZXNzaW9ucy5cbiAqXG4gKiBPbiBXZWIgb25seSwgdGhlIEZpcmVzdG9yZSBTREtzIHN1cHBvcnQgc2hhcmVkIGFjY2VzcyB0byBpdHMgcGVyc2lzdGVuY2VcbiAqIGxheWVyLiBUaGlzIGFsbG93cyBtdWx0aXBsZSBicm93c2VyIHRhYnMgdG8gcmVhZCBhbmQgd3JpdGUgdG8gSW5kZXhlZERiIGFuZFxuICogdG8gc3luY2hyb25pemUgc3RhdGUgZXZlbiB3aXRob3V0IG5ldHdvcmsgY29ubmVjdGl2aXR5LiBTaGFyZWQgYWNjZXNzIGlzXG4gKiBjdXJyZW50bHkgb3B0aW9uYWwgYW5kIG5vdCBlbmFibGVkIHVubGVzcyBhbGwgY2xpZW50cyBpbnZva2VcbiAqIGBlbmFibGVQZXJzaXN0ZW5jZSgpYCB3aXRoIGB7c3luY2hyb25pemVUYWJzOnRydWV9YC5cbiAqXG4gKiBJbiBtdWx0aS10YWIgbW9kZSwgaWYgbXVsdGlwbGUgY2xpZW50cyBhcmUgYWN0aXZlIGF0IHRoZSBzYW1lIHRpbWUsIHRoZSBTREtcbiAqIHdpbGwgZGVzaWduYXRlIG9uZSBjbGllbnQgYXMgdGhlIOKAnHByaW1hcnkgY2xpZW504oCdLiBBbiBlZmZvcnQgaXMgbWFkZSB0byBwaWNrXG4gKiBhIHZpc2libGUsIG5ldHdvcmstY29ubmVjdGVkIGFuZCBhY3RpdmUgY2xpZW50LCBhbmQgdGhpcyBjbGllbnQgaXNcbiAqIHJlc3BvbnNpYmxlIGZvciBsZXR0aW5nIG90aGVyIGNsaWVudHMga25vdyBhYm91dCBpdHMgcHJlc2VuY2UuIFRoZSBwcmltYXJ5XG4gKiBjbGllbnQgd3JpdGVzIGEgdW5pcXVlIGNsaWVudC1nZW5lcmF0ZWQgaWRlbnRpZmllciAodGhlIGNsaWVudCBJRCkgdG9cbiAqIEluZGV4ZWREYuKAmXMg4oCcb3duZXLigJ0gc3RvcmUgZXZlcnkgNCBzZWNvbmRzLiBJZiB0aGUgcHJpbWFyeSBjbGllbnQgZmFpbHMgdG9cbiAqIHVwZGF0ZSB0aGlzIGVudHJ5LCBhbm90aGVyIGNsaWVudCBjYW4gYWNxdWlyZSB0aGUgbGVhc2UgYW5kIHRha2Ugb3ZlciBhc1xuICogcHJpbWFyeS5cbiAqXG4gKiBTb21lIHBlcnNpc3RlbmNlIG9wZXJhdGlvbnMgaW4gdGhlIFNESyBhcmUgZGVzaWduYXRlZCBhcyBwcmltYXJ5LWNsaWVudCBvbmx5XG4gKiBvcGVyYXRpb25zLiBUaGlzIGluY2x1ZGVzIHRoZSBhY2tub3dsZWRnbWVudCBvZiBtdXRhdGlvbnMgYW5kIGFsbCB1cGRhdGVzIG9mXG4gKiByZW1vdGUgZG9jdW1lbnRzLiBUaGUgZWZmZWN0cyBvZiB0aGVzZSBvcGVyYXRpb25zIGFyZSB3cml0dGVuIHRvIHBlcnNpc3RlbmNlXG4gKiBhbmQgdGhlbiBicm9hZGNhc3QgdG8gb3RoZXIgdGFicyB2aWEgTG9jYWxTdG9yYWdlIChzZWVcbiAqIGBXZWJTdG9yYWdlU2hhcmVkQ2xpZW50U3RhdGVgKSwgd2hpY2ggdGhlbiByZWZyZXNoIHRoZWlyIHN0YXRlIGZyb21cbiAqIHBlcnNpc3RlbmNlLlxuICpcbiAqIFNpbWlsYXJseSwgdGhlIHByaW1hcnkgY2xpZW50IGxpc3RlbnMgdG8gbm90aWZpY2F0aW9ucyBzZW50IGJ5IHNlY29uZGFyeVxuICogY2xpZW50cyB0byBkaXNjb3ZlciBwZXJzaXN0ZW5jZSBjaGFuZ2VzIHdyaXR0ZW4gYnkgc2Vjb25kYXJ5IGNsaWVudHMsIHN1Y2ggYXNcbiAqIHRoZSBhZGRpdGlvbiBvZiBuZXcgbXV0YXRpb25zIGFuZCBxdWVyeSB0YXJnZXRzLlxuICpcbiAqIElmIG11bHRpLXRhYiBpcyBub3QgZW5hYmxlZCBhbmQgYW5vdGhlciB0YWIgYWxyZWFkeSBvYnRhaW5lZCB0aGUgcHJpbWFyeVxuICogbGVhc2UsIEluZGV4ZWREYlBlcnNpc3RlbmNlIGVudGVycyBhIGZhaWxlZCBzdGF0ZSBhbmQgYWxsIHN1YnNlcXVlbnRcbiAqIG9wZXJhdGlvbnMgd2lsbCBhdXRvbWF0aWNhbGx5IGZhaWwuXG4gKlxuICogQWRkaXRpb25hbGx5LCB0aGVyZSBpcyBhbiBvcHRpbWl6YXRpb24gc28gdGhhdCB3aGVuIGEgdGFiIGlzIGNsb3NlZCwgdGhlXG4gKiBwcmltYXJ5IGxlYXNlIGlzIHJlbGVhc2VkIGltbWVkaWF0ZWx5ICh0aGlzIGlzIGVzcGVjaWFsbHkgaW1wb3J0YW50IHRvIG1ha2VcbiAqIHN1cmUgdGhhdCBhIHJlZnJlc2hlZCB0YWIgaXMgYWJsZSB0byBpbW1lZGlhdGVseSByZS1hY3F1aXJlIHRoZSBwcmltYXJ5XG4gKiBsZWFzZSkuIFVuZm9ydHVuYXRlbHksIEluZGV4ZWREQiBjYW5ub3QgYmUgcmVsaWFibHkgdXNlZCBpbiB3aW5kb3cudW5sb2FkXG4gKiBzaW5jZSBpdCBpcyBhbiBhc3luY2hyb25vdXMgQVBJLiBTbyBpbiBhZGRpdGlvbiB0byBhdHRlbXB0aW5nIHRvIGdpdmUgdXAgdGhlXG4gKiBsZWFzZSwgdGhlIGxlYXNlaG9sZGVyIHdyaXRlcyBpdHMgY2xpZW50IElEIHRvIGEgXCJ6b21iaWVkQ2xpZW50XCIgZW50cnkgaW5cbiAqIExvY2FsU3RvcmFnZSB3aGljaCBhY3RzIGFzIGFuIGluZGljYXRvciB0aGF0IGFub3RoZXIgdGFiIHNob3VsZCBnbyBhaGVhZCBhbmRcbiAqIHRha2UgdGhlIHByaW1hcnkgbGVhc2UgaW1tZWRpYXRlbHkgcmVnYXJkbGVzcyBvZiB0aGUgY3VycmVudCBsZWFzZSB0aW1lc3RhbXAuXG4gKlxuICogVE9ETyhiLzExNDIyNjIzNCk6IFJlbW92ZSBgc3luY2hyb25pemVUYWJzYCBzZWN0aW9uIHdoZW4gbXVsdGktdGFiIGlzIG5vXG4gKiBsb25nZXIgb3B0aW9uYWwuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJQZXJzaXN0ZW5jZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0byBzeW5jaHJvbml6ZSB0aGUgaW4tbWVtb3J5IHN0YXRlIG9mIG11bHRpcGxlIHRhYnMgYW5kIHNoYXJlXG4gICAgICogYWNjZXNzIHRvIGxvY2FsIHBlcnNpc3RlbmNlLlxuICAgICAqL1xuICAgIGUsIHQsIG4sIHIsIGksIHMsIG8sIF8sIGEsIFxuICAgIC8qKlxuICAgICAqIElmIHNldCB0byB0cnVlLCBmb3JjZWZ1bGx5IG9idGFpbnMgZGF0YWJhc2UgYWNjZXNzLiBFeGlzdGluZyB0YWJzIHdpbGxcbiAgICAgKiBubyBsb25nZXIgYmUgYWJsZSB0byBhY2Nlc3MgSW5kZXhlZERCLlxuICAgICAqL1xuICAgIHUsIGMgPSAxNykge1xuICAgICAgICBpZiAodGhpcy5hbGxvd1RhYlN5bmNocm9uaXphdGlvbiA9IGUsIHRoaXMucGVyc2lzdGVuY2VLZXkgPSB0LCB0aGlzLmNsaWVudElkID0gbiwgXG4gICAgICAgIHRoaXMudWkgPSBpLCB0aGlzLndpbmRvdyA9IHMsIHRoaXMuZG9jdW1lbnQgPSBvLCB0aGlzLmNpID0gYSwgdGhpcy5saSA9IHUsIHRoaXMuaGkgPSBjLCBcbiAgICAgICAgdGhpcy5RciA9IG51bGwsIHRoaXMuS3IgPSAhMSwgdGhpcy5pc1ByaW1hcnkgPSAhMSwgdGhpcy5uZXR3b3JrRW5hYmxlZCA9ICEwLCBcbiAgICAgICAgLyoqIE91ciB3aW5kb3cudW5sb2FkIGhhbmRsZXIsIGlmIHJlZ2lzdGVyZWQuICovXG4gICAgICAgIHRoaXMuUGkgPSBudWxsLCB0aGlzLmluRm9yZWdyb3VuZCA9ICExLCBcbiAgICAgICAgLyoqIE91ciAndmlzaWJpbGl0eWNoYW5nZScgbGlzdGVuZXIgaWYgcmVnaXN0ZXJlZC4gKi9cbiAgICAgICAgdGhpcy5JaSA9IG51bGwsIFxuICAgICAgICAvKiogVGhlIGNsaWVudCBtZXRhZGF0YSByZWZyZXNoIHRhc2suICovXG4gICAgICAgIHRoaXMuVGkgPSBudWxsLCBcbiAgICAgICAgLyoqIFRoZSBsYXN0IHRpbWUgd2UgZ2FyYmFnZSBjb2xsZWN0ZWQgdGhlIGNsaWVudCBtZXRhZGF0YSBvYmplY3Qgc3RvcmUuICovXG4gICAgICAgIHRoaXMuRWkgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIFxuICAgICAgICAvKiogQSBsaXN0ZW5lciB0byBub3RpZnkgb24gcHJpbWFyeSBzdGF0ZSBjaGFuZ2VzLiAqL1xuICAgICAgICB0aGlzLmRpID0gZSA9PiBQcm9taXNlLnJlc29sdmUoKSwgIV9fUFJJVkFURV9JbmRleGVkRGJQZXJzaXN0ZW5jZS5EKCkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELlVOSU1QTEVNRU5URUQsIFwiVGhpcyBwbGF0Zm9ybSBpcyBlaXRoZXIgbWlzc2luZyBJbmRleGVkREIgb3IgaXMga25vd24gdG8gaGF2ZSBhbiBpbmNvbXBsZXRlIGltcGxlbWVudGF0aW9uLiBPZmZsaW5lIHBlcnNpc3RlbmNlIGhhcyBiZWVuIGRpc2FibGVkLlwiKTtcbiAgICAgICAgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiTHJ1RGVsZWdhdGVJbXBsKHRoaXMsIHIpLCB0aGlzLkFpID0gdCArIFwibWFpblwiLCBcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gbmV3IF9fUFJJVkFURV9Mb2NhbFNlcmlhbGl6ZXIoXyksIHRoaXMuUmkgPSBuZXcgX19QUklWQVRFX1NpbXBsZURiKHRoaXMuQWksIHRoaXMuaGksIG5ldyBfX1BSSVZBVEVfU2NoZW1hQ29udmVydGVyKHRoaXMuc2VyaWFsaXplcikpLCBcbiAgICAgICAgdGhpcy4kciA9IG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiR2xvYmFsc0NhY2hlLCB0aGlzLlVyID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJUYXJnZXRDYWNoZSh0aGlzLnJlZmVyZW5jZURlbGVnYXRlLCB0aGlzLnNlcmlhbGl6ZXIpLCBcbiAgICAgICAgdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlID0gX19QUklWQVRFX25ld0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUodGhpcy5zZXJpYWxpemVyKSwgXG4gICAgICAgIHRoaXMuR3IgPSBuZXcgX19QUklWQVRFX0luZGV4ZWREYkJ1bmRsZUNhY2hlLCB0aGlzLndpbmRvdyAmJiB0aGlzLndpbmRvdy5sb2NhbFN0b3JhZ2UgPyB0aGlzLlZpID0gdGhpcy53aW5kb3cubG9jYWxTdG9yYWdlIDogKHRoaXMuVmkgPSBudWxsLCBcbiAgICAgICAgITEgPT09IHUgJiYgX19QUklWQVRFX2xvZ0Vycm9yKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJMb2NhbFN0b3JhZ2UgaXMgdW5hdmFpbGFibGUuIEFzIGEgcmVzdWx0LCBwZXJzaXN0ZW5jZSBtYXkgbm90IHdvcmsgcmVsaWFibHkuIEluIHBhcnRpY3VsYXIgZW5hYmxlUGVyc2lzdGVuY2UoKSBjb3VsZCBmYWlsIGltbWVkaWF0ZWx5IGFmdGVyIHJlZnJlc2hpbmcgdGhlIHBhZ2UuXCIpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXR0ZW1wdCB0byBzdGFydCBJbmRleGVkRGIgcGVyc2lzdGVuY2UuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIHBlcnNpc3RlbmNlIHdhcyBlbmFibGVkLlxuICAgICAqLyAgICBzdGFydCgpIHtcbiAgICAgICAgLy8gTk9URTogVGhpcyBpcyBleHBlY3RlZCB0byBmYWlsIHNvbWV0aW1lcyAoaW4gdGhlIGNhc2Ugb2YgYW5vdGhlciB0YWJcbiAgICAgICAgLy8gYWxyZWFkeSBoYXZpbmcgdGhlIHBlcnNpc3RlbmNlIGxvY2spLCBzbyBpdCdzIHRoZSBmaXJzdCB0aGluZyB3ZSBzaG91bGRcbiAgICAgICAgLy8gZG8uXG4gICAgICAgIHJldHVybiB0aGlzLm1pKCkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUHJpbWFyeSAmJiAhdGhpcy5hbGxvd1RhYlN5bmNocm9uaXphdGlvbikgXG4gICAgICAgICAgICAvLyBGYWlsIGBzdGFydCgpYCBpZiBgc3luY2hyb25pemVUYWJzYCBpcyBkaXNhYmxlZCBhbmQgd2UgY2Fubm90XG4gICAgICAgICAgICAvLyBvYnRhaW4gdGhlIHByaW1hcnkgbGVhc2UuXG4gICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5GQUlMRURfUFJFQ09ORElUSU9OLCBWZSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maSgpLCB0aGlzLmdpKCksIHRoaXMucGkoKSwgdGhpcy5ydW5UcmFuc2FjdGlvbihcImdldEhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlclwiLCBcInJlYWRvbmx5XCIsIChlID0+IHRoaXMuVXIuZ2V0SGlnaGVzdFNlcXVlbmNlTnVtYmVyKGUpKSk7XG4gICAgICAgIH0pKS50aGVuKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuUXIgPSBuZXcgX19QUklWQVRFX0xpc3RlblNlcXVlbmNlKGUsIHRoaXMuY2kpO1xuICAgICAgICB9KSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5LciA9ICEwO1xuICAgICAgICB9KSkuY2F0Y2goKGUgPT4gKHRoaXMuUmkgJiYgdGhpcy5SaS5jbG9zZSgpLCBQcm9taXNlLnJlamVjdChlKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGEgbGlzdGVuZXIgdGhhdCBnZXRzIGNhbGxlZCB3aGVuIHRoZSBwcmltYXJ5IHN0YXRlIG9mIHRoZVxuICAgICAqIGluc3RhbmNlIGNoYW5nZXMuIFVwb24gcmVnaXN0ZXJpbmcsIHRoaXMgbGlzdGVuZXIgaXMgaW52b2tlZCBpbW1lZGlhdGVseVxuICAgICAqIHdpdGggdGhlIGN1cnJlbnQgcHJpbWFyeSBzdGF0ZS5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIHlpKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGkgPSBhc3luYyB0ID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0ZWQpIHJldHVybiBlKHQpO1xuICAgICAgICB9LCBlKHRoaXMuaXNQcmltYXJ5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGEgbGlzdGVuZXIgdGhhdCBnZXRzIGNhbGxlZCB3aGVuIHRoZSBkYXRhYmFzZSByZWNlaXZlcyBhXG4gICAgICogdmVyc2lvbiBjaGFuZ2UgZXZlbnQgaW5kaWNhdGluZyB0aGF0IGl0IGhhcyBkZWxldGVkLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoZSkge1xuICAgICAgICB0aGlzLlJpLkwoKGFzeW5jIHQgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW4gYXR0ZW1wdCBpcyBtYWRlIHRvIGRlbGV0ZSBJbmRleGVkREIuXG4gICAgICAgICAgICBudWxsID09PSB0Lm5ld1ZlcnNpb24gJiYgYXdhaXQgZSgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkanVzdHMgdGhlIGN1cnJlbnQgbmV0d29yayBzdGF0ZSBpbiB0aGUgY2xpZW50J3MgbWV0YWRhdGEsIHBvdGVudGlhbGx5XG4gICAgICogYWZmZWN0aW5nIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgc2V0TmV0d29ya0VuYWJsZWQoZSkge1xuICAgICAgICB0aGlzLm5ldHdvcmtFbmFibGVkICE9PSBlICYmICh0aGlzLm5ldHdvcmtFbmFibGVkID0gZSwgXG4gICAgICAgIC8vIFNjaGVkdWxlIGEgcHJpbWFyeSBsZWFzZSByZWZyZXNoIGZvciBpbW1lZGlhdGUgZXhlY3V0aW9uLiBUaGUgZXZlbnR1YWxcbiAgICAgICAgLy8gbGVhc2UgdXBkYXRlIHdpbGwgYmUgcHJvcGFnYXRlZCB2aWEgYHByaW1hcnlTdGF0ZUxpc3RlbmVyYC5cbiAgICAgICAgdGhpcy51aS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgJiYgYXdhaXQgdGhpcy5taSgpO1xuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBjbGllbnQgbWV0YWRhdGEgaW4gSW5kZXhlZERiIGFuZCBhdHRlbXB0cyB0byBlaXRoZXIgb2J0YWluIG9yXG4gICAgICogZXh0ZW5kIHRoZSBwcmltYXJ5IGxlYXNlIGZvciB0aGUgbG9jYWwgY2xpZW50LiBBc3luY2hyb25vdXNseSBub3RpZmllcyB0aGVcbiAgICAgKiBwcmltYXJ5IHN0YXRlIGxpc3RlbmVyIGlmIHRoZSBjbGllbnQgZWl0aGVyIG5ld2x5IG9idGFpbmVkIG9yIHJlbGVhc2VkIGl0c1xuICAgICAqIHByaW1hcnkgbGVhc2UuXG4gICAgICovICAgIG1pKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcInVwZGF0ZUNsaWVudE1ldGFkYXRhQW5kVHJ5QmVjb21lUHJpbWFyeVwiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKS5wdXQoe1xuICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgICB1cGRhdGVUaW1lTXM6IERhdGUubm93KCksXG4gICAgICAgICAgICBuZXR3b3JrRW5hYmxlZDogdGhpcy5uZXR3b3JrRW5hYmxlZCxcbiAgICAgICAgICAgIGluRm9yZWdyb3VuZDogdGhpcy5pbkZvcmVncm91bmRcbiAgICAgICAgfSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNQcmltYXJ5KSByZXR1cm4gdGhpcy53aShlKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBlIHx8ICh0aGlzLmlzUHJpbWFyeSA9ICExLCB0aGlzLnVpLmVucXVldWVSZXRyeWFibGUoKCgpID0+IHRoaXMuZGkoITEpKSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdGhpcy5TaShlKSkpLm5leHQoKHQgPT4gdGhpcy5pc1ByaW1hcnkgJiYgIXQgPyB0aGlzLmJpKGUpLm5leHQoKCgpID0+ICExKSkgOiAhIXQgJiYgdGhpcy5EaShlKS5uZXh0KCgoKSA9PiAhMCkpKSkpKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgXG4gICAgICAgICAgICAvLyBQcm9jZWVkIHdpdGggdGhlIGV4aXN0aW5nIHN0YXRlLiBBbnkgc3Vic2VxdWVudCBhY2Nlc3MgdG9cbiAgICAgICAgICAgIC8vIEluZGV4ZWREQiB3aWxsIHZlcmlmeSB0aGUgbGVhc2UuXG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJGYWlsZWQgdG8gZXh0ZW5kIG93bmVyIGxlYXNlOiBcIiwgZSksIFxuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pIHRocm93IGU7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJSZWxlYXNpbmcgb3duZXIgbGVhc2UgYWZ0ZXIgZXJyb3IgZHVyaW5nIGxlYXNlIHJlZnJlc2hcIiwgZSksIFxuICAgICAgICAgICAgLyogaXNQcmltYXJ5PSAqLyAhMTtcbiAgICAgICAgfSkpLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnkgIT09IGUgJiYgdGhpcy51aS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0aGlzLmRpKGUpKSksIHRoaXMuaXNQcmltYXJ5ID0gZTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB3aShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLmdldChcIm93bmVyXCIpLm5leHQoKGUgPT4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy52aShlKSkpKTtcbiAgICB9XG4gICAgQ2koZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NsaWVudE1ldGFkYXRhU3RvcmUoZSkuZGVsZXRlKHRoaXMuY2xpZW50SWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJZiB0aGUgZ2FyYmFnZSBjb2xsZWN0aW9uIHRocmVzaG9sZCBoYXMgcGFzc2VkLCBwcnVuZXMgdGhlXG4gICAgICogUmVtb3RlRG9jdW1lbnRDaGFuZ2VzIGFuZCB0aGUgQ2xpZW50TWV0YWRhdGEgc3RvcmUgYmFzZWQgb24gdGhlIGxhc3QgdXBkYXRlXG4gICAgICogdGltZSBvZiBhbGwgY2xpZW50cy5cbiAgICAgKi8gICAgYXN5bmMgRmkoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUHJpbWFyeSAmJiAhdGhpcy5NaSh0aGlzLkVpLCAxOGU1KSkge1xuICAgICAgICAgICAgdGhpcy5FaSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICBjb25zdCBlID0gYXdhaXQgdGhpcy5ydW5UcmFuc2FjdGlvbihcIm1heWJlR2FyYmFnZUNvbGxlY3RNdWx0aUNsaWVudFN0YXRlXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgXCJjbGllbnRNZXRhZGF0YVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5VKCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnhpKGUsIDE4ZTUpLCByID0gZS5maWx0ZXIoKGUgPT4gLTEgPT09IG4uaW5kZXhPZihlKSkpO1xuICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGUgbWV0YWRhdGEgZm9yIGNsaWVudHMgdGhhdCBhcmUgbm8gbG9uZ2VyIGNvbnNpZGVyZWQgYWN0aXZlLlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gociwgKGUgPT4gdC5kZWxldGUoZS5jbGllbnRJZCkpKS5uZXh0KCgoKSA9PiByKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpLmNhdGNoKCgoKSA9PiBbXSkpO1xuICAgICAgICAgICAgLy8gRGVsZXRlIHBvdGVudGlhbCBsZWZ0b3ZlciBlbnRyaWVzIHRoYXQgbWF5IGNvbnRpbnVlIHRvIG1hcmsgdGhlXG4gICAgICAgICAgICAvLyBpbmFjdGl2ZSBjbGllbnRzIGFzIHpvbWJpZWQgaW4gTG9jYWxTdG9yYWdlLlxuICAgICAgICAgICAgLy8gSWRlYWxseSB3ZSdkIGRlbGV0ZSB0aGUgSW5kZXhlZERiIGFuZCBMb2NhbFN0b3JhZ2Ugem9tYmllIGVudHJpZXMgZm9yXG4gICAgICAgICAgICAvLyB0aGUgY2xpZW50IGF0b21pY2FsbHksIGJ1dCB3ZSBjYW4ndC4gU28gd2Ugb3B0IHRvIGRlbGV0ZSB0aGUgSW5kZXhlZERiXG4gICAgICAgICAgICAvLyBlbnRyaWVzIGZpcnN0IHRvIGF2b2lkIHBvdGVudGlhbGx5IHJldml2aW5nIGEgem9tYmllZCBjbGllbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5WaSkgZm9yIChjb25zdCB0IG9mIGUpIHRoaXMuVmkucmVtb3ZlSXRlbSh0aGlzLk9pKHQuY2xpZW50SWQpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTY2hlZHVsZXMgYSByZWN1cnJpbmcgdGltZXIgdG8gdXBkYXRlIHRoZSBjbGllbnQgbWV0YWRhdGEgYW5kIHRvIGVpdGhlclxuICAgICAqIGV4dGVuZCBvciBhY3F1aXJlIHRoZSBwcmltYXJ5IGxlYXNlIGlmIHRoZSBjbGllbnQgaXMgZWxpZ2libGUuXG4gICAgICovICAgIHBpKCkge1xuICAgICAgICB0aGlzLlRpID0gdGhpcy51aS5lbnF1ZXVlQWZ0ZXJEZWxheShcImNsaWVudF9tZXRhZGF0YV9yZWZyZXNoXCIgLyogVGltZXJJZC5DbGllbnRNZXRhZGF0YVJlZnJlc2ggKi8gLCA0ZTMsICgoKSA9PiB0aGlzLm1pKCkudGhlbigoKCkgPT4gdGhpcy5GaSgpKSkudGhlbigoKCkgPT4gdGhpcy5waSgpKSkpKTtcbiAgICB9XG4gICAgLyoqIENoZWNrcyB3aGV0aGVyIGBjbGllbnRgIGlzIHRoZSBsb2NhbCBjbGllbnQuICovICAgIHZpKGUpIHtcbiAgICAgICAgcmV0dXJuICEhZSAmJiBlLm93bmVySWQgPT09IHRoaXMuY2xpZW50SWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV2YWx1YXRlIHRoZSBzdGF0ZSBvZiBhbGwgYWN0aXZlIGNsaWVudHMgYW5kIGRldGVybWluZSB3aGV0aGVyIHRoZSBsb2NhbFxuICAgICAqIGNsaWVudCBpcyBvciBjYW4gYWN0IGFzIHRoZSBob2xkZXIgb2YgdGhlIHByaW1hcnkgbGVhc2UuIFJldHVybnMgd2hldGhlclxuICAgICAqIHRoZSBjbGllbnQgaXMgZWxpZ2libGUgZm9yIHRoZSBsZWFzZSwgYnV0IGRvZXMgbm90IGFjdHVhbGx5IGFjcXVpcmUgaXQuXG4gICAgICogTWF5IHJldHVybiAnZmFsc2UnIGV2ZW4gaWYgdGhlcmUgaXMgbm8gYWN0aXZlIGxlYXNlaG9sZGVyIGFuZCBhbm90aGVyXG4gICAgICogKGZvcmVncm91bmQpIGNsaWVudCBzaG91bGQgYmVjb21lIGxlYXNlaG9sZGVyIGluc3RlYWQuXG4gICAgICovICAgIFNpKGUpIHtcbiAgICAgICAgaWYgKHRoaXMubGkpIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSghMCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLmdldChcIm93bmVyXCIpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgLy8gQSBjbGllbnQgaXMgZWxpZ2libGUgZm9yIHRoZSBwcmltYXJ5IGxlYXNlIGlmOlxuICAgICAgICAgICAgLy8gLSBpdHMgbmV0d29yayBpcyBlbmFibGVkIGFuZCB0aGUgY2xpZW50J3MgdGFiIGlzIGluIHRoZSBmb3JlZ3JvdW5kLlxuICAgICAgICAgICAgLy8gLSBpdHMgbmV0d29yayBpcyBlbmFibGVkIGFuZCBubyBvdGhlciBjbGllbnQncyB0YWIgaXMgaW4gdGhlXG4gICAgICAgICAgICAvLyAgIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIGV2ZXJ5IGNsaWVudHMgbmV0d29yayBpcyBkaXNhYmxlZCBhbmQgdGhlIGNsaWVudCdzIHRhYiBpcyBpbiB0aGVcbiAgICAgICAgICAgIC8vICAgZm9yZWdyb3VuZC5cbiAgICAgICAgICAgIC8vIC0gZXZlcnkgY2xpZW50cyBuZXR3b3JrIGlzIGRpc2FibGVkIGFuZCBubyBvdGhlciBjbGllbnQncyB0YWIgaXMgaW5cbiAgICAgICAgICAgIC8vICAgdGhlIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIHRoZSBgZm9yY2VPd25pbmdUYWJgIHNldHRpbmcgd2FzIHBhc3NlZCBpbi5cbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0ICYmIHRoaXMuTWkodC5sZWFzZVRpbWVzdGFtcE1zLCA1ZTMpICYmICF0aGlzLk5pKHQub3duZXJJZCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52aSh0KSAmJiB0aGlzLm5ldHdvcmtFbmFibGVkKSByZXR1cm4gITA7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnZpKHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdC5hbGxvd1RhYlN5bmNocm9uaXphdGlvbikgXG4gICAgICAgICAgICAgICAgICAgIC8vIEZhaWwgdGhlIGBjYW5BY3RBc1ByaW1hcnlgIGNoZWNrIGlmIHRoZSBjdXJyZW50IGxlYXNlaG9sZGVyIGhhc1xuICAgICAgICAgICAgICAgICAgICAvLyBub3Qgb3B0ZWQgaW50byBtdWx0aS10YWIgc3luY2hyb25pemF0aW9uLiBJZiB0aGlzIGhhcHBlbnMgYXRcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xpZW50IHN0YXJ0dXAsIHdlIHJlamVjdCB0aGUgUHJvbWlzZSByZXR1cm5lZCBieVxuICAgICAgICAgICAgICAgICAgICAvLyBgZW5hYmxlUGVyc2lzdGVuY2UoKWAgYW5kIHRoZSB1c2VyIGNhbiBjb250aW51ZSB0byB1c2UgRmlyZXN0b3JlXG4gICAgICAgICAgICAgICAgICAgIC8vIHdpdGggaW4tbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGZhaWxzIGR1cmluZyBhIGxlYXNlIHJlZnJlc2gsIHdlIHdpbGwgaW5zdGVhZCBibG9jayB0aGVcbiAgICAgICAgICAgICAgICAgICAgLy8gQXN5bmNRdWV1ZSBmcm9tIGV4ZWN1dGluZyBmdXJ0aGVyIG9wZXJhdGlvbnMuIE5vdGUgdGhhdCB0aGlzIGlzXG4gICAgICAgICAgICAgICAgICAgIC8vIGFjY2VwdGFibGUgc2luY2UgbWl4aW5nICYgbWF0Y2hpbmcgZGlmZmVyZW50IGBzeW5jaHJvbml6ZVRhYnNgXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldHRpbmdzIGlzIG5vdCBzdXBwb3J0ZWQuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8oYi8xMTQyMjYyMzQpOiBSZW1vdmUgdGhpcyBjaGVjayB3aGVuIGBzeW5jaHJvbml6ZVRhYnNgIGNhblxuICAgICAgICAgICAgICAgICAgICAvLyBubyBsb25nZXIgYmUgdHVybmVkIG9mZi5cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuRkFJTEVEX1BSRUNPTkRJVElPTiwgVmUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICEoIXRoaXMubmV0d29ya0VuYWJsZWQgfHwgIXRoaXMuaW5Gb3JlZ3JvdW5kKSB8fCBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKS5VKCkubmV4dCgoZSA9PiB2b2lkIDAgPT09IHRoaXMueGkoZSwgNWUzKS5maW5kKChlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGllbnRJZCAhPT0gZS5jbGllbnRJZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gIXRoaXMubmV0d29ya0VuYWJsZWQgJiYgZS5uZXR3b3JrRW5hYmxlZCwgbiA9ICF0aGlzLmluRm9yZWdyb3VuZCAmJiBlLmluRm9yZWdyb3VuZCwgciA9IHRoaXMubmV0d29ya0VuYWJsZWQgPT09IGUubmV0d29ya0VuYWJsZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0IHx8IG4gJiYgcikgcmV0dXJuICEwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgfSkpLm5leHQoKGUgPT4gKHRoaXMuaXNQcmltYXJ5ICE9PSBlICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIGBDbGllbnQgJHtlID8gXCJpc1wiIDogXCJpcyBub3RcIn0gZWxpZ2libGUgZm9yIGEgcHJpbWFyeSBsZWFzZS5gKSwgXG4gICAgICAgIGUpKSk7XG4gICAgfVxuICAgIGFzeW5jIHNodXRkb3duKCkge1xuICAgICAgICAvLyBUaGUgc2h1dGRvd24oKSBvcGVyYXRpb25zIGFyZSBpZGVtcG90ZW50IGFuZCBjYW4gYmUgY2FsbGVkIGV2ZW4gd2hlblxuICAgICAgICAvLyBzdGFydCgpIGFib3J0ZWQgKGUuZy4gYmVjYXVzZSBpdCBjb3VsZG4ndCBhY3F1aXJlIHRoZSBwZXJzaXN0ZW5jZSBsZWFzZSkuXG4gICAgICAgIHRoaXMuS3IgPSAhMSwgdGhpcy5MaSgpLCB0aGlzLlRpICYmICh0aGlzLlRpLmNhbmNlbCgpLCB0aGlzLlRpID0gbnVsbCksIHRoaXMuQmkoKSwgXG4gICAgICAgIHRoaXMua2koKSwgXG4gICAgICAgIC8vIFVzZSBgU2ltcGxlRGIucnVuVHJhbnNhY3Rpb25gIGRpcmVjdGx5IHRvIGF2b2lkIGZhaWxpbmcgaWYgYW5vdGhlciB0YWJcbiAgICAgICAgLy8gaGFzIG9idGFpbmVkIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAgICBhd2FpdCB0aGlzLlJpLnJ1blRyYW5zYWN0aW9uKFwic2h1dGRvd25cIiwgXCJyZWFkd3JpdGVcIiwgWyBcIm93bmVyXCIsIFwiY2xpZW50TWV0YWRhdGFcIiBdLCAoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbihlLCBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2Uub2UpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmkodCkubmV4dCgoKCkgPT4gdGhpcy5DaSh0KSkpO1xuICAgICAgICB9KSksIHRoaXMuUmkuY2xvc2UoKSwgXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgZW50cnkgbWFya2luZyB0aGUgY2xpZW50IGFzIHpvbWJpZWQgZnJvbSBMb2NhbFN0b3JhZ2Ugc2luY2VcbiAgICAgICAgLy8gd2Ugc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQgaXRzIG1ldGFkYXRhIGZyb20gSW5kZXhlZERiLlxuICAgICAgICB0aGlzLnFpKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgY2xpZW50cyB0aGF0IGFyZSBub3Qgem9tYmllZCBhbmQgaGF2ZSBhbiB1cGRhdGVUaW1lIHdpdGhpbiB0aGVcbiAgICAgKiBwcm92aWRlZCB0aHJlc2hvbGQuXG4gICAgICovICAgIHhpKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUuZmlsdGVyKChlID0+IHRoaXMuTWkoZS51cGRhdGVUaW1lTXMsIHQpICYmICF0aGlzLk5pKGUuY2xpZW50SWQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIElEcyBvZiB0aGUgY2xpZW50cyB0aGF0IGFyZSBjdXJyZW50bHkgYWN0aXZlLiBJZiBtdWx0aS10YWJcbiAgICAgKiBpcyBub3Qgc3VwcG9ydGVkLCByZXR1cm5zIGFuIGFycmF5IHRoYXQgb25seSBjb250YWlucyB0aGUgbG9jYWwgY2xpZW50J3NcbiAgICAgKiBJRC5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIFFpKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcImdldEFjdGl2ZUNsaWVudHNcIiwgXCJyZWFkb25seVwiLCAoZSA9PiBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKS5VKCkubmV4dCgoZSA9PiB0aGlzLnhpKGUsIDE4ZTUpLm1hcCgoZSA9PiBlLmNsaWVudElkKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgc3RhcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuS3I7XG4gICAgfVxuICAgIGdldEdsb2JhbHNDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHI7XG4gICAgfVxuICAgIGdldE11dGF0aW9uUXVldWUoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX0luZGV4ZWREYk11dGF0aW9uUXVldWUubHQoZSwgdGhpcy5zZXJpYWxpemVyLCB0LCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlKTtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0Q2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlVyO1xuICAgIH1cbiAgICBnZXRSZW1vdGVEb2N1bWVudENhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlO1xuICAgIH1cbiAgICBnZXRJbmRleE1hbmFnZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJJbmRleE1hbmFnZXIoZSwgdGhpcy5zZXJpYWxpemVyLmN0LmRhdGFiYXNlSWQpO1xuICAgIH1cbiAgICBnZXREb2N1bWVudE92ZXJsYXlDYWNoZShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfSW5kZXhlZERiRG9jdW1lbnRPdmVybGF5Q2FjaGUubHQodGhpcy5zZXJpYWxpemVyLCBlKTtcbiAgICB9XG4gICAgZ2V0QnVuZGxlQ2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkdyO1xuICAgIH1cbiAgICBydW5UcmFuc2FjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIFwiU3RhcnRpbmcgdHJhbnNhY3Rpb246XCIsIGUpO1xuICAgICAgICBjb25zdCByID0gXCJyZWFkb25seVwiID09PSB0ID8gXCJyZWFkb25seVwiIDogXCJyZWFkd3JpdGVcIiwgaSA9IFxuICAgICAgICAvKiogUmV0dXJucyB0aGUgb2JqZWN0IHN0b3JlcyBmb3IgdGhlIHByb3ZpZGVkIHNjaGVtYS4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2dldE9iamVjdFN0b3JlcyhlKSB7XG4gICAgICAgICAgICByZXR1cm4gMTcgPT09IGUgPyB0ZSA6IDE2ID09PSBlID8gZWUgOiAxNSA9PT0gZSA/IFggOiAxNCA9PT0gZSA/IFogOiAxMyA9PT0gZSA/IFkgOiAxMiA9PT0gZSA/IEogOiAxMSA9PT0gZSA/IEggOiB2b2lkIGZhaWwoKTtcbiAgICAgICAgfSh0aGlzLmhpKTtcbiAgICAgICAgbGV0IHM7XG4gICAgICAgIC8vIERvIGFsbCB0cmFuc2FjdGlvbnMgYXMgcmVhZHdyaXRlIGFnYWluc3QgYWxsIG9iamVjdCBzdG9yZXMsIHNpbmNlIHdlXG4gICAgICAgIC8vIGFyZSB0aGUgb25seSByZWFkZXIvd3JpdGVyLlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlJpLnJ1blRyYW5zYWN0aW9uKGUsIHIsIGksIChyID0+IChzID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbihyLCB0aGlzLlFyID8gdGhpcy5Rci5uZXh0KCkgOiBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2Uub2UpLCBcbiAgICAgICAgXCJyZWFkd3JpdGUtcHJpbWFyeVwiID09PSB0ID8gdGhpcy53aShzKS5uZXh0KChlID0+ICEhZSB8fCB0aGlzLlNpKHMpKSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBpZiAoIXQpIHRocm93IF9fUFJJVkFURV9sb2dFcnJvcihgRmFpbGVkIHRvIG9idGFpbiBwcmltYXJ5IGxlYXNlIGZvciBhY3Rpb24gJyR7ZX0nLmApLCBcbiAgICAgICAgICAgIHRoaXMuaXNQcmltYXJ5ID0gITEsIHRoaXMudWkuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gdGhpcy5kaSghMSkpKSwgbmV3IEZpcmVzdG9yZUVycm9yKEQuRkFJTEVEX1BSRUNPTkRJVElPTiwgQyk7XG4gICAgICAgICAgICByZXR1cm4gbihzKTtcbiAgICAgICAgfSkpLm5leHQoKGUgPT4gdGhpcy5EaShzKS5uZXh0KCgoKSA9PiBlKSkpKSA6IHRoaXMuS2kocykubmV4dCgoKCkgPT4gbihzKSkpKSkpLnRoZW4oKGUgPT4gKHMucmFpc2VPbkNvbW1pdHRlZEV2ZW50KCksIFxuICAgICAgICBlKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWZXJpZmllcyB0aGF0IHRoZSBjdXJyZW50IHRhYiBpcyB0aGUgcHJpbWFyeSBsZWFzZWhvbGRlciBvciBhbHRlcm5hdGl2ZWx5XG4gICAgICogdGhhdCB0aGUgbGVhc2Vob2xkZXIgaGFzIG9wdGVkIGludG8gbXVsdGktdGFiIHN5bmNocm9uaXphdGlvbi5cbiAgICAgKi9cbiAgICAvLyBUT0RPKGIvMTE0MjI2MjM0KTogUmVtb3ZlIHRoaXMgY2hlY2sgd2hlbiBgc3luY2hyb25pemVUYWJzYCBjYW4gbm8gbG9uZ2VyXG4gICAgLy8gYmUgdHVybmVkIG9mZi5cbiAgICBLaShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLmdldChcIm93bmVyXCIpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IGUgJiYgdGhpcy5NaShlLmxlYXNlVGltZXN0YW1wTXMsIDVlMykgJiYgIXRoaXMuTmkoZS5vd25lcklkKSAmJiAhdGhpcy52aShlKSAmJiAhKHRoaXMubGkgfHwgdGhpcy5hbGxvd1RhYlN5bmNocm9uaXphdGlvbiAmJiBlLmFsbG93VGFiU3luY2hyb25pemF0aW9uKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuRkFJTEVEX1BSRUNPTkRJVElPTiwgVmUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9idGFpbnMgb3IgZXh0ZW5kcyB0aGUgbmV3IHByaW1hcnkgbGVhc2UgZm9yIHRoZSBsb2NhbCBjbGllbnQuIFRoaXNcbiAgICAgKiBtZXRob2QgZG9lcyBub3QgdmVyaWZ5IHRoYXQgdGhlIGNsaWVudCBpcyBlbGlnaWJsZSBmb3IgdGhpcyBsZWFzZS5cbiAgICAgKi8gICAgRGkoZSkge1xuICAgICAgICBjb25zdCB0ID0ge1xuICAgICAgICAgICAgb3duZXJJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgICAgICAgIGFsbG93VGFiU3luY2hyb25pemF0aW9uOiB0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uLFxuICAgICAgICAgICAgbGVhc2VUaW1lc3RhbXBNczogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1hcnlDbGllbnRTdG9yZShlKS5wdXQoXCJvd25lclwiLCB0KTtcbiAgICB9XG4gICAgc3RhdGljIEQoKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfU2ltcGxlRGIuRCgpO1xuICAgIH1cbiAgICAvKiogQ2hlY2tzIHRoZSBwcmltYXJ5IGxlYXNlIGFuZCByZW1vdmVzIGl0IGlmIHdlIGFyZSB0aGUgY3VycmVudCBwcmltYXJ5LiAqLyAgICBiaShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpO1xuICAgICAgICByZXR1cm4gdC5nZXQoXCJvd25lclwiKS5uZXh0KChlID0+IHRoaXMudmkoZSkgPyAoX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJSZWxlYXNpbmcgcHJpbWFyeSBsZWFzZS5cIiksIFxuICAgICAgICB0LmRlbGV0ZShcIm93bmVyXCIpKSA6IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCkpKTtcbiAgICB9XG4gICAgLyoqIFZlcmlmaWVzIHRoYXQgYHVwZGF0ZVRpbWVNc2AgaXMgd2l0aGluIGBtYXhBZ2VNc2AuICovICAgIE1pKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IERhdGUubm93KCk7XG4gICAgICAgIHJldHVybiAhKGUgPCBuIC0gdCkgJiYgKCEoZSA+IG4pIHx8IChfX1BSSVZBVEVfbG9nRXJyb3IoYERldGVjdGVkIGFuIHVwZGF0ZSB0aW1lIHRoYXQgaXMgaW4gdGhlIGZ1dHVyZTogJHtlfSA+ICR7bn1gKSwgXG4gICAgICAgICExKSk7XG4gICAgfVxuICAgIGZpKCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLmRvY3VtZW50ICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdGhpcy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICYmICh0aGlzLklpID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51aS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiAodGhpcy5pbkZvcmVncm91bmQgPSBcInZpc2libGVcIiA9PT0gdGhpcy5kb2N1bWVudC52aXNpYmlsaXR5U3RhdGUsIFxuICAgICAgICAgICAgdGhpcy5taSgpKSkpO1xuICAgICAgICB9LCB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMuSWkpLCB0aGlzLmluRm9yZWdyb3VuZCA9IFwidmlzaWJsZVwiID09PSB0aGlzLmRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSk7XG4gICAgfVxuICAgIEJpKCkge1xuICAgICAgICB0aGlzLklpICYmICh0aGlzLmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMuSWkpLCB0aGlzLklpID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEF0dGFjaGVzIGEgd2luZG93LnVubG9hZCBoYW5kbGVyIHRoYXQgd2lsbCBzeW5jaHJvbm91c2x5IHdyaXRlIG91clxuICAgICAqIGNsaWVudElkIHRvIGEgXCJ6b21iaWUgY2xpZW50IGlkXCIgbG9jYXRpb24gaW4gTG9jYWxTdG9yYWdlLiBUaGlzIGNhbiBiZSB1c2VkXG4gICAgICogYnkgdGFicyB0cnlpbmcgdG8gYWNxdWlyZSB0aGUgcHJpbWFyeSBsZWFzZSB0byBkZXRlcm1pbmUgdGhhdCB0aGUgbGVhc2VcbiAgICAgKiBpcyBubyBsb25nZXIgdmFsaWQgZXZlbiBpZiB0aGUgdGltZXN0YW1wIGlzIHJlY2VudC4gVGhpcyBpcyBwYXJ0aWN1bGFybHlcbiAgICAgKiBpbXBvcnRhbnQgZm9yIHRoZSByZWZyZXNoIGNhc2UgKHNvIHRoZSB0YWIgY29ycmVjdGx5IHJlLWFjcXVpcmVzIHRoZVxuICAgICAqIHByaW1hcnkgbGVhc2UpLiBMb2NhbFN0b3JhZ2UgaXMgdXNlZCBmb3IgdGhpcyByYXRoZXIgdGhhbiBJbmRleGVkRGIgYmVjYXVzZVxuICAgICAqIGl0IGlzIGEgc3luY2hyb25vdXMgQVBJIGFuZCBzbyBjYW4gYmUgdXNlZCByZWxpYWJseSBmcm9tICBhbiB1bmxvYWRcbiAgICAgKiBoYW5kbGVyLlxuICAgICAqLyAgICBnaSgpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgKG51bGwgPT09IChlID0gdGhpcy53aW5kb3cpIHx8IHZvaWQgMCA9PT0gZSA/IHZvaWQgMCA6IGUuYWRkRXZlbnRMaXN0ZW5lcikgJiYgKHRoaXMuUGkgPSAoKSA9PiB7XG4gICAgICAgICAgICAvLyBOb3RlOiBJbiB0aGVvcnksIHRoaXMgc2hvdWxkIGJlIHNjaGVkdWxlZCBvbiB0aGUgQXN5bmNRdWV1ZSBzaW5jZSBpdFxuICAgICAgICAgICAgLy8gYWNjZXNzZXMgaW50ZXJuYWwgc3RhdGUuIFdlIGV4ZWN1dGUgdGhpcyBjb2RlIGRpcmVjdGx5IGR1cmluZyBzaHV0ZG93blxuICAgICAgICAgICAgLy8gdG8gbWFrZSBzdXJlIGl0IGdldHMgYSBjaGFuY2UgdG8gcnVuLlxuICAgICAgICAgICAgdGhpcy5MaSgpO1xuICAgICAgICAgICAgY29uc3QgZSA9IC8oPzpWZXJzaW9ufE1vYmlsZSlcXC8xWzQ1Nl0vO1xuICAgICAgICAgICAgaXNTYWZhcmkoKSAmJiAobmF2aWdhdG9yLmFwcFZlcnNpb24ubWF0Y2goZSkgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaChlKSkgJiYgXG4gICAgICAgICAgICAvLyBPbiBTYWZhcmkgMTQsIDE1LCBhbmQgMTYsIHdlIGRvIG5vdCBydW4gYW55IGNsZWFudXAgYWN0aW9ucyBhcyBpdCBtaWdodFxuICAgICAgICAgICAgLy8gdHJpZ2dlciBhIGJ1ZyB0aGF0IHByZXZlbnRzIFNhZmFyaSBmcm9tIHJlLW9wZW5pbmcgSW5kZXhlZERCIGR1cmluZ1xuICAgICAgICAgICAgLy8gdGhlIG5leHQgcGFnZSBsb2FkLlxuICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0yMjY1NDdcbiAgICAgICAgICAgIHRoaXMudWkuZW50ZXJSZXN0cmljdGVkTW9kZSgvKiBwdXJnZUV4aXN0aW5nVGFza3M9ICovICEwKSwgdGhpcy51aS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiB0aGlzLnNodXRkb3duKCkpKTtcbiAgICAgICAgfSwgdGhpcy53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBhZ2VoaWRlXCIsIHRoaXMuUGkpKTtcbiAgICB9XG4gICAga2koKSB7XG4gICAgICAgIHRoaXMuUGkgJiYgKHRoaXMud2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwYWdlaGlkZVwiLCB0aGlzLlBpKSwgdGhpcy5QaSA9IG51bGwpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgYSBjbGllbnQgaXMgXCJ6b21iaWVkXCIgYmFzZWQgb24gaXRzIExvY2FsU3RvcmFnZSBlbnRyeS5cbiAgICAgKiBDbGllbnRzIGJlY29tZSB6b21iaWVkIHdoZW4gdGhlaXIgdGFiIGNsb3NlcyB3aXRob3V0IHJ1bm5pbmcgYWxsIG9mIHRoZVxuICAgICAqIGNsZWFudXAgbG9naWMgaW4gYHNodXRkb3duKClgLlxuICAgICAqLyAgICBOaShlKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbiA9IG51bGwgIT09IChudWxsID09PSAodCA9IHRoaXMuVmkpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuZ2V0SXRlbSh0aGlzLk9pKGUpKSk7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ0RlYnVnKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgYENsaWVudCAnJHtlfScgJHtuID8gXCJpc1wiIDogXCJpcyBub3RcIn0gem9tYmllZCBpbiBMb2NhbFN0b3JhZ2VgKSwgXG4gICAgICAgICAgICBuO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBHcmFjZWZ1bGx5IGhhbmRsZSBpZiBMb2NhbFN0b3JhZ2UgaXNuJ3Qgd29ya2luZy5cbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nRXJyb3IoXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBcIkZhaWxlZCB0byBnZXQgem9tYmllZCBjbGllbnQgaWQuXCIsIGUpLCBcbiAgICAgICAgICAgICExO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlY29yZCBjbGllbnQgYXMgem9tYmllZCAoYSBjbGllbnQgdGhhdCBoYWQgaXRzIHRhYiBjbG9zZWQpLiBab21iaWVkXG4gICAgICogY2xpZW50cyBhcmUgaWdub3JlZCBkdXJpbmcgcHJpbWFyeSB0YWIgc2VsZWN0aW9uLlxuICAgICAqLyAgICBMaSgpIHtcbiAgICAgICAgaWYgKHRoaXMuVmkpIHRyeSB7XG4gICAgICAgICAgICB0aGlzLlZpLnNldEl0ZW0odGhpcy5PaSh0aGlzLmNsaWVudElkKSwgU3RyaW5nKERhdGUubm93KCkpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gR3JhY2VmdWxseSBoYW5kbGUgaWYgTG9jYWxTdG9yYWdlIGlzbid0IGF2YWlsYWJsZSAvIHdvcmtpbmcuXG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRXJyb3IoXCJGYWlsZWQgdG8gc2V0IHpvbWJpZSBjbGllbnQgaWQuXCIsIGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBSZW1vdmVzIHRoZSB6b21iaWVkIGNsaWVudCBlbnRyeSBpZiBpdCBleGlzdHMuICovICAgIHFpKCkge1xuICAgICAgICBpZiAodGhpcy5WaSkgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuVmkucmVtb3ZlSXRlbSh0aGlzLk9pKHRoaXMuY2xpZW50SWQpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gSWdub3JlXG4gICAgICAgIH1cbiAgICB9XG4gICAgT2koZSkge1xuICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV96b21iaWVfJHt0aGlzLnBlcnNpc3RlbmNlS2V5fV8ke2V9YDtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBwcmltYXJ5IGNsaWVudCBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ByaW1hcnlDbGllbnRTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcIm93bmVyXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgY2xpZW50IG1ldGFkYXRhIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBcImNsaWVudE1ldGFkYXRhXCIpO1xufVxuXG4vKipcbiAqIEdlbmVyYXRlcyBhIHN0cmluZyB1c2VkIGFzIGEgcHJlZml4IHdoZW4gc3RvcmluZyBkYXRhIGluIEluZGV4ZWREQiBhbmRcbiAqIExvY2FsU3RvcmFnZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhlZERiU3RvcmFnZVByZWZpeChlLCB0KSB7XG4gICAgLy8gVXNlIHR3byBkaWZmZXJlbnQgcHJlZml4IGZvcm1hdHM6XG4gICAgLy8gICAqIGZpcmVzdG9yZSAvIHBlcnNpc3RlbmNlS2V5IC8gcHJvamVjdElEIC4gZGF0YWJhc2VJRCAvIC4uLlxuICAgIC8vICAgKiBmaXJlc3RvcmUgLyBwZXJzaXN0ZW5jZUtleSAvIHByb2plY3RJRCAvIC4uLlxuICAgIC8vIHByb2plY3RJRHMgYXJlIEROUy1jb21wYXRpYmxlIG5hbWVzIGFuZCBjYW5ub3QgY29udGFpbiBkb3RzXG4gICAgLy8gc28gdGhlcmUncyBubyBkYW5nZXIgb2YgY29sbGlzaW9ucy5cbiAgICBsZXQgbiA9IGUucHJvamVjdElkO1xuICAgIHJldHVybiBlLmlzRGVmYXVsdERhdGFiYXNlIHx8IChuICs9IFwiLlwiICsgZS5kYXRhYmFzZSksIFwiZmlyZXN0b3JlL1wiICsgdCArIFwiL1wiICsgbiArIFwiL1wiO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHNldCBvZiBjaGFuZ2VzIHRvIHdoYXQgZG9jdW1lbnRzIGFyZSBjdXJyZW50bHkgaW4gdmlldyBhbmQgb3V0IG9mIHZpZXcgZm9yXG4gKiBhIGdpdmVuIHF1ZXJ5LiBUaGVzZSBjaGFuZ2VzIGFyZSBzZW50IHRvIHRoZSBMb2NhbFN0b3JlIGJ5IHRoZSBWaWV3ICh2aWFcbiAqIHRoZSBTeW5jRW5naW5lKSBhbmQgYXJlIHVzZWQgdG8gcGluIC8gdW5waW4gZG9jdW1lbnRzIGFzIGFwcHJvcHJpYXRlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTG9jYWxWaWV3Q2hhbmdlcyB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLnRhcmdldElkID0gZSwgdGhpcy5mcm9tQ2FjaGUgPSB0LCB0aGlzLiRpID0gbiwgdGhpcy5VaSA9IHI7XG4gICAgfVxuICAgIHN0YXRpYyBXaShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIHIgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQuZG9jQ2hhbmdlcykgc3dpdGNoIChlLnR5cGUpIHtcbiAgICAgICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICBuID0gbi5hZGQoZS5kb2Mua2V5KTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgICAgICByID0gci5hZGQoZS5kb2Mua2V5KTtcbiAvLyBkbyBub3RoaW5nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9Mb2NhbFZpZXdDaGFuZ2VzKGUsIHQuZnJvbUNhY2hlLCBuLCByKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgdHJhY2tlciB0byBrZWVwIGEgcmVjb3JkIG9mIGltcG9ydGFudCBkZXRhaWxzIGR1cmluZyBkYXRhYmFzZSBsb2NhbCBxdWVyeVxuICogZXhlY3V0aW9uLlxuICovIGNsYXNzIFF1ZXJ5Q29udGV4dCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb3VudHMgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgcGFzc2VkIHRocm91Z2ggZHVyaW5nIGxvY2FsIHF1ZXJ5IGV4ZWN1dGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX2RvY3VtZW50UmVhZENvdW50ID0gMDtcbiAgICB9XG4gICAgZ2V0IGRvY3VtZW50UmVhZENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnRSZWFkQ291bnQ7XG4gICAgfVxuICAgIGluY3JlbWVudERvY3VtZW50UmVhZENvdW50KGUpIHtcbiAgICAgICAgdGhpcy5fZG9jdW1lbnRSZWFkQ291bnQgKz0gZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBGaXJlc3RvcmUgcXVlcnkgZW5naW5lLlxuICpcbiAqIEZpcmVzdG9yZSBxdWVyaWVzIGNhbiBiZSBleGVjdXRlZCBpbiB0aHJlZSBtb2Rlcy4gVGhlIFF1ZXJ5IEVuZ2luZSBkZXRlcm1pbmVzXG4gKiB3aGF0IG1vZGUgdG8gdXNlIGJhc2VkIG9uIHdoYXQgZGF0YSBpcyBwZXJzaXN0ZWQuIFRoZSBtb2RlIG9ubHkgZGV0ZXJtaW5lc1xuICogdGhlIHJ1bnRpbWUgY29tcGxleGl0eSBvZiB0aGUgcXVlcnkgLSB0aGUgcmVzdWx0IHNldCBpcyBlcXVpdmFsZW50IGFjcm9zcyBhbGxcbiAqIGltcGxlbWVudGF0aW9ucy5cbiAqXG4gKiBUaGUgUXVlcnkgZW5naW5lIHdpbGwgdXNlIGluZGV4ZWQtYmFzZWQgZXhlY3V0aW9uIGlmIGEgdXNlciBoYXMgY29uZmlndXJlZFxuICogYW55IGluZGV4IHRoYXQgY2FuIGJlIHVzZWQgdG8gZXhlY3V0ZSBxdWVyeSAodmlhIGBzZXRJbmRleENvbmZpZ3VyYXRpb24oKWApLlxuICogT3RoZXJ3aXNlLCB0aGUgZW5naW5lIHdpbGwgdHJ5IHRvIG9wdGltaXplIHRoZSBxdWVyeSBieSByZS11c2luZyBhIHByZXZpb3VzbHlcbiAqIHBlcnNpc3RlZCBxdWVyeSByZXN1bHQuIElmIHRoYXQgaXMgbm90IHBvc3NpYmxlLCB0aGUgcXVlcnkgd2lsbCBiZSBleGVjdXRlZFxuICogdmlhIGEgZnVsbCBjb2xsZWN0aW9uIHNjYW4uXG4gKlxuICogSW5kZXgtYmFzZWQgZXhlY3V0aW9uIGlzIHRoZSBkZWZhdWx0IHdoZW4gYXZhaWxhYmxlLiBUaGUgcXVlcnkgZW5naW5lXG4gKiBzdXBwb3J0cyBwYXJ0aWFsIGluZGV4ZWQgZXhlY3V0aW9uIGFuZCBtZXJnZXMgdGhlIHJlc3VsdCBmcm9tIHRoZSBpbmRleFxuICogbG9va3VwIHdpdGggZG9jdW1lbnRzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gaW5kZXhlZC4gVGhlIGluZGV4IGV2YWx1YXRpb25cbiAqIG1hdGNoZXMgdGhlIGJhY2tlbmQncyBmb3JtYXQgYW5kIGFzIHN1Y2gsIHRoZSBTREsgY2FuIHVzZSBpbmRleGluZyBmb3IgYWxsXG4gKiBxdWVyaWVzIHRoYXQgdGhlIGJhY2tlbmQgc3VwcG9ydHMuXG4gKlxuICogSWYgbm8gaW5kZXggZXhpc3RzLCB0aGUgcXVlcnkgZW5naW5lIHRyaWVzIHRvIHRha2UgYWR2YW50YWdlIG9mIHRoZSB0YXJnZXRcbiAqIGRvY3VtZW50IG1hcHBpbmcgaW4gdGhlIFRhcmdldENhY2hlLiBUaGVzZSBtYXBwaW5ncyBleGlzdHMgZm9yIGFsbCBxdWVyaWVzXG4gKiB0aGF0IGhhdmUgYmVlbiBzeW5jZWQgd2l0aCB0aGUgYmFja2VuZCBhdCBsZWFzdCBvbmNlIGFuZCBhbGxvdyB0aGUgcXVlcnlcbiAqIGVuZ2luZSB0byBvbmx5IHJlYWQgZG9jdW1lbnRzIHRoYXQgcHJldmlvdXNseSBtYXRjaGVkIGEgcXVlcnkgcGx1cyBhbnlcbiAqIGRvY3VtZW50cyB0aGF0IHdlcmUgZWRpdGVkIGFmdGVyIHRoZSBxdWVyeSB3YXMgbGFzdCBsaXN0ZW5lZCB0by5cbiAqXG4gKiBUaGVyZSBhcmUgc29tZSBjYXNlcyB3aGVuIHRoaXMgb3B0aW1pemF0aW9uIGlzIG5vdCBndWFyYW50ZWVkIHRvIHByb2R1Y2VcbiAqIHRoZSBzYW1lIHJlc3VsdHMgYXMgZnVsbCBjb2xsZWN0aW9uIHNjYW5zLiBJbiB0aGVzZSBjYXNlcywgcXVlcnlcbiAqIHByb2Nlc3NpbmcgZmFsbHMgYmFjayB0byBmdWxsIHNjYW5zLiBUaGVzZSBjYXNlcyBhcmU6XG4gKlxuICogLSBMaW1pdCBxdWVyaWVzIHdoZXJlIGEgZG9jdW1lbnQgdGhhdCBtYXRjaGVkIHRoZSBxdWVyeSBwcmV2aW91c2x5IG5vIGxvbmdlclxuICogICBtYXRjaGVzIHRoZSBxdWVyeS5cbiAqXG4gKiAtIExpbWl0IHF1ZXJpZXMgd2hlcmUgYSBkb2N1bWVudCBlZGl0IG1heSBjYXVzZSB0aGUgZG9jdW1lbnQgdG8gc29ydCBiZWxvd1xuICogICBhbm90aGVyIGRvY3VtZW50IHRoYXQgaXMgaW4gdGhlIGxvY2FsIGNhY2hlLlxuICpcbiAqIC0gUXVlcmllcyB0aGF0IGhhdmUgbmV2ZXIgYmVlbiBDVVJSRU5UIG9yIGZyZWUgb2YgbGltYm8gZG9jdW1lbnRzLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfUXVlcnlFbmdpbmUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLkdpID0gITEsIHRoaXMuemkgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTREsgb25seSBkZWNpZGVzIHdoZXRoZXIgaXQgc2hvdWxkIGNyZWF0ZSBpbmRleCB3aGVuIGNvbGxlY3Rpb24gc2l6ZSBpc1xuICAgICAgICAgKiBsYXJnZXIgdGhhbiB0aGlzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5qaSA9IDEwMCwgdGhpcy5IaSA9IFxuICAgICAgICAvKipcbiAqIFRoaXMgY29zdCByZXByZXNlbnRzIHRoZSBldmFsdWF0aW9uIHJlc3VsdCBvZlxuICogKChbaW5kZXgsIGRvY0tleV0gKyBbZG9jS2V5LCBkb2NDb250ZW50XSkgcGVyIGRvY3VtZW50IGluIHRoZSByZXN1bHQgc2V0KVxuICogLyAoW2RvY0tleSwgZG9jQ29udGVudF0gcGVyIGRvY3VtZW50cyBpbiBmdWxsIGNvbGxlY3Rpb24gc2NhbikgY29taW5nIGZyb21cbiAqIGV4cGVyaW1lbnQgW2VudGVyIFBSIGV4cGVyaW1lbnQgVVJMIGhlcmVdLlxuICovXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXREZWZhdWx0UmVsYXRpdmVJbmRleFJlYWRDb3N0UGVyRG9jdW1lbnQoKSB7XG4gICAgICAgICAgICAvLyBUaGVzZSB2YWx1ZXMgd2VyZSBkZXJpdmVkIGZyb20gYW4gZXhwZXJpbWVudCB3aGVyZSBzZXZlcmFsIG1lbWJlcnMgb2YgdGhlXG4gICAgICAgICAgICAvLyBGaXJlc3RvcmUgU0RLIHRlYW0gcmFuIGEgcGVyZm9ybWFuY2UgdGVzdCBpbiB2YXJpb3VzIGVudmlyb25tZW50cy5cbiAgICAgICAgICAgIC8vIEdvb2dsZXJzIGNhbiBzZWUgYi8yOTkyODQyODcgZm9yIGRldGFpbHMuXG4gICAgICAgICAgICByZXR1cm4gaXNTYWZhcmkoKSA/IDggOiBfX1BSSVZBVEVfZ2V0QW5kcm9pZFZlcnNpb24oZ2V0VUEoKSkgPiAwID8gNiA6IDQ7XG4gICAgICAgIH0oKTtcbiAgICB9XG4gICAgLyoqIFNldHMgdGhlIGRvY3VtZW50IHZpZXcgdG8gcXVlcnkgYWdhaW5zdC4gKi8gICAgaW5pdGlhbGl6ZShlLCB0KSB7XG4gICAgICAgIHRoaXMuSmkgPSBlLCB0aGlzLmluZGV4TWFuYWdlciA9IHQsIHRoaXMuR2kgPSAhMDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYWxsIGxvY2FsIGRvY3VtZW50cyBtYXRjaGluZyB0aGUgc3BlY2lmaWVkIHF1ZXJ5LiAqLyAgICBnZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgLy8gU3RvcmVzIHRoZSByZXN1bHQgZnJvbSBleGVjdXRpbmcgdGhlIHF1ZXJ5OyB1c2luZyB0aGlzIG9iamVjdCBpcyBtb3JlXG4gICAgICAgIC8vIGNvbnZlbmllbnQgdGhhbiBwYXNzaW5nIHRoZSByZXN1bHQgYmV0d2VlbiBzdGVwcyBvZiB0aGUgcGVyc2lzdGVuY2VcbiAgICAgICAgLy8gdHJhbnNhY3Rpb24gYW5kIGltcHJvdmVzIHJlYWRhYmlsaXR5IGNvbXBhcmF0aXZlbHkuXG4gICAgICAgIGNvbnN0IGkgPSB7XG4gICAgICAgICAgICByZXN1bHQ6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuWWkoZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBpLnJlc3VsdCA9IGU7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWkucmVzdWx0KSByZXR1cm4gdGhpcy5aaShlLCB0LCByLCBuKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBpLnJlc3VsdCA9IGU7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoaS5yZXN1bHQpIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgUXVlcnlDb250ZXh0O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuWGkoZSwgdCwgbikubmV4dCgociA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGkucmVzdWx0ID0gciwgdGhpcy56aSkgcmV0dXJuIHRoaXMuZXMoZSwgdCwgbiwgci5zaXplKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkucmVzdWx0KSk7XG4gICAgfVxuICAgIGVzKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgcmV0dXJuIG4uZG9jdW1lbnRSZWFkQ291bnQgPCB0aGlzLmppID8gKF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIDw9IExvZ0xldmVsLkRFQlVHICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlF1ZXJ5RW5naW5lXCIsIFwiU0RLIHdpbGwgbm90IGNyZWF0ZSBjYWNoZSBpbmRleGVzIGZvciBxdWVyeTpcIiwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpLCBcInNpbmNlIGl0IG9ubHkgY3JlYXRlcyBjYWNoZSBpbmRleGVzIGZvciBjb2xsZWN0aW9uIGNvbnRhaW5zXCIsIFwibW9yZSB0aGFuIG9yIGVxdWFsIHRvXCIsIHRoaXMuamksIFwiZG9jdW1lbnRzXCIpLCBcbiAgICAgICAgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKSkgOiAoX19QUklWQVRFX2dldExvZ0xldmVsKCkgPD0gTG9nTGV2ZWwuREVCVUcgJiYgX19QUklWQVRFX2xvZ0RlYnVnKFwiUXVlcnlFbmdpbmVcIiwgXCJRdWVyeTpcIiwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpLCBcInNjYW5zXCIsIG4uZG9jdW1lbnRSZWFkQ291bnQsIFwibG9jYWwgZG9jdW1lbnRzIGFuZCByZXR1cm5zXCIsIHIsIFwiZG9jdW1lbnRzIGFzIHJlc3VsdHMuXCIpLCBcbiAgICAgICAgbi5kb2N1bWVudFJlYWRDb3VudCA+IHRoaXMuSGkgKiByID8gKF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIDw9IExvZ0xldmVsLkRFQlVHICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlF1ZXJ5RW5naW5lXCIsIFwiVGhlIFNESyBkZWNpZGVzIHRvIGNyZWF0ZSBjYWNoZSBpbmRleGVzIGZvciBxdWVyeTpcIiwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpLCBcImFzIHVzaW5nIGNhY2hlIGluZGV4ZXMgbWF5IGhlbHAgaW1wcm92ZSBwZXJmb3JtYW5jZS5cIiksIFxuICAgICAgICB0aGlzLmluZGV4TWFuYWdlci5jcmVhdGVUYXJnZXRJbmRleGVzKGUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpKSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgYW4gaW5kZXhlZCBxdWVyeSB0aGF0IGV2YWx1YXRlcyB0aGUgcXVlcnkgYmFzZWQgb24gYSBjb2xsZWN0aW9uJ3NcbiAgICAgKiBwZXJzaXN0ZWQgaW5kZXggdmFsdWVzLiBSZXR1cm5zIGBudWxsYCBpZiBhbiBpbmRleCBpcyBub3QgYXZhaWxhYmxlLlxuICAgICAqLyAgICBZaShlLCB0KSB7XG4gICAgICAgIGlmIChfX1BSSVZBVEVfcXVlcnlNYXRjaGVzQWxsRG9jdW1lbnRzKHQpKSBcbiAgICAgICAgLy8gUXVlcmllcyB0aGF0IG1hdGNoIGFsbCBkb2N1bWVudHMgZG9uJ3QgYmVuZWZpdCBmcm9tIHVzaW5nXG4gICAgICAgIC8vIGtleS1iYXNlZCBsb29rdXBzLiBJdCBpcyBtb3JlIGVmZmljaWVudCB0byBzY2FuIGFsbCBkb2N1bWVudHMgaW4gYVxuICAgICAgICAvLyBjb2xsZWN0aW9uLCByYXRoZXIgdGhhbiB0byBwZXJmb3JtIGluZGl2aWR1YWwgbG9va3Vwcy5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgICAgICBsZXQgbiA9IF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleE1hbmFnZXIuZ2V0SW5kZXhUeXBlKGUsIG4pLm5leHQoKHIgPT4gMCAvKiBJbmRleFR5cGUuTk9ORSAqLyA9PT0gciA/IG51bGwgOiAobnVsbCAhPT0gdC5saW1pdCAmJiAxIC8qIEluZGV4VHlwZS5QQVJUSUFMICovID09PSByICYmIChcbiAgICAgICAgLy8gV2UgY2Fubm90IGFwcGx5IGEgbGltaXQgZm9yIHRhcmdldHMgdGhhdCBhcmUgc2VydmVkIHVzaW5nIGEgcGFydGlhbFxuICAgICAgICAvLyBpbmRleC4gSWYgYSBwYXJ0aWFsIGluZGV4IHdpbGwgYmUgdXNlZCB0byBzZXJ2ZSB0aGUgdGFyZ2V0LCB0aGVcbiAgICAgICAgLy8gcXVlcnkgbWF5IHJldHVybiBhIHN1cGVyc2V0IG9mIGRvY3VtZW50cyB0aGF0IG1hdGNoIHRoZSB0YXJnZXRcbiAgICAgICAgLy8gKGUuZy4gaWYgdGhlIGluZGV4IGRvZXNuJ3QgaW5jbHVkZSBhbGwgdGhlIHRhcmdldCdzIGZpbHRlcnMpLCBvclxuICAgICAgICAvLyBtYXkgcmV0dXJuIHRoZSBjb3JyZWN0IHNldCBvZiBkb2N1bWVudHMgaW4gdGhlIHdyb25nIG9yZGVyIChlLmcuIGlmXG4gICAgICAgIC8vIHRoZSBpbmRleCBkb2Vzbid0IGluY2x1ZGUgYSBzZWdtZW50IGZvciBvbmUgb2YgdGhlIG9yZGVyQnlzKS5cbiAgICAgICAgLy8gVGhlcmVmb3JlLCBhIGxpbWl0IHNob3VsZCBub3QgYmUgYXBwbGllZCBpbiBzdWNoIGNhc2VzLlxuICAgICAgICB0ID0gX19QUklWQVRFX3F1ZXJ5V2l0aExpbWl0KHQsIG51bGwsIFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyksIG4gPSBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldCh0KSksIFxuICAgICAgICB0aGlzLmluZGV4TWFuYWdlci5nZXREb2N1bWVudHNNYXRjaGluZ1RhcmdldChlLCBuKS5uZXh0KChyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoLi4ucik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5KaS5nZXREb2N1bWVudHMoZSwgaSkubmV4dCgociA9PiB0aGlzLmluZGV4TWFuYWdlci5nZXRNaW5PZmZzZXQoZSwgbikubmV4dCgobiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMudHModCwgcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubnModCwgcywgaSwgbi5yZWFkVGltZSkgPyB0aGlzLllpKGUsIF9fUFJJVkFURV9xdWVyeVdpdGhMaW1pdCh0LCBudWxsLCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8pKSA6IHRoaXMucnMoZSwgcywgdCwgbik7XG4gICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgfSkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHF1ZXJ5IGJhc2VkIG9uIHRoZSB0YXJnZXQncyBwZXJzaXN0ZWQgcXVlcnkgbWFwcGluZy4gUmV0dXJuc1xuICAgICAqIGBudWxsYCBpZiB0aGUgbWFwcGluZyBpcyBub3QgYXZhaWxhYmxlIG9yIGNhbm5vdCBiZSB1c2VkLlxuICAgICAqLyAgICBaaShlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzQWxsRG9jdW1lbnRzKHQpIHx8IHIuaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpID8gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCkgOiB0aGlzLkppLmdldERvY3VtZW50cyhlLCBuKS5uZXh0KChpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLnRzKHQsIGkpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubnModCwgcywgbiwgcikgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShudWxsKSA6IChfX1BSSVZBVEVfZ2V0TG9nTGV2ZWwoKSA8PSBMb2dMZXZlbC5ERUJVRyAmJiBfX1BSSVZBVEVfbG9nRGVidWcoXCJRdWVyeUVuZ2luZVwiLCBcIlJlLXVzaW5nIHByZXZpb3VzIHJlc3VsdCBmcm9tICVzIHRvIGV4ZWN1dGUgcXVlcnk6ICVzXCIsIHIudG9TdHJpbmcoKSwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpKSwgXG4gICAgICAgICAgICB0aGlzLnJzKGUsIHMsIHQsIF9fUFJJVkFURV9uZXdJbmRleE9mZnNldFN1Y2Nlc3NvckZyb21SZWFkVGltZShyLCAtMSkpLm5leHQoKGUgPT4gZSkpKTtcbiAgICAgICAgfSkpO1xuICAgICAgICAvLyBRdWVyaWVzIHRoYXQgaGF2ZSBuZXZlciBzZWVuIGEgc25hcHNob3Qgd2l0aG91dCBsaW1ibyBmcmVlIGRvY3VtZW50c1xuICAgICAgICAvLyBzaG91bGQgYWxzbyBiZSBydW4gYXMgYSBmdWxsIGNvbGxlY3Rpb24gc2Nhbi5cbiAgICAgICAgfVxuICAgIC8qKiBBcHBsaWVzIHRoZSBxdWVyeSBmaWx0ZXIgYW5kIHNvcnRpbmcgdG8gdGhlIHByb3ZpZGVkIGRvY3VtZW50cy4gICovICAgIHRzKGUsIHQpIHtcbiAgICAgICAgLy8gU29ydCB0aGUgZG9jdW1lbnRzIGFuZCByZS1hcHBseSB0aGUgcXVlcnkgZmlsdGVyIHNpbmNlIHByZXZpb3VzbHlcbiAgICAgICAgLy8gbWF0Y2hpbmcgZG9jdW1lbnRzIGRvIG5vdCBuZWNlc3NhcmlseSBzdGlsbCBtYXRjaCB0aGUgcXVlcnkuXG4gICAgICAgIGxldCBuID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfbmV3UXVlcnlDb21wYXJhdG9yKGUpKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoKHQsIHIpID0+IHtcbiAgICAgICAgICAgIF9fUFJJVkFURV9xdWVyeU1hdGNoZXMoZSwgcikgJiYgKG4gPSBuLmFkZChyKSk7XG4gICAgICAgIH0pKSwgbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiBhIGxpbWl0IHF1ZXJ5IG5lZWRzIHRvIGJlIHJlZmlsbGVkIGZyb20gY2FjaGUsIG1ha2luZyBpdFxuICAgICAqIGluZWxpZ2libGUgZm9yIGluZGV4LWZyZWUgZXhlY3V0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHF1ZXJ5IC0gVGhlIHF1ZXJ5LlxuICAgICAqIEBwYXJhbSBzb3J0ZWRQcmV2aW91c1Jlc3VsdHMgLSBUaGUgZG9jdW1lbnRzIHRoYXQgbWF0Y2hlZCB0aGUgcXVlcnkgd2hlbiBpdFxuICAgICAqIHdhcyBsYXN0IHN5bmNocm9uaXplZCwgc29ydGVkIGJ5IHRoZSBxdWVyeSdzIGNvbXBhcmF0b3IuXG4gICAgICogQHBhcmFtIHJlbW90ZUtleXMgLSBUaGUgZG9jdW1lbnQga2V5cyB0aGF0IG1hdGNoZWQgdGhlIHF1ZXJ5IGF0IHRoZSBsYXN0XG4gICAgICogc25hcHNob3QuXG4gICAgICogQHBhcmFtIGxpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiAtIFRoZSB2ZXJzaW9uIG9mIHRoZSBzbmFwc2hvdCB3aGVuIHRoZVxuICAgICAqIHF1ZXJ5IHdhcyBsYXN0IHN5bmNocm9uaXplZC5cbiAgICAgKi8gICAgbnMoZSwgdCwgbiwgcikge1xuICAgICAgICBpZiAobnVsbCA9PT0gZS5saW1pdCkgXG4gICAgICAgIC8vIFF1ZXJpZXMgd2l0aG91dCBsaW1pdHMgZG8gbm90IG5lZWQgdG8gYmUgcmVmaWxsZWQuXG4gICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgaWYgKG4uc2l6ZSAhPT0gdC5zaXplKSBcbiAgICAgICAgLy8gVGhlIHF1ZXJ5IG5lZWRzIHRvIGJlIHJlZmlsbGVkIGlmIGEgcHJldmlvdXNseSBtYXRjaGluZyBkb2N1bWVudCBub1xuICAgICAgICAvLyBsb25nZXIgbWF0Y2hlcy5cbiAgICAgICAgcmV0dXJuICEwO1xuICAgICAgICAvLyBMaW1pdCBxdWVyaWVzIGFyZSBub3QgZWxpZ2libGUgZm9yIGluZGV4LWZyZWUgcXVlcnkgZXhlY3V0aW9uIGlmIHRoZXJlIGlzXG4gICAgICAgIC8vIGEgcG90ZW50aWFsIHRoYXQgYW4gb2xkZXIgZG9jdW1lbnQgZnJvbSBjYWNoZSBub3cgc29ydHMgYmVmb3JlIGEgZG9jdW1lbnRcbiAgICAgICAgLy8gdGhhdCB3YXMgcHJldmlvdXNseSBwYXJ0IG9mIHRoZSBsaW1pdC4gVGhpcywgaG93ZXZlciwgY2FuIG9ubHkgaGFwcGVuIGlmXG4gICAgICAgIC8vIHRoZSBkb2N1bWVudCBhdCB0aGUgZWRnZSBvZiB0aGUgbGltaXQgZ29lcyBvdXQgb2YgbGltaXQuXG4gICAgICAgIC8vIElmIGEgZG9jdW1lbnQgdGhhdCBpcyBub3QgdGhlIGxpbWl0IGJvdW5kYXJ5IHNvcnRzIGRpZmZlcmVudGx5LFxuICAgICAgICAvLyB0aGUgYm91bmRhcnkgb2YgdGhlIGxpbWl0IGl0c2VsZiBkaWQgbm90IGNoYW5nZSBhbmQgZG9jdW1lbnRzIGZyb20gY2FjaGVcbiAgICAgICAgLy8gd2lsbCBjb250aW51ZSB0byBiZSBcInJlamVjdGVkXCIgYnkgdGhpcyBib3VuZGFyeS4gVGhlcmVmb3JlLCB3ZSBjYW4gaWdub3JlXG4gICAgICAgIC8vIGFueSBtb2RpZmljYXRpb25zIHRoYXQgZG9uJ3QgYWZmZWN0IHRoZSBsYXN0IGRvY3VtZW50LlxuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gPT09IGUubGltaXRUeXBlID8gdC5sYXN0KCkgOiB0LmZpcnN0KCk7XG4gICAgICAgIHJldHVybiAhIWkgJiYgKGkuaGFzUGVuZGluZ1dyaXRlcyB8fCBpLnZlcnNpb24uY29tcGFyZVRvKHIpID4gMCk7XG4gICAgfVxuICAgIFhpKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIDw9IExvZ0xldmVsLkRFQlVHICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlF1ZXJ5RW5naW5lXCIsIFwiVXNpbmcgZnVsbCBjb2xsZWN0aW9uIHNjYW4gdG8gZXhlY3V0ZSBxdWVyeTpcIiwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpKSwgXG4gICAgICAgIHRoaXMuSmkuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdRdWVyeShlLCB0LCBJbmRleE9mZnNldC5taW4oKSwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbWJpbmVzIHRoZSByZXN1bHRzIGZyb20gYW4gaW5kZXhlZCBleGVjdXRpb24gd2l0aCB0aGUgcmVtYWluaW5nIGRvY3VtZW50c1xuICAgICAqIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gaW5kZXhlZC5cbiAgICAgKi8gICAgcnMoZSwgdCwgbiwgcikge1xuICAgICAgICAvLyBSZXRyaWV2ZSBhbGwgcmVzdWx0cyBmb3IgZG9jdW1lbnRzIHRoYXQgd2VyZSB1cGRhdGVkIHNpbmNlIHRoZSBvZmZzZXQuXG4gICAgICAgIHJldHVybiB0aGlzLkppLmdldERvY3VtZW50c01hdGNoaW5nUXVlcnkoZSwgbiwgcikubmV4dCgoZSA9PiAoXG4gICAgICAgIC8vIE1lcmdlIHdpdGggZXhpc3RpbmcgcmVzdWx0c1xuICAgICAgICB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgZSA9IGUuaW5zZXJ0KHQua2V5LCB0KTtcbiAgICAgICAgfSkpLCBlKSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW1wbGVtZW50cyBgTG9jYWxTdG9yZWAgaW50ZXJmYWNlLlxuICpcbiAqIE5vdGU6IHNvbWUgZmllbGQgZGVmaW5lZCBpbiB0aGlzIGNsYXNzIG1pZ2h0IGhhdmUgcHVibGljIGFjY2VzcyBsZXZlbCwgYnV0XG4gKiB0aGUgY2xhc3MgaXMgbm90IGV4cG9ydGVkIHNvIHRoZXkgYXJlIG9ubHkgYWNjZXNzaWJsZSBmcm9tIHRoaXMgbW9kdWxlLlxuICogVGhpcyBpcyB1c2VmdWwgdG8gaW1wbGVtZW50IG9wdGlvbmFsIGZlYXR1cmVzIChsaWtlIGJ1bmRsZXMpIGluIGZyZWVcbiAqIGZ1bmN0aW9ucywgc3VjaCB0aGF0IHRoZXkgYXJlIHRyZWUtc2hha2VhYmxlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTG9jYWxTdG9yZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBNYW5hZ2VzIG91ciBpbi1tZW1vcnkgb3IgZHVyYWJsZSBwZXJzaXN0ZW5jZS4gKi9cbiAgICBlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSBlLCB0aGlzLnNzID0gdCwgdGhpcy5zZXJpYWxpemVyID0gciwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNYXBzIGEgdGFyZ2V0SUQgdG8gZGF0YSBhYm91dCBpdHMgdGFyZ2V0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBQT1JUSU5HIE5PVEU6IFdlIGFyZSB1c2luZyBhbiBpbW11dGFibGUgZGF0YSBzdHJ1Y3R1cmUgb24gV2ViIHRvIG1ha2UgcmUtcnVuc1xuICAgICAgICAgKiBvZiBgYXBwbHlSZW1vdGVFdmVudCgpYCBpZGVtcG90ZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vcyA9IG5ldyBTb3J0ZWRNYXAoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCBcbiAgICAgICAgLyoqIE1hcHMgYSB0YXJnZXQgdG8gaXRzIHRhcmdldElELiAqL1xuICAgICAgICAvLyBUT0RPKHd1YW5keSk6IEV2YWx1YXRlIGlmIFRhcmdldElkIGNhbiBiZSBwYXJ0IG9mIFRhcmdldC5cbiAgICAgICAgdGhpcy5fcyA9IG5ldyBPYmplY3RNYXAoKGUgPT4gX19QUklWQVRFX2Nhbm9uaWZ5VGFyZ2V0KGUpKSwgX19QUklWQVRFX3RhcmdldEVxdWFscyksIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBwZXIgY29sbGVjdGlvbiBncm91cCBpbmRleCBvZiB0aGUgbGFzdCByZWFkIHRpbWUgcHJvY2Vzc2VkIGJ5XG4gICAgICAgICAqIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIG11bHRpLXRhYiBzeW5jaHJvbml6YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzID0gbmV3IE1hcCwgdGhpcy5jcyA9IGUuZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpLCB0aGlzLlVyID0gZS5nZXRUYXJnZXRDYWNoZSgpLCBcbiAgICAgICAgdGhpcy5HciA9IGUuZ2V0QnVuZGxlQ2FjaGUoKSwgdGhpcy5scyhuKTtcbiAgICB9XG4gICAgbHMoZSkge1xuICAgICAgICAvLyBUT0RPKGluZGV4aW5nKTogQWRkIHNwZWMgdGVzdHMgdGhhdCB0ZXN0IHRoZXNlIGNvbXBvbmVudHMgY2hhbmdlIGFmdGVyIGFcbiAgICAgICAgLy8gdXNlciBjaGFuZ2VcbiAgICAgICAgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZSA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0RG9jdW1lbnRPdmVybGF5Q2FjaGUoZSksIHRoaXMuaW5kZXhNYW5hZ2VyID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRJbmRleE1hbmFnZXIoZSksIFxuICAgICAgICB0aGlzLm11dGF0aW9uUXVldWUgPSB0aGlzLnBlcnNpc3RlbmNlLmdldE11dGF0aW9uUXVldWUoZSwgdGhpcy5pbmRleE1hbmFnZXIpLCB0aGlzLmxvY2FsRG9jdW1lbnRzID0gbmV3IExvY2FsRG9jdW1lbnRzVmlldyh0aGlzLmNzLCB0aGlzLm11dGF0aW9uUXVldWUsIHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUsIHRoaXMuaW5kZXhNYW5hZ2VyKSwgXG4gICAgICAgIHRoaXMuY3Muc2V0SW5kZXhNYW5hZ2VyKHRoaXMuaW5kZXhNYW5hZ2VyKSwgdGhpcy5zcy5pbml0aWFsaXplKHRoaXMubG9jYWxEb2N1bWVudHMsIHRoaXMuaW5kZXhNYW5hZ2VyKTtcbiAgICB9XG4gICAgY29sbGVjdEdhcmJhZ2UoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkNvbGxlY3QgZ2FyYmFnZVwiLCBcInJlYWR3cml0ZS1wcmltYXJ5XCIsICh0ID0+IGUuY29sbGVjdCh0LCB0aGlzLm9zKSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX25ld0xvY2FsU3RvcmUoXG4vKiogTWFuYWdlcyBvdXIgaW4tbWVtb3J5IG9yIGR1cmFibGUgcGVyc2lzdGVuY2UuICovXG5lLCB0LCBuLCByKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTG9jYWxTdG9yZUltcGwoZSwgdCwgbiwgcik7XG59XG5cbi8qKlxuICogVGVsbHMgdGhlIExvY2FsU3RvcmUgdGhhdCB0aGUgY3VycmVudGx5IGF1dGhlbnRpY2F0ZWQgdXNlciBoYXMgY2hhbmdlZC5cbiAqXG4gKiBJbiByZXNwb25zZSB0aGUgbG9jYWwgc3RvcmUgc3dpdGNoZXMgdGhlIG11dGF0aW9uIHF1ZXVlIHRvIHRoZSBuZXcgdXNlciBhbmRcbiAqIHJldHVybnMgYW55IHJlc3VsdGluZyBkb2N1bWVudCBjaGFuZ2VzLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IEFuZHJvaWQgYW5kIGlPUyBvbmx5IHJldHVybiB0aGUgZG9jdW1lbnRzIGFmZmVjdGVkIGJ5IHRoZVxuLy8gY2hhbmdlLlxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVIYW5kbGVVc2VyQ2hhbmdlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gYXdhaXQgbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkhhbmRsZSB1c2VyIGNoYW5nZVwiLCBcInJlYWRvbmx5XCIsIChlID0+IHtcbiAgICAgICAgLy8gU3dhcCBvdXQgdGhlIG11dGF0aW9uIHF1ZXVlLCBncmFiYmluZyB0aGUgcGVuZGluZyBtdXRhdGlvbiBiYXRjaGVzXG4gICAgICAgIC8vIGJlZm9yZSBhbmQgYWZ0ZXIuXG4gICAgICAgIGxldCByO1xuICAgICAgICByZXR1cm4gbi5tdXRhdGlvblF1ZXVlLmdldEFsbE11dGF0aW9uQmF0Y2hlcyhlKS5uZXh0KChpID0+IChyID0gaSwgbi5scyh0KSwgbi5tdXRhdGlvblF1ZXVlLmdldEFsbE11dGF0aW9uQmF0Y2hlcyhlKSkpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBbXSwgcyA9IFtdO1xuICAgICAgICAgICAgLy8gVW5pb24gdGhlIG9sZC9uZXcgY2hhbmdlZCBrZXlzLlxuICAgICAgICAgICAgbGV0IG8gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiByKSB7XG4gICAgICAgICAgICAgICAgaS5wdXNoKGUuYmF0Y2hJZCk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGUubXV0YXRpb25zKSBvID0gby5hZGQodC5rZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgICAgICBzLnB1c2goZS5iYXRjaElkKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZS5tdXRhdGlvbnMpIG8gPSBvLmFkZCh0LmtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIHNldCBvZiBhbGwgKHBvdGVudGlhbGx5KSBjaGFuZ2VkIGRvY3VtZW50cyBhbmQgdGhlIGxpc3RcbiAgICAgICAgICAgIC8vIG9mIG11dGF0aW9uIGJhdGNoIElEcyB0aGF0IHdlcmUgYWZmZWN0ZWQgYnkgY2hhbmdlLlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKGUsIG8pLm5leHQoKGUgPT4gKHtcbiAgICAgICAgICAgICAgICBoczogZSxcbiAgICAgICAgICAgICAgICByZW1vdmVkQmF0Y2hJZHM6IGksXG4gICAgICAgICAgICAgICAgYWRkZWRCYXRjaElkczogc1xuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfSkpO1xuICAgIH0pKTtcbn1cblxuLyogQWNjZXB0cyBsb2NhbGx5IGdlbmVyYXRlZCBNdXRhdGlvbnMgYW5kIGNvbW1pdCB0aGVtIHRvIHN0b3JhZ2UuICovXG4vKipcbiAqIEFja25vd2xlZGdlcyB0aGUgZ2l2ZW4gYmF0Y2guXG4gKlxuICogT24gdGhlIGhhcHB5IHBhdGggd2hlbiBhIGJhdGNoIGlzIGFja25vd2xlZGdlZCwgdGhlIGxvY2FsIHN0b3JlIHdpbGxcbiAqXG4gKiAgKyByZW1vdmUgdGhlIGJhdGNoIGZyb20gdGhlIG11dGF0aW9uIHF1ZXVlO1xuICogICsgYXBwbHkgdGhlIGNoYW5nZXMgdG8gdGhlIHJlbW90ZSBkb2N1bWVudCBjYWNoZTtcbiAqICArIHJlY2FsY3VsYXRlIHRoZSBsYXRlbmN5IGNvbXBlbnNhdGVkIHZpZXcgaW1wbGllZCBieSB0aG9zZSBjaGFuZ2VzICh0aGVyZVxuICogICAgbWF5IGJlIG11dGF0aW9ucyBpbiB0aGUgcXVldWUgdGhhdCBhZmZlY3QgdGhlIGRvY3VtZW50cyBidXQgaGF2ZW4ndCBiZWVuXG4gKiAgICBhY2tub3dsZWRnZWQgeWV0KTsgYW5kXG4gKiAgKyBnaXZlIHRoZSBjaGFuZ2VkIGRvY3VtZW50cyBiYWNrIHRoZSBzeW5jIGVuZ2luZVxuICpcbiAqIEByZXR1cm5zIFRoZSByZXN1bHRpbmcgKG1vZGlmaWVkKSBkb2N1bWVudHMuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlQWNrbm93bGVkZ2VCYXRjaChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJBY2tub3dsZWRnZSBiYXRjaFwiLCBcInJlYWR3cml0ZS1wcmltYXJ5XCIsIChlID0+IHtcbiAgICAgICAgY29uc3QgciA9IHQuYmF0Y2gua2V5cygpLCBpID0gbi5jcy5uZXdDaGFuZ2VCdWZmZXIoe1xuICAgICAgICAgICAgdHJhY2tSZW1vdmFsczogITBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlXcml0ZVRvUmVtb3RlRG9jdW1lbnRzKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBuLmJhdGNoLCBzID0gaS5rZXlzKCk7XG4gICAgICAgICAgICBsZXQgbyA9IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgICAgICByZXR1cm4gcy5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICBvID0gby5uZXh0KCgoKSA9PiByLmdldEVudHJ5KHQsIGUpKSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuLmRvY1ZlcnNpb25zLmdldChlKTtcbiAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQobnVsbCAhPT0gcyksIHQudmVyc2lvbi5jb21wYXJlVG8ocykgPCAwICYmIChpLmFwcGx5VG9SZW1vdGVEb2N1bWVudCh0LCBuKSwgXG4gICAgICAgICAgICAgICAgICAgIHQuaXNWYWxpZERvY3VtZW50KCkgJiYgKFxuICAgICAgICAgICAgICAgICAgICAvLyBXZSB1c2UgdGhlIGNvbW1pdFZlcnNpb24gYXMgdGhlIHJlYWRUaW1lIHJhdGhlciB0aGFuIHRoZVxuICAgICAgICAgICAgICAgICAgICAvLyBkb2N1bWVudCdzIHVwZGF0ZVRpbWUgc2luY2UgdGhlIHVwZGF0ZVRpbWUgaXMgbm90IGFkdmFuY2VkXG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciB1cGRhdGVzIHRoYXQgZG8gbm90IG1vZGlmeSB0aGUgdW5kZXJseWluZyBkb2N1bWVudC5cbiAgICAgICAgICAgICAgICAgICAgdC5zZXRSZWFkVGltZShuLmNvbW1pdFZlcnNpb24pLCByLmFkZEVudHJ5KHQpKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpLCBvLm5leHQoKCgpID0+IGUubXV0YXRpb25RdWV1ZS5yZW1vdmVNdXRhdGlvbkJhdGNoKHQsIGkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqIFJldHVybnMgdGhlIGxvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50cyBhZmZlY3RlZCBieSBhIG11dGF0aW9uIGJhdGNoLiAqL1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuICAgICAgICAobiwgZSwgdCwgaSkubmV4dCgoKCkgPT4gaS5hcHBseShlKSkpLm5leHQoKCgpID0+IG4ubXV0YXRpb25RdWV1ZS5wZXJmb3JtQ29uc2lzdGVuY3lDaGVjayhlKSkpLm5leHQoKCgpID0+IG4uZG9jdW1lbnRPdmVybGF5Q2FjaGUucmVtb3ZlT3ZlcmxheXNGb3JCYXRjaElkKGUsIHIsIHQuYmF0Y2guYmF0Y2hJZCkpKS5uZXh0KCgoKSA9PiBuLmxvY2FsRG9jdW1lbnRzLnJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzRm9yRG9jdW1lbnRLZXlzKGUsIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXRLZXlzV2l0aFRyYW5zZm9ybVJlc3VsdHMoZSkge1xuICAgICAgICAgICAgbGV0IHQgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5tdXRhdGlvblJlc3VsdHMubGVuZ3RoOyArK24pIHtcbiAgICAgICAgICAgICAgICBlLm11dGF0aW9uUmVzdWx0c1tuXS50cmFuc2Zvcm1SZXN1bHRzLmxlbmd0aCA+IDAgJiYgKHQgPSB0LmFkZChlLmJhdGNoLm11dGF0aW9uc1tuXS5rZXkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmVtb3ZlcyBtdXRhdGlvbnMgZnJvbSB0aGUgTXV0YXRpb25RdWV1ZSBmb3IgdGhlIHNwZWNpZmllZCBiYXRjaDtcbiAqIExvY2FsRG9jdW1lbnRzIHdpbGwgYmUgcmVjYWxjdWxhdGVkLlxuICpcbiAqIEByZXR1cm5zIFRoZSByZXN1bHRpbmcgbW9kaWZpZWQgZG9jdW1lbnRzLlxuICovICh0KSkpKS5uZXh0KCgoKSA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldERvY3VtZW50cyhlLCByKSkpO1xuICAgIH0pKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsYXN0IGNvbnNpc3RlbnQgc25hcHNob3QgcHJvY2Vzc2VkICh1c2VkIGJ5IHRoZSBSZW1vdGVTdG9yZSB0b1xuICogZGV0ZXJtaW5lIHdoZXRoZXIgdG8gYnVmZmVyIGluY29taW5nIHNuYXBzaG90cyBmcm9tIHRoZSBiYWNrZW5kKS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gdC5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBsYXN0IHJlbW90ZSBzbmFwc2hvdCB2ZXJzaW9uXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gdC5Vci5nZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUpKSk7XG59XG5cbi8qKlxuICogVXBkYXRlcyB0aGUgXCJncm91bmQtc3RhdGVcIiAocmVtb3RlKSBkb2N1bWVudHMuIFdlIGFzc3VtZSB0aGF0IHRoZSByZW1vdGVcbiAqIGV2ZW50IHJlZmxlY3RzIGFueSB3cml0ZSBiYXRjaGVzIHRoYXQgaGF2ZSBiZWVuIGFja25vd2xlZGdlZCBvciByZWplY3RlZFxuICogKGkuZS4gd2UgZG8gbm90IHJlLWFwcGx5IGxvY2FsIG11dGF0aW9ucyB0byB1cGRhdGVzIGZyb20gdGhpcyBldmVudCkuXG4gKlxuICogTG9jYWxEb2N1bWVudHMgYXJlIHJlLWNhbGN1bGF0ZWQgaWYgdGhlcmUgYXJlIHJlbWFpbmluZyBtdXRhdGlvbnMgaW4gdGhlXG4gKiBxdWV1ZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUFwcGx5UmVtb3RlRXZlbnRUb0xvY2FsQ2FjaGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gdC5zbmFwc2hvdFZlcnNpb247XG4gICAgbGV0IGkgPSBuLm9zO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQXBwbHkgcmVtb3RlIGV2ZW50XCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4ge1xuICAgICAgICBjb25zdCBzID0gbi5jcy5uZXdDaGFuZ2VCdWZmZXIoe1xuICAgICAgICAgICAgdHJhY2tSZW1vdmFsczogITBcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlc2V0IG5ld1RhcmdldERhdGFCeVRhcmdldE1hcCBpbiBjYXNlIHRoaXMgdHJhbnNhY3Rpb24gZ2V0cyByZS1ydW4uXG4gICAgICAgICAgICAgICAgaSA9IG4ub3M7XG4gICAgICAgIGNvbnN0IG8gPSBbXTtcbiAgICAgICAgdC50YXJnZXRDaGFuZ2VzLmZvckVhY2goKChzLCBfKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhID0gaS5nZXQoXyk7XG4gICAgICAgICAgICBpZiAoIWEpIHJldHVybjtcbiAgICAgICAgICAgIC8vIE9ubHkgdXBkYXRlIHRoZSByZW1vdGUga2V5cyBpZiB0aGUgdGFyZ2V0IGlzIHN0aWxsIGFjdGl2ZS4gVGhpc1xuICAgICAgICAgICAgLy8gZW5zdXJlcyB0aGF0IHdlIGNhbiBwZXJzaXN0IHRoZSB1cGRhdGVkIHRhcmdldCBkYXRhIGFsb25nIHdpdGhcbiAgICAgICAgICAgIC8vIHRoZSB1cGRhdGVkIGFzc2lnbm1lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnB1c2gobi5Vci5yZW1vdmVNYXRjaGluZ0tleXMoZSwgcy5yZW1vdmVkRG9jdW1lbnRzLCBfKS5uZXh0KCgoKSA9PiBuLlVyLmFkZE1hdGNoaW5nS2V5cyhlLCBzLmFkZGVkRG9jdW1lbnRzLCBfKSkpKTtcbiAgICAgICAgICAgIGxldCB1ID0gYS53aXRoU2VxdWVuY2VOdW1iZXIoZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIpO1xuICAgICAgICAgICAgbnVsbCAhPT0gdC50YXJnZXRNaXNtYXRjaGVzLmdldChfKSA/IHUgPSB1LndpdGhSZXN1bWVUb2tlbihCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HLCBTbmFwc2hvdFZlcnNpb24ubWluKCkpLndpdGhMYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uKFNuYXBzaG90VmVyc2lvbi5taW4oKSkgOiBzLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDAgJiYgKHUgPSB1LndpdGhSZXN1bWVUb2tlbihzLnJlc3VtZVRva2VuLCByKSksIFxuICAgICAgICAgICAgaSA9IGkuaW5zZXJ0KF8sIHUpLCBcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdGFyZ2V0IGRhdGEgaWYgdGhlcmUgYXJlIHRhcmdldCBjaGFuZ2VzIChvciBpZlxuICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0aW1lIGhhcyBwYXNzZWQgc2luY2UgdGhlIGxhc3QgdXBkYXRlKS5cbiAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBuZXdUYXJnZXREYXRhIHNob3VsZCBiZSBwZXJzaXN0ZWQgZHVyaW5nIGFuIHVwZGF0ZSBvZlxuICogYW4gYWN0aXZlIHRhcmdldC4gVGFyZ2V0RGF0YSBzaG91bGQgYWx3YXlzIGJlIHBlcnNpc3RlZCB3aGVuIGEgdGFyZ2V0IGlzXG4gKiBiZWluZyByZWxlYXNlZCBhbmQgc2hvdWxkIG5vdCBjYWxsIHRoaXMgZnVuY3Rpb24uXG4gKlxuICogV2hpbGUgdGhlIHRhcmdldCBpcyBhY3RpdmUsIFRhcmdldERhdGEgdXBkYXRlcyBjYW4gYmUgb21pdHRlZCB3aGVuIG5vdGhpbmdcbiAqIGFib3V0IHRoZSB0YXJnZXQgaGFzIGNoYW5nZWQgZXhjZXB0IG1ldGFkYXRhIGxpa2UgdGhlIHJlc3VtZSB0b2tlbiBvclxuICogc25hcHNob3QgdmVyc2lvbi4gT2NjYXNpb25hbGx5IGl0J3Mgd29ydGggdGhlIGV4dHJhIHdyaXRlIHRvIHByZXZlbnQgdGhlc2VcbiAqIHZhbHVlcyBmcm9tIGdldHRpbmcgdG9vIHN0YWxlIGFmdGVyIGEgY3Jhc2gsIGJ1dCB0aGlzIGRvZXNuJ3QgaGF2ZSB0byBiZVxuICogdG9vIGZyZXF1ZW50LlxuICovXG4gICAgICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfc2hvdWxkUGVyc2lzdFRhcmdldERhdGEoZSwgdCwgbikge1xuICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBwZXJzaXN0IHRhcmdldCBkYXRhIGlmIHdlIGRvbid0IGFscmVhZHkgaGF2ZSBhIHJlc3VtZSB0b2tlbi5cbiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gZS5yZXN1bWVUb2tlbi5hcHByb3hpbWF0ZUJ5dGVTaXplKCkpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICAvLyBEb24ndCBhbGxvdyByZXN1bWUgdG9rZW4gY2hhbmdlcyB0byBiZSBidWZmZXJlZCBpbmRlZmluaXRlbHkuIFRoaXNcbiAgICAgICAgICAgICAgICAvLyBhbGxvd3MgdXMgdG8gYmUgcmVhc29uYWJseSB1cC10by1kYXRlIGFmdGVyIGEgY3Jhc2ggYW5kIGF2b2lkcyBuZWVkaW5nXG4gICAgICAgICAgICAgICAgLy8gdG8gbG9vcCBvdmVyIGFsbCBhY3RpdmUgcXVlcmllcyBvbiBzaHV0ZG93bi4gRXNwZWNpYWxseSBpbiB0aGUgYnJvd3NlclxuICAgICAgICAgICAgICAgIC8vIHdlIG1heSBub3QgZ2V0IHRpbWUgdG8gZG8gYW55dGhpbmcgaW50ZXJlc3Rpbmcgd2hpbGUgdGhlIGN1cnJlbnQgdGFiIGlzXG4gICAgICAgICAgICAgICAgLy8gY2xvc2luZy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuc25hcHNob3RWZXJzaW9uLnRvTWljcm9zZWNvbmRzKCkgLSBlLnNuYXBzaG90VmVyc2lvbi50b01pY3Jvc2Vjb25kcygpID49IDNlOCkgcmV0dXJuICEwO1xuICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBpZiB0aGUgb25seSB0aGluZyB0aGF0IGhhcyBjaGFuZ2VkIGFib3V0IGEgdGFyZ2V0IGlzIGl0cyByZXN1bWVcbiAgICAgICAgICAgICAgICAvLyB0b2tlbiBpdCdzIG5vdCB3b3J0aCBwZXJzaXN0aW5nLiBOb3RlIHRoYXQgdGhlIFJlbW90ZVN0b3JlIGtlZXBzIGFuXG4gICAgICAgICAgICAgICAgLy8gaW4tbWVtb3J5IHZpZXcgb2YgdGhlIGN1cnJlbnRseSBhY3RpdmUgdGFyZ2V0cyB3aGljaCBpbmNsdWRlcyB0aGUgY3VycmVudFxuICAgICAgICAgICAgICAgIC8vIHJlc3VtZSB0b2tlbiwgc28gc3RyZWFtIGZhaWx1cmUgb3IgdXNlciBjaGFuZ2VzIHdpbGwgc3RpbGwgdXNlIGFuXG4gICAgICAgICAgICAgICAgLy8gdXAtdG8tZGF0ZSByZXN1bWUgdG9rZW4gcmVnYXJkbGVzcyBvZiB3aGF0IHdlIGRvIGhlcmUuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLmFkZGVkRG9jdW1lbnRzLnNpemUgKyBuLm1vZGlmaWVkRG9jdW1lbnRzLnNpemUgKyBuLnJlbW92ZWREb2N1bWVudHMuc2l6ZSA+IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAqIE5vdGlmaWVzIGxvY2FsIHN0b3JlIG9mIHRoZSBjaGFuZ2VkIHZpZXdzIHRvIGxvY2FsbHkgcGluIGRvY3VtZW50cy5cbiAqLyAoYSwgdSwgcykgJiYgby5wdXNoKG4uVXIudXBkYXRlVGFyZ2V0RGF0YShlLCB1KSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgbGV0IF8gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCksIGEgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgLy8gSEFDSzogVGhlIG9ubHkgcmVhc29uIHdlIGFsbG93IGEgbnVsbCBzbmFwc2hvdCB2ZXJzaW9uIGlzIHNvIHRoYXQgd2VcbiAgICAgICAgLy8gY2FuIHN5bnRoZXNpemUgcmVtb3RlIGV2ZW50cyB3aGVuIHdlIGdldCBwZXJtaXNzaW9uIGRlbmllZCBlcnJvcnMgd2hpbGVcbiAgICAgICAgLy8gdHJ5aW5nIHRvIHJlc29sdmUgdGhlIHN0YXRlIG9mIGEgbG9jYWxseSBjYWNoZWQgZG9jdW1lbnQgdGhhdCBpcyBpblxuICAgICAgICAvLyBsaW1iby5cbiAgICAgICAgaWYgKHQuZG9jdW1lbnRVcGRhdGVzLmZvckVhY2goKHIgPT4ge1xuICAgICAgICAgICAgdC5yZXNvbHZlZExpbWJvRG9jdW1lbnRzLmhhcyhyKSAmJiBvLnB1c2gobi5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZS51cGRhdGVMaW1ib0RvY3VtZW50KGUsIHIpKTtcbiAgICAgICAgfSkpLCBcbiAgICAgICAgLy8gRWFjaCBsb29wIGl0ZXJhdGlvbiBvbmx5IGFmZmVjdHMgaXRzIFwib3duXCIgZG9jLCBzbyBpdCdzIHNhZmUgdG8gZ2V0IGFsbFxuICAgICAgICAvLyB0aGUgcmVtb3RlIGRvY3VtZW50cyBpbiBhZHZhbmNlIGluIGEgc2luZ2xlIGNhbGwuXG4gICAgICAgIG8ucHVzaChfX1BSSVZBVEVfcG9wdWxhdGVEb2N1bWVudENoYW5nZUJ1ZmZlcihlLCBzLCB0LmRvY3VtZW50VXBkYXRlcykubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBfID0gZS5QcywgYSA9IGUuSXM7XG4gICAgICAgIH0pKSksICFyLmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG4uVXIuZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbihlKS5uZXh0KCh0ID0+IG4uVXIuc2V0VGFyZ2V0c01ldGFkYXRhKGUsIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyLCByKSkpO1xuICAgICAgICAgICAgby5wdXNoKHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihvKS5uZXh0KCgoKSA9PiBzLmFwcGx5KGUpKSkubmV4dCgoKCkgPT4gbi5sb2NhbERvY3VtZW50cy5nZXRMb2NhbFZpZXdPZkRvY3VtZW50cyhlLCBfLCBhKSkpLm5leHQoKCgpID0+IF8pKTtcbiAgICB9KSkudGhlbigoZSA9PiAobi5vcyA9IGksIGUpKSk7XG59XG5cbi8qKlxuICogUG9wdWxhdGVzIGRvY3VtZW50IGNoYW5nZSBidWZmZXIgd2l0aCBkb2N1bWVudHMgZnJvbSBiYWNrZW5kIG9yIGEgYnVuZGxlLlxuICogUmV0dXJucyB0aGUgZG9jdW1lbnQgY2hhbmdlcyByZXN1bHRpbmcgZnJvbSBhcHBseWluZyB0aG9zZSBkb2N1bWVudHMsIGFuZFxuICogYWxzbyBhIHNldCBvZiBkb2N1bWVudHMgd2hvc2UgZXhpc3RlbmNlIHN0YXRlIGFyZSBjaGFuZ2VkIGFzIGEgcmVzdWx0LlxuICpcbiAqIEBwYXJhbSB0eG4gLSBUcmFuc2FjdGlvbiB0byB1c2UgdG8gcmVhZCBleGlzdGluZyBkb2N1bWVudHMgZnJvbSBzdG9yYWdlLlxuICogQHBhcmFtIGRvY3VtZW50QnVmZmVyIC0gRG9jdW1lbnQgYnVmZmVyIHRvIGNvbGxlY3QgdGhlIHJlc3VsdGVkIGNoYW5nZXMgdG8gYmVcbiAqICAgICAgICBhcHBsaWVkIHRvIHN0b3JhZ2UuXG4gKiBAcGFyYW0gZG9jdW1lbnRzIC0gRG9jdW1lbnRzIHRvIGJlIGFwcGxpZWQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BvcHVsYXRlRG9jdW1lbnRDaGFuZ2VCdWZmZXIoZSwgdCwgbikge1xuICAgIGxldCByID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICByZXR1cm4gbi5mb3JFYWNoKChlID0+IHIgPSByLmFkZChlKSkpLCB0LmdldEVudHJpZXMoZSwgcikubmV4dCgoZSA9PiB7XG4gICAgICAgIGxldCByID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICByZXR1cm4gbi5mb3JFYWNoKCgobiwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgbyA9IGUuZ2V0KG4pO1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgc2VlIGlmIHRoZXJlIGlzIGEgZXhpc3RlbmNlIHN0YXRlIGNoYW5nZSBmb3IgdGhpcyBkb2N1bWVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIHMuaXNGb3VuZERvY3VtZW50KCkgIT09IG8uaXNGb3VuZERvY3VtZW50KCkgJiYgKGkgPSBpLmFkZChuKSksIFxuICAgICAgICAgICAgLy8gTm90ZTogVGhlIG9yZGVyIG9mIHRoZSBzdGVwcyBiZWxvdyBpcyBpbXBvcnRhbnQsIHNpbmNlIHdlIHdhbnRcbiAgICAgICAgICAgIC8vIHRvIGVuc3VyZSB0aGF0IHJlamVjdGVkIGxpbWJvIHJlc29sdXRpb25zICh3aGljaCBmYWJyaWNhdGVcbiAgICAgICAgICAgIC8vIE5vRG9jdW1lbnRzIHdpdGggU25hcHNob3RWZXJzaW9uLm1pbigpKSBuZXZlciBhZGQgZG9jdW1lbnRzIHRvXG4gICAgICAgICAgICAvLyBjYWNoZS5cbiAgICAgICAgICAgIHMuaXNOb0RvY3VtZW50KCkgJiYgcy52ZXJzaW9uLmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSA/IChcbiAgICAgICAgICAgIC8vIE5vRG9jdW1lbnRzIHdpdGggU25hcHNob3RWZXJzaW9uLm1pbigpIGFyZSB1c2VkIGluIG1hbnVmYWN0dXJlZFxuICAgICAgICAgICAgLy8gZXZlbnRzLiBXZSByZW1vdmUgdGhlc2UgZG9jdW1lbnRzIGZyb20gY2FjaGUgc2luY2Ugd2UgbG9zdFxuICAgICAgICAgICAgLy8gYWNjZXNzLlxuICAgICAgICAgICAgdC5yZW1vdmVFbnRyeShuLCBzLnJlYWRUaW1lKSwgciA9IHIuaW5zZXJ0KG4sIHMpKSA6ICFvLmlzVmFsaWREb2N1bWVudCgpIHx8IHMudmVyc2lvbi5jb21wYXJlVG8oby52ZXJzaW9uKSA+IDAgfHwgMCA9PT0gcy52ZXJzaW9uLmNvbXBhcmVUbyhvLnZlcnNpb24pICYmIG8uaGFzUGVuZGluZ1dyaXRlcyA/ICh0LmFkZEVudHJ5KHMpLCBcbiAgICAgICAgICAgIHIgPSByLmluc2VydChuLCBzKSkgOiBfX1BSSVZBVEVfbG9nRGVidWcoXCJMb2NhbFN0b3JlXCIsIFwiSWdub3Jpbmcgb3V0ZGF0ZWQgd2F0Y2ggdXBkYXRlIGZvciBcIiwgbiwgXCIuIEN1cnJlbnQgdmVyc2lvbjpcIiwgby52ZXJzaW9uLCBcIiBXYXRjaCB2ZXJzaW9uOlwiLCBzLnZlcnNpb24pO1xuICAgICAgICB9KSksIHtcbiAgICAgICAgICAgIFBzOiByLFxuICAgICAgICAgICAgSXM6IGlcbiAgICAgICAgfTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogR2V0cyB0aGUgbXV0YXRpb24gYmF0Y2ggYWZ0ZXIgdGhlIHBhc3NlZCBpbiBiYXRjaElkIGluIHRoZSBtdXRhdGlvbiBxdWV1ZVxuICogb3IgbnVsbCBpZiBlbXB0eS5cbiAqIEBwYXJhbSBhZnRlckJhdGNoSWQgLSBJZiBwcm92aWRlZCwgdGhlIGJhdGNoIHRvIHNlYXJjaCBhZnRlci5cbiAqIEByZXR1cm5zIFRoZSBuZXh0IG11dGF0aW9uIG9yIG51bGwgaWYgdGhlcmUgd2Fzbid0IG9uZS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXh0TXV0YXRpb25CYXRjaChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJHZXQgbmV4dCBtdXRhdGlvbiBiYXRjaFwiLCBcInJlYWRvbmx5XCIsIChlID0+ICh2b2lkIDAgPT09IHQgJiYgKHQgPSAtMSksIFxuICAgIG4ubXV0YXRpb25RdWV1ZS5nZXROZXh0TXV0YXRpb25CYXRjaEFmdGVyQmF0Y2hJZChlLCB0KSkpKTtcbn1cblxuLyoqXG4gKiBSZWFkcyB0aGUgY3VycmVudCB2YWx1ZSBvZiBhIERvY3VtZW50IHdpdGggYSBnaXZlbiBrZXkgb3IgbnVsbCBpZiBub3RcbiAqIGZvdW5kIC0gdXNlZCBmb3IgdGVzdGluZy5cbiAqL1xuLyoqXG4gKiBBc3NpZ25zIHRoZSBnaXZlbiB0YXJnZXQgYW4gaW50ZXJuYWwgSUQgc28gdGhhdCBpdHMgcmVzdWx0cyBjYW4gYmUgcGlubmVkIHNvXG4gKiB0aGV5IGRvbid0IGdldCBHQydkLiBBIHRhcmdldCBtdXN0IGJlIGFsbG9jYXRlZCBpbiB0aGUgbG9jYWwgc3RvcmUgYmVmb3JlXG4gKiB0aGUgc3RvcmUgY2FuIGJlIHVzZWQgdG8gbWFuYWdlIGl0cyB2aWV3LlxuICpcbiAqIEFsbG9jYXRpbmcgYW4gYWxyZWFkeSBhbGxvY2F0ZWQgYFRhcmdldGAgd2lsbCByZXR1cm4gdGhlIGV4aXN0aW5nIGBUYXJnZXREYXRhYFxuICogZm9yIHRoYXQgYFRhcmdldGAuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlQWxsb2NhdGVUYXJnZXQoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQWxsb2NhdGUgdGFyZ2V0XCIsIFwicmVhZHdyaXRlXCIsIChlID0+IHtcbiAgICAgICAgbGV0IHI7XG4gICAgICAgIHJldHVybiBuLlVyLmdldFRhcmdldERhdGEoZSwgdCkubmV4dCgoaSA9PiBpID8gKFxuICAgICAgICAvLyBUaGlzIHRhcmdldCBoYXMgYmVlbiBsaXN0ZW5lZCB0byBwcmV2aW91c2x5LCBzbyByZXVzZSB0aGVcbiAgICAgICAgLy8gcHJldmlvdXMgdGFyZ2V0SUQuXG4gICAgICAgIC8vIFRPRE8obWNnKTogZnJlc2hlbiBsYXN0IGFjY2Vzc2VkIGRhdGU/XG4gICAgICAgIHIgPSBpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShyKSkgOiBuLlVyLmFsbG9jYXRlVGFyZ2V0SWQoZSkubmV4dCgoaSA9PiAociA9IG5ldyBUYXJnZXREYXRhKHQsIGksIFwiVGFyZ2V0UHVycG9zZUxpc3RlblwiIC8qIFRhcmdldFB1cnBvc2UuTGlzdGVuICovICwgZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIpLCBcbiAgICAgICAgbi5Vci5hZGRUYXJnZXREYXRhKGUsIHIpLm5leHQoKCgpID0+IHIpKSkpKSkpO1xuICAgIH0pKS50aGVuKChlID0+IHtcbiAgICAgICAgLy8gSWYgTXVsdGktVGFiIGlzIGVuYWJsZWQsIHRoZSBleGlzdGluZyB0YXJnZXQgZGF0YSBtYXkgYmUgbmV3ZXIgdGhhblxuICAgICAgICAvLyB0aGUgaW4tbWVtb3J5IGRhdGFcbiAgICAgICAgY29uc3QgciA9IG4ub3MuZ2V0KGUudGFyZ2V0SWQpO1xuICAgICAgICByZXR1cm4gKG51bGwgPT09IHIgfHwgZS5zbmFwc2hvdFZlcnNpb24uY29tcGFyZVRvKHIuc25hcHNob3RWZXJzaW9uKSA+IDApICYmIChuLm9zID0gbi5vcy5pbnNlcnQoZS50YXJnZXRJZCwgZSksIFxuICAgICAgICBuLl9zLnNldCh0LCBlLnRhcmdldElkKSksIGU7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIFRhcmdldERhdGEgYXMgc2VlbiBieSB0aGUgTG9jYWxTdG9yZSwgaW5jbHVkaW5nIHVwZGF0ZXMgdGhhdCBtYXlcbiAqIGhhdmUgbm90IHlldCBiZWVuIHBlcnNpc3RlZCB0byB0aGUgVGFyZ2V0Q2FjaGUuXG4gKi9cbi8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG4vKipcbiAqIFVucGlucyBhbGwgdGhlIGRvY3VtZW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHRhcmdldC4gSWZcbiAqIGBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YWAgaXMgc2V0IHRvIGZhbHNlIGFuZCBFYWdlciBHQyBlbmFibGVkLCB0aGUgbWV0aG9kXG4gKiBkaXJlY3RseSByZW1vdmVzIHRoZSBhc3NvY2lhdGVkIHRhcmdldCBkYXRhIGZyb20gdGhlIHRhcmdldCBjYWNoZS5cbiAqXG4gKiBSZWxlYXNpbmcgYSBub24tZXhpc3RpbmcgYFRhcmdldGAgaXMgYSBuby1vcC5cbiAqL1xuLy8gUE9SVElORyBOT1RFOiBga2VlcFBlcnNpc3RlZFRhcmdldERhdGFgIGlzIG11bHRpLXRhYiBvbmx5LlxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgaSA9IHIub3MuZ2V0KHQpLCBzID0gbiA/IFwicmVhZHdyaXRlXCIgOiBcInJlYWR3cml0ZS1wcmltYXJ5XCI7XG4gICAgdHJ5IHtcbiAgICAgICAgbiB8fCBhd2FpdCByLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiUmVsZWFzZSB0YXJnZXRcIiwgcywgKGUgPT4gci5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZS5yZW1vdmVUYXJnZXQoZSwgaSkpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICghX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgdGhyb3cgZTtcbiAgICAgICAgLy8gQWxsIGByZWxlYXNlVGFyZ2V0YCBkb2VzIGlzIHJlY29yZCB0aGUgZmluYWwgbWV0YWRhdGEgc3RhdGUgZm9yIHRoZVxuICAgICAgICAvLyB0YXJnZXQsIGJ1dCB3ZSd2ZSBiZWVuIHJlY29yZGluZyB0aGlzIHBlcmlvZGljYWxseSBkdXJpbmcgdGFyZ2V0XG4gICAgICAgIC8vIGFjdGl2aXR5LiBJZiB3ZSBsb3NlIHRoaXMgd3JpdGUgdGhpcyBjb3VsZCBjYXVzZSBhIHZlcnkgc2xpZ2h0XG4gICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIG9yZGVyIG9mIHRhcmdldCBkZWxldGlvbiBkdXJpbmcgR0MsIGJ1dCB3ZVxuICAgICAgICAvLyBkb24ndCBkZWZpbmUgZXhhY3QgTFJVIHNlbWFudGljcyBzbyB0aGlzIGlzIGFjY2VwdGFibGUuXG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxvY2FsU3RvcmVcIiwgYEZhaWxlZCB0byB1cGRhdGUgc2VxdWVuY2UgbnVtYmVycyBmb3IgdGFyZ2V0ICR7dH06ICR7ZX1gKTtcbiAgICB9XG4gICAgci5vcyA9IHIub3MucmVtb3ZlKHQpLCByLl9zLmRlbGV0ZShpLnRhcmdldCk7XG59XG5cbi8qKlxuICogUnVucyB0aGUgc3BlY2lmaWVkIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHN0b3JlIGFuZCByZXR1cm5zIHRoZSByZXN1bHRzLFxuICogcG90ZW50aWFsbHkgdGFraW5nIGFkdmFudGFnZSBvZiBxdWVyeSBkYXRhIGZyb20gcHJldmlvdXMgZXhlY3V0aW9ucyAoc3VjaFxuICogYXMgdGhlIHNldCBvZiByZW1vdGUga2V5cykuXG4gKlxuICogQHBhcmFtIHVzZVByZXZpb3VzUmVzdWx0cyAtIFdoZXRoZXIgcmVzdWx0cyBmcm9tIHByZXZpb3VzIGV4ZWN1dGlvbnMgY2FuXG4gKiBiZSB1c2VkIHRvIG9wdGltaXplIHRoaXMgcXVlcnkgZXhlY3V0aW9uLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlRXhlY3V0ZVF1ZXJ5KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBsZXQgaSA9IFNuYXBzaG90VmVyc2lvbi5taW4oKSwgcyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgIHJldHVybiByLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiRXhlY3V0ZSBxdWVyeVwiLCBcInJlYWR3cml0ZVwiLCAoLy8gVXNlIHJlYWR3cml0ZSBpbnN0ZWFkIG9mIHJlYWRvbmx5IHNvIGluZGV4ZXMgY2FuIGJlIGNyZWF0ZWRcbiAgICAvLyBVc2UgcmVhZHdyaXRlIGluc3RlYWQgb2YgcmVhZG9ubHkgc28gaW5kZXhlcyBjYW4gYmUgY3JlYXRlZFxuICAgIGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRUYXJnZXREYXRhKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSByLl9zLmdldChuKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gaSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHIub3MuZ2V0KGkpKSA6IHIuVXIuZ2V0VGFyZ2V0RGF0YSh0LCBuKTtcbiAgICB9KHIsIGUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgaWYgKHQpIHJldHVybiBpID0gdC5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uLCByLlVyLmdldE1hdGNoaW5nS2V5c0ZvclRhcmdldElkKGUsIHQudGFyZ2V0SWQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgcyA9IGU7XG4gICAgICAgIH0pKTtcbiAgICB9KSkubmV4dCgoKCkgPT4gci5zcy5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4gPyBpIDogU25hcHNob3RWZXJzaW9uLm1pbigpLCBuID8gcyA6IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSkpLm5leHQoKGUgPT4gKF9fUFJJVkFURV9zZXRNYXhSZWFkVGltZShyLCBfX1BSSVZBVEVfcXVlcnlDb2xsZWN0aW9uR3JvdXAodCksIGUpLCBcbiAgICB7XG4gICAgICAgIGRvY3VtZW50czogZSxcbiAgICAgICAgVHM6IHNcbiAgICB9KSkpKSk7XG59XG5cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldENhY2hlZFRhcmdldChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KG4uVXIpLCBpID0gbi5vcy5nZXQodCk7XG4gICAgcmV0dXJuIGkgPyBQcm9taXNlLnJlc29sdmUoaS50YXJnZXQpIDogbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCB0YXJnZXQgZGF0YVwiLCBcInJlYWRvbmx5XCIsIChlID0+IHIub3QoZSwgdCkubmV4dCgoZSA9PiBlID8gZS50YXJnZXQgOiBudWxsKSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgaGF2ZSBiZWVuIHVwZGF0ZWQgc2luY2UgdGhlIGxhc3QgY2FsbC5cbiAqIElmIHRoaXMgaXMgdGhlIGZpcnN0IGNhbGwsIHJldHVybnMgdGhlIHNldCBvZiBjaGFuZ2VzIHNpbmNlIGNsaWVudFxuICogaW5pdGlhbGl6YXRpb24uIEZ1cnRoZXIgaW52b2NhdGlvbnMgd2lsbCByZXR1cm4gZG9jdW1lbnQgdGhhdCBoYXZlIGNoYW5nZWRcbiAqIHNpbmNlIHRoZSBwcmlvciBjYWxsLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXdEb2N1bWVudENoYW5nZXMoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gbi51cy5nZXQodCkgfHwgU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBtYXhpbXVtIHJlYWQgdGltZSBmb3IgdGhlIGNvbGxlY3Rpb24uIFRoaXMgc2hvdWxkIGFsd2F5c1xuICAgIC8vIGV4aXN0LCBidXQgdG8gcmVkdWNlIHRoZSBjaGFuY2UgZm9yIHJlZ3Jlc3Npb25zIHdlIGRlZmF1bHQgdG9cbiAgICAvLyBTbmFwc2hvdFZlcnNpb24uTWluKClcbiAgICAvLyBUT0RPKGluZGV4aW5nKTogQ29uc2lkZXIgcmVtb3ZpbmcgdGhlIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5ldyBkb2N1bWVudCBjaGFuZ2VzXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gbi5jcy5nZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQsIF9fUFJJVkFURV9uZXdJbmRleE9mZnNldFN1Y2Nlc3NvckZyb21SZWFkVGltZShyLCAtMSksIFxuICAgIC8qIGxpbWl0PSAqLyBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikpKS50aGVuKChlID0+IChfX1BSSVZBVEVfc2V0TWF4UmVhZFRpbWUobiwgdCwgZSksIFxuICAgIGUpKSk7XG59XG5cbi8qKiBTZXRzIHRoZSBjb2xsZWN0aW9uIGdyb3VwJ3MgbWF4aW11bSByZWFkIHRpbWUgZnJvbSB0aGUgZ2l2ZW4gZG9jdW1lbnRzLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zZXRNYXhSZWFkVGltZShlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSBlLnVzLmdldCh0KSB8fCBTbmFwc2hvdFZlcnNpb24ubWluKCk7XG4gICAgbi5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICB0LnJlYWRUaW1lLmNvbXBhcmVUbyhyKSA+IDAgJiYgKHIgPSB0LnJlYWRUaW1lKTtcbiAgICB9KSksIGUudXMuc2V0KHQsIHIpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IHVzaW5nIHRoZSBnaXZlbiBidW5kbGUgbmFtZSwgd2hpY2ggd2lsbCBiZSB1c2VkIHRvXG4gKiBob2xkIHRoZSBrZXlzIG9mIGFsbCBkb2N1bWVudHMgZnJvbSB0aGUgYnVuZGxlIGluIHF1ZXJ5LWRvY3VtZW50IG1hcHBpbmdzLlxuICogVGhpcyBlbnN1cmVzIHRoYXQgdGhlIGxvYWRlZCBkb2N1bWVudHMgZG8gbm90IGdldCBnYXJiYWdlIGNvbGxlY3RlZFxuICogcmlnaHQgYXdheS5cbiAqL1xuLyoqXG4gKiBBcHBsaWVzIHRoZSBkb2N1bWVudHMgZnJvbSBhIGJ1bmRsZSB0byB0aGUgXCJncm91bmQtc3RhdGVcIiAocmVtb3RlKVxuICogZG9jdW1lbnRzLlxuICpcbiAqIExvY2FsRG9jdW1lbnRzIGFyZSByZS1jYWxjdWxhdGVkIGlmIHRoZXJlIGFyZSByZW1haW5pbmcgbXV0YXRpb25zIGluIHRoZVxuICogcXVldWUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlQXBwbHlCdW5kbGVkRG9jdW1lbnRzKGUsIHQsIG4sIHIpIHtcbiAgICBjb25zdCBpID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBsZXQgcyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCBvID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgIGZvciAoY29uc3QgZSBvZiBuKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LkVzKGUubWV0YWRhdGEubmFtZSk7XG4gICAgICAgIGUuZG9jdW1lbnQgJiYgKHMgPSBzLmFkZChuKSk7XG4gICAgICAgIGNvbnN0IHIgPSB0LmRzKGUpO1xuICAgICAgICByLnNldFJlYWRUaW1lKHQuQXMoZS5tZXRhZGF0YS5yZWFkVGltZSkpLCBvID0gby5pbnNlcnQobiwgcik7XG4gICAgfVxuICAgIGNvbnN0IF8gPSBpLmNzLm5ld0NoYW5nZUJ1ZmZlcih7XG4gICAgICAgIHRyYWNrUmVtb3ZhbHM6ICEwXG4gICAgfSksIGEgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFsbG9jYXRlVGFyZ2V0KGksIGZ1bmN0aW9uIF9fUFJJVkFURV91bWJyZWxsYVRhcmdldChlKSB7XG4gICAgICAgIC8vIEl0IGlzIE9LIHRoYXQgdGhlIHBhdGggdXNlZCBmb3IgdGhlIHF1ZXJ5IGlzIG5vdCB2YWxpZCwgYmVjYXVzZSB0aGlzIHdpbGxcbiAgICAgICAgLy8gbm90IGJlIHJlYWQgYW5kIHF1ZXJpZWQuXG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChfX1BSSVZBVEVfbmV3UXVlcnlGb3JQYXRoKFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGBfX2J1bmRsZV9fL2RvY3MvJHtlfWApKSk7XG4gICAgfShyKSk7XG4gICAgLy8gQWxsb2NhdGVzIGEgdGFyZ2V0IHRvIGhvbGQgYWxsIGRvY3VtZW50IGtleXMgZnJvbSB0aGUgYnVuZGxlLCBzdWNoIHRoYXRcbiAgICAvLyB0aGV5IHdpbGwgbm90IGdldCBnYXJiYWdlIGNvbGxlY3RlZCByaWdodCBhd2F5LlxuICAgICAgICByZXR1cm4gaS5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkFwcGx5IGJ1bmRsZSBkb2N1bWVudHNcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4gX19QUklWQVRFX3BvcHVsYXRlRG9jdW1lbnRDaGFuZ2VCdWZmZXIoZSwgXywgbykubmV4dCgodCA9PiAoXy5hcHBseShlKSwgXG4gICAgdCkpKS5uZXh0KCh0ID0+IGkuVXIucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgYS50YXJnZXRJZCkubmV4dCgoKCkgPT4gaS5Vci5hZGRNYXRjaGluZ0tleXMoZSwgcywgYS50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiBpLmxvY2FsRG9jdW1lbnRzLmdldExvY2FsVmlld09mRG9jdW1lbnRzKGUsIHQuUHMsIHQuSXMpKSkubmV4dCgoKCkgPT4gdC5QcykpKSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSBvZiBhIGJvb2xlYW4gdG8gaW5kaWNhdGUgaWYgdGhlIGdpdmVuIGJ1bmRsZSBoYXMgYWxyZWFkeVxuICogYmVlbiBsb2FkZWQgYW5kIHRoZSBjcmVhdGUgdGltZSBpcyBuZXdlciB0aGFuIHRoZSBjdXJyZW50IGxvYWRpbmcgYnVuZGxlLlxuICovXG4vKipcbiAqIFNhdmVzIHRoZSBnaXZlbiBgTmFtZWRRdWVyeWAgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlU2F2ZU5hbWVkUXVlcnkoZSwgdCwgbiA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSB7XG4gICAgLy8gQWxsb2NhdGUgYSB0YXJnZXQgZm9yIHRoZSBuYW1lZCBxdWVyeSBzdWNoIHRoYXQgaXQgY2FuIGJlIHJlc3VtZWRcbiAgICAvLyBmcm9tIGFzc29jaWF0ZWQgcmVhZCB0aW1lIGlmIHVzZXJzIHVzZSBpdCB0byBsaXN0ZW4uXG4gICAgLy8gTk9URTogdGhpcyBhbHNvIG1lYW5zIGlmIG5vIGNvcnJlc3BvbmRpbmcgdGFyZ2V0IGV4aXN0cywgdGhlIG5ldyB0YXJnZXRcbiAgICAvLyB3aWxsIHJlbWFpbiBhY3RpdmUgYW5kIHdpbGwgbm90IGdldCBjb2xsZWN0ZWQsIHVubGVzcyB1c2VycyBoYXBwZW4gdG9cbiAgICAvLyB1bmxpc3RlbiB0aGUgcXVlcnkgc29tZWhvdy5cbiAgICBjb25zdCByID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChlLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeSh0LmJ1bmRsZWRRdWVyeSkpKSwgaSA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIGkucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJTYXZlIG5hbWVkIHF1ZXJ5XCIsIFwicmVhZHdyaXRlXCIsIChlID0+IHtcbiAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0LnJlYWRUaW1lKTtcbiAgICAgICAgLy8gU2ltcGx5IHNhdmUgdGhlIHF1ZXJ5IGl0c2VsZiBpZiBpdCBpcyBvbGRlciB0aGFuIHdoYXQgdGhlIFNESyBhbHJlYWR5XG4gICAgICAgIC8vIGhhcy5cbiAgICAgICAgICAgICAgICBpZiAoci5zbmFwc2hvdFZlcnNpb24uY29tcGFyZVRvKHMpID49IDApIHJldHVybiBpLkdyLnNhdmVOYW1lZFF1ZXJ5KGUsIHQpO1xuICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgdGFyZ2V0IGRhdGEgYmVjYXVzZSB0aGUgcXVlcnkgZnJvbSB0aGUgYnVuZGxlIGlzIG5ld2VyLlxuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSByLndpdGhSZXN1bWVUb2tlbihCeXRlU3RyaW5nLkVNUFRZX0JZVEVfU1RSSU5HLCBzKTtcbiAgICAgICAgcmV0dXJuIGkub3MgPSBpLm9zLmluc2VydChvLnRhcmdldElkLCBvKSwgaS5Vci51cGRhdGVUYXJnZXREYXRhKGUsIG8pLm5leHQoKCgpID0+IGkuVXIucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgci50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiBpLlVyLmFkZE1hdGNoaW5nS2V5cyhlLCBuLCByLnRhcmdldElkKSkpLm5leHQoKCgpID0+IGkuR3Iuc2F2ZU5hbWVkUXVlcnkoZSwgdCkpKTtcbiAgICB9KSk7XG59XG5cbi8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgYSBjbGllbnQgc3RhdGUgaW4gV2ViU3RvcmFnZSAqL1xuZnVuY3Rpb24gY3JlYXRlV2ViU3RvcmFnZUNsaWVudFN0YXRlS2V5KGUsIHQpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV9jbGllbnRzXyR7ZX1fJHt0fWA7XG59XG5cbi8vIFRoZSBmb3JtYXQgb2YgdGhlIFdlYlN0b3JhZ2Uga2V5IHRoYXQgc3RvcmVzIHRoZSBtdXRhdGlvbiBzdGF0ZSBpczpcbi8vICAgICBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5cbi8vICAgICAoZm9yIHVuYXV0aGVudGljYXRlZCB1c2Vycylcbi8vIG9yOiBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5fPHVzZXJfdWlkPlxuXG4vLyAndXNlcl91aWQnIGlzIGxhc3QgdG8gYXZvaWQgbmVlZGluZyB0byBlc2NhcGUgJ18nIGNoYXJhY3RlcnMgdGhhdCBpdCBtaWdodFxuLy8gY29udGFpbi5cbi8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgYSBtdXRhdGlvbiBiYXRjaCBpbiBXZWJTdG9yYWdlICovXG5mdW5jdGlvbiBjcmVhdGVXZWJTdG9yYWdlTXV0YXRpb25CYXRjaEtleShlLCB0LCBuKSB7XG4gICAgbGV0IHIgPSBgZmlyZXN0b3JlX211dGF0aW9uc18ke2V9XyR7bn1gO1xuICAgIHJldHVybiB0LmlzQXV0aGVudGljYXRlZCgpICYmIChyICs9IGBfJHt0LnVpZH1gKSwgcjtcbn1cblxuLy8gVGhlIGZvcm1hdCBvZiB0aGUgV2ViU3RvcmFnZSBrZXkgdGhhdCBzdG9yZXMgYSBxdWVyeSB0YXJnZXQncyBtZXRhZGF0YSBpczpcbi8vICAgICBmaXJlc3RvcmVfdGFyZ2V0c188cGVyc2lzdGVuY2VfcHJlZml4Pl88dGFyZ2V0X2lkPlxuLyoqIEFzc2VtYmxlcyB0aGUga2V5IGZvciBhIHF1ZXJ5IHN0YXRlIGluIFdlYlN0b3JhZ2UgKi9cbmZ1bmN0aW9uIGNyZWF0ZVdlYlN0b3JhZ2VRdWVyeVRhcmdldE1ldGFkYXRhS2V5KGUsIHQpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV90YXJnZXRzXyR7ZX1fJHt0fWA7XG59XG5cbi8vIFRoZSBXZWJTdG9yYWdlIHByZWZpeCB0aGF0IHN0b3JlcyB0aGUgcHJpbWFyeSB0YWIncyBvbmxpbmUgc3RhdGUuIFRoZVxuLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4vLyAgICAgZmlyZXN0b3JlX29ubGluZV9zdGF0ZV88cGVyc2lzdGVuY2VfcHJlZml4PlxuLyoqXG4gKiBIb2xkcyB0aGUgc3RhdGUgb2YgYSBtdXRhdGlvbiBiYXRjaCwgaW5jbHVkaW5nIGl0cyB1c2VyIElELCBiYXRjaCBJRCBhbmRcbiAqIHdoZXRoZXIgdGhlIGJhdGNoIGlzICdwZW5kaW5nJywgJ2Fja25vd2xlZGdlZCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgX19QUklWQVRFX011dGF0aW9uTWV0YWRhdGEge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy51c2VyID0gZSwgdGhpcy5iYXRjaElkID0gdCwgdGhpcy5zdGF0ZSA9IG4sIHRoaXMuZXJyb3IgPSByO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBNdXRhdGlvbk1ldGFkYXRhIGZyb20gaXRzIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgUnMoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gSlNPTi5wYXJzZShuKTtcbiAgICAgICAgbGV0IGksIHMgPSBcIm9iamVjdFwiID09IHR5cGVvZiByICYmIC0xICE9PSBbIFwicGVuZGluZ1wiLCBcImFja25vd2xlZGdlZFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKHIuc3RhdGUpICYmICh2b2lkIDAgPT09IHIuZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygci5lcnJvcik7XG4gICAgICAgIHJldHVybiBzICYmIHIuZXJyb3IgJiYgKHMgPSBcInN0cmluZ1wiID09IHR5cGVvZiByLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygci5lcnJvci5jb2RlLCBcbiAgICAgICAgcyAmJiAoaSA9IG5ldyBGaXJlc3RvcmVFcnJvcihyLmVycm9yLmNvZGUsIHIuZXJyb3IubWVzc2FnZSkpKSwgcyA/IG5ldyBfX1BSSVZBVEVfTXV0YXRpb25NZXRhZGF0YShlLCB0LCByLnN0YXRlLCBpKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIG11dGF0aW9uIHN0YXRlIGZvciBJRCAnJHt0fSc6ICR7bn1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbiAgICBWcygpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yICYmIChlLmVycm9yID0ge1xuICAgICAgICAgICAgY29kZTogdGhpcy5lcnJvci5jb2RlLFxuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5lcnJvci5tZXNzYWdlXG4gICAgICAgIH0pLCBKU09OLnN0cmluZ2lmeShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogSG9sZHMgdGhlIHN0YXRlIG9mIGEgcXVlcnkgdGFyZ2V0LCBpbmNsdWRpbmcgaXRzIHRhcmdldCBJRCBhbmQgd2hldGhlciB0aGVcbiAqIHRhcmdldCBpcyAnbm90LWN1cnJlbnQnLCAnY3VycmVudCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5VGFyZ2V0TWV0YWRhdGEge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy50YXJnZXRJZCA9IGUsIHRoaXMuc3RhdGUgPSB0LCB0aGlzLmVycm9yID0gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUXVlcnlUYXJnZXRNZXRhZGF0YSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIFJzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UodCk7XG4gICAgICAgIGxldCByLCBpID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgbiAmJiAtMSAhPT0gWyBcIm5vdC1jdXJyZW50XCIsIFwiY3VycmVudFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKG4uc3RhdGUpICYmICh2b2lkIDAgPT09IG4uZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygbi5lcnJvcik7XG4gICAgICAgIHJldHVybiBpICYmIG4uZXJyb3IgJiYgKGkgPSBcInN0cmluZ1wiID09IHR5cGVvZiBuLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygbi5lcnJvci5jb2RlLCBcbiAgICAgICAgaSAmJiAociA9IG5ldyBGaXJlc3RvcmVFcnJvcihuLmVycm9yLmNvZGUsIG4uZXJyb3IubWVzc2FnZSkpKSwgaSA/IG5ldyBfX1BSSVZBVEVfUXVlcnlUYXJnZXRNZXRhZGF0YShlLCBuLnN0YXRlLCByKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIHRhcmdldCBzdGF0ZSBmb3IgSUQgJyR7ZX0nOiAke3R9YCksIFxuICAgICAgICBudWxsKTtcbiAgICB9XG4gICAgVnMoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB7XG4gICAgICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcbiAgICAgICAgICAgIHVwZGF0ZVRpbWVNczogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5lcnJvciAmJiAoZS5lcnJvciA9IHtcbiAgICAgICAgICAgIGNvZGU6IHRoaXMuZXJyb3IuY29kZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuZXJyb3IubWVzc2FnZVxuICAgICAgICB9KSwgSlNPTi5zdHJpbmdpZnkoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyB0aGUgaW1tdXRhYmxlIENsaWVudFN0YXRlIGZvciBhIGNsaWVudCByZWFkIGZyb21cbiAqIFdlYlN0b3JhZ2UsIGNvbnRhaW5pbmcgdGhlIGxpc3Qgb2YgYWN0aXZlIHF1ZXJ5IHRhcmdldHMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1JlbW90ZUNsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuY2xpZW50SWQgPSBlLCB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIFJlbW90ZUNsaWVudFN0YXRlIGZyb20gdGhlIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgUnMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gSlNPTi5wYXJzZSh0KTtcbiAgICAgICAgbGV0IHIgPSBcIm9iamVjdFwiID09IHR5cGVvZiBuICYmIG4uYWN0aXZlVGFyZ2V0SWRzIGluc3RhbmNlb2YgQXJyYXksIGkgPSBfX1BSSVZBVEVfdGFyZ2V0SWRTZXQoKTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IHIgJiYgZSA8IG4uYWN0aXZlVGFyZ2V0SWRzLmxlbmd0aDsgKytlKSByID0gaXNTYWZlSW50ZWdlcihuLmFjdGl2ZVRhcmdldElkc1tlXSksIFxuICAgICAgICBpID0gaS5hZGQobi5hY3RpdmVUYXJnZXRJZHNbZV0pO1xuICAgICAgICByZXR1cm4gciA/IG5ldyBfX1BSSVZBVEVfUmVtb3RlQ2xpZW50U3RhdGUoZSwgaSkgOiAoX19QUklWQVRFX2xvZ0Vycm9yKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgYEZhaWxlZCB0byBwYXJzZSBjbGllbnQgZGF0YSBmb3IgaW5zdGFuY2UgJyR7ZX0nOiAke3R9YCksIFxuICAgICAgICBudWxsKTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyByZXByZXNlbnRzIHRoZSBvbmxpbmUgc3RhdGUgZm9yIGFsbCBjbGllbnRzIHBhcnRpY2lwYXRpbmcgaW5cbiAqIG11bHRpLXRhYi4gVGhlIG9ubGluZSBzdGF0ZSBpcyBvbmx5IHdyaXR0ZW4gdG8gYnkgdGhlIHByaW1hcnkgY2xpZW50LCBhbmRcbiAqIHVzZWQgaW4gc2Vjb25kYXJ5IGNsaWVudHMgdG8gdXBkYXRlIHRoZWlyIHF1ZXJ5IHZpZXdzLlxuICovIGNsYXNzIF9fUFJJVkFURV9TaGFyZWRPbmxpbmVTdGF0ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmNsaWVudElkID0gZSwgdGhpcy5vbmxpbmVTdGF0ZSA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIFNoYXJlZE9ubGluZVN0YXRlIGZyb20gaXRzIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgUnMoZSkge1xuICAgICAgICBjb25zdCB0ID0gSlNPTi5wYXJzZShlKTtcbiAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIHQgJiYgLTEgIT09IFsgXCJVbmtub3duXCIsIFwiT25saW5lXCIsIFwiT2ZmbGluZVwiIF0uaW5kZXhPZih0Lm9ubGluZVN0YXRlKSAmJiBcInN0cmluZ1wiID09IHR5cGVvZiB0LmNsaWVudElkID8gbmV3IF9fUFJJVkFURV9TaGFyZWRPbmxpbmVTdGF0ZSh0LmNsaWVudElkLCB0Lm9ubGluZVN0YXRlKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIG9ubGluZSBzdGF0ZTogJHtlfWApLCBcbiAgICAgICAgbnVsbCk7XG4gICAgfVxufVxuXG4vKipcbiAqIE1ldGFkYXRhIHN0YXRlIG9mIHRoZSBsb2NhbCBjbGllbnQuIFVubGlrZSBgUmVtb3RlQ2xpZW50U3RhdGVgLCB0aGlzIGNsYXNzIGlzXG4gKiBtdXRhYmxlIGFuZCBrZWVwcyB0cmFjayBvZiBhbGwgcGVuZGluZyBtdXRhdGlvbnMsIHdoaWNoIGFsbG93cyB1cyB0b1xuICogdXBkYXRlIHRoZSByYW5nZSBvZiBwZW5kaW5nIG11dGF0aW9uIGJhdGNoIElEcyBhcyBuZXcgbXV0YXRpb25zIGFyZSBhZGRlZCBvclxuICogcmVtb3ZlZC5cbiAqXG4gKiBUaGUgZGF0YSBpbiBgTG9jYWxDbGllbnRTdGF0ZWAgaXMgbm90IHJlYWQgZnJvbSBXZWJTdG9yYWdlIGFuZCBpbnN0ZWFkXG4gKiB1cGRhdGVkIHZpYSBpdHMgaW5zdGFuY2UgbWV0aG9kcy4gVGhlIHVwZGF0ZWQgc3RhdGUgY2FuIGJlIHNlcmlhbGl6ZWQgdmlhXG4gKiBgdG9XZWJTdG9yYWdlSlNPTigpYC5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbmNsYXNzIF9fUFJJVkFURV9Mb2NhbENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVUYXJnZXRJZHMgPSBfX1BSSVZBVEVfdGFyZ2V0SWRTZXQoKTtcbiAgICB9XG4gICAgZnMoZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmFkZChlKTtcbiAgICB9XG4gICAgZ3MoZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmRlbGV0ZShlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhpcyBlbnRyeSBpbnRvIGEgSlNPTi1lbmNvZGVkIGZvcm1hdCB3ZSBjYW4gdXNlIGZvciBXZWJTdG9yYWdlLlxuICAgICAqIERvZXMgbm90IGVuY29kZSBgY2xpZW50SWRgIGFzIGl0IGlzIHBhcnQgb2YgdGhlIGtleSBpbiBXZWJTdG9yYWdlLlxuICAgICAqLyAgICBWcygpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIGFjdGl2ZVRhcmdldElkczogdGhpcy5hY3RpdmVUYXJnZXRJZHMudG9BcnJheSgpLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgdXNlcyBXZWJTdG9yYWdlICh3aW5kb3cubG9jYWxTdG9yYWdlKSBhcyB0aGVcbiAqIGJhY2tpbmcgc3RvcmUgZm9yIHRoZSBTaGFyZWRDbGllbnRTdGF0ZS4gSXQga2VlcHMgdHJhY2sgb2YgYWxsIGFjdGl2ZVxuICogY2xpZW50cyBhbmQgc3VwcG9ydHMgbW9kaWZpY2F0aW9ucyBvZiB0aGUgbG9jYWwgY2xpZW50J3MgZGF0YS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHRoaXMud2luZG93ID0gZSwgdGhpcy51aSA9IHQsIHRoaXMucGVyc2lzdGVuY2VLZXkgPSBuLCB0aGlzLnBzID0gciwgdGhpcy5zeW5jRW5naW5lID0gbnVsbCwgXG4gICAgICAgIHRoaXMub25saW5lU3RhdGVIYW5kbGVyID0gbnVsbCwgdGhpcy5zZXF1ZW5jZU51bWJlckhhbmRsZXIgPSBudWxsLCB0aGlzLnlzID0gdGhpcy53cy5iaW5kKHRoaXMpLCBcbiAgICAgICAgdGhpcy5TcyA9IG5ldyBTb3J0ZWRNYXAoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCB0aGlzLnN0YXJ0ZWQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYXB0dXJlcyBXZWJTdG9yYWdlIGV2ZW50cyB0aGF0IG9jY3VyIGJlZm9yZSBgc3RhcnQoKWAgaXMgY2FsbGVkLiBUaGVzZVxuICAgICAgICAgKiBldmVudHMgYXJlIHJlcGxheWVkIG9uY2UgYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgaXMgc3RhcnRlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYnMgPSBbXTtcbiAgICAgICAgLy8gRXNjYXBlIHRoZSBzcGVjaWFsIGNoYXJhY3RlcnMgbWVudGlvbmVkIGhlcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvR3VpZGUvUmVndWxhcl9FeHByZXNzaW9uc1xuICAgICAgICBjb25zdCBzID0gbi5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG4gICAgICAgIHRoaXMuc3RvcmFnZSA9IHRoaXMud2luZG93LmxvY2FsU3RvcmFnZSwgdGhpcy5jdXJyZW50VXNlciA9IGksIHRoaXMuRHMgPSBjcmVhdGVXZWJTdG9yYWdlQ2xpZW50U3RhdGVLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgdGhpcy5wcyksIFxuICAgICAgICB0aGlzLnZzID0gXG4gICAgICAgIC8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgdGhlIGN1cnJlbnQgc2VxdWVuY2UgbnVtYmVyLiAqL1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVXZWJTdG9yYWdlU2VxdWVuY2VOdW1iZXJLZXkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGBmaXJlc3RvcmVfc2VxdWVuY2VfbnVtYmVyXyR7ZX1gO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgdGhpcy5TcyA9IHRoaXMuU3MuaW5zZXJ0KHRoaXMucHMsIG5ldyBfX1BSSVZBVEVfTG9jYWxDbGllbnRTdGF0ZSksIFxuICAgICAgICB0aGlzLkNzID0gbmV3IFJlZ0V4cChgXmZpcmVzdG9yZV9jbGllbnRzXyR7c31fKFteX10qKSRgKSwgdGhpcy5GcyA9IG5ldyBSZWdFeHAoYF5maXJlc3RvcmVfbXV0YXRpb25zXyR7c31fKFxcXFxkKykoPzpfKC4qKSk/JGApLCBcbiAgICAgICAgdGhpcy5NcyA9IG5ldyBSZWdFeHAoYF5maXJlc3RvcmVfdGFyZ2V0c18ke3N9XyhcXFxcZCspJGApLCB0aGlzLnhzID0gXG4gICAgICAgIC8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgdGhlIG9ubGluZSBzdGF0ZSBvZiB0aGUgcHJpbWFyeSB0YWIuICovXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVdlYlN0b3JhZ2VPbmxpbmVTdGF0ZUtleShlKSB7XG4gICAgICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV9vbmxpbmVfc3RhdGVfJHtlfWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIFdlYlN0b3JhZ2UgcHJlZml4IHRoYXQgcGxheXMgYXMgYSBldmVudCB0byBpbmRpY2F0ZSB0aGUgcmVtb3RlIGRvY3VtZW50c1xuICAgICAgICAvLyBtaWdodCBoYXZlIGNoYW5nZWQgZHVlIHRvIHNvbWUgc2Vjb25kYXJ5IHRhYnMgbG9hZGluZyBhIGJ1bmRsZS5cbiAgICAgICAgLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4gICAgICAgIC8vICAgICBmaXJlc3RvcmVfYnVuZGxlX2xvYWRlZF92Ml88cGVyc2lzdGVuY2VLZXk+XG4gICAgICAgIC8vIFRoZSB2ZXJzaW9uIGVuZGluZyB3aXRoIFwidjJcIiBzdG9yZXMgdGhlIGxpc3Qgb2YgbW9kaWZpZWQgY29sbGVjdGlvbiBncm91cHMuXG4gICAgICAgICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgdGhpcy5PcyA9IGZ1bmN0aW9uIGNyZWF0ZUJ1bmRsZUxvYWRlZEtleShlKSB7XG4gICAgICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV9idW5kbGVfbG9hZGVkX3YyXyR7ZX1gO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBXZWJTdG9yYWdlIGtleSBwcmVmaXggZm9yIHRoZSBrZXkgdGhhdCBzdG9yZXMgdGhlIGxhc3Qgc2VxdWVuY2UgbnVtYmVyIGFsbG9jYXRlZC4gVGhlIGtleVxuICAgICAgICAvLyBsb29rcyBsaWtlICdmaXJlc3RvcmVfc2VxdWVuY2VfbnVtYmVyXzxwZXJzaXN0ZW5jZV9wcmVmaXg+Jy5cbiAgICAgICAgKHRoaXMucGVyc2lzdGVuY2VLZXkpLCBcbiAgICAgICAgLy8gUmF0aGVyIHRoYW4gYWRkaW5nIHRoZSBzdG9yYWdlIG9ic2VydmVyIGR1cmluZyBzdGFydCgpLCB3ZSBhZGQgdGhlXG4gICAgICAgIC8vIHN0b3JhZ2Ugb2JzZXJ2ZXIgZHVyaW5nIGluaXRpYWxpemF0aW9uLiBUaGlzIGVuc3VyZXMgdGhhdCB3ZSBjb2xsZWN0XG4gICAgICAgIC8vIGV2ZW50cyBiZWZvcmUgb3RoZXIgY29tcG9uZW50cyBwb3B1bGF0ZSB0aGVpciBpbml0aWFsIHN0YXRlIChkdXJpbmcgdGhlaXJcbiAgICAgICAgLy8gcmVzcGVjdGl2ZSBzdGFydCgpIGNhbGxzKS4gT3RoZXJ3aXNlLCB3ZSBtaWdodCBmb3IgZXhhbXBsZSBtaXNzIGFcbiAgICAgICAgLy8gbXV0YXRpb24gdGhhdCBpcyBhZGRlZCBhZnRlciBMb2NhbFN0b3JlJ3Mgc3RhcnQoKSBwcm9jZXNzZWQgdGhlIGV4aXN0aW5nXG4gICAgICAgIC8vIG11dGF0aW9ucyBidXQgYmVmb3JlIHdlIG9ic2VydmUgV2ViU3RvcmFnZSBldmVudHMuXG4gICAgICAgIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJzdG9yYWdlXCIsIHRoaXMueXMpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyAndHJ1ZScgaWYgV2ViU3RvcmFnZSBpcyBhdmFpbGFibGUgaW4gdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQuICovICAgIHN0YXRpYyBEKGUpIHtcbiAgICAgICAgcmV0dXJuICEoIWUgfHwgIWUubG9jYWxTdG9yYWdlKTtcbiAgICB9XG4gICAgYXN5bmMgc3RhcnQoKSB7XG4gICAgICAgIC8vIFJldHJpZXZlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIGNsaWVudHMgdG8gYmFja2ZpbGwgdGhlIGRhdGEgaW5cbiAgICAgICAgLy8gU2hhcmVkQ2xpZW50U3RhdGUuXG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCB0aGlzLnN5bmNFbmdpbmUuUWkoKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGlmICh0ID09PSB0aGlzLnBzKSBjb250aW51ZTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmdldEl0ZW0oY3JlYXRlV2ViU3RvcmFnZUNsaWVudFN0YXRlS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIHQpKTtcbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9SZW1vdGVDbGllbnRTdGF0ZS5Scyh0LCBlKTtcbiAgICAgICAgICAgICAgICBuICYmICh0aGlzLlNzID0gdGhpcy5Tcy5pbnNlcnQobi5jbGllbnRJZCwgbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuTnMoKTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYW4gZXhpc3Rpbmcgb25saW5lIHN0YXRlIGFuZCBjYWxsIHRoZSBjYWxsYmFjayBoYW5kbGVyXG4gICAgICAgIC8vIGlmIGFwcGxpY2FibGUuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnhzKTtcbiAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLkxzKHQpO1xuICAgICAgICAgICAgZSAmJiB0aGlzLkJzKGUpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLmJzKSB0aGlzLndzKGUpO1xuICAgICAgICB0aGlzLmJzID0gW10sIFxuICAgICAgICAvLyBSZWdpc3RlciBhIHdpbmRvdyB1bmxvYWQgaG9vayB0byByZW1vdmUgdGhlIGNsaWVudCBtZXRhZGF0YSBlbnRyeSBmcm9tXG4gICAgICAgIC8vIFdlYlN0b3JhZ2UgZXZlbiBpZiBgc2h1dGRvd24oKWAgd2FzIG5vdCBjYWxsZWQuXG4gICAgICAgIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwYWdlaGlkZVwiLCAoKCkgPT4gdGhpcy5zaHV0ZG93bigpKSksIHRoaXMuc3RhcnRlZCA9ICEwO1xuICAgIH1cbiAgICB3cml0ZVNlcXVlbmNlTnVtYmVyKGUpIHtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHRoaXMudnMsIEpTT04uc3RyaW5naWZ5KGUpKTtcbiAgICB9XG4gICAgZ2V0QWxsQWN0aXZlUXVlcnlUYXJnZXRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5rcyh0aGlzLlNzKTtcbiAgICB9XG4gICAgaXNBY3RpdmVRdWVyeVRhcmdldChlKSB7XG4gICAgICAgIGxldCB0ID0gITE7XG4gICAgICAgIHJldHVybiB0aGlzLlNzLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICByLmFjdGl2ZVRhcmdldElkcy5oYXMoZSkgJiYgKHQgPSAhMCk7XG4gICAgICAgIH0pKSwgdDtcbiAgICB9XG4gICAgYWRkUGVuZGluZ011dGF0aW9uKGUpIHtcbiAgICAgICAgdGhpcy5xcyhlLCBcInBlbmRpbmdcIik7XG4gICAgfVxuICAgIHVwZGF0ZU11dGF0aW9uU3RhdGUoZSwgdCwgbikge1xuICAgICAgICB0aGlzLnFzKGUsIHQsIG4pLCBcbiAgICAgICAgLy8gT25jZSBhIGZpbmFsIG11dGF0aW9uIHJlc3VsdCBpcyBvYnNlcnZlZCBieSBvdGhlciBjbGllbnRzLCB0aGV5IG5vIGxvbmdlclxuICAgICAgICAvLyBhY2Nlc3MgdGhlIG11dGF0aW9uJ3MgbWV0YWRhdGEgZW50cnkuIFNpbmNlIFdlYlN0b3JhZ2UgcmVwbGF5cyBldmVudHNcbiAgICAgICAgLy8gaW4gb3JkZXIsIGl0IGlzIHNhZmUgdG8gZGVsZXRlIHRoZSBlbnRyeSByaWdodCBhZnRlciB1cGRhdGluZyBpdC5cbiAgICAgICAgdGhpcy5RcyhlKTtcbiAgICB9XG4gICAgYWRkTG9jYWxRdWVyeVRhcmdldChlLCB0ID0gITApIHtcbiAgICAgICAgbGV0IG4gPSBcIm5vdC1jdXJyZW50XCI7XG4gICAgICAgIC8vIExvb2t1cCBhbiBleGlzdGluZyBxdWVyeSBzdGF0ZSBpZiB0aGUgdGFyZ2V0IElEIHdhcyBhbHJlYWR5IHJlZ2lzdGVyZWRcbiAgICAgICAgLy8gYnkgYW5vdGhlciB0YWJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZVF1ZXJ5VGFyZ2V0KGUpKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oY3JlYXRlV2ViU3RvcmFnZVF1ZXJ5VGFyZ2V0TWV0YWRhdGFLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgZSkpO1xuICAgICAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX1F1ZXJ5VGFyZ2V0TWV0YWRhdGEuUnMoZSwgdCk7XG4gICAgICAgICAgICAgICAgciAmJiAobiA9IHIuc3RhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZSBxdWVyeSBpcyBsaXN0ZW5pbmcgdG8gY2FjaGUgb25seSwgdGhlIHRhcmdldCBJRCBzaG91bGQgbm90IGJlIHJlZ2lzdGVyZWQgd2l0aCB0aGVcbiAgICAgICAgLy8gbG9jYWwgRmlyZXN0b3JlIGNsaWVudCBhcyBhbiBhY3RpdmUgd2F0Y2ggdGFyZ2V0LlxuICAgICAgICAgICAgICAgIHJldHVybiB0ICYmIHRoaXMuS3MuZnMoZSksIHRoaXMuTnMoKSwgbjtcbiAgICB9XG4gICAgcmVtb3ZlTG9jYWxRdWVyeVRhcmdldChlKSB7XG4gICAgICAgIHRoaXMuS3MuZ3MoZSksIHRoaXMuTnMoKTtcbiAgICB9XG4gICAgaXNMb2NhbFF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuS3MuYWN0aXZlVGFyZ2V0SWRzLmhhcyhlKTtcbiAgICB9XG4gICAgY2xlYXJRdWVyeVN0YXRlKGUpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtKGNyZWF0ZVdlYlN0b3JhZ2VRdWVyeVRhcmdldE1ldGFkYXRhS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIGUpKTtcbiAgICB9XG4gICAgdXBkYXRlUXVlcnlTdGF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuJHMoZSwgdCwgbik7XG4gICAgfVxuICAgIGhhbmRsZVVzZXJDaGFuZ2UoZSwgdCwgbikge1xuICAgICAgICB0LmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5RcyhlKTtcbiAgICAgICAgfSkpLCB0aGlzLmN1cnJlbnRVc2VyID0gZSwgbi5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWRkUGVuZGluZ011dGF0aW9uKGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNldE9ubGluZVN0YXRlKGUpIHtcbiAgICAgICAgdGhpcy5VcyhlKTtcbiAgICB9XG4gICAgbm90aWZ5QnVuZGxlTG9hZGVkKGUpIHtcbiAgICAgICAgdGhpcy5XcyhlKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHRoaXMuc3RhcnRlZCAmJiAodGhpcy53aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN0b3JhZ2VcIiwgdGhpcy55cyksIHRoaXMucmVtb3ZlSXRlbSh0aGlzLkRzKSwgXG4gICAgICAgIHRoaXMuc3RhcnRlZCA9ICExKTtcbiAgICB9XG4gICAgZ2V0SXRlbShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShlKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiUkVBRFwiLCBlLCB0KSwgdDtcbiAgICB9XG4gICAgc2V0SXRlbShlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiU0VUXCIsIGUsIHQpLCB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShlLCB0KTtcbiAgICB9XG4gICAgcmVtb3ZlSXRlbShlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiUkVNT1ZFXCIsIGUpLCB0aGlzLnN0b3JhZ2UucmVtb3ZlSXRlbShlKTtcbiAgICB9XG4gICAgd3MoZSkge1xuICAgICAgICAvLyBOb3RlOiBUaGUgZnVuY3Rpb24gaXMgdHlwZWQgdG8gdGFrZSBFdmVudCB0byBiZSBpbnRlcmZhY2UtY29tcGF0aWJsZSB3aXRoXG4gICAgICAgIC8vIGBXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcmAuXG4gICAgICAgIGNvbnN0IHQgPSBlO1xuICAgICAgICBpZiAodC5zdG9yYWdlQXJlYSA9PT0gdGhpcy5zdG9yYWdlKSB7XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgXCJFVkVOVFwiLCB0LmtleSwgdC5uZXdWYWx1ZSksIHQua2V5ID09PSB0aGlzLkRzKSByZXR1cm4gdm9pZCBfX1BSSVZBVEVfbG9nRXJyb3IoXCJSZWNlaXZlZCBXZWJTdG9yYWdlIG5vdGlmaWNhdGlvbiBmb3IgbG9jYWwgY2hhbmdlLiBBbm90aGVyIGNsaWVudCBtaWdodCBoYXZlIGdhcmJhZ2UtY29sbGVjdGVkIG91ciBzdGF0ZVwiKTtcbiAgICAgICAgICAgIHRoaXMudWkuZW5xdWV1ZVJldHJ5YWJsZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IHQua2V5KSBpZiAodGhpcy5Dcy50ZXN0KHQua2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gdC5uZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLkdzKHQua2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy56cyhlLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5qcyh0LmtleSwgdC5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHJldHVybiB0aGlzLnpzKGUuY2xpZW50SWQsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuRnMudGVzdCh0LmtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSB0Lm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuSHModC5rZXksIHQubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSByZXR1cm4gdGhpcy5KcyhlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLk1zLnRlc3QodC5rZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPT0gdC5uZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLllzKHQua2V5LCB0Lm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkgcmV0dXJuIHRoaXMuWnMoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5rZXkgPT09IHRoaXMueHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSB0Lm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuTHModC5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHJldHVybiB0aGlzLkJzKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQua2V5ID09PSB0aGlzLnZzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21XZWJTdG9yYWdlU2VxdWVuY2VOdW1iZXIoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ID0gX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLm9lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGUpIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBKU09OLnBhcnNlKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChcIm51bWJlclwiID09IHR5cGVvZiBuKSwgdCA9IG47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRXJyb3IoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBcIkZhaWxlZCB0byByZWFkIHNlcXVlbmNlIG51bWJlciBmcm9tIFdlYlN0b3JhZ2VcIiwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBgTWVtb3J5U2hhcmVkQ2xpZW50U3RhdGVgIGlzIGEgc2ltcGxlIGltcGxlbWVudGF0aW9uIG9mIFNoYXJlZENsaWVudFN0YXRlIGZvclxuICogY2xpZW50cyB1c2luZyBtZW1vcnkgcGVyc2lzdGVuY2UuIFRoZSBzdGF0ZSBpbiB0aGlzIGNsYXNzIHJlbWFpbnMgZnVsbHlcbiAqIGlzb2xhdGVkIGFuZCBubyBzeW5jaHJvbml6YXRpb24gaXMgcGVyZm9ybWVkLlxuICovICh0Lm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUgIT09IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5vZSAmJiB0aGlzLnNlcXVlbmNlTnVtYmVySGFuZGxlcihlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmtleSA9PT0gdGhpcy5Pcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuWHModC5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChlLm1hcCgoZSA9PiB0aGlzLnN5bmNFbmdpbmUuZW8oZSkpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5icy5wdXNoKHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBLcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuU3MuZ2V0KHRoaXMucHMpO1xuICAgIH1cbiAgICBOcygpIHtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHRoaXMuRHMsIHRoaXMuS3MuVnMoKSk7XG4gICAgfVxuICAgIHFzKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfTXV0YXRpb25NZXRhZGF0YSh0aGlzLmN1cnJlbnRVc2VyLCBlLCB0LCBuKSwgaSA9IGNyZWF0ZVdlYlN0b3JhZ2VNdXRhdGlvbkJhdGNoS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIHRoaXMuY3VycmVudFVzZXIsIGUpO1xuICAgICAgICB0aGlzLnNldEl0ZW0oaSwgci5WcygpKTtcbiAgICB9XG4gICAgUXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gY3JlYXRlV2ViU3RvcmFnZU11dGF0aW9uQmF0Y2hLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgdGhpcy5jdXJyZW50VXNlciwgZSk7XG4gICAgICAgIHRoaXMucmVtb3ZlSXRlbSh0KTtcbiAgICB9XG4gICAgVXMoZSkge1xuICAgICAgICBjb25zdCB0ID0ge1xuICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMucHMsXG4gICAgICAgICAgICBvbmxpbmVTdGF0ZTogZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN0b3JhZ2Uuc2V0SXRlbSh0aGlzLnhzLCBKU09OLnN0cmluZ2lmeSh0KSk7XG4gICAgfVxuICAgICRzKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IGNyZWF0ZVdlYlN0b3JhZ2VRdWVyeVRhcmdldE1ldGFkYXRhS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIGUpLCBpID0gbmV3IF9fUFJJVkFURV9RdWVyeVRhcmdldE1ldGFkYXRhKGUsIHQsIG4pO1xuICAgICAgICB0aGlzLnNldEl0ZW0ociwgaS5WcygpKTtcbiAgICB9XG4gICAgV3MoZSkge1xuICAgICAgICBjb25zdCB0ID0gSlNPTi5zdHJpbmdpZnkoQXJyYXkuZnJvbShlKSk7XG4gICAgICAgIHRoaXMuc2V0SXRlbSh0aGlzLk9zLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgY2xpZW50IHN0YXRlIGtleSBpbiBXZWJTdG9yYWdlLiBSZXR1cm5zIG51bGwgaWYgdGhlIGtleSBkb2VzIG5vdFxuICAgICAqIG1hdGNoIHRoZSBleHBlY3RlZCBrZXkgZm9ybWF0LlxuICAgICAqLyAgICBHcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLkNzLmV4ZWMoZSk7XG4gICAgICAgIHJldHVybiB0ID8gdFsxXSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIGNsaWVudCBzdGF0ZSBpbiBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWUgY291bGQgbm90XG4gICAgICogYmUgcGFyc2VkLlxuICAgICAqLyAgICBqcyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLkdzKGUpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX1JlbW90ZUNsaWVudFN0YXRlLlJzKG4sIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBtdXRhdGlvbiBiYXRjaCBzdGF0ZSBpbiBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWVcbiAgICAgKiBjb3VsZCBub3QgYmUgcGFyc2VkLlxuICAgICAqLyAgICBIcyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLkZzLmV4ZWMoZSksIHIgPSBOdW1iZXIoblsxXSksIGkgPSB2b2lkIDAgIT09IG5bMl0gPyBuWzJdIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9NdXRhdGlvbk1ldGFkYXRhLlJzKG5ldyBVc2VyKGkpLCByLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgcXVlcnkgdGFyZ2V0IHN0YXRlIGZyb20gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlXG4gICAgICogY291bGQgbm90IGJlIHBhcnNlZC5cbiAgICAgKi8gICAgWXMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5Ncy5leGVjKGUpLCByID0gTnVtYmVyKG5bMV0pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX1F1ZXJ5VGFyZ2V0TWV0YWRhdGEuUnMociwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhbiBvbmxpbmUgc3RhdGUgZnJvbSBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWVcbiAgICAgKiBjb3VsZCBub3QgYmUgcGFyc2VkLlxuICAgICAqLyAgICBMcyhlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfU2hhcmVkT25saW5lU3RhdGUuUnMoZSk7XG4gICAgfVxuICAgIFhzKGUpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZSk7XG4gICAgfVxuICAgIGFzeW5jIEpzKGUpIHtcbiAgICAgICAgaWYgKGUudXNlci51aWQgPT09IHRoaXMuY3VycmVudFVzZXIudWlkKSByZXR1cm4gdGhpcy5zeW5jRW5naW5lLm5vKGUuYmF0Y2hJZCwgZS5zdGF0ZSwgZS5lcnJvcik7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIGBJZ25vcmluZyBtdXRhdGlvbiBmb3Igbm9uLWFjdGl2ZSB1c2VyICR7ZS51c2VyLnVpZH1gKTtcbiAgICB9XG4gICAgWnMoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zeW5jRW5naW5lLnJvKGUudGFyZ2V0SWQsIGUuc3RhdGUsIGUuZXJyb3IpO1xuICAgIH1cbiAgICB6cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0ID8gdGhpcy5Tcy5pbnNlcnQoZSwgdCkgOiB0aGlzLlNzLnJlbW92ZShlKSwgciA9IHRoaXMua3ModGhpcy5TcyksIGkgPSB0aGlzLmtzKG4pLCBzID0gW10sIG8gPSBbXTtcbiAgICAgICAgcmV0dXJuIGkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICByLmhhcyhlKSB8fCBzLnB1c2goZSk7XG4gICAgICAgIH0pKSwgci5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIGkuaGFzKGUpIHx8IG8ucHVzaChlKTtcbiAgICAgICAgfSkpLCB0aGlzLnN5bmNFbmdpbmUuaW8ocywgbykudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5TcyA9IG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgQnMoZSkge1xuICAgICAgICAvLyBXZSBjaGVjayB3aGV0aGVyIHRoZSBjbGllbnQgdGhhdCB3cm90ZSB0aGlzIG9ubGluZSBzdGF0ZSBpcyBzdGlsbCBhY3RpdmVcbiAgICAgICAgLy8gYnkgY29tcGFyaW5nIGl0cyBjbGllbnQgSUQgdG8gdGhlIGxpc3Qgb2YgY2xpZW50cyBrZXB0IGFjdGl2ZSBpblxuICAgICAgICAvLyBJbmRleGVkRGIuIElmIGEgY2xpZW50IGRvZXMgbm90IHVwZGF0ZSB0aGVpciBJbmRleGVkRGIgY2xpZW50IHN0YXRlXG4gICAgICAgIC8vIHdpdGhpbiA1IHNlY29uZHMsIGl0IGlzIGNvbnNpZGVyZWQgaW5hY3RpdmUgYW5kIHdlIGRvbid0IGVtaXQgYW4gb25saW5lXG4gICAgICAgIC8vIHN0YXRlIGV2ZW50LlxuICAgICAgICB0aGlzLlNzLmdldChlLmNsaWVudElkKSAmJiB0aGlzLm9ubGluZVN0YXRlSGFuZGxlcihlLm9ubGluZVN0YXRlKTtcbiAgICB9XG4gICAga3MoZSkge1xuICAgICAgICBsZXQgdCA9IF9fUFJJVkFURV90YXJnZXRJZFNldCgpO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgdCA9IHQudW5pb25XaXRoKG4uYWN0aXZlVGFyZ2V0SWRzKTtcbiAgICAgICAgfSkpLCB0O1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX01lbW9yeVNoYXJlZENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5zbyA9IG5ldyBfX1BSSVZBVEVfTG9jYWxDbGllbnRTdGF0ZSwgdGhpcy5vbyA9IHt9LCB0aGlzLm9ubGluZVN0YXRlSGFuZGxlciA9IG51bGwsIFxuICAgICAgICB0aGlzLnNlcXVlbmNlTnVtYmVySGFuZGxlciA9IG51bGw7XG4gICAgfVxuICAgIGFkZFBlbmRpbmdNdXRhdGlvbihlKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICB1cGRhdGVNdXRhdGlvblN0YXRlKGUsIHQsIG4pIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIGFkZExvY2FsUXVlcnlUYXJnZXQoZSwgdCA9ICEwKSB7XG4gICAgICAgIHJldHVybiB0ICYmIHRoaXMuc28uZnMoZSksIHRoaXMub29bZV0gfHwgXCJub3QtY3VycmVudFwiO1xuICAgIH1cbiAgICB1cGRhdGVRdWVyeVN0YXRlKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5vb1tlXSA9IHQ7XG4gICAgfVxuICAgIHJlbW92ZUxvY2FsUXVlcnlUYXJnZXQoZSkge1xuICAgICAgICB0aGlzLnNvLmdzKGUpO1xuICAgIH1cbiAgICBpc0xvY2FsUXVlcnlUYXJnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zby5hY3RpdmVUYXJnZXRJZHMuaGFzKGUpO1xuICAgIH1cbiAgICBjbGVhclF1ZXJ5U3RhdGUoZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5vb1tlXTtcbiAgICB9XG4gICAgZ2V0QWxsQWN0aXZlUXVlcnlUYXJnZXRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zby5hY3RpdmVUYXJnZXRJZHM7XG4gICAgfVxuICAgIGlzQWN0aXZlUXVlcnlUYXJnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zby5hY3RpdmVUYXJnZXRJZHMuaGFzKGUpO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc28gPSBuZXcgX19QUklWQVRFX0xvY2FsQ2xpZW50U3RhdGUsIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBoYW5kbGVVc2VyQ2hhbmdlKGUsIHQsIG4pIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIHNldE9ubGluZVN0YXRlKGUpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIHNodXRkb3duKCkge31cbiAgICB3cml0ZVNlcXVlbmNlTnVtYmVyKGUpIHt9XG4gICAgbm90aWZ5QnVuZGxlTG9hZGVkKGUpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTm9vcENvbm5lY3Rpdml0eU1vbml0b3Ige1xuICAgIF9vKGUpIHtcbiAgICAgICAgLy8gTm8tb3AuXG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICAvLyBOby1vcC5cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBSZWZlcmVuY2VzIHRvIGB3aW5kb3dgIGFyZSBndWFyZGVkIGJ5IEJyb3dzZXJDb25uZWN0aXZpdHlNb25pdG9yLmlzQXZhaWxhYmxlKClcbi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscyAqL1xuLyoqXG4gKiBCcm93c2VyIGltcGxlbWVudGF0aW9uIG9mIENvbm5lY3Rpdml0eU1vbml0b3IuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9Ccm93c2VyQ29ubmVjdGl2aXR5TW9uaXRvciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYW8gPSAoKSA9PiB0aGlzLnVvKCksIHRoaXMuY28gPSAoKSA9PiB0aGlzLmxvKCksIHRoaXMuaG8gPSBbXSwgdGhpcy5QbygpO1xuICAgIH1cbiAgICBfbyhlKSB7XG4gICAgICAgIHRoaXMuaG8ucHVzaChlKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwib25saW5lXCIsIHRoaXMuYW8pLCB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9mZmxpbmVcIiwgdGhpcy5jbyk7XG4gICAgfVxuICAgIFBvKCkge1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCB0aGlzLmFvKSwgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIHRoaXMuY28pO1xuICAgIH1cbiAgICB1bygpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiQ29ubmVjdGl2aXR5TW9uaXRvclwiLCBcIk5ldHdvcmsgY29ubmVjdGl2aXR5IGNoYW5nZWQ6IEFWQUlMQUJMRVwiKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuaG8pIGUoMCAvKiBOZXR3b3JrU3RhdHVzLkFWQUlMQUJMRSAqLyk7XG4gICAgfVxuICAgIGxvKCkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJDb25uZWN0aXZpdHlNb25pdG9yXCIsIFwiTmV0d29yayBjb25uZWN0aXZpdHkgY2hhbmdlZDogVU5BVkFJTEFCTEVcIik7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLmhvKSBlKDEgLyogTmV0d29ya1N0YXR1cy5VTkFWQUlMQUJMRSAqLyk7XG4gICAgfVxuICAgIC8vIFRPRE8oY2hlbmJyaWFuKTogQ29uc2lkZXIgcGFzc2luZyBpbiB3aW5kb3cgZWl0aGVyIGludG8gdGhpcyBjb21wb25lbnQgb3JcbiAgICAvLyBoZXJlIGZvciB0ZXN0aW5nIHZpYSBGYWtlV2luZG93LlxuICAgIC8qKiBDaGVja3MgdGhhdCBhbGwgdXNlZCBhdHRyaWJ1dGVzIG9mIHdpbmRvdyBhcmUgYXZhaWxhYmxlLiAqL1xuICAgIHN0YXRpYyBEKCkge1xuICAgICAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2Ygd2luZG93ICYmIHZvaWQgMCAhPT0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgJiYgdm9pZCAwICE9PSB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSB2YWx1ZSByZXR1cm5lZCBmcm9tIHRoZSBtb3N0IHJlY2VudCBpbnZvY2F0aW9uIG9mXG4gKiBgZ2VuZXJhdGVVbmlxdWVEZWJ1Z0lkKClgLCBvciBudWxsIGlmIGl0IGhhcyBuZXZlciBiZWVuIGludm9rZWQuXG4gKi8gbGV0IG1lID0gbnVsbDtcblxuLyoqXG4gKiBHZW5lcmF0ZXMgYW5kIHJldHVybnMgYW4gaW5pdGlhbCB2YWx1ZSBmb3IgYGxhc3RVbmlxdWVEZWJ1Z0lkYC5cbiAqXG4gKiBUaGUgcmV0dXJuZWQgdmFsdWUgaXMgcmFuZG9tbHkgc2VsZWN0ZWQgZnJvbSBhIHJhbmdlIG9mIGludGVnZXJzIHRoYXQgYXJlXG4gKiByZXByZXNlbnRlZCBhcyA4IGhleGFkZWNpbWFsIGRpZ2l0cy4gVGhpcyBtZWFucyB0aGF0ICh3aXRoaW4gcmVhc29uKSBhbnlcbiAqIG51bWJlcnMgZ2VuZXJhdGVkIGJ5IGluY3JlbWVudGluZyB0aGUgcmV0dXJuZWQgbnVtYmVyIGJ5IDEgd2lsbCBhbHNvIGJlXG4gKiByZXByZXNlbnRlZCBieSA4IGhleGFkZWNpbWFsIGRpZ2l0cy4gVGhpcyBsZWFkcyB0byBhbGwgXCJJRHNcIiBoYXZpbmcgdGhlIHNhbWVcbiAqIGxlbmd0aCB3aGVuIGNvbnZlcnRlZCB0byBhIGhleGFkZWNpbWFsIHN0cmluZywgbWFraW5nIHJlYWRpbmcgbG9ncyBjb250YWluaW5nXG4gKiB0aGVzZSBJRHMgZWFzaWVyIHRvIGZvbGxvdy4gQW5kIHNpbmNlIHRoZSByZXR1cm4gdmFsdWUgaXMgcmFuZG9tbHkgc2VsZWN0ZWRcbiAqIGl0IHdpbGwgaGVscCB0byBkaWZmZXJlbnRpYXRlIGJldHdlZW4gbG9ncyBmcm9tIGRpZmZlcmVudCBleGVjdXRpb25zLlxuICovXG4vKipcbiAqIEdlbmVyYXRlcyBhbmQgcmV0dXJucyBhIHVuaXF1ZSBJRCBhcyBhIGhleGFkZWNpbWFsIHN0cmluZy5cbiAqXG4gKiBUaGUgcmV0dXJuZWQgSUQgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBpbiBkZWJ1ZyBsb2dnaW5nIG1lc3NhZ2VzIHRvIGhlbHBcbiAqIGNvcnJlbGF0ZSBsb2cgbWVzc2FnZXMgdGhhdCBtYXkgYmUgc3BhdGlhbGx5IHNlcGFyYXRlZCBpbiB0aGUgbG9ncywgYnV0XG4gKiBsb2dpY2FsbHkgcmVsYXRlZC4gRm9yIGV4YW1wbGUsIGEgbmV0d29yayBjb25uZWN0aW9uIGNvdWxkIGluY2x1ZGUgdGhlIHNhbWVcbiAqIFwiZGVidWcgSURcIiBzdHJpbmcgaW4gYWxsIG9mIGl0cyBsb2cgbWVzc2FnZXMgdG8gaGVscCB0cmFjZSBhIHNwZWNpZmljXG4gKiBjb25uZWN0aW9uIG92ZXIgdGltZS5cbiAqXG4gKiBAcmV0dXJuIHRoZSAxMC1jaGFyYWN0ZXIgZ2VuZXJhdGVkIElEIChlLmcuIFwiMHhhMWIyYzNkNFwiKS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2dlbmVyYXRlVW5pcXVlRGVidWdJZCgpIHtcbiAgICByZXR1cm4gbnVsbCA9PT0gbWUgPyBtZSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9nZW5lcmF0ZUluaXRpYWxVbmlxdWVEZWJ1Z0lkKCkge1xuICAgICAgICByZXR1cm4gMjY4NDM1NDU2ICsgTWF0aC5yb3VuZCgyMTQ3NDgzNjQ4ICogTWF0aC5yYW5kb20oKSk7XG4gICAgfSgpIDogbWUrKywgXCIweFwiICsgbWUudG9TdHJpbmcoMTYpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBmZSA9IHtcbiAgICBCYXRjaEdldERvY3VtZW50czogXCJiYXRjaEdldFwiLFxuICAgIENvbW1pdDogXCJjb21taXRcIixcbiAgICBSdW5RdWVyeTogXCJydW5RdWVyeVwiLFxuICAgIFJ1bkFnZ3JlZ2F0aW9uUXVlcnk6IFwicnVuQWdncmVnYXRpb25RdWVyeVwiXG59O1xuXG4vKipcbiAqIE1hcHMgUlBDIG5hbWVzIHRvIHRoZSBjb3JyZXNwb25kaW5nIFJFU1QgZW5kcG9pbnQgbmFtZS5cbiAqXG4gKiBXZSB1c2UgYXJyYXkgbm90YXRpb24gdG8gYXZvaWQgbWFuZ2xpbmcuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFByb3ZpZGVzIGEgc2ltcGxlIGhlbHBlciBjbGFzcyB0aGF0IGltcGxlbWVudHMgdGhlIFN0cmVhbSBpbnRlcmZhY2UgdG9cbiAqIGJyaWRnZSB0byBvdGhlciBpbXBsZW1lbnRhdGlvbnMgdGhhdCBhcmUgc3RyZWFtcyBidXQgZG8gbm90IGltcGxlbWVudCB0aGVcbiAqIGludGVyZmFjZS4gVGhlIHN0cmVhbSBjYWxsYmFja3MgYXJlIGludm9rZWQgd2l0aCB0aGUgY2FsbE9uLi4uIG1ldGhvZHMuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9TdHJlYW1CcmlkZ2Uge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5JbyA9IGUuSW8sIHRoaXMuVG8gPSBlLlRvO1xuICAgIH1cbiAgICBFbyhlKSB7XG4gICAgICAgIHRoaXMuQW8gPSBlO1xuICAgIH1cbiAgICBSbyhlKSB7XG4gICAgICAgIHRoaXMuVm8gPSBlO1xuICAgIH1cbiAgICBtbyhlKSB7XG4gICAgICAgIHRoaXMuZm8gPSBlO1xuICAgIH1cbiAgICBvbk1lc3NhZ2UoZSkge1xuICAgICAgICB0aGlzLnBvID0gZTtcbiAgICB9XG4gICAgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMuVG8oKTtcbiAgICB9XG4gICAgc2VuZChlKSB7XG4gICAgICAgIHRoaXMuSW8oZSk7XG4gICAgfVxuICAgIHlvKCkge1xuICAgICAgICB0aGlzLkFvKCk7XG4gICAgfVxuICAgIHdvKCkge1xuICAgICAgICB0aGlzLlZvKCk7XG4gICAgfVxuICAgIFNvKGUpIHtcbiAgICAgICAgdGhpcy5mbyhlKTtcbiAgICB9XG4gICAgYm8oZSkge1xuICAgICAgICB0aGlzLnBvKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgZ2UgPSBcIldlYkNoYW5uZWxDb25uZWN0aW9uXCI7XG5cbmNsYXNzIF9fUFJJVkFURV9XZWJDaGFubmVsQ29ubmVjdGlvbiBleHRlbmRzIFxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBhbGwgUmVzdC1iYXNlZCBjb25uZWN0aW9ucyB0byB0aGUgYmFja2VuZCAoV2ViQ2hhbm5lbCBhbmRcbiAqIEhUVFApLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfUmVzdENvbm5lY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUluZm8gPSBlLCB0aGlzLmRhdGFiYXNlSWQgPSBlLmRhdGFiYXNlSWQ7XG4gICAgICAgIGNvbnN0IHQgPSBlLnNzbCA/IFwiaHR0cHNcIiA6IFwiaHR0cFwiLCBuID0gZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuZGF0YWJhc2VJZC5wcm9qZWN0SWQpLCByID0gZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuZGF0YWJhc2VJZC5kYXRhYmFzZSk7XG4gICAgICAgIHRoaXMuRG8gPSB0ICsgXCI6Ly9cIiArIGUuaG9zdCwgdGhpcy52byA9IGBwcm9qZWN0cy8ke259L2RhdGFiYXNlcy8ke3J9YCwgdGhpcy5DbyA9IFwiKGRlZmF1bHQpXCIgPT09IHRoaXMuZGF0YWJhc2VJZC5kYXRhYmFzZSA/IGBwcm9qZWN0X2lkPSR7bn1gIDogYHByb2plY3RfaWQ9JHtufSZkYXRhYmFzZV9pZD0ke3J9YDtcbiAgICB9XG4gICAgZ2V0IEZvKCkge1xuICAgICAgICAvLyBCb3RoIGBpbnZva2VSUEMoKWAgYW5kIGBpbnZva2VTdHJlYW1pbmdSUEMoKWAgdXNlIHRoZWlyIGBwYXRoYCBhcmd1bWVudHMgdG8gZGV0ZXJtaW5lXG4gICAgICAgIC8vIHdoZXJlIHRvIHJ1biB0aGUgcXVlcnksIGFuZCBleHBlY3QgdGhlIGByZXF1ZXN0YCB0byBOT1Qgc3BlY2lmeSB0aGUgXCJwYXRoXCIuXG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgTW8oZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX2dlbmVyYXRlVW5pcXVlRGVidWdJZCgpLCBvID0gdGhpcy54byhlLCB0LnRvVXJpRW5jb2RlZFN0cmluZygpKTtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiUmVzdENvbm5lY3Rpb25cIiwgYFNlbmRpbmcgUlBDICcke2V9JyAke3N9OmAsIG8sIG4pO1xuICAgICAgICBjb25zdCBfID0ge1xuICAgICAgICAgICAgXCJnb29nbGUtY2xvdWQtcmVzb3VyY2UtcHJlZml4XCI6IHRoaXMudm8sXG4gICAgICAgICAgICBcIngtZ29vZy1yZXF1ZXN0LXBhcmFtc1wiOiB0aGlzLkNvXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLk9vKF8sIHIsIGkpLCB0aGlzLk5vKGUsIG8sIF8sIG4pLnRoZW4oKHQgPT4gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlJlc3RDb25uZWN0aW9uXCIsIGBSZWNlaXZlZCBSUEMgJyR7ZX0nICR7c306IGAsIHQpLCBcbiAgICAgICAgdCkpLCAodCA9PiB7XG4gICAgICAgICAgICB0aHJvdyBfX1BSSVZBVEVfbG9nV2FybihcIlJlc3RDb25uZWN0aW9uXCIsIGBSUEMgJyR7ZX0nICR7c30gZmFpbGVkIHdpdGggZXJyb3I6IGAsIHQsIFwidXJsOiBcIiwgbywgXCJyZXF1ZXN0OlwiLCBuKSwgXG4gICAgICAgICAgICB0O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIExvKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgLy8gVGhlIFJFU1QgQVBJIGF1dG9tYXRpY2FsbHkgYWdncmVnYXRlcyBhbGwgb2YgdGhlIHN0cmVhbWVkIHJlc3VsdHMsIHNvIHdlXG4gICAgICAgIC8vIGNhbiBqdXN0IHVzZSB0aGUgbm9ybWFsIGludm9rZSgpIG1ldGhvZC5cbiAgICAgICAgcmV0dXJuIHRoaXMuTW8oZSwgdCwgbiwgciwgaSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1vZGlmaWVzIHRoZSBoZWFkZXJzIGZvciBhIHJlcXVlc3QsIGFkZGluZyBhbnkgYXV0aG9yaXphdGlvbiB0b2tlbiBpZlxuICAgICAqIHByZXNlbnQgYW5kIGFueSBhZGRpdGlvbmFsIGhlYWRlcnMgZm9yIHRoZSByZXF1ZXN0LlxuICAgICAqLyAgICBPbyhlLCB0LCBuKSB7XG4gICAgICAgIGVbXCJYLUdvb2ctQXBpLUNsaWVudFwiXSA9IFxuICAgICAgICAvLyBTREtfVkVSU0lPTiBpcyB1cGRhdGVkIHRvIGRpZmZlcmVudCB2YWx1ZSBhdCBydW50aW1lIGRlcGVuZGluZyBvbiB0aGUgZW50cnkgcG9pbnQsXG4gICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gZ2V0IGl0cyB2YWx1ZSB3aGVuIHdlIG5lZWQgaXQgaW4gYSBmdW5jdGlvbi5cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2dldEdvb2dBcGlDbGllbnRWYWx1ZSgpIHtcbiAgICAgICAgICAgIHJldHVybiBcImdsLWpzLyBmaXJlL1wiICsgUztcbiAgICAgICAgfSgpLCBcbiAgICAgICAgLy8gQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluIHdpbGwgYXZvaWQgcHJlZmxpZ2h0IHJlcXVlc3RzIHdoaWNoIG1pZ2h0XG4gICAgICAgIC8vIG1lc3Mgd2l0aCBDT1JTIGFuZCByZWRpcmVjdHMgYnkgcHJveGllcy4gSWYgd2UgYWRkIGN1c3RvbSBoZWFkZXJzXG4gICAgICAgIC8vIHdlIHdpbGwgbmVlZCB0byBjaGFuZ2UgdGhpcyBjb2RlIHRvIHBvdGVudGlhbGx5IHVzZSB0aGUgJGh0dHBPdmVyd3JpdGVcbiAgICAgICAgLy8gcGFyYW1ldGVyIHN1cHBvcnRlZCBieSBFU0YgdG8gYXZvaWQgdHJpZ2dlcmluZyBwcmVmbGlnaHQgcmVxdWVzdHMuXG4gICAgICAgIGVbXCJDb250ZW50LVR5cGVcIl0gPSBcInRleHQvcGxhaW5cIiwgdGhpcy5kYXRhYmFzZUluZm8uYXBwSWQgJiYgKGVbXCJYLUZpcmViYXNlLUdNUElEXCJdID0gdGhpcy5kYXRhYmFzZUluZm8uYXBwSWQpLCBcbiAgICAgICAgdCAmJiB0LmhlYWRlcnMuZm9yRWFjaCgoKHQsIG4pID0+IGVbbl0gPSB0KSksIG4gJiYgbi5oZWFkZXJzLmZvckVhY2goKCh0LCBuKSA9PiBlW25dID0gdCkpO1xuICAgIH1cbiAgICB4byhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBmZVtlXTtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuRG99L3YxLyR7dH06JHtufWA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsb3NlcyBhbmQgY2xlYW5zIHVwIGFueSByZXNvdXJjZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBjb25uZWN0aW9uLiBUaGlzXG4gICAgICogaW1wbGVtZW50YXRpb24gaXMgYSBuby1vcCBiZWNhdXNlIHRoZXJlIGFyZSBubyByZXNvdXJjZXMgYXNzb2NpYXRlZFxuICAgICAqIHdpdGggdGhlIFJlc3RDb25uZWN0aW9uIHRoYXQgbmVlZCB0byBiZSBjbGVhbmVkIHVwLlxuICAgICAqLyAgICB0ZXJtaW5hdGUoKSB7XG4gICAgICAgIC8vIE5vLW9wXG4gICAgfVxufSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcihlKSwgdGhpcy5mb3JjZUxvbmdQb2xsaW5nID0gZS5mb3JjZUxvbmdQb2xsaW5nLCB0aGlzLmF1dG9EZXRlY3RMb25nUG9sbGluZyA9IGUuYXV0b0RldGVjdExvbmdQb2xsaW5nLCBcbiAgICAgICAgdGhpcy51c2VGZXRjaFN0cmVhbXMgPSBlLnVzZUZldGNoU3RyZWFtcywgdGhpcy5sb25nUG9sbGluZ09wdGlvbnMgPSBlLmxvbmdQb2xsaW5nT3B0aW9ucztcbiAgICB9XG4gICAgTm8oZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2dlbmVyYXRlVW5pcXVlRGVidWdJZCgpO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKChzLCBvKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBfID0gbmV3IFhocklvO1xuICAgICAgICAgICAgXy5zZXRXaXRoQ3JlZGVudGlhbHMoITApLCBfLmxpc3Rlbk9uY2UoRXZlbnRUeXBlLkNPTVBMRVRFLCAoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoXy5nZXRMYXN0RXJyb3JDb2RlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVycm9yQ29kZS5OT19FUlJPUjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfLmdldFJlc3BvbnNlSnNvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgWEhSIGZvciBSUEMgJyR7ZX0nICR7aX0gcmVjZWl2ZWQ6YCwgSlNPTi5zdHJpbmdpZnkodCkpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHModCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRXJyb3JDb2RlLlRJTUVPVVQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoZ2UsIGBSUEMgJyR7ZX0nICR7aX0gdGltZWQgb3V0YCksIG8obmV3IEZpcmVzdG9yZUVycm9yKEQuREVBRExJTkVfRVhDRUVERUQsIFwiUmVxdWVzdCB0aW1lIG91dFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRXJyb3JDb2RlLkhUVFBfRVJST1I6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gXy5nZXRTdGF0dXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfbG9nRGVidWcoZ2UsIGBSUEMgJyR7ZX0nICR7aX0gZmFpbGVkIHdpdGggc3RhdHVzOmAsIG4sIFwicmVzcG9uc2UgdGV4dDpcIiwgXy5nZXRSZXNwb25zZVRleHQoKSksIFxuICAgICAgICAgICAgICAgICAgICAgICAgbiA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZSA9IF8uZ2V0UmVzcG9uc2VKc29uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkuaXNBcnJheShlKSAmJiAoZSA9IGVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBudWxsID09IGUgPyB2b2lkIDAgOiBlLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIHQuc3RhdHVzICYmIHQubWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gZnVuY3Rpb24gX19QUklWQVRFX21hcENvZGVGcm9tSHR0cFJlc3BvbnNlRXJyb3JTdGF0dXMoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9fL2csIFwiLVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKEQpLmluZGV4T2YodCkgPj0gMCA/IHQgOiBELlVOS05PV047XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0odC5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvKG5ldyBGaXJlc3RvcmVFcnJvcihlLCB0Lm1lc3NhZ2UpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgbyhuZXcgRmlyZXN0b3JlRXJyb3IoRC5VTktOT1dOLCBcIlNlcnZlciByZXNwb25kZWQgd2l0aCBzdGF0dXMgXCIgKyBfLmdldFN0YXR1cygpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSByZWNlaXZlZCBhbiBIVFRQX0VSUk9SIGJ1dCB0aGVyZSdzIG5vIHN0YXR1cyBjb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQncyBtb3N0IHByb2JhYmx5IGEgY29ubmVjdGlvbiBpc3N1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgbyhuZXcgRmlyZXN0b3JlRXJyb3IoRC5VTkFWQUlMQUJMRSwgXCJDb25uZWN0aW9uIGZhaWxlZC5cIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgUlBDICcke2V9JyAke2l9IGNvbXBsZXRlZC5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCBhID0gSlNPTi5zdHJpbmdpZnkocik7XG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoZ2UsIGBSUEMgJyR7ZX0nICR7aX0gc2VuZGluZyByZXF1ZXN0OmAsIHIpLCBfLnNlbmQodCwgXCJQT1NUXCIsIGEsIG4sIDE1KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBCbyhlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZ2VuZXJhdGVVbmlxdWVEZWJ1Z0lkKCksIGkgPSBbIHRoaXMuRG8sIFwiL1wiLCBcImdvb2dsZS5maXJlc3RvcmUudjEuRmlyZXN0b3JlXCIsIFwiL1wiLCBlLCBcIi9jaGFubmVsXCIgXSwgcyA9IGNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQoKSwgbyA9IGdldFN0YXRFdmVudFRhcmdldCgpLCBfID0ge1xuICAgICAgICAgICAgLy8gUmVxdWlyZWQgZm9yIGJhY2tlbmQgc3RpY2tpbmVzcywgcm91dGluZyBiZWhhdmlvciBpcyBiYXNlZCBvbiB0aGlzXG4gICAgICAgICAgICAvLyBwYXJhbWV0ZXIuXG4gICAgICAgICAgICBodHRwU2Vzc2lvbklkUGFyYW06IFwiZ3Nlc3Npb25pZFwiLFxuICAgICAgICAgICAgaW5pdE1lc3NhZ2VIZWFkZXJzOiB7fSxcbiAgICAgICAgICAgIG1lc3NhZ2VVcmxQYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHBhcmFtIGlzIHVzZWQgdG8gaW1wcm92ZSByb3V0aW5nIGFuZCBwcm9qZWN0IGlzb2xhdGlvbiBieSB0aGVcbiAgICAgICAgICAgICAgICAvLyBiYWNrZW5kIGFuZCBtdXN0IGJlIGluY2x1ZGVkIGluIGV2ZXJ5IHJlcXVlc3QuXG4gICAgICAgICAgICAgICAgZGF0YWJhc2U6IGBwcm9qZWN0cy8ke3RoaXMuZGF0YWJhc2VJZC5wcm9qZWN0SWR9L2RhdGFiYXNlcy8ke3RoaXMuZGF0YWJhc2VJZC5kYXRhYmFzZX1gXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VuZFJhd0pzb246ICEwLFxuICAgICAgICAgICAgc3VwcG9ydHNDcm9zc0RvbWFpblhocjogITAsXG4gICAgICAgICAgICBpbnRlcm5hbENoYW5uZWxQYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAvLyBPdmVycmlkZSB0aGUgZGVmYXVsdCB0aW1lb3V0IChyYW5kb21pemVkIGJldHdlZW4gMTAtMjAgc2Vjb25kcykgc2luY2VcbiAgICAgICAgICAgICAgICAvLyBhIGxhcmdlIHdyaXRlIGJhdGNoIG9uIGEgc2xvdyBpbnRlcm5ldCBjb25uZWN0aW9uIG1heSB0YWtlIGEgbG9uZ1xuICAgICAgICAgICAgICAgIC8vIHRpbWUgdG8gc2VuZCB0byB0aGUgYmFja2VuZC4gUmF0aGVyIHRoYW4gaGF2ZSBXZWJDaGFubmVsIGltcG9zZSBhXG4gICAgICAgICAgICAgICAgLy8gdGlnaHQgdGltZW91dCB3aGljaCBjb3VsZCBsZWFkIHRvIGluZmluaXRlIHRpbWVvdXRzIGFuZCByZXRyaWVzLCB3ZVxuICAgICAgICAgICAgICAgIC8vIHNldCBpdCB2ZXJ5IGxhcmdlICg1LTEwIG1pbnV0ZXMpIGFuZCByZWx5IG9uIHRoZSBicm93c2VyJ3MgYnVpbHRpblxuICAgICAgICAgICAgICAgIC8vIHRpbWVvdXRzIHRvIGtpY2sgaW4gaWYgdGhlIHJlcXVlc3QgaXNuJ3Qgd29ya2luZy5cbiAgICAgICAgICAgICAgICBmb3J3YXJkQ2hhbm5lbFJlcXVlc3RUaW1lb3V0TXM6IDZlNVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZvcmNlTG9uZ1BvbGxpbmc6IHRoaXMuZm9yY2VMb25nUG9sbGluZyxcbiAgICAgICAgICAgIGRldGVjdEJ1ZmZlcmluZ1Byb3h5OiB0aGlzLmF1dG9EZXRlY3RMb25nUG9sbGluZ1xuICAgICAgICB9LCBhID0gdGhpcy5sb25nUG9sbGluZ09wdGlvbnMudGltZW91dFNlY29uZHM7XG4gICAgICAgIHZvaWQgMCAhPT0gYSAmJiAoXy5sb25nUG9sbGluZ1RpbWVvdXQgPSBNYXRoLnJvdW5kKDFlMyAqIGEpKSwgdGhpcy51c2VGZXRjaFN0cmVhbXMgJiYgKF8udXNlRmV0Y2hTdHJlYW1zID0gITApLCBcbiAgICAgICAgdGhpcy5PbyhfLmluaXRNZXNzYWdlSGVhZGVycywgdCwgbiksIFxuICAgICAgICAvLyBTZW5kaW5nIHRoZSBjdXN0b20gaGVhZGVycyB3ZSBqdXN0IGFkZGVkIHRvIHJlcXVlc3QuaW5pdE1lc3NhZ2VIZWFkZXJzXG4gICAgICAgIC8vIChBdXRob3JpemF0aW9uLCBldGMuKSB3aWxsIHRyaWdnZXIgdGhlIGJyb3dzZXIgdG8gbWFrZSBhIENPUlMgcHJlZmxpZ2h0XG4gICAgICAgIC8vIHJlcXVlc3QgYmVjYXVzZSB0aGUgWEhSIHdpbGwgbm8gbG9uZ2VyIG1lZXQgdGhlIGNyaXRlcmlhIGZvciBhIFwic2ltcGxlXCJcbiAgICAgICAgLy8gQ09SUyByZXF1ZXN0OlxuICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9IVFRQL0NPUlMjU2ltcGxlX3JlcXVlc3RzXG4gICAgICAgIC8vIFRoZXJlZm9yZSB0byBhdm9pZCB0aGUgQ09SUyBwcmVmbGlnaHQgcmVxdWVzdCAoYW4gZXh0cmEgbmV0d29ya1xuICAgICAgICAvLyByb3VuZHRyaXApLCB3ZSB1c2UgdGhlIGVuY29kZUluaXRNZXNzYWdlSGVhZGVycyBvcHRpb24gdG8gc3BlY2lmeSB0aGF0XG4gICAgICAgIC8vIHRoZSBoZWFkZXJzIHNob3VsZCBpbnN0ZWFkIGJlIGVuY29kZWQgaW4gdGhlIHJlcXVlc3QncyBQT1NUIHBheWxvYWQsXG4gICAgICAgIC8vIHdoaWNoIGlzIHJlY29nbml6ZWQgYnkgdGhlIHdlYmNoYW5uZWwgYmFja2VuZC5cbiAgICAgICAgXy5lbmNvZGVJbml0TWVzc2FnZUhlYWRlcnMgPSAhMDtcbiAgICAgICAgY29uc3QgdSA9IGkuam9pbihcIlwiKTtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgQ3JlYXRpbmcgUlBDICcke2V9JyBzdHJlYW0gJHtyfTogJHt1fWAsIF8pO1xuICAgICAgICBjb25zdCBjID0gcy5jcmVhdGVXZWJDaGFubmVsKHUsIF8pO1xuICAgICAgICAvLyBXZWJDaGFubmVsIHN1cHBvcnRzIHNlbmRpbmcgdGhlIGZpcnN0IG1lc3NhZ2Ugd2l0aCB0aGUgaGFuZHNoYWtlIC0gc2F2aW5nXG4gICAgICAgIC8vIGEgbmV0d29yayByb3VuZCB0cmlwLiBIb3dldmVyLCBpdCB3aWxsIGhhdmUgdG8gY2FsbCBzZW5kIGluIHRoZSBzYW1lXG4gICAgICAgIC8vIEpTIGV2ZW50IGxvb3AgYXMgb3Blbi4gSW4gb3JkZXIgdG8gZW5mb3JjZSB0aGlzLCB3ZSBkZWxheSBhY3R1YWxseVxuICAgICAgICAvLyBvcGVuaW5nIHRoZSBXZWJDaGFubmVsIHVudGlsIHNlbmQgaXMgY2FsbGVkLiBXaGV0aGVyIHdlIGhhdmUgY2FsbGVkXG4gICAgICAgIC8vIG9wZW4gaXMgdHJhY2tlZCB3aXRoIHRoaXMgdmFyaWFibGUuXG4gICAgICAgICAgICAgICAgbGV0IGwgPSAhMSwgaCA9ICExO1xuICAgICAgICAvLyBBIGZsYWcgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHN0cmVhbSB3YXMgY2xvc2VkIChieSB1cyBvciB0aHJvdWdoIGFuXG4gICAgICAgIC8vIGVycm9yL2Nsb3NlIGV2ZW50KSB0byBhdm9pZCBkZWxpdmVyaW5nIG11bHRpcGxlIGNsb3NlIGV2ZW50cyBvciBzZW5kaW5nXG4gICAgICAgIC8vIG9uIGEgY2xvc2VkIHN0cmVhbVxuICAgICAgICAgICAgICAgIGNvbnN0IFAgPSBuZXcgX19QUklWQVRFX1N0cmVhbUJyaWRnZSh7XG4gICAgICAgICAgICBJbzogdCA9PiB7XG4gICAgICAgICAgICAgICAgaCA/IF9fUFJJVkFURV9sb2dEZWJ1ZyhnZSwgYE5vdCBzZW5kaW5nIGJlY2F1c2UgUlBDICcke2V9JyBzdHJlYW0gJHtyfSBpcyBjbG9zZWQ6YCwgdCkgOiAobCB8fCAoX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgT3BlbmluZyBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHRyYW5zcG9ydC5gKSwgXG4gICAgICAgICAgICAgICAgYy5vcGVuKCksIGwgPSAhMCksIF9fUFJJVkFURV9sb2dEZWJ1ZyhnZSwgYFJQQyAnJHtlfScgc3RyZWFtICR7cn0gc2VuZGluZzpgLCB0KSwgXG4gICAgICAgICAgICAgICAgYy5zZW5kKHQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBUbzogKCkgPT4gYy5jbG9zZSgpXG4gICAgICAgIH0pLCBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4gPSAoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgLy8gVE9ETyhkaW1vbmQpOiBjbG9zdXJlIHR5cGluZyBzZWVtcyBicm9rZW4gYmVjYXVzZSBXZWJDaGFubmVsIGRvZXNcbiAgICAgICAgICAgIC8vIG5vdCBpbXBsZW1lbnQgZ29vZy5ldmVudHMuTGlzdGVuYWJsZVxuICAgICAgICAgICAgZS5saXN0ZW4odCwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIG4oZSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgICAgICAgICB9KSwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBDbG9zdXJlIGV2ZW50cyBhcmUgZ3VhcmRlZCBhbmQgZXhjZXB0aW9ucyBhcmUgc3dhbGxvd2VkLCBzbyBjYXRjaCBhbnlcbiAgICAgICAgLy8gZXhjZXB0aW9uIGFuZCByZXRocm93IHVzaW5nIGEgc2V0VGltZW91dCBzbyB0aGV5IGJlY29tZSB2aXNpYmxlIGFnYWluLlxuICAgICAgICAvLyBOb3RlIHRoYXQgZXZlbnR1YWxseSB0aGlzIGZ1bmN0aW9uIGNvdWxkIGdvIGF3YXkgaWYgd2UgYXJlIGNvbmZpZGVudFxuICAgICAgICAvLyBlbm91Z2ggdGhlIGNvZGUgaXMgZXhjZXB0aW9uIGZyZWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV91bmd1YXJkZWRFdmVudExpc3RlbihjLCBXZWJDaGFubmVsLkV2ZW50VHlwZS5PUEVOLCAoKCkgPT4ge1xuICAgICAgICAgICAgaCB8fCAoX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSB0cmFuc3BvcnQgb3BlbmVkLmApLCBQLnlvKCkpO1xuICAgICAgICB9KSksIF9fUFJJVkFURV91bmd1YXJkZWRFdmVudExpc3RlbihjLCBXZWJDaGFubmVsLkV2ZW50VHlwZS5DTE9TRSwgKCgpID0+IHtcbiAgICAgICAgICAgIGggfHwgKGggPSAhMCwgX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSB0cmFuc3BvcnQgY2xvc2VkYCksIFxuICAgICAgICAgICAgUC5TbygpKTtcbiAgICAgICAgfSkpLCBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4oYywgV2ViQ2hhbm5lbC5FdmVudFR5cGUuRVJST1IsICh0ID0+IHtcbiAgICAgICAgICAgIGggfHwgKGggPSAhMCwgX19QUklWQVRFX2xvZ1dhcm4oZ2UsIGBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHRyYW5zcG9ydCBlcnJvcmVkOmAsIHQpLCBcbiAgICAgICAgICAgIFAuU28obmV3IEZpcmVzdG9yZUVycm9yKEQuVU5BVkFJTEFCTEUsIFwiVGhlIG9wZXJhdGlvbiBjb3VsZCBub3QgYmUgY29tcGxldGVkXCIpKSk7XG4gICAgICAgIH0pKSwgX19QUklWQVRFX3VuZ3VhcmRlZEV2ZW50TGlzdGVuKGMsIFdlYkNoYW5uZWwuRXZlbnRUeXBlLk1FU1NBR0UsICh0ID0+IHtcbiAgICAgICAgICAgIHZhciBuO1xuICAgICAgICAgICAgaWYgKCFoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHQuZGF0YVswXTtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCghIWkpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8oYi8zNTE0Mzg5MSk6IFRoZXJlIGlzIGEgYnVnIGluIE9uZSBQbGF0Zm9ybSB0aGF0IGNhdXNlZCBlcnJvcnNcbiAgICAgICAgICAgICAgICAvLyAoYW5kIG9ubHkgZXJyb3JzKSB0byBiZSB3cmFwcGVkIGluIGFuIGV4dHJhIGFycmF5LiBUbyBiZSBmb3J3YXJkXG4gICAgICAgICAgICAgICAgLy8gY29tcGF0aWJsZSB3aXRoIHRoZSBidWcgd2UgbmVlZCB0byBjaGVjayBlaXRoZXIgY29uZGl0aW9uLiBUaGUgbGF0dGVyXG4gICAgICAgICAgICAgICAgLy8gY2FuIGJlIHJlbW92ZWQgb25jZSB0aGUgZml4IGhhcyBiZWVuIHJvbGxlZCBvdXQuXG4gICAgICAgICAgICAgICAgLy8gVXNlIGFueSBiZWNhdXNlIG1zZ0RhdGEuZXJyb3IgaXMgbm90IHR5cGVkLlxuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBpLCBvID0gcy5lcnJvciB8fCAobnVsbCA9PT0gKG4gPSBzWzBdKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLmVycm9yKTtcbiAgICAgICAgICAgICAgICBpZiAobykge1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoZ2UsIGBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHJlY2VpdmVkIGVycm9yOmAsIG8pO1xuICAgICAgICAgICAgICAgICAgICAvLyBlcnJvci5zdGF0dXMgd2lsbCBiZSBhIHN0cmluZyBsaWtlICdPSycgb3IgJ05PVF9GT1VORCcuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBvLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgbGV0IG4gPSBcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBNYXBzIGFuIGVycm9yIENvZGUgZnJvbSBhIEdSUEMgc3RhdHVzIGlkZW50aWZpZXIgbGlrZSAnTk9UX0ZPVU5EJy5cbiAqXG4gKiBAcmV0dXJucyBUaGUgQ29kZSBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiBzdGF0dXMgc3RyaW5nIG9yIHVuZGVmaW5lZCBpZlxuICogICAgIHRoZXJlIGlzIG5vIG1hdGNoLlxuICovXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9tYXBDb2RlRnJvbVJwY1N0YXR1cyhlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29rdXAgYnkgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IGxlW2VdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCkgcmV0dXJuIF9fUFJJVkFURV9tYXBDb2RlRnJvbVJwY0NvZGUodCk7XG4gICAgICAgICAgICAgICAgICAgIH0odCksIGkgPSBvLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gbiAmJiAobiA9IEQuSU5URVJOQUwsIGkgPSBcIlVua25vd24gZXJyb3Igc3RhdHVzOiBcIiArIHQgKyBcIiB3aXRoIG1lc3NhZ2UgXCIgKyBvLm1lc3NhZ2UpLCBcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBjbG9zZWQgc28gbm8gZnVydGhlciBldmVudHMgYXJlIHByb3BhZ2F0ZWRcbiAgICAgICAgICAgICAgICAgICAgaCA9ICEwLCBQLlNvKG5ldyBGaXJlc3RvcmVFcnJvcihuLCBpKSksIGMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSByZWNlaXZlZDpgLCBpKSwgUC5ibyhpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4obywgRXZlbnQuU1RBVF9FVkVOVCwgKHQgPT4ge1xuICAgICAgICAgICAgdC5zdGF0ID09PSBTdGF0LlBST1hZID8gX19QUklWQVRFX2xvZ0RlYnVnKGdlLCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSBkZXRlY3RlZCBidWZmZXJpbmcgcHJveHlgKSA6IHQuc3RhdCA9PT0gU3RhdC5OT1BST1hZICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhnZSwgYFJQQyAnJHtlfScgc3RyZWFtICR7cn0gZGV0ZWN0ZWQgbm8gYnVmZmVyaW5nIHByb3h5YCk7XG4gICAgICAgIH0pKSwgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gVGVjaG5pY2FsbHkgd2UgY291bGQvc2hvdWxkIHdhaXQgZm9yIHRoZSBXZWJDaGFubmVsIG9wZW5lZCBldmVudCxcbiAgICAgICAgICAgIC8vIGJ1dCBiZWNhdXNlIHdlIHdhbnQgdG8gc2VuZCB0aGUgZmlyc3QgbWVzc2FnZSB3aXRoIHRoZSBXZWJDaGFubmVsXG4gICAgICAgICAgICAvLyBoYW5kc2hha2Ugd2UgcHJldGVuZCB0aGUgY2hhbm5lbCBvcGVuZWQgaGVyZSAoYXN5bmNocm9ub3VzbHkpLCBhbmRcbiAgICAgICAgICAgIC8vIHRoZW4gZGVsYXkgdGhlIGFjdHVhbCBvcGVuIHVudGlsIHRoZSBmaXJzdCBtZXNzYWdlIGlzIHNlbnQuXG4gICAgICAgICAgICBQLndvKCk7XG4gICAgICAgIH0pLCAwKSwgUDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogSW5pdGlhbGl6ZXMgdGhlIFdlYkNoYW5uZWxDb25uZWN0aW9uIGZvciB0aGUgYnJvd3Nlci4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogVGhlIFBsYXRmb3JtJ3MgJ3dpbmRvdycgaW1wbGVtZW50YXRpb24gb3IgbnVsbCBpZiBub3QgYXZhaWxhYmxlLiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2dldFdpbmRvdygpIHtcbiAgICAvLyBgd2luZG93YCBpcyBub3QgYWx3YXlzIGF2YWlsYWJsZSwgZS5nLiBpbiBSZWFjdE5hdGl2ZSBhbmQgV2ViV29ya2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IG51bGw7XG59XG5cbi8qKiBUaGUgUGxhdGZvcm0ncyAnZG9jdW1lbnQnIGltcGxlbWVudGF0aW9uIG9yIG51bGwgaWYgbm90IGF2YWlsYWJsZS4gKi8gZnVuY3Rpb24gZ2V0RG9jdW1lbnQoKSB7XG4gICAgLy8gYGRvY3VtZW50YCBpcyBub3QgYWx3YXlzIGF2YWlsYWJsZSwgZS5nLiBpbiBSZWFjdE5hdGl2ZSBhbmQgV2ViV29ya2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGRvY3VtZW50ID8gZG9jdW1lbnQgOiBudWxsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3U2VyaWFsaXplcihlKSB7XG4gICAgcmV0dXJuIG5ldyBKc29uUHJvdG9TZXJpYWxpemVyKGUsIC8qIHVzZVByb3RvM0pzb249ICovICEwKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBoZWxwZXIgZm9yIHJ1bm5pbmcgZGVsYXllZCB0YXNrcyBmb2xsb3dpbmcgYW4gZXhwb25lbnRpYWwgYmFja29mZiBjdXJ2ZVxuICogYmV0d2VlbiBhdHRlbXB0cy5cbiAqXG4gKiBFYWNoIGRlbGF5IGlzIG1hZGUgdXAgb2YgYSBcImJhc2VcIiBkZWxheSB3aGljaCBmb2xsb3dzIHRoZSBleHBvbmVudGlhbFxuICogYmFja29mZiBjdXJ2ZSwgYW5kIGEgKy8tIDUwJSBcImppdHRlclwiIHRoYXQgaXMgY2FsY3VsYXRlZCBhbmQgYWRkZWQgdG8gdGhlXG4gKiBiYXNlIGRlbGF5LiBUaGlzIHByZXZlbnRzIGNsaWVudHMgZnJvbSBhY2NpZGVudGFsbHkgc3luY2hyb25pemluZyB0aGVpclxuICogZGVsYXlzIGNhdXNpbmcgc3Bpa2VzIG9mIGxvYWQgdG8gdGhlIGJhY2tlbmQuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBBc3luY1F1ZXVlIHRvIHJ1biBiYWNrb2ZmIG9wZXJhdGlvbnMgb24uXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIElEIHRvIHVzZSB3aGVuIHNjaGVkdWxpbmcgYmFja29mZiBvcGVyYXRpb25zIG9uIHRoZSBBc3luY1F1ZXVlLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBpbml0aWFsIGRlbGF5ICh1c2VkIGFzIHRoZSBiYXNlIGRlbGF5IG9uIHRoZSBmaXJzdCByZXRyeSBhdHRlbXB0KS5cbiAgICAgKiBOb3RlIHRoYXQgaml0dGVyIHdpbGwgc3RpbGwgYmUgYXBwbGllZCwgc28gdGhlIGFjdHVhbCBkZWxheSBjb3VsZCBiZSBhc1xuICAgICAqIGxpdHRsZSBhcyAwLjUqaW5pdGlhbERlbGF5TXMuXG4gICAgICovXG4gICAgbiA9IDFlM1xuICAgIC8qKlxuICAgICAqIFRoZSBtdWx0aXBsaWVyIHRvIHVzZSB0byBkZXRlcm1pbmUgdGhlIGV4dGVuZGVkIGJhc2UgZGVsYXkgYWZ0ZXIgZWFjaFxuICAgICAqIGF0dGVtcHQuXG4gICAgICovICwgciA9IDEuNVxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIGJhc2UgZGVsYXkgYWZ0ZXIgd2hpY2ggbm8gZnVydGhlciBiYWNrb2ZmIGlzIHBlcmZvcm1lZC5cbiAgICAgKiBOb3RlIHRoYXQgaml0dGVyIHdpbGwgc3RpbGwgYmUgYXBwbGllZCwgc28gdGhlIGFjdHVhbCBkZWxheSBjb3VsZCBiZSBhc1xuICAgICAqIG11Y2ggYXMgMS41Km1heERlbGF5TXMuXG4gICAgICovICwgaSA9IDZlNCkge1xuICAgICAgICB0aGlzLnVpID0gZSwgdGhpcy50aW1lcklkID0gdCwgdGhpcy5rbyA9IG4sIHRoaXMucW8gPSByLCB0aGlzLlFvID0gaSwgdGhpcy5LbyA9IDAsIFxuICAgICAgICB0aGlzLiRvID0gbnVsbCwgXG4gICAgICAgIC8qKiBUaGUgbGFzdCBiYWNrb2ZmIGF0dGVtcHQsIGFzIGVwb2NoIG1pbGxpc2Vjb25kcy4gKi9cbiAgICAgICAgdGhpcy5VbyA9IERhdGUubm93KCksIHRoaXMucmVzZXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBiYWNrb2ZmIGRlbGF5LlxuICAgICAqXG4gICAgICogVGhlIHZlcnkgbmV4dCBiYWNrb2ZmQW5kV2FpdCgpIHdpbGwgaGF2ZSBubyBkZWxheS4gSWYgaXQgaXMgY2FsbGVkIGFnYWluXG4gICAgICogKGkuZS4gZHVlIHRvIGFuIGVycm9yKSwgaW5pdGlhbERlbGF5TXMgKHBsdXMgaml0dGVyKSB3aWxsIGJlIHVzZWQsIGFuZFxuICAgICAqIHN1YnNlcXVlbnQgb25lcyB3aWxsIGluY3JlYXNlIGFjY29yZGluZyB0byB0aGUgYmFja29mZkZhY3Rvci5cbiAgICAgKi8gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuS28gPSAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGJhY2tvZmYgZGVsYXkgdG8gdGhlIG1heGltdW0gZGVsYXkgKGUuZy4gZm9yIHVzZSBhZnRlciBhXG4gICAgICogUkVTT1VSQ0VfRVhIQVVTVEVEIGVycm9yKS5cbiAgICAgKi8gICAgV28oKSB7XG4gICAgICAgIHRoaXMuS28gPSB0aGlzLlFvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIGFmdGVyIGN1cnJlbnREZWxheU1zLCBhbmQgaW5jcmVhc2VzIHRoZVxuICAgICAqIGRlbGF5IGZvciBhbnkgc3Vic2VxdWVudCBhdHRlbXB0cy4gSWYgdGhlcmUgd2FzIGEgcGVuZGluZyBiYWNrb2ZmIG9wZXJhdGlvblxuICAgICAqIGFscmVhZHksIGl0IHdpbGwgYmUgY2FuY2VsZWQuXG4gICAgICovICAgIEdvKGUpIHtcbiAgICAgICAgLy8gQ2FuY2VsIGFueSBwZW5kaW5nIGJhY2tvZmYgb3BlcmF0aW9uLlxuICAgICAgICB0aGlzLmNhbmNlbCgpO1xuICAgICAgICAvLyBGaXJzdCBzY2hlZHVsZSB1c2luZyB0aGUgY3VycmVudCBiYXNlICh3aGljaCBtYXkgYmUgMCBhbmQgc2hvdWxkIGJlXG4gICAgICAgIC8vIGhvbm9yZWQgYXMgc3VjaCkuXG4gICAgICAgIGNvbnN0IHQgPSBNYXRoLmZsb29yKHRoaXMuS28gKyB0aGlzLnpvKCkpLCBuID0gTWF0aC5tYXgoMCwgRGF0ZS5ub3coKSAtIHRoaXMuVW8pLCByID0gTWF0aC5tYXgoMCwgdCAtIG4pO1xuICAgICAgICAvLyBHdWFyZCBhZ2FpbnN0IGxhc3RBdHRlbXB0VGltZSBiZWluZyBpbiB0aGUgZnV0dXJlIGR1ZSB0byBhIGNsb2NrIGNoYW5nZS5cbiAgICAgICAgICAgICAgICByID4gMCAmJiBfX1BSSVZBVEVfbG9nRGVidWcoXCJFeHBvbmVudGlhbEJhY2tvZmZcIiwgYEJhY2tpbmcgb2ZmIGZvciAke3J9IG1zIChiYXNlIGRlbGF5OiAke3RoaXMuS299IG1zLCBkZWxheSB3aXRoIGppdHRlcjogJHt0fSBtcywgbGFzdCBhdHRlbXB0OiAke259IG1zIGFnbylgKSwgXG4gICAgICAgIHRoaXMuJG8gPSB0aGlzLnVpLmVucXVldWVBZnRlckRlbGF5KHRoaXMudGltZXJJZCwgciwgKCgpID0+ICh0aGlzLlVvID0gRGF0ZS5ub3coKSwgXG4gICAgICAgIGUoKSkpKSwgXG4gICAgICAgIC8vIEFwcGx5IGJhY2tvZmYgZmFjdG9yIHRvIGRldGVybWluZSBuZXh0IGRlbGF5IGFuZCBlbnN1cmUgaXQgaXMgd2l0aGluXG4gICAgICAgIC8vIGJvdW5kcy5cbiAgICAgICAgdGhpcy5LbyAqPSB0aGlzLnFvLCB0aGlzLktvIDwgdGhpcy5rbyAmJiAodGhpcy5LbyA9IHRoaXMua28pLCB0aGlzLktvID4gdGhpcy5RbyAmJiAodGhpcy5LbyA9IHRoaXMuUW8pO1xuICAgIH1cbiAgICBqbygpIHtcbiAgICAgICAgbnVsbCAhPT0gdGhpcy4kbyAmJiAodGhpcy4kby5za2lwRGVsYXkoKSwgdGhpcy4kbyA9IG51bGwpO1xuICAgIH1cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuJG8gJiYgKHRoaXMuJG8uY2FuY2VsKCksIHRoaXMuJG8gPSBudWxsKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSByYW5kb20gdmFsdWUgaW4gdGhlIHJhbmdlIFstY3VycmVudEJhc2VNcy8yLCBjdXJyZW50QmFzZU1zLzJdICovICAgIHpvKCkge1xuICAgICAgICByZXR1cm4gKE1hdGgucmFuZG9tKCkgLSAuNSkgKiB0aGlzLktvO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBQZXJzaXN0ZW50U3RyZWFtIGlzIGFuIGFic3RyYWN0IGJhc2UgY2xhc3MgdGhhdCByZXByZXNlbnRzIGEgc3RyZWFtaW5nIFJQQ1xuICogdG8gdGhlIEZpcmVzdG9yZSBiYWNrZW5kLiBJdCdzIGJ1aWx0IG9uIHRvcCBvZiB0aGUgY29ubmVjdGlvbnMgb3duIHN1cHBvcnRcbiAqIGZvciBzdHJlYW1pbmcgUlBDcywgYW5kIGFkZHMgc2V2ZXJhbCBjcml0aWNhbCBmZWF0dXJlcyBmb3Igb3VyIGNsaWVudHM6XG4gKlxuICogICAtIEV4cG9uZW50aWFsIGJhY2tvZmYgb24gZmFpbHVyZVxuICogICAtIEF1dGhlbnRpY2F0aW9uIHZpYSBDcmVkZW50aWFsc1Byb3ZpZGVyXG4gKiAgIC0gRGlzcGF0Y2hpbmcgYWxsIGNhbGxiYWNrcyBpbnRvIHRoZSBzaGFyZWQgd29ya2VyIHF1ZXVlXG4gKiAgIC0gQ2xvc2luZyBpZGxlIHN0cmVhbXMgYWZ0ZXIgNjAgc2Vjb25kcyBvZiBpbmFjdGl2aXR5XG4gKlxuICogU3ViY2xhc3NlcyBvZiBQZXJzaXN0ZW50U3RyZWFtIGltcGxlbWVudCBzZXJpYWxpemF0aW9uIG9mIG1vZGVscyB0byBhbmRcbiAqIGZyb20gdGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgdGhlIHByb3RvY29sIGJ1ZmZlcnMgZm9yIGEgc3BlY2lmaWNcbiAqIHN0cmVhbWluZyBSUEMuXG4gKlxuICogIyMgU3RhcnRpbmcgYW5kIFN0b3BwaW5nXG4gKlxuICogU3RyZWFtaW5nIFJQQ3MgYXJlIHN0YXRlZnVsIGFuZCBuZWVkIHRvIGJlIHN0YXJ0KCllZCBiZWZvcmUgbWVzc2FnZXMgY2FuXG4gKiBiZSBzZW50IGFuZCByZWNlaXZlZC4gVGhlIFBlcnNpc3RlbnRTdHJlYW0gd2lsbCBjYWxsIHRoZSBvbk9wZW4oKSBmdW5jdGlvblxuICogb2YgdGhlIGxpc3RlbmVyIG9uY2UgdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgcmVxdWVzdHMuXG4gKlxuICogU2hvdWxkIGEgc3RhcnQoKSBmYWlsLCBQZXJzaXN0ZW50U3RyZWFtIHdpbGwgY2FsbCB0aGUgcmVnaXN0ZXJlZCBvbkNsb3NlKClcbiAqIGxpc3RlbmVyIHdpdGggYSBGaXJlc3RvcmVFcnJvciBpbmRpY2F0aW5nIHdoYXQgd2VudCB3cm9uZy5cbiAqXG4gKiBBIFBlcnNpc3RlbnRTdHJlYW0gY2FuIGJlIHN0YXJ0ZWQgYW5kIHN0b3BwZWQgcmVwZWF0ZWRseS5cbiAqXG4gKiBHZW5lcmljIHR5cGVzOlxuICogIFNlbmRUeXBlOiBUaGUgdHlwZSBvZiB0aGUgb3V0Z29pbmcgbWVzc2FnZSBvZiB0aGUgdW5kZXJseWluZ1xuICogICAgY29ubmVjdGlvbiBzdHJlYW1cbiAqICBSZWNlaXZlVHlwZTogVGhlIHR5cGUgb2YgdGhlIGluY29taW5nIG1lc3NhZ2Ugb2YgdGhlIHVuZGVybHlpbmdcbiAqICAgIGNvbm5lY3Rpb24gc3RyZWFtXG4gKiAgTGlzdGVuZXJUeXBlOiBUaGUgdHlwZSBvZiB0aGUgbGlzdGVuZXIgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIGNhbGxiYWNrc1xuICovXG5jbGFzcyBfX1BSSVZBVEVfUGVyc2lzdGVudFN0cmVhbSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbywgXykge1xuICAgICAgICB0aGlzLnVpID0gZSwgdGhpcy5IbyA9IG4sIHRoaXMuSm8gPSByLCB0aGlzLmNvbm5lY3Rpb24gPSBpLCB0aGlzLmF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyID0gcywgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsc1Byb3ZpZGVyID0gbywgdGhpcy5saXN0ZW5lciA9IF8sIHRoaXMuc3RhdGUgPSAwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovICwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGNsb3NlIGNvdW50IHRoYXQncyBpbmNyZW1lbnRlZCBldmVyeSB0aW1lIHRoZSBzdHJlYW0gaXMgY2xvc2VkOyB1c2VkIGJ5XG4gICAgICAgICAqIGdldENsb3NlR3VhcmRlZERpc3BhdGNoZXIoKSB0byBpbnZhbGlkYXRlIGNhbGxiYWNrcyB0aGF0IGhhcHBlbiBhZnRlclxuICAgICAgICAgKiBjbG9zZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuWW8gPSAwLCB0aGlzLlpvID0gbnVsbCwgdGhpcy5YbyA9IG51bGwsIHRoaXMuc3RyZWFtID0gbnVsbCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb3VudCBvZiByZXNwb25zZSBtZXNzYWdlcyByZWNlaXZlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZV8gPSAwLCB0aGlzLnRfID0gbmV3IF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYoZSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiBzdGFydCgpIGhhcyBiZWVuIGNhbGxlZCBhbmQgbm8gZXJyb3IgaGFzIG9jY3VycmVkLiBUcnVlXG4gICAgICogaW5kaWNhdGVzIHRoZSBzdHJlYW0gaXMgb3BlbiBvciBpbiB0aGUgcHJvY2VzcyBvZiBvcGVuaW5nICh3aGljaFxuICAgICAqIGVuY29tcGFzc2VzIHJlc3BlY3RpbmcgYmFja29mZiwgZ2V0dGluZyBhdXRoIHRva2VucywgYW5kIHN0YXJ0aW5nIHRoZVxuICAgICAqIGFjdHVhbCBSUEMpLiBVc2UgaXNPcGVuKCkgdG8gZGV0ZXJtaW5lIGlmIHRoZSBzdHJlYW0gaXMgb3BlbiBhbmQgcmVhZHkgZm9yXG4gICAgICogb3V0Ym91bmQgcmVxdWVzdHMuXG4gICAgICovICAgIG5fKCkge1xuICAgICAgICByZXR1cm4gMSAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuU3RhcnRpbmcgKi8gPT09IHRoaXMuc3RhdGUgfHwgNSAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuQmFja29mZiAqLyA9PT0gdGhpcy5zdGF0ZSB8fCB0aGlzLnJfKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdW5kZXJseWluZyBSUEMgaXMgb3BlbiAodGhlIG9uT3BlbigpIGxpc3RlbmVyIGhhcyBiZWVuXG4gICAgICogY2FsbGVkKSBhbmQgdGhlIHN0cmVhbSBpcyByZWFkeSBmb3Igb3V0Ym91bmQgcmVxdWVzdHMuXG4gICAgICovICAgIHJfKCkge1xuICAgICAgICByZXR1cm4gMiAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuT3BlbiAqLyA9PT0gdGhpcy5zdGF0ZSB8fCAzIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5IZWFsdGh5ICovID09PSB0aGlzLnN0YXRlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGFydHMgdGhlIFJQQy4gT25seSBhbGxvd2VkIGlmIGlzU3RhcnRlZCgpIHJldHVybnMgZmFsc2UuIFRoZSBzdHJlYW0gaXNcbiAgICAgKiBub3QgaW1tZWRpYXRlbHkgcmVhZHkgZm9yIHVzZTogb25PcGVuKCkgd2lsbCBiZSBpbnZva2VkIHdoZW4gdGhlIFJQQyBpc1xuICAgICAqIHJlYWR5IGZvciBvdXRib3VuZCByZXF1ZXN0cywgYXQgd2hpY2ggcG9pbnQgaXNPcGVuKCkgd2lsbCByZXR1cm4gdHJ1ZS5cbiAgICAgKlxuICAgICAqIFdoZW4gc3RhcnQgcmV0dXJucywgaXNTdGFydGVkKCkgd2lsbCByZXR1cm4gdHJ1ZS5cbiAgICAgKi8gICAgc3RhcnQoKSB7XG4gICAgICAgIHRoaXMuZV8gPSAwLCA0IC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5FcnJvciAqLyAhPT0gdGhpcy5zdGF0ZSA/IHRoaXMuYXV0aCgpIDogdGhpcy5pXygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdG9wcyB0aGUgUlBDLiBUaGlzIGNhbGwgaXMgaWRlbXBvdGVudCBhbmQgYWxsb3dlZCByZWdhcmRsZXNzIG9mIHRoZVxuICAgICAqIGN1cnJlbnQgaXNTdGFydGVkKCkgc3RhdGUuXG4gICAgICpcbiAgICAgKiBXaGVuIHN0b3AgcmV0dXJucywgaXNTdGFydGVkKCkgYW5kIGlzT3BlbigpIHdpbGwgYm90aCByZXR1cm4gZmFsc2UuXG4gICAgICovICAgIGFzeW5jIHN0b3AoKSB7XG4gICAgICAgIHRoaXMubl8oKSAmJiBhd2FpdCB0aGlzLmNsb3NlKDAgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkluaXRpYWwgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZnRlciBhbiBlcnJvciB0aGUgc3RyZWFtIHdpbGwgdXN1YWxseSBiYWNrIG9mZiBvbiB0aGUgbmV4dCBhdHRlbXB0IHRvXG4gICAgICogc3RhcnQgaXQuIElmIHRoZSBlcnJvciB3YXJyYW50cyBhbiBpbW1lZGlhdGUgcmVzdGFydCBvZiB0aGUgc3RyZWFtLCB0aGVcbiAgICAgKiBzZW5kZXIgY2FuIHVzZSB0aGlzIHRvIGluZGljYXRlIHRoYXQgdGhlIHJlY2VpdmVyIHNob3VsZCBub3QgYmFjayBvZmYuXG4gICAgICpcbiAgICAgKiBFYWNoIGVycm9yIHdpbGwgY2FsbCB0aGUgb25DbG9zZSgpIGxpc3RlbmVyLiBUaGF0IGZ1bmN0aW9uIGNhbiBkZWNpZGUgdG9cbiAgICAgKiBpbmhpYml0IGJhY2tvZmYgaWYgcmVxdWlyZWQuXG4gICAgICovICAgIHNfKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gMCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSW5pdGlhbCAqLyAsIHRoaXMudF8ucmVzZXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFya3MgdGhpcyBzdHJlYW0gYXMgaWRsZS4gSWYgbm8gZnVydGhlciBhY3Rpb25zIGFyZSBwZXJmb3JtZWQgb24gdGhlXG4gICAgICogc3RyZWFtIGZvciBvbmUgbWludXRlLCB0aGUgc3RyZWFtIHdpbGwgYXV0b21hdGljYWxseSBjbG9zZSBpdHNlbGYgYW5kXG4gICAgICogbm90aWZ5IHRoZSBzdHJlYW0ncyBvbkNsb3NlKCkgaGFuZGxlciB3aXRoIFN0YXR1cy5PSy4gVGhlIHN0cmVhbSB3aWxsIHRoZW5cbiAgICAgKiBiZSBpbiBhICFpc1N0YXJ0ZWQoKSBzdGF0ZSwgcmVxdWlyaW5nIHRoZSBjYWxsZXIgdG8gc3RhcnQgdGhlIHN0cmVhbSBhZ2FpblxuICAgICAqIGJlZm9yZSBmdXJ0aGVyIHVzZS5cbiAgICAgKlxuICAgICAqIE9ubHkgc3RyZWFtcyB0aGF0IGFyZSBpbiBzdGF0ZSAnT3BlbicgY2FuIGJlIG1hcmtlZCBpZGxlLCBhcyBhbGwgb3RoZXJcbiAgICAgKiBzdGF0ZXMgaW1wbHkgcGVuZGluZyBuZXR3b3JrIG9wZXJhdGlvbnMuXG4gICAgICovICAgIG9fKCkge1xuICAgICAgICAvLyBTdGFydHMgdGhlIGlkbGUgdGltZSBpZiB3ZSBhcmUgaW4gc3RhdGUgJ09wZW4nIGFuZCBhcmUgbm90IHlldCBhbHJlYWR5XG4gICAgICAgIC8vIHJ1bm5pbmcgYSB0aW1lciAoaW4gd2hpY2ggY2FzZSB0aGUgcHJldmlvdXMgaWRsZSB0aW1lb3V0IHN0aWxsIGFwcGxpZXMpLlxuICAgICAgICB0aGlzLnJfKCkgJiYgbnVsbCA9PT0gdGhpcy5abyAmJiAodGhpcy5abyA9IHRoaXMudWkuZW5xdWV1ZUFmdGVyRGVsYXkodGhpcy5IbywgNmU0LCAoKCkgPT4gdGhpcy5fXygpKSkpO1xuICAgIH1cbiAgICAvKiogU2VuZHMgYSBtZXNzYWdlIHRvIHRoZSB1bmRlcmx5aW5nIHN0cmVhbS4gKi8gICAgYV8oZSkge1xuICAgICAgICB0aGlzLnVfKCksIHRoaXMuc3RyZWFtLnNlbmQoZSk7XG4gICAgfVxuICAgIC8qKiBDYWxsZWQgYnkgdGhlIGlkbGUgdGltZXIgd2hlbiB0aGUgc3RyZWFtIHNob3VsZCBjbG9zZSBkdWUgdG8gaW5hY3Rpdml0eS4gKi8gICAgYXN5bmMgX18oKSB7XG4gICAgICAgIGlmICh0aGlzLnJfKCkpIFxuICAgICAgICAvLyBXaGVuIHRpbWluZyBvdXQgYW4gaWRsZSBzdHJlYW0gdGhlcmUncyBubyByZWFzb24gdG8gZm9yY2UgdGhlIHN0cmVhbSBpbnRvIGJhY2tvZmYgd2hlblxuICAgICAgICAvLyBpdCByZXN0YXJ0cyBzbyBzZXQgdGhlIHN0cmVhbSBzdGF0ZSB0byBJbml0aWFsIGluc3RlYWQgb2YgRXJyb3IuXG4gICAgICAgIHJldHVybiB0aGlzLmNsb3NlKDAgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkluaXRpYWwgKi8pO1xuICAgIH1cbiAgICAvKiogTWFya3MgdGhlIHN0cmVhbSBhcyBhY3RpdmUgYWdhaW4uICovICAgIHVfKCkge1xuICAgICAgICB0aGlzLlpvICYmICh0aGlzLlpvLmNhbmNlbCgpLCB0aGlzLlpvID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKiBDYW5jZWxzIHRoZSBoZWFsdGggY2hlY2sgZGVsYXllZCBvcGVyYXRpb24uICovICAgIGNfKCkge1xuICAgICAgICB0aGlzLlhvICYmICh0aGlzLlhvLmNhbmNlbCgpLCB0aGlzLlhvID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsb3NlcyB0aGUgc3RyZWFtIGFuZCBjbGVhbnMgdXAgYXMgbmVjZXNzYXJ5OlxuICAgICAqXG4gICAgICogKiBjbG9zZXMgdGhlIHVuZGVybHlpbmcgR1JQQyBzdHJlYW07XG4gICAgICogKiBjYWxscyB0aGUgb25DbG9zZSBoYW5kbGVyIHdpdGggdGhlIGdpdmVuICdlcnJvcic7XG4gICAgICogKiBzZXRzIGludGVybmFsIHN0cmVhbSBzdGF0ZSB0byAnZmluYWxTdGF0ZSc7XG4gICAgICogKiBhZGp1c3RzIHRoZSBiYWNrb2ZmIHRpbWVyIGJhc2VkIG9uIHRoZSBlcnJvclxuICAgICAqXG4gICAgICogQSBuZXcgc3RyZWFtIGNhbiBiZSBvcGVuZWQgYnkgY2FsbGluZyBzdGFydCgpLlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpbmFsU3RhdGUgLSB0aGUgaW50ZW5kZWQgc3RhdGUgb2YgdGhlIHN0cmVhbSBhZnRlciBjbG9zaW5nLlxuICAgICAqIEBwYXJhbSBlcnJvciAtIHRoZSBlcnJvciB0aGUgY29ubmVjdGlvbiB3YXMgY2xvc2VkIHdpdGguXG4gICAgICovICAgIGFzeW5jIGNsb3NlKGUsIHQpIHtcbiAgICAgICAgLy8gQ2FuY2VsIGFueSBvdXRzdGFuZGluZyB0aW1lcnMgKHRoZXkncmUgZ3VhcmFudGVlZCBub3QgdG8gZXhlY3V0ZSkuXG4gICAgICAgIHRoaXMudV8oKSwgdGhpcy5jXygpLCB0aGlzLnRfLmNhbmNlbCgpLCBcbiAgICAgICAgLy8gSW52YWxpZGF0ZXMgYW55IHN0cmVhbS1yZWxhdGVkIGNhbGxiYWNrcyAoZS5nLiBmcm9tIGF1dGggb3IgdGhlXG4gICAgICAgIC8vIHVuZGVybHlpbmcgc3RyZWFtKSwgZ3VhcmFudGVlaW5nIHRoZXkgd29uJ3QgZXhlY3V0ZS5cbiAgICAgICAgdGhpcy5ZbysrLCA0IC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5FcnJvciAqLyAhPT0gZSA/IFxuICAgICAgICAvLyBJZiB0aGlzIGlzIGFuIGludGVudGlvbmFsIGNsb3NlIGVuc3VyZSB3ZSBkb24ndCBkZWxheSBvdXIgbmV4dCBjb25uZWN0aW9uIGF0dGVtcHQuXG4gICAgICAgIHRoaXMudF8ucmVzZXQoKSA6IHQgJiYgdC5jb2RlID09PSBELlJFU09VUkNFX0VYSEFVU1RFRCA/IChcbiAgICAgICAgLy8gTG9nIHRoZSBlcnJvci4gKFByb2JhYmx5IGVpdGhlciAncXVvdGEgZXhjZWVkZWQnIG9yICdtYXggcXVldWUgbGVuZ3RoIHJlYWNoZWQnLilcbiAgICAgICAgX19QUklWQVRFX2xvZ0Vycm9yKHQudG9TdHJpbmcoKSksIF9fUFJJVkFURV9sb2dFcnJvcihcIlVzaW5nIG1heGltdW0gYmFja29mZiBkZWxheSB0byBwcmV2ZW50IG92ZXJsb2FkaW5nIHRoZSBiYWNrZW5kLlwiKSwgXG4gICAgICAgIHRoaXMudF8uV28oKSkgOiB0ICYmIHQuY29kZSA9PT0gRC5VTkFVVEhFTlRJQ0FURUQgJiYgMyAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSGVhbHRoeSAqLyAhPT0gdGhpcy5zdGF0ZSAmJiAoXG4gICAgICAgIC8vIFwidW5hdXRoZW50aWNhdGVkXCIgZXJyb3IgbWVhbnMgdGhlIHRva2VuIHdhcyByZWplY3RlZC4gVGhpcyBzaG91bGQgcmFyZWx5XG4gICAgICAgIC8vIGhhcHBlbiBzaW5jZSBib3RoIEF1dGggYW5kIEFwcENoZWNrIGVuc3VyZSBhIHN1ZmZpY2llbnQgVFRMIHdoZW4gd2VcbiAgICAgICAgLy8gcmVxdWVzdCBhIHRva2VuLiBJZiBhIHVzZXIgbWFudWFsbHkgcmVzZXRzIHRoZWlyIHN5c3RlbSBjbG9jayB0aGlzIGNhblxuICAgICAgICAvLyBmYWlsLCBob3dldmVyLiBJbiB0aGlzIGNhc2UsIHdlIHNob3VsZCBnZXQgYSBDb2RlLlVOQVVUSEVOVElDQVRFRCBlcnJvclxuICAgICAgICAvLyBiZWZvcmUgd2UgcmVjZWl2ZWQgdGhlIGZpcnN0IG1lc3NhZ2UgYW5kIHdlIG5lZWQgdG8gaW52YWxpZGF0ZSB0aGUgdG9rZW5cbiAgICAgICAgLy8gdG8gZW5zdXJlIHRoYXQgd2UgZmV0Y2ggYSBuZXcgdG9rZW4uXG4gICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzUHJvdmlkZXIuaW52YWxpZGF0ZVRva2VuKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsc1Byb3ZpZGVyLmludmFsaWRhdGVUb2tlbigpKSwgXG4gICAgICAgIC8vIENsZWFuIHVwIHRoZSB1bmRlcmx5aW5nIHN0cmVhbSBiZWNhdXNlIHdlIGFyZSBubyBsb25nZXIgaW50ZXJlc3RlZCBpbiBldmVudHMuXG4gICAgICAgIG51bGwgIT09IHRoaXMuc3RyZWFtICYmICh0aGlzLmxfKCksIHRoaXMuc3RyZWFtLmNsb3NlKCksIHRoaXMuc3RyZWFtID0gbnVsbCksIFxuICAgICAgICAvLyBUaGlzIHN0YXRlIG11c3QgYmUgYXNzaWduZWQgYmVmb3JlIGNhbGxpbmcgb25DbG9zZSgpIHRvIGFsbG93IHRoZSBjYWxsYmFjayB0b1xuICAgICAgICAvLyBpbmhpYml0IGJhY2tvZmYgb3Igb3RoZXJ3aXNlIG1hbmlwdWxhdGUgdGhlIHN0YXRlIGluIGl0cyBub24tc3RhcnRlZCBzdGF0ZS5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IGUsIFxuICAgICAgICAvLyBOb3RpZnkgdGhlIGxpc3RlbmVyIHRoYXQgdGhlIHN0cmVhbSBjbG9zZWQuXG4gICAgICAgIGF3YWl0IHRoaXMubGlzdGVuZXIubW8odCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbiBiZSBvdmVycmlkZGVuIHRvIHBlcmZvcm0gYWRkaXRpb25hbCBjbGVhbnVwIGJlZm9yZSB0aGUgc3RyZWFtIGlzIGNsb3NlZC5cbiAgICAgKiBDYWxsaW5nIHN1cGVyLnRlYXJEb3duKCkgaXMgbm90IHJlcXVpcmVkLlxuICAgICAqLyAgICBsXygpIHt9XG4gICAgYXV0aCgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDEgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLlN0YXJ0aW5nICovO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5oXyh0aGlzLllvKSwgdCA9IHRoaXMuWW87XG4gICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogSnVzdCB1c2UgZGlzcGF0Y2hJZk5vdENsb3NlZCwgYnV0IHNlZSBUT0RPIGJlbG93LlxuICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKFsgdGhpcy5hdXRoQ3JlZGVudGlhbHNQcm92aWRlci5nZXRUb2tlbigpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHNQcm92aWRlci5nZXRUb2tlbigpIF0pLnRoZW4oKChbZSwgbl0pID0+IHtcbiAgICAgICAgICAgIC8vIFN0cmVhbSBjYW4gYmUgc3RvcHBlZCB3aGlsZSB3YWl0aW5nIGZvciBhdXRoZW50aWNhdGlvbi5cbiAgICAgICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogV2UgcmVhbGx5IHNob3VsZCBqdXN0IHVzZSBkaXNwYXRjaElmTm90Q2xvc2VkXG4gICAgICAgICAgICAvLyBhbmQgbGV0IHRoaXMgZGlzcGF0Y2ggb250byB0aGUgcXVldWUsIGJ1dCB0aGF0IG9wZW5lZCBhIHNwZWMgdGVzdCBjYW5cbiAgICAgICAgICAgIC8vIG9mIHdvcm1zIHRoYXQgSSBkb24ndCB3YW50IHRvIGRlYWwgd2l0aCBpbiB0aGlzIFBSLlxuICAgICAgICAgICAgdGhpcy5ZbyA9PT0gdCAmJiBcbiAgICAgICAgICAgIC8vIE5vcm1hbGx5IHdlJ2QgaGF2ZSB0byBzY2hlZHVsZSB0aGUgY2FsbGJhY2sgb24gdGhlIEFzeW5jUXVldWUuXG4gICAgICAgICAgICAvLyBIb3dldmVyLCB0aGUgZm9sbG93aW5nIGNhbGxzIGFyZSBzYWZlIHRvIGJlIGNhbGxlZCBvdXRzaWRlIHRoZVxuICAgICAgICAgICAgLy8gQXN5bmNRdWV1ZSBzaW5jZSB0aGV5IGRvbid0IGNoYWluIGFzeW5jaHJvbm91cyBjYWxsc1xuICAgICAgICAgICAgdGhpcy5QXyhlLCBuKTtcbiAgICAgICAgfSksICh0ID0+IHtcbiAgICAgICAgICAgIGUoKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IEZpcmVzdG9yZUVycm9yKEQuVU5LTk9XTiwgXCJGZXRjaGluZyBhdXRoIHRva2VuIGZhaWxlZDogXCIgKyB0Lm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLklfKGUpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIFBfKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuaF8odGhpcy5Zbyk7XG4gICAgICAgIHRoaXMuc3RyZWFtID0gdGhpcy5UXyhlLCB0KSwgdGhpcy5zdHJlYW0uRW8oKCgpID0+IHtcbiAgICAgICAgICAgIG4oKCgpID0+IHRoaXMubGlzdGVuZXIuRW8oKSkpO1xuICAgICAgICB9KSksIHRoaXMuc3RyZWFtLlJvKCgoKSA9PiB7XG4gICAgICAgICAgICBuKCgoKSA9PiAodGhpcy5zdGF0ZSA9IDIgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLk9wZW4gKi8gLCB0aGlzLlhvID0gdGhpcy51aS5lbnF1ZXVlQWZ0ZXJEZWxheSh0aGlzLkpvLCAxZTQsICgoKSA9PiAodGhpcy5yXygpICYmICh0aGlzLnN0YXRlID0gMyAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSGVhbHRoeSAqLyksIFxuICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSksIHRoaXMubGlzdGVuZXIuUm8oKSkpKTtcbiAgICAgICAgfSkpLCB0aGlzLnN0cmVhbS5tbygoZSA9PiB7XG4gICAgICAgICAgICBuKCgoKSA9PiB0aGlzLklfKGUpKSk7XG4gICAgICAgIH0pKSwgdGhpcy5zdHJlYW0ub25NZXNzYWdlKChlID0+IHtcbiAgICAgICAgICAgIG4oKCgpID0+IDEgPT0gKyt0aGlzLmVfID8gdGhpcy5FXyhlKSA6IHRoaXMub25OZXh0KGUpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgaV8oKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSA1IC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5CYWNrb2ZmICovICwgdGhpcy50Xy5HbygoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IDAgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkluaXRpYWwgKi8gLCB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLy8gVmlzaWJsZSBmb3IgdGVzdHNcbiAgICBJXyhlKSB7XG4gICAgICAgIC8vIEluIHRoZW9yeSB0aGUgc3RyZWFtIGNvdWxkIGNsb3NlIGNsZWFubHksIGhvd2V2ZXIsIGluIG91ciBjdXJyZW50IG1vZGVsXG4gICAgICAgIC8vIHdlIG5ldmVyIGV4cGVjdCB0aGlzIHRvIGhhcHBlbiBiZWNhdXNlIGlmIHdlIHN0b3AgYSBzdHJlYW0gb3Vyc2VsdmVzLFxuICAgICAgICAvLyB0aGlzIGNhbGxiYWNrIHdpbGwgbmV2ZXIgYmUgY2FsbGVkLiBUbyBwcmV2ZW50IGNhc2VzIHdoZXJlIHdlIHJldHJ5XG4gICAgICAgIC8vIHdpdGhvdXQgYSBiYWNrb2ZmIGFjY2lkZW50YWxseSwgd2Ugc2V0IHRoZSBzdHJlYW0gdG8gZXJyb3IgaW4gYWxsIGNhc2VzLlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ0RlYnVnKFwiUGVyc2lzdGVudFN0cmVhbVwiLCBgY2xvc2Ugd2l0aCBlcnJvcjogJHtlfWApLCB0aGlzLnN0cmVhbSA9IG51bGwsIFxuICAgICAgICB0aGlzLmNsb3NlKDQgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkVycm9yICovICwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBcImRpc3BhdGNoZXJcIiBmdW5jdGlvbiB0aGF0IGRpc3BhdGNoZXMgb3BlcmF0aW9ucyBvbnRvIHRoZVxuICAgICAqIEFzeW5jUXVldWUgYnV0IG9ubHkgcnVucyB0aGVtIGlmIGNsb3NlQ291bnQgcmVtYWlucyB1bmNoYW5nZWQuIFRoaXMgYWxsb3dzXG4gICAgICogdXMgdG8gdHVybiBhdXRoIC8gc3RyZWFtIGNhbGxiYWNrcyBpbnRvIG5vLW9wcyBpZiB0aGUgc3RyZWFtIGlzIGNsb3NlZCAvXG4gICAgICogcmUtb3BlbmVkLCBldGMuXG4gICAgICovICAgIGhfKGUpIHtcbiAgICAgICAgcmV0dXJuIHQgPT4ge1xuICAgICAgICAgICAgdGhpcy51aS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiB0aGlzLllvID09PSBlID8gdCgpIDogKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlBlcnNpc3RlbnRTdHJlYW1cIiwgXCJzdHJlYW0gY2FsbGJhY2sgc2tpcHBlZCBieSBnZXRDbG9zZUd1YXJkZWREaXNwYXRjaGVyLlwiKSwgXG4gICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKTtcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBQZXJzaXN0ZW50U3RyZWFtIHRoYXQgaW1wbGVtZW50cyB0aGUgTGlzdGVuIFJQQy5cbiAqXG4gKiBPbmNlIHRoZSBMaXN0ZW4gc3RyZWFtIGhhcyBjYWxsZWQgdGhlIG9uT3BlbigpIGxpc3RlbmVyLCBhbnkgbnVtYmVyIG9mXG4gKiBsaXN0ZW4oKSBhbmQgdW5saXN0ZW4oKSBjYWxscyBjYW4gYmUgbWFkZSB0byBjb250cm9sIHdoYXQgY2hhbmdlcyB3aWxsIGJlXG4gKiBzZW50IGZyb20gdGhlIHNlcnZlciBmb3IgTGlzdGVuUmVzcG9uc2VzLlxuICovIGNsYXNzIF9fUFJJVkFURV9QZXJzaXN0ZW50TGlzdGVuU3RyZWFtIGV4dGVuZHMgX19QUklWQVRFX1BlcnNpc3RlbnRTdHJlYW0ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgc3VwZXIoZSwgXCJsaXN0ZW5fc3RyZWFtX2Nvbm5lY3Rpb25fYmFja29mZlwiIC8qIFRpbWVySWQuTGlzdGVuU3RyZWFtQ29ubmVjdGlvbkJhY2tvZmYgKi8gLCBcImxpc3Rlbl9zdHJlYW1faWRsZVwiIC8qIFRpbWVySWQuTGlzdGVuU3RyZWFtSWRsZSAqLyAsIFwiaGVhbHRoX2NoZWNrX3RpbWVvdXRcIiAvKiBUaW1lcklkLkhlYWx0aENoZWNrVGltZW91dCAqLyAsIHQsIG4sIHIsIHMpLCBcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gaTtcbiAgICB9XG4gICAgVF8oZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uLkJvKFwiTGlzdGVuXCIsIGUsIHQpO1xuICAgIH1cbiAgICBFXyhlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9uTmV4dChlKTtcbiAgICB9XG4gICAgb25OZXh0KGUpIHtcbiAgICAgICAgLy8gQSBzdWNjZXNzZnVsIHJlc3BvbnNlIG1lYW5zIHRoZSBzdHJlYW0gaXMgaGVhbHRoeVxuICAgICAgICB0aGlzLnRfLnJlc2V0KCk7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbVdhdGNoQ2hhbmdlKHRoaXMuc2VyaWFsaXplciwgZSksIG4gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdmVyc2lvbkZyb21MaXN0ZW5SZXNwb25zZShlKSB7XG4gICAgICAgICAgICAvLyBXZSBoYXZlIG9ubHkgcmVhY2hlZCBhIGNvbnNpc3RlbnQgc25hcHNob3QgZm9yIHRoZSBlbnRpcmUgc3RyZWFtIGlmIHRoZXJlXG4gICAgICAgICAgICAvLyBpcyBhIHJlYWRfdGltZSBzZXQgYW5kIGl0IGFwcGxpZXMgdG8gYWxsIHRhcmdldHMgKGkuZS4gdGhlIGxpc3Qgb2ZcbiAgICAgICAgICAgIC8vIHRhcmdldHMgaXMgZW1wdHkpLiBUaGUgYmFja2VuZCBpcyBndWFyYW50ZWVkIHRvIHNlbmQgc3VjaCByZXNwb25zZXMuXG4gICAgICAgICAgICBpZiAoIShcInRhcmdldENoYW5nZVwiIGluIGUpKSByZXR1cm4gU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgICAgICAgICAgY29uc3QgdCA9IGUudGFyZ2V0Q2hhbmdlO1xuICAgICAgICAgICAgcmV0dXJuIHQudGFyZ2V0SWRzICYmIHQudGFyZ2V0SWRzLmxlbmd0aCA/IFNuYXBzaG90VmVyc2lvbi5taW4oKSA6IHQucmVhZFRpbWUgPyBfX1BSSVZBVEVfZnJvbVZlcnNpb24odC5yZWFkVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCk7XG4gICAgICAgIH0oZSk7XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLmRfKHQsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgaW50ZXJlc3QgaW4gdGhlIHJlc3VsdHMgb2YgdGhlIGdpdmVuIHRhcmdldC4gSWYgdGhlIHRhcmdldFxuICAgICAqIGluY2x1ZGVzIGEgcmVzdW1lVG9rZW4gaXQgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVxdWVzdC4gUmVzdWx0cyB0aGF0XG4gICAgICogYWZmZWN0IHRoZSB0YXJnZXQgd2lsbCBiZSBzdHJlYW1lZCBiYWNrIGFzIFdhdGNoQ2hhbmdlIG1lc3NhZ2VzIHRoYXRcbiAgICAgKiByZWZlcmVuY2UgdGhlIHRhcmdldElkLlxuICAgICAqLyAgICBBXyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7fTtcbiAgICAgICAgdC5kYXRhYmFzZSA9IF9fUFJJVkFURV9nZXRFbmNvZGVkRGF0YWJhc2VJZCh0aGlzLnNlcmlhbGl6ZXIpLCB0LmFkZFRhcmdldCA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b1RhcmdldChlLCB0KSB7XG4gICAgICAgICAgICBsZXQgbjtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0LnRhcmdldDtcbiAgICAgICAgICAgIGlmIChuID0gX19QUklWQVRFX3RhcmdldElzRG9jdW1lbnRUYXJnZXQocikgPyB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRzOiBfX1BSSVZBVEVfdG9Eb2N1bWVudHNUYXJnZXQoZSwgcilcbiAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgcXVlcnk6IF9fUFJJVkFURV90b1F1ZXJ5VGFyZ2V0KGUsIHIpLl90XG4gICAgICAgICAgICB9LCBuLnRhcmdldElkID0gdC50YXJnZXRJZCwgdC5yZXN1bWVUb2tlbi5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgbi5yZXN1bWVUb2tlbiA9IF9fUFJJVkFURV90b0J5dGVzKGUsIHQucmVzdW1lVG9rZW4pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfdG9JbnQzMlByb3RvKGUsIHQuZXhwZWN0ZWRDb3VudCk7XG4gICAgICAgICAgICAgICAgbnVsbCAhPT0gciAmJiAobi5leHBlY3RlZENvdW50ID0gcik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHQuc25hcHNob3RWZXJzaW9uLmNvbXBhcmVUbyhTbmFwc2hvdFZlcnNpb24ubWluKCkpID4gMCkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8od3VhbmR5KTogQ29uc2lkZXIgcmVtb3ZpbmcgYWJvdmUgY2hlY2sgYmVjYXVzZSBpdCBpcyBtb3N0IGxpa2VseSB0cnVlLlxuICAgICAgICAgICAgICAgIC8vIFJpZ2h0IG5vdywgbWFueSB0ZXN0cyBkZXBlbmQgb24gdGhpcyBiZWhhdmlvdXIgdGhvdWdoIChsZWF2aW5nIG1pbigpIG91dFxuICAgICAgICAgICAgICAgIC8vIG9mIHNlcmlhbGl6YXRpb24pLlxuICAgICAgICAgICAgICAgIG4ucmVhZFRpbWUgPSB0b1RpbWVzdGFtcChlLCB0LnNuYXBzaG90VmVyc2lvbi50b1RpbWVzdGFtcCgpKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3RvSW50MzJQcm90byhlLCB0LmV4cGVjdGVkQ291bnQpO1xuICAgICAgICAgICAgICAgIG51bGwgIT09IHIgJiYgKG4uZXhwZWN0ZWRDb3VudCA9IHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG47XG4gICAgICAgIH0odGhpcy5zZXJpYWxpemVyLCBlKTtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV90b0xpc3RlblJlcXVlc3RMYWJlbHModGhpcy5zZXJpYWxpemVyLCBlKTtcbiAgICAgICAgbiAmJiAodC5sYWJlbHMgPSBuKSwgdGhpcy5hXyh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVW5yZWdpc3RlcnMgaW50ZXJlc3QgaW4gdGhlIHJlc3VsdHMgb2YgdGhlIHRhcmdldCBhc3NvY2lhdGVkIHdpdGggdGhlXG4gICAgICogZ2l2ZW4gdGFyZ2V0SWQuXG4gICAgICovICAgIFJfKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHt9O1xuICAgICAgICB0LmRhdGFiYXNlID0gX19QUklWQVRFX2dldEVuY29kZWREYXRhYmFzZUlkKHRoaXMuc2VyaWFsaXplciksIHQucmVtb3ZlVGFyZ2V0ID0gZSwgXG4gICAgICAgIHRoaXMuYV8odCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgU3RyZWFtIHRoYXQgaW1wbGVtZW50cyB0aGUgV3JpdGUgUlBDLlxuICpcbiAqIFRoZSBXcml0ZSBSUEMgcmVxdWlyZXMgdGhlIGNhbGxlciB0byBtYWludGFpbiBzcGVjaWFsIHN0cmVhbVRva2VuXG4gKiBzdGF0ZSBpbiBiZXR3ZWVuIGNhbGxzLCB0byBoZWxwIHRoZSBzZXJ2ZXIgdW5kZXJzdGFuZCB3aGljaCByZXNwb25zZXMgdGhlXG4gKiBjbGllbnQgaGFzIHByb2Nlc3NlZCBieSB0aGUgdGltZSB0aGUgbmV4dCByZXF1ZXN0IGlzIG1hZGUuIEV2ZXJ5IHJlc3BvbnNlXG4gKiB3aWxsIGNvbnRhaW4gYSBzdHJlYW1Ub2tlbjsgdGhpcyB2YWx1ZSBtdXN0IGJlIHBhc3NlZCB0byB0aGUgbmV4dFxuICogcmVxdWVzdC5cbiAqXG4gKiBBZnRlciBjYWxsaW5nIHN0YXJ0KCkgb24gdGhpcyBzdHJlYW0sIHRoZSBuZXh0IHJlcXVlc3QgbXVzdCBiZSBhIGhhbmRzaGFrZSxcbiAqIGNvbnRhaW5pbmcgd2hhdGV2ZXIgc3RyZWFtVG9rZW4gaXMgb24gaGFuZC4gT25jZSBhIHJlc3BvbnNlIHRvIHRoaXNcbiAqIHJlcXVlc3QgaXMgcmVjZWl2ZWQsIGFsbCBwZW5kaW5nIG11dGF0aW9ucyBtYXkgYmUgc3VibWl0dGVkLiBXaGVuXG4gKiBzdWJtaXR0aW5nIG11bHRpcGxlIGJhdGNoZXMgb2YgbXV0YXRpb25zIGF0IHRoZSBzYW1lIHRpbWUsIGl0J3NcbiAqIG9rYXkgdG8gdXNlIHRoZSBzYW1lIHN0cmVhbVRva2VuIGZvciB0aGUgY2FsbHMgdG8gd3JpdGVNdXRhdGlvbnMuXG4gKlxuICogVE9ETyhiLzMzMjcxMjM1KTogVXNlIHByb3RvIHR5cGVzXG4gKi8gY2xhc3MgX19QUklWQVRFX1BlcnNpc3RlbnRXcml0ZVN0cmVhbSBleHRlbmRzIF9fUFJJVkFURV9QZXJzaXN0ZW50U3RyZWFtIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpLCBzKSB7XG4gICAgICAgIHN1cGVyKGUsIFwid3JpdGVfc3RyZWFtX2Nvbm5lY3Rpb25fYmFja29mZlwiIC8qIFRpbWVySWQuV3JpdGVTdHJlYW1Db25uZWN0aW9uQmFja29mZiAqLyAsIFwid3JpdGVfc3RyZWFtX2lkbGVcIiAvKiBUaW1lcklkLldyaXRlU3RyZWFtSWRsZSAqLyAsIFwiaGVhbHRoX2NoZWNrX3RpbWVvdXRcIiAvKiBUaW1lcklkLkhlYWx0aENoZWNrVGltZW91dCAqLyAsIHQsIG4sIHIsIHMpLCBcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gaTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgb3Igbm90IGEgaGFuZHNoYWtlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBleGNoYW5nZWQgYW5kXG4gICAgICogdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgbXV0YXRpb25zLlxuICAgICAqLyAgICBnZXQgVl8oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVfID4gMDtcbiAgICB9XG4gICAgLy8gT3ZlcnJpZGUgb2YgUGVyc2lzdGVudFN0cmVhbS5zdGFydFxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLmxhc3RTdHJlYW1Ub2tlbiA9IHZvaWQgMCwgc3VwZXIuc3RhcnQoKTtcbiAgICB9XG4gICAgbF8oKSB7XG4gICAgICAgIHRoaXMuVl8gJiYgdGhpcy5tXyhbXSk7XG4gICAgfVxuICAgIFRfKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbi5CbyhcIldyaXRlXCIsIGUsIHQpO1xuICAgIH1cbiAgICBFXyhlKSB7XG4gICAgICAgIC8vIEFsd2F5cyBjYXB0dXJlIHRoZSBsYXN0IHN0cmVhbSB0b2tlbi5cbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZS5zdHJlYW1Ub2tlbiksIHRoaXMubGFzdFN0cmVhbVRva2VuID0gZS5zdHJlYW1Ub2tlbiwgXG4gICAgICAgIC8vIFRoZSBmaXJzdCByZXNwb25zZSBpcyBhbHdheXMgdGhlIGhhbmRzaGFrZSByZXNwb25zZVxuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCghZS53cml0ZVJlc3VsdHMgfHwgMCA9PT0gZS53cml0ZVJlc3VsdHMubGVuZ3RoKSwgdGhpcy5saXN0ZW5lci5mXygpO1xuICAgIH1cbiAgICBvbk5leHQoZSkge1xuICAgICAgICAvLyBBbHdheXMgY2FwdHVyZSB0aGUgbGFzdCBzdHJlYW0gdG9rZW4uXG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZS5zdHJlYW1Ub2tlbiksIHRoaXMubGFzdFN0cmVhbVRva2VuID0gZS5zdHJlYW1Ub2tlbiwgXG4gICAgICAgIC8vIEEgc3VjY2Vzc2Z1bCBmaXJzdCB3cml0ZSByZXNwb25zZSBtZWFucyB0aGUgc3RyZWFtIGlzIGhlYWx0aHksXG4gICAgICAgIC8vIE5vdGUsIHRoYXQgd2UgY291bGQgY29uc2lkZXIgYSBzdWNjZXNzZnVsIGhhbmRzaGFrZSBoZWFsdGh5LCBob3dldmVyLFxuICAgICAgICAvLyB0aGUgd3JpdGUgaXRzZWxmIG1pZ2h0IGJlIGNhdXNpbmcgYW4gZXJyb3Igd2Ugd2FudCB0byBiYWNrIG9mZiBmcm9tLlxuICAgICAgICB0aGlzLnRfLnJlc2V0KCk7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbVdyaXRlUmVzdWx0cyhlLndyaXRlUmVzdWx0cywgZS5jb21taXRUaW1lKSwgbiA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLmNvbW1pdFRpbWUpO1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5lci5nXyhuLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2VuZHMgYW4gaW5pdGlhbCBzdHJlYW1Ub2tlbiB0byB0aGUgc2VydmVyLCBwZXJmb3JtaW5nIHRoZSBoYW5kc2hha2VcbiAgICAgKiByZXF1aXJlZCB0byBtYWtlIHRoZSBTdHJlYW1pbmdXcml0ZSBSUEMgd29yay4gU3Vic2VxdWVudFxuICAgICAqIGNhbGxzIHNob3VsZCB3YWl0IHVudGlsIG9uSGFuZHNoYWtlQ29tcGxldGUgd2FzIGNhbGxlZC5cbiAgICAgKi8gICAgcF8oKSB7XG4gICAgICAgIC8vIFRPRE8oZGltb25kKTogU3VwcG9ydCBzdHJlYW0gcmVzdW1wdGlvbi4gV2UgaW50ZW50aW9uYWxseSBkbyBub3Qgc2V0IHRoZVxuICAgICAgICAvLyBzdHJlYW0gdG9rZW4gb24gdGhlIGhhbmRzaGFrZSwgaWdub3JpbmcgYW55IHN0cmVhbSB0b2tlbiB3ZSBtaWdodCBoYXZlLlxuICAgICAgICBjb25zdCBlID0ge307XG4gICAgICAgIGUuZGF0YWJhc2UgPSBfX1BSSVZBVEVfZ2V0RW5jb2RlZERhdGFiYXNlSWQodGhpcy5zZXJpYWxpemVyKSwgdGhpcy5hXyhlKTtcbiAgICB9XG4gICAgLyoqIFNlbmRzIGEgZ3JvdXAgb2YgbXV0YXRpb25zIHRvIHRoZSBGaXJlc3RvcmUgYmFja2VuZCB0byBhcHBseS4gKi8gICAgbV8oZSkge1xuICAgICAgICBjb25zdCB0ID0ge1xuICAgICAgICAgICAgc3RyZWFtVG9rZW46IHRoaXMubGFzdFN0cmVhbVRva2VuLFxuICAgICAgICAgICAgd3JpdGVzOiBlLm1hcCgoZSA9PiB0b011dGF0aW9uKHRoaXMuc2VyaWFsaXplciwgZSkpKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmFfKHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRGF0YXN0b3JlIGFuZCBpdHMgcmVsYXRlZCBtZXRob2RzIGFyZSBhIHdyYXBwZXIgYXJvdW5kIHRoZSBleHRlcm5hbCBHb29nbGVcbiAqIENsb3VkIERhdGFzdG9yZSBncnBjIEFQSSwgd2hpY2ggcHJvdmlkZXMgYW4gaW50ZXJmYWNlIHRoYXQgaXMgbW9yZSBjb252ZW5pZW50XG4gKiBmb3IgdGhlIHJlc3Qgb2YgdGhlIGNsaWVudCBTREsgYXJjaGl0ZWN0dXJlIHRvIGNvbnN1bWUuXG4gKi9cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgRGF0YXN0b3JlIHRoYXQgZXhwb3NlcyBhZGRpdGlvbmFsIHN0YXRlIGZvciBpbnRlcm5hbFxuICogY29uc3VtcHRpb24uXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9EYXRhc3RvcmVJbXBsIGV4dGVuZHMgY2xhc3MgRGF0YXN0b3JlIHt9IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuYXV0aENyZWRlbnRpYWxzID0gZSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzID0gdCwgdGhpcy5jb25uZWN0aW9uID0gbiwgXG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IHIsIHRoaXMueV8gPSAhMTtcbiAgICB9XG4gICAgd18oKSB7XG4gICAgICAgIGlmICh0aGlzLnlfKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlRoZSBjbGllbnQgaGFzIGFscmVhZHkgYmVlbiB0ZXJtaW5hdGVkLlwiKTtcbiAgICB9XG4gICAgLyoqIEludm9rZXMgdGhlIHByb3ZpZGVkIFJQQyB3aXRoIGF1dGggYW5kIEFwcENoZWNrIHRva2Vucy4gKi8gICAgTW8oZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gdGhpcy53XygpLCBQcm9taXNlLmFsbChbIHRoaXMuYXV0aENyZWRlbnRpYWxzLmdldFRva2VuKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5nZXRUb2tlbigpIF0pLnRoZW4oKChbaSwgc10pID0+IHRoaXMuY29ubmVjdGlvbi5NbyhlLCBfX1BSSVZBVEVfdG9SZXNvdXJjZVBhdGgodCwgbiksIHIsIGksIHMpKSkuY2F0Y2goKGUgPT4ge1xuICAgICAgICAgICAgdGhyb3cgXCJGaXJlYmFzZUVycm9yXCIgPT09IGUubmFtZSA/IChlLmNvZGUgPT09IEQuVU5BVVRIRU5USUNBVEVEICYmICh0aGlzLmF1dGhDcmVkZW50aWFscy5pbnZhbGlkYXRlVG9rZW4oKSwgXG4gICAgICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuaW52YWxpZGF0ZVRva2VuKCkpLCBlKSA6IG5ldyBGaXJlc3RvcmVFcnJvcihELlVOS05PV04sIGUudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqIEludm9rZXMgdGhlIHByb3ZpZGVkIFJQQyB3aXRoIHN0cmVhbWVkIHJlc3VsdHMgd2l0aCBhdXRoIGFuZCBBcHBDaGVjayB0b2tlbnMuICovICAgIExvKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud18oKSwgUHJvbWlzZS5hbGwoWyB0aGlzLmF1dGhDcmVkZW50aWFscy5nZXRUb2tlbigpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuZ2V0VG9rZW4oKSBdKS50aGVuKCgoW3MsIG9dKSA9PiB0aGlzLmNvbm5lY3Rpb24uTG8oZSwgX19QUklWQVRFX3RvUmVzb3VyY2VQYXRoKHQsIG4pLCByLCBzLCBvLCBpKSkpLmNhdGNoKChlID0+IHtcbiAgICAgICAgICAgIHRocm93IFwiRmlyZWJhc2VFcnJvclwiID09PSBlLm5hbWUgPyAoZS5jb2RlID09PSBELlVOQVVUSEVOVElDQVRFRCAmJiAodGhpcy5hdXRoQ3JlZGVudGlhbHMuaW52YWxpZGF0ZVRva2VuKCksIFxuICAgICAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLmludmFsaWRhdGVUb2tlbigpKSwgZSkgOiBuZXcgRmlyZXN0b3JlRXJyb3IoRC5VTktOT1dOLCBlLnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHRlcm1pbmF0ZSgpIHtcbiAgICAgICAgdGhpcy55XyA9ICEwLCB0aGlzLmNvbm5lY3Rpb24udGVybWluYXRlKCk7XG4gICAgfVxufVxuXG4vLyBUT0RPKGZpcmVzdG9yZXhwKTogTWFrZSBzdXJlIHRoZXJlIGlzIG9ubHkgb25lIERhdGFzdG9yZSBpbnN0YW5jZSBwZXJcbi8vIGZpcmVzdG9yZS1leHAgY2xpZW50LlxuLyoqXG4gKiBBIGNvbXBvbmVudCB1c2VkIGJ5IHRoZSBSZW1vdGVTdG9yZSB0byB0cmFjayB0aGUgT25saW5lU3RhdGUgKHRoYXQgaXMsXG4gKiB3aGV0aGVyIG9yIG5vdCB0aGUgY2xpZW50IGFzIGEgd2hvbGUgc2hvdWxkIGJlIGNvbnNpZGVyZWQgdG8gYmUgb25saW5lIG9yXG4gKiBvZmZsaW5lKSwgaW1wbGVtZW50aW5nIHRoZSBhcHByb3ByaWF0ZSBoZXVyaXN0aWNzLlxuICpcbiAqIEluIHBhcnRpY3VsYXIsIHdoZW4gdGhlIGNsaWVudCBpcyB0cnlpbmcgdG8gY29ubmVjdCB0byB0aGUgYmFja2VuZCwgd2VcbiAqIGFsbG93IHVwIHRvIE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMgd2l0aGluIE9OTElORV9TVEFURV9USU1FT1VUX01TIGZvclxuICogYSBjb25uZWN0aW9uIHRvIHN1Y2NlZWQuIElmIHdlIGhhdmUgdG9vIG1hbnkgZmFpbHVyZXMgb3IgdGhlIHRpbWVvdXQgZWxhcHNlcyxcbiAqIHRoZW4gd2Ugc2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBPZmZsaW5lLCBhbmQgdGhlIGNsaWVudCB3aWxsIGJlaGF2ZSBhcyBpZlxuICogaXQgaXMgb2ZmbGluZSAoZ2V0KClzIHdpbGwgcmV0dXJuIGNhY2hlZCBkYXRhLCBldGMuKS5cbiAqL1xuY2xhc3MgX19QUklWQVRFX09ubGluZVN0YXRlVHJhY2tlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUgPSBlLCB0aGlzLm9ubGluZVN0YXRlSGFuZGxlciA9IHQsIFxuICAgICAgICAvKiogVGhlIGN1cnJlbnQgT25saW5lU3RhdGUuICovXG4gICAgICAgIHRoaXMuc3RhdGUgPSBcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovICwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGNvdW50IG9mIGNvbnNlY3V0aXZlIGZhaWx1cmVzIHRvIG9wZW4gdGhlIHN0cmVhbS4gSWYgaXQgcmVhY2hlcyB0aGVcbiAgICAgICAgICogbWF4aW11bSBkZWZpbmVkIGJ5IE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMsIHdlJ2xsIHNldCB0aGUgT25saW5lU3RhdGUgdG9cbiAgICAgICAgICogT2ZmbGluZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuU18gPSAwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgdGltZXIgdGhhdCBlbGFwc2VzIGFmdGVyIE9OTElORV9TVEFURV9USU1FT1VUX01TLCBhdCB3aGljaCBwb2ludCB3ZVxuICAgICAgICAgKiB0cmFuc2l0aW9uIGZyb20gT25saW5lU3RhdGUuVW5rbm93biB0byBPbmxpbmVTdGF0ZS5PZmZsaW5lIHdpdGhvdXQgd2FpdGluZ1xuICAgICAgICAgKiBmb3IgdGhlIHN0cmVhbSB0byBhY3R1YWxseSBmYWlsIChNQVhfV0FUQ0hfU1RSRUFNX0ZBSUxVUkVTIHRpbWVzKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYl8gPSBudWxsLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIGNsaWVudCBzaG91bGQgbG9nIGEgd2FybmluZyBtZXNzYWdlIGlmIGl0IGZhaWxzIHRvIGNvbm5lY3QgdG9cbiAgICAgICAgICogdGhlIGJhY2tlbmQgKGluaXRpYWxseSB0cnVlLCBjbGVhcmVkIGFmdGVyIGEgc3VjY2Vzc2Z1bCBzdHJlYW0sIG9yIGlmIHdlJ3ZlXG4gICAgICAgICAqIGxvZ2dlZCB0aGUgbWVzc2FnZSBhbHJlYWR5KS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuRF8gPSAhMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGVkIGJ5IFJlbW90ZVN0b3JlIHdoZW4gYSB3YXRjaCBzdHJlYW0gaXMgc3RhcnRlZCAoaW5jbHVkaW5nIG9uIGVhY2hcbiAgICAgKiBiYWNrb2ZmIGF0dGVtcHQpLlxuICAgICAqXG4gICAgICogSWYgdGhpcyBpcyB0aGUgZmlyc3QgYXR0ZW1wdCwgaXQgc2V0cyB0aGUgT25saW5lU3RhdGUgdG8gVW5rbm93biBhbmQgc3RhcnRzXG4gICAgICogdGhlIG9ubGluZVN0YXRlVGltZXIuXG4gICAgICovICAgIHZfKCkge1xuICAgICAgICAwID09PSB0aGlzLlNfICYmICh0aGlzLkNfKFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pLCB0aGlzLmJfID0gdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBZnRlckRlbGF5KFwib25saW5lX3N0YXRlX3RpbWVvdXRcIiAvKiBUaW1lcklkLk9ubGluZVN0YXRlVGltZW91dCAqLyAsIDFlNCwgKCgpID0+ICh0aGlzLmJfID0gbnVsbCwgXG4gICAgICAgIHRoaXMuRl8oXCJCYWNrZW5kIGRpZG4ndCByZXNwb25kIHdpdGhpbiAxMCBzZWNvbmRzLlwiKSwgdGhpcy5DXyhcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovKSwgXG4gICAgICAgIFByb21pc2UucmVzb2x2ZSgpKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBvdXIgT25saW5lU3RhdGUgYXMgYXBwcm9wcmlhdGUgYWZ0ZXIgdGhlIHdhdGNoIHN0cmVhbSByZXBvcnRzIGFcbiAgICAgKiBmYWlsdXJlLiBUaGUgZmlyc3QgZmFpbHVyZSBtb3ZlcyB1cyB0byB0aGUgJ1Vua25vd24nIHN0YXRlLiBXZSB0aGVuIG1heVxuICAgICAqIGFsbG93IG11bHRpcGxlIGZhaWx1cmVzIChiYXNlZCBvbiBNQVhfV0FUQ0hfU1RSRUFNX0ZBSUxVUkVTKSBiZWZvcmUgd2VcbiAgICAgKiBhY3R1YWxseSB0cmFuc2l0aW9uIHRvIHRoZSAnT2ZmbGluZScgc3RhdGUuXG4gICAgICovICAgIE1fKGUpIHtcbiAgICAgICAgXCJPbmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PbmxpbmUgKi8gPT09IHRoaXMuc3RhdGUgPyB0aGlzLkNfKFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pIDogKHRoaXMuU18rKywgXG4gICAgICAgIHRoaXMuU18gPj0gMSAmJiAodGhpcy54XygpLCB0aGlzLkZfKGBDb25uZWN0aW9uIGZhaWxlZCAxIHRpbWVzLiBNb3N0IHJlY2VudCBlcnJvcjogJHtlLnRvU3RyaW5nKCl9YCksIFxuICAgICAgICB0aGlzLkNfKFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8pKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4cGxpY2l0bHkgc2V0cyB0aGUgT25saW5lU3RhdGUgdG8gdGhlIHNwZWNpZmllZCBzdGF0ZS5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB0aGlzIHJlc2V0cyBvdXIgdGltZXJzIC8gZmFpbHVyZSBjb3VudGVycywgZXRjLiB1c2VkIGJ5IG91clxuICAgICAqIE9mZmxpbmUgaGV1cmlzdGljcywgc28gbXVzdCBub3QgYmUgdXNlZCBpbiBwbGFjZSBvZlxuICAgICAqIGhhbmRsZVdhdGNoU3RyZWFtU3RhcnQoKSBhbmQgaGFuZGxlV2F0Y2hTdHJlYW1GYWlsdXJlKCkuXG4gICAgICovICAgIHNldChlKSB7XG4gICAgICAgIHRoaXMueF8oKSwgdGhpcy5TXyA9IDAsIFwiT25saW5lXCIgLyogT25saW5lU3RhdGUuT25saW5lICovID09PSBlICYmIChcbiAgICAgICAgLy8gV2UndmUgY29ubmVjdGVkIHRvIHdhdGNoIGF0IGxlYXN0IG9uY2UuIERvbid0IHdhcm4gdGhlIGRldmVsb3BlclxuICAgICAgICAvLyBhYm91dCBiZWluZyBvZmZsaW5lIGdvaW5nIGZvcndhcmQuXG4gICAgICAgIHRoaXMuRF8gPSAhMSksIHRoaXMuQ18oZSk7XG4gICAgfVxuICAgIENfKGUpIHtcbiAgICAgICAgZSAhPT0gdGhpcy5zdGF0ZSAmJiAodGhpcy5zdGF0ZSA9IGUsIHRoaXMub25saW5lU3RhdGVIYW5kbGVyKGUpKTtcbiAgICB9XG4gICAgRl8oZSkge1xuICAgICAgICBjb25zdCB0ID0gYENvdWxkIG5vdCByZWFjaCBDbG91ZCBGaXJlc3RvcmUgYmFja2VuZC4gJHtlfVxcblRoaXMgdHlwaWNhbGx5IGluZGljYXRlcyB0aGF0IHlvdXIgZGV2aWNlIGRvZXMgbm90IGhhdmUgYSBoZWFsdGh5IEludGVybmV0IGNvbm5lY3Rpb24gYXQgdGhlIG1vbWVudC4gVGhlIGNsaWVudCB3aWxsIG9wZXJhdGUgaW4gb2ZmbGluZSBtb2RlIHVudGlsIGl0IGlzIGFibGUgdG8gc3VjY2Vzc2Z1bGx5IGNvbm5lY3QgdG8gdGhlIGJhY2tlbmQuYDtcbiAgICAgICAgdGhpcy5EXyA/IChfX1BSSVZBVEVfbG9nRXJyb3IodCksIHRoaXMuRF8gPSAhMSkgOiBfX1BSSVZBVEVfbG9nRGVidWcoXCJPbmxpbmVTdGF0ZVRyYWNrZXJcIiwgdCk7XG4gICAgfVxuICAgIHhfKCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLmJfICYmICh0aGlzLmJfLmNhbmNlbCgpLCB0aGlzLmJfID0gbnVsbCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUmVtb3RlU3RvcmVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgbG9jYWwgc3RvcmUsIHVzZWQgdG8gZmlsbCB0aGUgd3JpdGUgcGlwZWxpbmUgd2l0aCBvdXRib3VuZCBtdXRhdGlvbnMuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqIFRoZSBjbGllbnQtc2lkZSBwcm94eSBmb3IgaW50ZXJhY3Rpbmcgd2l0aCB0aGUgYmFja2VuZC4gKi9cbiAgICB0LCBuLCByLCBpKSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSA9IGUsIHRoaXMuZGF0YXN0b3JlID0gdCwgdGhpcy5hc3luY1F1ZXVlID0gbiwgdGhpcy5yZW1vdGVTeW5jZXIgPSB7fSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGxpc3Qgb2YgdXAgdG8gTUFYX1BFTkRJTkdfV1JJVEVTIHdyaXRlcyB0aGF0IHdlIGhhdmUgZmV0Y2hlZCBmcm9tIHRoZVxuICAgICAgICAgKiBMb2NhbFN0b3JlIHZpYSBmaWxsV3JpdGVQaXBlbGluZSgpIGFuZCBoYXZlIG9yIHdpbGwgc2VuZCB0byB0aGUgd3JpdGVcbiAgICAgICAgICogc3RyZWFtLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXaGVuZXZlciB3cml0ZVBpcGVsaW5lLmxlbmd0aCA+IDAgdGhlIFJlbW90ZVN0b3JlIHdpbGwgYXR0ZW1wdCB0byBzdGFydCBvclxuICAgICAgICAgKiByZXN0YXJ0IHRoZSB3cml0ZSBzdHJlYW0uIFdoZW4gdGhlIHN0cmVhbSBpcyBlc3RhYmxpc2hlZCB0aGUgd3JpdGVzIGluIHRoZVxuICAgICAgICAgKiBwaXBlbGluZSB3aWxsIGJlIHNlbnQgaW4gb3JkZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIFdyaXRlcyByZW1haW4gaW4gd3JpdGVQaXBlbGluZSB1bnRpbCB0aGV5IGFyZSBhY2tub3dsZWRnZWQgYnkgdGhlIGJhY2tlbmRcbiAgICAgICAgICogYW5kIHRodXMgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIHJlLXNlbnQgaWYgdGhlIHN0cmVhbSBpcyBpbnRlcnJ1cHRlZCAvXG4gICAgICAgICAqIHJlc3RhcnRlZCBiZWZvcmUgdGhleSdyZSBhY2tub3dsZWRnZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFdyaXRlIHJlc3BvbnNlcyBmcm9tIHRoZSBiYWNrZW5kIGFyZSBsaW5rZWQgdG8gdGhlaXIgb3JpZ2luYXRpbmcgcmVxdWVzdFxuICAgICAgICAgKiBwdXJlbHkgYmFzZWQgb24gb3JkZXIsIGFuZCBzbyB3ZSBjYW4ganVzdCBzaGlmdCgpIHdyaXRlcyBmcm9tIHRoZSBmcm9udCBvZlxuICAgICAgICAgKiB0aGUgd3JpdGVQaXBlbGluZSBhcyB3ZSByZWNlaXZlIHJlc3BvbnNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuT18gPSBbXSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIG1hcHBpbmcgb2Ygd2F0Y2hlZCB0YXJnZXRzIHRoYXQgdGhlIGNsaWVudCBjYXJlcyBhYm91dCB0cmFja2luZyBhbmQgdGhlXG4gICAgICAgICAqIHVzZXIgaGFzIGV4cGxpY2l0bHkgY2FsbGVkIGEgJ2xpc3RlbicgZm9yIHRoaXMgdGFyZ2V0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGVzZSB0YXJnZXRzIG1heSBvciBtYXkgbm90IGhhdmUgYmVlbiBzZW50IHRvIG9yIGFja25vd2xlZGdlZCBieSB0aGVcbiAgICAgICAgICogc2VydmVyLiBPbiByZS1lc3RhYmxpc2hpbmcgdGhlIGxpc3RlbiBzdHJlYW0sIHRoZXNlIHRhcmdldHMgc2hvdWxkIGJlIHNlbnRcbiAgICAgICAgICogdG8gdGhlIHNlcnZlci4gVGhlIHRhcmdldHMgcmVtb3ZlZCB3aXRoIHVubGlzdGVucyBhcmUgcmVtb3ZlZCBlYWdlcmx5XG4gICAgICAgICAqIHdpdGhvdXQgd2FpdGluZyBmb3IgY29uZmlybWF0aW9uIGZyb20gdGhlIGxpc3RlbiBzdHJlYW0uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLk5fID0gbmV3IE1hcCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHNldCBvZiByZWFzb25zIGZvciB3aHkgdGhlIFJlbW90ZVN0b3JlIG1heSBiZSBvZmZsaW5lLiBJZiBlbXB0eSwgdGhlXG4gICAgICAgICAqIFJlbW90ZVN0b3JlIG1heSBzdGFydCBpdHMgbmV0d29yayBjb25uZWN0aW9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuTF8gPSBuZXcgU2V0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEV2ZW50IGhhbmRsZXJzIHRoYXQgZ2V0IGNhbGxlZCB3aGVuIHRoZSBuZXR3b3JrIGlzIGRpc2FibGVkIG9yIGVuYWJsZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogVGhlc2UgZnVuY3Rpb25zIGFyZSB1c2VkIG9uIHRoZSBXZWIgY2xpZW50IHRvIGNyZWF0ZSB0aGVcbiAgICAgICAgICogdW5kZXJseWluZyBzdHJlYW1zICh0byBzdXBwb3J0IHRyZWUtc2hha2VhYmxlIHN0cmVhbXMpLiBPbiBBbmRyb2lkIGFuZCBpT1MsXG4gICAgICAgICAqIHRoZSBzdHJlYW1zIGFyZSBjcmVhdGVkIGR1cmluZyBjb25zdHJ1Y3Rpb24gb2YgUmVtb3RlU3RvcmUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkJfID0gW10sIHRoaXMua18gPSBpLCB0aGlzLmtfLl9vKChlID0+IHtcbiAgICAgICAgICAgIG4uZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFBvcnRpbmcgTm90ZTogVW5saWtlIGlPUywgYHJlc3RhcnROZXR3b3JrKClgIGlzIGNhbGxlZCBldmVuIHdoZW4gdGhlXG4gICAgICAgICAgICAgICAgLy8gbmV0d29yayBiZWNvbWVzIHVucmVhY2hhYmxlIGFzIHdlIGRvbid0IGhhdmUgYW55IG90aGVyIHdheSB0byB0ZWFyXG4gICAgICAgICAgICAgICAgLy8gZG93biBvdXIgc3RyZWFtcy5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfY2FuVXNlTmV0d29yayh0aGlzKSAmJiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiUmVtb3RlU3RvcmVcIiwgXCJSZXN0YXJ0aW5nIHN0cmVhbXMgZm9yIG5ldHdvcmsgcmVhY2hhYmlsaXR5IGNoYW5nZS5cIiksIFxuICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9yZXN0YXJ0TmV0d29yayhlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgICAgICAgICB0LkxfLmFkZCg0IC8qIE9mZmxpbmVDYXVzZS5Db25uZWN0aXZpdHlDaGFuZ2UgKi8pLCBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbCh0KSwgXG4gICAgICAgICAgICAgICAgICAgIHQucV8uc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pLCB0LkxfLmRlbGV0ZSg0IC8qIE9mZmxpbmVDYXVzZS5Db25uZWN0aXZpdHlDaGFuZ2UgKi8pLCBcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX2VuYWJsZU5ldHdvcmtJbnRlcm5hbCh0KTtcbiAgICAgICAgICAgICAgICB9KHRoaXMpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLCB0aGlzLnFfID0gbmV3IF9fUFJJVkFURV9PbmxpbmVTdGF0ZVRyYWNrZXIobiwgcik7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5hYmxlTmV0d29ya0ludGVybmFsKGUpIHtcbiAgICBpZiAoX19QUklWQVRFX2NhblVzZU5ldHdvcmsoZSkpIGZvciAoY29uc3QgdCBvZiBlLkJfKSBhd2FpdCB0KC8qIGVuYWJsZWQ9ICovICEwKTtcbn1cblxuLyoqXG4gKiBUZW1wb3JhcmlseSBkaXNhYmxlcyB0aGUgbmV0d29yay4gVGhlIG5ldHdvcmsgY2FuIGJlIHJlLWVuYWJsZWQgdXNpbmdcbiAqIGVuYWJsZU5ldHdvcmsoKS5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbChlKSB7XG4gICAgZm9yIChjb25zdCB0IG9mIGUuQl8pIGF3YWl0IHQoLyogZW5hYmxlZD0gKi8gITEpO1xufVxuXG4vKipcbiAqIFN0YXJ0cyBuZXcgbGlzdGVuIGZvciB0aGUgZ2l2ZW4gdGFyZ2V0LiBVc2VzIHJlc3VtZSB0b2tlbiBpZiBwcm92aWRlZC4gSXRcbiAqIGlzIGEgbm8tb3AgaWYgdGhlIHRhcmdldCBvZiBnaXZlbiBgVGFyZ2V0RGF0YWAgaXMgYWxyZWFkeSBiZWluZyBsaXN0ZW5lZCB0by5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3JlbW90ZVN0b3JlTGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBuLk5fLmhhcyh0LnRhcmdldElkKSB8fCAoXG4gICAgLy8gTWFyayB0aGlzIGFzIHNvbWV0aGluZyB0aGUgY2xpZW50IGlzIGN1cnJlbnRseSBsaXN0ZW5pbmcgZm9yLlxuICAgIG4uTl8uc2V0KHQudGFyZ2V0SWQsIHQpLCBfX1BSSVZBVEVfc2hvdWxkU3RhcnRXYXRjaFN0cmVhbShuKSA/IFxuICAgIC8vIFRoZSBsaXN0ZW4gd2lsbCBiZSBzZW50IGluIG9uV2F0Y2hTdHJlYW1PcGVuXG4gICAgX19QUklWQVRFX3N0YXJ0V2F0Y2hTdHJlYW0obikgOiBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hTdHJlYW0obikucl8oKSAmJiBfX1BSSVZBVEVfc2VuZFdhdGNoUmVxdWVzdChuLCB0KSk7XG59XG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgbGlzdGVuIGZyb20gc2VydmVyLiBJdCBpcyBhIG5vLW9wIGlmIHRoZSBnaXZlbiB0YXJnZXQgaWQgaXNcbiAqIG5vdCBiZWluZyBsaXN0ZW5lZCB0by5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3RlbihlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hTdHJlYW0obik7XG4gICAgbi5OXy5kZWxldGUodCksIHIucl8oKSAmJiBfX1BSSVZBVEVfc2VuZFVud2F0Y2hSZXF1ZXN0KG4sIHQpLCAwID09PSBuLk5fLnNpemUgJiYgKHIucl8oKSA/IHIub18oKSA6IF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKG4pICYmIFxuICAgIC8vIFJldmVydCB0byBPbmxpbmVTdGF0ZS5Vbmtub3duIGlmIHRoZSB3YXRjaCBzdHJlYW0gaXMgbm90IG9wZW4gYW5kIHdlXG4gICAgLy8gaGF2ZSBubyBsaXN0ZW5lcnMsIHNpbmNlIHdpdGhvdXQgYW55IGxpc3RlbnMgdG8gc2VuZCB3ZSBjYW5ub3RcbiAgICAvLyBjb25maXJtIGlmIHRoZSBzdHJlYW0gaXMgaGVhbHRoeSBhbmQgdXBncmFkZSB0byBPbmxpbmVTdGF0ZS5PbmxpbmUuXG4gICAgbi5xXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLykpO1xufVxuXG4vKipcbiAqIFdlIG5lZWQgdG8gaW5jcmVtZW50IHRoZSBleHBlY3RlZCBudW1iZXIgb2YgcGVuZGluZyByZXNwb25zZXMgd2UncmUgZHVlXG4gKiBmcm9tIHdhdGNoIHNvIHdlIHdhaXQgZm9yIHRoZSBhY2sgdG8gcHJvY2VzcyBhbnkgbWVzc2FnZXMgZnJvbSB0aGlzIHRhcmdldC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2VuZFdhdGNoUmVxdWVzdChlLCB0KSB7XG4gICAgaWYgKGUuUV8ueGUodC50YXJnZXRJZCksIHQucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCB8fCB0LnNuYXBzaG90VmVyc2lvbi5jb21wYXJlVG8oU25hcHNob3RWZXJzaW9uLm1pbigpKSA+IDApIHtcbiAgICAgICAgY29uc3QgbiA9IGUucmVtb3RlU3luY2VyLmdldFJlbW90ZUtleXNGb3JUYXJnZXQodC50YXJnZXRJZCkuc2l6ZTtcbiAgICAgICAgdCA9IHQud2l0aEV4cGVjdGVkQ291bnQobik7XG4gICAgfVxuICAgIF9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShlKS5BXyh0KTtcbn1cblxuLyoqXG4gKiBXZSBuZWVkIHRvIGluY3JlbWVudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHBlbmRpbmcgcmVzcG9uc2VzIHdlJ3JlIGR1ZVxuICogZnJvbSB3YXRjaCBzbyB3ZSB3YWl0IGZvciB0aGUgcmVtb3ZhbCBvbiB0aGUgc2VydmVyIGJlZm9yZSB3ZSBwcm9jZXNzIGFueVxuICogbWVzc2FnZXMgZnJvbSB0aGlzIHRhcmdldC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2VuZFVud2F0Y2hSZXF1ZXN0KGUsIHQpIHtcbiAgICBlLlFfLnhlKHQpLCBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hTdHJlYW0oZSkuUl8odCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zdGFydFdhdGNoU3RyZWFtKGUpIHtcbiAgICBlLlFfID0gbmV3IF9fUFJJVkFURV9XYXRjaENoYW5nZUFnZ3JlZ2F0b3Ioe1xuICAgICAgICBnZXRSZW1vdGVLZXlzRm9yVGFyZ2V0OiB0ID0+IGUucmVtb3RlU3luY2VyLmdldFJlbW90ZUtleXNGb3JUYXJnZXQodCksXG4gICAgICAgIG90OiB0ID0+IGUuTl8uZ2V0KHQpIHx8IG51bGwsXG4gICAgICAgIHR0OiAoKSA9PiBlLmRhdGFzdG9yZS5zZXJpYWxpemVyLmRhdGFiYXNlSWRcbiAgICB9KSwgX19QUklWQVRFX2Vuc3VyZVdhdGNoU3RyZWFtKGUpLnN0YXJ0KCksIGUucV8udl8oKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHdhdGNoIHN0cmVhbSBzaG91bGQgYmUgc3RhcnRlZCBiZWNhdXNlIGl0J3MgbmVjZXNzYXJ5XG4gKiBhbmQgaGFzIG5vdCB5ZXQgYmVlbiBzdGFydGVkLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9zaG91bGRTdGFydFdhdGNoU3RyZWFtKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2NhblVzZU5ldHdvcmsoZSkgJiYgIV9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShlKS5uXygpICYmIGUuTl8uc2l6ZSA+IDA7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKGUpIHtcbiAgICByZXR1cm4gMCA9PT0gX19QUklWQVRFX2RlYnVnQ2FzdChlKS5MXy5zaXplO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY2xlYW5VcFdhdGNoU3RyZWFtU3RhdGUoZSkge1xuICAgIGUuUV8gPSB2b2lkIDA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ29ubmVjdGVkKGUpIHtcbiAgICAvLyBNYXJrIHRoZSBjbGllbnQgYXMgb25saW5lIHNpbmNlIHdlIGdvdCBhIFwiY29ubmVjdGVkXCIgbm90aWZpY2F0aW9uLlxuICAgIGUucV8uc2V0KFwiT25saW5lXCIgLyogT25saW5lU3RhdGUuT25saW5lICovKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uV2F0Y2hTdHJlYW1PcGVuKGUpIHtcbiAgICBlLk5fLmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgIF9fUFJJVkFURV9zZW5kV2F0Y2hSZXF1ZXN0KGUsIHQpO1xuICAgIH0pKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uV2F0Y2hTdHJlYW1DbG9zZShlLCB0KSB7XG4gICAgX19QUklWQVRFX2NsZWFuVXBXYXRjaFN0cmVhbVN0YXRlKGUpLCBcbiAgICAvLyBJZiB3ZSBzdGlsbCBuZWVkIHRoZSB3YXRjaCBzdHJlYW0sIHJldHJ5IHRoZSBjb25uZWN0aW9uLlxuICAgIF9fUFJJVkFURV9zaG91bGRTdGFydFdhdGNoU3RyZWFtKGUpID8gKGUucV8uTV8odCksIF9fUFJJVkFURV9zdGFydFdhdGNoU3RyZWFtKGUpKSA6IFxuICAgIC8vIE5vIG5lZWQgdG8gcmVzdGFydCB3YXRjaCBzdHJlYW0gYmVjYXVzZSB0aGVyZSBhcmUgbm8gYWN0aXZlIHRhcmdldHMuXG4gICAgLy8gVGhlIG9ubGluZSBzdGF0ZSBpcyBzZXQgdG8gdW5rbm93biBiZWNhdXNlIHRoZXJlIGlzIG5vIGFjdGl2ZSBhdHRlbXB0XG4gICAgLy8gYXQgZXN0YWJsaXNoaW5nIGEgY29ubmVjdGlvblxuICAgIGUucV8uc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbUNoYW5nZShlLCB0LCBuKSB7XG4gICAgaWYgKFxuICAgIC8vIE1hcmsgdGhlIGNsaWVudCBhcyBvbmxpbmUgc2luY2Ugd2UgZ290IGEgbWVzc2FnZSBmcm9tIHRoZSBzZXJ2ZXJcbiAgICBlLnFfLnNldChcIk9ubGluZVwiIC8qIE9ubGluZVN0YXRlLk9ubGluZSAqLyksIHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfV2F0Y2hUYXJnZXRDaGFuZ2UgJiYgMiAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLlJlbW92ZWQgKi8gPT09IHQuc3RhdGUgJiYgdC5jYXVzZSkgXG4gICAgLy8gVGhlcmUgd2FzIGFuIGVycm9yIG9uIGEgdGFyZ2V0LCBkb24ndCB3YWl0IGZvciBhIGNvbnNpc3RlbnQgc25hcHNob3RcbiAgICAvLyB0byByYWlzZSBldmVudHNcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBcbiAgICAgICAgLyoqIEhhbmRsZXMgYW4gZXJyb3Igb24gYSB0YXJnZXQgKi9cbiAgICAgICAgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2hhbmRsZVRhcmdldEVycm9yKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmNhdXNlO1xuICAgICAgICAgICAgZm9yIChjb25zdCByIG9mIHQudGFyZ2V0SWRzKSBcbiAgICAgICAgICAgIC8vIEEgd2F0Y2hlZCB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuIHJlbW92ZWQgYWxyZWFkeS5cbiAgICAgICAgICAgIGUuTl8uaGFzKHIpICYmIChhd2FpdCBlLnJlbW90ZVN5bmNlci5yZWplY3RMaXN0ZW4ociwgbiksIGUuTl8uZGVsZXRlKHIpLCBlLlFfLnJlbW92ZVRhcmdldChyKSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBBdHRlbXB0cyB0byBmaWxsIG91ciB3cml0ZSBwaXBlbGluZSB3aXRoIHdyaXRlcyBmcm9tIHRoZSBMb2NhbFN0b3JlLlxuICpcbiAqIENhbGxlZCBpbnRlcm5hbGx5IHRvIGJvb3RzdHJhcCBvciByZWZpbGwgdGhlIHdyaXRlIHBpcGVsaW5lIGFuZCBieVxuICogU3luY0VuZ2luZSB3aGVuZXZlciB0aGVyZSBhcmUgbmV3IG11dGF0aW9ucyB0byBwcm9jZXNzLlxuICpcbiAqIFN0YXJ0cyB0aGUgd3JpdGUgc3RyZWFtIGlmIG5lY2Vzc2FyeS5cbiAqLyAoZSwgdCk7XG4gICAgfSBjYXRjaCAobikge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJSZW1vdGVTdG9yZVwiLCBcIkZhaWxlZCB0byByZW1vdmUgdGFyZ2V0cyAlczogJXMgXCIsIHQudGFyZ2V0SWRzLmpvaW4oXCIsXCIpLCBuKSwgXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya1VudGlsUmVjb3ZlcnkoZSwgbik7XG4gICAgfSBlbHNlIGlmICh0IGluc3RhbmNlb2YgX19QUklWQVRFX0RvY3VtZW50V2F0Y2hDaGFuZ2UgPyBlLlFfLktlKHQpIDogdCBpbnN0YW5jZW9mIF9fUFJJVkFURV9FeGlzdGVuY2VGaWx0ZXJDaGFuZ2UgPyBlLlFfLkhlKHQpIDogZS5RXy5XZSh0KSwgXG4gICAgIW4uaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpKSB0cnkge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVHZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUubG9jYWxTdG9yZSk7XG4gICAgICAgIG4uY29tcGFyZVRvKHQpID49IDAgJiYgXG4gICAgICAgIC8vIFdlIGhhdmUgcmVjZWl2ZWQgYSB0YXJnZXQgY2hhbmdlIHdpdGggYSBnbG9iYWwgc25hcHNob3QgaWYgdGhlIHNuYXBzaG90XG4gICAgICAgIC8vIHZlcnNpb24gaXMgbm90IGVxdWFsIHRvIFNuYXBzaG90VmVyc2lvbi5taW4oKS5cbiAgICAgICAgYXdhaXQgXG4gICAgICAgIC8qKlxuICogVGFrZXMgYSBiYXRjaCBvZiBjaGFuZ2VzIGZyb20gdGhlIERhdGFzdG9yZSwgcmVwYWNrYWdlcyB0aGVtIGFzIGFcbiAqIFJlbW90ZUV2ZW50LCBhbmQgcGFzc2VzIHRoYXQgb24gdG8gdGhlIGxpc3RlbmVyLCB3aGljaCBpcyB0eXBpY2FsbHkgdGhlXG4gKiBTeW5jRW5naW5lLlxuICovXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9yYWlzZVdhdGNoU25hcHNob3QoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IGUuUV8ucnQodCk7XG4gICAgICAgICAgICAvLyBVcGRhdGUgaW4tbWVtb3J5IHJlc3VtZSB0b2tlbnMuIExvY2FsU3RvcmUgd2lsbCB1cGRhdGUgdGhlXG4gICAgICAgICAgICAvLyBwZXJzaXN0ZW50IHZpZXcgb2YgdGhlc2Ugd2hlbiBhcHBseWluZyB0aGUgY29tcGxldGVkIFJlbW90ZUV2ZW50LlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4udGFyZ2V0Q2hhbmdlcy5mb3JFYWNoKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChuLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGUuTl8uZ2V0KHIpO1xuICAgICAgICAgICAgICAgICAgICAvLyBBIHdhdGNoZWQgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlbiByZW1vdmVkIGFscmVhZHkuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSAmJiBlLk5fLnNldChyLCBpLndpdGhSZXN1bWVUb2tlbihuLnJlc3VtZVRva2VuLCB0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpLCBcbiAgICAgICAgICAgIC8vIFJlLWVzdGFibGlzaCBsaXN0ZW5zIGZvciB0aGUgdGFyZ2V0cyB0aGF0IGhhdmUgYmVlbiBpbnZhbGlkYXRlZCBieVxuICAgICAgICAgICAgLy8gZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaGVzLlxuICAgICAgICAgICAgbi50YXJnZXRNaXNtYXRjaGVzLmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IGUuTl8uZ2V0KHQpO1xuICAgICAgICAgICAgICAgIGlmICghcikgXG4gICAgICAgICAgICAgICAgLy8gQSB3YXRjaGVkIHRhcmdldCBtaWdodCBoYXZlIGJlZW4gcmVtb3ZlZCBhbHJlYWR5LlxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAvLyBDbGVhciB0aGUgcmVzdW1lIHRva2VuIGZvciB0aGUgdGFyZ2V0LCBzaW5jZSB3ZSdyZSBpbiBhIGtub3duIG1pc21hdGNoXG4gICAgICAgICAgICAgICAgLy8gc3RhdGUuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuTl8uc2V0KHQsIHIud2l0aFJlc3VtZVRva2VuKEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkcsIHIuc25hcHNob3RWZXJzaW9uKSksIFxuICAgICAgICAgICAgICAgIC8vIENhdXNlIGEgaGFyZCByZXNldCBieSB1bndhdGNoaW5nIGFuZCByZXdhdGNoaW5nIGltbWVkaWF0ZWx5LCBidXRcbiAgICAgICAgICAgICAgICAvLyBkZWxpYmVyYXRlbHkgZG9uJ3Qgc2VuZCBhIHJlc3VtZSB0b2tlbiBzbyB0aGF0IHdlIGdldCBhIGZ1bGwgdXBkYXRlLlxuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9zZW5kVW53YXRjaFJlcXVlc3QoZSwgdCk7XG4gICAgICAgICAgICAgICAgLy8gTWFyayB0aGUgdGFyZ2V0IHdlIHNlbmQgYXMgYmVpbmcgb24gYmVoYWxmIG9mIGFuIGV4aXN0ZW5jZSBmaWx0ZXJcbiAgICAgICAgICAgICAgICAvLyBtaXNtYXRjaCwgYnV0IGRvbid0IGFjdHVhbGx5IHJldGFpbiB0aGF0IGluIGxpc3RlblRhcmdldHMuIFRoaXMgZW5zdXJlc1xuICAgICAgICAgICAgICAgIC8vIHRoYXQgd2UgZmxhZyB0aGUgZmlyc3QgcmUtbGlzdGVuIHRoaXMgd2F5IHdpdGhvdXQgaW1wYWN0aW5nIGZ1dHVyZVxuICAgICAgICAgICAgICAgIC8vIGxpc3RlbnMgb2YgdGhpcyB0YXJnZXQgKHRoYXQgbWlnaHQgaGFwcGVuIGUuZy4gb24gcmVjb25uZWN0KS5cbiAgICAgICAgICAgICAgICBjb25zdCBpID0gbmV3IFRhcmdldERhdGEoci50YXJnZXQsIHQsIG4sIHIuc2VxdWVuY2VOdW1iZXIpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9zZW5kV2F0Y2hSZXF1ZXN0KGUsIGkpO1xuICAgICAgICAgICAgfSkpLCBlLnJlbW90ZVN5bmNlci5hcHBseVJlbW90ZUV2ZW50KG4pO1xuICAgICAgICB9KGUsIG4pO1xuICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiUmVtb3RlU3RvcmVcIiwgXCJGYWlsZWQgdG8gcmFpc2Ugc25hcHNob3Q6XCIsIHQpLCBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtVbnRpbFJlY292ZXJ5KGUsIHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWNvdmVyeSBsb2dpYyBmb3IgSW5kZXhlZERCIGVycm9ycyB0aGF0IHRha2VzIHRoZSBuZXR3b3JrIG9mZmxpbmUgdW50aWxcbiAqIGBvcGAgc3VjY2VlZHMuIFJldHJpZXMgYXJlIHNjaGVkdWxlZCB3aXRoIGJhY2tvZmYgdXNpbmdcbiAqIGBlbnF1ZXVlUmV0cnlhYmxlKClgLiBJZiBgb3AoKWAgaXMgbm90IHByb3ZpZGVkLCBJbmRleGVkREIgYWNjZXNzIGlzXG4gKiB2YWxpZGF0ZWQgdmlhIGEgZ2VuZXJpYyBvcGVyYXRpb24uXG4gKlxuICogVGhlIHJldHVybmVkIFByb21pc2UgaXMgcmVzb2x2ZWQgb25jZSB0aGUgbmV0d29yayBpcyBkaXNhYmxlZCBhbmQgYmVmb3JlXG4gKiBhbnkgcmV0cnkgYXR0ZW1wdC5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtVbnRpbFJlY292ZXJ5KGUsIHQsIG4pIHtcbiAgICBpZiAoIV9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IodCkpIHRocm93IHQ7XG4gICAgZS5MXy5hZGQoMSAvKiBPZmZsaW5lQ2F1c2UuSW5kZXhlZERiRmFpbGVkICovKSwgXG4gICAgLy8gRGlzYWJsZSBuZXR3b3JrIGFuZCByYWlzZSBvZmZsaW5lIHNuYXBzaG90c1xuICAgIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKGUpLCBlLnFfLnNldChcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovKSwgXG4gICAgbiB8fCAoXG4gICAgLy8gVXNlIGEgc2ltcGxlIHJlYWQgb3BlcmF0aW9uIHRvIGRldGVybWluZSBpZiBJbmRleGVkREIgcmVjb3ZlcmVkLlxuICAgIC8vIElkZWFsbHksIHdlIHdvdWxkIGV4cG9zZSBhIGhlYWx0aCBjaGVjayBkaXJlY3RseSBvbiBTaW1wbGVEYiwgYnV0XG4gICAgLy8gUmVtb3RlU3RvcmUgb25seSBoYXMgYWNjZXNzIHRvIHBlcnNpc3RlbmNlIHRocm91Z2ggTG9jYWxTdG9yZS5cbiAgICBuID0gKCkgPT4gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUubG9jYWxTdG9yZSkpLCBcbiAgICAvLyBQcm9iZSBJbmRleGVkREIgcGVyaW9kaWNhbGx5IGFuZCByZS1lbmFibGUgbmV0d29ya1xuICAgIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlJlbW90ZVN0b3JlXCIsIFwiUmV0cnlpbmcgSW5kZXhlZERCIGFjY2Vzc1wiKSwgYXdhaXQgbigpLCBlLkxfLmRlbGV0ZSgxIC8qIE9mZmxpbmVDYXVzZS5JbmRleGVkRGJGYWlsZWQgKi8pLCBcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2VuYWJsZU5ldHdvcmtJbnRlcm5hbChlKTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogRXhlY3V0ZXMgYG9wYC4gSWYgYG9wYCBmYWlscywgdGFrZXMgdGhlIG5ldHdvcmsgb2ZmbGluZSB1bnRpbCBgb3BgXG4gKiBzdWNjZWVkcy4gUmV0dXJucyBhZnRlciB0aGUgZmlyc3QgYXR0ZW1wdC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZXhlY3V0ZVdpdGhSZWNvdmVyeShlLCB0KSB7XG4gICAgcmV0dXJuIHQoKS5jYXRjaCgobiA9PiBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtVbnRpbFJlY292ZXJ5KGUsIG4sIHQpKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIG4gPSBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0odCk7XG4gICAgbGV0IHIgPSB0Lk9fLmxlbmd0aCA+IDAgPyB0Lk9fW3QuT18ubGVuZ3RoIC0gMV0uYmF0Y2hJZCA6IC0xO1xuICAgIGZvciAoO19fUFJJVkFURV9jYW5BZGRUb1dyaXRlUGlwZWxpbmUodCk7ICkgdHJ5IHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TmV4dE11dGF0aW9uQmF0Y2godC5sb2NhbFN0b3JlLCByKTtcbiAgICAgICAgaWYgKG51bGwgPT09IGUpIHtcbiAgICAgICAgICAgIDAgPT09IHQuT18ubGVuZ3RoICYmIG4ub18oKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHIgPSBlLmJhdGNoSWQsIF9fUFJJVkFURV9hZGRUb1dyaXRlUGlwZWxpbmUodCwgZSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtVbnRpbFJlY292ZXJ5KHQsIGUpO1xuICAgIH1cbiAgICBfX1BSSVZBVEVfc2hvdWxkU3RhcnRXcml0ZVN0cmVhbSh0KSAmJiBfX1BSSVZBVEVfc3RhcnRXcml0ZVN0cmVhbSh0KTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgd2UgY2FuIGFkZCB0byB0aGUgd3JpdGUgcGlwZWxpbmUgKGkuZS4gdGhlIG5ldHdvcmsgaXNcbiAqIGVuYWJsZWQgYW5kIHRoZSB3cml0ZSBwaXBlbGluZSBpcyBub3QgZnVsbCkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NhbkFkZFRvV3JpdGVQaXBlbGluZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKGUpICYmIGUuT18ubGVuZ3RoIDwgMTA7XG59XG5cbi8qKlxuICogUXVldWVzIGFkZGl0aW9uYWwgd3JpdGVzIHRvIGJlIHNlbnQgdG8gdGhlIHdyaXRlIHN0cmVhbSwgc2VuZGluZyB0aGVtXG4gKiBpbW1lZGlhdGVseSBpZiB0aGUgd3JpdGUgc3RyZWFtIGlzIGVzdGFibGlzaGVkLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hZGRUb1dyaXRlUGlwZWxpbmUoZSwgdCkge1xuICAgIGUuT18ucHVzaCh0KTtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpO1xuICAgIG4ucl8oKSAmJiBuLlZfICYmIG4ubV8odC5tdXRhdGlvbnMpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc2hvdWxkU3RhcnRXcml0ZVN0cmVhbShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKGUpICYmICFfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSkubl8oKSAmJiBlLk9fLmxlbmd0aCA+IDA7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zdGFydFdyaXRlU3RyZWFtKGUpIHtcbiAgICBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSkuc3RhcnQoKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uV3JpdGVTdHJlYW1PcGVuKGUpIHtcbiAgICBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSkucF8oKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uV3JpdGVIYW5kc2hha2VDb21wbGV0ZShlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9lbnN1cmVXcml0ZVN0cmVhbShlKTtcbiAgICAvLyBTZW5kIHRoZSB3cml0ZSBwaXBlbGluZSBub3cgdGhhdCB0aGUgc3RyZWFtIGlzIGVzdGFibGlzaGVkLlxuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZS5PXykgdC5tXyhuLm11dGF0aW9ucyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbk11dGF0aW9uUmVzdWx0KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gZS5PXy5zaGlmdCgpLCBpID0gTXV0YXRpb25CYXRjaFJlc3VsdC5mcm9tKHIsIHQsIG4pO1xuICAgIGF3YWl0IF9fUFJJVkFURV9leGVjdXRlV2l0aFJlY292ZXJ5KGUsICgoKSA9PiBlLnJlbW90ZVN5bmNlci5hcHBseVN1Y2Nlc3NmdWxXcml0ZShpKSkpLCBcbiAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgd2l0aCB0aGUgY29tcGxldGlvbiBvZiB0aGlzIG11dGF0aW9uIGFub3RoZXJcbiAgICAvLyBzbG90IGhhcyBmcmVlZCB1cC5cbiAgICBhd2FpdCBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUoZSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbldyaXRlU3RyZWFtQ2xvc2UoZSwgdCkge1xuICAgIC8vIElmIHRoZSB3cml0ZSBzdHJlYW0gY2xvc2VkIGFmdGVyIHRoZSB3cml0ZSBoYW5kc2hha2UgY29tcGxldGVzLCBhIHdyaXRlXG4gICAgLy8gb3BlcmF0aW9uIGZhaWxlZCBhbmQgd2UgZmFpbCB0aGUgcGVuZGluZyBvcGVyYXRpb24uXG4gICAgdCAmJiBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSkuVl8gJiYgXG4gICAgLy8gVGhpcyBlcnJvciBhZmZlY3RzIHRoZSBhY3R1YWwgd3JpdGUuXG4gICAgYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2hhbmRsZVdyaXRlRXJyb3IoZSwgdCkge1xuICAgICAgICAvLyBPbmx5IGhhbmRsZSBwZXJtYW5lbnQgZXJyb3JzIGhlcmUuIElmIGl0J3MgdHJhbnNpZW50LCBqdXN0IGxldCB0aGUgcmV0cnlcbiAgICAgICAgLy8gbG9naWMga2ljayBpbi5cbiAgICAgICAgaWYgKGZ1bmN0aW9uIF9fUFJJVkFURV9pc1Blcm1hbmVudFdyaXRlRXJyb3IoZSkge1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9pc1Blcm1hbmVudEVycm9yKGUpICYmIGUgIT09IEQuQUJPUlRFRDtcbiAgICAgICAgfSh0LmNvZGUpKSB7XG4gICAgICAgICAgICAvLyBUaGlzIHdhcyBhIHBlcm1hbmVudCBlcnJvciwgdGhlIHJlcXVlc3QgaXRzZWxmIHdhcyB0aGUgcHJvYmxlbVxuICAgICAgICAgICAgLy8gc28gaXQncyBub3QgZ29pbmcgdG8gc3VjY2VlZCBpZiB3ZSByZXNlbmQgaXQuXG4gICAgICAgICAgICBjb25zdCBuID0gZS5PXy5zaGlmdCgpO1xuICAgICAgICAgICAgLy8gSW4gdGhpcyBjYXNlIGl0J3MgYWxzbyB1bmxpa2VseSB0aGF0IHRoZSBzZXJ2ZXIgaXRzZWxmIGlzIG1lbHRpbmdcbiAgICAgICAgICAgIC8vIGRvd24gLS0gdGhpcyB3YXMganVzdCBhIGJhZCByZXF1ZXN0IHNvIGluaGliaXQgYmFja29mZiBvbiB0aGUgbmV4dFxuICAgICAgICAgICAgLy8gcmVzdGFydC5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9lbnN1cmVXcml0ZVN0cmVhbShlKS5zXygpLCBhd2FpdCBfX1BSSVZBVEVfZXhlY3V0ZVdpdGhSZWNvdmVyeShlLCAoKCkgPT4gZS5yZW1vdGVTeW5jZXIucmVqZWN0RmFpbGVkV3JpdGUobi5iYXRjaElkLCB0KSkpLCBcbiAgICAgICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aXRoIHRoZSBjb21wbGV0aW9uIG9mIHRoaXMgbXV0YXRpb25cbiAgICAgICAgICAgIC8vIGFub3RoZXIgc2xvdCBoYXMgZnJlZWQgdXAuXG4gICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUoZSk7XG4gICAgICAgIH1cbiAgICB9KGUsIHQpLCBcbiAgICAvLyBUaGUgd3JpdGUgc3RyZWFtIG1pZ2h0IGhhdmUgYmVlbiBzdGFydGVkIGJ5IHJlZmlsbGluZyB0aGUgd3JpdGVcbiAgICAvLyBwaXBlbGluZSBmb3IgZmFpbGVkIHdyaXRlc1xuICAgIF9fUFJJVkFURV9zaG91bGRTdGFydFdyaXRlU3RyZWFtKGUpICYmIF9fUFJJVkFURV9zdGFydFdyaXRlU3RyZWFtKGUpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVIYW5kbGVDcmVkZW50aWFsQ2hhbmdlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBuLmFzeW5jUXVldWUudmVyaWZ5T3BlcmF0aW9uSW5Qcm9ncmVzcygpLCBfX1BSSVZBVEVfbG9nRGVidWcoXCJSZW1vdGVTdG9yZVwiLCBcIlJlbW90ZVN0b3JlIHJlY2VpdmVkIG5ldyBjcmVkZW50aWFsc1wiKTtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2NhblVzZU5ldHdvcmsobik7XG4gICAgLy8gVGVhciBkb3duIGFuZCByZS1jcmVhdGUgb3VyIG5ldHdvcmsgc3RyZWFtcy4gVGhpcyB3aWxsIGVuc3VyZSB3ZSBnZXQgYVxuICAgIC8vIGZyZXNoIGF1dGggdG9rZW4gZm9yIHRoZSBuZXcgdXNlciBhbmQgcmUtZmlsbCB0aGUgd3JpdGUgcGlwZWxpbmUgd2l0aFxuICAgIC8vIG5ldyBtdXRhdGlvbnMgZnJvbSB0aGUgTG9jYWxTdG9yZSAoc2luY2UgbXV0YXRpb25zIGFyZSBwZXItdXNlcikuXG4gICAgICAgIG4uTF8uYWRkKDMgLyogT2ZmbGluZUNhdXNlLkNyZWRlbnRpYWxDaGFuZ2UgKi8pLCBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbChuKSwgXG4gICAgciAmJiBcbiAgICAvLyBEb24ndCBzZXQgdGhlIG5ldHdvcmsgc3RhdHVzIHRvIFVua25vd24gaWYgd2UgYXJlIG9mZmxpbmUuXG4gICAgbi5xXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyksIGF3YWl0IG4ucmVtb3RlU3luY2VyLmhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UodCksIFxuICAgIG4uTF8uZGVsZXRlKDMgLyogT2ZmbGluZUNhdXNlLkNyZWRlbnRpYWxDaGFuZ2UgKi8pLCBhd2FpdCBfX1BSSVZBVEVfZW5hYmxlTmV0d29ya0ludGVybmFsKG4pO1xufVxuXG4vKipcbiAqIFRvZ2dsZXMgdGhlIG5ldHdvcmsgc3RhdGUgd2hlbiB0aGUgY2xpZW50IGdhaW5zIG9yIGxvc2VzIGl0cyBwcmltYXJ5IGxlYXNlLlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVTdG9yZUFwcGx5UHJpbWFyeVN0YXRlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICB0ID8gKG4uTF8uZGVsZXRlKDIgLyogT2ZmbGluZUNhdXNlLklzU2Vjb25kYXJ5ICovKSwgYXdhaXQgX19QUklWQVRFX2VuYWJsZU5ldHdvcmtJbnRlcm5hbChuKSkgOiB0IHx8IChuLkxfLmFkZCgyIC8qIE9mZmxpbmVDYXVzZS5Jc1NlY29uZGFyeSAqLyksIFxuICAgIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKG4pLCBuLnFfLnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKSk7XG59XG5cbi8qKlxuICogSWYgbm90IHlldCBpbml0aWFsaXplZCwgcmVnaXN0ZXJzIHRoZSBXYXRjaFN0cmVhbSBhbmQgaXRzIG5ldHdvcmsgc3RhdGVcbiAqIGNhbGxiYWNrIHdpdGggYHJlbW90ZVN0b3JlSW1wbGAuIFJldHVybnMgdGhlIGV4aXN0aW5nIHN0cmVhbSBpZiBvbmUgaXNcbiAqIGFscmVhZHkgYXZhaWxhYmxlLlxuICpcbiAqIFBPUlRJTkcgTk9URTogT24gaU9TIGFuZCBBbmRyb2lkLCB0aGUgV2F0Y2hTdHJlYW0gZ2V0cyByZWdpc3RlcmVkIG9uIHN0YXJ0dXAuXG4gKiBUaGlzIGlzIG5vdCBkb25lIG9uIFdlYiB0byBhbGxvdyBpdCB0byBiZSB0cmVlLXNoYWtlbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hTdHJlYW0oZSkge1xuICAgIHJldHVybiBlLktfIHx8IChcbiAgICAvLyBDcmVhdGUgc3RyZWFtIChidXQgbm90ZSB0aGF0IGl0IGlzIG5vdCBzdGFydGVkIHlldCkuXG4gICAgZS5LXyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdQZXJzaXN0ZW50V2F0Y2hTdHJlYW0oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgcmV0dXJuIHIud18oKSwgbmV3IF9fUFJJVkFURV9QZXJzaXN0ZW50TGlzdGVuU3RyZWFtKHQsIHIuY29ubmVjdGlvbiwgci5hdXRoQ3JlZGVudGlhbHMsIHIuYXBwQ2hlY2tDcmVkZW50aWFscywgci5zZXJpYWxpemVyLCBuKTtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKGUuZGF0YXN0b3JlLCBlLmFzeW5jUXVldWUsIHtcbiAgICAgICAgRW86IF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ29ubmVjdGVkLmJpbmQobnVsbCwgZSksXG4gICAgICAgIFJvOiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbU9wZW4uYmluZChudWxsLCBlKSxcbiAgICAgICAgbW86IF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ2xvc2UuYmluZChudWxsLCBlKSxcbiAgICAgICAgZF86IF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ2hhbmdlLmJpbmQobnVsbCwgZSlcbiAgICB9KSwgZS5CXy5wdXNoKChhc3luYyB0ID0+IHtcbiAgICAgICAgdCA/IChlLktfLnNfKCksIF9fUFJJVkFURV9zaG91bGRTdGFydFdhdGNoU3RyZWFtKGUpID8gX19QUklWQVRFX3N0YXJ0V2F0Y2hTdHJlYW0oZSkgOiBlLnFfLnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKSkgOiAoYXdhaXQgZS5LXy5zdG9wKCksIFxuICAgICAgICBfX1BSSVZBVEVfY2xlYW5VcFdhdGNoU3RyZWFtU3RhdGUoZSkpO1xuICAgIH0pKSksIGUuS187XG59XG5cbi8qKlxuICogSWYgbm90IHlldCBpbml0aWFsaXplZCwgcmVnaXN0ZXJzIHRoZSBXcml0ZVN0cmVhbSBhbmQgaXRzIG5ldHdvcmsgc3RhdGVcbiAqIGNhbGxiYWNrIHdpdGggYHJlbW90ZVN0b3JlSW1wbGAuIFJldHVybnMgdGhlIGV4aXN0aW5nIHN0cmVhbSBpZiBvbmUgaXNcbiAqIGFscmVhZHkgYXZhaWxhYmxlLlxuICpcbiAqIFBPUlRJTkcgTk9URTogT24gaU9TIGFuZCBBbmRyb2lkLCB0aGUgV3JpdGVTdHJlYW0gZ2V0cyByZWdpc3RlcmVkIG9uIHN0YXJ0dXAuXG4gKiBUaGlzIGlzIG5vdCBkb25lIG9uIFdlYiB0byBhbGxvdyBpdCB0byBiZSB0cmVlLXNoYWtlbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSkge1xuICAgIHJldHVybiBlLlVfIHx8IChcbiAgICAvLyBDcmVhdGUgc3RyZWFtIChidXQgbm90ZSB0aGF0IGl0IGlzIG5vdCBzdGFydGVkIHlldCkuXG4gICAgZS5VXyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdQZXJzaXN0ZW50V3JpdGVTdHJlYW0oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgcmV0dXJuIHIud18oKSwgbmV3IF9fUFJJVkFURV9QZXJzaXN0ZW50V3JpdGVTdHJlYW0odCwgci5jb25uZWN0aW9uLCByLmF1dGhDcmVkZW50aWFscywgci5hcHBDaGVja0NyZWRlbnRpYWxzLCByLnNlcmlhbGl6ZXIsIG4pO1xuICAgIH0oZS5kYXRhc3RvcmUsIGUuYXN5bmNRdWV1ZSwge1xuICAgICAgICBFbzogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCksXG4gICAgICAgIFJvOiBfX1BSSVZBVEVfb25Xcml0ZVN0cmVhbU9wZW4uYmluZChudWxsLCBlKSxcbiAgICAgICAgbW86IF9fUFJJVkFURV9vbldyaXRlU3RyZWFtQ2xvc2UuYmluZChudWxsLCBlKSxcbiAgICAgICAgZl86IF9fUFJJVkFURV9vbldyaXRlSGFuZHNoYWtlQ29tcGxldGUuYmluZChudWxsLCBlKSxcbiAgICAgICAgZ186IF9fUFJJVkFURV9vbk11dGF0aW9uUmVzdWx0LmJpbmQobnVsbCwgZSlcbiAgICB9KSwgZS5CXy5wdXNoKChhc3luYyB0ID0+IHtcbiAgICAgICAgdCA/IChlLlVfLnNfKCksIFxuICAgICAgICAvLyBUaGlzIHdpbGwgc3RhcnQgdGhlIHdyaXRlIHN0cmVhbSBpZiBuZWNlc3NhcnkuXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShlKSkgOiAoYXdhaXQgZS5VXy5zdG9wKCksIGUuT18ubGVuZ3RoID4gMCAmJiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiUmVtb3RlU3RvcmVcIiwgYFN0b3BwaW5nIHdyaXRlIHN0cmVhbSB3aXRoICR7ZS5PXy5sZW5ndGh9IHBlbmRpbmcgd3JpdGVzYCksIFxuICAgICAgICBlLk9fID0gW10pKTtcbiAgICB9KSkpLCBlLlVfO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGFuIG9wZXJhdGlvbiBzY2hlZHVsZWQgdG8gYmUgcnVuIGluIHRoZSBmdXR1cmUgb24gYW4gQXN5bmNRdWV1ZS5cbiAqXG4gKiBJdCBpcyBjcmVhdGVkIHZpYSBEZWxheWVkT3BlcmF0aW9uLmNyZWF0ZUFuZFNjaGVkdWxlKCkuXG4gKlxuICogU3VwcG9ydHMgY2FuY2VsbGF0aW9uICh2aWEgY2FuY2VsKCkpIGFuZCBlYXJseSBleGVjdXRpb24gKHZpYSBza2lwRGVsYXkoKSkuXG4gKlxuICogTm90ZTogV2UgaW1wbGVtZW50IGBQcm9taXNlTGlrZWAgaW5zdGVhZCBvZiBgUHJvbWlzZWAsIGFzIHRoZSBgUHJvbWlzZWAgdHlwZVxuICogaW4gbmV3ZXIgdmVyc2lvbnMgb2YgVHlwZVNjcmlwdCBkZWZpbmVzIGBmaW5hbGx5YCwgd2hpY2ggaXMgbm90IGF2YWlsYWJsZSBpblxuICogSUUuXG4gKi9cbmNsYXNzIERlbGF5ZWRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gZSwgdGhpcy50aW1lcklkID0gdCwgdGhpcy50YXJnZXRUaW1lTXMgPSBuLCB0aGlzLm9wID0gciwgdGhpcy5yZW1vdmFsQ2FsbGJhY2sgPSBpLCBcbiAgICAgICAgdGhpcy5kZWZlcnJlZCA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIHRoaXMudGhlbiA9IHRoaXMuZGVmZXJyZWQucHJvbWlzZS50aGVuLmJpbmQodGhpcy5kZWZlcnJlZC5wcm9taXNlKSwgXG4gICAgICAgIC8vIEl0J3Mgbm9ybWFsIGZvciB0aGUgZGVmZXJyZWQgcHJvbWlzZSB0byBiZSBjYW5jZWxlZCAoZHVlIHRvIGNhbmNlbGxhdGlvbilcbiAgICAgICAgLy8gYW5kIHNvIHdlIGF0dGFjaCBhIGR1bW15IGNhdGNoIGNhbGxiYWNrIHRvIGF2b2lkXG4gICAgICAgIC8vICdVbmhhbmRsZWRQcm9taXNlUmVqZWN0aW9uV2FybmluZycgbG9nIHNwYW0uXG4gICAgICAgIHRoaXMuZGVmZXJyZWQucHJvbWlzZS5jYXRjaCgoZSA9PiB7fSkpO1xuICAgIH1cbiAgICBnZXQgcHJvbWlzZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIERlbGF5ZWRPcGVyYXRpb24gdGhhdCBoYXMgYmVlbiBzY2hlZHVsZWQgdG8gYmVcbiAgICAgKiBleGVjdXRlZCBvbiB0aGUgcHJvdmlkZWQgYXN5bmNRdWV1ZSBhZnRlciB0aGUgcHJvdmlkZWQgZGVsYXlNcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhc3luY1F1ZXVlIC0gVGhlIHF1ZXVlIHRvIHNjaGVkdWxlIHRoZSBvcGVyYXRpb24gb24uXG4gICAgICogQHBhcmFtIGlkIC0gQSBUaW1lciBJRCBpZGVudGlmeWluZyB0aGUgdHlwZSBvZiBvcGVyYXRpb24gdGhpcyBpcy5cbiAgICAgKiBAcGFyYW0gZGVsYXlNcyAtIFRoZSBkZWxheSAobXMpIGJlZm9yZSB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBzY2hlZHVsZWQuXG4gICAgICogQHBhcmFtIG9wIC0gVGhlIG9wZXJhdGlvbiB0byBydW4uXG4gICAgICogQHBhcmFtIHJlbW92YWxDYWxsYmFjayAtIEEgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgb25jZSB0aGVcbiAgICAgKiAgIG9wZXJhdGlvbiBpcyBleGVjdXRlZCBvciBjYW5jZWxlZCwgbm90aWZ5aW5nIHRoZSBBc3luY1F1ZXVlIHRvIHJlbW92ZSBpdFxuICAgICAqICAgZnJvbSBpdHMgZGVsYXllZE9wZXJhdGlvbnMgbGlzdC5cbiAgICAgKiAgIFBPUlRJTkcgTk9URTogVGhpcyBleGlzdHMgdG8gcHJldmVudCBtYWtpbmcgcmVtb3ZlRGVsYXllZE9wZXJhdGlvbigpIGFuZFxuICAgICAqICAgdGhlIERlbGF5ZWRPcGVyYXRpb24gY2xhc3MgcHVibGljLlxuICAgICAqLyAgICBzdGF0aWMgY3JlYXRlQW5kU2NoZWR1bGUoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBjb25zdCBzID0gRGF0ZS5ub3coKSArIG4sIG8gPSBuZXcgRGVsYXllZE9wZXJhdGlvbihlLCB0LCBzLCByLCBpKTtcbiAgICAgICAgcmV0dXJuIG8uc3RhcnQobiksIG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXJ0cyB0aGUgdGltZXIuIFRoaXMgaXMgY2FsbGVkIGltbWVkaWF0ZWx5IGFmdGVyIGNvbnN0cnVjdGlvbiBieVxuICAgICAqIGNyZWF0ZUFuZFNjaGVkdWxlKCkuXG4gICAgICovICAgIHN0YXJ0KGUpIHtcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IHNldFRpbWVvdXQoKCgpID0+IHRoaXMuaGFuZGxlRGVsYXlFbGFwc2VkKCkpLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUXVldWVzIHRoZSBvcGVyYXRpb24gdG8gcnVuIGltbWVkaWF0ZWx5IChpZiBpdCBoYXNuJ3QgYWxyZWFkeSBiZWVuIHJ1biBvclxuICAgICAqIGNhbmNlbGVkKS5cbiAgICAgKi8gICAgc2tpcERlbGF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVEZWxheUVsYXBzZWQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FuY2VscyB0aGUgb3BlcmF0aW9uIGlmIGl0IGhhc24ndCBhbHJlYWR5IGJlZW4gZXhlY3V0ZWQgb3IgY2FuY2VsZWQuIFRoZVxuICAgICAqIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZC5cbiAgICAgKlxuICAgICAqIEFzIGxvbmcgYXMgdGhlIG9wZXJhdGlvbiBoYXMgbm90IHlldCBiZWVuIHJ1biwgY2FsbGluZyBjYW5jZWwoKSBwcm92aWRlcyBhXG4gICAgICogZ3VhcmFudGVlIHRoYXQgdGhlIG9wZXJhdGlvbiB3aWxsIG5vdCBiZSBydW4uXG4gICAgICovICAgIGNhbmNlbChlKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMudGltZXJIYW5kbGUgJiYgKHRoaXMuY2xlYXJUaW1lb3V0KCksIHRoaXMuZGVmZXJyZWQucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcihELkNBTkNFTExFRCwgXCJPcGVyYXRpb24gY2FuY2VsbGVkXCIgKyAoZSA/IFwiOiBcIiArIGUgOiBcIlwiKSkpKTtcbiAgICB9XG4gICAgaGFuZGxlRGVsYXlFbGFwc2VkKCkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gbnVsbCAhPT0gdGhpcy50aW1lckhhbmRsZSA/ICh0aGlzLmNsZWFyVGltZW91dCgpLCBcbiAgICAgICAgdGhpcy5vcCgpLnRoZW4oKGUgPT4gdGhpcy5kZWZlcnJlZC5yZXNvbHZlKGUpKSkpIDogUHJvbWlzZS5yZXNvbHZlKCkpKTtcbiAgICB9XG4gICAgY2xlYXJUaW1lb3V0KCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLnRpbWVySGFuZGxlICYmICh0aGlzLnJlbW92YWxDYWxsYmFjayh0aGlzKSwgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJIYW5kbGUpLCBcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgRmlyZXN0b3JlRXJyb3IgdGhhdCBjYW4gYmUgc3VyZmFjZWQgdG8gdGhlIHVzZXIgaWYgdGhlIHByb3ZpZGVkXG4gKiBlcnJvciBpcyBhbiBJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yLiBSZS10aHJvd3MgdGhlIGVycm9yIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCB0KSB7XG4gICAgaWYgKF9fUFJJVkFURV9sb2dFcnJvcihcIkFzeW5jUXVldWVcIiwgYCR7dH06ICR7ZX1gKSwgX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgcmV0dXJuIG5ldyBGaXJlc3RvcmVFcnJvcihELlVOQVZBSUxBQkxFLCBgJHt0fTogJHtlfWApO1xuICAgIHRocm93IGU7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50U2V0IGlzIGFuIGltbXV0YWJsZSAoY29weS1vbi13cml0ZSkgY29sbGVjdGlvbiB0aGF0IGhvbGRzIGRvY3VtZW50c1xuICogaW4gb3JkZXIgc3BlY2lmaWVkIGJ5IHRoZSBwcm92aWRlZCBjb21wYXJhdG9yLiBXZSBhbHdheXMgYWRkIGEgZG9jdW1lbnQga2V5XG4gKiBjb21wYXJhdG9yIG9uIHRvcCBvZiB3aGF0IGlzIHByb3ZpZGVkIHRvIGd1YXJhbnRlZSBkb2N1bWVudCBlcXVhbGl0eSBiYXNlZCBvblxuICogdGhlIGtleS5cbiAqLyBjbGFzcyBEb2N1bWVudFNldCB7XG4gICAgLyoqIFRoZSBkZWZhdWx0IG9yZGVyaW5nIGlzIGJ5IGtleSBpZiB0aGUgY29tcGFyYXRvciBpcyBvbWl0dGVkICovXG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICAvLyBXZSBhcmUgYWRkaW5nIGRvY3VtZW50IGtleSBjb21wYXJhdG9yIHRvIHRoZSBlbmQgYXMgaXQncyB0aGUgb25seVxuICAgICAgICAvLyBndWFyYW50ZWVkIHVuaXF1ZSBwcm9wZXJ0eSBvZiBhIGRvY3VtZW50LlxuICAgICAgICB0aGlzLmNvbXBhcmF0b3IgPSBlID8gKHQsIG4pID0+IGUodCwgbikgfHwgRG9jdW1lbnRLZXkuY29tcGFyYXRvcih0LmtleSwgbi5rZXkpIDogKGUsIHQpID0+IERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5rZXksIHQua2V5KSwgXG4gICAgICAgIHRoaXMua2V5ZWRNYXAgPSBkb2N1bWVudE1hcCgpLCB0aGlzLnNvcnRlZFNldCA9IG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBlbXB0eSBjb3B5IG9mIHRoZSBleGlzdGluZyBEb2N1bWVudFNldCwgdXNpbmcgdGhlIHNhbWVcbiAgICAgKiBjb21wYXJhdG9yLlxuICAgICAqLyAgICBzdGF0aWMgZW1wdHlTZXQoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50U2V0KGUuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIGhhcyhlKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9IHRoaXMua2V5ZWRNYXAuZ2V0KGUpO1xuICAgIH1cbiAgICBnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5rZXllZE1hcC5nZXQoZSk7XG4gICAgfVxuICAgIGZpcnN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQubWluS2V5KCk7XG4gICAgfVxuICAgIGxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRlZFNldC5tYXhLZXkoKTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydGVkU2V0LmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIHByb3ZpZGVkIGtleSBpbiB0aGUgZG9jdW1lbnQgc2V0LCBvciAtMSBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBrZXkgaXMgbm90IHByZXNlbnQgaW4gdGhlIHNldDtcbiAgICAgKi8gICAgaW5kZXhPZihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmtleWVkTWFwLmdldChlKTtcbiAgICAgICAgcmV0dXJuIHQgPyB0aGlzLnNvcnRlZFNldC5pbmRleE9mKHQpIDogLTE7XG4gICAgfVxuICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQuc2l6ZTtcbiAgICB9XG4gICAgLyoqIEl0ZXJhdGVzIGRvY3VtZW50cyBpbiBvcmRlciBkZWZpbmVkIGJ5IFwiY29tcGFyYXRvclwiICovICAgIGZvckVhY2goZSkge1xuICAgICAgICB0aGlzLnNvcnRlZFNldC5pbm9yZGVyVHJhdmVyc2FsKCgodCwgbikgPT4gKGUodCksICExKSkpO1xuICAgIH1cbiAgICAvKiogSW5zZXJ0cyBvciB1cGRhdGVzIGEgZG9jdW1lbnQgd2l0aCB0aGUgc2FtZSBrZXkgKi8gICAgYWRkKGUpIHtcbiAgICAgICAgLy8gRmlyc3QgcmVtb3ZlIHRoZSBlbGVtZW50IGlmIHdlIGhhdmUgaXQuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRlbGV0ZShlLmtleSk7XG4gICAgICAgIHJldHVybiB0LmNvcHkodC5rZXllZE1hcC5pbnNlcnQoZS5rZXksIGUpLCB0LnNvcnRlZFNldC5pbnNlcnQoZSwgbnVsbCkpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlcyBhIGRvY3VtZW50IHdpdGggYSBnaXZlbiBrZXkgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdCA/IHRoaXMuY29weSh0aGlzLmtleWVkTWFwLnJlbW92ZShlKSwgdGhpcy5zb3J0ZWRTZXQucmVtb3ZlKHQpKSA6IHRoaXM7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgRG9jdW1lbnRTZXQpKSByZXR1cm4gITE7XG4gICAgICAgIGlmICh0aGlzLnNpemUgIT09IGUuc2l6ZSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5zb3J0ZWRTZXQuZ2V0SXRlcmF0b3IoKSwgbiA9IGUuc29ydGVkU2V0LmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO3QuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmdldE5leHQoKS5rZXksIHIgPSBuLmdldE5leHQoKS5rZXk7XG4gICAgICAgICAgICBpZiAoIWUuaXNFcXVhbChyKSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBlLnB1c2godC50b1N0cmluZygpKTtcbiAgICAgICAgfSkpLCAwID09PSBlLmxlbmd0aCA/IFwiRG9jdW1lbnRTZXQgKClcIiA6IFwiRG9jdW1lbnRTZXQgKFxcbiAgXCIgKyBlLmpvaW4oXCIgIFxcblwiKSArIFwiXFxuKVwiO1xuICAgIH1cbiAgICBjb3B5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBEb2N1bWVudFNldDtcbiAgICAgICAgcmV0dXJuIG4uY29tcGFyYXRvciA9IHRoaXMuY29tcGFyYXRvciwgbi5rZXllZE1hcCA9IGUsIG4uc29ydGVkU2V0ID0gdCwgbjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50Q2hhbmdlU2V0IGtlZXBzIHRyYWNrIG9mIGEgc2V0IG9mIGNoYW5nZXMgdG8gZG9jcyBpbiBhIHF1ZXJ5LCBtZXJnaW5nXG4gKiBkdXBsaWNhdGUgZXZlbnRzIGZvciB0aGUgc2FtZSBkb2MuXG4gKi8gY2xhc3MgX19QUklWQVRFX0RvY3VtZW50Q2hhbmdlU2V0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5XXyA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIHRyYWNrKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZG9jLmtleSwgbiA9IHRoaXMuV18uZ2V0KHQpO1xuICAgICAgICBuID8gXG4gICAgICAgIC8vIE1lcmdlIHRoZSBuZXcgY2hhbmdlIHdpdGggdGhlIGV4aXN0aW5nIGNoYW5nZS5cbiAgICAgICAgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovICE9PSBlLnR5cGUgJiYgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovID09PSBuLnR5cGUgPyB0aGlzLldfID0gdGhpcy5XXy5pbnNlcnQodCwgZSkgOiAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gPT09IGUudHlwZSAmJiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAhPT0gbi50eXBlID8gdGhpcy5XXyA9IHRoaXMuV18uaW5zZXJ0KHQsIHtcbiAgICAgICAgICAgIHR5cGU6IG4udHlwZSxcbiAgICAgICAgICAgIGRvYzogZS5kb2NcbiAgICAgICAgfSkgOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gPT09IGUudHlwZSAmJiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuV18gPSB0aGlzLldfLmluc2VydCh0LCB7XG4gICAgICAgICAgICB0eXBlOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiBlLmRvY1xuICAgICAgICB9KSA6IDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA9PT0gZS50eXBlICYmIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA9PT0gbi50eXBlID8gdGhpcy5XXyA9IHRoaXMuV18uaW5zZXJ0KHQsIHtcbiAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICBkb2M6IGUuZG9jXG4gICAgICAgIH0pIDogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gPT09IGUudHlwZSAmJiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuV18gPSB0aGlzLldfLnJlbW92ZSh0KSA6IDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovID09PSBlLnR5cGUgJiYgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovID09PSBuLnR5cGUgPyB0aGlzLldfID0gdGhpcy5XXy5pbnNlcnQodCwge1xuICAgICAgICAgICAgdHlwZTogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiBuLmRvY1xuICAgICAgICB9KSA6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA9PT0gZS50eXBlICYmIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovID09PSBuLnR5cGUgPyB0aGlzLldfID0gdGhpcy5XXy5pbnNlcnQodCwge1xuICAgICAgICAgICAgdHlwZTogMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovICxcbiAgICAgICAgICAgIGRvYzogZS5kb2NcbiAgICAgICAgfSkgOiBcbiAgICAgICAgLy8gVGhpcyBpbmNsdWRlcyB0aGVzZSBjYXNlcywgd2hpY2ggZG9uJ3QgbWFrZSBzZW5zZTpcbiAgICAgICAgLy8gQWRkZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPlJlbW92ZWRcbiAgICAgICAgLy8gTW9kaWZpZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPk1vZGlmaWVkXG4gICAgICAgIC8vIE1ldGFkYXRhLT5BZGRlZFxuICAgICAgICAvLyBSZW1vdmVkLT5NZXRhZGF0YVxuICAgICAgICBmYWlsKCkgOiB0aGlzLldfID0gdGhpcy5XXy5pbnNlcnQodCwgZSk7XG4gICAgfVxuICAgIEdfKCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLldfLmlub3JkZXJUcmF2ZXJzYWwoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBlLnB1c2gobik7XG4gICAgICAgIH0pKSwgZTtcbiAgICB9XG59XG5cbmNsYXNzIFZpZXdTbmFwc2hvdCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbywgXywgYSkge1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gZSwgdGhpcy5kb2NzID0gdCwgdGhpcy5vbGREb2NzID0gbiwgdGhpcy5kb2NDaGFuZ2VzID0gciwgdGhpcy5tdXRhdGVkS2V5cyA9IGksIFxuICAgICAgICB0aGlzLmZyb21DYWNoZSA9IHMsIHRoaXMuc3luY1N0YXRlQ2hhbmdlZCA9IG8sIHRoaXMuZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXMgPSBfLCBcbiAgICAgICAgdGhpcy5oYXNDYWNoZWRSZXN1bHRzID0gYTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSB2aWV3IHNuYXBzaG90IGFzIGlmIGFsbCBkb2N1bWVudHMgaW4gdGhlIHNuYXBzaG90IHdlcmUgYWRkZWQuICovICAgIHN0YXRpYyBmcm9tSW5pdGlhbERvY3VtZW50cyhlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBzLnB1c2goe1xuICAgICAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpLCBuZXcgVmlld1NuYXBzaG90KGUsIHQsIERvY3VtZW50U2V0LmVtcHR5U2V0KHQpLCBzLCBuLCByLCBcbiAgICAgICAgLyogc3luY1N0YXRlQ2hhbmdlZD0gKi8gITAsIFxuICAgICAgICAvKiBleGNsdWRlc01ldGFkYXRhQ2hhbmdlcz0gKi8gITEsIGkpO1xuICAgIH1cbiAgICBnZXQgaGFzUGVuZGluZ1dyaXRlcygpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLm11dGF0ZWRLZXlzLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIGlmICghKHRoaXMuZnJvbUNhY2hlID09PSBlLmZyb21DYWNoZSAmJiB0aGlzLmhhc0NhY2hlZFJlc3VsdHMgPT09IGUuaGFzQ2FjaGVkUmVzdWx0cyAmJiB0aGlzLnN5bmNTdGF0ZUNoYW5nZWQgPT09IGUuc3luY1N0YXRlQ2hhbmdlZCAmJiB0aGlzLm11dGF0ZWRLZXlzLmlzRXF1YWwoZS5tdXRhdGVkS2V5cykgJiYgX19QUklWQVRFX3F1ZXJ5RXF1YWxzKHRoaXMucXVlcnksIGUucXVlcnkpICYmIHRoaXMuZG9jcy5pc0VxdWFsKGUuZG9jcykgJiYgdGhpcy5vbGREb2NzLmlzRXF1YWwoZS5vbGREb2NzKSkpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZG9jQ2hhbmdlcywgbiA9IGUuZG9jQ2hhbmdlcztcbiAgICAgICAgaWYgKHQubGVuZ3RoICE9PSBuLmxlbmd0aCkgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHQubGVuZ3RoOyBlKyspIGlmICh0W2VdLnR5cGUgIT09IG5bZV0udHlwZSB8fCAhdFtlXS5kb2MuaXNFcXVhbChuW2VdLmRvYykpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSG9sZHMgdGhlIGxpc3RlbmVycyBhbmQgdGhlIGxhc3QgcmVjZWl2ZWQgVmlld1NuYXBzaG90IGZvciBhIHF1ZXJ5IGJlaW5nXG4gKiB0cmFja2VkIGJ5IEV2ZW50TWFuYWdlci5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUXVlcnlMaXN0ZW5lcnNJbmZvIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy56XyA9IHZvaWQgMCwgdGhpcy5qXyA9IFtdO1xuICAgIH1cbiAgICAvLyBIZWxwZXIgbWV0aG9kcyB0aGF0IGNoZWNrcyBpZiB0aGUgcXVlcnkgaGFzIGxpc3RlbmVycyB0aGF0IGxpc3RlbmluZyB0byByZW1vdGUgc3RvcmVcbiAgICBIXygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMual8uc29tZSgoZSA9PiBlLkpfKCkpKTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9FdmVudE1hbmFnZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5xdWVyaWVzID0gX19QUklWQVRFX25ld1F1ZXJpZXNPYmplY3RNYXAoKSwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgdGhpcy5ZXyA9IG5ldyBTZXQ7XG4gICAgfVxuICAgIHRlcm1pbmF0ZSgpIHtcbiAgICAgICAgIWZ1bmN0aW9uIF9fUFJJVkFURV9lcnJvckFsbFRhcmdldHMoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBuLnF1ZXJpZXM7XG4gICAgICAgICAgICAvLyBQcmV2ZW50IGZ1cnRoZXIgYWNjZXNzIGJ5IGNsZWFyaW5nIE9iamVjdE1hcC5cbiAgICAgICAgICAgIG4ucXVlcmllcyA9IF9fUFJJVkFURV9uZXdRdWVyaWVzT2JqZWN0TWFwKCksIHIuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2Ygbi5qXykgZS5vbkVycm9yKHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhbGwgYWxsIGdsb2JhbCBzbmFwc2hvdCBsaXN0ZW5lcnMgdGhhdCBoYXZlIGJlZW4gc2V0LlxuICAgICAgICAodGhpcywgbmV3IEZpcmVzdG9yZUVycm9yKEQuQUJPUlRFRCwgXCJGaXJlc3RvcmUgc2h1dHRpbmcgZG93blwiKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcmllc09iamVjdE1hcCgpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlRdWVyeShlKSksIF9fUFJJVkFURV9xdWVyeUVxdWFscyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9ldmVudE1hbmFnZXJMaXN0ZW4oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCByID0gMyAvKiBMaXN0ZW5lclNldHVwQWN0aW9uLk5vQWN0aW9uUmVxdWlyZWQgKi87XG4gICAgY29uc3QgaSA9IHQucXVlcnk7XG4gICAgbGV0IHMgPSBuLnF1ZXJpZXMuZ2V0KGkpO1xuICAgIHMgPyAhcy5IXygpICYmIHQuSl8oKSAmJiAoXG4gICAgLy8gUXVlcnkgaGFzIGJlZW4gbGlzdGVuaW5nIHRvIGxvY2FsIGNhY2hlLCBhbmQgdHJpZXMgdG8gYWRkIGEgbmV3IGxpc3RlbmVyIHNvdXJjZWQgZnJvbSB3YXRjaC5cbiAgICByID0gMiAvKiBMaXN0ZW5lclNldHVwQWN0aW9uLlJlcXVpcmVXYXRjaENvbm5lY3Rpb25Pbmx5ICovKSA6IChzID0gbmV3IF9fUFJJVkFURV9RdWVyeUxpc3RlbmVyc0luZm8sIFxuICAgIHIgPSB0LkpfKCkgPyAwIC8qIExpc3RlbmVyU2V0dXBBY3Rpb24uSW5pdGlhbGl6ZUxvY2FsTGlzdGVuQW5kUmVxdWlyZVdhdGNoQ29ubmVjdGlvbiAqLyA6IDEgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5Jbml0aWFsaXplTG9jYWxMaXN0ZW5Pbmx5ICovKTtcbiAgICB0cnkge1xuICAgICAgICBzd2l0Y2ggKHIpIHtcbiAgICAgICAgICBjYXNlIDAgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5Jbml0aWFsaXplTG9jYWxMaXN0ZW5BbmRSZXF1aXJlV2F0Y2hDb25uZWN0aW9uICovIDpcbiAgICAgICAgICAgIHMuel8gPSBhd2FpdCBuLm9uTGlzdGVuKGksIFxuICAgICAgICAgICAgLyoqIGVuYWJsZVJlbW90ZUxpc3Rlbj0gKi8gITApO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDEgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5Jbml0aWFsaXplTG9jYWxMaXN0ZW5Pbmx5ICovIDpcbiAgICAgICAgICAgIHMuel8gPSBhd2FpdCBuLm9uTGlzdGVuKGksIFxuICAgICAgICAgICAgLyoqIGVuYWJsZVJlbW90ZUxpc3Rlbj0gKi8gITEpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDIgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5SZXF1aXJlV2F0Y2hDb25uZWN0aW9uT25seSAqLyA6XG4gICAgICAgICAgICBhd2FpdCBuLm9uRmlyc3RSZW1vdGVTdG9yZUxpc3RlbihpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV93cmFwSW5Vc2VyRXJyb3JJZlJlY292ZXJhYmxlKGUsIGBJbml0aWFsaXphdGlvbiBvZiBxdWVyeSAnJHtfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkodC5xdWVyeSl9JyBmYWlsZWRgKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgdC5vbkVycm9yKG4pO1xuICAgIH1cbiAgICBpZiAobi5xdWVyaWVzLnNldChpLCBzKSwgcy5qXy5wdXNoKHQpLCBcbiAgICAvLyBSdW4gZ2xvYmFsIHNuYXBzaG90IGxpc3RlbmVycyBpZiBhIGNvbnNpc3RlbnQgc25hcHNob3QgaGFzIGJlZW4gZW1pdHRlZC5cbiAgICB0LlpfKG4ub25saW5lU3RhdGUpLCBzLnpfKSB7XG4gICAgICAgIHQuWF8ocy56XykgJiYgX19QUklWQVRFX3JhaXNlU25hcHNob3RzSW5TeW5jRXZlbnQobik7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyVW5saXN0ZW4oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gdC5xdWVyeTtcbiAgICBsZXQgaSA9IDMgLyogTGlzdGVuZXJSZW1vdmFsQWN0aW9uLk5vQWN0aW9uUmVxdWlyZWQgKi87XG4gICAgY29uc3QgcyA9IG4ucXVlcmllcy5nZXQocik7XG4gICAgaWYgKHMpIHtcbiAgICAgICAgY29uc3QgZSA9IHMual8uaW5kZXhPZih0KTtcbiAgICAgICAgZSA+PSAwICYmIChzLmpfLnNwbGljZShlLCAxKSwgMCA9PT0gcy5qXy5sZW5ndGggPyBpID0gdC5KXygpID8gMCAvKiBMaXN0ZW5lclJlbW92YWxBY3Rpb24uVGVybWluYXRlTG9jYWxMaXN0ZW5BbmRSZXF1aXJlV2F0Y2hEaXNjb25uZWN0aW9uICovIDogMSAvKiBMaXN0ZW5lclJlbW92YWxBY3Rpb24uVGVybWluYXRlTG9jYWxMaXN0ZW5Pbmx5ICovIDogIXMuSF8oKSAmJiB0LkpfKCkgJiYgKFxuICAgICAgICAvLyBUaGUgcmVtb3ZlZCBsaXN0ZW5lciBpcyB0aGUgbGFzdCBvbmUgdGhhdCBzb3VyY2VkIGZyb20gd2F0Y2guXG4gICAgICAgIGkgPSAyIC8qIExpc3RlbmVyUmVtb3ZhbEFjdGlvbi5SZXF1aXJlV2F0Y2hEaXNjb25uZWN0aW9uT25seSAqLykpO1xuICAgIH1cbiAgICBzd2l0Y2ggKGkpIHtcbiAgICAgIGNhc2UgMCAvKiBMaXN0ZW5lclJlbW92YWxBY3Rpb24uVGVybWluYXRlTG9jYWxMaXN0ZW5BbmRSZXF1aXJlV2F0Y2hEaXNjb25uZWN0aW9uICovIDpcbiAgICAgICAgcmV0dXJuIG4ucXVlcmllcy5kZWxldGUociksIG4ub25Vbmxpc3RlbihyLCBcbiAgICAgICAgLyoqIGRpc2FibGVSZW1vdGVMaXN0ZW49ICovICEwKTtcblxuICAgICAgY2FzZSAxIC8qIExpc3RlbmVyUmVtb3ZhbEFjdGlvbi5UZXJtaW5hdGVMb2NhbExpc3Rlbk9ubHkgKi8gOlxuICAgICAgICByZXR1cm4gbi5xdWVyaWVzLmRlbGV0ZShyKSwgbi5vblVubGlzdGVuKHIsIFxuICAgICAgICAvKiogZGlzYWJsZVJlbW90ZUxpc3Rlbj0gKi8gITEpO1xuXG4gICAgICBjYXNlIDIgLyogTGlzdGVuZXJSZW1vdmFsQWN0aW9uLlJlcXVpcmVXYXRjaERpc2Nvbm5lY3Rpb25Pbmx5ICovIDpcbiAgICAgICAgcmV0dXJuIG4ub25MYXN0UmVtb3RlU3RvcmVVbmxpc3RlbihyKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uV2F0Y2hDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCByID0gITE7XG4gICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgY29uc3QgdCA9IGUucXVlcnksIGkgPSBuLnF1ZXJpZXMuZ2V0KHQpO1xuICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGkual8pIHQuWF8oZSkgJiYgKHIgPSAhMCk7XG4gICAgICAgICAgICBpLnpfID0gZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByICYmIF9fUFJJVkFURV9yYWlzZVNuYXBzaG90c0luU3luY0V2ZW50KG4pO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyT25XYXRjaEVycm9yKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgaSA9IHIucXVlcmllcy5nZXQodCk7XG4gICAgaWYgKGkpIGZvciAoY29uc3QgZSBvZiBpLmpfKSBlLm9uRXJyb3Iobik7XG4gICAgLy8gUmVtb3ZlIGFsbCBsaXN0ZW5lcnMuIE5PVEU6IFdlIGRvbid0IG5lZWQgdG8gY2FsbCBzeW5jRW5naW5lLnVubGlzdGVuKClcbiAgICAvLyBhZnRlciBhbiBlcnJvci5cbiAgICAgICAgci5xdWVyaWVzLmRlbGV0ZSh0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3JhaXNlU25hcHNob3RzSW5TeW5jRXZlbnQoZSkge1xuICAgIGUuWV8uZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgIGUubmV4dCgpO1xuICAgIH0pKTtcbn1cblxudmFyIHBlLCB5ZTtcblxuLyoqIExpc3RlbiB0byBib3RoIGNhY2hlIGFuZCBzZXJ2ZXIgY2hhbmdlcyAqL1xuKHllID0gcGUgfHwgKHBlID0ge30pKS5lYSA9IFwiZGVmYXVsdFwiLCBcbi8qKiBMaXN0ZW4gdG8gY2hhbmdlcyBpbiBjYWNoZSBvbmx5ICovXG55ZS5DYWNoZSA9IFwiY2FjaGVcIjtcblxuLyoqXG4gKiBRdWVyeUxpc3RlbmVyIHRha2VzIGEgc2VyaWVzIG9mIGludGVybmFsIHZpZXcgc25hcHNob3RzIGFuZCBkZXRlcm1pbmVzXG4gKiB3aGVuIHRvIHJhaXNlIHRoZSBldmVudC5cbiAqXG4gKiBJdCB1c2VzIGFuIE9ic2VydmVyIHRvIGRpc3BhdGNoIGV2ZW50cy5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5TGlzdGVuZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IGUsIHRoaXMudGEgPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWwgc25hcHNob3RzIChlLmcuIGZyb20gY2FjaGUpIG1heSBub3QgYmUgcHJvcGFnYXRlZCB0byB0aGUgd3JhcHBlZFxuICAgICAgICAgKiBvYnNlcnZlci4gVGhpcyBmbGFnIGlzIHNldCB0byB0cnVlIG9uY2Ugd2UndmUgYWN0dWFsbHkgcmFpc2VkIGFuIGV2ZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYSA9ICExLCB0aGlzLnJhID0gbnVsbCwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgdGhpcy5vcHRpb25zID0gbiB8fCB7fTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyB0aGUgbmV3IFZpZXdTbmFwc2hvdCB0byB0aGlzIGxpc3RlbmVyLCByYWlzaW5nIGEgdXNlci1mYWNpbmcgZXZlbnRcbiAgICAgKiBpZiBhcHBsaWNhYmxlIChkZXBlbmRpbmcgb24gd2hhdCBjaGFuZ2VkLCB3aGV0aGVyIHRoZSB1c2VyIGhhcyBvcHRlZCBpbnRvXG4gICAgICogbWV0YWRhdGEtb25seSBjaGFuZ2VzLCBldGMuKS4gUmV0dXJucyB0cnVlIGlmIGEgdXNlci1mYWNpbmcgZXZlbnQgd2FzXG4gICAgICogaW5kZWVkIHJhaXNlZC5cbiAgICAgKi8gICAgWF8oZSkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgdGhlIG1ldGFkYXRhIG9ubHkgY2hhbmdlcy5cbiAgICAgICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBlLmRvY0NoYW5nZXMpIDMgLyogQ2hhbmdlVHlwZS5NZXRhZGF0YSAqLyAhPT0gbi50eXBlICYmIHQucHVzaChuKTtcbiAgICAgICAgICAgIGUgPSBuZXcgVmlld1NuYXBzaG90KGUucXVlcnksIGUuZG9jcywgZS5vbGREb2NzLCB0LCBlLm11dGF0ZWRLZXlzLCBlLmZyb21DYWNoZSwgZS5zeW5jU3RhdGVDaGFuZ2VkLCBcbiAgICAgICAgICAgIC8qIGV4Y2x1ZGVzTWV0YWRhdGFDaGFuZ2VzPSAqLyAhMCwgZS5oYXNDYWNoZWRSZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdCA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5uYSA/IHRoaXMuaWEoZSkgJiYgKHRoaXMudGEubmV4dChlKSwgdCA9ICEwKSA6IHRoaXMuc2EoZSwgdGhpcy5vbmxpbmVTdGF0ZSkgJiYgKHRoaXMub2EoZSksIFxuICAgICAgICB0ID0gITApLCB0aGlzLnJhID0gZSwgdDtcbiAgICB9XG4gICAgb25FcnJvcihlKSB7XG4gICAgICAgIHRoaXMudGEuZXJyb3IoZSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHdoZXRoZXIgYSBzbmFwc2hvdCB3YXMgcmFpc2VkLiAqLyAgICBaXyhlKSB7XG4gICAgICAgIHRoaXMub25saW5lU3RhdGUgPSBlO1xuICAgICAgICBsZXQgdCA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5yYSAmJiAhdGhpcy5uYSAmJiB0aGlzLnNhKHRoaXMucmEsIGUpICYmICh0aGlzLm9hKHRoaXMucmEpLCB0ID0gITApLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgc2EoZSwgdCkge1xuICAgICAgICAvLyBBbHdheXMgcmFpc2UgdGhlIGZpcnN0IGV2ZW50IHdoZW4gd2UncmUgc3luY2VkXG4gICAgICAgIGlmICghZS5mcm9tQ2FjaGUpIHJldHVybiAhMDtcbiAgICAgICAgLy8gQWx3YXlzIHJhaXNlIGV2ZW50IGlmIGxpc3RlbmluZyB0byBjYWNoZVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5KXygpKSByZXR1cm4gITA7XG4gICAgICAgIC8vIE5PVEU6IFdlIGNvbnNpZGVyIE9ubGluZVN0YXRlLlVua25vd24gYXMgb25saW5lIChpdCBzaG91bGQgYmVjb21lIE9mZmxpbmVcbiAgICAgICAgLy8gb3IgT25saW5lIGlmIHdlIHdhaXQgbG9uZyBlbm91Z2gpLlxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovICE9PSB0O1xuICAgICAgICAvLyBEb24ndCByYWlzZSB0aGUgZXZlbnQgaWYgd2UncmUgb25saW5lLCBhcmVuJ3Qgc3luY2VkIHlldCAoY2hlY2tlZFxuICAgICAgICAvLyBhYm92ZSkgYW5kIGFyZSB3YWl0aW5nIGZvciBhIHN5bmMuXG4gICAgICAgICAgICAgICAgcmV0dXJuICghdGhpcy5vcHRpb25zLl9hIHx8ICFuKSAmJiAoIWUuZG9jcy5pc0VtcHR5KCkgfHwgZS5oYXNDYWNoZWRSZXN1bHRzIHx8IFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8gPT09IHQpO1xuICAgICAgICAvLyBSYWlzZSBkYXRhIGZyb20gY2FjaGUgaWYgd2UgaGF2ZSBhbnkgZG9jdW1lbnRzLCBoYXZlIGNhY2hlZCByZXN1bHRzIGJlZm9yZSxcbiAgICAgICAgLy8gb3Igd2UgYXJlIG9mZmxpbmUuXG4gICAgICAgIH1cbiAgICBpYShlKSB7XG4gICAgICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gaGFuZGxlIGluY2x1ZGVEb2N1bWVudE1ldGFkYXRhQ2hhbmdlcyBoZXJlIGJlY2F1c2VcbiAgICAgICAgLy8gdGhlIE1ldGFkYXRhIG9ubHkgY2hhbmdlcyBoYXZlIGFscmVhZHkgYmVlbiBzdHJpcHBlZCBvdXQgaWYgbmVlZGVkLlxuICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHRoZSBvbmx5IGNoYW5nZXMgd2Ugd2lsbCBzZWUgYXJlIHRoZSBvbmVzIHdlIHNob3VsZFxuICAgICAgICAvLyBwcm9wYWdhdGUuXG4gICAgICAgIGlmIChlLmRvY0NoYW5nZXMubGVuZ3RoID4gMCkgcmV0dXJuICEwO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5yYSAmJiB0aGlzLnJhLmhhc1BlbmRpbmdXcml0ZXMgIT09IGUuaGFzUGVuZGluZ1dyaXRlcztcbiAgICAgICAgcmV0dXJuICEoIWUuc3luY1N0YXRlQ2hhbmdlZCAmJiAhdCkgJiYgITAgPT09IHRoaXMub3B0aW9ucy5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzO1xuICAgICAgICAvLyBHZW5lcmFsbHkgd2Ugc2hvdWxkIGhhdmUgaGl0IG9uZSBvZiB0aGUgY2FzZXMgYWJvdmUsIGJ1dCBpdCdzIHBvc3NpYmxlXG4gICAgICAgIC8vIHRvIGdldCBoZXJlIGlmIHRoZXJlIHdlcmUgb25seSBtZXRhZGF0YSBkb2NDaGFuZ2VzIGFuZCB0aGV5IGdvdFxuICAgICAgICAvLyBzdHJpcHBlZCBvdXQuXG4gICAgICAgIH1cbiAgICBvYShlKSB7XG4gICAgICAgIGUgPSBWaWV3U25hcHNob3QuZnJvbUluaXRpYWxEb2N1bWVudHMoZS5xdWVyeSwgZS5kb2NzLCBlLm11dGF0ZWRLZXlzLCBlLmZyb21DYWNoZSwgZS5oYXNDYWNoZWRSZXN1bHRzKSwgXG4gICAgICAgIHRoaXMubmEgPSAhMCwgdGhpcy50YS5uZXh0KGUpO1xuICAgIH1cbiAgICBKXygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zb3VyY2UgIT09IHBlLkNhY2hlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBjb21wbGV0ZSBlbGVtZW50IGluIHRoZSBidW5kbGUgc3RyZWFtLCB0b2dldGhlciB3aXRoIHRoZSBieXRlIGxlbmd0aCBpdFxuICogb2NjdXBpZXMgaW4gdGhlIHN0cmVhbS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU2l6ZWRCdW5kbGVFbGVtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlLCBcbiAgICAvLyBIb3cgbWFueSBieXRlcyB0aGlzIGVsZW1lbnQgdGFrZXMgdG8gc3RvcmUgaW4gdGhlIGJ1bmRsZS5cbiAgICB0KSB7XG4gICAgICAgIHRoaXMuYWEgPSBlLCB0aGlzLmJ5dGVMZW5ndGggPSB0O1xuICAgIH1cbiAgICB1YSgpIHtcbiAgICAgICAgcmV0dXJuIFwibWV0YWRhdGFcIiBpbiB0aGlzLmFhO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSGVscGVyIHRvIGNvbnZlcnQgb2JqZWN0cyBmcm9tIGJ1bmRsZXMgdG8gbW9kZWwgb2JqZWN0cyBpbiB0aGUgU0RLLlxuICovIGNsYXNzIF9fUFJJVkFURV9CdW5kbGVDb252ZXJ0ZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGU7XG4gICAgfVxuICAgIEVzKGUpIHtcbiAgICAgICAgcmV0dXJuIGZyb21OYW1lKHRoaXMuc2VyaWFsaXplciwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGEgQnVuZGxlRG9jdW1lbnQgdG8gYSBNdXRhYmxlRG9jdW1lbnQuXG4gICAgICovICAgIGRzKGUpIHtcbiAgICAgICAgcmV0dXJuIGUubWV0YWRhdGEuZXhpc3RzID8gX19QUklWQVRFX2Zyb21Eb2N1bWVudCh0aGlzLnNlcmlhbGl6ZXIsIGUuZG9jdW1lbnQsICExKSA6IE11dGFibGVEb2N1bWVudC5uZXdOb0RvY3VtZW50KHRoaXMuRXMoZS5tZXRhZGF0YS5uYW1lKSwgdGhpcy5BcyhlLm1ldGFkYXRhLnJlYWRUaW1lKSk7XG4gICAgfVxuICAgIEFzKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9mcm9tVmVyc2lvbihlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBjbGFzcyB0byBwcm9jZXNzIHRoZSBlbGVtZW50cyBmcm9tIGEgYnVuZGxlLCBsb2FkIHRoZW0gaW50byBsb2NhbFxuICogc3RvcmFnZSBhbmQgcHJvdmlkZSBwcm9ncmVzcyB1cGRhdGUgd2hpbGUgbG9hZGluZy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQnVuZGxlTG9hZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuY2EgPSBlLCB0aGlzLmxvY2FsU3RvcmUgPSB0LCB0aGlzLnNlcmlhbGl6ZXIgPSBuLCBcbiAgICAgICAgLyoqIEJhdGNoZWQgcXVlcmllcyB0byBiZSBzYXZlZCBpbnRvIHN0b3JhZ2UgKi9cbiAgICAgICAgdGhpcy5xdWVyaWVzID0gW10sIFxuICAgICAgICAvKiogQmF0Y2hlZCBkb2N1bWVudHMgdG8gYmUgc2F2ZWQgaW50byBzdG9yYWdlICovXG4gICAgICAgIHRoaXMuZG9jdW1lbnRzID0gW10sIFxuICAgICAgICAvKiogVGhlIGNvbGxlY3Rpb24gZ3JvdXBzIGFmZmVjdGVkIGJ5IHRoaXMgYnVuZGxlLiAqL1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25Hcm91cHMgPSBuZXcgU2V0LCB0aGlzLnByb2dyZXNzID0gX19QUklWQVRFX2J1bmRsZUluaXRpYWxQcm9ncmVzcyhlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhbiBlbGVtZW50IGZyb20gdGhlIGJ1bmRsZSB0byB0aGUgbG9hZGVyLlxuICAgICAqXG4gICAgICogUmV0dXJucyBhIG5ldyBwcm9ncmVzcyBpZiBhZGRpbmcgdGhlIGVsZW1lbnQgbGVhZHMgdG8gYSBuZXcgcHJvZ3Jlc3MsXG4gICAgICogb3RoZXJ3aXNlIHJldHVybnMgbnVsbC5cbiAgICAgKi8gICAgbGEoZSkge1xuICAgICAgICB0aGlzLnByb2dyZXNzLmJ5dGVzTG9hZGVkICs9IGUuYnl0ZUxlbmd0aDtcbiAgICAgICAgbGV0IHQgPSB0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZDtcbiAgICAgICAgaWYgKGUuYWEubmFtZWRRdWVyeSkgdGhpcy5xdWVyaWVzLnB1c2goZS5hYS5uYW1lZFF1ZXJ5KTsgZWxzZSBpZiAoZS5hYS5kb2N1bWVudE1ldGFkYXRhKSB7XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICBtZXRhZGF0YTogZS5hYS5kb2N1bWVudE1ldGFkYXRhXG4gICAgICAgICAgICB9KSwgZS5hYS5kb2N1bWVudE1ldGFkYXRhLmV4aXN0cyB8fCArK3Q7XG4gICAgICAgICAgICBjb25zdCBuID0gUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZS5hYS5kb2N1bWVudE1ldGFkYXRhLm5hbWUpO1xuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uR3JvdXBzLmFkZChuLmdldChuLmxlbmd0aCAtIDIpKTtcbiAgICAgICAgfSBlbHNlIGUuYWEuZG9jdW1lbnQgJiYgKHRoaXMuZG9jdW1lbnRzW3RoaXMuZG9jdW1lbnRzLmxlbmd0aCAtIDFdLmRvY3VtZW50ID0gZS5hYS5kb2N1bWVudCwgXG4gICAgICAgICsrdCk7XG4gICAgICAgIHJldHVybiB0ICE9PSB0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZCA/ICh0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZCA9IHQsIFxuICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnByb2dyZXNzKSkgOiBudWxsO1xuICAgIH1cbiAgICBoYShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgTWFwLCBuID0gbmV3IF9fUFJJVkFURV9CdW5kbGVDb252ZXJ0ZXJJbXBsKHRoaXMuc2VyaWFsaXplcik7XG4gICAgICAgIGZvciAoY29uc3QgciBvZiBlKSBpZiAoci5tZXRhZGF0YS5xdWVyaWVzKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbi5FcyhyLm1ldGFkYXRhLm5hbWUpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHIubWV0YWRhdGEucXVlcmllcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSAodC5nZXQobikgfHwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCkpLmFkZChlKTtcbiAgICAgICAgICAgICAgICB0LnNldChuLCByKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBwcm9ncmVzcyB0byAnU3VjY2VzcycgYW5kIHJldHVybiB0aGUgdXBkYXRlZCBwcm9ncmVzcy5cbiAgICAgKi8gICAgYXN5bmMgY29tcGxldGUoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFwcGx5QnVuZGxlZERvY3VtZW50cyh0aGlzLmxvY2FsU3RvcmUsIG5ldyBfX1BSSVZBVEVfQnVuZGxlQ29udmVydGVySW1wbCh0aGlzLnNlcmlhbGl6ZXIpLCB0aGlzLmRvY3VtZW50cywgdGhpcy5jYS5pZCksIHQgPSB0aGlzLmhhKHRoaXMuZG9jdW1lbnRzKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMucXVlcmllcykgYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVTYXZlTmFtZWRRdWVyeSh0aGlzLmxvY2FsU3RvcmUsIGUsIHQuZ2V0KGUubmFtZSkpO1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9ncmVzcy50YXNrU3RhdGUgPSBcIlN1Y2Nlc3NcIiwge1xuICAgICAgICAgICAgcHJvZ3Jlc3M6IHRoaXMucHJvZ3Jlc3MsXG4gICAgICAgICAgICBQYTogdGhpcy5jb2xsZWN0aW9uR3JvdXBzLFxuICAgICAgICAgICAgSWE6IGVcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGBMb2FkQnVuZGxlVGFza1Byb2dyZXNzYCByZXByZXNlbnRpbmcgdGhlIGluaXRpYWwgcHJvZ3Jlc3Mgb2ZcbiAqIGxvYWRpbmcgYSBidW5kbGUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2J1bmRsZUluaXRpYWxQcm9ncmVzcyhlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGFza1N0YXRlOiBcIlJ1bm5pbmdcIixcbiAgICAgICAgZG9jdW1lbnRzTG9hZGVkOiAwLFxuICAgICAgICBieXRlc0xvYWRlZDogMCxcbiAgICAgICAgdG90YWxEb2N1bWVudHM6IGUudG90YWxEb2N1bWVudHMsXG4gICAgICAgIHRvdGFsQnl0ZXM6IGUudG90YWxCeXRlc1xuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGBMb2FkQnVuZGxlVGFza1Byb2dyZXNzYCByZXByZXNlbnRpbmcgdGhlIHByb2dyZXNzIHRoYXQgdGhlIGxvYWRpbmdcbiAqIGhhcyBzdWNjZWVkZWQuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfQWRkZWRMaW1ib0RvY3VtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua2V5ID0gZTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9SZW1vdmVkTGltYm9Eb2N1bWVudCB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmtleSA9IGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFZpZXcgaXMgcmVzcG9uc2libGUgZm9yIGNvbXB1dGluZyB0aGUgZmluYWwgbWVyZ2VkIHRydXRoIG9mIHdoYXQgZG9jcyBhcmUgaW5cbiAqIGEgcXVlcnkuIEl0IGdldHMgbm90aWZpZWQgb2YgbG9jYWwgYW5kIHJlbW90ZSBjaGFuZ2VzIHRvIGRvY3MsIGFuZCBhcHBsaWVzXG4gKiB0aGUgcXVlcnkgZmlsdGVycyBhbmQgbGltaXRzIHRvIGRldGVybWluZSB0aGUgbW9zdCBjb3JyZWN0IHBvc3NpYmxlIHJlc3VsdHMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1ZpZXcge1xuICAgIGNvbnN0cnVjdG9yKGUsIFxuICAgIC8qKiBEb2N1bWVudHMgaW5jbHVkZWQgaW4gdGhlIHJlbW90ZSB0YXJnZXQgKi9cbiAgICB0KSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSBlLCB0aGlzLlRhID0gdCwgdGhpcy5FYSA9IG51bGwsIHRoaXMuaGFzQ2FjaGVkUmVzdWx0cyA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZmxhZyB3aGV0aGVyIHRoZSB2aWV3IGlzIGN1cnJlbnQgd2l0aCB0aGUgYmFja2VuZC4gQSB2aWV3IGlzIGNvbnNpZGVyZWRcbiAgICAgICAgICogY3VycmVudCBhZnRlciBpdCBoYXMgc2VlbiB0aGUgY3VycmVudCBmbGFnIGZyb20gdGhlIGJhY2tlbmQgYW5kIGRpZCBub3RcbiAgICAgICAgICogbG9zZSBjb25zaXN0ZW5jeSB3aXRoaW4gdGhlIHdhdGNoIHN0cmVhbSAoZS5nLiBiZWNhdXNlIG9mIGFuIGV4aXN0ZW5jZVxuICAgICAgICAgKiBmaWx0ZXIgbWlzbWF0Y2gpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jdXJyZW50ID0gITEsIFxuICAgICAgICAvKiogRG9jdW1lbnRzIGluIHRoZSB2aWV3IGJ1dCBub3QgaW4gdGhlIHJlbW90ZSB0YXJnZXQgKi9cbiAgICAgICAgdGhpcy5kYSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCBcbiAgICAgICAgLyoqIERvY3VtZW50IEtleXMgdGhhdCBoYXZlIGxvY2FsIGNoYW5nZXMgKi9cbiAgICAgICAgdGhpcy5tdXRhdGVkS2V5cyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCB0aGlzLkFhID0gX19QUklWQVRFX25ld1F1ZXJ5Q29tcGFyYXRvcihlKSwgXG4gICAgICAgIHRoaXMuUmEgPSBuZXcgRG9jdW1lbnRTZXQodGhpcy5BYSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBzZXQgb2YgcmVtb3RlIGRvY3VtZW50cyB0aGF0IHRoZSBzZXJ2ZXIgaGFzIHRvbGQgdXMgYmVsb25ncyB0byB0aGUgdGFyZ2V0IGFzc29jaWF0ZWQgd2l0aFxuICAgICAqIHRoaXMgdmlldy5cbiAgICAgKi8gICAgZ2V0IFZhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5UYTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBhIHNldCBvZiBkb2MgY2hhbmdlcywgYXBwbGllcyB0aGUgcXVlcnkgbGltaXQsIGFuZCBjb21wdXRlc1xuICAgICAqIHdoYXQgdGhlIG5ldyByZXN1bHRzIHNob3VsZCBiZSwgd2hhdCB0aGUgY2hhbmdlcyB3ZXJlLCBhbmQgd2hldGhlciB3ZSBtYXlcbiAgICAgKiBuZWVkIHRvIGdvIGJhY2sgdG8gdGhlIGxvY2FsIGNhY2hlIGZvciBtb3JlIHJlc3VsdHMuIERvZXMgbm90IG1ha2UgYW55XG4gICAgICogY2hhbmdlcyB0byB0aGUgdmlldy5cbiAgICAgKiBAcGFyYW0gZG9jQ2hhbmdlcyAtIFRoZSBkb2MgY2hhbmdlcyB0byBhcHBseSB0byB0aGlzIHZpZXcuXG4gICAgICogQHBhcmFtIHByZXZpb3VzQ2hhbmdlcyAtIElmIHRoaXMgaXMgYmVpbmcgY2FsbGVkIHdpdGggYSByZWZpbGwsIHRoZW4gc3RhcnRcbiAgICAgKiAgICAgICAgd2l0aCB0aGlzIHNldCBvZiBkb2NzIGFuZCBjaGFuZ2VzIGluc3RlYWQgb2YgdGhlIGN1cnJlbnQgdmlldy5cbiAgICAgKiBAcmV0dXJucyBhIG5ldyBzZXQgb2YgZG9jcywgY2hhbmdlcywgYW5kIHJlZmlsbCBmbGFnLlxuICAgICAqLyAgICBtYShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0ID8gdC5mYSA6IG5ldyBfX1BSSVZBVEVfRG9jdW1lbnRDaGFuZ2VTZXQsIHIgPSB0ID8gdC5SYSA6IHRoaXMuUmE7XG4gICAgICAgIGxldCBpID0gdCA/IHQubXV0YXRlZEtleXMgOiB0aGlzLm11dGF0ZWRLZXlzLCBzID0gciwgbyA9ICExO1xuICAgICAgICAvLyBUcmFjayB0aGUgbGFzdCBkb2MgaW4gYSAoZnVsbCkgbGltaXQuIFRoaXMgaXMgbmVjZXNzYXJ5LCBiZWNhdXNlIHNvbWVcbiAgICAgICAgLy8gdXBkYXRlIChhIGRlbGV0ZSwgb3IgYW4gdXBkYXRlIG1vdmluZyBhIGRvYyBwYXN0IHRoZSBvbGQgbGltaXQpIG1pZ2h0XG4gICAgICAgIC8vIG1lYW4gdGhlcmUgaXMgc29tZSBvdGhlciBkb2N1bWVudCBpbiB0aGUgbG9jYWwgY2FjaGUgdGhhdCBlaXRoZXIgc2hvdWxkXG4gICAgICAgIC8vIGNvbWUgKDEpIGJldHdlZW4gdGhlIG9sZCBsYXN0IGxpbWl0IGRvYyBhbmQgdGhlIG5ldyBsYXN0IGRvY3VtZW50LCBpbiB0aGVcbiAgICAgICAgLy8gY2FzZSBvZiB1cGRhdGVzLCBvciAoMikgYWZ0ZXIgdGhlIG5ldyBsYXN0IGRvY3VtZW50LCBpbiB0aGUgY2FzZSBvZlxuICAgICAgICAvLyBkZWxldGVzLiBTbyB3ZSBrZWVwIHRoaXMgZG9jIGF0IHRoZSBvbGQgbGltaXQgdG8gY29tcGFyZSB0aGUgdXBkYXRlcyB0by5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgc2hvdWxkIG5ldmVyIGdldCB1c2VkIGluIGEgcmVmaWxsICh3aGVuIHByZXZpb3VzQ2hhbmdlcyBpc1xuICAgICAgICAvLyBzZXQpLCBiZWNhdXNlIHRoZXJlIHdpbGwgb25seSBiZSBhZGRzIC0tIG5vIGRlbGV0ZXMgb3IgdXBkYXRlcy5cbiAgICAgICAgY29uc3QgXyA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyA9PT0gdGhpcy5xdWVyeS5saW1pdFR5cGUgJiYgci5zaXplID09PSB0aGlzLnF1ZXJ5LmxpbWl0ID8gci5sYXN0KCkgOiBudWxsLCBhID0gXCJMXCIgLyogTGltaXRUeXBlLkxhc3QgKi8gPT09IHRoaXMucXVlcnkubGltaXRUeXBlICYmIHIuc2l6ZSA9PT0gdGhpcy5xdWVyeS5saW1pdCA/IHIuZmlyc3QoKSA6IG51bGw7XG4gICAgICAgIC8vIERyb3AgZG9jdW1lbnRzIG91dCB0byBtZWV0IGxpbWl0L2xpbWl0VG9MYXN0IHJlcXVpcmVtZW50LlxuICAgICAgICBpZiAoZS5pbm9yZGVyVHJhdmVyc2FsKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdSA9IHIuZ2V0KGUpLCBjID0gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlcyh0aGlzLnF1ZXJ5LCB0KSA/IHQgOiBudWxsLCBsID0gISF1ICYmIHRoaXMubXV0YXRlZEtleXMuaGFzKHUua2V5KSwgaCA9ICEhYyAmJiAoYy5oYXNMb2NhbE11dGF0aW9ucyB8fCBcbiAgICAgICAgICAgIC8vIFdlIG9ubHkgY29uc2lkZXIgY29tbWl0dGVkIG11dGF0aW9ucyBmb3IgZG9jdW1lbnRzIHRoYXQgd2VyZVxuICAgICAgICAgICAgLy8gbXV0YXRlZCBkdXJpbmcgdGhlIGxpZmV0aW1lIG9mIHRoZSB2aWV3LlxuICAgICAgICAgICAgdGhpcy5tdXRhdGVkS2V5cy5oYXMoYy5rZXkpICYmIGMuaGFzQ29tbWl0dGVkTXV0YXRpb25zKTtcbiAgICAgICAgICAgIGxldCBQID0gITE7XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgY2hhbmdlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodSAmJiBjKSB7XG4gICAgICAgICAgICAgICAgdS5kYXRhLmlzRXF1YWwoYy5kYXRhKSA/IGwgIT09IGggJiYgKG4udHJhY2soe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gLFxuICAgICAgICAgICAgICAgICAgICBkb2M6IGNcbiAgICAgICAgICAgICAgICB9KSwgUCA9ICEwKSA6IHRoaXMuZ2EodSwgYykgfHwgKG4udHJhY2soe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gLFxuICAgICAgICAgICAgICAgICAgICBkb2M6IGNcbiAgICAgICAgICAgICAgICB9KSwgUCA9ICEwLCAoXyAmJiB0aGlzLkFhKGMsIF8pID4gMCB8fCBhICYmIHRoaXMuQWEoYywgYSkgPCAwKSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBkb2MgbW92ZWQgZnJvbSBpbnNpZGUgdGhlIGxpbWl0IHRvIG91dHNpZGUgdGhlIGxpbWl0LlxuICAgICAgICAgICAgICAgIC8vIFRoYXQgbWVhbnMgdGhlcmUgbWF5IGJlIHNvbWUgb3RoZXIgZG9jIGluIHRoZSBsb2NhbCBjYWNoZVxuICAgICAgICAgICAgICAgIC8vIHRoYXQgc2hvdWxkIGJlIGluY2x1ZGVkIGluc3RlYWQuXG4gICAgICAgICAgICAgICAgbyA9ICEwKSk7XG4gICAgICAgICAgICB9IGVsc2UgIXUgJiYgYyA/IChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gLFxuICAgICAgICAgICAgICAgIGRvYzogY1xuICAgICAgICAgICAgfSksIFAgPSAhMCkgOiB1ICYmICFjICYmIChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiB1XG4gICAgICAgICAgICB9KSwgUCA9ICEwLCAoXyB8fCBhKSAmJiAoXG4gICAgICAgICAgICAvLyBBIGRvYyB3YXMgcmVtb3ZlZCBmcm9tIGEgZnVsbCBsaW1pdCBxdWVyeS4gV2UnbGwgbmVlZCB0b1xuICAgICAgICAgICAgLy8gcmVxdWVyeSBmcm9tIHRoZSBsb2NhbCBjYWNoZSB0byBzZWUgaWYgd2Uga25vdyBhYm91dCBzb21lIG90aGVyXG4gICAgICAgICAgICAvLyBkb2MgdGhhdCBzaG91bGQgYmUgaW4gdGhlIHJlc3VsdHMuXG4gICAgICAgICAgICBvID0gITApKTtcbiAgICAgICAgICAgIFAgJiYgKGMgPyAocyA9IHMuYWRkKGMpLCBpID0gaCA/IGkuYWRkKGUpIDogaS5kZWxldGUoZSkpIDogKHMgPSBzLmRlbGV0ZShlKSwgaSA9IGkuZGVsZXRlKGUpKSk7XG4gICAgICAgIH0pKSwgbnVsbCAhPT0gdGhpcy5xdWVyeS5saW1pdCkgZm9yICg7cy5zaXplID4gdGhpcy5xdWVyeS5saW1pdDsgKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovID09PSB0aGlzLnF1ZXJ5LmxpbWl0VHlwZSA/IHMubGFzdCgpIDogcy5maXJzdCgpO1xuICAgICAgICAgICAgcyA9IHMuZGVsZXRlKGUua2V5KSwgaSA9IGkuZGVsZXRlKGUua2V5KSwgbi50cmFjayh7XG4gICAgICAgICAgICAgICAgdHlwZTogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgICAgIGRvYzogZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFJhOiBzLFxuICAgICAgICAgICAgZmE6IG4sXG4gICAgICAgICAgICBuczogbyxcbiAgICAgICAgICAgIG11dGF0ZWRLZXlzOiBpXG4gICAgICAgIH07XG4gICAgfVxuICAgIGdhKGUsIHQpIHtcbiAgICAgICAgLy8gV2Ugc3VwcHJlc3MgdGhlIGluaXRpYWwgY2hhbmdlIGV2ZW50IGZvciBkb2N1bWVudHMgdGhhdCB3ZXJlIG1vZGlmaWVkIGFzXG4gICAgICAgIC8vIHBhcnQgb2YgYSB3cml0ZSBhY2tub3dsZWRnbWVudCAoZS5nLiB3aGVuIHRoZSB2YWx1ZSBvZiBhIHNlcnZlciB0cmFuc2Zvcm1cbiAgICAgICAgLy8gaXMgYXBwbGllZCkgYXMgV2F0Y2ggd2lsbCBzZW5kIHVzIHRoZSBzYW1lIGRvY3VtZW50IGFnYWluLlxuICAgICAgICAvLyBCeSBzdXBwcmVzc2luZyB0aGUgZXZlbnQsIHdlIG9ubHkgcmFpc2UgdHdvIHVzZXIgdmlzaWJsZSBldmVudHMgKG9uZSB3aXRoXG4gICAgICAgIC8vIGBoYXNQZW5kaW5nV3JpdGVzYCBhbmQgdGhlIGZpbmFsIHN0YXRlIG9mIHRoZSBkb2N1bWVudCkgaW5zdGVhZCBvZiB0aHJlZVxuICAgICAgICAvLyAob25lIHdpdGggYGhhc1BlbmRpbmdXcml0ZXNgLCB0aGUgbW9kaWZpZWQgZG9jdW1lbnQgd2l0aFxuICAgICAgICAvLyBgaGFzUGVuZGluZ1dyaXRlc2AgYW5kIHRoZSBmaW5hbCBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQpLlxuICAgICAgICByZXR1cm4gZS5oYXNMb2NhbE11dGF0aW9ucyAmJiB0Lmhhc0NvbW1pdHRlZE11dGF0aW9ucyAmJiAhdC5oYXNMb2NhbE11dGF0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgdmlldyB3aXRoIHRoZSBnaXZlbiBWaWV3RG9jdW1lbnRDaGFuZ2VzIGFuZCBvcHRpb25hbGx5IHVwZGF0ZXNcbiAgICAgKiBsaW1ibyBkb2NzIGFuZCBzeW5jIHN0YXRlIGZyb20gdGhlIHByb3ZpZGVkIHRhcmdldCBjaGFuZ2UuXG4gICAgICogQHBhcmFtIGRvY0NoYW5nZXMgLSBUaGUgc2V0IG9mIGNoYW5nZXMgdG8gbWFrZSB0byB0aGUgdmlldydzIGRvY3MuXG4gICAgICogQHBhcmFtIGxpbWJvUmVzb2x1dGlvbkVuYWJsZWQgLSBXaGV0aGVyIHRvIHVwZGF0ZSBsaW1ibyBkb2N1bWVudHMgYmFzZWQgb25cbiAgICAgKiAgICAgICAgdGhpcyBjaGFuZ2UuXG4gICAgICogQHBhcmFtIHRhcmdldENoYW5nZSAtIEEgdGFyZ2V0IGNoYW5nZSB0byBhcHBseSBmb3IgY29tcHV0aW5nIGxpbWJvIGRvY3MgYW5kXG4gICAgICogICAgICAgIHN5bmMgc3RhdGUuXG4gICAgICogQHBhcmFtIHRhcmdldElzUGVuZGluZ1Jlc2V0IC0gV2hldGhlciB0aGUgdGFyZ2V0IGlzIHBlbmRpbmcgdG8gcmVzZXQgZHVlIHRvXG4gICAgICogICAgICAgIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2guIElmIG5vdCBleHBsaWNpdGx5IHNwZWNpZmllZCwgaXQgaXMgdHJlYXRlZFxuICAgICAqICAgICAgICBlcXVpdmFsZW50bHkgdG8gYGZhbHNlYC5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyBWaWV3Q2hhbmdlIHdpdGggdGhlIGdpdmVuIGRvY3MsIGNoYW5nZXMsIGFuZCBzeW5jIHN0YXRlLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIGlPUy9BbmRyb2lkIGNsaWVudHMgYWx3YXlzIGNvbXB1dGUgbGltYm8gZG9jdW1lbnQgY2hhbmdlcy5cbiAgICBhcHBseUNoYW5nZXMoZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gdGhpcy5SYTtcbiAgICAgICAgdGhpcy5SYSA9IGUuUmEsIHRoaXMubXV0YXRlZEtleXMgPSBlLm11dGF0ZWRLZXlzO1xuICAgICAgICAvLyBTb3J0IGNoYW5nZXMgYmFzZWQgb24gdHlwZSBhbmQgcXVlcnkgY29tcGFyYXRvclxuICAgICAgICBjb25zdCBzID0gZS5mYS5HXygpO1xuICAgICAgICBzLnNvcnQoKChlLCB0KSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUNoYW5nZVR5cGUoZSwgdCkge1xuICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovIDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDpcbiAgICAgICAgICAgICAgICAgIGNhc2UgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovIDpcbiAgICAgICAgICAgICAgICAgICAgLy8gQSBtZXRhZGF0YSBjaGFuZ2UgaXMgY29udmVydGVkIHRvIGEgbW9kaWZpZWQgY2hhbmdlIGF0IHRoZSBwdWJsaWNcbiAgICAgICAgICAgICAgICAgICAgLy8gYXBpIGxheWVyLiAgU2luY2Ugd2Ugc29ydCBieSBkb2N1bWVudCBrZXkgYW5kIHRoZW4gY2hhbmdlIHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ldGFkYXRhIGFuZCBtb2RpZmllZCBjaGFuZ2VzIG11c3QgYmUgc29ydGVkIGVxdWl2YWxlbnRseS5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcblxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIG9yZGVyKGUpIC0gb3JkZXIodCk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKGUudHlwZSwgdC50eXBlKSB8fCB0aGlzLkFhKGUuZG9jLCB0LmRvYykpKSwgdGhpcy5wYShuKSwgciA9IG51bGwgIT0gciAmJiByO1xuICAgICAgICBjb25zdCBvID0gdCAmJiAhciA/IHRoaXMueWEoKSA6IFtdLCBfID0gMCA9PT0gdGhpcy5kYS5zaXplICYmIHRoaXMuY3VycmVudCAmJiAhciA/IDEgLyogU3luY1N0YXRlLlN5bmNlZCAqLyA6IDAgLyogU3luY1N0YXRlLkxvY2FsICovICwgYSA9IF8gIT09IHRoaXMuRWE7XG4gICAgICAgIC8vIFdlIGFyZSBhdCBzeW5jZWQgc3RhdGUgaWYgdGhlcmUgaXMgbm8gbGltYm8gZG9jcyBhcmUgd2FpdGluZyB0byBiZSByZXNvbHZlZCwgdmlldyBpcyBjdXJyZW50XG4gICAgICAgIC8vIHdpdGggdGhlIGJhY2tlbmQsIGFuZCB0aGUgcXVlcnkgaXMgbm90IHBlbmRpbmcgdG8gcmVzZXQgZHVlIHRvIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2guXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuRWEgPSBfLCAwICE9PSBzLmxlbmd0aCB8fCBhKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90OiBuZXcgVmlld1NuYXBzaG90KHRoaXMucXVlcnksIGUuUmEsIGksIHMsIGUubXV0YXRlZEtleXMsIDAgLyogU3luY1N0YXRlLkxvY2FsICovID09PSBfLCBhLCBcbiAgICAgICAgICAgICAgICAvKiBleGNsdWRlc01ldGFkYXRhQ2hhbmdlcz0gKi8gITEsICEhbiAmJiBuLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDApLFxuICAgICAgICAgICAgICAgIHdhOiBvXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIG5vIGNoYW5nZXNcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHdhOiBvXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYW4gT25saW5lU3RhdGUgY2hhbmdlIHRvIHRoZSB2aWV3LCBwb3RlbnRpYWxseSBnZW5lcmF0aW5nIGFcbiAgICAgKiBWaWV3Q2hhbmdlIGlmIHRoZSB2aWV3J3Mgc3luY1N0YXRlIGNoYW5nZXMgYXMgYSByZXN1bHQuXG4gICAgICovICAgIFpfKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudCAmJiBcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovID09PSBlID8gKFxuICAgICAgICAvLyBJZiB3ZSdyZSBvZmZsaW5lLCBzZXQgYGN1cnJlbnRgIHRvIGZhbHNlIGFuZCB0aGVuIGNhbGwgYXBwbHlDaGFuZ2VzKClcbiAgICAgICAgLy8gdG8gcmVmcmVzaCBvdXIgc3luY1N0YXRlIGFuZCBnZW5lcmF0ZSBhIFZpZXdDaGFuZ2UgYXMgYXBwcm9wcmlhdGUuIFdlXG4gICAgICAgIC8vIGFyZSBndWFyYW50ZWVkIHRvIGdldCBhIG5ldyBUYXJnZXRDaGFuZ2UgdGhhdCBzZXRzIGBjdXJyZW50YCBiYWNrIHRvXG4gICAgICAgIC8vIHRydWUgb25jZSB0aGUgY2xpZW50IGlzIGJhY2sgb25saW5lLlxuICAgICAgICB0aGlzLmN1cnJlbnQgPSAhMSwgdGhpcy5hcHBseUNoYW5nZXMoe1xuICAgICAgICAgICAgUmE6IHRoaXMuUmEsXG4gICAgICAgICAgICBmYTogbmV3IF9fUFJJVkFURV9Eb2N1bWVudENoYW5nZVNldCxcbiAgICAgICAgICAgIG11dGF0ZWRLZXlzOiB0aGlzLm11dGF0ZWRLZXlzLFxuICAgICAgICAgICAgbnM6ICExXG4gICAgICAgIH0sIFxuICAgICAgICAvKiBsaW1ib1Jlc29sdXRpb25FbmFibGVkPSAqLyAhMSkpIDoge1xuICAgICAgICAgICAgd2E6IFtdXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgZG9jIGZvciB0aGUgZ2l2ZW4ga2V5IHNob3VsZCBiZSBpbiBsaW1iby5cbiAgICAgKi8gICAgU2EoZSkge1xuICAgICAgICAvLyBJZiB0aGUgcmVtb3RlIGVuZCBzYXlzIGl0J3MgcGFydCBvZiB0aGlzIHF1ZXJ5LCBpdCdzIG5vdCBpbiBsaW1iby5cbiAgICAgICAgcmV0dXJuICF0aGlzLlRhLmhhcyhlKSAmJiAoXG4gICAgICAgIC8vIFRoZSBsb2NhbCBzdG9yZSBkb2Vzbid0IHRoaW5rIGl0J3MgYSByZXN1bHQsIHNvIGl0IHNob3VsZG4ndCBiZSBpbiBsaW1iby5cbiAgICAgICAgISF0aGlzLlJhLmhhcyhlKSAmJiAhdGhpcy5SYS5nZXQoZSkuaGFzTG9jYWxNdXRhdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHN5bmNlZERvY3VtZW50cywgY3VycmVudCwgYW5kIGxpbWJvIGRvY3MgYmFzZWQgb24gdGhlIGdpdmVuIGNoYW5nZS5cbiAgICAgKiBSZXR1cm5zIHRoZSBsaXN0IG9mIGNoYW5nZXMgdG8gd2hpY2ggZG9jcyBhcmUgaW4gbGltYm8uXG4gICAgICovICAgIHBhKGUpIHtcbiAgICAgICAgZSAmJiAoZS5hZGRlZERvY3VtZW50cy5mb3JFYWNoKChlID0+IHRoaXMuVGEgPSB0aGlzLlRhLmFkZChlKSkpLCBlLm1vZGlmaWVkRG9jdW1lbnRzLmZvckVhY2goKGUgPT4ge30pKSwgXG4gICAgICAgIGUucmVtb3ZlZERvY3VtZW50cy5mb3JFYWNoKChlID0+IHRoaXMuVGEgPSB0aGlzLlRhLmRlbGV0ZShlKSkpLCB0aGlzLmN1cnJlbnQgPSBlLmN1cnJlbnQpO1xuICAgIH1cbiAgICB5YSgpIHtcbiAgICAgICAgLy8gV2UgY2FuIG9ubHkgZGV0ZXJtaW5lIGxpbWJvIGRvY3VtZW50cyB3aGVuIHdlJ3JlIGluLXN5bmMgd2l0aCB0aGUgc2VydmVyLlxuICAgICAgICBpZiAoIXRoaXMuY3VycmVudCkgcmV0dXJuIFtdO1xuICAgICAgICAvLyBUT0RPKGtsaW10KTogRG8gdGhpcyBpbmNyZW1lbnRhbGx5IHNvIHRoYXQgaXQncyBub3QgcXVhZHJhdGljIHdoZW5cbiAgICAgICAgLy8gdXBkYXRpbmcgbWFueSBkb2N1bWVudHMuXG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuZGE7XG4gICAgICAgIHRoaXMuZGEgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSwgdGhpcy5SYS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuU2EoZS5rZXkpICYmICh0aGlzLmRhID0gdGhpcy5kYS5hZGQoZS5rZXkpKTtcbiAgICAgICAgfSkpO1xuICAgICAgICAvLyBEaWZmIHRoZSBuZXcgbGltYm8gZG9jcyB3aXRoIHRoZSBvbGQgbGltYm8gZG9jcy5cbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGEuaGFzKGUpIHx8IHQucHVzaChuZXcgX19QUklWQVRFX1JlbW92ZWRMaW1ib0RvY3VtZW50KGUpKTtcbiAgICAgICAgfSkpLCB0aGlzLmRhLmZvckVhY2goKG4gPT4ge1xuICAgICAgICAgICAgZS5oYXMobikgfHwgdC5wdXNoKG5ldyBfX1BSSVZBVEVfQWRkZWRMaW1ib0RvY3VtZW50KG4pKTtcbiAgICAgICAgfSkpLCB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGluLW1lbW9yeSBzdGF0ZSBvZiB0aGUgY3VycmVudCB2aWV3IHdpdGggdGhlIHN0YXRlIHJlYWQgZnJvbVxuICAgICAqIHBlcnNpc3RlbmNlLlxuICAgICAqXG4gICAgICogV2UgdXBkYXRlIHRoZSBxdWVyeSB2aWV3IHdoZW5ldmVyIGEgY2xpZW50J3MgcHJpbWFyeSBzdGF0dXMgY2hhbmdlczpcbiAgICAgKiAtIFdoZW4gYSBjbGllbnQgdHJhbnNpdGlvbnMgZnJvbSBwcmltYXJ5IHRvIHNlY29uZGFyeSwgaXQgY2FuIG1pc3NcbiAgICAgKiAgIExvY2FsU3RvcmFnZSB1cGRhdGVzIGFuZCBpdHMgcXVlcnkgdmlld3MgbWF5IHRlbXBvcmFyaWx5IG5vdCBiZVxuICAgICAqICAgc3luY2hyb25pemVkIHdpdGggdGhlIHN0YXRlIG9uIGRpc2suXG4gICAgICogLSBGb3Igc2Vjb25kYXJ5IHRvIHByaW1hcnkgdHJhbnNpdGlvbnMsIHRoZSBjbGllbnQgbmVlZHMgdG8gdXBkYXRlIHRoZSBsaXN0XG4gICAgICogICBvZiBgc3luY2VkRG9jdW1lbnRzYCBzaW5jZSBzZWNvbmRhcnkgY2xpZW50cyB1cGRhdGUgdGhlaXIgcXVlcnkgdmlld3NcbiAgICAgKiAgIGJhc2VkIHB1cmVseSBvbiBzeW50aGVzaXplZCBSZW1vdGVFdmVudHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcXVlcnlSZXN1bHQuZG9jdW1lbnRzIC0gVGhlIGRvY3VtZW50cyB0aGF0IG1hdGNoIHRoZSBxdWVyeSBhY2NvcmRpbmdcbiAgICAgKiB0byB0aGUgTG9jYWxTdG9yZS5cbiAgICAgKiBAcGFyYW0gcXVlcnlSZXN1bHQucmVtb3RlS2V5cyAtIFRoZSBrZXlzIG9mIHRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaCB0aGVcbiAgICAgKiBxdWVyeSBhY2NvcmRpbmcgdG8gdGhlIGJhY2tlbmQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgVmlld0NoYW5nZSB0aGF0IHJlc3VsdGVkIGZyb20gdGhpcyBzeW5jaHJvbml6YXRpb24uXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBiYShlKSB7XG4gICAgICAgIHRoaXMuVGEgPSBlLlRzLCB0aGlzLmRhID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLm1hKGUuZG9jdW1lbnRzKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwbHlDaGFuZ2VzKHQsIC8qIGxpbWJvUmVzb2x1dGlvbkVuYWJsZWQ9ICovICEwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHZpZXcgc25hcHNob3QgYXMgaWYgdGhpcyBxdWVyeSB3YXMganVzdCBsaXN0ZW5lZCB0by4gQ29udGFpbnNcbiAgICAgKiBhIGRvY3VtZW50IGFkZCBmb3IgZXZlcnkgZXhpc3RpbmcgZG9jdW1lbnQgYW5kIHRoZSBgZnJvbUNhY2hlYCBhbmRcbiAgICAgKiBgaGFzUGVuZGluZ1dyaXRlc2Agc3RhdHVzIG9mIHRoZSBhbHJlYWR5IGVzdGFibGlzaGVkIHZpZXcuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBEYSgpIHtcbiAgICAgICAgcmV0dXJuIFZpZXdTbmFwc2hvdC5mcm9tSW5pdGlhbERvY3VtZW50cyh0aGlzLnF1ZXJ5LCB0aGlzLlJhLCB0aGlzLm11dGF0ZWRLZXlzLCAwIC8qIFN5bmNTdGF0ZS5Mb2NhbCAqLyA9PT0gdGhpcy5FYSwgdGhpcy5oYXNDYWNoZWRSZXN1bHRzKTtcbiAgICB9XG59XG5cbi8qKlxuICogUXVlcnlWaWV3IGNvbnRhaW5zIGFsbCBvZiB0aGUgZGF0YSB0aGF0IFN5bmNFbmdpbmUgbmVlZHMgdG8ga2VlcCB0cmFjayBvZiBmb3JcbiAqIGEgcGFydGljdWxhciBxdWVyeS5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5VmlldyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIHF1ZXJ5IGl0c2VsZi5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBUaGUgdGFyZ2V0IG51bWJlciBjcmVhdGVkIGJ5IHRoZSBjbGllbnQgdGhhdCBpcyB1c2VkIGluIHRoZSB3YXRjaFxuICAgICAqIHN0cmVhbSB0byBpZGVudGlmeSB0aGlzIHF1ZXJ5LlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSB2aWV3IGlzIHJlc3BvbnNpYmxlIGZvciBjb21wdXRpbmcgdGhlIGZpbmFsIG1lcmdlZCB0cnV0aCBvZiB3aGF0XG4gICAgICogZG9jcyBhcmUgaW4gdGhlIHF1ZXJ5LiBJdCBnZXRzIG5vdGlmaWVkIG9mIGxvY2FsIGFuZCByZW1vdGUgY2hhbmdlcyxcbiAgICAgKiBhbmQgYXBwbGllcyB0aGUgcXVlcnkgZmlsdGVycyBhbmQgbGltaXRzIHRvIGRldGVybWluZSB0aGUgbW9zdCBjb3JyZWN0XG4gICAgICogcG9zc2libGUgcmVzdWx0cy5cbiAgICAgKi9cbiAgICBuKSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSBlLCB0aGlzLnRhcmdldElkID0gdCwgdGhpcy52aWV3ID0gbjtcbiAgICB9XG59XG5cbi8qKiBUcmFja3MgYSBsaW1ibyByZXNvbHV0aW9uLiAqLyBjbGFzcyBMaW1ib1Jlc29sdXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5rZXkgPSBlLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCB0byB0cnVlIG9uY2Ugd2UndmUgcmVjZWl2ZWQgYSBkb2N1bWVudC4gVGhpcyBpcyB1c2VkIGluXG4gICAgICAgICAqIGdldFJlbW90ZUtleXNGb3JUYXJnZXQoKSBhbmQgdWx0aW1hdGVseSB1c2VkIGJ5IFdhdGNoQ2hhbmdlQWdncmVnYXRvciB0b1xuICAgICAgICAgKiBkZWNpZGUgd2hldGhlciBpdCBuZWVkcyB0byBtYW51ZmFjdHVyZSBhIGRlbGV0ZSBldmVudCBmb3IgdGhlIHRhcmdldCBvbmNlXG4gICAgICAgICAqIHRoZSB0YXJnZXQgaXMgQ1VSUkVOVC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmEgPSAhMTtcbiAgICB9XG59XG5cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgYFN5bmNFbmdpbmVgIGNvb3JkaW5hdGluZyB3aXRoIG90aGVyIHBhcnRzIG9mIFNESy5cbiAqXG4gKiBUaGUgcGFydHMgb2YgU3luY0VuZ2luZSB0aGF0IGFjdCBhcyBhIGNhbGxiYWNrIHRvIFJlbW90ZVN0b3JlIG5lZWQgdG8gYmVcbiAqIHJlZ2lzdGVyZWQgaW5kaXZpZHVhbGx5LiBUaGlzIGlzIGRvbmUgaW4gYHN5bmNFbmdpbmVXcml0ZSgpYCBhbmRcbiAqIGBzeW5jRW5naW5lTGlzdGVuKClgIChhcyB3ZWxsIGFzIGBhcHBseVByaW1hcnlTdGF0ZSgpYCkgYXMgdGhlc2UgbWV0aG9kc1xuICogc2VydmUgYXMgZW50cnkgcG9pbnRzIHRvIFJlbW90ZVN0b3JlJ3MgZnVuY3Rpb25hbGl0eS5cbiAqXG4gKiBOb3RlOiBzb21lIGZpZWxkIGRlZmluZWQgaW4gdGhpcyBjbGFzcyBtaWdodCBoYXZlIHB1YmxpYyBhY2Nlc3MgbGV2ZWwsIGJ1dFxuICogdGhlIGNsYXNzIGlzIG5vdCBleHBvcnRlZCBzbyB0aGV5IGFyZSBvbmx5IGFjY2Vzc2libGUgZnJvbSB0aGlzIG1vZHVsZS5cbiAqIFRoaXMgaXMgdXNlZnVsIHRvIGltcGxlbWVudCBvcHRpb25hbCBmZWF0dXJlcyAobGlrZSBidW5kbGVzKSBpbiBmcmVlXG4gKiBmdW5jdGlvbnMsIHN1Y2ggdGhhdCB0aGV5IGFyZSB0cmVlLXNoYWtlYWJsZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU3luY0VuZ2luZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIFxuICAgIC8vIFBPUlRJTkcgTk9URTogTWFuYWdlcyBzdGF0ZSBzeW5jaHJvbml6YXRpb24gaW4gbXVsdGktdGFiIGVudmlyb25tZW50cy5cbiAgICByLCBpLCBzKSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSA9IGUsIHRoaXMucmVtb3RlU3RvcmUgPSB0LCB0aGlzLmV2ZW50TWFuYWdlciA9IG4sIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUgPSByLCBcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IGksIHRoaXMubWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnMgPSBzLCB0aGlzLkNhID0ge30sIHRoaXMuRmEgPSBuZXcgT2JqZWN0TWFwKChlID0+IF9fUFJJVkFURV9jYW5vbmlmeVF1ZXJ5KGUpKSwgX19QUklWQVRFX3F1ZXJ5RXF1YWxzKSwgXG4gICAgICAgIHRoaXMuTWEgPSBuZXcgTWFwLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBrZXlzIG9mIGRvY3VtZW50cyB0aGF0IGFyZSBpbiBsaW1ibyBmb3Igd2hpY2ggd2UgaGF2ZW4ndCB5ZXQgc3RhcnRlZCBhXG4gICAgICAgICAqIGxpbWJvIHJlc29sdXRpb24gcXVlcnkuIFRoZSBzdHJpbmdzIGluIHRoaXMgc2V0IGFyZSB0aGUgcmVzdWx0IG9mIGNhbGxpbmdcbiAgICAgICAgICogYGtleS5wYXRoLmNhbm9uaWNhbFN0cmluZygpYCB3aGVyZSBga2V5YCBpcyBhIGBEb2N1bWVudEtleWAgb2JqZWN0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGUgYFNldGAgdHlwZSB3YXMgY2hvc2VuIGJlY2F1c2UgaXQgcHJvdmlkZXMgZWZmaWNpZW50IGxvb2t1cCBhbmQgcmVtb3ZhbFxuICAgICAgICAgKiBvZiBhcmJpdHJhcnkgZWxlbWVudHMgYW5kIGl0IGFsc28gbWFpbnRhaW5zIGluc2VydGlvbiBvcmRlciwgcHJvdmlkaW5nIHRoZVxuICAgICAgICAgKiBkZXNpcmVkIHF1ZXVlLWxpa2UgRklGTyBzZW1hbnRpY3MuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnhhID0gbmV3IFNldCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgdGFyZ2V0IElEIGZvciBlYWNoIGRvY3VtZW50IHRoYXQgaXMgaW4gbGltYm8gd2l0aCBhblxuICAgICAgICAgKiBhY3RpdmUgdGFyZ2V0LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5PYSA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvciksIFxuICAgICAgICAvKipcbiAgICAgICAgICogS2VlcHMgdHJhY2sgb2YgdGhlIGluZm9ybWF0aW9uIGFib3V0IGFuIGFjdGl2ZSBsaW1ibyByZXNvbHV0aW9uIGZvciBlYWNoXG4gICAgICAgICAqIGFjdGl2ZSB0YXJnZXQgSUQgdGhhdCB3YXMgc3RhcnRlZCBmb3IgdGhlIHB1cnBvc2Ugb2YgbGltYm8gcmVzb2x1dGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuTmEgPSBuZXcgTWFwLCB0aGlzLkxhID0gbmV3IF9fUFJJVkFURV9SZWZlcmVuY2VTZXQsIFxuICAgICAgICAvKiogU3RvcmVzIHVzZXIgY29tcGxldGlvbiBoYW5kbGVycywgaW5kZXhlZCBieSBVc2VyIGFuZCBCYXRjaElkLiAqL1xuICAgICAgICB0aGlzLkJhID0ge30sIFxuICAgICAgICAvKiogU3RvcmVzIHVzZXIgY2FsbGJhY2tzIHdhaXRpbmcgZm9yIGFsbCBwZW5kaW5nIHdyaXRlcyB0byBiZSBhY2tub3dsZWRnZWQuICovXG4gICAgICAgIHRoaXMua2EgPSBuZXcgTWFwLCB0aGlzLnFhID0gX19QUklWQVRFX1RhcmdldElkR2VuZXJhdG9yLmtuKCksIHRoaXMub25saW5lU3RhdGUgPSBcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovICwgXG4gICAgICAgIC8vIFRoZSBwcmltYXJ5IHN0YXRlIGlzIHNldCB0byBgdHJ1ZWAgb3IgYGZhbHNlYCBpbW1lZGlhdGVseSBhZnRlciBGaXJlc3RvcmVcbiAgICAgICAgLy8gc3RhcnR1cC4gSW4gdGhlIGludGVyaW0sIGEgY2xpZW50IHNob3VsZCBvbmx5IGJlIGNvbnNpZGVyZWQgcHJpbWFyeSBpZlxuICAgICAgICAvLyBgaXNQcmltYXJ5YCBpcyB0cnVlLlxuICAgICAgICB0aGlzLlFhID0gdm9pZCAwO1xuICAgIH1cbiAgICBnZXQgaXNQcmltYXJ5Q2xpZW50KCkge1xuICAgICAgICByZXR1cm4gITAgPT09IHRoaXMuUWE7XG4gICAgfVxufVxuXG4vKipcbiAqIEluaXRpYXRlcyB0aGUgbmV3IGxpc3RlbiwgcmVzb2x2ZXMgcHJvbWlzZSB3aGVuIGxpc3RlbiBlbnF1ZXVlZCB0byB0aGVcbiAqIHNlcnZlci4gQWxsIHRoZSBzdWJzZXF1ZW50IHZpZXcgc25hcHNob3RzIG9yIGVycm9ycyBhcmUgc2VudCB0byB0aGVcbiAqIHN1YnNjcmliZWQgaGFuZGxlcnMuIFJldHVybnMgdGhlIGluaXRpYWwgc25hcHNob3QuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lTGlzdGVuKGUsIHQsIG4gPSAhMCkge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MoZSk7XG4gICAgbGV0IGk7XG4gICAgY29uc3QgcyA9IHIuRmEuZ2V0KHQpO1xuICAgIHJldHVybiBzID8gKFxuICAgIC8vIFBPUlRJTkcgTk9URTogV2l0aCBNdWx0aS1UYWIgV2ViLCBpdCBpcyBwb3NzaWJsZSB0aGF0IGEgcXVlcnkgdmlld1xuICAgIC8vIGFscmVhZHkgZXhpc3RzIHdoZW4gRXZlbnRNYW5hZ2VyIGNhbGxzIHVzIGZvciB0aGUgZmlyc3QgdGltZS4gVGhpc1xuICAgIC8vIGhhcHBlbnMgd2hlbiB0aGUgcHJpbWFyeSB0YWIgaXMgYWxyZWFkeSBsaXN0ZW5pbmcgdG8gdGhpcyBxdWVyeSBvblxuICAgIC8vIGJlaGFsZiBvZiBhbm90aGVyIHRhYiBhbmQgdGhlIHVzZXIgb2YgdGhlIHByaW1hcnkgYWxzbyBzdGFydHMgbGlzdGVuaW5nXG4gICAgLy8gdG8gdGhlIHF1ZXJ5LiBFdmVudE1hbmFnZXIgd2lsbCBub3QgaGF2ZSBhbiBhc3NpZ25lZCB0YXJnZXQgSUQgaW4gdGhpc1xuICAgIC8vIGNhc2UgYW5kIGNhbGxzIGBsaXN0ZW5gIHRvIG9idGFpbiB0aGlzIElELlxuICAgIHIuc2hhcmVkQ2xpZW50U3RhdGUuYWRkTG9jYWxRdWVyeVRhcmdldChzLnRhcmdldElkKSwgaSA9IHMudmlldy5EYSgpKSA6IGkgPSBhd2FpdCBfX1BSSVZBVEVfYWxsb2NhdGVUYXJnZXRBbmRNYXliZUxpc3RlbihyLCB0LCBuLCBcbiAgICAvKiogc2hvdWxkSW5pdGlhbGl6ZVZpZXc9ICovICEwKSwgaTtcbn1cblxuLyoqIFF1ZXJ5IGhhcyBiZWVuIGxpc3RlbmluZyB0byB0aGUgY2FjaGUsIGFuZCB0cmllcyB0byBpbml0aWF0ZSB0aGUgcmVtb3RlIHN0b3JlIGxpc3RlbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfdHJpZ2dlclJlbW90ZVN0b3JlTGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2Vuc3VyZVdhdGNoQ2FsbGJhY2tzKGUpO1xuICAgIGF3YWl0IF9fUFJJVkFURV9hbGxvY2F0ZVRhcmdldEFuZE1heWJlTGlzdGVuKG4sIHQsIFxuICAgIC8qKiBzaG91bGRMaXN0ZW5Ub1JlbW90ZT0gKi8gITAsIFxuICAgIC8qKiBzaG91bGRJbml0aWFsaXplVmlldz0gKi8gITEpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfYWxsb2NhdGVUYXJnZXRBbmRNYXliZUxpc3RlbihlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQWxsb2NhdGVUYXJnZXQoZS5sb2NhbFN0b3JlLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldCh0KSksIHMgPSBpLnRhcmdldElkLCBvID0gZS5zaGFyZWRDbGllbnRTdGF0ZS5hZGRMb2NhbFF1ZXJ5VGFyZ2V0KHMsIG4pO1xuICAgIGxldCBfO1xuICAgIHJldHVybiByICYmIChfID0gYXdhaXQgX19QUklWQVRFX2luaXRpYWxpemVWaWV3QW5kQ29tcHV0ZVNuYXBzaG90KGUsIHQsIHMsIFwiY3VycmVudFwiID09PSBvLCBpLnJlc3VtZVRva2VuKSksIFxuICAgIGUuaXNQcmltYXJ5Q2xpZW50ICYmIG4gJiYgX19QUklWQVRFX3JlbW90ZVN0b3JlTGlzdGVuKGUucmVtb3RlU3RvcmUsIGkpLCBfO1xufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIHZpZXcgZm9yIGEgcHJldmlvdXNseSB1bmtub3duIHF1ZXJ5IGFuZCBjb21wdXRlcyBpdHMgaW5pdGlhbFxuICogc25hcHNob3QuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2luaXRpYWxpemVWaWV3QW5kQ29tcHV0ZVNuYXBzaG90KGUsIHQsIG4sIHIsIGkpIHtcbiAgICAvLyBQT1JUSU5HIE5PVEU6IE9uIFdlYiBvbmx5LCB3ZSBpbmplY3QgdGhlIGNvZGUgdGhhdCByZWdpc3RlcnMgbmV3IExpbWJvXG4gICAgLy8gdGFyZ2V0cyBiYXNlZCBvbiB2aWV3IGNoYW5nZXMuIFRoaXMgYWxsb3dzIHVzIHRvIG9ubHkgZGVwZW5kIG9uIExpbWJvXG4gICAgLy8gY2hhbmdlcyB3aGVuIHVzZXIgY29kZSBpbmNsdWRlcyBxdWVyaWVzLlxuICAgIGUuS2EgPSAodCwgbiwgcikgPT4gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RG9jQ2hhbmdlcyhlLCB0LCBuLCByKSB7XG4gICAgICAgIGxldCBpID0gdC52aWV3Lm1hKG4pO1xuICAgICAgICBpLm5zICYmIChcbiAgICAgICAgLy8gVGhlIHF1ZXJ5IGhhcyBhIGxpbWl0IGFuZCBzb21lIGRvY3Mgd2VyZSByZW1vdmVkLCBzbyB3ZSBuZWVkXG4gICAgICAgIC8vIHRvIHJlLXJ1biB0aGUgcXVlcnkgYWdhaW5zdCB0aGUgbG9jYWwgc3RvcmUgdG8gbWFrZSBzdXJlIHdlXG4gICAgICAgIC8vIGRpZG4ndCBsb3NlIGFueSBnb29kIGRvY3MgdGhhdCBoYWQgYmVlbiBwYXN0IHRoZSBsaW1pdC5cbiAgICAgICAgaSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlRXhlY3V0ZVF1ZXJ5KGUubG9jYWxTdG9yZSwgdC5xdWVyeSwgXG4gICAgICAgIC8qIHVzZVByZXZpb3VzUmVzdWx0cz0gKi8gITEpLnRoZW4oKCh7ZG9jdW1lbnRzOiBlfSkgPT4gdC52aWV3Lm1hKGUsIGkpKSkpO1xuICAgICAgICBjb25zdCBzID0gciAmJiByLnRhcmdldENoYW5nZXMuZ2V0KHQudGFyZ2V0SWQpLCBvID0gciAmJiBudWxsICE9IHIudGFyZ2V0TWlzbWF0Y2hlcy5nZXQodC50YXJnZXRJZCksIF8gPSB0LnZpZXcuYXBwbHlDaGFuZ2VzKGksIFxuICAgICAgICAvKiBsaW1ib1Jlc29sdXRpb25FbmFibGVkPSAqLyBlLmlzUHJpbWFyeUNsaWVudCwgcywgbyk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdXBkYXRlVHJhY2tlZExpbWJvcyhlLCB0LnRhcmdldElkLCBfLndhKSwgXy5zbmFwc2hvdDtcbiAgICB9KGUsIHQsIG4sIHIpO1xuICAgIGNvbnN0IHMgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUV4ZWN1dGVRdWVyeShlLmxvY2FsU3RvcmUsIHQsIFxuICAgIC8qIHVzZVByZXZpb3VzUmVzdWx0cz0gKi8gITApLCBvID0gbmV3IF9fUFJJVkFURV9WaWV3KHQsIHMuVHMpLCBfID0gby5tYShzLmRvY3VtZW50cyksIGEgPSBUYXJnZXRDaGFuZ2UuY3JlYXRlU3ludGhlc2l6ZWRUYXJnZXRDaGFuZ2VGb3JDdXJyZW50Q2hhbmdlKG4sIHIgJiYgXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyAhPT0gZS5vbmxpbmVTdGF0ZSwgaSksIHUgPSBvLmFwcGx5Q2hhbmdlcyhfLCBcbiAgICAvKiBsaW1ib1Jlc29sdXRpb25FbmFibGVkPSAqLyBlLmlzUHJpbWFyeUNsaWVudCwgYSk7XG4gICAgX19QUklWQVRFX3VwZGF0ZVRyYWNrZWRMaW1ib3MoZSwgbiwgdS53YSk7XG4gICAgY29uc3QgYyA9IG5ldyBfX1BSSVZBVEVfUXVlcnlWaWV3KHQsIG4sIG8pO1xuICAgIHJldHVybiBlLkZhLnNldCh0LCBjKSwgZS5NYS5oYXMobikgPyBlLk1hLmdldChuKS5wdXNoKHQpIDogZS5NYS5zZXQobiwgWyB0IF0pLCB1LnNuYXBzaG90O1xufVxuXG4vKiogU3RvcHMgbGlzdGVuaW5nIHRvIHRoZSBxdWVyeS4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVVbmxpc3RlbihlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSByLkZhLmdldCh0KSwgcyA9IHIuTWEuZ2V0KGkudGFyZ2V0SWQpO1xuICAgIGlmIChzLmxlbmd0aCA+IDEpIHJldHVybiByLk1hLnNldChpLnRhcmdldElkLCBzLmZpbHRlcigoZSA9PiAhX19QUklWQVRFX3F1ZXJ5RXF1YWxzKGUsIHQpKSkpLCBcbiAgICB2b2lkIHIuRmEuZGVsZXRlKHQpO1xuICAgIC8vIE5vIG90aGVyIHF1ZXJpZXMgYXJlIG1hcHBlZCB0byB0aGUgdGFyZ2V0LCBjbGVhbiB1cCB0aGUgcXVlcnkgYW5kIHRoZSB0YXJnZXQuXG4gICAgICAgIGlmIChyLmlzUHJpbWFyeUNsaWVudCkge1xuICAgICAgICAvLyBXZSBuZWVkIHRvIHJlbW92ZSB0aGUgbG9jYWwgcXVlcnkgdGFyZ2V0IGZpcnN0IHRvIGFsbG93IHVzIHRvIHZlcmlmeVxuICAgICAgICAvLyB3aGV0aGVyIGFueSBvdGhlciBjbGllbnQgaXMgc3RpbGwgaW50ZXJlc3RlZCBpbiB0aGlzIHRhcmdldC5cbiAgICAgICAgci5zaGFyZWRDbGllbnRTdGF0ZS5yZW1vdmVMb2NhbFF1ZXJ5VGFyZ2V0KGkudGFyZ2V0SWQpO1xuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLmlzQWN0aXZlUXVlcnlUYXJnZXQoaS50YXJnZXRJZCkgfHwgYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KHIubG9jYWxTdG9yZSwgaS50YXJnZXRJZCwgXG4gICAgICAgIC8qa2VlcFBlcnNpc3RlZFRhcmdldERhdGE9Ki8gITEpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIHIuc2hhcmVkQ2xpZW50U3RhdGUuY2xlYXJRdWVyeVN0YXRlKGkudGFyZ2V0SWQpLCBuICYmIF9fUFJJVkFURV9yZW1vdGVTdG9yZVVubGlzdGVuKHIucmVtb3RlU3RvcmUsIGkudGFyZ2V0SWQpLCBcbiAgICAgICAgICAgIF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KHIsIGkudGFyZ2V0SWQpO1xuICAgICAgICB9KSkuY2F0Y2goX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyk7XG4gICAgfSBlbHNlIF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KHIsIGkudGFyZ2V0SWQpLCBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQoci5sb2NhbFN0b3JlLCBpLnRhcmdldElkLCBcbiAgICAvKmtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhPSovICEwKTtcbn1cblxuLyoqIFVubGlzdGVucyB0byB0aGUgcmVtb3RlIHN0b3JlIHdoaWxlIHN0aWxsIGxpc3RlbmluZyB0byB0aGUgY2FjaGUuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV90cmlnZ2VyUmVtb3RlU3RvcmVVbmxpc3RlbihlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBuLkZhLmdldCh0KSwgaSA9IG4uTWEuZ2V0KHIudGFyZ2V0SWQpO1xuICAgIG4uaXNQcmltYXJ5Q2xpZW50ICYmIDEgPT09IGkubGVuZ3RoICYmIChcbiAgICAvLyBQT1JUSU5HIE5PVEU6IFVucmVnaXN0ZXIgdGhlIHRhcmdldCBJRCB3aXRoIGxvY2FsIEZpcmVzdG9yZSBjbGllbnQgYXNcbiAgICAvLyB3YXRjaCB0YXJnZXQuXG4gICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5yZW1vdmVMb2NhbFF1ZXJ5VGFyZ2V0KHIudGFyZ2V0SWQpLCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3RlbihuLnJlbW90ZVN0b3JlLCByLnRhcmdldElkKSk7XG59XG5cbi8qKlxuICogSW5pdGlhdGVzIHRoZSB3cml0ZSBvZiBsb2NhbCBtdXRhdGlvbiBiYXRjaCB3aGljaCBpbnZvbHZlcyBhZGRpbmcgdGhlXG4gKiB3cml0ZXMgdG8gdGhlIG11dGF0aW9uIHF1ZXVlLCBub3RpZnlpbmcgdGhlIHJlbW90ZSBzdG9yZSBhYm91dCBuZXdcbiAqIG11dGF0aW9ucyBhbmQgcmFpc2luZyBldmVudHMgZm9yIGFueSBjaGFuZ2VzIHRoaXMgd3JpdGUgY2F1c2VkLlxuICpcbiAqIFRoZSBwcm9taXNlIHJldHVybmVkIGJ5IHRoaXMgY2FsbCBpcyByZXNvbHZlZCB3aGVuIHRoZSBhYm92ZSBzdGVwc1xuICogaGF2ZSBjb21wbGV0ZWQsICpub3QqIHdoZW4gdGhlIHdyaXRlIHdhcyBhY2tlZCBieSB0aGUgYmFja2VuZC4gVGhlXG4gKiB1c2VyQ2FsbGJhY2sgaXMgcmVzb2x2ZWQgb25jZSB0aGUgd3JpdGUgd2FzIGFja2VkL3JlamVjdGVkIGJ5IHRoZVxuICogYmFja2VuZCAob3IgZmFpbGVkIGxvY2FsbHkgZm9yIGFueSBvdGhlciByZWFzb24pLlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lV3JpdGUoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfc3luY0VuZ2luZUVuc3VyZVdyaXRlQ2FsbGJhY2tzKGUpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZVdyaXRlTG9jYWxseShlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IFRpbWVzdGFtcC5ub3coKSwgaSA9IHQucmVkdWNlKCgoZSwgdCkgPT4gZS5hZGQodC5rZXkpKSwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCkpO1xuICAgICAgICAgICAgbGV0IHMsIG87XG4gICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkxvY2FsbHkgd3JpdGUgbXV0YXRpb25zXCIsIFwicmVhZHdyaXRlXCIsIChlID0+IHtcbiAgICAgICAgICAgICAgICAvLyBGaWd1cmUgb3V0IHdoaWNoIGtleXMgZG8gbm90IGhhdmUgYSByZW1vdGUgdmVyc2lvbiBpbiB0aGUgY2FjaGUsIHRoaXNcbiAgICAgICAgICAgICAgICAvLyBpcyBuZWVkZWQgdG8gY3JlYXRlIHRoZSByaWdodCBvdmVybGF5IG11dGF0aW9uOiBpZiBubyByZW1vdGUgdmVyc2lvblxuICAgICAgICAgICAgICAgIC8vIHByZXNlbnRzLCB3ZSBkbyBub3QgbmVlZCB0byBjcmVhdGUgb3ZlcmxheXMgYXMgcGF0Y2ggbXV0YXRpb25zLlxuICAgICAgICAgICAgICAgIC8vIFRPRE8oT3ZlcmxheSk6IElzIHRoZXJlIGEgYmV0dGVyIHdheSB0byBkZXRlcm1pbmUgdGhpcz8gVXNpbmcgdGhlXG4gICAgICAgICAgICAgICAgLy8gIGRvY3VtZW50IHZlcnNpb24gZG9lcyBub3Qgd29yayBiZWNhdXNlIGxvY2FsIG11dGF0aW9ucyBzZXQgdGhlbSBiYWNrXG4gICAgICAgICAgICAgICAgLy8gIHRvIDAuXG4gICAgICAgICAgICAgICAgbGV0IF8gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCksIGEgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5jcy5nZXRFbnRyaWVzKGUsIGkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBfID0gZSwgXy5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5pc1ZhbGlkRG9jdW1lbnQoKSB8fCAoYSA9IGEuYWRkKGUpKTtcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldE92ZXJsYXllZERvY3VtZW50cyhlLCBfKSkpLm5leHQoKGkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzID0gaTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIG5vbi1pZGVtcG90ZW50IG11dGF0aW9ucyAoc3VjaCBhcyBgRmllbGRWYWx1ZS5pbmNyZW1lbnQoKWApLFxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSByZWNvcmQgdGhlIGJhc2Ugc3RhdGUgaW4gYSBzZXBhcmF0ZSBwYXRjaCBtdXRhdGlvbi4gVGhpcyBpc1xuICAgICAgICAgICAgICAgICAgICAvLyBsYXRlciB1c2VkIHRvIGd1YXJhbnRlZSBjb25zaXN0ZW50IHZhbHVlcyBhbmQgcHJldmVudHMgZmxpY2tlclxuICAgICAgICAgICAgICAgICAgICAvLyBldmVuIGlmIHRoZSBiYWNrZW5kIHNlbmRzIHVzIGFuIHVwZGF0ZSB0aGF0IGFscmVhZHkgaW5jbHVkZXMgb3VyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRyYW5zZm9ybS5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9tdXRhdGlvbkV4dHJhY3RCYXNlVmFsdWUoZSwgcy5nZXQoZS5rZXkpLm92ZXJsYXllZERvY3VtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gdCAmJiBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5PVEU6IFRoZSBiYXNlIHN0YXRlIHNob3VsZCBvbmx5IGJlIGFwcGxpZWQgaWYgdGhlcmUncyBzb21lXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBleGlzdGluZyBkb2N1bWVudCB0byBvdmVycmlkZSwgc28gdXNlIGEgUHJlY29uZGl0aW9uIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBleGlzdHM9dHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgby5wdXNoKG5ldyBfX1BSSVZBVEVfUGF0Y2hNdXRhdGlvbihlLmtleSwgdCwgX19QUklWQVRFX2V4dHJhY3RGaWVsZE1hc2sodC52YWx1ZS5tYXBWYWx1ZSksIFByZWNvbmRpdGlvbi5leGlzdHMoITApKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4ubXV0YXRpb25RdWV1ZS5hZGRNdXRhdGlvbkJhdGNoKGUsIHIsIG8sIHQpO1xuICAgICAgICAgICAgICAgIH0pKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbyA9IHQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0LmFwcGx5VG9Mb2NhbERvY3VtZW50U2V0KHMsIGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5kb2N1bWVudE92ZXJsYXlDYWNoZS5zYXZlT3ZlcmxheXMoZSwgdC5iYXRjaElkLCByKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSkudGhlbigoKCkgPT4gKHtcbiAgICAgICAgICAgICAgICBiYXRjaElkOiBvLmJhdGNoSWQsXG4gICAgICAgICAgICAgICAgY2hhbmdlczogX19QUklWQVRFX2NvbnZlcnRPdmVybGF5ZWREb2N1bWVudE1hcFRvRG9jdW1lbnRNYXAocylcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0oci5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgci5zaGFyZWRDbGllbnRTdGF0ZS5hZGRQZW5kaW5nTXV0YXRpb24oZS5iYXRjaElkKSwgZnVuY3Rpb24gX19QUklWQVRFX2FkZE11dGF0aW9uQ2FsbGJhY2soZSwgdCwgbikge1xuICAgICAgICAgICAgbGV0IHIgPSBlLkJhW2UuY3VycmVudFVzZXIudG9LZXkoKV07XG4gICAgICAgICAgICByIHx8IChyID0gbmV3IFNvcnRlZE1hcChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcikpO1xuICAgICAgICAgICAgciA9IHIuaW5zZXJ0KHQsIG4pLCBlLkJhW2UuY3VycmVudFVzZXIudG9LZXkoKV0gPSByO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmVzb2x2ZXMgb3IgcmVqZWN0cyB0aGUgdXNlciBjYWxsYmFjayBmb3IgdGhlIGdpdmVuIGJhdGNoIGFuZCB0aGVuIGRpc2NhcmRzXG4gKiBpdC5cbiAqLyAociwgZS5iYXRjaElkLCBuKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKHIsIGUuY2hhbmdlcyksIFxuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUoci5yZW1vdGVTdG9yZSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBJZiB3ZSBjYW4ndCBwZXJzaXN0IHRoZSBtdXRhdGlvbiwgd2UgcmVqZWN0IHRoZSB1c2VyIGNhbGxiYWNrIGFuZFxuICAgICAgICAvLyBkb24ndCBzZW5kIHRoZSBtdXRhdGlvbi4gVGhlIHVzZXIgY2FuIHRoZW4gcmV0cnkgdGhlIHdyaXRlLlxuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3dyYXBJblVzZXJFcnJvcklmUmVjb3ZlcmFibGUoZSwgXCJGYWlsZWQgdG8gcGVyc2lzdCB3cml0ZVwiKTtcbiAgICAgICAgbi5yZWplY3QodCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgb25lIHJlbW90ZSBldmVudCB0byB0aGUgc3luYyBlbmdpbmUsIG5vdGlmeWluZyBhbnkgdmlld3Mgb2YgdGhlXG4gKiBjaGFuZ2VzLCBhbmQgcmVsZWFzaW5nIGFueSBwZW5kaW5nIG11dGF0aW9uIGJhdGNoZXMgdGhhdCB3b3VsZCBiZWNvbWVcbiAqIHZpc2libGUgYmVjYXVzZSBvZiB0aGUgc25hcHNob3QgdmVyc2lvbiB0aGUgcmVtb3RlIGV2ZW50IGNvbnRhaW5zLlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlSZW1vdGVFdmVudChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQXBwbHlSZW1vdGVFdmVudFRvTG9jYWxDYWNoZShuLmxvY2FsU3RvcmUsIHQpO1xuICAgICAgICAvLyBVcGRhdGUgYHJlY2VpdmVkRG9jdW1lbnRgIGFzIGFwcHJvcHJpYXRlIGZvciBhbnkgbGltYm8gdGFyZ2V0cy5cbiAgICAgICAgICAgICAgICB0LnRhcmdldENoYW5nZXMuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBuLk5hLmdldCh0KTtcbiAgICAgICAgICAgIHIgJiYgKFxuICAgICAgICAgICAgLy8gU2luY2UgdGhpcyBpcyBhIGxpbWJvIHJlc29sdXRpb24gbG9va3VwLCBpdCdzIGZvciBhIHNpbmdsZSBkb2N1bWVudFxuICAgICAgICAgICAgLy8gYW5kIGl0IGNvdWxkIGJlIGFkZGVkLCBtb2RpZmllZCwgb3IgcmVtb3ZlZCwgYnV0IG5vdCBhIGNvbWJpbmF0aW9uLlxuICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoZS5hZGRlZERvY3VtZW50cy5zaXplICsgZS5tb2RpZmllZERvY3VtZW50cy5zaXplICsgZS5yZW1vdmVkRG9jdW1lbnRzLnNpemUgPD0gMSksIFxuICAgICAgICAgICAgZS5hZGRlZERvY3VtZW50cy5zaXplID4gMCA/IHIudmEgPSAhMCA6IGUubW9kaWZpZWREb2N1bWVudHMuc2l6ZSA+IDAgPyBfX1BSSVZBVEVfaGFyZEFzc2VydChyLnZhKSA6IGUucmVtb3ZlZERvY3VtZW50cy5zaXplID4gMCAmJiAoX19QUklWQVRFX2hhcmRBc3NlcnQoci52YSksIFxuICAgICAgICAgICAgci52YSA9ICExKSk7XG4gICAgICAgIH0pKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKG4sIGUsIHQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyBhbiBPbmxpbmVTdGF0ZSBjaGFuZ2UgdG8gdGhlIHN5bmMgZW5naW5lIGFuZCBub3RpZmllcyBhbnkgdmlld3Mgb2ZcbiAqIHRoZSBjaGFuZ2UuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseU9ubGluZVN0YXRlQ2hhbmdlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAvLyBJZiB3ZSBhcmUgdGhlIHNlY29uZGFyeSBjbGllbnQsIHdlIGV4cGxpY2l0bHkgaWdub3JlIHRoZSByZW1vdGUgc3RvcmUnc1xuICAgIC8vIG9ubGluZSBzdGF0ZSAodGhlIGxvY2FsIGNsaWVudCBtYXkgZ28gb2ZmbGluZSwgZXZlbiB0aG91Z2ggdGhlIHByaW1hcnlcbiAgICAvLyB0YWIgcmVtYWlucyBvbmxpbmUpIGFuZCBvbmx5IGFwcGx5IHRoZSBwcmltYXJ5IHRhYidzIG9ubGluZSBzdGF0ZSBmcm9tXG4gICAgLy8gU2hhcmVkQ2xpZW50U3RhdGUuXG4gICAgICAgIGlmIChyLmlzUHJpbWFyeUNsaWVudCAmJiAwIC8qIE9ubGluZVN0YXRlU291cmNlLlJlbW90ZVN0b3JlICovID09PSBuIHx8ICFyLmlzUHJpbWFyeUNsaWVudCAmJiAxIC8qIE9ubGluZVN0YXRlU291cmNlLlNoYXJlZENsaWVudFN0YXRlICovID09PSBuKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgci5GYS5mb3JFYWNoKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHIudmlldy5aXyh0KTtcbiAgICAgICAgICAgIGkuc25hcHNob3QgJiYgZS5wdXNoKGkuc25hcHNob3QpO1xuICAgICAgICB9KSksIGZ1bmN0aW9uIF9fUFJJVkFURV9ldmVudE1hbmFnZXJPbk9ubGluZVN0YXRlQ2hhbmdlKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgbi5vbmxpbmVTdGF0ZSA9IHQ7XG4gICAgICAgICAgICBsZXQgciA9ICExO1xuICAgICAgICAgICAgbi5xdWVyaWVzLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIG4ual8pIFxuICAgICAgICAgICAgICAgIC8vIFJ1biBnbG9iYWwgc25hcHNob3QgbGlzdGVuZXJzIGlmIGEgY29uc2lzdGVudCBzbmFwc2hvdCBoYXMgYmVlbiBlbWl0dGVkLlxuICAgICAgICAgICAgICAgIGUuWl8odCkgJiYgKHIgPSAhMCk7XG4gICAgICAgICAgICB9KSksIHIgJiYgX19QUklWQVRFX3JhaXNlU25hcHNob3RzSW5TeW5jRXZlbnQobik7XG4gICAgICAgIH0oci5ldmVudE1hbmFnZXIsIHQpLCBlLmxlbmd0aCAmJiByLkNhLmRfKGUpLCByLm9ubGluZVN0YXRlID0gdCwgci5pc1ByaW1hcnlDbGllbnQgJiYgci5zaGFyZWRDbGllbnRTdGF0ZS5zZXRPbmxpbmVTdGF0ZSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVqZWN0cyB0aGUgbGlzdGVuIGZvciB0aGUgZ2l2ZW4gdGFyZ2V0SUQuIFRoaXMgY2FuIGJlIHRyaWdnZXJlZCBieSB0aGVcbiAqIGJhY2tlbmQgZm9yIGFueSBhY3RpdmUgdGFyZ2V0LlxuICpcbiAqIEBwYXJhbSBzeW5jRW5naW5lIC0gVGhlIHN5bmMgZW5naW5lIGltcGxlbWVudGF0aW9uLlxuICogQHBhcmFtIHRhcmdldElkIC0gVGhlIHRhcmdldElEIGNvcnJlc3BvbmRzIHRvIG9uZSBwcmV2aW91c2x5IGluaXRpYXRlZCBieSB0aGVcbiAqIHVzZXIgYXMgcGFydCBvZiBUYXJnZXREYXRhIHBhc3NlZCB0byBsaXN0ZW4oKSBvbiBSZW1vdGVTdG9yZS5cbiAqIEBwYXJhbSBlcnIgLSBBIGRlc2NyaXB0aW9uIG9mIHRoZSBjb25kaXRpb24gdGhhdCBoYXMgZm9yY2VkIHRoZSByZWplY3Rpb24uXG4gKiBOZWFybHkgYWx3YXlzIHRoaXMgd2lsbCBiZSBhbiBpbmRpY2F0aW9uIHRoYXQgdGhlIHVzZXIgaXMgbm8gbG9uZ2VyXG4gKiBhdXRob3JpemVkIHRvIHNlZSB0aGUgZGF0YSBtYXRjaGluZyB0aGUgdGFyZ2V0LlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lUmVqZWN0TGlzdGVuKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZVF1ZXJ5U3RhdGUodCwgXCJyZWplY3RlZFwiLCBuKTtcbiAgICBjb25zdCBpID0gci5OYS5nZXQodCksIHMgPSBpICYmIGkua2V5O1xuICAgIGlmIChzKSB7XG4gICAgICAgIC8vIFRPRE8oa2xpbXQpOiBXZSByZWFsbHkgb25seSBzaG91bGQgZG8gdGhlIGZvbGxvd2luZyBvbiBwZXJtaXNzaW9uXG4gICAgICAgIC8vIGRlbmllZCBlcnJvcnMsIGJ1dCB3ZSBkb24ndCBoYXZlIHRoZSBjYXVzZSBjb2RlIGhlcmUuXG4gICAgICAgIC8vIEl0J3MgYSBsaW1ibyBkb2MuIENyZWF0ZSBhIHN5bnRoZXRpYyBldmVudCBzYXlpbmcgaXQgd2FzIGRlbGV0ZWQuXG4gICAgICAgIC8vIFRoaXMgaXMga2luZCBvZiBhIGhhY2suIElkZWFsbHksIHdlIHdvdWxkIGhhdmUgYSBtZXRob2QgaW4gdGhlIGxvY2FsXG4gICAgICAgIC8vIHN0b3JlIHRvIHB1cmdlIGEgZG9jdW1lbnQuIEhvd2V2ZXIsIGl0IHdvdWxkIGJlIHRyaWNreSB0byBrZWVwIGFsbCBvZlxuICAgICAgICAvLyB0aGUgbG9jYWwgc3RvcmUncyBpbnZhcmlhbnRzIHdpdGggYW5vdGhlciBtZXRob2QuXG4gICAgICAgIGxldCBlID0gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcbiAgICAgICAgLy8gVE9ETyhiLzIxNzE4OTIxNik6IFRoaXMgbGltYm8gZG9jdW1lbnQgc2hvdWxkIGlkZWFsbHkgaGF2ZSBhIHJlYWQgdGltZSxcbiAgICAgICAgLy8gc28gdGhhdCBpdCBpcyBwaWNrZWQgdXAgYnkgYW55IHJlYWQtdGltZSBiYXNlZCBzY2Fucy4gVGhlIGJhY2tlbmQsXG4gICAgICAgIC8vIGhvd2V2ZXIsIGRvZXMgbm90IHNlbmQgYSByZWFkIHRpbWUgZm9yIHRhcmdldCByZW1vdmFscy5cbiAgICAgICAgICAgICAgICBlID0gZS5pbnNlcnQocywgTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQocywgU25hcHNob3RWZXJzaW9uLm1pbigpKSk7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKS5hZGQocyksIGkgPSBuZXcgUmVtb3RlRXZlbnQoU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyogdGFyZ2V0Q2hhbmdlcz0gKi8gbmV3IE1hcCwgXG4gICAgICAgIC8qIHRhcmdldE1pc21hdGNoZXM9ICovIG5ldyBTb3J0ZWRNYXAoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCBlLCBuKTtcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVJlbW90ZUV2ZW50KHIsIGkpLCBcbiAgICAgICAgLy8gU2luY2UgdGhpcyBxdWVyeSBmYWlsZWQsIHdlIHdvbid0IHdhbnQgdG8gbWFudWFsbHkgdW5saXN0ZW4gdG8gaXQuXG4gICAgICAgIC8vIFdlIG9ubHkgcmVtb3ZlIGl0IGZyb20gYm9va2tlZXBpbmcgYWZ0ZXIgd2Ugc3VjY2Vzc2Z1bGx5IGFwcGxpZWQgdGhlXG4gICAgICAgIC8vIFJlbW90ZUV2ZW50LiBJZiBgYXBwbHlSZW1vdGVFdmVudCgpYCB0aHJvd3MsIHdlIHdhbnQgdG8gcmUtbGlzdGVuIHRvXG4gICAgICAgIC8vIHRoaXMgcXVlcnkgd2hlbiB0aGUgUmVtb3RlU3RvcmUgcmVzdGFydHMgdGhlIFdhdGNoIHN0cmVhbSwgd2hpY2ggc2hvdWxkXG4gICAgICAgIC8vIHJlLXRyaWdnZXIgdGhlIHRhcmdldCBmYWlsdXJlLlxuICAgICAgICByLk9hID0gci5PYS5yZW1vdmUocyksIHIuTmEuZGVsZXRlKHQpLCBfX1BSSVZBVEVfcHVtcEVucXVldWVkTGltYm9SZXNvbHV0aW9ucyhyKTtcbiAgICB9IGVsc2UgYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KHIubG9jYWxTdG9yZSwgdCwgXG4gICAgLyoga2VlcFBlcnNpc3RlZFRhcmdldERhdGEgKi8gITEpLnRoZW4oKCgpID0+IF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KHIsIHQsIG4pKSkuY2F0Y2goX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlTdWNjZXNzZnVsV3JpdGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gdC5iYXRjaC5iYXRjaElkO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFja25vd2xlZGdlQmF0Y2gobi5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgLy8gVGhlIGxvY2FsIHN0b3JlIG1heSBvciBtYXkgbm90IGJlIGFibGUgdG8gYXBwbHkgdGhlIHdyaXRlIHJlc3VsdCBhbmRcbiAgICAgICAgLy8gcmFpc2UgZXZlbnRzIGltbWVkaWF0ZWx5IChkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgd2F0Y2hlciBpcyBjYXVnaHRcbiAgICAgICAgLy8gdXApLCBzbyB3ZSByYWlzZSB1c2VyIGNhbGxiYWNrcyBmaXJzdCBzbyB0aGF0IHRoZXkgY29uc2lzdGVudGx5IGhhcHBlblxuICAgICAgICAvLyBiZWZvcmUgbGlzdGVuIGV2ZW50cy5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfcHJvY2Vzc1VzZXJDYWxsYmFjayhuLCByLCAvKmVycm9yPSovIG51bGwpLCBfX1BSSVZBVEVfdHJpZ2dlclBlbmRpbmdXcml0ZXNDYWxsYmFja3MobiwgciksIFxuICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZU11dGF0aW9uU3RhdGUociwgXCJhY2tub3dsZWRnZWRcIiksIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShuLCBlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9pZ25vcmVJZlByaW1hcnlMZWFzZUxvc3MoZSk7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZVJlamVjdEZhaWxlZFdyaXRlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVSZWplY3RCYXRjaChlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiUmVqZWN0IGJhdGNoXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIGxldCByO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLm11dGF0aW9uUXVldWUubG9va3VwTXV0YXRpb25CYXRjaChlLCB0KS5uZXh0KCh0ID0+IChfX1BSSVZBVEVfaGFyZEFzc2VydChudWxsICE9PSB0KSwgXG4gICAgICAgICAgICAgICAgciA9IHQua2V5cygpLCBuLm11dGF0aW9uUXVldWUucmVtb3ZlTXV0YXRpb25CYXRjaChlLCB0KSkpKS5uZXh0KCgoKSA9PiBuLm11dGF0aW9uUXVldWUucGVyZm9ybUNvbnNpc3RlbmN5Q2hlY2soZSkpKS5uZXh0KCgoKSA9PiBuLmRvY3VtZW50T3ZlcmxheUNhY2hlLnJlbW92ZU92ZXJsYXlzRm9yQmF0Y2hJZChlLCByLCB0KSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXNGb3JEb2N1bWVudEtleXMoZSwgcikpKS5uZXh0KCgoKSA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldERvY3VtZW50cyhlLCByKSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmV0dXJucyB0aGUgbGFyZ2VzdCAobGF0ZXN0KSBiYXRjaCBpZCBpbiBtdXRhdGlvbiBxdWV1ZSB0aGF0IGlzIHBlbmRpbmdcbiAqIHNlcnZlciByZXNwb25zZS5cbiAqXG4gKiBSZXR1cm5zIGBCQVRDSElEX1VOS05PV05gIGlmIHRoZSBxdWV1ZSBpcyBlbXB0eS5cbiAqLyAoci5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgLy8gVGhlIGxvY2FsIHN0b3JlIG1heSBvciBtYXkgbm90IGJlIGFibGUgdG8gYXBwbHkgdGhlIHdyaXRlIHJlc3VsdCBhbmRcbiAgICAgICAgLy8gcmFpc2UgZXZlbnRzIGltbWVkaWF0ZWx5IChkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgd2F0Y2hlciBpcyBjYXVnaHQgdXApLFxuICAgICAgICAvLyBzbyB3ZSByYWlzZSB1c2VyIGNhbGxiYWNrcyBmaXJzdCBzbyB0aGF0IHRoZXkgY29uc2lzdGVudGx5IGhhcHBlbiBiZWZvcmVcbiAgICAgICAgLy8gbGlzdGVuIGV2ZW50cy5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfcHJvY2Vzc1VzZXJDYWxsYmFjayhyLCB0LCBuKSwgX19QUklWQVRFX3RyaWdnZXJQZW5kaW5nV3JpdGVzQ2FsbGJhY2tzKHIsIHQpLCBcbiAgICAgICAgci5zaGFyZWRDbGllbnRTdGF0ZS51cGRhdGVNdXRhdGlvblN0YXRlKHQsIFwicmVqZWN0ZWRcIiwgbiksIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShyLCBlKTtcbiAgICB9IGNhdGNoIChuKSB7XG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9pZ25vcmVJZlByaW1hcnlMZWFzZUxvc3Mobik7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIHVzZXIgY2FsbGJhY2sgdGhhdCByZXNvbHZlcyB3aGVuIGFsbCBwZW5kaW5nIG11dGF0aW9ucyBhdCB0aGUgbW9tZW50IG9mIGNhbGxpbmdcbiAqIGFyZSBhY2tub3dsZWRnZWQgLlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lUmVnaXN0ZXJQZW5kaW5nV3JpdGVzQ2FsbGJhY2soZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKG4ucmVtb3RlU3RvcmUpIHx8IF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJUaGUgbmV0d29yayBpcyBkaXNhYmxlZC4gVGhlIHRhc2sgcmV0dXJuZWQgYnkgJ2F3YWl0UGVuZGluZ1dyaXRlcygpJyB3aWxsIG5vdCBjb21wbGV0ZSB1bnRpbCB0aGUgbmV0d29yayBpcyBlbmFibGVkLlwiKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgcmV0dXJuIHQucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJHZXQgaGlnaGVzdCB1bmFja25vd2xlZGdlZCBiYXRjaCBpZFwiLCBcInJlYWRvbmx5XCIsIChlID0+IHQubXV0YXRpb25RdWV1ZS5nZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKGUpKSk7XG4gICAgICAgIH0obi5sb2NhbFN0b3JlKTtcbiAgICAgICAgaWYgKC0xID09PSBlKSBcbiAgICAgICAgLy8gVHJpZ2dlciB0aGUgY2FsbGJhY2sgcmlnaHQgYXdheSBpZiB0aGVyZSBpcyBubyBwZW5kaW5nIHdyaXRlcyBhdCB0aGUgbW9tZW50LlxuICAgICAgICByZXR1cm4gdm9pZCB0LnJlc29sdmUoKTtcbiAgICAgICAgY29uc3QgciA9IG4ua2EuZ2V0KGUpIHx8IFtdO1xuICAgICAgICByLnB1c2godCksIG4ua2Euc2V0KGUsIHIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV93cmFwSW5Vc2VyRXJyb3JJZlJlY292ZXJhYmxlKGUsIFwiSW5pdGlhbGl6YXRpb24gb2Ygd2FpdEZvclBlbmRpbmdXcml0ZXMoKSBvcGVyYXRpb24gZmFpbGVkXCIpO1xuICAgICAgICB0LnJlamVjdChuKTtcbiAgICB9XG59XG5cbi8qKlxuICogVHJpZ2dlcnMgdGhlIGNhbGxiYWNrcyB0aGF0IGFyZSB3YWl0aW5nIGZvciB0aGlzIGJhdGNoIGlkIHRvIGdldCBhY2tub3dsZWRnZWQgYnkgc2VydmVyLFxuICogaWYgdGhlcmUgYXJlIGFueS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdHJpZ2dlclBlbmRpbmdXcml0ZXNDYWxsYmFja3MoZSwgdCkge1xuICAgIChlLmthLmdldCh0KSB8fCBbXSkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgIGUucmVzb2x2ZSgpO1xuICAgIH0pKSwgZS5rYS5kZWxldGUodCk7XG59XG5cbi8qKiBSZWplY3QgYWxsIG91dHN0YW5kaW5nIGNhbGxiYWNrcyB3YWl0aW5nIGZvciBwZW5kaW5nIHdyaXRlcyB0byBjb21wbGV0ZS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3Byb2Nlc3NVc2VyQ2FsbGJhY2soZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCBpID0gci5CYVtyLmN1cnJlbnRVc2VyLnRvS2V5KCldO1xuICAgIC8vIE5PVEU6IE11dGF0aW9ucyByZXN0b3JlZCBmcm9tIHBlcnNpc3RlbmNlIHdvbid0IGhhdmUgY2FsbGJhY2tzLCBzbyBpdCdzXG4gICAgLy8gb2theSBmb3IgdGhlcmUgdG8gYmUgbm8gY2FsbGJhY2sgZm9yIHRoaXMgSUQuXG4gICAgICAgIGlmIChpKSB7XG4gICAgICAgIGNvbnN0IGUgPSBpLmdldCh0KTtcbiAgICAgICAgZSAmJiAobiA/IGUucmVqZWN0KG4pIDogZS5yZXNvbHZlKCksIGkgPSBpLnJlbW92ZSh0KSksIHIuQmFbci5jdXJyZW50VXNlci50b0tleSgpXSA9IGk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3ZlQW5kQ2xlYW51cFRhcmdldChlLCB0LCBuID0gbnVsbCkge1xuICAgIGUuc2hhcmVkQ2xpZW50U3RhdGUucmVtb3ZlTG9jYWxRdWVyeVRhcmdldCh0KTtcbiAgICBmb3IgKGNvbnN0IHIgb2YgZS5NYS5nZXQodCkpIGUuRmEuZGVsZXRlKHIpLCBuICYmIGUuQ2EuJGEociwgbik7XG4gICAgaWYgKGUuTWEuZGVsZXRlKHQpLCBlLmlzUHJpbWFyeUNsaWVudCkge1xuICAgICAgICBlLkxhLmdyKHQpLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgZS5MYS5jb250YWluc0tleSh0KSB8fCBcbiAgICAgICAgICAgIC8vIFdlIHJlbW92ZWQgdGhlIGxhc3QgcmVmZXJlbmNlIGZvciB0aGlzIGtleVxuICAgICAgICAgICAgX19QUklWQVRFX3JlbW92ZUxpbWJvVGFyZ2V0KGUsIHQpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3ZlTGltYm9UYXJnZXQoZSwgdCkge1xuICAgIGUueGEuZGVsZXRlKHQucGF0aC5jYW5vbmljYWxTdHJpbmcoKSk7XG4gICAgLy8gSXQncyBwb3NzaWJsZSB0aGF0IHRoZSB0YXJnZXQgYWxyZWFkeSBnb3QgcmVtb3ZlZCBiZWNhdXNlIHRoZSBxdWVyeSBmYWlsZWQuIEluIHRoYXQgY2FzZSxcbiAgICAvLyB0aGUga2V5IHdvbid0IGV4aXN0IGluIGBsaW1ib1RhcmdldHNCeUtleWAuIE9ubHkgZG8gdGhlIGNsZWFudXAgaWYgd2Ugc3RpbGwgaGF2ZSB0aGUgdGFyZ2V0LlxuICAgIGNvbnN0IG4gPSBlLk9hLmdldCh0KTtcbiAgICBudWxsICE9PSBuICYmIChfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3RlbihlLnJlbW90ZVN0b3JlLCBuKSwgZS5PYSA9IGUuT2EucmVtb3ZlKHQpLCBcbiAgICBlLk5hLmRlbGV0ZShuKSwgX19QUklWQVRFX3B1bXBFbnF1ZXVlZExpbWJvUmVzb2x1dGlvbnMoZSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdXBkYXRlVHJhY2tlZExpbWJvcyhlLCB0LCBuKSB7XG4gICAgZm9yIChjb25zdCByIG9mIG4pIGlmIChyIGluc3RhbmNlb2YgX19QUklWQVRFX0FkZGVkTGltYm9Eb2N1bWVudCkgZS5MYS5hZGRSZWZlcmVuY2Uoci5rZXksIHQpLCBcbiAgICBfX1BSSVZBVEVfdHJhY2tMaW1ib0NoYW5nZShlLCByKTsgZWxzZSBpZiAociBpbnN0YW5jZW9mIF9fUFJJVkFURV9SZW1vdmVkTGltYm9Eb2N1bWVudCkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJTeW5jRW5naW5lXCIsIFwiRG9jdW1lbnQgbm8gbG9uZ2VyIGluIGxpbWJvOiBcIiArIHIua2V5KSwgZS5MYS5yZW1vdmVSZWZlcmVuY2Uoci5rZXksIHQpO1xuICAgICAgICBlLkxhLmNvbnRhaW5zS2V5KHIua2V5KSB8fCBcbiAgICAgICAgLy8gV2UgcmVtb3ZlZCB0aGUgbGFzdCByZWZlcmVuY2UgZm9yIHRoaXMga2V5XG4gICAgICAgIF9fUFJJVkFURV9yZW1vdmVMaW1ib1RhcmdldChlLCByLmtleSk7XG4gICAgfSBlbHNlIGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RyYWNrTGltYm9DaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LmtleSwgciA9IG4ucGF0aC5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICBlLk9hLmdldChuKSB8fCBlLnhhLmhhcyhyKSB8fCAoX19QUklWQVRFX2xvZ0RlYnVnKFwiU3luY0VuZ2luZVwiLCBcIk5ldyBkb2N1bWVudCBpbiBsaW1ibzogXCIgKyBuKSwgXG4gICAgZS54YS5hZGQociksIF9fUFJJVkFURV9wdW1wRW5xdWV1ZWRMaW1ib1Jlc29sdXRpb25zKGUpKTtcbn1cblxuLyoqXG4gKiBTdGFydHMgbGlzdGVucyBmb3IgZG9jdW1lbnRzIGluIGxpbWJvIHRoYXQgYXJlIGVucXVldWVkIGZvciByZXNvbHV0aW9uLFxuICogc3ViamVjdCB0byBhIG1heGltdW0gbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMuXG4gKlxuICogV2l0aG91dCBib3VuZGluZyB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMsIHRoZSBzZXJ2ZXIgY2FuIGZhaWxcbiAqIHdpdGggXCJyZXNvdXJjZSBleGhhdXN0ZWRcIiBlcnJvcnMgd2hpY2ggY2FuIGxlYWQgdG8gcGF0aG9sb2dpY2FsIGNsaWVudFxuICogYmVoYXZpb3IgYXMgc2VlbiBpbiBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy8yNjgzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wdW1wRW5xdWV1ZWRMaW1ib1Jlc29sdXRpb25zKGUpIHtcbiAgICBmb3IgKDtlLnhhLnNpemUgPiAwICYmIGUuT2Euc2l6ZSA8IGUubWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnM7ICkge1xuICAgICAgICBjb25zdCB0ID0gZS54YS52YWx1ZXMoKS5uZXh0KCkudmFsdWU7XG4gICAgICAgIGUueGEuZGVsZXRlKHQpO1xuICAgICAgICBjb25zdCBuID0gbmV3IERvY3VtZW50S2V5KFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKHQpKSwgciA9IGUucWEubmV4dCgpO1xuICAgICAgICBlLk5hLnNldChyLCBuZXcgTGltYm9SZXNvbHV0aW9uKG4pKSwgZS5PYSA9IGUuT2EuaW5zZXJ0KG4sIHIpLCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVMaXN0ZW4oZS5yZW1vdGVTdG9yZSwgbmV3IFRhcmdldERhdGEoX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoX19QUklWQVRFX25ld1F1ZXJ5Rm9yUGF0aChuLnBhdGgpKSwgciwgXCJUYXJnZXRQdXJwb3NlTGltYm9SZXNvbHV0aW9uXCIgLyogVGFyZ2V0UHVycG9zZS5MaW1ib1Jlc29sdXRpb24gKi8gLCBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2Uub2UpKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSBbXSwgcyA9IFtdLCBvID0gW107XG4gICAgci5GYS5pc0VtcHR5KCkgfHwgKHIuRmEuZm9yRWFjaCgoKGUsIF8pID0+IHtcbiAgICAgICAgby5wdXNoKHIuS2EoXywgdCwgbikudGhlbigoZSA9PiB7XG4gICAgICAgICAgICB2YXIgdDtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBjaGFuZ2VzLCBvciB3ZSBhcmUgaGFuZGxpbmcgYSBnbG9iYWwgc25hcHNob3QsIG5vdGlmeVxuICAgICAgICAgICAgLy8gc2Vjb25kYXJ5IGNsaWVudHMgdG8gdXBkYXRlIHF1ZXJ5IHN0YXRlLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChlIHx8IG4pICYmIHIuaXNQcmltYXJ5Q2xpZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gUXVlcnkgc3RhdGUgaXMgc2V0IHRvIGBjdXJyZW50YCBpZjpcbiAgICAgICAgICAgICAgICAvLyAtIFRoZXJlIGlzIGEgdmlldyBjaGFuZ2UgYW5kIGl0IGlzIHVwLXRvLWRhdGUsIG9yLFxuICAgICAgICAgICAgICAgIC8vIC0gVGhlcmUgaXMgYSBnbG9iYWwgc25hcHNob3QsIHRoZSBUYXJnZXQgaXMgY3VycmVudCwgYW5kIG5vIGNoYW5nZXMgdG8gYmUgcmVzb2x2ZWRcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gZSA/ICFlLmZyb21DYWNoZSA6IG51bGwgPT09ICh0ID0gbnVsbCA9PSBuID8gdm9pZCAwIDogbi50YXJnZXRDaGFuZ2VzLmdldChfLnRhcmdldElkKSkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC5jdXJyZW50O1xuICAgICAgICAgICAgICAgIHIuc2hhcmVkQ2xpZW50U3RhdGUudXBkYXRlUXVlcnlTdGF0ZShfLnRhcmdldElkLCBpID8gXCJjdXJyZW50XCIgOiBcIm5vdC1jdXJyZW50XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVXBkYXRlIHZpZXdzIGlmIHRoZXJlIGFyZSBhY3R1YWwgY2hhbmdlcy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgaS5wdXNoKGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfTG9jYWxWaWV3Q2hhbmdlcy5XaShfLnRhcmdldElkLCBlKTtcbiAgICAgICAgICAgICAgICBzLnB1c2godCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSk7XG4gICAgfSkpLCBhd2FpdCBQcm9taXNlLmFsbChvKSwgci5DYS5kXyhpKSwgYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVOb3RpZnlMb2NhbFZpZXdDaGFuZ2VzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwibm90aWZ5TG9jYWxWaWV3Q2hhbmdlc1wiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LiRpLCAociA9PiBuLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLmFkZFJlZmVyZW5jZShlLCB0LnRhcmdldElkLCByKSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQuVWksIChyID0+IG4ucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUucmVtb3ZlUmVmZXJlbmNlKGUsIHQudGFyZ2V0SWQsIHIpKSkpKSkpKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGlmICghX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgdGhyb3cgZTtcbiAgICAgICAgICAgIC8vIElmIGBub3RpZnlMb2NhbFZpZXdDaGFuZ2VzYCBmYWlscywgd2UgZGlkIG5vdCBhZHZhbmNlIHRoZSBzZXF1ZW5jZVxuICAgICAgICAgICAgLy8gbnVtYmVyIGZvciB0aGUgZG9jdW1lbnRzIHRoYXQgd2VyZSBpbmNsdWRlZCBpbiB0aGlzIHRyYW5zYWN0aW9uLlxuICAgICAgICAgICAgLy8gVGhpcyBtaWdodCB0cmlnZ2VyIHRoZW0gdG8gYmUgZGVsZXRlZCBlYXJsaWVyIHRoYW4gdGhleSBvdGhlcndpc2VcbiAgICAgICAgICAgIC8vIHdvdWxkIGhhdmUsIGJ1dCBpdCBzaG91bGQgbm90IGludmFsaWRhdGUgdGhlIGludGVncml0eSBvZiB0aGUgZGF0YS5cbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxvY2FsU3RvcmVcIiwgXCJGYWlsZWQgdG8gdXBkYXRlIHNlcXVlbmNlIG51bWJlcnM6IFwiICsgZSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLnRhcmdldElkO1xuICAgICAgICAgICAgaWYgKCFlLmZyb21DYWNoZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBuLm9zLmdldCh0KSwgciA9IGUuc25hcHNob3RWZXJzaW9uLCBpID0gZS53aXRoTGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbihyKTtcbiAgICAgICAgICAgICAgICAvLyBBZHZhbmNlIHRoZSBsYXN0IGxpbWJvIGZyZWUgc25hcHNob3QgdmVyc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLm9zID0gbi5vcy5pbnNlcnQodCwgaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KHIubG9jYWxTdG9yZSwgcykpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGlmICghbi5jdXJyZW50VXNlci5pc0VxdWFsKHQpKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJVc2VyIGNoYW5nZS4gTmV3IHVzZXI6XCIsIHQudG9LZXkoKSk7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUhhbmRsZVVzZXJDaGFuZ2Uobi5sb2NhbFN0b3JlLCB0KTtcbiAgICAgICAgbi5jdXJyZW50VXNlciA9IHQsIFxuICAgICAgICAvLyBGYWlscyB0YXNrcyB3YWl0aW5nIGZvciBwZW5kaW5nIHdyaXRlcyByZXF1ZXN0ZWQgYnkgcHJldmlvdXMgdXNlci5cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX3JlamVjdE91dHN0YW5kaW5nUGVuZGluZ1dyaXRlc0NhbGxiYWNrcyhlLCB0KSB7XG4gICAgICAgICAgICBlLmthLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcihELkNBTkNFTExFRCwgdCkpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pKSwgZS5rYS5jbGVhcigpO1xuICAgICAgICB9KG4sIFwiJ3dhaXRGb3JQZW5kaW5nV3JpdGVzJyBwcm9taXNlIGlzIHJlamVjdGVkIGR1ZSB0byBhIHVzZXIgY2hhbmdlLlwiKSwgXG4gICAgICAgIC8vIFRPRE8oYi8xMTQyMjY0MTcpOiBDb25zaWRlciBjYWxsaW5nIHRoaXMgb25seSBpbiB0aGUgcHJpbWFyeSB0YWIuXG4gICAgICAgIG4uc2hhcmVkQ2xpZW50U3RhdGUuaGFuZGxlVXNlckNoYW5nZSh0LCBlLnJlbW92ZWRCYXRjaElkcywgZS5hZGRlZEJhdGNoSWRzKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKG4sIGUuaHMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVHZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IG4uTmEuZ2V0KHQpO1xuICAgIGlmIChyICYmIHIudmEpIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKS5hZGQoci5rZXkpO1xuICAgIHtcbiAgICAgICAgbGV0IGUgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgY29uc3QgciA9IG4uTWEuZ2V0KHQpO1xuICAgICAgICBpZiAoIXIpIHJldHVybiBlO1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2Ygcikge1xuICAgICAgICAgICAgY29uc3QgciA9IG4uRmEuZ2V0KHQpO1xuICAgICAgICAgICAgZSA9IGUudW5pb25XaXRoKHIudmlldy5WYSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlY29uY2lsZSB0aGUgbGlzdCBvZiBzeW5jZWQgZG9jdW1lbnRzIGluIGFuIGV4aXN0aW5nIHZpZXcgd2l0aCB0aG9zZVxuICogZnJvbSBwZXJzaXN0ZW5jZS5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY2hyb25pemVWaWV3QW5kQ29tcHV0ZVNuYXBzaG90KGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlRXhlY3V0ZVF1ZXJ5KG4ubG9jYWxTdG9yZSwgdC5xdWVyeSwgXG4gICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMCksIGkgPSB0LnZpZXcuYmEocik7XG4gICAgcmV0dXJuIG4uaXNQcmltYXJ5Q2xpZW50ICYmIF9fUFJJVkFURV91cGRhdGVUcmFja2VkTGltYm9zKG4sIHQudGFyZ2V0SWQsIGkud2EpLCBcbiAgICBpO1xufVxuXG4vKipcbiAqIFJldHJpZXZlcyBuZXdseSBjaGFuZ2VkIGRvY3VtZW50cyBmcm9tIHJlbW90ZSBkb2N1bWVudCBjYWNoZSBhbmQgcmFpc2VzXG4gKiBzbmFwc2hvdHMgaWYgbmVlZGVkLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVTeW5jaHJvbml6ZVdpdGhDaGFuZ2VkRG9jdW1lbnRzKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXdEb2N1bWVudENoYW5nZXMobi5sb2NhbFN0b3JlLCB0KS50aGVuKChlID0+IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShuLCBlKSkpO1xufVxuXG4vKiogQXBwbGllcyBhIG11dGF0aW9uIHN0YXRlIHRvIGFuIGV4aXN0aW5nIGJhdGNoLiAgKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5QmF0Y2hTdGF0ZShlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHMgPSBhd2FpdCBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUxvb2t1cE11dGF0aW9uRG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KG4ubXV0YXRpb25RdWV1ZSk7XG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiTG9va3VwIG11dGF0aW9uIGRvY3VtZW50c1wiLCBcInJlYWRvbmx5XCIsIChlID0+IHIuTW4oZSwgdCkubmV4dCgodCA9PiB0ID8gbi5sb2NhbERvY3VtZW50cy5nZXREb2N1bWVudHMoZSwgdCkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShudWxsKSkpKSk7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgKGkubG9jYWxTdG9yZSwgdCk7XG4gICAgbnVsbCAhPT0gcyA/IChcInBlbmRpbmdcIiA9PT0gbiA/IFxuICAgIC8vIElmIHdlIGFyZSB0aGUgcHJpbWFyeSBjbGllbnQsIHdlIG5lZWQgdG8gc2VuZCB0aGlzIHdyaXRlIHRvIHRoZVxuICAgIC8vIGJhY2tlbmQuIFNlY29uZGFyeSBjbGllbnRzIHdpbGwgaWdub3JlIHRoZXNlIHdyaXRlcyBzaW5jZSB0aGVpciByZW1vdGVcbiAgICAvLyBjb25uZWN0aW9uIGlzIGRpc2FibGVkLlxuICAgIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShpLnJlbW90ZVN0b3JlKSA6IFwiYWNrbm93bGVkZ2VkXCIgPT09IG4gfHwgXCJyZWplY3RlZFwiID09PSBuID8gKFxuICAgIC8vIE5PVEU6IEJvdGggdGhlc2UgbWV0aG9kcyBhcmUgbm8tb3BzIGZvciBiYXRjaGVzIHRoYXQgb3JpZ2luYXRlZCBmcm9tXG4gICAgLy8gb3RoZXIgY2xpZW50cy5cbiAgICBfX1BSSVZBVEVfcHJvY2Vzc1VzZXJDYWxsYmFjayhpLCB0LCByIHx8IG51bGwpLCBfX1BSSVZBVEVfdHJpZ2dlclBlbmRpbmdXcml0ZXNDYWxsYmFja3MoaSwgdCksIFxuICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlUmVtb3ZlQ2FjaGVkTXV0YXRpb25CYXRjaE1ldGFkYXRhKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2RlYnVnQ2FzdChfX1BSSVZBVEVfZGVidWdDYXN0KGUpLm11dGF0aW9uUXVldWUpLk9uKHQpO1xuICAgIH1cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuICAgIChpLmxvY2FsU3RvcmUsIHQpKSA6IGZhaWwoKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKGksIHMpKSA6IFxuICAgIC8vIEEgdGhyb3R0bGVkIHRhYiBtYXkgbm90IGhhdmUgc2VlbiB0aGUgbXV0YXRpb24gYmVmb3JlIGl0IHdhcyBjb21wbGV0ZWRcbiAgICAvLyBhbmQgcmVtb3ZlZCBmcm9tIHRoZSBtdXRhdGlvbiBxdWV1ZSwgaW4gd2hpY2ggY2FzZSB3ZSB3b24ndCBoYXZlIGNhY2hlZFxuICAgIC8vIHRoZSBhZmZlY3RlZCBkb2N1bWVudHMuIEluIHRoaXMgY2FzZSB3ZSBjYW4gc2FmZWx5IGlnbm9yZSB0aGUgdXBkYXRlXG4gICAgLy8gc2luY2UgdGhhdCBtZWFucyB3ZSBkaWRuJ3QgYXBwbHkgdGhlIG11dGF0aW9uIGxvY2FsbHkgYXQgYWxsIChpZiB3ZVxuICAgIC8vIGhhZCwgd2Ugd291bGQgaGF2ZSBjYWNoZWQgdGhlIGFmZmVjdGVkIGRvY3VtZW50cyksIGFuZCBzbyB3ZSB3aWxsIGp1c3RcbiAgICAvLyBzZWUgYW55IHJlc3VsdGluZyBkb2N1bWVudCBjaGFuZ2VzIHZpYSBub3JtYWwgcmVtb3RlIGRvY3VtZW50IHVwZGF0ZXNcbiAgICAvLyBhcyBhcHBsaWNhYmxlLlxuICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJDYW5ub3QgYXBwbHkgbXV0YXRpb24gYmF0Y2ggd2l0aCBpZDogXCIgKyB0KTtcbn1cblxuLyoqIEFwcGxpZXMgYSBxdWVyeSB0YXJnZXQgY2hhbmdlIGZyb20gYSBkaWZmZXJlbnQgdGFiLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlQcmltYXJ5U3RhdGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGlmIChfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MobiksIF9fUFJJVkFURV9zeW5jRW5naW5lRW5zdXJlV3JpdGVDYWxsYmFja3MobiksIFxuICAgICEwID09PSB0ICYmICEwICE9PSBuLlFhKSB7XG4gICAgICAgIC8vIFNlY29uZGFyeSB0YWJzIG9ubHkgbWFpbnRhaW4gVmlld3MgZm9yIHRoZWlyIGxvY2FsIGxpc3RlbmVycyBhbmQgdGhlXG4gICAgICAgIC8vIFZpZXdzIGludGVybmFsIHN0YXRlIG1heSBub3QgYmUgMTAwJSBwb3B1bGF0ZWQgKGluIHBhcnRpY3VsYXJcbiAgICAgICAgLy8gc2Vjb25kYXJ5IHRhYnMgZG9uJ3QgdHJhY2sgc3luY2VkRG9jdW1lbnRzLCB0aGUgc2V0IG9mIGRvY3VtZW50cyB0aGVcbiAgICAgICAgLy8gc2VydmVyIGNvbnNpZGVycyB0byBiZSBpbiB0aGUgdGFyZ2V0KS4gU28gd2hlbiBhIHNlY29uZGFyeSBiZWNvbWVzXG4gICAgICAgIC8vIHByaW1hcnksIHdlIG5lZWQgdG8gbmVlZCB0byBtYWtlIHN1cmUgdGhhdCBhbGwgdmlld3MgZm9yIGFsbCB0YXJnZXRzXG4gICAgICAgIC8vIG1hdGNoIHRoZSBzdGF0ZSBvbiBkaXNrLlxuICAgICAgICBjb25zdCBlID0gbi5zaGFyZWRDbGllbnRTdGF0ZS5nZXRBbGxBY3RpdmVRdWVyeVRhcmdldHMoKSwgdCA9IGF3YWl0IF9fUFJJVkFURV9zeW5jaHJvbml6ZVF1ZXJ5Vmlld3NBbmRSYWlzZVNuYXBzaG90cyhuLCBlLnRvQXJyYXkoKSk7XG4gICAgICAgIG4uUWEgPSAhMCwgYXdhaXQgX19QUklWQVRFX3JlbW90ZVN0b3JlQXBwbHlQcmltYXJ5U3RhdGUobi5yZW1vdGVTdG9yZSwgITApO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdCkgX19QUklWQVRFX3JlbW90ZVN0b3JlTGlzdGVuKG4ucmVtb3RlU3RvcmUsIGUpO1xuICAgIH0gZWxzZSBpZiAoITEgPT09IHQgJiYgITEgIT09IG4uUWEpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICBsZXQgdCA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICBuLk1hLmZvckVhY2goKChyLCBpKSA9PiB7XG4gICAgICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLmlzTG9jYWxRdWVyeVRhcmdldChpKSA/IGUucHVzaChpKSA6IHQgPSB0LnRoZW4oKCgpID0+IChfX1BSSVZBVEVfcmVtb3ZlQW5kQ2xlYW51cFRhcmdldChuLCBpKSwgXG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQobi5sb2NhbFN0b3JlLCBpLCBcbiAgICAgICAgICAgIC8qa2VlcFBlcnNpc3RlZFRhcmdldERhdGE9Ki8gITApKSkpLCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3RlbihuLnJlbW90ZVN0b3JlLCBpKTtcbiAgICAgICAgfSkpLCBhd2FpdCB0LCBhd2FpdCBfX1BSSVZBVEVfc3luY2hyb25pemVRdWVyeVZpZXdzQW5kUmFpc2VTbmFwc2hvdHMobiwgZSksIFxuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfcmVzZXRMaW1ib0RvY3VtZW50cyhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgIHQuTmEuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfcmVtb3RlU3RvcmVVbmxpc3Rlbih0LnJlbW90ZVN0b3JlLCBuKTtcbiAgICAgICAgICAgIH0pKSwgdC5MYS5wcigpLCB0Lk5hID0gbmV3IE1hcCwgdC5PYSA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZWNvbmNpbGUgdGhlIHF1ZXJ5IHZpZXdzIG9mIHRoZSBwcm92aWRlZCBxdWVyeSB0YXJnZXRzIHdpdGggdGhlIHN0YXRlIGZyb21cbiAqIHBlcnNpc3RlbmNlLiBSYWlzZXMgc25hcHNob3RzIGZvciBhbnkgY2hhbmdlcyB0aGF0IGFmZmVjdCB0aGUgbG9jYWxcbiAqIGNsaWVudCBhbmQgcmV0dXJucyB0aGUgdXBkYXRlZCBzdGF0ZSBvZiBhbGwgdGFyZ2V0J3MgcXVlcnkgZGF0YS5cbiAqXG4gKiBAcGFyYW0gc3luY0VuZ2luZSAtIFRoZSBzeW5jIGVuZ2luZSBpbXBsZW1lbnRhdGlvblxuICogQHBhcmFtIHRhcmdldHMgLSB0aGUgbGlzdCBvZiB0YXJnZXRzIHdpdGggdmlld3MgdGhhdCBuZWVkIHRvIGJlIHJlY29tcHV0ZWRcbiAqIEBwYXJhbSB0cmFuc2l0aW9uVG9QcmltYXJ5IC0gYHRydWVgIGlmZiB0aGUgdGFiIHRyYW5zaXRpb25zIGZyb20gYSBzZWNvbmRhcnlcbiAqIHRhYiB0byBhIHByaW1hcnkgdGFiXG4gKi9cbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbiAgICAgICAgKG4pLCBuLlFhID0gITEsIGF3YWl0IF9fUFJJVkFURV9yZW1vdGVTdG9yZUFwcGx5UHJpbWFyeVN0YXRlKG4ucmVtb3RlU3RvcmUsICExKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jaHJvbml6ZVF1ZXJ5Vmlld3NBbmRSYWlzZVNuYXBzaG90cyhlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSBbXSwgcyA9IFtdO1xuICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgIGxldCB0O1xuICAgICAgICBjb25zdCBuID0gci5NYS5nZXQoZSk7XG4gICAgICAgIGlmIChuICYmIDAgIT09IG4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBGb3IgcXVlcmllcyB0aGF0IGhhdmUgYSBsb2NhbCBWaWV3LCB3ZSBmZXRjaCB0aGVpciBjdXJyZW50IHN0YXRlXG4gICAgICAgICAgICAvLyBmcm9tIExvY2FsU3RvcmUgKGFzIHRoZSByZXN1bWUgdG9rZW4gYW5kIHRoZSBzbmFwc2hvdCB2ZXJzaW9uXG4gICAgICAgICAgICAvLyBtaWdodCBoYXZlIGNoYW5nZWQpIGFuZCByZWNvbmNpbGUgdGhlaXIgdmlld3Mgd2l0aCB0aGUgcGVyc2lzdGVkXG4gICAgICAgICAgICAvLyBzdGF0ZSAodGhlIGxpc3Qgb2Ygc3luY2VkRG9jdW1lbnRzIG1heSBoYXZlIGdvdHRlbiBvdXQgb2Ygc3luYykuXG4gICAgICAgICAgICB0ID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChyLmxvY2FsU3RvcmUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KG5bMF0pKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBuKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHIuRmEuZ2V0KGUpLCBuID0gYXdhaXQgX19QUklWQVRFX3N5bmNocm9uaXplVmlld0FuZENvbXB1dGVTbmFwc2hvdChyLCB0KTtcbiAgICAgICAgICAgICAgICBuLnNuYXBzaG90ICYmIHMucHVzaChuLnNuYXBzaG90KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEZvciBxdWVyaWVzIHRoYXQgbmV2ZXIgZXhlY3V0ZWQgb24gdGhpcyBjbGllbnQsIHdlIG5lZWQgdG9cbiAgICAgICAgICAgIC8vIGFsbG9jYXRlIHRoZSB0YXJnZXQgaW4gTG9jYWxTdG9yZSBhbmQgaW5pdGlhbGl6ZSBhIG5ldyBWaWV3LlxuICAgICAgICAgICAgY29uc3QgbiA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0Q2FjaGVkVGFyZ2V0KHIubG9jYWxTdG9yZSwgZSk7XG4gICAgICAgICAgICB0ID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChyLmxvY2FsU3RvcmUsIG4pLCBhd2FpdCBfX1BSSVZBVEVfaW5pdGlhbGl6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QociwgX19QUklWQVRFX3N5bnRoZXNpemVUYXJnZXRUb1F1ZXJ5KG4pLCBlLCBcbiAgICAgICAgICAgIC8qY3VycmVudD0qLyAhMSwgdC5yZXN1bWVUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgaS5wdXNoKHQpO1xuICAgIH1cbiAgICByZXR1cm4gci5DYS5kXyhzKSwgaTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgYFF1ZXJ5YCBvYmplY3QgZnJvbSB0aGUgc3BlY2lmaWVkIGBUYXJnZXRgLiBUaGVyZSBpcyBubyB3YXkgdG9cbiAqIG9idGFpbiB0aGUgb3JpZ2luYWwgYFF1ZXJ5YCwgc28gd2Ugc3ludGhlc2l6ZSBhIGBRdWVyeWAgZnJvbSB0aGUgYFRhcmdldGBcbiAqIG9iamVjdC5cbiAqXG4gKiBUaGUgc3ludGhlc2l6ZWQgcmVzdWx0IG1pZ2h0IGJlIGRpZmZlcmVudCBmcm9tIHRoZSBvcmlnaW5hbCBgUXVlcnlgLCBidXRcbiAqIHNpbmNlIHRoZSBzeW50aGVzaXplZCBgUXVlcnlgIHNob3VsZCByZXR1cm4gdGhlIHNhbWUgcmVzdWx0cyBhcyB0aGVcbiAqIG9yaWdpbmFsIG9uZSAob25seSB0aGUgcHJlc2VudGF0aW9uIG9mIHJlc3VsdHMgbWlnaHQgZGlmZmVyKSwgdGhlIHBvdGVudGlhbFxuICogZGlmZmVyZW5jZSB3aWxsIG5vdCBjYXVzZSBpc3N1ZXMuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc3ludGhlc2l6ZVRhcmdldFRvUXVlcnkoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfbmV3UXVlcnkoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5vcmRlckJ5LCBlLmZpbHRlcnMsIGUubGltaXQsIFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyAsIGUuc3RhcnRBdCwgZS5lbmRBdCk7XG59XG5cbi8qKiBSZXR1cm5zIHRoZSBJRHMgb2YgdGhlIGNsaWVudHMgdGhhdCBhcmUgY3VycmVudGx5IGFjdGl2ZS4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUdldEFjdGl2ZUNsaWVudHMoZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldEFjdGl2ZUNsaWVudHMoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RlYnVnQ2FzdChfX1BSSVZBVEVfZGVidWdDYXN0KGUpLnBlcnNpc3RlbmNlKS5RaSgpO1xuICAgIH0oX19QUklWQVRFX2RlYnVnQ2FzdChlKS5sb2NhbFN0b3JlKTtcbn1cblxuLyoqIEFwcGxpZXMgYSBxdWVyeSB0YXJnZXQgY2hhbmdlIGZyb20gYSBkaWZmZXJlbnQgdGFiLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlUYXJnZXRTdGF0ZShlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgaWYgKGkuUWEpIFxuICAgIC8vIElmIHdlIHJlY2VpdmUgYSB0YXJnZXQgc3RhdGUgbm90aWZpY2F0aW9uIHZpYSBXZWJTdG9yYWdlLCB3ZSBhcmVcbiAgICAvLyBlaXRoZXIgYWxyZWFkeSBzZWNvbmRhcnkgb3IgYW5vdGhlciB0YWIgaGFzIHRha2VuIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgIHJldHVybiB2b2lkIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlN5bmNFbmdpbmVcIiwgXCJJZ25vcmluZyB1bmV4cGVjdGVkIHF1ZXJ5IHN0YXRlIG5vdGlmaWNhdGlvbi5cIik7XG4gICAgY29uc3QgcyA9IGkuTWEuZ2V0KHQpO1xuICAgIGlmIChzICYmIHMubGVuZ3RoID4gMCkgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIFwiY3VycmVudFwiOlxuICAgICAgY2FzZSBcIm5vdC1jdXJyZW50XCI6XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldE5ld0RvY3VtZW50Q2hhbmdlcyhpLmxvY2FsU3RvcmUsIF9fUFJJVkFURV9xdWVyeUNvbGxlY3Rpb25Hcm91cChzWzBdKSksIHIgPSBSZW1vdGVFdmVudC5jcmVhdGVTeW50aGVzaXplZFJlbW90ZUV2ZW50Rm9yQ3VycmVudENoYW5nZSh0LCBcImN1cnJlbnRcIiA9PT0gbiwgQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklORyk7XG4gICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUoaSwgZSwgcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlIFwicmVqZWN0ZWRcIjpcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KGkubG9jYWxTdG9yZSwgdCwgXG4gICAgICAgIC8qIGtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhICovICEwKSwgX19QUklWQVRFX3JlbW92ZUFuZENsZWFudXBUYXJnZXQoaSwgdCwgcik7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBmYWlsKCk7XG4gICAgfVxufVxuXG4vKiogQWRkcyBvciByZW1vdmVzIFdhdGNoIHRhcmdldHMgZm9yIHF1ZXJpZXMgZnJvbSBkaWZmZXJlbnQgdGFicy4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseUFjdGl2ZVRhcmdldHNDaGFuZ2UoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MoZSk7XG4gICAgaWYgKHIuUWEpIHtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgIGlmIChyLk1hLmhhcyhlKSAmJiByLnNoYXJlZENsaWVudFN0YXRlLmlzQWN0aXZlUXVlcnlUYXJnZXQoZSkpIHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJTeW5jRW5naW5lXCIsIFwiQWRkaW5nIGFuIGFscmVhZHkgYWN0aXZlIHRhcmdldCBcIiArIGUpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdCA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0Q2FjaGVkVGFyZ2V0KHIubG9jYWxTdG9yZSwgZSksIG4gPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFsbG9jYXRlVGFyZ2V0KHIubG9jYWxTdG9yZSwgdCk7XG4gICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfaW5pdGlhbGl6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QociwgX19QUklWQVRFX3N5bnRoZXNpemVUYXJnZXRUb1F1ZXJ5KHQpLCBuLnRhcmdldElkLCBcbiAgICAgICAgICAgIC8qY3VycmVudD0qLyAhMSwgbi5yZXN1bWVUb2tlbiksIF9fUFJJVkFURV9yZW1vdGVTdG9yZUxpc3RlbihyLnJlbW90ZVN0b3JlLCBuKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgbikgXG4gICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHRhcmdldCBpcyBzdGlsbCBhY3RpdmUgc2luY2UgdGhlIHRhcmdldCBtaWdodCBoYXZlIGJlZW5cbiAgICAgICAgLy8gcmVtb3ZlZCBpZiBpdCBoYXMgYmVlbiByZWplY3RlZCBieSB0aGUgYmFja2VuZC5cbiAgICAgICAgci5NYS5oYXMoZSkgJiYgXG4gICAgICAgIC8vIFJlbGVhc2UgcXVlcmllcyB0aGF0IGFyZSBzdGlsbCBhY3RpdmUuXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlUmVsZWFzZVRhcmdldChyLmxvY2FsU3RvcmUsIGUsIFxuICAgICAgICAvKiBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YSAqLyAhMSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgX19QUklWQVRFX3JlbW90ZVN0b3JlVW5saXN0ZW4oci5yZW1vdGVTdG9yZSwgZSksIF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KHIsIGUpO1xuICAgICAgICB9KSkuY2F0Y2goX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiB0LnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5hcHBseVJlbW90ZUV2ZW50ID0gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVJlbW90ZUV2ZW50LmJpbmQobnVsbCwgdCksIFxuICAgIHQucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmdldFJlbW90ZUtleXNGb3JUYXJnZXQgPSBfX1BSSVZBVEVfc3luY0VuZ2luZUdldFJlbW90ZUtleXNGb3JUYXJnZXQuYmluZChudWxsLCB0KSwgXG4gICAgdC5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIucmVqZWN0TGlzdGVuID0gX19QUklWQVRFX3N5bmNFbmdpbmVSZWplY3RMaXN0ZW4uYmluZChudWxsLCB0KSwgXG4gICAgdC5DYS5kXyA9IF9fUFJJVkFURV9ldmVudE1hbmFnZXJPbldhdGNoQ2hhbmdlLmJpbmQobnVsbCwgdC5ldmVudE1hbmFnZXIpLCB0LkNhLiRhID0gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uV2F0Y2hFcnJvci5iaW5kKG51bGwsIHQuZXZlbnRNYW5hZ2VyKSwgXG4gICAgdDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVFbnN1cmVXcml0ZUNhbGxiYWNrcyhlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIHQucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmFwcGx5U3VjY2Vzc2Z1bFdyaXRlID0gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVN1Y2Nlc3NmdWxXcml0ZS5iaW5kKG51bGwsIHQpLCBcbiAgICB0LnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5yZWplY3RGYWlsZWRXcml0ZSA9IF9fUFJJVkFURV9zeW5jRW5naW5lUmVqZWN0RmFpbGVkV3JpdGUuYmluZChudWxsLCB0KSwgXG4gICAgdDtcbn1cblxuLyoqXG4gKiBMb2FkcyBhIEZpcmVzdG9yZSBidW5kbGUgaW50byB0aGUgU0RLLiBUaGUgcmV0dXJuZWQgcHJvbWlzZSByZXNvbHZlcyB3aGVuXG4gKiB0aGUgYnVuZGxlIGZpbmlzaGVkIGxvYWRpbmcuXG4gKlxuICogQHBhcmFtIHN5bmNFbmdpbmUgLSBTeW5jRW5naW5lIHRvIHVzZS5cbiAqIEBwYXJhbSBidW5kbGVSZWFkZXIgLSBCdW5kbGUgdG8gbG9hZCBpbnRvIHRoZSBTREsuXG4gKiBAcGFyYW0gdGFzayAtIExvYWRCdW5kbGVUYXNrIHVzZWQgdG8gdXBkYXRlIHRoZSBsb2FkaW5nIHByb2dyZXNzIHRvIHB1YmxpYyBBUEkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVMb2FkQnVuZGxlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIChcbiAgICAvKiogTG9hZHMgYSBidW5kbGUgYW5kIHJldHVybnMgdGhlIGxpc3Qgb2YgYWZmZWN0ZWQgY29sbGVjdGlvbiBncm91cHMuICovXG4gICAgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvYWRCdW5kbGVJbXBsKGUsIHQsIG4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCB0LmdldE1ldGFkYXRhKCk7XG4gICAgICAgICAgICBpZiAoYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVIYXNOZXdlckJ1bmRsZShlLCB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZnJvbVZlcnNpb24odC5jcmVhdGVUaW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcImhhc05ld2VyQnVuZGxlXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gbi5Hci5nZXRCdW5kbGVNZXRhZGF0YShlLCB0LmlkKSkpLnRoZW4oKGUgPT4gISFlICYmIGUuY3JlYXRlVGltZS5jb21wYXJlVG8ocikgPj0gMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBTYXZlcyB0aGUgZ2l2ZW4gYEJ1bmRsZU1ldGFkYXRhYCB0byBsb2NhbCBwZXJzaXN0ZW5jZS5cbiAqLyAoZS5sb2NhbFN0b3JlLCByKSkgcmV0dXJuIGF3YWl0IHQuY2xvc2UoKSwgbi5fY29tcGxldGVXaXRoKGZ1bmN0aW9uIF9fUFJJVkFURV9idW5kbGVTdWNjZXNzUHJvZ3Jlc3MoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0ZTogXCJTdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50c0xvYWRlZDogZS50b3RhbERvY3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgYnl0ZXNMb2FkZWQ6IGUudG90YWxCeXRlcyxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxEb2N1bWVudHM6IGUudG90YWxEb2N1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXM6IGUudG90YWxCeXRlc1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KHIpKSwgUHJvbWlzZS5yZXNvbHZlKG5ldyBTZXQpO1xuICAgICAgICAgICAgbi5fdXBkYXRlUHJvZ3Jlc3MoX19QUklWQVRFX2J1bmRsZUluaXRpYWxQcm9ncmVzcyhyKSk7XG4gICAgICAgICAgICBjb25zdCBpID0gbmV3IF9fUFJJVkFURV9CdW5kbGVMb2FkZXIociwgZS5sb2NhbFN0b3JlLCB0LnNlcmlhbGl6ZXIpO1xuICAgICAgICAgICAgbGV0IHMgPSBhd2FpdCB0LlVhKCk7XG4gICAgICAgICAgICBmb3IgKDtzOyApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gYXdhaXQgaS5sYShzKTtcbiAgICAgICAgICAgICAgICBlICYmIG4uX3VwZGF0ZVByb2dyZXNzKGUpLCBzID0gYXdhaXQgdC5VYSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbyA9IGF3YWl0IGkuY29tcGxldGUoKTtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUoZSwgby5JYSwgXG4gICAgICAgICAgICAvKiByZW1vdGVFdmVudCAqLyB2b2lkIDApLCBcbiAgICAgICAgICAgIC8vIFNhdmUgbWV0YWRhdGEsIHNvIGxvYWRpbmcgdGhlIHNhbWUgYnVuZGxlIHdpbGwgc2tpcC5cbiAgICAgICAgICAgIGF3YWl0IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlU2F2ZUJ1bmRsZShlLCB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJTYXZlIGJ1bmRsZVwiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBuLkdyLnNhdmVCdW5kbGVNZXRhZGF0YShlLCB0KSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSBvZiBhIGBOYW1lZFF1ZXJ5YCBhc3NvY2lhdGVkIHdpdGggZ2l2ZW4gcXVlcnkgbmFtZS4gUHJvbWlzZVxuICogcmVzb2x2ZXMgdG8gdW5kZWZpbmVkIGlmIG5vIHBlcnNpc3RlZCBkYXRhIGNhbiBiZSBmb3VuZC5cbiAqLyAoZS5sb2NhbFN0b3JlLCByKSwgbi5fY29tcGxldGVXaXRoKG8ucHJvZ3Jlc3MpLCBQcm9taXNlLnJlc29sdmUoby5QYSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nV2FybihcIlN5bmNFbmdpbmVcIiwgYExvYWRpbmcgYnVuZGxlIGZhaWxlZCB3aXRoICR7ZX1gKSwgbi5fZmFpbFdpdGgoZSksIFxuICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKG5ldyBTZXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLyoqXG4gKiBQcm92aWRlcyBhbGwgY29tcG9uZW50cyBuZWVkZWQgZm9yIEZpcmVzdG9yZSB3aXRoIGluLW1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAqIFVzZXMgRWFnZXJHQyBnYXJiYWdlIGNvbGxlY3Rpb24uXG4gKi8pKHIsIHQsIG4pLnRoZW4oKGUgPT4ge1xuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLm5vdGlmeUJ1bmRsZUxvYWRlZChlKTtcbiAgICB9KSk7XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmtpbmQgPSBcIm1lbW9yeVwiLCB0aGlzLnN5bmNocm9uaXplVGFicyA9ICExO1xuICAgIH1cbiAgICBhc3luYyBpbml0aWFsaXplKGUpIHtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZS5kYXRhYmFzZUluZm8uZGF0YWJhc2VJZCksIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUgPSB0aGlzLldhKGUpLCBcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IHRoaXMuR2EoZSksIGF3YWl0IHRoaXMucGVyc2lzdGVuY2Uuc3RhcnQoKSwgdGhpcy5sb2NhbFN0b3JlID0gdGhpcy56YShlKSwgXG4gICAgICAgIHRoaXMuZ2NTY2hlZHVsZXIgPSB0aGlzLmphKGUsIHRoaXMubG9jYWxTdG9yZSksIHRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyID0gdGhpcy5IYShlLCB0aGlzLmxvY2FsU3RvcmUpO1xuICAgIH1cbiAgICBqYShlLCB0KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBIYShlLCB0KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB6YShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbmV3TG9jYWxTdG9yZSh0aGlzLnBlcnNpc3RlbmNlLCBuZXcgX19QUklWQVRFX1F1ZXJ5RW5naW5lLCBlLmluaXRpYWxVc2VyLCB0aGlzLnNlcmlhbGl6ZXIpO1xuICAgIH1cbiAgICBHYShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeVBlcnNpc3RlbmNlKF9fUFJJVkFURV9NZW1vcnlFYWdlckRlbGVnYXRlLlpyLCB0aGlzLnNlcmlhbGl6ZXIpO1xuICAgIH1cbiAgICBXYShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeVNoYXJlZENsaWVudFN0YXRlO1xuICAgIH1cbiAgICBhc3luYyB0ZXJtaW5hdGUoKSB7XG4gICAgICAgIHZhciBlLCB0O1xuICAgICAgICBudWxsID09PSAoZSA9IHRoaXMuZ2NTY2hlZHVsZXIpIHx8IHZvaWQgMCA9PT0gZSB8fCBlLnN0b3AoKSwgbnVsbCA9PT0gKHQgPSB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlcikgfHwgdm9pZCAwID09PSB0IHx8IHQuc3RvcCgpLCBcbiAgICAgICAgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5zaHV0ZG93bigpLCBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLnNodXRkb3duKCk7XG4gICAgfVxufVxuXG5fX1BSSVZBVEVfTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyID0ge1xuICAgIGJ1aWxkOiAoKSA9PiBuZXcgX19QUklWQVRFX01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlclxufTtcblxuY2xhc3MgX19QUklWQVRFX0xydUdjTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIGV4dGVuZHMgX19QUklWQVRFX01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmNhY2hlU2l6ZUJ5dGVzID0gZTtcbiAgICB9XG4gICAgamEoZSwgdCkge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCh0aGlzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlIGluc3RhbmNlb2YgX19QUklWQVRFX01lbW9yeUxydURlbGVnYXRlKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUuZ2FyYmFnZUNvbGxlY3RvcjtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTHJ1U2NoZWR1bGVyKG4sIGUuYXN5bmNRdWV1ZSwgdCk7XG4gICAgfVxuICAgIEdhKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHZvaWQgMCAhPT0gdGhpcy5jYWNoZVNpemVCeXRlcyA/IExydVBhcmFtcy53aXRoQ2FjaGVTaXplKHRoaXMuY2FjaGVTaXplQnl0ZXMpIDogTHJ1UGFyYW1zLkRFRkFVTFQ7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeVBlcnNpc3RlbmNlKChlID0+IF9fUFJJVkFURV9NZW1vcnlMcnVEZWxlZ2F0ZS5acihlLCB0KSksIHRoaXMuc2VyaWFsaXplcik7XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVzIGFsbCBjb21wb25lbnRzIG5lZWRlZCBmb3IgRmlyZXN0b3JlIHdpdGggSW5kZXhlZERCIHBlcnNpc3RlbmNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgZXh0ZW5kcyBfX1BSSVZBVEVfTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuSmEgPSBlLCB0aGlzLmNhY2hlU2l6ZUJ5dGVzID0gdCwgdGhpcy5mb3JjZU93bmVyc2hpcCA9IG4sIHRoaXMua2luZCA9IFwicGVyc2lzdGVudFwiLCBcbiAgICAgICAgdGhpcy5zeW5jaHJvbml6ZVRhYnMgPSAhMTtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZShlKSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmluaXRpYWxpemUoZSksIGF3YWl0IHRoaXMuSmEuaW5pdGlhbGl6ZSh0aGlzLCBlKSwgXG4gICAgICAgIC8vIEVucXVldWUgd3JpdGVzIGZyb20gYSBwcmV2aW91cyBzZXNzaW9uXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lRW5zdXJlV3JpdGVDYWxsYmFja3ModGhpcy5KYS5zeW5jRW5naW5lKSwgYXdhaXQgX19QUklWQVRFX2ZpbGxXcml0ZVBpcGVsaW5lKHRoaXMuSmEucmVtb3RlU3RvcmUpLCBcbiAgICAgICAgLy8gTk9URTogVGhpcyB3aWxsIGltbWVkaWF0ZWx5IGNhbGwgdGhlIGxpc3RlbmVyLCBzbyB3ZSBtYWtlIHN1cmUgdG9cbiAgICAgICAgLy8gc2V0IGl0IGFmdGVyIGxvY2FsU3RvcmUgLyByZW1vdGVTdG9yZSBhcmUgc3RhcnRlZC5cbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS55aSgoKCkgPT4gKHRoaXMuZ2NTY2hlZHVsZXIgJiYgIXRoaXMuZ2NTY2hlZHVsZXIuc3RhcnRlZCAmJiB0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0KCksIFxuICAgICAgICB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlciAmJiAhdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIuc3RhcnRlZCAmJiB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdGFydCgpLCBcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSk7XG4gICAgfVxuICAgIHphKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9uZXdMb2NhbFN0b3JlKHRoaXMucGVyc2lzdGVuY2UsIG5ldyBfX1BSSVZBVEVfUXVlcnlFbmdpbmUsIGUuaW5pdGlhbFVzZXIsIHRoaXMuc2VyaWFsaXplcik7XG4gICAgfVxuICAgIGphKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUuZ2FyYmFnZUNvbGxlY3RvcjtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTHJ1U2NoZWR1bGVyKG4sIGUuYXN5bmNRdWV1ZSwgdCk7XG4gICAgfVxuICAgIEhhKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfSW5kZXhCYWNrZmlsbGVyKHQsIHRoaXMucGVyc2lzdGVuY2UpO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIoZS5hc3luY1F1ZXVlLCBuKTtcbiAgICB9XG4gICAgR2EoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2luZGV4ZWREYlN0b3JhZ2VQcmVmaXgoZS5kYXRhYmFzZUluZm8uZGF0YWJhc2VJZCwgZS5kYXRhYmFzZUluZm8ucGVyc2lzdGVuY2VLZXkpLCBuID0gdm9pZCAwICE9PSB0aGlzLmNhY2hlU2l6ZUJ5dGVzID8gTHJ1UGFyYW1zLndpdGhDYWNoZVNpemUodGhpcy5jYWNoZVNpemVCeXRlcykgOiBMcnVQYXJhbXMuREVGQVVMVDtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiUGVyc2lzdGVuY2UodGhpcy5zeW5jaHJvbml6ZVRhYnMsIHQsIGUuY2xpZW50SWQsIG4sIGUuYXN5bmNRdWV1ZSwgX19QUklWQVRFX2dldFdpbmRvdygpLCBnZXREb2N1bWVudCgpLCB0aGlzLnNlcmlhbGl6ZXIsIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUsICEhdGhpcy5mb3JjZU93bmVyc2hpcCk7XG4gICAgfVxuICAgIFdhKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTWVtb3J5U2hhcmVkQ2xpZW50U3RhdGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVzIGFsbCBjb21wb25lbnRzIG5lZWRlZCBmb3IgRmlyZXN0b3JlIHdpdGggbXVsdGktdGFiIEluZGV4ZWREQlxuICogcGVyc2lzdGVuY2UuXG4gKlxuICogSW4gdGhlIGxlZ2FjeSBjbGllbnQsIHRoaXMgcHJvdmlkZXIgaXMgdXNlZCB0byBwcm92aWRlIGJvdGggbXVsdGktdGFiIGFuZFxuICogbm9uLW11bHRpLXRhYiBwZXJzaXN0ZW5jZSBzaW5jZSB3ZSBjYW5ub3QgdGVsbCBhdCBidWlsZCB0aW1lIHdoZXRoZXJcbiAqIGBzeW5jaHJvbml6ZVRhYnNgIHdpbGwgYmUgZW5hYmxlZC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTXVsdGlUYWJPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgZXh0ZW5kcyBfX1BSSVZBVEVfSW5kZXhlZERiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIHQsIC8qIGZvcmNlT3duZXJzaGlwPSAqLyAhMSksIHRoaXMuSmEgPSBlLCB0aGlzLmNhY2hlU2l6ZUJ5dGVzID0gdCwgdGhpcy5zeW5jaHJvbml6ZVRhYnMgPSAhMDtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZShlKSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmluaXRpYWxpemUoZSk7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLkphLnN5bmNFbmdpbmU7XG4gICAgICAgIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlICYmICh0aGlzLnNoYXJlZENsaWVudFN0YXRlLnN5bmNFbmdpbmUgPSB7XG4gICAgICAgICAgICBubzogX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseUJhdGNoU3RhdGUuYmluZChudWxsLCB0KSxcbiAgICAgICAgICAgIHJvOiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5VGFyZ2V0U3RhdGUuYmluZChudWxsLCB0KSxcbiAgICAgICAgICAgIGlvOiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5QWN0aXZlVGFyZ2V0c0NoYW5nZS5iaW5kKG51bGwsIHQpLFxuICAgICAgICAgICAgUWk6IF9fUFJJVkFURV9zeW5jRW5naW5lR2V0QWN0aXZlQ2xpZW50cy5iaW5kKG51bGwsIHQpLFxuICAgICAgICAgICAgZW86IF9fUFJJVkFURV9zeW5jRW5naW5lU3luY2hyb25pemVXaXRoQ2hhbmdlZERvY3VtZW50cy5iaW5kKG51bGwsIHQpXG4gICAgICAgIH0sIGF3YWl0IHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUuc3RhcnQoKSksIFxuICAgICAgICAvLyBOT1RFOiBUaGlzIHdpbGwgaW1tZWRpYXRlbHkgY2FsbCB0aGUgbGlzdGVuZXIsIHNvIHdlIG1ha2Ugc3VyZSB0b1xuICAgICAgICAvLyBzZXQgaXQgYWZ0ZXIgbG9jYWxTdG9yZSAvIHJlbW90ZVN0b3JlIGFyZSBzdGFydGVkLlxuICAgICAgICBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLnlpKChhc3luYyBlID0+IHtcbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlQcmltYXJ5U3RhdGUodGhpcy5KYS5zeW5jRW5naW5lLCBlKSwgdGhpcy5nY1NjaGVkdWxlciAmJiAoZSAmJiAhdGhpcy5nY1NjaGVkdWxlci5zdGFydGVkID8gdGhpcy5nY1NjaGVkdWxlci5zdGFydCgpIDogZSB8fCB0aGlzLmdjU2NoZWR1bGVyLnN0b3AoKSksIFxuICAgICAgICAgICAgdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIgJiYgKGUgJiYgIXRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyLnN0YXJ0ZWQgPyB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdGFydCgpIDogZSB8fCB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdG9wKCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIFdhKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9nZXRXaW5kb3coKTtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlLkQodCkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELlVOSU1QTEVNRU5URUQsIFwiSW5kZXhlZERCIHBlcnNpc3RlbmNlIGlzIG9ubHkgYXZhaWxhYmxlIG9uIHBsYXRmb3JtcyB0aGF0IHN1cHBvcnQgTG9jYWxTdG9yYWdlLlwiKTtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9pbmRleGVkRGJTdG9yYWdlUHJlZml4KGUuZGF0YWJhc2VJbmZvLmRhdGFiYXNlSWQsIGUuZGF0YWJhc2VJbmZvLnBlcnNpc3RlbmNlS2V5KTtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlKHQsIGUuYXN5bmNRdWV1ZSwgbiwgZS5jbGllbnRJZCwgZS5pbml0aWFsVXNlcik7XG4gICAgfVxufVxuXG4vKipcbiAqIEluaXRpYWxpemVzIGFuZCB3aXJlcyB0aGUgY29tcG9uZW50cyB0aGF0IGFyZSBuZWVkZWQgdG8gaW50ZXJmYWNlIHdpdGggdGhlXG4gKiBuZXR3b3JrLlxuICovIGNsYXNzIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyIHtcbiAgICBhc3luYyBpbml0aWFsaXplKGUsIHQpIHtcbiAgICAgICAgdGhpcy5sb2NhbFN0b3JlIHx8ICh0aGlzLmxvY2FsU3RvcmUgPSBlLmxvY2FsU3RvcmUsIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUgPSBlLnNoYXJlZENsaWVudFN0YXRlLCBcbiAgICAgICAgdGhpcy5kYXRhc3RvcmUgPSB0aGlzLmNyZWF0ZURhdGFzdG9yZSh0KSwgdGhpcy5yZW1vdGVTdG9yZSA9IHRoaXMuY3JlYXRlUmVtb3RlU3RvcmUodCksIFxuICAgICAgICB0aGlzLmV2ZW50TWFuYWdlciA9IHRoaXMuY3JlYXRlRXZlbnRNYW5hZ2VyKHQpLCB0aGlzLnN5bmNFbmdpbmUgPSB0aGlzLmNyZWF0ZVN5bmNFbmdpbmUodCwgXG4gICAgICAgIC8qIHN0YXJ0QXNQcmltYXJ5PSovICFlLnN5bmNocm9uaXplVGFicyksIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUub25saW5lU3RhdGVIYW5kbGVyID0gZSA9PiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5T25saW5lU3RhdGVDaGFuZ2UodGhpcy5zeW5jRW5naW5lLCBlLCAxIC8qIE9ubGluZVN0YXRlU291cmNlLlNoYXJlZENsaWVudFN0YXRlICovKSwgXG4gICAgICAgIHRoaXMucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UgPSBfX1BSSVZBVEVfc3luY0VuZ2luZUhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UuYmluZChudWxsLCB0aGlzLnN5bmNFbmdpbmUpLCBcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX3JlbW90ZVN0b3JlQXBwbHlQcmltYXJ5U3RhdGUodGhpcy5yZW1vdGVTdG9yZSwgdGhpcy5zeW5jRW5naW5lLmlzUHJpbWFyeUNsaWVudCkpO1xuICAgIH1cbiAgICBjcmVhdGVFdmVudE1hbmFnZXIoZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld0V2ZW50TWFuYWdlcigpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0V2ZW50TWFuYWdlckltcGw7XG4gICAgICAgIH0oKTtcbiAgICB9XG4gICAgY3JlYXRlRGF0YXN0b3JlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9uZXdTZXJpYWxpemVyKGUuZGF0YWJhc2VJbmZvLmRhdGFiYXNlSWQpLCBuID0gZnVuY3Rpb24gX19QUklWQVRFX25ld0Nvbm5lY3Rpb24oZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfV2ViQ2hhbm5lbENvbm5lY3Rpb24oZSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqIFJldHVybiB0aGUgUGxhdGZvcm0tc3BlY2lmaWMgY29ubmVjdGl2aXR5IG1vbml0b3IuICovIChlLmRhdGFiYXNlSW5mbyk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3RGF0YXN0b3JlKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0RhdGFzdG9yZUltcGwoZSwgdCwgbiwgcik7XG4gICAgICAgIH0oZS5hdXRoQ3JlZGVudGlhbHMsIGUuYXBwQ2hlY2tDcmVkZW50aWFscywgbiwgdCk7XG4gICAgfVxuICAgIGNyZWF0ZVJlbW90ZVN0b3JlKGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdSZW1vdGVTdG9yZShlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9SZW1vdGVTdG9yZUltcGwoZSwgdCwgbiwgciwgaSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqIFJlLWVuYWJsZXMgdGhlIG5ldHdvcmsuIElkZW1wb3RlbnQuICovICh0aGlzLmxvY2FsU3RvcmUsIHRoaXMuZGF0YXN0b3JlLCBlLmFzeW5jUXVldWUsIChlID0+IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlPbmxpbmVTdGF0ZUNoYW5nZSh0aGlzLnN5bmNFbmdpbmUsIGUsIDAgLyogT25saW5lU3RhdGVTb3VyY2UuUmVtb3RlU3RvcmUgKi8pKSwgZnVuY3Rpb24gX19QUklWQVRFX25ld0Nvbm5lY3Rpdml0eU1vbml0b3IoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX0Jyb3dzZXJDb25uZWN0aXZpdHlNb25pdG9yLkQoKSA/IG5ldyBfX1BSSVZBVEVfQnJvd3NlckNvbm5lY3Rpdml0eU1vbml0b3IgOiBuZXcgX19QUklWQVRFX05vb3BDb25uZWN0aXZpdHlNb25pdG9yO1xuICAgICAgICB9KCkpO1xuICAgIH1cbiAgICBjcmVhdGVTeW5jRW5naW5lKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdTeW5jRW5naW5lKGUsIHQsIG4sIFxuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE1hbmFnZXMgc3RhdGUgc3luY2hyb25pemF0aW9uIGluIG11bHRpLXRhYiBlbnZpcm9ubWVudHMuXG4gICAgICAgIHIsIGksIHMsIG8pIHtcbiAgICAgICAgICAgIGNvbnN0IF8gPSBuZXcgX19QUklWQVRFX1N5bmNFbmdpbmVJbXBsKGUsIHQsIG4sIHIsIGksIHMpO1xuICAgICAgICAgICAgcmV0dXJuIG8gJiYgKF8uUWEgPSAhMCksIF87XG4gICAgICAgIH0odGhpcy5sb2NhbFN0b3JlLCB0aGlzLnJlbW90ZVN0b3JlLCB0aGlzLmV2ZW50TWFuYWdlciwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSwgZS5pbml0aWFsVXNlciwgZS5tYXhDb25jdXJyZW50TGltYm9SZXNvbHV0aW9ucywgdCk7XG4gICAgfVxuICAgIGFzeW5jIHRlcm1pbmF0ZSgpIHtcbiAgICAgICAgdmFyIGUsIHQ7XG4gICAgICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVTdG9yZVNodXRkb3duKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiUmVtb3RlU3RvcmVcIiwgXCJSZW1vdGVTdG9yZSBzaHV0dGluZyBkb3duLlwiKSwgdC5MXy5hZGQoNSAvKiBPZmZsaW5lQ2F1c2UuU2h1dGRvd24gKi8pLCBcbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKHQpLCB0LmtfLnNodXRkb3duKCksIFxuICAgICAgICAgICAgLy8gU2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBVbmtub3duIChyYXRoZXIgdGhhbiBPZmZsaW5lKSB0byBhdm9pZCBwb3RlbnRpYWxseVxuICAgICAgICAgICAgLy8gdHJpZ2dlcmluZyBzcHVyaW91cyBsaXN0ZW5lciBldmVudHMgd2l0aCBjYWNoZWQgZGF0YSwgZXRjLlxuICAgICAgICAgICAgdC5xXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyk7XG4gICAgICAgIH0odGhpcy5yZW1vdGVTdG9yZSksIG51bGwgPT09IChlID0gdGhpcy5kYXRhc3RvcmUpIHx8IHZvaWQgMCA9PT0gZSB8fCBlLnRlcm1pbmF0ZSgpLCBcbiAgICAgICAgbnVsbCA9PT0gKHQgPSB0aGlzLmV2ZW50TWFuYWdlcikgfHwgdm9pZCAwID09PSB0IHx8IHQudGVybWluYXRlKCk7XG4gICAgfVxufVxuXG5PbmxpbmVDb21wb25lbnRQcm92aWRlci5wcm92aWRlciA9IHtcbiAgICBidWlsZDogKCkgPT4gbmV3IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXG59O1xuXG4vKipcbiAqIEJ1aWxkcyBhIGBCeXRlU3RyZWFtUmVhZGVyYCBmcm9tIGEgVUludDhBcnJheS5cbiAqIEBwYXJhbSBzb3VyY2UgLSBUaGUgZGF0YSBzb3VyY2UgdG8gdXNlLlxuICogQHBhcmFtIGJ5dGVzUGVyUmVhZCAtIEhvdyBtYW55IGJ5dGVzIGVhY2ggYHJlYWQoKWAgZnJvbSB0aGUgcmV0dXJuZWQgcmVhZGVyXG4gKiAgICAgICAgd2lsbCByZWFkLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9CeXRlU3RyZWFtUmVhZGVySGVscGVyKGUsIHQgPSAxMDI0MCkge1xuICAgIGxldCBuID0gMDtcbiAgICAvLyBUaGUgVHlwZVNjcmlwdCBkZWZpbml0aW9uIGZvciBSZWFkYWJsZVN0cmVhbVJlYWRlciBjaGFuZ2VkLiBXZSB1c2VcbiAgICAvLyBgYW55YCBoZXJlIHRvIGFsbG93IHRoaXMgY29kZSB0byBjb21waWxlIHdpdGggZGlmZmVyZW50IHZlcnNpb25zLlxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzQyOTcwXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgYXN5bmMgcmVhZCgpIHtcbiAgICAgICAgICAgIGlmIChuIDwgZS5ieXRlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGUuc2xpY2UobiwgbiArIHQpLFxuICAgICAgICAgICAgICAgICAgICBkb25lOiAhMVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gKz0gdCwgcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIGNhbmNlbCgpIHt9LFxuICAgICAgICByZWxlYXNlTG9jaygpIHt9LFxuICAgICAgICBjbG9zZWQ6IFByb21pc2UucmVzb2x2ZSgpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogT24gd2ViLCBhIGBSZWFkYWJsZVN0cmVhbWAgaXMgd3JhcHBlZCBhcm91bmQgYnkgYSBgQnl0ZVN0cmVhbVJlYWRlcmAuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKlxuICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIE9ic2VydmVyPFQ+IHRoYXQgd2lsbCBkaXNwYXRjaCBldmVudHNcbiAqIGFzeW5jaHJvbm91c2x5LiBUbyBhbGxvdyBpbW1lZGlhdGUgc2lsZW5jaW5nLCBhIG11dGUgY2FsbCBpcyBhZGRlZCB3aGljaFxuICogY2F1c2VzIGV2ZW50cyBzY2hlZHVsZWQgdG8gbm8gbG9uZ2VyIGJlIHJhaXNlZC5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0FzeW5jT2JzZXJ2ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogV2hlbiBzZXQgdG8gdHJ1ZSwgd2lsbCBub3QgcmFpc2UgZnV0dXJlIGV2ZW50cy4gTmVjZXNzYXJ5IHRvIGRlYWwgd2l0aFxuICAgICAgICAgKiBhc3luYyBkZXRhY2htZW50IG9mIGxpc3RlbmVyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tdXRlZCA9ICExO1xuICAgIH1cbiAgICBuZXh0KGUpIHtcbiAgICAgICAgdGhpcy5tdXRlZCB8fCB0aGlzLm9ic2VydmVyLm5leHQgJiYgdGhpcy5ZYSh0aGlzLm9ic2VydmVyLm5leHQsIGUpO1xuICAgIH1cbiAgICBlcnJvcihlKSB7XG4gICAgICAgIHRoaXMubXV0ZWQgfHwgKHRoaXMub2JzZXJ2ZXIuZXJyb3IgPyB0aGlzLllhKHRoaXMub2JzZXJ2ZXIuZXJyb3IsIGUpIDogX19QUklWQVRFX2xvZ0Vycm9yKFwiVW5jYXVnaHQgRXJyb3IgaW4gc25hcHNob3QgbGlzdGVuZXI6XCIsIGUudG9TdHJpbmcoKSkpO1xuICAgIH1cbiAgICBaYSgpIHtcbiAgICAgICAgdGhpcy5tdXRlZCA9ICEwO1xuICAgIH1cbiAgICBZYShlLCB0KSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubXV0ZWQgfHwgZSh0KTtcbiAgICAgICAgfSksIDApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBjbGFzcyByZXByZXNlbnRpbmcgYSBidW5kbGUuXG4gKlxuICogVGFrZXMgYSBidW5kbGUgc3RyZWFtIG9yIGJ1ZmZlciwgYW5kIHByZXNlbnRzIGFic3RyYWN0aW9ucyB0byByZWFkIGJ1bmRsZWRcbiAqIGVsZW1lbnRzIG91dCBvZiB0aGUgdW5kZXJseWluZyBjb250ZW50LlxuICovIGNsYXNzIF9fUFJJVkFURV9CdW5kbGVSZWFkZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIHJlYWRlciB0byByZWFkIGZyb20gdW5kZXJseWluZyBiaW5hcnkgYnVuZGxlIGRhdGEgc291cmNlLiAqL1xuICAgIGUsIHQpIHtcbiAgICAgICAgdGhpcy5YYSA9IGUsIHRoaXMuc2VyaWFsaXplciA9IHQsIFxuICAgICAgICAvKiogQ2FjaGVkIGJ1bmRsZSBtZXRhZGF0YS4gKi9cbiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgYnVmZmVyIHRvIGhvbGQgYnVuZGxlIGNvbnRlbnQsIGFjY3VtdWxhdGluZyBpbmNvbXBsZXRlIGVsZW1lbnRcbiAgICAgICAgICogY29udGVudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXksIHRoaXMuZXUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3VGV4dERlY29kZXIoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKFwidXRmLThcIik7XG4gICAgICAgIH0oKSwgXG4gICAgICAgIC8vIFJlYWQgdGhlIG1ldGFkYXRhICh3aGljaCBpcyB0aGUgZmlyc3QgZWxlbWVudCkuXG4gICAgICAgIHRoaXMudHUoKS50aGVuKChlID0+IHtcbiAgICAgICAgICAgIGUgJiYgZS51YSgpID8gdGhpcy5tZXRhZGF0YS5yZXNvbHZlKGUuYWEubWV0YWRhdGEpIDogdGhpcy5tZXRhZGF0YS5yZWplY3QobmV3IEVycm9yKGBUaGUgZmlyc3QgZWxlbWVudCBvZiB0aGUgYnVuZGxlIGlzIG5vdCBhIG1ldGFkYXRhLCBpdCBpc1xcbiAgICAgICAgICAgICAke0pTT04uc3RyaW5naWZ5KG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuYWEpfWApKTtcbiAgICAgICAgfSksIChlID0+IHRoaXMubWV0YWRhdGEucmVqZWN0KGUpKSk7XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5YYS5jYW5jZWwoKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0TWV0YWRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1ldGFkYXRhLnByb21pc2U7XG4gICAgfVxuICAgIGFzeW5jIFVhKCkge1xuICAgICAgICAvLyBNYWtlcyBzdXJlIG1ldGFkYXRhIGlzIHJlYWQgYmVmb3JlIHByb2NlZWRpbmcuXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldE1ldGFkYXRhKCksIHRoaXMudHUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgZnJvbSB0aGUgaGVhZCBvZiBpbnRlcm5hbCBidWZmZXIsIGFuZCBwdWxsaW5nIG1vcmUgZGF0YSBmcm9tXG4gICAgICogdW5kZXJseWluZyBzdHJlYW0gaWYgYSBjb21wbGV0ZSBlbGVtZW50IGNhbm5vdCBiZSBmb3VuZCwgdW50aWwgYW5cbiAgICAgKiBlbGVtZW50KGluY2x1ZGluZyB0aGUgcHJlZml4ZWQgbGVuZ3RoIGFuZCB0aGUgSlNPTiBzdHJpbmcpIGlzIGZvdW5kLlxuICAgICAqXG4gICAgICogT25jZSBhIGNvbXBsZXRlIGVsZW1lbnQgaXMgcmVhZCwgaXQgaXMgZHJvcHBlZCBmcm9tIGludGVybmFsIGJ1ZmZlci5cbiAgICAgKlxuICAgICAqIFJldHVybnMgZWl0aGVyIHRoZSBidW5kbGVkIGVsZW1lbnQsIG9yIG51bGwgaWYgd2UgaGF2ZSByZWFjaGVkIHRoZSBlbmQgb2ZcbiAgICAgKiB0aGUgc3RyZWFtLlxuICAgICAqLyAgICBhc3luYyB0dSgpIHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IHRoaXMubnUoKTtcbiAgICAgICAgaWYgKG51bGwgPT09IGUpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5ldS5kZWNvZGUoZSksIG4gPSBOdW1iZXIodCk7XG4gICAgICAgIGlzTmFOKG4pICYmIHRoaXMucnUoYGxlbmd0aCBzdHJpbmcgKCR7dH0pIGlzIG5vdCB2YWxpZCBudW1iZXJgKTtcbiAgICAgICAgY29uc3QgciA9IGF3YWl0IHRoaXMuaXUobik7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1NpemVkQnVuZGxlRWxlbWVudChKU09OLnBhcnNlKHIpLCBlLmxlbmd0aCArIG4pO1xuICAgIH1cbiAgICAvKiogRmlyc3QgaW5kZXggb2YgJ3snIGZyb20gdGhlIHVuZGVybHlpbmcgYnVmZmVyLiAqLyAgICBzdSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLmZpbmRJbmRleCgoZSA9PiBlID09PSBcIntcIi5jaGFyQ29kZUF0KDApKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgaW50ZXJuYWwgYnVmZmVyLCB1bnRpbCB0aGUgZmlyc3QgJ3snLCBhbmRcbiAgICAgKiByZXR1cm4gdGhlIGNvbnRlbnQuXG4gICAgICpcbiAgICAgKiBJZiByZWFjaGVkIGVuZCBvZiB0aGUgc3RyZWFtLCByZXR1cm5zIGEgbnVsbC5cbiAgICAgKi8gICAgYXN5bmMgbnUoKSB7XG4gICAgICAgIGZvciAoO3RoaXMuc3UoKSA8IDA7ICkge1xuICAgICAgICAgICAgaWYgKGF3YWl0IHRoaXMub3UoKSkgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQnJva2Ugb3V0IG9mIHRoZSBsb29wIGJlY2F1c2UgdW5kZXJseWluZyBzdHJlYW0gaXMgY2xvc2VkLCBhbmQgdGhlcmVcbiAgICAgICAgLy8gaGFwcGVucyB0byBiZSBubyBtb3JlIGRhdGEgdG8gcHJvY2Vzcy5cbiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gdGhpcy5idWZmZXIubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuc3UoKTtcbiAgICAgICAgLy8gQnJva2Ugb3V0IG9mIHRoZSBsb29wIGJlY2F1c2UgdW5kZXJseWluZyBzdHJlYW0gaXMgY2xvc2VkLCBidXQgc3RpbGxcbiAgICAgICAgLy8gY2Fubm90IGZpbmQgYW4gb3BlbiBicmFja2V0LlxuICAgICAgICAgICAgICAgIGUgPCAwICYmIHRoaXMucnUoXCJSZWFjaGVkIHRoZSBlbmQgb2YgYnVuZGxlIHdoZW4gYSBsZW5ndGggc3RyaW5nIGlzIGV4cGVjdGVkLlwiKTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuYnVmZmVyLnNsaWNlKDAsIGUpO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIGludGVybmFsIGJ1ZmZlciB0byBkcm9wIHRoZSByZWFkIGxlbmd0aC5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5zbGljZShlKSwgdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgZnJvbSBhIHNwZWNpZmllZCBwb3NpdGlvbiBmcm9tIHRoZSBpbnRlcm5hbCBidWZmZXIsIGZvciBhIHNwZWNpZmllZFxuICAgICAqIG51bWJlciBvZiBieXRlcywgcHVsbGluZyBtb3JlIGRhdGEgZnJvbSB0aGUgdW5kZXJseWluZyBzdHJlYW0gaWYgbmVlZGVkLlxuICAgICAqXG4gICAgICogUmV0dXJucyBhIHN0cmluZyBkZWNvZGVkIGZyb20gdGhlIHJlYWQgYnl0ZXMuXG4gICAgICovICAgIGFzeW5jIGl1KGUpIHtcbiAgICAgICAgZm9yICg7dGhpcy5idWZmZXIubGVuZ3RoIDwgZTsgKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLm91KCkgJiYgdGhpcy5ydShcIlJlYWNoZWQgdGhlIGVuZCBvZiBidW5kbGUgd2hlbiBtb3JlIGlzIGV4cGVjdGVkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0ID0gdGhpcy5ldS5kZWNvZGUodGhpcy5idWZmZXIuc2xpY2UoMCwgZSkpO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIGludGVybmFsIGJ1ZmZlciB0byBkcm9wIHRoZSByZWFkIGpzb24gc3RyaW5nLlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLnNsaWNlKGUpLCB0O1xuICAgIH1cbiAgICBydShlKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgdGhyb3cgdGhpcy5YYS5jYW5jZWwoKSwgbmV3IEVycm9yKGBJbnZhbGlkIGJ1bmRsZSBmb3JtYXQ6ICR7ZX1gKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHVsbHMgbW9yZSBkYXRhIGZyb20gdW5kZXJseWluZyBzdHJlYW0gdG8gaW50ZXJuYWwgYnVmZmVyLlxuICAgICAqIFJldHVybnMgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgc3RyZWFtIGlzIGZpbmlzaGVkLlxuICAgICAqLyAgICBhc3luYyBvdSgpIHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IHRoaXMuWGEucmVhZCgpO1xuICAgICAgICBpZiAoIWUuZG9uZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyLmxlbmd0aCArIGUudmFsdWUubGVuZ3RoKTtcbiAgICAgICAgICAgIHQuc2V0KHRoaXMuYnVmZmVyKSwgdC5zZXQoZS52YWx1ZSwgdGhpcy5idWZmZXIubGVuZ3RoKSwgdGhpcy5idWZmZXIgPSB0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlLmRvbmU7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbnRlcm5hbCB0cmFuc2FjdGlvbiBvYmplY3QgcmVzcG9uc2libGUgZm9yIGFjY3VtdWxhdGluZyB0aGUgbXV0YXRpb25zIHRvXG4gKiBwZXJmb3JtIGFuZCB0aGUgYmFzZSB2ZXJzaW9ucyBmb3IgYW55IGRvY3VtZW50cyByZWFkLlxuICovXG5jbGFzcyBUcmFuc2FjdGlvbiQyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuZGF0YXN0b3JlID0gZSwgXG4gICAgICAgIC8vIFRoZSB2ZXJzaW9uIG9mIGVhY2ggZG9jdW1lbnQgdGhhdCB3YXMgcmVhZCBkdXJpbmcgdGhpcyB0cmFuc2FjdGlvbi5cbiAgICAgICAgdGhpcy5yZWFkVmVyc2lvbnMgPSBuZXcgTWFwLCB0aGlzLm11dGF0aW9ucyA9IFtdLCB0aGlzLmNvbW1pdHRlZCA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZGVmZXJyZWQgdXNhZ2UgZXJyb3IgdGhhdCBvY2N1cnJlZCBwcmV2aW91c2x5IGluIHRoaXMgdHJhbnNhY3Rpb24gdGhhdFxuICAgICAgICAgKiB3aWxsIGNhdXNlIHRoZSB0cmFuc2FjdGlvbiB0byBmYWlsIG9uY2UgaXQgYWN0dWFsbHkgY29tbWl0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGFzdFRyYW5zYWN0aW9uRXJyb3IgPSBudWxsLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCBvZiBkb2N1bWVudHMgdGhhdCBoYXZlIGJlZW4gd3JpdHRlbiBpbiB0aGUgdHJhbnNhY3Rpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIFdoZW4gdGhlcmUncyBtb3JlIHRoYW4gb25lIHdyaXRlIHRvIHRoZSBzYW1lIGtleSBpbiBhIHRyYW5zYWN0aW9uLCBhbnlcbiAgICAgICAgICogd3JpdGVzIGFmdGVyIHRoZSBmaXJzdCBhcmUgaGFuZGxlZCBkaWZmZXJlbnRseS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MgPSBuZXcgU2V0O1xuICAgIH1cbiAgICBhc3luYyBsb29rdXAoZSkge1xuICAgICAgICBpZiAodGhpcy5lbnN1cmVDb21taXROb3RDYWxsZWQoKSwgdGhpcy5tdXRhdGlvbnMubGVuZ3RoID4gMCkgdGhyb3cgdGhpcy5sYXN0VHJhbnNhY3Rpb25FcnJvciA9IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiRmlyZXN0b3JlIHRyYW5zYWN0aW9ucyByZXF1aXJlIGFsbCByZWFkcyB0byBiZSBleGVjdXRlZCBiZWZvcmUgYWxsIHdyaXRlcy5cIiksIFxuICAgICAgICB0aGlzLmxhc3RUcmFuc2FjdGlvbkVycm9yO1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2ludm9rZUJhdGNoR2V0RG9jdW1lbnRzUnBjKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50czogdC5tYXAoKGUgPT4gX19QUklWQVRFX3RvTmFtZShuLnNlcmlhbGl6ZXIsIGUpKSlcbiAgICAgICAgICAgIH0sIGkgPSBhd2FpdCBuLkxvKFwiQmF0Y2hHZXREb2N1bWVudHNcIiwgbi5zZXJpYWxpemVyLmRhdGFiYXNlSWQsIFJlc291cmNlUGF0aC5lbXB0eVBhdGgoKSwgciwgdC5sZW5ndGgpLCBzID0gbmV3IE1hcDtcbiAgICAgICAgICAgIGkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tQmF0Y2hHZXREb2N1bWVudHNSZXNwb25zZShuLnNlcmlhbGl6ZXIsIGUpO1xuICAgICAgICAgICAgICAgIHMuc2V0KHQua2V5LnRvU3RyaW5nKCksIHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgbyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHMuZ2V0KGUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoISF0KSwgby5wdXNoKHQpO1xuICAgICAgICAgICAgfSkpLCBvO1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCBlKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB0aGlzLnJlY29yZFZlcnNpb24oZSkpKSwgdDtcbiAgICB9XG4gICAgc2V0KGUsIHQpIHtcbiAgICAgICAgdGhpcy53cml0ZSh0LnRvTXV0YXRpb24oZSwgdGhpcy5wcmVjb25kaXRpb24oZSkpKSwgdGhpcy53cml0dGVuRG9jcy5hZGQoZS50b1N0cmluZygpKTtcbiAgICB9XG4gICAgdXBkYXRlKGUsIHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMud3JpdGUodC50b011dGF0aW9uKGUsIHRoaXMucHJlY29uZGl0aW9uRm9yVXBkYXRlKGUpKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFRyYW5zYWN0aW9uRXJyb3IgPSBlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MuYWRkKGUudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIHRoaXMud3JpdGUobmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihlLCB0aGlzLnByZWNvbmRpdGlvbihlKSkpLCB0aGlzLndyaXR0ZW5Eb2NzLmFkZChlLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBhc3luYyBjb21taXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmVuc3VyZUNvbW1pdE5vdENhbGxlZCgpLCB0aGlzLmxhc3RUcmFuc2FjdGlvbkVycm9yKSB0aHJvdyB0aGlzLmxhc3RUcmFuc2FjdGlvbkVycm9yO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5yZWFkVmVyc2lvbnM7XG4gICAgICAgIC8vIEZvciBlYWNoIG11dGF0aW9uLCBub3RlIHRoYXQgdGhlIGRvYyB3YXMgd3JpdHRlbi5cbiAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9ucy5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGUuZGVsZXRlKHQua2V5LnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSksIFxuICAgICAgICAvLyBGb3IgZWFjaCBkb2N1bWVudCB0aGF0IHdhcyByZWFkIGJ1dCBub3Qgd3JpdHRlbiB0bywgd2Ugd2FudCB0byBwZXJmb3JtXG4gICAgICAgIC8vIGEgYHZlcmlmeWAgb3BlcmF0aW9uLlxuICAgICAgICBlLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gRG9jdW1lbnRLZXkuZnJvbVBhdGgodCk7XG4gICAgICAgICAgICB0aGlzLm11dGF0aW9ucy5wdXNoKG5ldyBfX1BSSVZBVEVfVmVyaWZ5TXV0YXRpb24obiwgdGhpcy5wcmVjb25kaXRpb24obikpKTtcbiAgICAgICAgfSkpLCBhd2FpdCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW52b2tlQ29tbWl0UnBjKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0ge1xuICAgICAgICAgICAgICAgIHdyaXRlczogdC5tYXAoKGUgPT4gdG9NdXRhdGlvbihuLnNlcmlhbGl6ZXIsIGUpKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhd2FpdCBuLk1vKFwiQ29tbWl0XCIsIG4uc2VyaWFsaXplci5kYXRhYmFzZUlkLCBSZXNvdXJjZVBhdGguZW1wdHlQYXRoKCksIHIpO1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCB0aGlzLm11dGF0aW9ucyksIHRoaXMuY29tbWl0dGVkID0gITA7XG4gICAgfVxuICAgIHJlY29yZFZlcnNpb24oZSkge1xuICAgICAgICBsZXQgdDtcbiAgICAgICAgaWYgKGUuaXNGb3VuZERvY3VtZW50KCkpIHQgPSBlLnZlcnNpb247IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFlLmlzTm9Eb2N1bWVudCgpKSB0aHJvdyBmYWlsKCk7XG4gICAgICAgICAgICAvLyBSZXByZXNlbnQgYSBkZWxldGVkIGRvYyB1c2luZyBTbmFwc2hvdFZlcnNpb24ubWluKCkuXG4gICAgICAgICAgICB0ID0gU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnJlYWRWZXJzaW9ucy5nZXQoZS5rZXkudG9TdHJpbmcoKSk7XG4gICAgICAgIGlmIChuKSB7XG4gICAgICAgICAgICBpZiAoIXQuaXNFcXVhbChuKSkgXG4gICAgICAgICAgICAvLyBUaGlzIHRyYW5zYWN0aW9uIHdpbGwgZmFpbCBubyBtYXR0ZXIgd2hhdC5cbiAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELkFCT1JURUQsIFwiRG9jdW1lbnQgdmVyc2lvbiBjaGFuZ2VkIGJldHdlZW4gdHdvIHJlYWRzLlwiKTtcbiAgICAgICAgfSBlbHNlIHRoaXMucmVhZFZlcnNpb25zLnNldChlLmtleS50b1N0cmluZygpLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdmVyc2lvbiBvZiB0aGlzIGRvY3VtZW50IHdoZW4gaXQgd2FzIHJlYWQgaW4gdGhpcyB0cmFuc2FjdGlvbixcbiAgICAgKiBhcyBhIHByZWNvbmRpdGlvbiwgb3Igbm8gcHJlY29uZGl0aW9uIGlmIGl0IHdhcyBub3QgcmVhZC5cbiAgICAgKi8gICAgcHJlY29uZGl0aW9uKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMucmVhZFZlcnNpb25zLmdldChlLnRvU3RyaW5nKCkpO1xuICAgICAgICByZXR1cm4gIXRoaXMud3JpdHRlbkRvY3MuaGFzKGUudG9TdHJpbmcoKSkgJiYgdCA/IHQuaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpID8gUHJlY29uZGl0aW9uLmV4aXN0cyghMSkgOiBQcmVjb25kaXRpb24udXBkYXRlVGltZSh0KSA6IFByZWNvbmRpdGlvbi5ub25lKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHByZWNvbmRpdGlvbiBmb3IgYSBkb2N1bWVudCBpZiB0aGUgb3BlcmF0aW9uIGlzIGFuIHVwZGF0ZS5cbiAgICAgKi8gICAgcHJlY29uZGl0aW9uRm9yVXBkYXRlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMucmVhZFZlcnNpb25zLmdldChlLnRvU3RyaW5nKCkpO1xuICAgICAgICAvLyBUaGUgZmlyc3QgdGltZSBhIGRvY3VtZW50IGlzIHdyaXR0ZW4sIHdlIHdhbnQgdG8gdGFrZSBpbnRvIGFjY291bnQgdGhlXG4gICAgICAgIC8vIHJlYWQgdGltZSBhbmQgZXhpc3RlbmNlXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLndyaXR0ZW5Eb2NzLmhhcyhlLnRvU3RyaW5nKCkpICYmIHQpIHtcbiAgICAgICAgICAgIGlmICh0LmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSkgXG4gICAgICAgICAgICAvLyBUaGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdCwgc28gZmFpbCB0aGUgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAvLyBUaGlzIGhhcyB0byBiZSB2YWxpZGF0ZWQgbG9jYWxseSBiZWNhdXNlIHlvdSBjYW4ndCBzZW5kIGFcbiAgICAgICAgICAgIC8vIHByZWNvbmRpdGlvbiB0aGF0IGEgZG9jdW1lbnQgZG9lcyBub3QgZXhpc3Qgd2l0aG91dCBjaGFuZ2luZyB0aGVcbiAgICAgICAgICAgIC8vIHNlbWFudGljcyBvZiB0aGUgYmFja2VuZCB3cml0ZSB0byBiZSBhbiBpbnNlcnQuIFRoaXMgaXMgdGhlIHJldmVyc2VcbiAgICAgICAgICAgIC8vIG9mIHdoYXQgd2Ugd2FudCwgc2luY2Ugd2Ugd2FudCB0byBhc3NlcnQgdGhhdCB0aGUgZG9jdW1lbnQgZG9lc24ndFxuICAgICAgICAgICAgLy8gZXhpc3QgYnV0IHRoZW4gc2VuZCB0aGUgdXBkYXRlIGFuZCBoYXZlIGl0IGZhaWwuIFNpbmNlIHdlIGNhbid0XG4gICAgICAgICAgICAvLyBleHByZXNzIHRoYXQgdG8gdGhlIGJhY2tlbmQsIHdlIGhhdmUgdG8gdmFsaWRhdGUgbG9jYWxseS5cbiAgICAgICAgICAgIC8vIE5vdGU6IHRoaXMgY2FuIGNoYW5nZSBvbmNlIHdlIGNhbiBzZW5kIHNlcGFyYXRlIHZlcmlmeSB3cml0ZXMgaW4gdGhlXG4gICAgICAgICAgICAvLyB0cmFuc2FjdGlvbi5cbiAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiQ2FuJ3QgdXBkYXRlIGEgZG9jdW1lbnQgdGhhdCBkb2Vzbid0IGV4aXN0LlwiKTtcbiAgICAgICAgICAgIC8vIERvY3VtZW50IGV4aXN0cywgYmFzZSBwcmVjb25kaXRpb24gb24gZG9jdW1lbnQgdXBkYXRlIHRpbWUuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJlY29uZGl0aW9uLnVwZGF0ZVRpbWUodCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRG9jdW1lbnQgd2FzIG5vdCByZWFkLCBzbyB3ZSBqdXN0IHVzZSB0aGUgcHJlY29uZGl0aW9ucyBmb3IgYSBibGluZFxuICAgICAgICAvLyB1cGRhdGUuXG4gICAgICAgIHJldHVybiBQcmVjb25kaXRpb24uZXhpc3RzKCEwKTtcbiAgICB9XG4gICAgd3JpdGUoZSkge1xuICAgICAgICB0aGlzLmVuc3VyZUNvbW1pdE5vdENhbGxlZCgpLCB0aGlzLm11dGF0aW9ucy5wdXNoKGUpO1xuICAgIH1cbiAgICBlbnN1cmVDb21taXROb3RDYWxsZWQoKSB7fVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUcmFuc2FjdGlvblJ1bm5lciBlbmNhcHN1bGF0ZXMgdGhlIGxvZ2ljIG5lZWRlZCB0byBydW4gYW5kIHJldHJ5IHRyYW5zYWN0aW9uc1xuICogd2l0aCBiYWNrb2ZmLlxuICovIGNsYXNzIF9fUFJJVkFURV9UcmFuc2FjdGlvblJ1bm5lciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUgPSBlLCB0aGlzLmRhdGFzdG9yZSA9IHQsIHRoaXMub3B0aW9ucyA9IG4sIHRoaXMudXBkYXRlRnVuY3Rpb24gPSByLCBcbiAgICAgICAgdGhpcy5kZWZlcnJlZCA9IGksIHRoaXMuX3UgPSBuLm1heEF0dGVtcHRzLCB0aGlzLnRfID0gbmV3IF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYodGhpcy5hc3luY1F1ZXVlLCBcInRyYW5zYWN0aW9uX3JldHJ5XCIgLyogVGltZXJJZC5UcmFuc2FjdGlvblJldHJ5ICovKTtcbiAgICB9XG4gICAgLyoqIFJ1bnMgdGhlIHRyYW5zYWN0aW9uIGFuZCBzZXRzIHRoZSByZXN1bHQgb24gZGVmZXJyZWQuICovICAgIGF1KCkge1xuICAgICAgICB0aGlzLl91IC09IDEsIHRoaXMudXUoKTtcbiAgICB9XG4gICAgdXUoKSB7XG4gICAgICAgIHRoaXMudF8uR28oKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgVHJhbnNhY3Rpb24kMih0aGlzLmRhdGFzdG9yZSksIHQgPSB0aGlzLmN1KGUpO1xuICAgICAgICAgICAgdCAmJiB0LnRoZW4oKHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiBlLmNvbW1pdCgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZlcnJlZC5yZXNvbHZlKHQpO1xuICAgICAgICAgICAgICAgIH0pKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubHUoZSk7XG4gICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICB9KSkuY2F0Y2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubHUoZSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgY3UoZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMudXBkYXRlRnVuY3Rpb24oZSk7XG4gICAgICAgICAgICByZXR1cm4gIV9fUFJJVkFURV9pc051bGxPclVuZGVmaW5lZCh0KSAmJiB0LmNhdGNoICYmIHQudGhlbiA/IHQgOiAodGhpcy5kZWZlcnJlZC5yZWplY3QoRXJyb3IoXCJUcmFuc2FjdGlvbiBjYWxsYmFjayBtdXN0IHJldHVybiBhIFByb21pc2VcIikpLCBcbiAgICAgICAgICAgIG51bGwpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBEbyBub3QgcmV0cnkgZXJyb3JzIHRocm93biBieSB1c2VyIHByb3ZpZGVkIHVwZGF0ZUZ1bmN0aW9uLlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmZXJyZWQucmVqZWN0KGUpLCBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGx1KGUpIHtcbiAgICAgICAgdGhpcy5fdSA+IDAgJiYgdGhpcy5odShlKSA/ICh0aGlzLl91IC09IDEsIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiAodGhpcy51dSgpLCBcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSkpIDogdGhpcy5kZWZlcnJlZC5yZWplY3QoZSk7XG4gICAgfVxuICAgIGh1KGUpIHtcbiAgICAgICAgaWYgKFwiRmlyZWJhc2VFcnJvclwiID09PSBlLm5hbWUpIHtcbiAgICAgICAgICAgIC8vIEluIHRyYW5zYWN0aW9ucywgdGhlIGJhY2tlbmQgd2lsbCBmYWlsIG91dGRhdGVkIHJlYWRzIHdpdGggRkFJTEVEX1BSRUNPTkRJVElPTiBhbmRcbiAgICAgICAgICAgIC8vIG5vbi1tYXRjaGluZyBkb2N1bWVudCB2ZXJzaW9ucyB3aXRoIEFCT1JURUQuIFRoZXNlIGVycm9ycyBzaG91bGQgYmUgcmV0cmllZC5cbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNvZGU7XG4gICAgICAgICAgICByZXR1cm4gXCJhYm9ydGVkXCIgPT09IHQgfHwgXCJmYWlsZWQtcHJlY29uZGl0aW9uXCIgPT09IHQgfHwgXCJhbHJlYWR5LWV4aXN0c1wiID09PSB0IHx8ICFfX1BSSVZBVEVfaXNQZXJtYW5lbnRFcnJvcih0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBGaXJlc3RvcmVDbGllbnQgaXMgYSB0b3AtbGV2ZWwgY2xhc3MgdGhhdCBjb25zdHJ1Y3RzIGFuZCBvd25zIGFsbCBvZiB0aGUgLy9cbiAqIHBpZWNlcyBvZiB0aGUgY2xpZW50IFNESyBhcmNoaXRlY3R1cmUuIEl0IGlzIHJlc3BvbnNpYmxlIGZvciBjcmVhdGluZyB0aGUgLy9cbiAqIGFzeW5jIHF1ZXVlIHRoYXQgaXMgc2hhcmVkIGJ5IGFsbCBvZiB0aGUgb3RoZXIgY29tcG9uZW50cyBpbiB0aGUgc3lzdGVtLiAvL1xuICovXG5jbGFzcyBGaXJlc3RvcmVDbGllbnQge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIFxuICAgIC8qKlxuICAgICAqIEFzeW5jaHJvbm91cyBxdWV1ZSByZXNwb25zaWJsZSBmb3IgYWxsIG9mIG91ciBpbnRlcm5hbCBwcm9jZXNzaW5nLiBXaGVuXG4gICAgICogd2UgZ2V0IGluY29taW5nIHdvcmsgZnJvbSB0aGUgdXNlciAodmlhIHB1YmxpYyBBUEkpIG9yIHRoZSBuZXR3b3JrXG4gICAgICogKGluY29taW5nIEdSUEMgbWVzc2FnZXMpLCB3ZSBzaG91bGQgYWx3YXlzIHNjaGVkdWxlIG9udG8gdGhpcyBxdWV1ZS5cbiAgICAgKiBUaGlzIGVuc3VyZXMgYWxsIG9mIG91ciB3b3JrIGlzIHByb3Blcmx5IHNlcmlhbGl6ZWQgKGUuZy4gd2UgZG9uJ3RcbiAgICAgKiBzdGFydCBwcm9jZXNzaW5nIGEgbmV3IG9wZXJhdGlvbiB3aGlsZSB0aGUgcHJldmlvdXMgb25lIGlzIHdhaXRpbmcgZm9yXG4gICAgICogYW4gYXN5bmMgSS9PIHRvIGNvbXBsZXRlKS5cbiAgICAgKi9cbiAgICBuLCByLCBpKSB7XG4gICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzID0gZSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzID0gdCwgdGhpcy5hc3luY1F1ZXVlID0gbiwgdGhpcy5kYXRhYmFzZUluZm8gPSByLCBcbiAgICAgICAgdGhpcy51c2VyID0gVXNlci5VTkFVVEhFTlRJQ0FURUQsIHRoaXMuY2xpZW50SWQgPSBfX1BSSVZBVEVfQXV0b0lkLm5ld0lkKCksIHRoaXMuYXV0aENyZWRlbnRpYWxMaXN0ZW5lciA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgpLCBcbiAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxMaXN0ZW5lciA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgpLCB0aGlzLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyID0gaSwgXG4gICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzLnN0YXJ0KG4sIChhc3luYyBlID0+IHtcbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlJlY2VpdmVkIHVzZXI9XCIsIGUudWlkKSwgYXdhaXQgdGhpcy5hdXRoQ3JlZGVudGlhbExpc3RlbmVyKGUpLCBcbiAgICAgICAgICAgIHRoaXMudXNlciA9IGU7XG4gICAgICAgIH0pKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLnN0YXJ0KG4sIChlID0+IChfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJSZWNlaXZlZCBuZXcgYXBwIGNoZWNrIHRva2VuPVwiLCBlKSwgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIoZSwgdGhpcy51c2VyKSkpKTtcbiAgICB9XG4gICAgZ2V0IGNvbmZpZ3VyYXRpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhc3luY1F1ZXVlOiB0aGlzLmFzeW5jUXVldWUsXG4gICAgICAgICAgICBkYXRhYmFzZUluZm86IHRoaXMuZGF0YWJhc2VJbmZvLFxuICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgICBhdXRoQ3JlZGVudGlhbHM6IHRoaXMuYXV0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgYXBwQ2hlY2tDcmVkZW50aWFsczogdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLFxuICAgICAgICAgICAgaW5pdGlhbFVzZXI6IHRoaXMudXNlcixcbiAgICAgICAgICAgIG1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zOiAxMDBcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyKGUpIHtcbiAgICAgICAgdGhpcy5hdXRoQ3JlZGVudGlhbExpc3RlbmVyID0gZTtcbiAgICB9XG4gICAgc2V0QXBwQ2hlY2tUb2tlbkNoYW5nZUxpc3RlbmVyKGUpIHtcbiAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxMaXN0ZW5lciA9IGU7XG4gICAgfVxuICAgIHRlcm1pbmF0ZSgpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlLmVudGVyUmVzdHJpY3RlZE1vZGUoKTtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgICAgIHJldHVybiB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldEV2ZW5XaGlsZVJlc3RyaWN0ZWQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25saW5lQ29tcG9uZW50cyAmJiBhd2FpdCB0aGlzLl9vbmxpbmVDb21wb25lbnRzLnRlcm1pbmF0ZSgpLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50cyAmJiBhd2FpdCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50cy50ZXJtaW5hdGUoKSwgXG4gICAgICAgICAgICAgICAgLy8gVGhlIGNyZWRlbnRpYWxzIHByb3ZpZGVyIG11c3QgYmUgdGVybWluYXRlZCBhZnRlciBzaHV0dGluZyBkb3duIHRoZVxuICAgICAgICAgICAgICAgIC8vIFJlbW90ZVN0b3JlIGFzIGl0IHdpbGwgcHJldmVudCB0aGUgUmVtb3RlU3RvcmUgZnJvbSByZXRyaWV2aW5nIGF1dGhcbiAgICAgICAgICAgICAgICAvLyB0b2tlbnMuXG4gICAgICAgICAgICAgICAgdGhpcy5hdXRoQ3JlZGVudGlhbHMuc2h1dGRvd24oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLnNodXRkb3duKCksIGUucmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZSh0LCBcIkZhaWxlZCB0byBzaHV0ZG93biBwZXJzaXN0ZW5jZVwiKTtcbiAgICAgICAgICAgICAgICBlLnJlamVjdChuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBlLnByb21pc2U7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIHQpIHtcbiAgICBlLmFzeW5jUXVldWUudmVyaWZ5T3BlcmF0aW9uSW5Qcm9ncmVzcygpLCBfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJJbml0aWFsaXppbmcgT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyXCIpO1xuICAgIGNvbnN0IG4gPSBlLmNvbmZpZ3VyYXRpb247XG4gICAgYXdhaXQgdC5pbml0aWFsaXplKG4pO1xuICAgIGxldCByID0gbi5pbml0aWFsVXNlcjtcbiAgICBlLnNldENyZWRlbnRpYWxDaGFuZ2VMaXN0ZW5lcigoYXN5bmMgZSA9PiB7XG4gICAgICAgIHIuaXNFcXVhbChlKSB8fCAoYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVIYW5kbGVVc2VyQ2hhbmdlKHQubG9jYWxTdG9yZSwgZSksIHIgPSBlKTtcbiAgICB9KSksIFxuICAgIC8vIFdoZW4gYSB1c2VyIGNhbGxzIGNsZWFyUGVyc2lzdGVuY2UoKSBpbiBvbmUgY2xpZW50LCBhbGwgb3RoZXIgY2xpZW50c1xuICAgIC8vIG5lZWQgdG8gYmUgdGVybWluYXRlZCB0byBhbGxvdyB0aGUgZGVsZXRlIHRvIHN1Y2NlZWQuXG4gICAgdC5wZXJzaXN0ZW5jZS5zZXREYXRhYmFzZURlbGV0ZWRMaXN0ZW5lcigoKCkgPT4gZS50ZXJtaW5hdGUoKSkpLCBlLl9vZmZsaW5lQ29tcG9uZW50cyA9IHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zZXRPbmxpbmVDb21wb25lbnRQcm92aWRlcihlLCB0KSB7XG4gICAgZS5hc3luY1F1ZXVlLnZlcmlmeU9wZXJhdGlvbkluUHJvZ3Jlc3MoKTtcbiAgICBjb25zdCBuID0gYXdhaXQgX19QUklWQVRFX2Vuc3VyZU9mZmxpbmVDb21wb25lbnRzKGUpO1xuICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIkluaXRpYWxpemluZyBPbmxpbmVDb21wb25lbnRQcm92aWRlclwiKSwgYXdhaXQgdC5pbml0aWFsaXplKG4sIGUuY29uZmlndXJhdGlvbiksIFxuICAgIC8vIFRoZSBDcmVkZW50aWFsQ2hhbmdlTGlzdGVuZXIgb2YgdGhlIG9ubGluZSBjb21wb25lbnQgcHJvdmlkZXIgdGFrZXNcbiAgICAvLyBwcmVjZWRlbmNlIG92ZXIgdGhlIG9mZmxpbmUgY29tcG9uZW50IHByb3ZpZGVyLlxuICAgIGUuc2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyKChlID0+IF9fUFJJVkFURV9yZW1vdGVTdG9yZUhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UodC5yZW1vdGVTdG9yZSwgZSkpKSwgXG4gICAgZS5zZXRBcHBDaGVja1Rva2VuQ2hhbmdlTGlzdGVuZXIoKChlLCBuKSA9PiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVIYW5kbGVDcmVkZW50aWFsQ2hhbmdlKHQucmVtb3RlU3RvcmUsIG4pKSksIFxuICAgIGUuX29ubGluZUNvbXBvbmVudHMgPSB0O1xufVxuXG4vKipcbiAqIERlY2lkZXMgd2hldGhlciB0aGUgcHJvdmlkZWQgZXJyb3IgYWxsb3dzIHVzIHRvIGdyYWNlZnVsbHkgZGlzYWJsZVxuICogcGVyc2lzdGVuY2UgKGFzIG9wcG9zZWQgdG8gY3Jhc2hpbmcgdGhlIGNsaWVudCkuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2Vuc3VyZU9mZmxpbmVDb21wb25lbnRzKGUpIHtcbiAgICBpZiAoIWUuX29mZmxpbmVDb21wb25lbnRzKSBpZiAoZS5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlcikge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJVc2luZyB1c2VyIHByb3ZpZGVkIE9mZmxpbmVDb21wb25lbnRQcm92aWRlclwiKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9zZXRPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgZS5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlci5fb2ZmbGluZSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0O1xuICAgICAgICAgICAgaWYgKCFmdW5jdGlvbiBfX1BSSVZBVEVfY2FuRmFsbGJhY2tGcm9tSW5kZXhlZERiRXJyb3IoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIkZpcmViYXNlRXJyb3JcIiA9PT0gZS5uYW1lID8gZS5jb2RlID09PSBELkZBSUxFRF9QUkVDT05ESVRJT04gfHwgZS5jb2RlID09PSBELlVOSU1QTEVNRU5URUQgOiAhKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIERPTUV4Y2VwdGlvbiAmJiBlIGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uKSB8fCBcbiAgICAgICAgICAgICAgICAvLyBXaGVuIHRoZSBicm93c2VyIGlzIG91dCBvZiBxdW90YSB3ZSBjb3VsZCBnZXQgZWl0aGVyIHF1b3RhIGV4Y2VlZGVkXG4gICAgICAgICAgICAgICAgLy8gb3IgYW4gYWJvcnRlZCBlcnJvciBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZXJyb3IgaGFwcGVuZWQgZHVyaW5nXG4gICAgICAgICAgICAgICAgLy8gc2NoZW1hIG1pZ3JhdGlvbi5cbiAgICAgICAgICAgICAgICAyMiA9PT0gZS5jb2RlIHx8IDIwID09PSBlLmNvZGUgfHwgXG4gICAgICAgICAgICAgICAgLy8gRmlyZWZveCBQcml2YXRlIEJyb3dzaW5nIG1vZGUgZGlzYWJsZXMgSW5kZXhlZERiIGFuZCByZXR1cm5zXG4gICAgICAgICAgICAgICAgLy8gSU5WQUxJRF9TVEFURSBmb3IgYW55IHVzYWdlLlxuICAgICAgICAgICAgICAgIDExID09PSBlLmNvZGU7XG4gICAgICAgICAgICB9KG4pKSB0aHJvdyBuO1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ1dhcm4oXCJFcnJvciB1c2luZyB1c2VyIHByb3ZpZGVkIGNhY2hlLiBGYWxsaW5nIGJhY2sgdG8gbWVtb3J5IGNhY2hlOiBcIiArIG4pLCBcbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9zZXRPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgbmV3IF9fUFJJVkFURV9NZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlVzaW5nIGRlZmF1bHQgT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyXCIpLCBcbiAgICBhd2FpdCBfX1BSSVZBVEVfc2V0T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIG5ldyBfX1BSSVZBVEVfTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKTtcbiAgICByZXR1cm4gZS5fb2ZmbGluZUNvbXBvbmVudHM7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9lbnN1cmVPbmxpbmVDb21wb25lbnRzKGUpIHtcbiAgICByZXR1cm4gZS5fb25saW5lQ29tcG9uZW50cyB8fCAoZS5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlciA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJVc2luZyB1c2VyIHByb3ZpZGVkIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXCIpLCBcbiAgICBhd2FpdCBfX1BSSVZBVEVfc2V0T25saW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgZS5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlci5fb25saW5lKSkgOiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiVXNpbmcgZGVmYXVsdCBPbmxpbmVDb21wb25lbnRQcm92aWRlclwiKSwgXG4gICAgYXdhaXQgX19QUklWQVRFX3NldE9ubGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIG5ldyBPbmxpbmVDb21wb25lbnRQcm92aWRlcikpKSwgZS5fb25saW5lQ29tcG9uZW50cztcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFBlcnNpc3RlbmNlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2Vuc3VyZU9mZmxpbmVDb21wb25lbnRzKGUpLnRoZW4oKGUgPT4gZS5wZXJzaXN0ZW5jZSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0TG9jYWxTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9lbnN1cmVPZmZsaW5lQ29tcG9uZW50cyhlKS50aGVuKChlID0+IGUubG9jYWxTdG9yZSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0UmVtb3RlU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZW5zdXJlT25saW5lQ29tcG9uZW50cyhlKS50aGVuKChlID0+IGUucmVtb3RlU3RvcmUpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFN5bmNFbmdpbmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZW5zdXJlT25saW5lQ29tcG9uZW50cyhlKS50aGVuKChlID0+IGUuc3luY0VuZ2luZSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0RGF0YXN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2Vuc3VyZU9ubGluZUNvbXBvbmVudHMoZSkudGhlbigoZSA9PiBlLmRhdGFzdG9yZSkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZ2V0RXZlbnRNYW5hZ2VyKGUpIHtcbiAgICBjb25zdCB0ID0gYXdhaXQgX19QUklWQVRFX2Vuc3VyZU9ubGluZUNvbXBvbmVudHMoZSksIG4gPSB0LmV2ZW50TWFuYWdlcjtcbiAgICByZXR1cm4gbi5vbkxpc3RlbiA9IF9fUFJJVkFURV9zeW5jRW5naW5lTGlzdGVuLmJpbmQobnVsbCwgdC5zeW5jRW5naW5lKSwgbi5vblVubGlzdGVuID0gX19QUklWQVRFX3N5bmNFbmdpbmVVbmxpc3Rlbi5iaW5kKG51bGwsIHQuc3luY0VuZ2luZSksIFxuICAgIG4ub25GaXJzdFJlbW90ZVN0b3JlTGlzdGVuID0gX19QUklWQVRFX3RyaWdnZXJSZW1vdGVTdG9yZUxpc3Rlbi5iaW5kKG51bGwsIHQuc3luY0VuZ2luZSksIFxuICAgIG4ub25MYXN0UmVtb3RlU3RvcmVVbmxpc3RlbiA9IF9fUFJJVkFURV90cmlnZ2VyUmVtb3RlU3RvcmVVbmxpc3Rlbi5iaW5kKG51bGwsIHQuc3luY0VuZ2luZSksIFxuICAgIG47XG59XG5cbi8qKiBFbmFibGVzIHRoZSBuZXR3b3JrIGNvbm5lY3Rpb24gYW5kIHJlLWVucXVldWVzIGFsbCBwZW5kaW5nIG9wZXJhdGlvbnMuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRFbmFibGVOZXR3b3JrKGUpIHtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdCA9IGF3YWl0IF9fUFJJVkFURV9nZXRQZXJzaXN0ZW5jZShlKSwgbiA9IGF3YWl0IF9fUFJJVkFURV9nZXRSZW1vdGVTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIHQuc2V0TmV0d29ya0VuYWJsZWQoITApLCBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVFbmFibGVOZXR3b3JrKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgcmV0dXJuIHQuTF8uZGVsZXRlKDAgLyogT2ZmbGluZUNhdXNlLlVzZXJEaXNhYmxlZCAqLyksIF9fUFJJVkFURV9lbmFibGVOZXR3b3JrSW50ZXJuYWwodCk7XG4gICAgICAgIH0obik7XG4gICAgfSkpO1xufVxuXG4vKiogRGlzYWJsZXMgdGhlIG5ldHdvcmsgY29ubmVjdGlvbi4gUGVuZGluZyBvcGVyYXRpb25zIHdpbGwgbm90IGNvbXBsZXRlLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50RGlzYWJsZU5ldHdvcmsoZSkge1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgX19QUklWQVRFX2dldFBlcnNpc3RlbmNlKGUpLCBuID0gYXdhaXQgX19QUklWQVRFX2dldFJlbW90ZVN0b3JlKGUpO1xuICAgICAgICByZXR1cm4gdC5zZXROZXR3b3JrRW5hYmxlZCghMSksIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVTdG9yZURpc2FibGVOZXR3b3JrKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgdC5MXy5hZGQoMCAvKiBPZmZsaW5lQ2F1c2UuVXNlckRpc2FibGVkICovKSwgYXdhaXQgX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrSW50ZXJuYWwodCksIFxuICAgICAgICAgICAgLy8gU2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBPZmZsaW5lIHNvIGdldCgpcyByZXR1cm4gZnJvbSBjYWNoZSwgZXRjLlxuICAgICAgICAgICAgdC5xXy5zZXQoXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyk7XG4gICAgICAgIH0obik7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiBhbGwgd3JpdGVzIHRoYXQgd2VyZSBwZW5kaW5nIGF0IHRoZSB0aW1lXG4gKiB0aGlzIG1ldGhvZCB3YXMgY2FsbGVkIHJlY2VpdmVkIHNlcnZlciBhY2tub3dsZWRnZW1lbnQuIEFuIGFja25vd2xlZGdlbWVudFxuICogY2FuIGJlIGVpdGhlciBhY2NlcHRhbmNlIG9yIHJlamVjdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRGcm9tTG9jYWxDYWNoZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVhZERvY3VtZW50RnJvbUNhY2hlKGUsIHQsIG4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlYWREb2N1bWVudChlLCB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJyZWFkIGRvY3VtZW50XCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gbi5sb2NhbERvY3VtZW50cy5nZXREb2N1bWVudChlLCB0KSkpO1xuICAgICAgICAgICAgfShlLCB0KTtcbiAgICAgICAgICAgIHIuaXNGb3VuZERvY3VtZW50KCkgPyBuLnJlc29sdmUocikgOiByLmlzTm9Eb2N1bWVudCgpID8gbi5yZXNvbHZlKG51bGwpIDogbi5yZWplY3QobmV3IEZpcmVzdG9yZUVycm9yKEQuVU5BVkFJTEFCTEUsIFwiRmFpbGVkIHRvIGdldCBkb2N1bWVudCBmcm9tIGNhY2hlLiAoSG93ZXZlciwgdGhpcyBkb2N1bWVudCBtYXkgZXhpc3Qgb24gdGhlIHNlcnZlci4gUnVuIGFnYWluIHdpdGhvdXQgc2V0dGluZyAnc291cmNlJyBpbiB0aGUgR2V0T3B0aW9ucyB0byBhdHRlbXB0IHRvIHJldHJpZXZlIHRoZSBkb2N1bWVudCBmcm9tIHRoZSBzZXJ2ZXIuKVwiKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCBgRmFpbGVkIHRvIGdldCBkb2N1bWVudCAnJHt0fSBmcm9tIGNhY2hlYCk7XG4gICAgICAgICAgICBuLnJlamVjdChyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAqIFJldHJpZXZlcyBhIGxhdGVuY3ktY29tcGVuc2F0ZWQgZG9jdW1lbnQgZnJvbSB0aGUgYmFja2VuZCB2aWEgYVxuICogU25hcHNob3RMaXN0ZW5lci5cbiAqLyAoYXdhaXQgX19QUklWQVRFX2dldExvY2FsU3RvcmUoZSksIHQsIG4pKSksIG4ucHJvbWlzZTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50VmlhU25hcHNob3RMaXN0ZW5lcihlLCB0LCBuID0ge30pIHtcbiAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9yZWFkRG9jdW1lbnRWaWFTbmFwc2hvdExpc3RlbmVyKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBfX1BSSVZBVEVfQXN5bmNPYnNlcnZlcih7XG4gICAgICAgICAgICBuZXh0OiBfID0+IHtcbiAgICAgICAgICAgICAgICAvLyBNdXRlIGFuZCByZW1vdmUgcXVlcnkgZmlyc3QgYmVmb3JlIHBhc3NpbmcgZXZlbnQgdG8gdXNlciB0byBhdm9pZFxuICAgICAgICAgICAgICAgIC8vIHVzZXIgYWN0aW9ucyBhZmZlY3RpbmcgdGhlIG5vdyBzdGFsZSBxdWVyeS5cbiAgICAgICAgICAgICAgICBzLlphKCksIHQuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gX19QUklWQVRFX2V2ZW50TWFuYWdlclVubGlzdGVuKGUsIG8pKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IF8uZG9jcy5oYXMobik7XG4gICAgICAgICAgICAgICAgIWEgJiYgXy5mcm9tQ2FjaGUgPyBcbiAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElmIHdlJ3JlIG9ubGluZSBhbmQgdGhlIGRvY3VtZW50IGRvZXNuJ3RcbiAgICAgICAgICAgICAgICAvLyBleGlzdCB0aGVuIHdlIHJlc29sdmUgd2l0aCBhIGRvYy5leGlzdHMgc2V0IHRvIGZhbHNlLiBJZlxuICAgICAgICAgICAgICAgIC8vIHdlJ3JlIG9mZmxpbmUgaG93ZXZlciwgd2UgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoaXNcbiAgICAgICAgICAgICAgICAvLyBjYXNlLiBUd28gb3B0aW9uczogMSkgQ2FjaGUgdGhlIG5lZ2F0aXZlIHJlc3BvbnNlIGZyb21cbiAgICAgICAgICAgICAgICAvLyB0aGUgc2VydmVyIHNvIHdlIGNhbiBkZWxpdmVyIHRoYXQgZXZlbiB3aGVuIHlvdSdyZVxuICAgICAgICAgICAgICAgIC8vIG9mZmxpbmUgMikgQWN0dWFsbHkgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoZSBvbmxpbmUgY2FzZVxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBkb2N1bWVudCBkb2Vzbid0IGV4aXN0LlxuICAgICAgICAgICAgICAgIGkucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcihELlVOQVZBSUxBQkxFLCBcIkZhaWxlZCB0byBnZXQgZG9jdW1lbnQgYmVjYXVzZSB0aGUgY2xpZW50IGlzIG9mZmxpbmUuXCIpKSA6IGEgJiYgXy5mcm9tQ2FjaGUgJiYgciAmJiBcInNlcnZlclwiID09PSByLnNvdXJjZSA/IGkucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcihELlVOQVZBSUxBQkxFLCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudCBmcm9tIHNlcnZlci4gKEhvd2V2ZXIsIHRoaXMgZG9jdW1lbnQgZG9lcyBleGlzdCBpbiB0aGUgbG9jYWwgY2FjaGUuIFJ1biBhZ2FpbiB3aXRob3V0IHNldHRpbmcgc291cmNlIHRvIFwic2VydmVyXCIgdG8gcmV0cmlldmUgdGhlIGNhY2hlZCBkb2N1bWVudC4pJykpIDogaS5yZXNvbHZlKF8pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBlID0+IGkucmVqZWN0KGUpXG4gICAgICAgIH0pLCBvID0gbmV3IF9fUFJJVkFURV9RdWVyeUxpc3RlbmVyKF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgobi5wYXRoKSwgcywge1xuICAgICAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogITAsXG4gICAgICAgICAgICBfYTogITBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyTGlzdGVuKGUsIG8pO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgZS5hc3luY1F1ZXVlLCB0LCBuLCByKSkpLCByLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNGcm9tTG9jYWxDYWNoZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZXhlY3V0ZVF1ZXJ5RnJvbUNhY2hlKGUsIHQsIG4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUV4ZWN1dGVRdWVyeShlLCB0LCBcbiAgICAgICAgICAgIC8qIHVzZVByZXZpb3VzUmVzdWx0cz0gKi8gITApLCBpID0gbmV3IF9fUFJJVkFURV9WaWV3KHQsIHIuVHMpLCBzID0gaS5tYShyLmRvY3VtZW50cyksIG8gPSBpLmFwcGx5Q2hhbmdlcyhzLCBcbiAgICAgICAgICAgIC8qIGxpbWJvUmVzb2x1dGlvbkVuYWJsZWQ9ICovICExKTtcbiAgICAgICAgICAgIG4ucmVzb2x2ZShvLnNuYXBzaG90KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV93cmFwSW5Vc2VyRXJyb3JJZlJlY292ZXJhYmxlKGUsIGBGYWlsZWQgdG8gZXhlY3V0ZSBxdWVyeSAnJHt0fSBhZ2FpbnN0IGNhY2hlYCk7XG4gICAgICAgICAgICBuLnJlamVjdChyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAqIFJldHJpZXZlcyBhIGxhdGVuY3ktY29tcGVuc2F0ZWQgcXVlcnkgc25hcHNob3QgZnJvbSB0aGUgYmFja2VuZCB2aWEgYVxuICogU25hcHNob3RMaXN0ZW5lci5cbiAqLyAoYXdhaXQgX19QUklWQVRFX2dldExvY2FsU3RvcmUoZSksIHQsIG4pKSksIG4ucHJvbWlzZTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50c1ZpYVNuYXBzaG90TGlzdGVuZXIoZSwgdCwgbiA9IHt9KSB7XG4gICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfZXhlY3V0ZVF1ZXJ5VmlhU25hcHNob3RMaXN0ZW5lcihlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgX19QUklWQVRFX0FzeW5jT2JzZXJ2ZXIoe1xuICAgICAgICAgICAgbmV4dDogbiA9PiB7XG4gICAgICAgICAgICAgICAgLy8gTXV0ZSBhbmQgcmVtb3ZlIHF1ZXJ5IGZpcnN0IGJlZm9yZSBwYXNzaW5nIGV2ZW50IHRvIHVzZXIgdG8gYXZvaWRcbiAgICAgICAgICAgICAgICAvLyB1c2VyIGFjdGlvbnMgYWZmZWN0aW5nIHRoZSBub3cgc3RhbGUgcXVlcnkuXG4gICAgICAgICAgICAgICAgcy5aYSgpLCB0LmVucXVldWVBbmRGb3JnZXQoKCgpID0+IF9fUFJJVkFURV9ldmVudE1hbmFnZXJVbmxpc3RlbihlLCBvKSkpLCBuLmZyb21DYWNoZSAmJiBcInNlcnZlclwiID09PSByLnNvdXJjZSA/IGkucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcihELlVOQVZBSUxBQkxFLCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudHMgZnJvbSBzZXJ2ZXIuIChIb3dldmVyLCB0aGVzZSBkb2N1bWVudHMgbWF5IGV4aXN0IGluIHRoZSBsb2NhbCBjYWNoZS4gUnVuIGFnYWluIHdpdGhvdXQgc2V0dGluZyBzb3VyY2UgdG8gXCJzZXJ2ZXJcIiB0byByZXRyaWV2ZSB0aGUgY2FjaGVkIGRvY3VtZW50cy4pJykpIDogaS5yZXNvbHZlKG4pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBlID0+IGkucmVqZWN0KGUpXG4gICAgICAgIH0pLCBvID0gbmV3IF9fUFJJVkFURV9RdWVyeUxpc3RlbmVyKG4sIHMsIHtcbiAgICAgICAgICAgIGluY2x1ZGVNZXRhZGF0YUNoYW5nZXM6ICEwLFxuICAgICAgICAgICAgX2E6ICEwXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2V2ZW50TWFuYWdlckxpc3RlbihlLCBvKTtcbiAgICB9KGF3YWl0IF9fUFJJVkFURV9nZXRFdmVudE1hbmFnZXIoZSksIGUuYXN5bmNRdWV1ZSwgdCwgbiwgcikpKSwgci5wcm9taXNlO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50UnVuQWdncmVnYXRlUXVlcnkoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBJbXBsZW1lbnQgYW5kIGNhbGwgZXhlY3V0ZUFnZ3JlZ2F0ZVF1ZXJ5VmlhU25hcHNob3RMaXN0ZW5lciwgc2ltaWxhclxuICAgICAgICAvLyB0byB0aGUgaW1wbGVtZW50YXRpb24gaW4gZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRzVmlhU25hcHNob3RMaXN0ZW5lclxuICAgICAgICAvLyBhYm92ZVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gVE9ETyhiLzI3NzYyODM4NCk6IGNoZWNrIGBjYW5Vc2VOZXR3b3JrKClgIGFuZCBoYW5kbGUgbXVsdGktdGFiLlxuICAgICAgICAgICAgY29uc3QgaSA9IGF3YWl0IF9fUFJJVkFURV9nZXREYXRhc3RvcmUoZSk7XG4gICAgICAgICAgICByLnJlc29sdmUoYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2ludm9rZVJ1bkFnZ3JlZ2F0aW9uUXVlcnlScGMoZSwgdCwgbikge1xuICAgICAgICAgICAgICAgIHZhciByO1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCB7cmVxdWVzdDogcywgdXQ6IG8sIHBhcmVudDogX30gPSBfX1BSSVZBVEVfdG9SdW5BZ2dyZWdhdGlvblF1ZXJ5UmVxdWVzdChpLnNlcmlhbGl6ZXIsIF9fUFJJVkFURV9xdWVyeVRvQWdncmVnYXRlVGFyZ2V0KHQpLCBuKTtcbiAgICAgICAgICAgICAgICBpLmNvbm5lY3Rpb24uRm8gfHwgZGVsZXRlIHMucGFyZW50O1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSAoYXdhaXQgaS5MbyhcIlJ1bkFnZ3JlZ2F0aW9uUXVlcnlcIiwgaS5zZXJpYWxpemVyLmRhdGFiYXNlSWQsIF8sIHMsIFxuICAgICAgICAgICAgICAgIC8qZXhwZWN0ZWRSZXNwb25zZUNvdW50PSovIDEpKS5maWx0ZXIoKGUgPT4gISFlLnJlc3VsdCkpO1xuICAgICAgICAgICAgICAgIC8vIE9taXQgUnVuQWdncmVnYXRpb25RdWVyeVJlc3BvbnNlIHRoYXQgb25seSBjb250YWluIHJlYWRUaW1lcy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoMSA9PT0gYS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIC8vIFJlbWFwIHRoZSBzaG9ydC1mb3JtIGFsaWFzZXMgdGhhdCB3ZXJlIHNlbnQgdG8gdGhlIHNlcnZlclxuICAgICAgICAgICAgICAgIC8vIHRvIHRoZSBjbGllbnQtc2lkZSBhbGlhc2VzLiBVc2VycyB3aWxsIGFjY2VzcyB0aGUgcmVzdWx0c1xuICAgICAgICAgICAgICAgIC8vIHVzaW5nIHRoZSBjbGllbnQtc2lkZSBhbGlhcy5cbiAgICAgICAgICAgICAgICBjb25zdCB1ID0gbnVsbCA9PT0gKHIgPSBhWzBdLnJlc3VsdCkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5hZ2dyZWdhdGVGaWVsZHM7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHUpLnJlZHVjZSgoKGUsIHQpID0+IChlW29bdF1dID0gdVt0XSwgZSkpLCB7fSk7XG4gICAgICAgICAgICB9KGksIHQsIG4pKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgci5yZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICB9KSksIHIucHJvbWlzZTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEFkZFNuYXBzaG90c0luU3luY0xpc3RlbmVyKGUsIHQpIHtcbiAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9Bc3luY09ic2VydmVyKHQpO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX2FkZFNuYXBzaG90c0luU3luY0xpc3RlbmVyKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2RlYnVnQ2FzdChlKS5ZXy5hZGQodCksIFxuICAgICAgICAvLyBJbW1lZGlhdGVseSBmaXJlIGFuIGluaXRpYWwgZXZlbnQsIGluZGljYXRpbmcgYWxsIGV4aXN0aW5nIGxpc3RlbmVyc1xuICAgICAgICAvLyBhcmUgaW4tc3luYy5cbiAgICAgICAgdC5uZXh0KCk7XG4gICAgfShhd2FpdCBfX1BSSVZBVEVfZ2V0RXZlbnRNYW5hZ2VyKGUpLCBuKSkpLCAoKSA9PiB7XG4gICAgICAgIG4uWmEoKSwgZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdmVTbmFwc2hvdHNJblN5bmNMaXN0ZW5lcihlLCB0KSB7XG4gICAgICAgICAgICBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLllfLmRlbGV0ZSh0KTtcbiAgICAgICAgfShhd2FpdCBfX1BSSVZBVEVfZ2V0RXZlbnRNYW5hZ2VyKGUpLCBuKSkpO1xuICAgIH07XG59XG5cbi8qKlxuICogVGFrZXMgYW4gdXBkYXRlRnVuY3Rpb24gaW4gd2hpY2ggYSBzZXQgb2YgcmVhZHMgYW5kIHdyaXRlcyBjYW4gYmUgcGVyZm9ybWVkXG4gKiBhdG9taWNhbGx5LiBJbiB0aGUgdXBkYXRlRnVuY3Rpb24sIHRoZSBjbGllbnQgY2FuIHJlYWQgYW5kIHdyaXRlIHZhbHVlc1xuICogdXNpbmcgdGhlIHN1cHBsaWVkIHRyYW5zYWN0aW9uIG9iamVjdC4gQWZ0ZXIgdGhlIHVwZGF0ZUZ1bmN0aW9uLCBhbGxcbiAqIGNoYW5nZXMgd2lsbCBiZSBjb21taXR0ZWQuIElmIGEgcmV0cnlhYmxlIGVycm9yIG9jY3VycyAoZXg6IHNvbWUgb3RoZXJcbiAqIGNsaWVudCBoYXMgY2hhbmdlZCBhbnkgb2YgdGhlIGRhdGEgcmVmZXJlbmNlZCksIHRoZW4gdGhlIHVwZGF0ZUZ1bmN0aW9uXG4gKiB3aWxsIGJlIGNhbGxlZCBhZ2FpbiBhZnRlciBhIGJhY2tvZmYuIElmIHRoZSB1cGRhdGVGdW5jdGlvbiBzdGlsbCBmYWlsc1xuICogYWZ0ZXIgYWxsIHJldHJpZXMsIHRoZW4gdGhlIHRyYW5zYWN0aW9uIHdpbGwgYmUgcmVqZWN0ZWQuXG4gKlxuICogVGhlIHRyYW5zYWN0aW9uIG9iamVjdCBwYXNzZWQgdG8gdGhlIHVwZGF0ZUZ1bmN0aW9uIGNvbnRhaW5zIG1ldGhvZHMgZm9yXG4gKiBhY2Nlc3NpbmcgZG9jdW1lbnRzIGFuZCBjb2xsZWN0aW9ucy4gVW5saWtlIG90aGVyIGRhdGFzdG9yZSBhY2Nlc3MsIGRhdGFcbiAqIGFjY2Vzc2VkIHdpdGggdGhlIHRyYW5zYWN0aW9uIHdpbGwgbm90IHJlZmxlY3QgbG9jYWwgY2hhbmdlcyB0aGF0IGhhdmUgbm90XG4gKiBiZWVuIGNvbW1pdHRlZC4gRm9yIHRoaXMgcmVhc29uLCBpdCBpcyByZXF1aXJlZCB0aGF0IGFsbCByZWFkcyBhcmVcbiAqIHBlcmZvcm1lZCBiZWZvcmUgYW55IHdyaXRlcy4gVHJhbnNhY3Rpb25zIG11c3QgYmUgcGVyZm9ybWVkIHdoaWxlIG9ubGluZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50TG9hZEJ1bmRsZShlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVCdW5kbGVSZWFkZXIoZSwgdCkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgbiA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBfX1BSSVZBVEVfbmV3VGV4dEVuY29kZXIoKS5lbmNvZGUoZSkgOiBlO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld0J1bmRsZVJlYWRlcihlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9CdW5kbGVSZWFkZXJJbXBsKGUsIHQpO1xuICAgICAgICB9KGZ1bmN0aW9uIF9fUFJJVkFURV90b0J5dGVTdHJlYW1SZWFkZXIoZSwgdCkge1xuICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBVaW50OEFycmF5KSByZXR1cm4gX19QUklWQVRFX3RvQnl0ZVN0cmVhbVJlYWRlckhlbHBlcihlLCB0KTtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHJldHVybiBfX1BSSVZBVEVfdG9CeXRlU3RyZWFtUmVhZGVySGVscGVyKG5ldyBVaW50OEFycmF5KGUpLCB0KTtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUmVhZGFibGVTdHJlYW0pIHJldHVybiBlLmdldFJlYWRlcigpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU291cmNlIG9mIGB0b0J5dGVTdHJlYW1SZWFkZXJgIGhhcyB0byBiZSBhIEFycmF5QnVmZmVyIG9yIFJlYWRhYmxlU3RyZWFtXCIpO1xuICAgICAgICB9KG4pLCB0KTtcbiAgICB9KG4sIF9fUFJJVkFURV9uZXdTZXJpYWxpemVyKHQpKTtcbiAgICBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBfX1BSSVZBVEVfc3luY0VuZ2luZUxvYWRCdW5kbGUoYXdhaXQgX19QUklWQVRFX2dldFN5bmNFbmdpbmUoZSksIGksIHIpO1xuICAgIH0pKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldE5hbWVkUXVlcnkoZSwgdCkge1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXROYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5hbWVkIHF1ZXJ5XCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gbi5Hci5nZXROYW1lZFF1ZXJ5KGUsIHQpKSk7XG4gICAgfShhd2FpdCBfX1BSSVZBVEVfZ2V0TG9jYWxTdG9yZShlKSwgdCkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFNldEluZGV4Q29uZmlndXJhdGlvbihlLCB0KSB7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlKChhc3luYyAoKSA9PiBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUNvbmZpZ3VyZUZpZWxkSW5kZXhlcyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gbi5pbmRleE1hbmFnZXIsIGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJDb25maWd1cmUgaW5kZXhlc1wiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiByLmdldEZpZWxkSW5kZXhlcyhlKS5uZXh0KChuID0+IFxuICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgICAgICAvKipcbiAqIENvbXBhcmVzIHR3byBhcnJheSBmb3IgZXF1YWxpdHkgdXNpbmcgY29tcGFyYXRvci4gVGhlIG1ldGhvZCBjb21wdXRlcyB0aGVcbiAqIGludGVyc2VjdGlvbiBhbmQgaW52b2tlcyBgb25BZGRgIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgaW4gYGFmdGVyYCBidXQgbm90XG4gKiBgYmVmb3JlYC4gYG9uUmVtb3ZlYCBpcyBpbnZva2VkIGZvciBldmVyeSBlbGVtZW50IGluIGBiZWZvcmVgIGJ1dCBtaXNzaW5nXG4gKiBmcm9tIGBhZnRlcmAuXG4gKlxuICogVGhlIG1ldGhvZCBjcmVhdGVzIGEgY29weSBvZiBib3RoIGBiZWZvcmVgIGFuZCBgYWZ0ZXJgIGFuZCBydW5zIGluIE8obiBsb2dcbiAqIG4pLCB3aGVyZSBuIGlzIHRoZSBzaXplIG9mIHRoZSB0d28gbGlzdHMuXG4gKlxuICogQHBhcmFtIGJlZm9yZSAtIFRoZSBlbGVtZW50cyB0aGF0IGV4aXN0IGluIHRoZSBvcmlnaW5hbCBhcnJheS5cbiAqIEBwYXJhbSBhZnRlciAtIFRoZSBlbGVtZW50cyB0byBkaWZmIGFnYWluc3QgdGhlIG9yaWdpbmFsIGFycmF5LlxuICogQHBhcmFtIGNvbXBhcmF0b3IgLSBUaGUgY29tcGFyYXRvciBmb3IgdGhlIGVsZW1lbnRzIGluIGJlZm9yZSBhbmQgYWZ0ZXIuXG4gKiBAcGFyYW0gb25BZGQgLSBBIGZ1bmN0aW9uIHRvIGludm9rZSBmb3IgZXZlcnkgZWxlbWVudCB0aGF0IGlzIHBhcnQgb2YgYFxuICogYWZ0ZXJgIGJ1dCBub3QgYGJlZm9yZWAuXG4gKiBAcGFyYW0gb25SZW1vdmUgLSBBIGZ1bmN0aW9uIHRvIGludm9rZSBmb3IgZXZlcnkgZWxlbWVudCB0aGF0IGlzIHBhcnQgb2ZcbiAqIGBiZWZvcmVgIGJ1dCBub3QgYGFmdGVyYC5cbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfZGlmZkFycmF5cyhlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgICAgICBlID0gWyAuLi5lIF0sIHQgPSBbIC4uLnQgXSwgZS5zb3J0KG4pLCB0LnNvcnQobik7XG4gICAgICAgICAgICBjb25zdCBzID0gZS5sZW5ndGgsIG8gPSB0Lmxlbmd0aDtcbiAgICAgICAgICAgIGxldCBfID0gMCwgYSA9IDA7XG4gICAgICAgICAgICBmb3IgKDtfIDwgbyAmJiBhIDwgczsgKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG4oZVthXSwgdFtfXSk7XG4gICAgICAgICAgICAgICAgcyA8IDAgPyBcbiAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudCB3YXMgcmVtb3ZlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkXG4gICAgICAgICAgICAgICAgLy8gd2Fsa3Rocm91Z2ggaXMgb25seSBpbiBgYmVmb3JlYC5cbiAgICAgICAgICAgICAgICBpKGVbYSsrXSkgOiBzID4gMCA/IFxuICAgICAgICAgICAgICAgIC8vIFRoZSBlbGVtZW50IHdhcyBhZGRlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkIHdhbGt0aHJvdWdoXG4gICAgICAgICAgICAgICAgLy8gaXMgb25seSBpbiBgYWZ0ZXJgLlxuICAgICAgICAgICAgICAgIHIodFtfKytdKSA6IChfKyssIGErKyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKDtfIDwgbzsgKSByKHRbXysrXSk7XG4gICAgICAgICAgICBmb3IgKDthIDwgczsgKSBpKGVbYSsrXSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBWZXJpZmllcyBlcXVhbGl0eSBmb3IgYW4gYXJyYXkgb2YgcHJpbWl0aXZlcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbGVmdCBBcnJheSBvZiBwcmltaXRpdmVzLlxuICogQHBhcmFtIHJpZ2h0IEFycmF5IG9mIHByaW1pdGl2ZXMuXG4gKiBAcmV0dXJuIFRydWUgaWYgYXJyYXlzIGFyZSBlcXVhbC5cbiAqLyAobiwgdCwgX19QUklWQVRFX2ZpZWxkSW5kZXhTZW1hbnRpY0NvbXBhcmF0b3IsICh0ID0+IHtcbiAgICAgICAgICAgIGkucHVzaChyLmFkZEZpZWxkSW5kZXgoZSwgdCkpO1xuICAgICAgICB9KSwgKHQgPT4ge1xuICAgICAgICAgICAgaS5wdXNoKHIuZGVsZXRlRmllbGRJbmRleChlLCB0KSk7XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKGkpKSkpKTtcbiAgICB9KGF3YWl0IF9fUFJJVkFURV9nZXRMb2NhbFN0b3JlKGUpLCB0KSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50U2V0UGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb25FbmFibGVkKGUsIHQpIHtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlU2V0SW5kZXhBdXRvQ3JlYXRpb25FbmFibGVkKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2RlYnVnQ2FzdChlKS5zcy56aSA9IHQ7XG4gICAgfShhd2FpdCBfX1BSSVZBVEVfZ2V0TG9jYWxTdG9yZShlKSwgdCkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudERlbGV0ZUFsbEZpZWxkSW5kZXhlcyhlKSB7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlKChhc3luYyAoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZURlbGV0ZUFsbEZpZWxkSW5kZXhlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCBuID0gdC5pbmRleE1hbmFnZXI7XG4gICAgICAgIHJldHVybiB0LnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiRGVsZXRlIEFsbCBJbmRleGVzXCIsIFwicmVhZHdyaXRlXCIsIChlID0+IG4uZGVsZXRlQWxsRmllbGRJbmRleGVzKGUpKSk7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLy8gVGhlIGZvcm1hdCBvZiB0aGUgTG9jYWxTdG9yYWdlIGtleSB0aGF0IHN0b3JlcyB0aGUgY2xpZW50IHN0YXRlIGlzOlxuICAgIC8vICAgICBmaXJlc3RvcmVfY2xpZW50c188cGVyc2lzdGVuY2VfcHJlZml4Pl88aW5zdGFuY2Vfa2V5PlxuICAgIChhd2FpdCBfX1BSSVZBVEVfZ2V0TG9jYWxTdG9yZShlKSkpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ29tcGFyZXMgdHdvIGBFeHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnNgIG9iamVjdHMgZm9yIGVxdWFsaXR5LlxuICovXG4vKipcbiAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgYEV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9uc2Agd2l0aCB0aGUgc2FtZVxuICogb3B0aW9uIHZhbHVlcyBhcyB0aGUgZ2l2ZW4gaW5zdGFuY2UuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9jbG9uZUxvbmdQb2xsaW5nT3B0aW9ucyhlKSB7XG4gICAgY29uc3QgdCA9IHt9O1xuICAgIHJldHVybiB2b2lkIDAgIT09IGUudGltZW91dFNlY29uZHMgJiYgKHQudGltZW91dFNlY29uZHMgPSBlLnRpbWVvdXRTZWNvbmRzKSwgdDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3Qgd2UgPSBuZXcgTWFwO1xuXG4vKipcbiAqIEFuIGluc3RhbmNlIG1hcCB0aGF0IGVuc3VyZXMgb25seSBvbmUgRGF0YXN0b3JlIGV4aXN0cyBwZXIgRmlyZXN0b3JlXG4gKiBpbnN0YW5jZS5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZU5vbkVtcHR5QXJndW1lbnQoZSwgdCwgbikge1xuICAgIGlmICghbikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEZ1bmN0aW9uICR7ZX0oKSBjYW5ub3QgYmUgY2FsbGVkIHdpdGggYW4gZW1wdHkgJHt0fS5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCB0d28gYm9vbGVhbiBvcHRpb25zIGFyZSBub3Qgc2V0IGF0IHRoZSBzYW1lIHRpbWUuXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVJc05vdFVzZWRUb2dldGhlcihlLCB0LCBuLCByKSB7XG4gICAgaWYgKCEwID09PSB0ICYmICEwID09PSByKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgJHtlfSBhbmQgJHtufSBjYW5ub3QgYmUgdXNlZCB0b2dldGhlci5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBgcGF0aGAgcmVmZXJzIHRvIGEgZG9jdW1lbnQgKGluZGljYXRlZCBieSB0aGUgZmFjdCBpdCBjb250YWluc1xuICogYW4gZXZlbiBudW1iZXJzIG9mIHNlZ21lbnRzKS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVEb2N1bWVudFBhdGgoZSkge1xuICAgIGlmICghRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShlKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgZG9jdW1lbnQgcmVmZXJlbmNlLiBEb2N1bWVudCByZWZlcmVuY2VzIG11c3QgaGF2ZSBhbiBldmVuIG51bWJlciBvZiBzZWdtZW50cywgYnV0ICR7ZX0gaGFzICR7ZS5sZW5ndGh9LmApO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlcyB0aGF0IGBwYXRoYCByZWZlcnMgdG8gYSBjb2xsZWN0aW9uIChpbmRpY2F0ZWQgYnkgdGhlIGZhY3QgaXRcbiAqIGNvbnRhaW5zIGFuIG9kZCBudW1iZXJzIG9mIHNlZ21lbnRzKS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVDb2xsZWN0aW9uUGF0aChlKSB7XG4gICAgaWYgKERvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkoZSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGNvbGxlY3Rpb24gcmVmZXJlbmNlLiBDb2xsZWN0aW9uIHJlZmVyZW5jZXMgbXVzdCBoYXZlIGFuIG9kZCBudW1iZXIgb2Ygc2VnbWVudHMsIGJ1dCAke2V9IGhhcyAke2UubGVuZ3RofS5gKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgaXQncyBhIG5vbi1udWxsIG9iamVjdCB3aXRob3V0IGEgY3VzdG9tIHByb3RvdHlwZVxuICogKGkuZS4gZXhjbHVkZXMgQXJyYXksIERhdGUsIGV0Yy4pLlxuICovXG4vKiogUmV0dXJucyBhIHN0cmluZyBkZXNjcmliaW5nIHRoZSB0eXBlIC8gdmFsdWUgb2YgdGhlIHByb3ZpZGVkIGlucHV0LiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlRGVzY3JpcHRpb24oZSkge1xuICAgIGlmICh2b2lkIDAgPT09IGUpIHJldHVybiBcInVuZGVmaW5lZFwiO1xuICAgIGlmIChudWxsID09PSBlKSByZXR1cm4gXCJudWxsXCI7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpIHJldHVybiBlLmxlbmd0aCA+IDIwICYmIChlID0gYCR7ZS5zdWJzdHJpbmcoMCwgMjApfS4uLmApLCBcbiAgICBKU09OLnN0cmluZ2lmeShlKTtcbiAgICBpZiAoXCJudW1iZXJcIiA9PSB0eXBlb2YgZSB8fCBcImJvb2xlYW5cIiA9PSB0eXBlb2YgZSkgcmV0dXJuIFwiXCIgKyBlO1xuICAgIGlmIChcIm9iamVjdFwiID09IHR5cGVvZiBlKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQXJyYXkpIHJldHVybiBcImFuIGFycmF5XCI7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBcbiAgICAgICAgICAgIC8qKiB0cnkgdG8gZ2V0IHRoZSBjb25zdHJ1Y3RvciBuYW1lIGZvciBhbiBvYmplY3QuICovXG4gICAgICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfdHJ5R2V0Q3VzdG9tT2JqZWN0VHlwZShlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuY29uc3RydWN0b3IpIHJldHVybiBlLmNvbnN0cnVjdG9yLm5hbWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAqIENhc3RzIGBvYmpgIHRvIGBUYCwgb3B0aW9uYWxseSB1bndyYXBwaW5nIENvbXBhdCB0eXBlcyB0byBleHBvc2UgdGhlXG4gKiB1bmRlcmx5aW5nIGluc3RhbmNlLiBUaHJvd3MgaWYgIGBvYmpgIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBgVGAuXG4gKlxuICogVGhpcyBjYXN0IGlzIHVzZWQgaW4gdGhlIExpdGUgYW5kIEZ1bGwgU0RLIHRvIHZlcmlmeSBpbnN0YW5jZSB0eXBlcyBmb3JcbiAqIGFyZ3VtZW50cyBwYXNzZWQgdG8gdGhlIHB1YmxpYyBBUEkuXG4gKiBAaW50ZXJuYWxcbiAqLyAoZSk7XG4gICAgICAgICAgICByZXR1cm4gdCA/IGBhIGN1c3RvbSAke3R9IG9iamVjdGAgOiBcImFuIG9iamVjdFwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUgPyBcImEgZnVuY3Rpb25cIiA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Nhc3QoZSwgXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxudCkge1xuICAgIGlmIChcIl9kZWxlZ2F0ZVwiIGluIGUgJiYgKFxuICAgIC8vIFVud3JhcCBDb21wYXQgdHlwZXNcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGUgPSBlLl9kZWxlZ2F0ZSksICEoZSBpbnN0YW5jZW9mIHQpKSB7XG4gICAgICAgIGlmICh0Lm5hbWUgPT09IGUuY29uc3RydWN0b3IubmFtZSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJUeXBlIGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZCBpbnN0YW5jZS4gRGlkIHlvdSBwYXNzIGEgcmVmZXJlbmNlIGZyb20gYSBkaWZmZXJlbnQgRmlyZXN0b3JlIFNESz9cIik7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdmFsdWVEZXNjcmlwdGlvbihlKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBFeHBlY3RlZCB0eXBlICcke3QubmFtZX0nLCBidXQgaXQgd2FzOiAke259YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGU7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVBvc2l0aXZlTnVtYmVyKGUsIHQpIHtcbiAgICBpZiAodCA8PSAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHtlfSgpIHJlcXVpcmVzIGEgcG9zaXRpdmUgbnVtYmVyLCBidXQgaXQgd2FzOiAke3R9LmApO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gc2V0dGluZ3MoKSBkZWZhdWx0czpcbi8qKlxuICogQSBjb25jcmV0ZSB0eXBlIGRlc2NyaWJpbmcgYWxsIHRoZSB2YWx1ZXMgdGhhdCBjYW4gYmUgYXBwbGllZCB2aWEgYVxuICogdXNlci1zdXBwbGllZCBgRmlyZXN0b3JlU2V0dGluZ3NgIG9iamVjdC4gVGhpcyBpcyBhIHNlcGFyYXRlIHR5cGUgc28gdGhhdFxuICogZGVmYXVsdHMgY2FuIGJlIHN1cHBsaWVkIGFuZCB0aGUgdmFsdWUgY2FuIGJlIGNoZWNrZWQgZm9yIGVxdWFsaXR5LlxuICovXG5jbGFzcyBGaXJlc3RvcmVTZXR0aW5nc0ltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdmFyIHQsIG47XG4gICAgICAgIGlmICh2b2lkIDAgPT09IGUuaG9zdCkge1xuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZS5zc2wpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiQ2FuJ3QgcHJvdmlkZSBzc2wgb3B0aW9uIGlmIGhvc3Qgb3B0aW9uIGlzIG5vdCBzZXRcIik7XG4gICAgICAgICAgICB0aGlzLmhvc3QgPSBcImZpcmVzdG9yZS5nb29nbGVhcGlzLmNvbVwiLCB0aGlzLnNzbCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB0aGlzLmhvc3QgPSBlLmhvc3QsIHRoaXMuc3NsID0gbnVsbCA9PT0gKHQgPSBlLnNzbCkgfHwgdm9pZCAwID09PSB0IHx8IHQ7XG4gICAgICAgIGlmICh0aGlzLmNyZWRlbnRpYWxzID0gZS5jcmVkZW50aWFscywgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzID0gISFlLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMsIFxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGUgPSBlLmxvY2FsQ2FjaGUsIHZvaWQgMCA9PT0gZS5jYWNoZVNpemVCeXRlcykgdGhpcy5jYWNoZVNpemVCeXRlcyA9IDQxOTQzMDQwOyBlbHNlIHtcbiAgICAgICAgICAgIGlmICgtMSAhPT0gZS5jYWNoZVNpemVCeXRlcyAmJiBlLmNhY2hlU2l6ZUJ5dGVzIDwgMTA0ODU3NikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJjYWNoZVNpemVCeXRlcyBtdXN0IGJlIGF0IGxlYXN0IDEwNDg1NzZcIik7XG4gICAgICAgICAgICB0aGlzLmNhY2hlU2l6ZUJ5dGVzID0gZS5jYWNoZVNpemVCeXRlcztcbiAgICAgICAgfVxuICAgICAgICBfX1BSSVZBVEVfdmFsaWRhdGVJc05vdFVzZWRUb2dldGhlcihcImV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmdcIiwgZS5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nLCBcImV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZ1wiLCBlLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyksIFxuICAgICAgICB0aGlzLmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcgPSAhIWUuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZywgdGhpcy5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nID8gdGhpcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSAhMSA6IHZvaWQgMCA9PT0gZS5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPyB0aGlzLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyA9IHRydWUgOiBcbiAgICAgICAgLy8gRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBjb2VyY2UgdGhlIHZhbHVlIHRvIGJvb2xlYW4gZXZlbiB0aG91Z2hcbiAgICAgICAgLy8gdGhlIFR5cGVTY3JpcHQgY29tcGlsZXIgaGFzIG5hcnJvd2VkIHRoZSB0eXBlIHRvIGJvb2xlYW4gYWxyZWFkeS5cbiAgICAgICAgLy8gbm9pbnNwZWN0aW9uIFBvaW50bGVzc0Jvb2xlYW5FeHByZXNzaW9uSlNcbiAgICAgICAgdGhpcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSAhIWUuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nLCBcbiAgICAgICAgdGhpcy5leHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMgPSBfX1BSSVZBVEVfY2xvbmVMb25nUG9sbGluZ09wdGlvbnMobnVsbCAhPT0gKG4gPSBlLmV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9ucykgJiYgdm9pZCAwICE9PSBuID8gbiA6IHt9KSwgXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZUxvbmdQb2xsaW5nT3B0aW9ucyhlKSB7XG4gICAgICAgICAgICBpZiAodm9pZCAwICE9PSBlLnRpbWVvdXRTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKGUudGltZW91dFNlY29uZHMpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgaW52YWxpZCBsb25nIHBvbGxpbmcgdGltZW91dDogJHtlLnRpbWVvdXRTZWNvbmRzfSAobXVzdCBub3QgYmUgTmFOKWApO1xuICAgICAgICAgICAgICAgIGlmIChlLnRpbWVvdXRTZWNvbmRzIDwgNSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYGludmFsaWQgbG9uZyBwb2xsaW5nIHRpbWVvdXQ6ICR7ZS50aW1lb3V0U2Vjb25kc30gKG1pbmltdW0gYWxsb3dlZCB2YWx1ZSBpcyA1KWApO1xuICAgICAgICAgICAgICAgIGlmIChlLnRpbWVvdXRTZWNvbmRzID4gMzApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBpbnZhbGlkIGxvbmcgcG9sbGluZyB0aW1lb3V0OiAke2UudGltZW91dFNlY29uZHN9IChtYXhpbXVtIGFsbG93ZWQgdmFsdWUgaXMgMzApYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAgICAgLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKi8gKHRoaXMuZXhwZXJpbWVudGFsTG9uZ1BvbGxpbmdPcHRpb25zKSwgdGhpcy51c2VGZXRjaFN0cmVhbXMgPSAhIWUudXNlRmV0Y2hTdHJlYW1zO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaG9zdCA9PT0gZS5ob3N0ICYmIHRoaXMuc3NsID09PSBlLnNzbCAmJiB0aGlzLmNyZWRlbnRpYWxzID09PSBlLmNyZWRlbnRpYWxzICYmIHRoaXMuY2FjaGVTaXplQnl0ZXMgPT09IGUuY2FjaGVTaXplQnl0ZXMgJiYgdGhpcy5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nID09PSBlLmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcgJiYgdGhpcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPT09IGUuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9sb25nUG9sbGluZ09wdGlvbnNFcXVhbChlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gZS50aW1lb3V0U2Vjb25kcyA9PT0gdC50aW1lb3V0U2Vjb25kcztcbiAgICAgICAgfSh0aGlzLmV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9ucywgZS5leHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMpICYmIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9PT0gZS5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzICYmIHRoaXMudXNlRmV0Y2hTdHJlYW1zID09PSBlLnVzZUZldGNoU3RyZWFtcztcbiAgICB9XG59XG5cbmNsYXNzIEZpcmVzdG9yZSQxIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5fYXV0aENyZWRlbnRpYWxzID0gZSwgdGhpcy5fYXBwQ2hlY2tDcmVkZW50aWFscyA9IHQsIHRoaXMuX2RhdGFiYXNlSWQgPSBuLCBcbiAgICAgICAgdGhpcy5fYXBwID0gciwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIGl0J3MgYSBGaXJlc3RvcmUgb3IgRmlyZXN0b3JlIExpdGUgaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcImZpcmVzdG9yZS1saXRlXCIsIHRoaXMuX3BlcnNpc3RlbmNlS2V5ID0gXCIobGl0ZSlcIiwgdGhpcy5fc2V0dGluZ3MgPSBuZXcgRmlyZXN0b3JlU2V0dGluZ3NJbXBsKHt9KSwgXG4gICAgICAgIHRoaXMuX3NldHRpbmdzRnJvemVuID0gITEsIFxuICAgICAgICAvLyBBIHRhc2sgdGhhdCBpcyBhc3NpZ25lZCB3aGVuIHRoZSB0ZXJtaW5hdGUoKSBpcyBpbnZva2VkIGFuZCByZXNvbHZlZCB3aGVuXG4gICAgICAgIC8vIGFsbCBjb21wb25lbnRzIGhhdmUgc2h1dCBkb3duLiBPdGhlcndpc2UsIEZpcmVzdG9yZSBpcyBub3QgdGVybWluYXRlZCxcbiAgICAgICAgLy8gd2hpY2ggY2FuIG1lYW4gZWl0aGVyIHRoZSBGaXJlc3RvcmVDbGllbnQgaXMgaW4gdGhlIHByb2Nlc3Mgb2Ygc3RhcnRpbmcsXG4gICAgICAgIC8vIG9yIHJlc3RhcnRpbmcuXG4gICAgICAgIHRoaXMuX3Rlcm1pbmF0ZVRhc2sgPSBcIm5vdFRlcm1pbmF0ZWRcIjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBhc3NvY2lhdGVkIHdpdGggdGhpcyBgRmlyZXN0b3JlYCBzZXJ2aWNlXG4gICAgICogaW5zdGFuY2UuXG4gICAgICovICAgIGdldCBhcHAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fYXBwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5GQUlMRURfUFJFQ09ORElUSU9OLCBcIkZpcmVzdG9yZSB3YXMgbm90IGluaXRpYWxpemVkIHVzaW5nIHRoZSBGaXJlYmFzZSBTREsuICdhcHAnIGlzIG5vdCBhdmFpbGFibGVcIik7XG4gICAgICAgIHJldHVybiB0aGlzLl9hcHA7XG4gICAgfVxuICAgIGdldCBfaW5pdGlhbGl6ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXR0aW5nc0Zyb3plbjtcbiAgICB9XG4gICAgZ2V0IF90ZXJtaW5hdGVkKCkge1xuICAgICAgICByZXR1cm4gXCJub3RUZXJtaW5hdGVkXCIgIT09IHRoaXMuX3Rlcm1pbmF0ZVRhc2s7XG4gICAgfVxuICAgIF9zZXRTZXR0aW5ncyhlKSB7XG4gICAgICAgIGlmICh0aGlzLl9zZXR0aW5nc0Zyb3plbikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJGaXJlc3RvcmUgaGFzIGFscmVhZHkgYmVlbiBzdGFydGVkIGFuZCBpdHMgc2V0dGluZ3MgY2FuIG5vIGxvbmdlciBiZSBjaGFuZ2VkLiBZb3UgY2FuIG9ubHkgbW9kaWZ5IHNldHRpbmdzIGJlZm9yZSBjYWxsaW5nIGFueSBvdGhlciBtZXRob2RzIG9uIGEgRmlyZXN0b3JlIG9iamVjdC5cIik7XG4gICAgICAgIHRoaXMuX3NldHRpbmdzID0gbmV3IEZpcmVzdG9yZVNldHRpbmdzSW1wbChlKSwgdm9pZCAwICE9PSBlLmNyZWRlbnRpYWxzICYmICh0aGlzLl9hdXRoQ3JlZGVudGlhbHMgPSBmdW5jdGlvbiBfX1BSSVZBVEVfbWFrZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyKGUpIHtcbiAgICAgICAgICAgIGlmICghZSkgcmV0dXJuIG5ldyBfX1BSSVZBVEVfRW1wdHlBdXRoQ3JlZGVudGlhbHNQcm92aWRlcjtcbiAgICAgICAgICAgIHN3aXRjaCAoZS50eXBlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJmaXJzdFBhcnR5XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfRmlyc3RQYXJ0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyKGUuc2Vzc2lvbkluZGV4IHx8IFwiMFwiLCBlLmlhbVRva2VuIHx8IG51bGwsIGUuYXV0aFRva2VuRmFjdG9yeSB8fCBudWxsKTtcblxuICAgICAgICAgICAgICBjYXNlIFwicHJvdmlkZXJcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gZS5jbGllbnQ7XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBcIm1ha2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlciBmYWlsZWQgZHVlIHRvIGludmFsaWQgY3JlZGVudGlhbCB0eXBlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KGUuY3JlZGVudGlhbHMpKTtcbiAgICB9XG4gICAgX2dldFNldHRpbmdzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dGluZ3M7XG4gICAgfVxuICAgIF9mcmVlemVTZXR0aW5ncygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldHRpbmdzRnJvemVuID0gITAsIHRoaXMuX3NldHRpbmdzO1xuICAgIH1cbiAgICBfZGVsZXRlKCkge1xuICAgICAgICAvLyBUaGUgYF90ZXJtaW5hdGVUYXNrYCBtdXN0IGJlIGFzc2lnbmVkIGZ1dHVyZSB0aGF0IGNvbXBsZXRlcyB3aGVuXG4gICAgICAgIC8vIHRlcm1pbmF0ZSBpcyBjb21wbGV0ZS4gVGhlIGV4aXN0ZW5jZSBvZiB0aGlzIGZ1dHVyZSBwdXRzIFNESyBpbiBzdGF0ZVxuICAgICAgICAvLyB0aGF0IHdpbGwgbm90IGFjY2VwdCBmdXJ0aGVyIEFQSSBpbnRlcmFjdGlvbi5cbiAgICAgICAgcmV0dXJuIFwibm90VGVybWluYXRlZFwiID09PSB0aGlzLl90ZXJtaW5hdGVUYXNrICYmICh0aGlzLl90ZXJtaW5hdGVUYXNrID0gdGhpcy5fdGVybWluYXRlKCkpLCBcbiAgICAgICAgdGhpcy5fdGVybWluYXRlVGFzaztcbiAgICB9XG4gICAgYXN5bmMgX3Jlc3RhcnQoKSB7XG4gICAgICAgIC8vIFRoZSBgX3Rlcm1pbmF0ZVRhc2tgIG11c3QgZXF1YWwgJ25vdFRlcm1pbmF0ZWQnIGFmdGVyIHJlc3RhcnQgdG9cbiAgICAgICAgLy8gc2lnbmFsIHRoYXQgY2xpZW50IGlzIGluIGEgc3RhdGUgdGhhdCBhY2NlcHRzIEFQSSBjYWxscy5cbiAgICAgICAgXCJub3RUZXJtaW5hdGVkXCIgPT09IHRoaXMuX3Rlcm1pbmF0ZVRhc2sgPyBhd2FpdCB0aGlzLl90ZXJtaW5hdGUoKSA6IHRoaXMuX3Rlcm1pbmF0ZVRhc2sgPSBcIm5vdFRlcm1pbmF0ZWRcIjtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSBKU09OLXNlcmlhbGl6YWJsZSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGBGaXJlc3RvcmVgIGluc3RhbmNlLiAqLyAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhcHA6IHRoaXMuX2FwcCxcbiAgICAgICAgICAgIGRhdGFiYXNlSWQ6IHRoaXMuX2RhdGFiYXNlSWQsXG4gICAgICAgICAgICBzZXR0aW5nczogdGhpcy5fc2V0dGluZ3NcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGVybWluYXRlcyBhbGwgY29tcG9uZW50cyB1c2VkIGJ5IHRoaXMgY2xpZW50LiBTdWJjbGFzc2VzIGNhbiBvdmVycmlkZVxuICAgICAqIHRoaXMgbWV0aG9kIHRvIGNsZWFuIHVwIHRoZWlyIG93biBkZXBlbmRlbmNpZXMsIGJ1dCBtdXN0IGFsc28gY2FsbCB0aGlzXG4gICAgICogbWV0aG9kLlxuICAgICAqXG4gICAgICogT25seSBldmVyIGNhbGxlZCBvbmNlLlxuICAgICAqLyAgICBfdGVybWluYXRlKCkge1xuICAgICAgICAvKipcbiAqIFJlbW92ZXMgYWxsIGNvbXBvbmVudHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBwcm92aWRlZCBpbnN0YW5jZS4gTXVzdCBiZSBjYWxsZWRcbiAqIHdoZW4gdGhlIGBGaXJlc3RvcmVgIGluc3RhbmNlIGlzIHRlcm1pbmF0ZWQuXG4gKi9cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdmVDb21wb25lbnRzKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB3ZS5nZXQoZSk7XG4gICAgICAgICAgICB0ICYmIChfX1BSSVZBVEVfbG9nRGVidWcoXCJDb21wb25lbnRQcm92aWRlclwiLCBcIlJlbW92aW5nIERhdGFzdG9yZVwiKSwgd2UuZGVsZXRlKGUpLCBcbiAgICAgICAgICAgIHQudGVybWluYXRlKCkpO1xuICAgICAgICB9KHRoaXMpLCBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogTW9kaWZ5IHRoaXMgaW5zdGFuY2UgdG8gY29tbXVuaWNhdGUgd2l0aCB0aGUgQ2xvdWQgRmlyZXN0b3JlIGVtdWxhdG9yLlxuICpcbiAqIE5vdGU6IFRoaXMgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIHRoaXMgaW5zdGFuY2UgaGFzIGJlZW4gdXNlZCB0byBkbyBhbnlcbiAqIG9wZXJhdGlvbnMuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIFRoZSBgRmlyZXN0b3JlYCBpbnN0YW5jZSB0byBjb25maWd1cmUgdG8gY29ubmVjdCB0byB0aGVcbiAqIGVtdWxhdG9yLlxuICogQHBhcmFtIGhvc3QgLSB0aGUgZW11bGF0b3IgaG9zdCAoZXg6IGxvY2FsaG9zdCkuXG4gKiBAcGFyYW0gcG9ydCAtIHRoZSBlbXVsYXRvciBwb3J0IChleDogOTAwMCkuXG4gKiBAcGFyYW0gb3B0aW9ucy5tb2NrVXNlclRva2VuIC0gdGhlIG1vY2sgYXV0aCB0b2tlbiB0byB1c2UgZm9yIHVuaXQgdGVzdGluZ1xuICogU2VjdXJpdHkgUnVsZXMuXG4gKi8gZnVuY3Rpb24gY29ubmVjdEZpcmVzdG9yZUVtdWxhdG9yKGUsIHQsIG4sIHIgPSB7fSkge1xuICAgIHZhciBpO1xuICAgIGNvbnN0IHMgPSAoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSQxKSkuX2dldFNldHRpbmdzKCksIG8gPSBgJHt0fToke259YDtcbiAgICBpZiAoXCJmaXJlc3RvcmUuZ29vZ2xlYXBpcy5jb21cIiAhPT0gcy5ob3N0ICYmIHMuaG9zdCAhPT0gbyAmJiBfX1BSSVZBVEVfbG9nV2FybihcIkhvc3QgaGFzIGJlZW4gc2V0IGluIGJvdGggc2V0dGluZ3MoKSBhbmQgY29ubmVjdEZpcmVzdG9yZUVtdWxhdG9yKCksIGVtdWxhdG9yIGhvc3Qgd2lsbCBiZSB1c2VkLlwiKSwgXG4gICAgZS5fc2V0U2V0dGluZ3MoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBzKSwge1xuICAgICAgICBob3N0OiBvLFxuICAgICAgICBzc2w6ICExXG4gICAgfSkpLCByLm1vY2tVc2VyVG9rZW4pIHtcbiAgICAgICAgbGV0IHQsIG47XG4gICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiByLm1vY2tVc2VyVG9rZW4pIHQgPSByLm1vY2tVc2VyVG9rZW4sIG4gPSBVc2VyLk1PQ0tfVVNFUjsgZWxzZSB7XG4gICAgICAgICAgICAvLyBMZXQgY3JlYXRlTW9ja1VzZXJUb2tlbiB2YWxpZGF0ZSBmaXJzdCAoY2F0Y2hlcyBjb21tb24gbWlzdGFrZXMgbGlrZVxuICAgICAgICAgICAgLy8gaW52YWxpZCBmaWVsZCBcInVpZFwiIGFuZCBtaXNzaW5nIGZpZWxkIFwic3ViXCIgLyBcInVzZXJfaWRcIi4pXG4gICAgICAgICAgICB0ID0gY3JlYXRlTW9ja1VzZXJUb2tlbihyLm1vY2tVc2VyVG9rZW4sIG51bGwgPT09IChpID0gZS5fYXBwKSB8fCB2b2lkIDAgPT09IGkgPyB2b2lkIDAgOiBpLm9wdGlvbnMucHJvamVjdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHMgPSByLm1vY2tVc2VyVG9rZW4uc3ViIHx8IHIubW9ja1VzZXJUb2tlbi51c2VyX2lkO1xuICAgICAgICAgICAgaWYgKCFzKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBcIm1vY2tVc2VyVG9rZW4gbXVzdCBjb250YWluICdzdWInIG9yICd1c2VyX2lkJyBmaWVsZCFcIik7XG4gICAgICAgICAgICBuID0gbmV3IFVzZXIocyk7XG4gICAgICAgIH1cbiAgICAgICAgZS5fYXV0aENyZWRlbnRpYWxzID0gbmV3IF9fUFJJVkFURV9FbXVsYXRvckF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyKG5ldyBfX1BSSVZBVEVfT0F1dGhUb2tlbih0LCBuKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBRdWVyeWAgcmVmZXJzIHRvIGEgcXVlcnkgd2hpY2ggeW91IGNhbiByZWFkIG9yIGxpc3RlbiB0by4gWW91IGNhbiBhbHNvXG4gKiBjb25zdHJ1Y3QgcmVmaW5lZCBgUXVlcnlgIG9iamVjdHMgYnkgYWRkaW5nIGZpbHRlcnMgYW5kIG9yZGVyaW5nLlxuICovIGNsYXNzIFF1ZXJ5IHtcbiAgICAvLyBUaGlzIGlzIHRoZSBsaXRlIHZlcnNpb24gb2YgdGhlIFF1ZXJ5IGNsYXNzIGluIHRoZSBtYWluIFNESy5cbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciBwcm90ZWN0ZWQgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCBcbiAgICAvKipcbiAgICAgKiBJZiBwcm92aWRlZCwgdGhlIGBGaXJlc3RvcmVEYXRhQ29udmVydGVyYCBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICB0LCBuKSB7XG4gICAgICAgIHRoaXMuY29udmVydGVyID0gdCwgdGhpcy5fcXVlcnkgPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJxdWVyeVwiLCB0aGlzLmZpcmVzdG9yZSA9IGU7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5KHRoaXMuZmlyZXN0b3JlLCBlLCB0aGlzLl9xdWVyeSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYERvY3VtZW50UmVmZXJlbmNlYCByZWZlcnMgdG8gYSBkb2N1bWVudCBsb2NhdGlvbiBpbiBhIEZpcmVzdG9yZSBkYXRhYmFzZVxuICogYW5kIGNhbiBiZSB1c2VkIHRvIHdyaXRlLCByZWFkLCBvciBsaXN0ZW4gdG8gdGhlIGxvY2F0aW9uLiBUaGUgZG9jdW1lbnQgYXRcbiAqIHRoZSByZWZlcmVuY2VkIGxvY2F0aW9uIG1heSBvciBtYXkgbm90IGV4aXN0LlxuICovIGNsYXNzIERvY3VtZW50UmVmZXJlbmNlIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIFxuICAgIC8qKlxuICAgICAqIElmIHByb3ZpZGVkLCB0aGUgYEZpcmVzdG9yZURhdGFDb252ZXJ0ZXJgIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGluc3RhbmNlLlxuICAgICAqL1xuICAgIHQsIG4pIHtcbiAgICAgICAgdGhpcy5jb252ZXJ0ZXIgPSB0LCB0aGlzLl9rZXkgPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJkb2N1bWVudFwiLCB0aGlzLmZpcmVzdG9yZSA9IGU7XG4gICAgfVxuICAgIGdldCBfcGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgZG9jdW1lbnQncyBpZGVudGlmaWVyIHdpdGhpbiBpdHMgY29sbGVjdGlvbi5cbiAgICAgKi8gICAgZ2V0IGlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fa2V5LnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBwYXRoIG9mIHRoZSByZWZlcmVuY2VkIGRvY3VtZW50IChyZWxhdGl2ZVxuICAgICAqIHRvIHRoZSByb290IG9mIHRoZSBkYXRhYmFzZSkuXG4gICAgICovICAgIGdldCBwYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fa2V5LnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBjb2xsZWN0aW9uIHRoaXMgYERvY3VtZW50UmVmZXJlbmNlYCBiZWxvbmdzIHRvLlxuICAgICAqLyAgICBnZXQgcGFyZW50KCkge1xuICAgICAgICByZXR1cm4gbmV3IENvbGxlY3Rpb25SZWZlcmVuY2UodGhpcy5maXJlc3RvcmUsIHRoaXMuY29udmVydGVyLCB0aGlzLl9rZXkucGF0aC5wb3BMYXN0KCkpO1xuICAgIH1cbiAgICB3aXRoQ29udmVydGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgZSwgdGhpcy5fa2V5KTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgQ29sbGVjdGlvblJlZmVyZW5jZWAgb2JqZWN0IGNhbiBiZSB1c2VkIGZvciBhZGRpbmcgZG9jdW1lbnRzLCBnZXR0aW5nXG4gKiBkb2N1bWVudCByZWZlcmVuY2VzLCBhbmQgcXVlcnlpbmcgZm9yIGRvY3VtZW50cyAodXNpbmcge0BsaW5rIChxdWVyeToxKX0pLlxuICovIGNsYXNzIENvbGxlY3Rpb25SZWZlcmVuY2UgZXh0ZW5kcyBRdWVyeSB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKGUsIHQsIF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgobikpLCB0aGlzLl9wYXRoID0gbiwgXG4gICAgICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIEZpcmVzdG9yZSByZWZlcmVuY2UuICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiY29sbGVjdGlvblwiO1xuICAgIH1cbiAgICAvKiogVGhlIGNvbGxlY3Rpb24ncyBpZGVudGlmaWVyLiAqLyAgICBnZXQgaWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgcGF0aCBvZiB0aGUgcmVmZXJlbmNlZCBjb2xsZWN0aW9uIChyZWxhdGl2ZVxuICAgICAqIHRvIHRoZSByb290IG9mIHRoZSBkYXRhYmFzZSkuXG4gICAgICovICAgIGdldCBwYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnkucGF0aC5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSByZWZlcmVuY2UgdG8gdGhlIGNvbnRhaW5pbmcgYERvY3VtZW50UmVmZXJlbmNlYCBpZiB0aGlzIGlzIGFcbiAgICAgKiBzdWJjb2xsZWN0aW9uLiBJZiB0aGlzIGlzbid0IGEgc3ViY29sbGVjdGlvbiwgdGhlIHJlZmVyZW5jZSBpcyBudWxsLlxuICAgICAqLyAgICBnZXQgcGFyZW50KCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5fcGF0aC5wb3BMYXN0KCk7XG4gICAgICAgIHJldHVybiBlLmlzRW1wdHkoKSA/IG51bGwgOiBuZXcgRG9jdW1lbnRSZWZlcmVuY2UodGhpcy5maXJlc3RvcmUsIFxuICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIG5ldyBEb2N1bWVudEtleShlKSk7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IENvbGxlY3Rpb25SZWZlcmVuY2UodGhpcy5maXJlc3RvcmUsIGUsIHRoaXMuX3BhdGgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gY29sbGVjdGlvbihlLCB0LCAuLi5uKSB7XG4gICAgaWYgKGUgPSBnZXRNb2R1bGFySW5zdGFuY2UoZSksIF9fUFJJVkFURV92YWxpZGF0ZU5vbkVtcHR5QXJndW1lbnQoXCJjb2xsZWN0aW9uXCIsIFwicGF0aFwiLCB0KSwgZSBpbnN0YW5jZW9mIEZpcmVzdG9yZSQxKSB7XG4gICAgICAgIGNvbnN0IHIgPSBSZXNvdXJjZVBhdGguZnJvbVN0cmluZyh0LCAuLi5uKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZUNvbGxlY3Rpb25QYXRoKHIpLCBuZXcgQ29sbGVjdGlvblJlZmVyZW5jZShlLCAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIHIpO1xuICAgIH1cbiAgICB7XG4gICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBEb2N1bWVudFJlZmVyZW5jZSB8fCBlIGluc3RhbmNlb2YgQ29sbGVjdGlvblJlZmVyZW5jZSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiRXhwZWN0ZWQgZmlyc3QgYXJndW1lbnQgdG8gY29sbGVjdGlvbigpIHRvIGJlIGEgQ29sbGVjdGlvblJlZmVyZW5jZSwgYSBEb2N1bWVudFJlZmVyZW5jZSBvciBGaXJlYmFzZUZpcmVzdG9yZVwiKTtcbiAgICAgICAgY29uc3QgciA9IGUuX3BhdGguY2hpbGQoUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcodCwgLi4ubikpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ZhbGlkYXRlQ29sbGVjdGlvblBhdGgociksIG5ldyBDb2xsZWN0aW9uUmVmZXJlbmNlKGUuZmlyZXN0b3JlLCBcbiAgICAgICAgLyogY29udmVydGVyPSAqLyBudWxsLCByKTtcbiAgICB9XG59XG5cbi8vIFRPRE8oZmlyZXN0b3JlbGl0ZSk6IENvbnNpZGVyIHVzaW5nIEVycm9yRmFjdG9yeSAtXG4vLyBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2Jsb2IvMDEzMWUxZi9wYWNrYWdlcy91dGlsL3NyYy9lcnJvcnMudHMjTDEwNlxuLyoqXG4gKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgbmV3IGBRdWVyeWAgaW5zdGFuY2UgdGhhdCBpbmNsdWRlcyBhbGwgZG9jdW1lbnRzIGluIHRoZVxuICogZGF0YWJhc2UgdGhhdCBhcmUgY29udGFpbmVkIGluIGEgY29sbGVjdGlvbiBvciBzdWJjb2xsZWN0aW9uIHdpdGggdGhlXG4gKiBnaXZlbiBgY29sbGVjdGlvbklkYC5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gQSByZWZlcmVuY2UgdG8gdGhlIHJvb3QgYEZpcmVzdG9yZWAgaW5zdGFuY2UuXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkIC0gSWRlbnRpZmllcyB0aGUgY29sbGVjdGlvbnMgdG8gcXVlcnkgb3Zlci4gRXZlcnlcbiAqIGNvbGxlY3Rpb24gb3Igc3ViY29sbGVjdGlvbiB3aXRoIHRoaXMgSUQgYXMgdGhlIGxhc3Qgc2VnbWVudCBvZiBpdHMgcGF0aFxuICogd2lsbCBiZSBpbmNsdWRlZC4gQ2Fubm90IGNvbnRhaW4gYSBzbGFzaC5cbiAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIGBRdWVyeWAuXG4gKi8gZnVuY3Rpb24gY29sbGVjdGlvbkdyb3VwKGUsIHQpIHtcbiAgICBpZiAoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSQxKSwgX19QUklWQVRFX3ZhbGlkYXRlTm9uRW1wdHlBcmd1bWVudChcImNvbGxlY3Rpb25Hcm91cFwiLCBcImNvbGxlY3Rpb24gaWRcIiwgdCksIFxuICAgIHQuaW5kZXhPZihcIi9cIikgPj0gMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgY29sbGVjdGlvbiBJRCAnJHt0fScgcGFzc2VkIHRvIGZ1bmN0aW9uIGNvbGxlY3Rpb25Hcm91cCgpLiBDb2xsZWN0aW9uIElEcyBtdXN0IG5vdCBjb250YWluICcvJy5gKTtcbiAgICByZXR1cm4gbmV3IFF1ZXJ5KGUsIFxuICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5Rm9yQ29sbGVjdGlvbkdyb3VwKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKFJlc291cmNlUGF0aC5lbXB0eVBhdGgoKSwgZSk7XG4gICAgfSh0KSk7XG59XG5cbmZ1bmN0aW9uIGRvYyhlLCB0LCAuLi5uKSB7XG4gICAgaWYgKGUgPSBnZXRNb2R1bGFySW5zdGFuY2UoZSksIFxuICAgIC8vIFdlIGFsbG93IG9taXNzaW9uIG9mICdwYXRoU3RyaW5nJyBidXQgZXhwbGljaXRseSBwcm9oaWJpdCBwYXNzaW5nIGluIGJvdGhcbiAgICAvLyAndW5kZWZpbmVkJyBhbmQgJ251bGwnLlxuICAgIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggJiYgKHQgPSBfX1BSSVZBVEVfQXV0b0lkLm5ld0lkKCkpLCBfX1BSSVZBVEVfdmFsaWRhdGVOb25FbXB0eUFyZ3VtZW50KFwiZG9jXCIsIFwicGF0aFwiLCB0KSwgXG4gICAgZSBpbnN0YW5jZW9mIEZpcmVzdG9yZSQxKSB7XG4gICAgICAgIGNvbnN0IHIgPSBSZXNvdXJjZVBhdGguZnJvbVN0cmluZyh0LCAuLi5uKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZURvY3VtZW50UGF0aChyKSwgbmV3IERvY3VtZW50UmVmZXJlbmNlKGUsIFxuICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIG5ldyBEb2N1bWVudEtleShyKSk7XG4gICAgfVxuICAgIHtcbiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIERvY3VtZW50UmVmZXJlbmNlIHx8IGUgaW5zdGFuY2VvZiBDb2xsZWN0aW9uUmVmZXJlbmNlKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJFeHBlY3RlZCBmaXJzdCBhcmd1bWVudCB0byBjb2xsZWN0aW9uKCkgdG8gYmUgYSBDb2xsZWN0aW9uUmVmZXJlbmNlLCBhIERvY3VtZW50UmVmZXJlbmNlIG9yIEZpcmViYXNlRmlyZXN0b3JlXCIpO1xuICAgICAgICBjb25zdCByID0gZS5fcGF0aC5jaGlsZChSZXNvdXJjZVBhdGguZnJvbVN0cmluZyh0LCAuLi5uKSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVEb2N1bWVudFBhdGgociksIG5ldyBEb2N1bWVudFJlZmVyZW5jZShlLmZpcmVzdG9yZSwgZSBpbnN0YW5jZW9mIENvbGxlY3Rpb25SZWZlcmVuY2UgPyBlLmNvbnZlcnRlciA6IG51bGwsIG5ldyBEb2N1bWVudEtleShyKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgcmVmZXJlbmNlcyBhcmUgZXF1YWwuXG4gKlxuICogQHBhcmFtIGxlZnQgLSBBIHJlZmVyZW5jZSB0byBjb21wYXJlLlxuICogQHBhcmFtIHJpZ2h0IC0gQSByZWZlcmVuY2UgdG8gY29tcGFyZS5cbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5jZXMgcG9pbnQgdG8gdGhlIHNhbWUgbG9jYXRpb24gaW4gdGhlIHNhbWVcbiAqIEZpcmVzdG9yZSBkYXRhYmFzZS5cbiAqLyBmdW5jdGlvbiByZWZFcXVhbChlLCB0KSB7XG4gICAgcmV0dXJuIGUgPSBnZXRNb2R1bGFySW5zdGFuY2UoZSksIHQgPSBnZXRNb2R1bGFySW5zdGFuY2UodCksIChlIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UgfHwgZSBpbnN0YW5jZW9mIENvbGxlY3Rpb25SZWZlcmVuY2UpICYmICh0IGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UgfHwgdCBpbnN0YW5jZW9mIENvbGxlY3Rpb25SZWZlcmVuY2UpICYmIChlLmZpcmVzdG9yZSA9PT0gdC5maXJlc3RvcmUgJiYgZS5wYXRoID09PSB0LnBhdGggJiYgZS5jb252ZXJ0ZXIgPT09IHQuY29udmVydGVyKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHByb3ZpZGVkIHF1ZXJpZXMgcG9pbnQgdG8gdGhlIHNhbWUgY29sbGVjdGlvbiBhbmQgYXBwbHlcbiAqIHRoZSBzYW1lIGNvbnN0cmFpbnRzLlxuICpcbiAqIEBwYXJhbSBsZWZ0IC0gQSBgUXVlcnlgIHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0gcmlnaHQgLSBBIGBRdWVyeWAgdG8gY29tcGFyZS5cbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5jZXMgcG9pbnQgdG8gdGhlIHNhbWUgbG9jYXRpb24gaW4gdGhlIHNhbWVcbiAqIEZpcmVzdG9yZSBkYXRhYmFzZS5cbiAqLyBmdW5jdGlvbiBxdWVyeUVxdWFsKGUsIHQpIHtcbiAgICByZXR1cm4gZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSwgdCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSwgZSBpbnN0YW5jZW9mIFF1ZXJ5ICYmIHQgaW5zdGFuY2VvZiBRdWVyeSAmJiAoZS5maXJlc3RvcmUgPT09IHQuZmlyZXN0b3JlICYmIF9fUFJJVkFURV9xdWVyeUVxdWFscyhlLl9xdWVyeSwgdC5fcXVlcnkpICYmIGUuY29udmVydGVyID09PSB0LmNvbnZlcnRlcik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9Bc3luY1F1ZXVlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSA9IFByb21pc2UucmVzb2x2ZSgpKSB7XG4gICAgICAgIC8vIEEgbGlzdCBvZiByZXRyeWFibGUgb3BlcmF0aW9ucy4gUmV0cnlhYmxlIG9wZXJhdGlvbnMgYXJlIHJ1biBpbiBvcmRlciBhbmRcbiAgICAgICAgLy8gcmV0cmllZCB3aXRoIGJhY2tvZmYuXG4gICAgICAgIHRoaXMuUHUgPSBbXSwgXG4gICAgICAgIC8vIElzIHRoaXMgQXN5bmNRdWV1ZSBiZWluZyBzaHV0IGRvd24/IE9uY2UgaXQgaXMgc2V0IHRvIHRydWUsIGl0IHdpbGwgbm90XG4gICAgICAgIC8vIGJlIGNoYW5nZWQgYWdhaW4uXG4gICAgICAgIHRoaXMuSXUgPSAhMSwgXG4gICAgICAgIC8vIE9wZXJhdGlvbnMgc2NoZWR1bGVkIHRvIGJlIHF1ZXVlZCBpbiB0aGUgZnV0dXJlLiBPcGVyYXRpb25zIGFyZVxuICAgICAgICAvLyBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgYWZ0ZXIgdGhleSBhcmUgcnVuIG9yIGNhbmNlbGVkLlxuICAgICAgICB0aGlzLlR1ID0gW10sIFxuICAgICAgICAvLyB2aXNpYmxlIGZvciB0ZXN0aW5nXG4gICAgICAgIHRoaXMuRXUgPSBudWxsLCBcbiAgICAgICAgLy8gRmxhZyBzZXQgd2hpbGUgdGhlcmUncyBhbiBvdXRzdGFuZGluZyBBc3luY1F1ZXVlIG9wZXJhdGlvbiwgdXNlZCBmb3JcbiAgICAgICAgLy8gYXNzZXJ0aW9uIHNhbml0eS1jaGVja3MuXG4gICAgICAgIHRoaXMuZHUgPSAhMSwgXG4gICAgICAgIC8vIEVuYWJsZWQgZHVyaW5nIHNodXRkb3duIG9uIFNhZmFyaSB0byBwcmV2ZW50IGZ1dHVyZSBhY2Nlc3MgdG8gSW5kZXhlZERCLlxuICAgICAgICB0aGlzLkF1ID0gITEsIFxuICAgICAgICAvLyBMaXN0IG9mIFRpbWVySWRzIHRvIGZhc3QtZm9yd2FyZCBkZWxheXMgZm9yLlxuICAgICAgICB0aGlzLlJ1ID0gW10sIFxuICAgICAgICAvLyBCYWNrb2ZmIHRpbWVyIHVzZWQgdG8gc2NoZWR1bGUgcmV0cmllcyBmb3IgcmV0cnlhYmxlIG9wZXJhdGlvbnNcbiAgICAgICAgdGhpcy50XyA9IG5ldyBfX1BSSVZBVEVfRXhwb25lbnRpYWxCYWNrb2ZmKHRoaXMsIFwiYXN5bmNfcXVldWVfcmV0cnlcIiAvKiBUaW1lcklkLkFzeW5jUXVldWVSZXRyeSAqLyksIFxuICAgICAgICAvLyBWaXNpYmlsaXR5IGhhbmRsZXIgdGhhdCB0cmlnZ2VycyBhbiBpbW1lZGlhdGUgcmV0cnkgb2YgYWxsIHJldHJ5YWJsZVxuICAgICAgICAvLyBvcGVyYXRpb25zLiBNZWFudCB0byBzcGVlZCB1cCByZWNvdmVyeSB3aGVuIHdlIHJlZ2FpbiBmaWxlIHN5c3RlbSBhY2Nlc3NcbiAgICAgICAgLy8gYWZ0ZXIgcGFnZSBjb21lcyBpbnRvIGZvcmVncm91bmQuXG4gICAgICAgIHRoaXMuVnUgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlID0gZ2V0RG9jdW1lbnQoKTtcbiAgICAgICAgICAgIGUgJiYgX19QUklWQVRFX2xvZ0RlYnVnKFwiQXN5bmNRdWV1ZVwiLCBcIlZpc2liaWxpdHkgc3RhdGUgY2hhbmdlZCB0byBcIiArIGUudmlzaWJpbGl0eVN0YXRlKSwgXG4gICAgICAgICAgICB0aGlzLnRfLmpvKCk7XG4gICAgICAgIH0sIHRoaXMubXUgPSBlO1xuICAgICAgICBjb25zdCB0ID0gZ2V0RG9jdW1lbnQoKTtcbiAgICAgICAgdCAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQuYWRkRXZlbnRMaXN0ZW5lciAmJiB0LmFkZEV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMuVnUpO1xuICAgIH1cbiAgICBnZXQgaXNTaHV0dGluZ0Rvd24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkl1O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbmV3IG9wZXJhdGlvbiB0byB0aGUgcXVldWUgd2l0aG91dCB3YWl0aW5nIGZvciBpdCB0byBjb21wbGV0ZSAoaS5lLlxuICAgICAqIHdlIGlnbm9yZSB0aGUgUHJvbWlzZSByZXN1bHQpLlxuICAgICAqLyAgICBlbnF1ZXVlQW5kRm9yZ2V0KGUpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICB0aGlzLmVucXVldWUoZSk7XG4gICAgfVxuICAgIGVucXVldWVBbmRGb3JnZXRFdmVuV2hpbGVSZXN0cmljdGVkKGUpIHtcbiAgICAgICAgdGhpcy5mdSgpLCBcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICB0aGlzLmd1KGUpO1xuICAgIH1cbiAgICBlbnRlclJlc3RyaWN0ZWRNb2RlKGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLkl1KSB7XG4gICAgICAgICAgICB0aGlzLkl1ID0gITAsIHRoaXMuQXUgPSBlIHx8ICExO1xuICAgICAgICAgICAgY29uc3QgdCA9IGdldERvY3VtZW50KCk7XG4gICAgICAgICAgICB0ICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdC5yZW1vdmVFdmVudExpc3RlbmVyICYmIHQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgdGhpcy5WdSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZW5xdWV1ZShlKSB7XG4gICAgICAgIGlmICh0aGlzLmZ1KCksIHRoaXMuSXUpIFxuICAgICAgICAvLyBSZXR1cm4gYSBQcm9taXNlIHdoaWNoIG5ldmVyIHJlc29sdmVzLlxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKCgpID0+IHt9KSk7XG4gICAgICAgIC8vIENyZWF0ZSBhIGRlZmVycmVkIFByb21pc2UgdGhhdCB3ZSBjYW4gcmV0dXJuIHRvIHRoZSBjYWxsZWUuIFRoaXNcbiAgICAgICAgLy8gYWxsb3dzIHVzIHRvIHJldHVybiBhIFwiaGFuZ2luZyBQcm9taXNlXCIgb25seSB0byB0aGUgY2FsbGVlIGFuZCBzdGlsbFxuICAgICAgICAvLyBhZHZhbmNlIHRoZSBxdWV1ZSBldmVuIHdoZW4gdGhlIG9wZXJhdGlvbiBpcyBub3QgcnVuLlxuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gdGhpcy5ndSgoKCkgPT4gdGhpcy5JdSAmJiB0aGlzLkF1ID8gUHJvbWlzZS5yZXNvbHZlKCkgOiAoZSgpLnRoZW4odC5yZXNvbHZlLCB0LnJlamVjdCksIFxuICAgICAgICB0LnByb21pc2UpKSkudGhlbigoKCkgPT4gdC5wcm9taXNlKSk7XG4gICAgfVxuICAgIGVucXVldWVSZXRyeWFibGUoZSkge1xuICAgICAgICB0aGlzLmVucXVldWVBbmRGb3JnZXQoKCgpID0+ICh0aGlzLlB1LnB1c2goZSksIHRoaXMucHUoKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUnVucyB0aGUgbmV4dCBvcGVyYXRpb24gZnJvbSB0aGUgcmV0cnlhYmxlIHF1ZXVlLiBJZiB0aGUgb3BlcmF0aW9uIGZhaWxzLFxuICAgICAqIHJlc2NoZWR1bGVzIHdpdGggYmFja29mZi5cbiAgICAgKi8gICAgYXN5bmMgcHUoKSB7XG4gICAgICAgIGlmICgwICE9PSB0aGlzLlB1Lmxlbmd0aCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlB1WzBdKCksIHRoaXMuUHUuc2hpZnQoKSwgdGhpcy50Xy5yZXNldCgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGlmICghX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgdGhyb3cgZTtcbiAvLyBGYWlsdXJlIHdpbGwgYmUgaGFuZGxlZCBieSBBc3luY1F1ZXVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkFzeW5jUXVldWVcIiwgXCJPcGVyYXRpb24gZmFpbGVkIHdpdGggcmV0cnlhYmxlIGVycm9yOiBcIiArIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5QdS5sZW5ndGggPiAwICYmIFxuICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGFkZGl0aW9uYWwgb3BlcmF0aW9ucywgd2UgcmUtc2NoZWR1bGUgYHJldHJ5TmV4dE9wKClgLlxuICAgICAgICAgICAgLy8gVGhpcyBpcyBuZWNlc3NhcnkgdG8gcnVuIHJldHJ5YWJsZSBvcGVyYXRpb25zIHRoYXQgZmFpbGVkIGR1cmluZ1xuICAgICAgICAgICAgLy8gdGhlaXIgaW5pdGlhbCBhdHRlbXB0IHNpbmNlIHdlIGRvbid0IGtub3cgd2hldGhlciB0aGV5IGFyZSBhbHJlYWR5XG4gICAgICAgICAgICAvLyBlbnF1ZXVlZC4gSWYsIGZvciBleGFtcGxlLCBgb3AxYCwgYG9wMmAsIGBvcDNgIGFyZSBlbnF1ZXVlZCBhbmQgYG9wMWBcbiAgICAgICAgICAgIC8vIG5lZWRzIHRvICBiZSByZS1ydW4sIHdlIHdpbGwgcnVuIGBvcDFgLCBgb3AxYCwgYG9wMmAgdXNpbmcgdGhlXG4gICAgICAgICAgICAvLyBhbHJlYWR5IGVucXVldWVkIGNhbGxzIHRvIGByZXRyeU5leHRPcCgpYC4gYG9wMygpYCB3aWxsIHRoZW4gcnVuIGluIHRoZVxuICAgICAgICAgICAgLy8gY2FsbCBzY2hlZHVsZWQgaGVyZS5cbiAgICAgICAgICAgIC8vIFNpbmNlIGBiYWNrb2ZmQW5kUnVuKClgIGNhbmNlbHMgYW4gZXhpc3RpbmcgYmFja29mZiBhbmQgc2NoZWR1bGVzIGFcbiAgICAgICAgICAgIC8vIG5ldyBiYWNrb2ZmIG9uIGV2ZXJ5IGNhbGwsIHRoZXJlIGlzIG9ubHkgZXZlciBhIHNpbmdsZSBhZGRpdGlvbmFsXG4gICAgICAgICAgICAvLyBvcGVyYXRpb24gaW4gdGhlIHF1ZXVlLlxuICAgICAgICAgICAgdGhpcy50Xy5HbygoKCkgPT4gdGhpcy5wdSgpKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ3UoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5tdS50aGVuKCgoKSA9PiAodGhpcy5kdSA9ICEwLCBlKCkuY2F0Y2goKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5FdSA9IGUsIHRoaXMuZHUgPSAhMTtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBcbiAgICAgICAgICAgIC8qKlxuICogQ2hyb21lIGluY2x1ZGVzIEVycm9yLm1lc3NhZ2UgaW4gRXJyb3Iuc3RhY2suIE90aGVyIGJyb3dzZXJzIGRvIG5vdC5cbiAqIFRoaXMgcmV0dXJucyBleHBlY3RlZCBvdXRwdXQgb2YgbWVzc2FnZSArIHN0YWNrIHdoZW4gYXZhaWxhYmxlLlxuICogQHBhcmFtIGVycm9yIC0gRXJyb3Igb3IgRmlyZXN0b3JlRXJyb3JcbiAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2dldE1lc3NhZ2VPclN0YWNrKGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9IGUubWVzc2FnZSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGUuc3RhY2sgJiYgKHQgPSBlLnN0YWNrLmluY2x1ZGVzKGUubWVzc2FnZSkgPyBlLnN0YWNrIDogZS5tZXNzYWdlICsgXCJcXG5cIiArIGUuc3RhY2spO1xuICAgICAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKGUpO1xuICAgICAgICAgICAgLy8gUmUtdGhyb3cgdGhlIGVycm9yIHNvIHRoYXQgdGhpcy50YWlsIGJlY29tZXMgYSByZWplY3RlZCBQcm9taXNlIGFuZFxuICAgICAgICAgICAgLy8gYWxsIGZ1cnRoZXIgYXR0ZW1wdHMgdG8gY2hhaW4gKHZpYSAudGhlbikgd2lsbCBqdXN0IHNob3J0LWNpcmN1aXRcbiAgICAgICAgICAgIC8vIGFuZCByZXR1cm4gdGhlIHJlamVjdGVkIFByb21pc2UuXG4gICAgICAgICAgICB0aHJvdyBfX1BSSVZBVEVfbG9nRXJyb3IoXCJJTlRFUk5BTCBVTkhBTkRMRUQgRVJST1I6IFwiLCB0KSwgZTtcbiAgICAgICAgfSkpLnRoZW4oKGUgPT4gKHRoaXMuZHUgPSAhMSwgZSkpKSkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubXUgPSB0LCB0O1xuICAgIH1cbiAgICBlbnF1ZXVlQWZ0ZXJEZWxheShlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZnUoKSwgXG4gICAgICAgIC8vIEZhc3QtZm9yd2FyZCBkZWxheXMgZm9yIHRpbWVySWRzIHRoYXQgaGF2ZSBiZWVuIG92ZXJyaWRkZW4uXG4gICAgICAgIHRoaXMuUnUuaW5kZXhPZihlKSA+IC0xICYmICh0ID0gMCk7XG4gICAgICAgIGNvbnN0IHIgPSBEZWxheWVkT3BlcmF0aW9uLmNyZWF0ZUFuZFNjaGVkdWxlKHRoaXMsIGUsIHQsIG4sIChlID0+IHRoaXMueXUoZSkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuVHUucHVzaChyKSwgcjtcbiAgICB9XG4gICAgZnUoKSB7XG4gICAgICAgIHRoaXMuRXUgJiYgZmFpbCgpO1xuICAgIH1cbiAgICB2ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCkge31cbiAgICAvKipcbiAgICAgKiBXYWl0cyB1bnRpbCBhbGwgY3VycmVudGx5IHF1ZXVlZCB0YXNrcyBhcmUgZmluaXNoZWQgZXhlY3V0aW5nLiBEZWxheWVkXG4gICAgICogb3BlcmF0aW9ucyBhcmUgbm90IHJ1bi5cbiAgICAgKi8gICAgYXN5bmMgd3UoKSB7XG4gICAgICAgIC8vIE9wZXJhdGlvbnMgaW4gdGhlIHF1ZXVlIHByaW9yIHRvIGRyYWluaW5nIG1heSBoYXZlIGVucXVldWVkIGFkZGl0aW9uYWxcbiAgICAgICAgLy8gb3BlcmF0aW9ucy4gS2VlcCBkcmFpbmluZyB0aGUgcXVldWUgdW50aWwgdGhlIHRhaWwgaXMgbm8gbG9uZ2VyIGFkdmFuY2VkLFxuICAgICAgICAvLyB3aGljaCBpbmRpY2F0ZXMgdGhhdCBubyBtb3JlIG5ldyBvcGVyYXRpb25zIHdlcmUgZW5xdWV1ZWQgYW5kIHRoYXQgYWxsXG4gICAgICAgIC8vIG9wZXJhdGlvbnMgd2VyZSBleGVjdXRlZC5cbiAgICAgICAgbGV0IGU7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGUgPSB0aGlzLm11LCBhd2FpdCBlO1xuICAgICAgICB9IHdoaWxlIChlICE9PSB0aGlzLm11KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBEZXRlcm1pbmUgaWYgYSBkZWxheWVkIG9wZXJhdGlvbiB3aXRoIGEgcGFydGljdWxhciBUaW1lcklkXG4gICAgICogZXhpc3RzLlxuICAgICAqLyAgICBTdShlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLlR1KSBpZiAodC50aW1lcklkID09PSBlKSByZXR1cm4gITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBSdW5zIHNvbWUgb3IgYWxsIGRlbGF5ZWQgb3BlcmF0aW9ucyBlYXJseS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBsYXN0VGltZXJJZCAtIERlbGF5ZWQgb3BlcmF0aW9ucyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoaXMgVGltZXJJZFxuICAgICAqIHdpbGwgYmUgZHJhaW5lZC4gUGFzcyBUaW1lcklkLkFsbCB0byBydW4gYWxsIGRlbGF5ZWQgb3BlcmF0aW9ucy5cbiAgICAgKiBAcmV0dXJucyBhIFByb21pc2UgdGhhdCByZXNvbHZlcyBvbmNlIGFsbCBvcGVyYXRpb25zIGhhdmUgYmVlbiBydW4uXG4gICAgICovICAgIGJ1KGUpIHtcbiAgICAgICAgLy8gTm90ZSB0aGF0IGRyYWluaW5nIG1heSBnZW5lcmF0ZSBtb3JlIGRlbGF5ZWQgb3BzLCBzbyB3ZSBkbyB0aGF0IGZpcnN0LlxuICAgICAgICByZXR1cm4gdGhpcy53dSgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFJ1biBvcHMgaW4gdGhlIHNhbWUgb3JkZXIgdGhleSdkIHJ1biBpZiB0aGV5IHJhbiBuYXR1cmFsbHkuXG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzICovXG4gICAgICAgICAgICB0aGlzLlR1LnNvcnQoKChlLCB0KSA9PiBlLnRhcmdldFRpbWVNcyAtIHQudGFyZ2V0VGltZU1zKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgdGhpcy5UdSkgaWYgKHQuc2tpcERlbGF5KCksIFwiYWxsXCIgLyogVGltZXJJZC5BbGwgKi8gIT09IGUgJiYgdC50aW1lcklkID09PSBlKSBicmVhaztcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnd1KCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIFRlc3RzOiBTa2lwIGFsbCBzdWJzZXF1ZW50IGRlbGF5cyBmb3IgYSB0aW1lciBpZC5cbiAgICAgKi8gICAgRHUoZSkge1xuICAgICAgICB0aGlzLlJ1LnB1c2goZSk7XG4gICAgfVxuICAgIC8qKiBDYWxsZWQgb25jZSBhIERlbGF5ZWRPcGVyYXRpb24gaXMgcnVuIG9yIGNhbmNlbGVkLiAqLyAgICB5dShlKSB7XG4gICAgICAgIC8vIE5PVEU6IGluZGV4T2YgLyBzbGljZSBhcmUgTyhuKSwgYnV0IGRlbGF5ZWRPcGVyYXRpb25zIGlzIGV4cGVjdGVkIHRvIGJlIHNtYWxsLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5UdS5pbmRleE9mKGUpO1xuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzICovICAgICAgICB0aGlzLlR1LnNwbGljZSh0LCAxKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc1BhcnRpYWxPYnNlcnZlcihlKSB7XG4gICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgb2JqIGlzIGFuIG9iamVjdCBhbmQgY29udGFpbnMgYXQgbGVhc3Qgb25lIG9mIHRoZSBzcGVjaWZpZWRcbiAqIG1ldGhvZHMuXG4gKi9cbiAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2ltcGxlbWVudHNBbnlNZXRob2RzKGUsIHQpIHtcbiAgICAgICAgaWYgKFwib2JqZWN0XCIgIT0gdHlwZW9mIGUgfHwgbnVsbCA9PT0gZSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gZTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIGlmIChlIGluIG4gJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuW2VdKSByZXR1cm4gITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAvKipcbiAqIFJlcHJlc2VudHMgdGhlIHRhc2sgb2YgbG9hZGluZyBhIEZpcmVzdG9yZSBidW5kbGUuIEl0IHByb3ZpZGVzIHByb2dyZXNzIG9mIGJ1bmRsZVxuICogbG9hZGluZywgYXMgd2VsbCBhcyB0YXNrIGNvbXBsZXRpb24gYW5kIGVycm9yIGV2ZW50cy5cbiAqXG4gKiBUaGUgQVBJIGlzIGNvbXBhdGlibGUgd2l0aCBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPmAuXG4gKi8gKGUsIFsgXCJuZXh0XCIsIFwiZXJyb3JcIiwgXCJjb21wbGV0ZVwiIF0pO1xufVxuXG5jbGFzcyBMb2FkQnVuZGxlVGFzayB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIgPSB7fSwgdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlciA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIFxuICAgICAgICB0aGlzLl9sYXN0UHJvZ3Jlc3MgPSB7XG4gICAgICAgICAgICB0YXNrU3RhdGU6IFwiUnVubmluZ1wiLFxuICAgICAgICAgICAgdG90YWxCeXRlczogMCxcbiAgICAgICAgICAgIHRvdGFsRG9jdW1lbnRzOiAwLFxuICAgICAgICAgICAgYnl0ZXNMb2FkZWQ6IDAsXG4gICAgICAgICAgICBkb2N1bWVudHNMb2FkZWQ6IDBcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGZ1bmN0aW9ucyB0byBsaXN0ZW4gdG8gYnVuZGxlIGxvYWRpbmcgcHJvZ3Jlc3MgZXZlbnRzLlxuICAgICAqIEBwYXJhbSBuZXh0IC0gQ2FsbGVkIHdoZW4gdGhlcmUgaXMgYSBwcm9ncmVzcyB1cGRhdGUgZnJvbSBidW5kbGUgbG9hZGluZy4gVHlwaWNhbGx5IGBuZXh0YCBjYWxscyBvY2N1clxuICAgICAqICAgZWFjaCB0aW1lIGEgRmlyZXN0b3JlIGRvY3VtZW50IGlzIGxvYWRlZCBmcm9tIHRoZSBidW5kbGUuXG4gICAgICogQHBhcmFtIGVycm9yIC0gQ2FsbGVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzIGR1cmluZyBidW5kbGUgbG9hZGluZy4gVGhlIHRhc2sgYWJvcnRzIGFmdGVyIHJlcG9ydGluZyB0aGVcbiAgICAgKiAgIGVycm9yLCBhbmQgdGhlcmUgc2hvdWxkIGJlIG5vIG1vcmUgdXBkYXRlcyBhZnRlciB0aGlzLlxuICAgICAqIEBwYXJhbSBjb21wbGV0ZSAtIENhbGxlZCB3aGVuIHRoZSBsb2FkaW5nIHRhc2sgaXMgY29tcGxldGUuXG4gICAgICovICAgIG9uUHJvZ3Jlc3MoZSwgdCwgbikge1xuICAgICAgICB0aGlzLl9wcm9ncmVzc09ic2VydmVyID0ge1xuICAgICAgICAgICAgbmV4dDogZSxcbiAgICAgICAgICAgIGVycm9yOiB0LFxuICAgICAgICAgICAgY29tcGxldGU6IG5cbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW1wbGVtZW50cyB0aGUgYFByb21pc2U8TG9hZEJ1bmRsZVRhc2tQcm9ncmVzcz4uY2F0Y2hgIGludGVyZmFjZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvblJlamVjdGVkIC0gQ2FsbGVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzIGR1cmluZyBidW5kbGUgbG9hZGluZy5cbiAgICAgKi8gICAgY2F0Y2goZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5wcm9taXNlLmNhdGNoKGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRzIHRoZSBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPi50aGVuYCBpbnRlcmZhY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb25GdWxmaWxsZWQgLSBDYWxsZWQgb24gdGhlIGNvbXBsZXRpb24gb2YgdGhlIGxvYWRpbmcgdGFzayB3aXRoIGEgZmluYWwgYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIHVwZGF0ZS5cbiAgICAgKiAgIFRoZSB1cGRhdGUgd2lsbCBhbHdheXMgaGF2ZSBpdHMgYHRhc2tTdGF0ZWAgc2V0IHRvIGBcIlN1Y2Nlc3NcImAuXG4gICAgICogQHBhcmFtIG9uUmVqZWN0ZWQgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLlxuICAgICAqLyAgICB0aGVuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Rhc2tDb21wbGV0aW9uUmVzb2x2ZXIucHJvbWlzZS50aGVuKGUsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBOb3RpZmllcyBhbGwgb2JzZXJ2ZXJzIHRoYXQgYnVuZGxlIGxvYWRpbmcgaGFzIGNvbXBsZXRlZCwgd2l0aCBhIHByb3ZpZGVkXG4gICAgICogYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF9jb21wbGV0ZVdpdGgoZSkge1xuICAgICAgICB0aGlzLl91cGRhdGVQcm9ncmVzcyhlKSwgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5jb21wbGV0ZSAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLmNvbXBsZXRlKCksIFxuICAgICAgICB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyLnJlc29sdmUoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGFsbCBvYnNlcnZlcnMgdGhhdCBidW5kbGUgbG9hZGluZyBoYXMgZmFpbGVkLCB3aXRoIGEgcHJvdmlkZWRcbiAgICAgKiBgRXJyb3JgIGFzIHRoZSByZWFzb24uXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqLyAgICBfZmFpbFdpdGgoZSkge1xuICAgICAgICB0aGlzLl9sYXN0UHJvZ3Jlc3MudGFza1N0YXRlID0gXCJFcnJvclwiLCB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQgJiYgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5uZXh0KHRoaXMuX2xhc3RQcm9ncmVzcyksIFxuICAgICAgICB0aGlzLl9wcm9ncmVzc09ic2VydmVyLmVycm9yICYmIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuZXJyb3IoZSksIHRoaXMuX3Rhc2tDb21wbGV0aW9uUmVzb2x2ZXIucmVqZWN0KGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBOb3RpZmllcyBhIHByb2dyZXNzIHVwZGF0ZSBvZiBsb2FkaW5nIGEgYnVuZGxlLlxuICAgICAqIEBwYXJhbSBwcm9ncmVzcyAtIFRoZSBuZXcgcHJvZ3Jlc3MuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqLyAgICBfdXBkYXRlUHJvZ3Jlc3MoZSkge1xuICAgICAgICB0aGlzLl9sYXN0UHJvZ3Jlc3MgPSBlLCB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQgJiYgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5uZXh0KGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ29uc3RhbnQgdXNlZCB0byBpbmRpY2F0ZSB0aGUgTFJVIGdhcmJhZ2UgY29sbGVjdGlvbiBzaG91bGQgYmUgZGlzYWJsZWQuXG4gKiBTZXQgdGhpcyB2YWx1ZSBhcyB0aGUgYGNhY2hlU2l6ZUJ5dGVzYCBvbiB0aGUgc2V0dGluZ3MgcGFzc2VkIHRvIHRoZVxuICoge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKi8gY29uc3QgU2UgPSAtMTtcblxuLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKi8gY2xhc3MgRmlyZXN0b3JlIGV4dGVuZHMgRmlyZXN0b3JlJDEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICBzdXBlcihlLCB0LCBuLCByKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIGl0J3MgYSB7QGxpbmsgRmlyZXN0b3JlfSBvciBGaXJlc3RvcmUgTGl0ZSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiZmlyZXN0b3JlXCIsIHRoaXMuX3F1ZXVlID0gbmV3IF9fUFJJVkFURV9Bc3luY1F1ZXVlSW1wbCwgdGhpcy5fcGVyc2lzdGVuY2VLZXkgPSAobnVsbCA9PSByID8gdm9pZCAwIDogci5uYW1lKSB8fCBcIltERUZBVUxUXVwiO1xuICAgIH1cbiAgICBhc3luYyBfdGVybWluYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5fZmlyZXN0b3JlQ2xpZW50KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5fZmlyZXN0b3JlQ2xpZW50LnRlcm1pbmF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5fcXVldWUgPSBuZXcgX19QUklWQVRFX0FzeW5jUXVldWVJbXBsKGUpLCB0aGlzLl9maXJlc3RvcmVDbGllbnQgPSB2b2lkIDAsIGF3YWl0IGU7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2Yge0BsaW5rIEZpcmVzdG9yZX0gd2l0aCB0aGUgcHJvdmlkZWQgc2V0dGluZ3MuXG4gKiBDYW4gb25seSBiZSBjYWxsZWQgYmVmb3JlIGFueSBvdGhlciBmdW5jdGlvbiwgaW5jbHVkaW5nXG4gKiB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uIElmIHRoZSBjdXN0b20gc2V0dGluZ3MgYXJlIGVtcHR5LCB0aGlzIGZ1bmN0aW9uIGlzXG4gKiBlcXVpdmFsZW50IHRvIGNhbGxpbmcge0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9LlxuICpcbiAqIEBwYXJhbSBhcHAgLSBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IHdpdGggd2hpY2ggdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHdpbGxcbiAqIGJlIGFzc29jaWF0ZWQuXG4gKiBAcGFyYW0gc2V0dGluZ3MgLSBBIHNldHRpbmdzIG9iamVjdCB0byBjb25maWd1cmUgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlLlxuICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgbmFtZSBvZiB0aGUgZGF0YWJhc2UuXG4gKiBAcmV0dXJucyBBIG5ld2x5IGluaXRpYWxpemVkIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlLlxuICovIGZ1bmN0aW9uIGluaXRpYWxpemVGaXJlc3RvcmUoZSwgdCwgbikge1xuICAgIG4gfHwgKG4gPSBcIihkZWZhdWx0KVwiKTtcbiAgICBjb25zdCByID0gX2dldFByb3ZpZGVyKGUsIFwiZmlyZXN0b3JlXCIpO1xuICAgIGlmIChyLmlzSW5pdGlhbGl6ZWQobikpIHtcbiAgICAgICAgY29uc3QgZSA9IHIuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6IG5cbiAgICAgICAgfSksIGkgPSByLmdldE9wdGlvbnMobik7XG4gICAgICAgIGlmIChkZWVwRXF1YWwoaSwgdCkpIHJldHVybiBlO1xuICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5GQUlMRURfUFJFQ09ORElUSU9OLCBcImluaXRpYWxpemVGaXJlc3RvcmUoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCB3aXRoIGRpZmZlcmVudCBvcHRpb25zLiBUbyBhdm9pZCB0aGlzIGVycm9yLCBjYWxsIGluaXRpYWxpemVGaXJlc3RvcmUoKSB3aXRoIHRoZSBzYW1lIG9wdGlvbnMgYXMgd2hlbiBpdCB3YXMgb3JpZ2luYWxseSBjYWxsZWQsIG9yIGNhbGwgZ2V0RmlyZXN0b3JlKCkgdG8gcmV0dXJuIHRoZSBhbHJlYWR5IGluaXRpYWxpemVkIGluc3RhbmNlLlwiKTtcbiAgICB9XG4gICAgaWYgKHZvaWQgMCAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiB2b2lkIDAgIT09IHQubG9jYWxDYWNoZSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJjYWNoZSBhbmQgY2FjaGVTaXplQnl0ZXMgY2Fubm90IGJlIHNwZWNpZmllZCBhdCB0aGUgc2FtZSB0aW1lIGFzIGNhY2hlU2l6ZUJ5dGVzIHdpbGxiZSBkZXByZWNhdGVkLiBJbnN0ZWFkLCBzcGVjaWZ5IHRoZSBjYWNoZSBzaXplIGluIHRoZSBjYWNoZSBvYmplY3RcIik7XG4gICAgaWYgKHZvaWQgMCAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiAtMSAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiB0LmNhY2hlU2l6ZUJ5dGVzIDwgMTA0ODU3NikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJjYWNoZVNpemVCeXRlcyBtdXN0IGJlIGF0IGxlYXN0IDEwNDg1NzZcIik7XG4gICAgcmV0dXJuIHIuaW5pdGlhbGl6ZSh7XG4gICAgICAgIG9wdGlvbnM6IHQsXG4gICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogblxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRGaXJlc3RvcmUodCwgbikge1xuICAgIGNvbnN0IHIgPSBcIm9iamVjdFwiID09IHR5cGVvZiB0ID8gdCA6IGdldEFwcCgpLCBpID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCA/IHQgOiBuIHx8IFwiKGRlZmF1bHQpXCIsIHMgPSBfZ2V0UHJvdmlkZXIociwgXCJmaXJlc3RvcmVcIikuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgaWRlbnRpZmllcjogaVxuICAgIH0pO1xuICAgIGlmICghcy5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgY29uc3QgZSA9IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydChcImZpcmVzdG9yZVwiKTtcbiAgICAgICAgZSAmJiBjb25uZWN0RmlyZXN0b3JlRW11bGF0b3IocywgLi4uZSk7XG4gICAgfVxuICAgIHJldHVybiBzO1xufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSkge1xuICAgIGlmIChlLl90ZXJtaW5hdGVkKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlRoZSBjbGllbnQgaGFzIGFscmVhZHkgYmVlbiB0ZXJtaW5hdGVkLlwiKTtcbiAgICByZXR1cm4gZS5fZmlyZXN0b3JlQ2xpZW50IHx8IF9fUFJJVkFURV9jb25maWd1cmVGaXJlc3RvcmUoZSksIGUuX2ZpcmVzdG9yZUNsaWVudDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbmZpZ3VyZUZpcmVzdG9yZShlKSB7XG4gICAgdmFyIHQsIG4sIHI7XG4gICAgY29uc3QgaSA9IGUuX2ZyZWV6ZVNldHRpbmdzKCksIHMgPSBmdW5jdGlvbiBfX1BSSVZBVEVfbWFrZURhdGFiYXNlSW5mbyhlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YWJhc2VJbmZvKGUsIHQsIG4sIHIuaG9zdCwgci5zc2wsIHIuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZywgci5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcsIF9fUFJJVkFURV9jbG9uZUxvbmdQb2xsaW5nT3B0aW9ucyhyLmV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9ucyksIHIudXNlRmV0Y2hTdHJlYW1zKTtcbiAgICB9KGUuX2RhdGFiYXNlSWQsIChudWxsID09PSAodCA9IGUuX2FwcCkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC5vcHRpb25zLmFwcElkKSB8fCBcIlwiLCBlLl9wZXJzaXN0ZW5jZUtleSwgaSk7XG4gICAgZS5fY29tcG9uZW50c1Byb3ZpZGVyIHx8IChudWxsID09PSAobiA9IGkubG9jYWxDYWNoZSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKSAmJiAobnVsbCA9PT0gKHIgPSBpLmxvY2FsQ2FjaGUpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyKSAmJiAoZS5fY29tcG9uZW50c1Byb3ZpZGVyID0ge1xuICAgICAgICBfb2ZmbGluZTogaS5sb2NhbENhY2hlLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIsXG4gICAgICAgIF9vbmxpbmU6IGkubG9jYWxDYWNoZS5fb25saW5lQ29tcG9uZW50UHJvdmlkZXJcbiAgICB9KSwgZS5fZmlyZXN0b3JlQ2xpZW50ID0gbmV3IEZpcmVzdG9yZUNsaWVudChlLl9hdXRoQ3JlZGVudGlhbHMsIGUuX2FwcENoZWNrQ3JlZGVudGlhbHMsIGUuX3F1ZXVlLCBzLCBlLl9jb21wb25lbnRzUHJvdmlkZXIgJiYgZnVuY3Rpb24gX19QUklWQVRFX2J1aWxkQ29tcG9uZW50UHJvdmlkZXIoZSkge1xuICAgICAgICBjb25zdCB0ID0gbnVsbCA9PSBlID8gdm9pZCAwIDogZS5fb25saW5lLmJ1aWxkKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfb2ZmbGluZTogbnVsbCA9PSBlID8gdm9pZCAwIDogZS5fb2ZmbGluZS5idWlsZCh0KSxcbiAgICAgICAgICAgIF9vbmxpbmU6IHRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gKiBBdHRlbXB0cyB0byBlbmFibGUgcGVyc2lzdGVudCBzdG9yYWdlLCBpZiBwb3NzaWJsZS5cbiAqXG4gKiBPbiBmYWlsdXJlLCBgZW5hYmxlSW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgd2lsbCByZWplY3QgdGhlIHByb21pc2Ugb3JcbiAqIHRocm93IGFuIGV4Y2VwdGlvbi4gVGhlcmUgYXJlIHNldmVyYWwgcmVhc29ucyB3aHkgdGhpcyBjYW4gZmFpbCwgd2hpY2ggY2FuIGJlXG4gKiBpZGVudGlmaWVkIGJ5IHRoZSBgY29kZWAgb24gdGhlIGVycm9yLlxuICpcbiAqICAgKiBmYWlsZWQtcHJlY29uZGl0aW9uOiBUaGUgYXBwIGlzIGFscmVhZHkgb3BlbiBpbiBhbm90aGVyIGJyb3dzZXIgdGFiLlxuICogICAqIHVuaW1wbGVtZW50ZWQ6IFRoZSBicm93c2VyIGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBvZmZsaW5lIHBlcnNpc3RlbmNlXG4gKiAgICAgaW1wbGVtZW50YXRpb24uXG4gKlxuICogTm90ZSB0aGF0IGV2ZW4gYWZ0ZXIgYSBmYWlsdXJlLCB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2Ugd2lsbCByZW1haW5cbiAqIHVzYWJsZSwgaG93ZXZlciBvZmZsaW5lIHBlcnNpc3RlbmNlIHdpbGwgYmUgZGlzYWJsZWQuXG4gKlxuICogTm90ZTogYGVuYWJsZUluZGV4ZWREYlBlcnNpc3RlbmNlKClgIG11c3QgYmUgY2FsbGVkIGJlZm9yZSBhbnkgb3RoZXIgZnVuY3Rpb25zXG4gKiAob3RoZXIgdGhhbiB7QGxpbmsgaW5pdGlhbGl6ZUZpcmVzdG9yZX0sIHtAbGluayAoZ2V0RmlyZXN0b3JlOjEpfSBvclxuICoge0BsaW5rIGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2V9LlxuICpcbiAqIFBlcnNpc3RlbmNlIGNhbm5vdCBiZSB1c2VkIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudC5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGVuYWJsZSBwZXJzaXN0ZW5jZSBmb3IuXG4gKiBAcGFyYW0gcGVyc2lzdGVuY2VTZXR0aW5ncyAtIE9wdGlvbmFsIHNldHRpbmdzIG9iamVjdCB0byBjb25maWd1cmVcbiAqIHBlcnNpc3RlbmNlLlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCByZXByZXNlbnRzIHN1Y2Nlc3NmdWxseSBlbmFibGluZyBwZXJzaXN0ZW50IHN0b3JhZ2UuXG4gKiBAZGVwcmVjYXRlZCBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSBtYWpvciByZWxlYXNlLiBJbnN0ZWFkLCBzZXRcbiAqIGBGaXJlc3RvcmVTZXR0aW5ncy5sb2NhbENhY2hlYCB0byBhbiBpbnN0YW5jZSBvZiBgUGVyc2lzdGVudExvY2FsQ2FjaGVgIHRvXG4gKiB0dXJuIG9uIEluZGV4ZWREYiBjYWNoZS4gQ2FsbGluZyB0aGlzIGZ1bmN0aW9uIHdoZW4gYEZpcmVzdG9yZVNldHRpbmdzLmxvY2FsQ2FjaGVgXG4gKiBpcyBhbHJlYWR5IHNwZWNpZmllZCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbi5cbiAqLyAoZS5fY29tcG9uZW50c1Byb3ZpZGVyKSk7XG59XG5cbmZ1bmN0aW9uIGVuYWJsZUluZGV4ZWREYlBlcnNpc3RlbmNlKGUsIHQpIHtcbiAgICBfX1BSSVZBVEVfbG9nV2FybihcImVuYWJsZUluZGV4ZWREYlBlcnNpc3RlbmNlKCkgd2lsbCBiZSBkZXByZWNhdGVkIGluIHRoZSBmdXR1cmUsIHlvdSBjYW4gdXNlIGBGaXJlc3RvcmVTZXR0aW5ncy5jYWNoZWAgaW5zdGVhZC5cIik7XG4gICAgY29uc3QgbiA9IGUuX2ZyZWV6ZVNldHRpbmdzKCk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9zZXRQZXJzaXN0ZW5jZVByb3ZpZGVycyhlLCBPbmxpbmVDb21wb25lbnRQcm92aWRlci5wcm92aWRlciwge1xuICAgICAgICBidWlsZDogZSA9PiBuZXcgX19QUklWQVRFX0luZGV4ZWREYk9mZmxpbmVDb21wb25lbnRQcm92aWRlcihlLCBuLmNhY2hlU2l6ZUJ5dGVzLCBudWxsID09IHQgPyB2b2lkIDAgOiB0LmZvcmNlT3duZXJzaGlwKVxuICAgIH0pLCBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBlbmFibGUgbXVsdGktdGFiIHBlcnNpc3RlbnQgc3RvcmFnZSwgaWYgcG9zc2libGUuIElmIGVuYWJsZWRcbiAqIGFjcm9zcyBhbGwgdGFicywgYWxsIG9wZXJhdGlvbnMgc2hhcmUgYWNjZXNzIHRvIGxvY2FsIHBlcnNpc3RlbmNlLCBpbmNsdWRpbmdcbiAqIHNoYXJlZCBleGVjdXRpb24gb2YgcXVlcmllcyBhbmQgbGF0ZW5jeS1jb21wZW5zYXRlZCBsb2NhbCBkb2N1bWVudCB1cGRhdGVzXG4gKiBhY3Jvc3MgYWxsIGNvbm5lY3RlZCBpbnN0YW5jZXMuXG4gKlxuICogT24gZmFpbHVyZSwgYGVuYWJsZU11bHRpVGFiSW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgd2lsbCByZWplY3QgdGhlIHByb21pc2Ugb3JcbiAqIHRocm93IGFuIGV4Y2VwdGlvbi4gVGhlcmUgYXJlIHNldmVyYWwgcmVhc29ucyB3aHkgdGhpcyBjYW4gZmFpbCwgd2hpY2ggY2FuIGJlXG4gKiBpZGVudGlmaWVkIGJ5IHRoZSBgY29kZWAgb24gdGhlIGVycm9yLlxuICpcbiAqICAgKiBmYWlsZWQtcHJlY29uZGl0aW9uOiBUaGUgYXBwIGlzIGFscmVhZHkgb3BlbiBpbiBhbm90aGVyIGJyb3dzZXIgdGFiIGFuZFxuICogICAgIG11bHRpLXRhYiBpcyBub3QgZW5hYmxlZC5cbiAqICAgKiB1bmltcGxlbWVudGVkOiBUaGUgYnJvd3NlciBpcyBpbmNvbXBhdGlibGUgd2l0aCB0aGUgb2ZmbGluZSBwZXJzaXN0ZW5jZVxuICogICAgIGltcGxlbWVudGF0aW9uLlxuICpcbiAqIE5vdGUgdGhhdCBldmVuIGFmdGVyIGEgZmFpbHVyZSwgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHdpbGwgcmVtYWluXG4gKiB1c2FibGUsIGhvd2V2ZXIgb2ZmbGluZSBwZXJzaXN0ZW5jZSB3aWxsIGJlIGRpc2FibGVkLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gZW5hYmxlIHBlcnNpc3RlbmNlIGZvci5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVwcmVzZW50cyBzdWNjZXNzZnVsbHkgZW5hYmxpbmcgcGVyc2lzdGVudFxuICogc3RvcmFnZS5cbiAqIEBkZXByZWNhdGVkIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIG1ham9yIHJlbGVhc2UuIEluc3RlYWQsIHNldFxuICogYEZpcmVzdG9yZVNldHRpbmdzLmxvY2FsQ2FjaGVgIHRvIGFuIGluc3RhbmNlIG9mIGBQZXJzaXN0ZW50TG9jYWxDYWNoZWAgdG9cbiAqIHR1cm4gb24gaW5kZXhlZGRiIGNhY2hlLiBDYWxsaW5nIHRoaXMgZnVuY3Rpb24gd2hlbiBgRmlyZXN0b3JlU2V0dGluZ3MubG9jYWxDYWNoZWBcbiAqIGlzIGFscmVhZHkgc3BlY2lmaWVkIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uLlxuICovIGFzeW5jIGZ1bmN0aW9uIGVuYWJsZU11bHRpVGFiSW5kZXhlZERiUGVyc2lzdGVuY2UoZSkge1xuICAgIF9fUFJJVkFURV9sb2dXYXJuKFwiZW5hYmxlTXVsdGlUYWJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpIHdpbGwgYmUgZGVwcmVjYXRlZCBpbiB0aGUgZnV0dXJlLCB5b3UgY2FuIHVzZSBgRmlyZXN0b3JlU2V0dGluZ3MuY2FjaGVgIGluc3RlYWQuXCIpO1xuICAgIGNvbnN0IHQgPSBlLl9mcmVlemVTZXR0aW5ncygpO1xuICAgIF9fUFJJVkFURV9zZXRQZXJzaXN0ZW5jZVByb3ZpZGVycyhlLCBPbmxpbmVDb21wb25lbnRQcm92aWRlci5wcm92aWRlciwge1xuICAgICAgICBidWlsZDogZSA9PiBuZXcgX19QUklWQVRFX011bHRpVGFiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIHQuY2FjaGVTaXplQnl0ZXMpXG4gICAgfSk7XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGJvdGggdGhlIGBPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXJgIGFuZCBgT25saW5lQ29tcG9uZW50UHJvdmlkZXJgLlxuICogSWYgdGhlIG9wZXJhdGlvbiBmYWlscyB3aXRoIGEgcmVjb3ZlcmFibGUgZXJyb3IgKHNlZVxuICogYGNhblJlY292ZXJGcm9tSW5kZXhlZERiRXJyb3IoKWAgYmVsb3cpLCB0aGUgcmV0dXJuZWQgUHJvbWlzZSBpcyByZWplY3RlZFxuICogYnV0IHRoZSBjbGllbnQgcmVtYWlucyB1c2FibGUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3NldFBlcnNpc3RlbmNlUHJvdmlkZXJzKGUsIHQsIG4pIHtcbiAgICBpZiAoKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKS5fZmlyZXN0b3JlQ2xpZW50IHx8IGUuX3Rlcm1pbmF0ZWQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELkZBSUxFRF9QUkVDT05ESVRJT04sIFwiRmlyZXN0b3JlIGhhcyBhbHJlYWR5IGJlZW4gc3RhcnRlZCBhbmQgcGVyc2lzdGVuY2UgY2FuIG5vIGxvbmdlciBiZSBlbmFibGVkLiBZb3UgY2FuIG9ubHkgZW5hYmxlIHBlcnNpc3RlbmNlIGJlZm9yZSBjYWxsaW5nIGFueSBvdGhlciBtZXRob2RzIG9uIGEgRmlyZXN0b3JlIG9iamVjdC5cIik7XG4gICAgaWYgKGUuX2NvbXBvbmVudHNQcm92aWRlciB8fCBlLl9nZXRTZXR0aW5ncygpLmxvY2FsQ2FjaGUpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELkZBSUxFRF9QUkVDT05ESVRJT04sIFwiU0RLIGNhY2hlIGlzIGFscmVhZHkgc3BlY2lmaWVkLlwiKTtcbiAgICBlLl9jb21wb25lbnRzUHJvdmlkZXIgPSB7XG4gICAgICAgIF9vbmxpbmU6IHQsXG4gICAgICAgIF9vZmZsaW5lOiBuXG4gICAgfSwgX19QUklWQVRFX2NvbmZpZ3VyZUZpcmVzdG9yZShlKTtcbn1cblxuLyoqXG4gKiBDbGVhcnMgdGhlIHBlcnNpc3RlbnQgc3RvcmFnZS4gVGhpcyBpbmNsdWRlcyBwZW5kaW5nIHdyaXRlcyBhbmQgY2FjaGVkXG4gKiBkb2N1bWVudHMuXG4gKlxuICogTXVzdCBiZSBjYWxsZWQgd2hpbGUgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIGlzIG5vdCBzdGFydGVkIChhZnRlciB0aGUgYXBwIGlzXG4gKiB0ZXJtaW5hdGVkIG9yIHdoZW4gdGhlIGFwcCBpcyBmaXJzdCBpbml0aWFsaXplZCkuIE9uIHN0YXJ0dXAsIHRoaXMgZnVuY3Rpb25cbiAqIG11c3QgYmUgY2FsbGVkIGJlZm9yZSBvdGhlciBmdW5jdGlvbnMgKG90aGVyIHRoYW4ge0BsaW5rXG4gKiBpbml0aWFsaXplRmlyZXN0b3JlfSBvciB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0pKS4gSWYgdGhlIHtAbGluayBGaXJlc3RvcmV9XG4gKiBpbnN0YW5jZSBpcyBzdGlsbCBydW5uaW5nLCB0aGUgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIHdpdGggdGhlIGVycm9yIGNvZGVcbiAqIG9mIGBmYWlsZWQtcHJlY29uZGl0aW9uYC5cbiAqXG4gKiBOb3RlOiBgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCBpcyBwcmltYXJpbHkgaW50ZW5kZWQgdG8gaGVscCB3cml0ZVxuICogcmVsaWFibGUgdGVzdHMgdGhhdCB1c2UgQ2xvdWQgRmlyZXN0b3JlLiBJdCB1c2VzIGFuIGVmZmljaWVudCBtZWNoYW5pc20gZm9yXG4gKiBkcm9wcGluZyBleGlzdGluZyBkYXRhIGJ1dCBkb2VzIG5vdCBhdHRlbXB0IHRvIHNlY3VyZWx5IG92ZXJ3cml0ZSBvclxuICogb3RoZXJ3aXNlIG1ha2UgY2FjaGVkIGRhdGEgdW5yZWNvdmVyYWJsZS4gRm9yIGFwcGxpY2F0aW9ucyB0aGF0IGFyZSBzZW5zaXRpdmVcbiAqIHRvIHRoZSBkaXNjbG9zdXJlIG9mIGNhY2hlZCBkYXRhIGluIGJldHdlZW4gdXNlciBzZXNzaW9ucywgd2Ugc3Ryb25nbHlcbiAqIHJlY29tbWVuZCBub3QgZW5hYmxpbmcgcGVyc2lzdGVuY2UgYXQgYWxsLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gY2xlYXIgcGVyc2lzdGVuY2UgZm9yLlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCB3aGVuIHRoZSBwZXJzaXN0ZW50IHN0b3JhZ2UgaXNcbiAqIGNsZWFyZWQuIE90aGVyd2lzZSwgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQgd2l0aCBhbiBlcnJvci5cbiAqLyBmdW5jdGlvbiBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlKGUpIHtcbiAgICBpZiAoZS5faW5pdGlhbGl6ZWQgJiYgIWUuX3Rlcm1pbmF0ZWQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELkZBSUxFRF9QUkVDT05ESVRJT04sIFwiUGVyc2lzdGVuY2UgY2FuIG9ubHkgYmUgY2xlYXJlZCBiZWZvcmUgYSBGaXJlc3RvcmUgaW5zdGFuY2UgaXMgaW5pdGlhbGl6ZWQgb3IgYWZ0ZXIgaXQgaXMgdGVybWluYXRlZC5cIik7XG4gICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgcmV0dXJuIGUuX3F1ZXVlLmVucXVldWVBbmRGb3JnZXRFdmVuV2hpbGVSZXN0cmljdGVkKChhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhlZERiQ2xlYXJQZXJzaXN0ZW5jZShlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFfX1BSSVZBVEVfU2ltcGxlRGIuRCgpKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGUgKyBcIm1haW5cIjtcbiAgICAgICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfU2ltcGxlRGIuZGVsZXRlKHQpO1xuICAgICAgICAgICAgfShfX1BSSVZBVEVfaW5kZXhlZERiU3RvcmFnZVByZWZpeChlLl9kYXRhYmFzZUlkLCBlLl9wZXJzaXN0ZW5jZUtleSkpLCB0LnJlc29sdmUoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdC5yZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICB9KSksIHQucHJvbWlzZTtcbn1cblxuLyoqXG4gKiBXYWl0cyB1bnRpbCBhbGwgY3VycmVudGx5IHBlbmRpbmcgd3JpdGVzIGZvciB0aGUgYWN0aXZlIHVzZXIgaGF2ZSBiZWVuXG4gKiBhY2tub3dsZWRnZWQgYnkgdGhlIGJhY2tlbmQuXG4gKlxuICogVGhlIHJldHVybmVkIHByb21pc2UgcmVzb2x2ZXMgaW1tZWRpYXRlbHkgaWYgdGhlcmUgYXJlIG5vIG91dHN0YW5kaW5nIHdyaXRlcy5cbiAqIE90aGVyd2lzZSwgdGhlIHByb21pc2Ugd2FpdHMgZm9yIGFsbCBwcmV2aW91c2x5IGlzc3VlZCB3cml0ZXMgKGluY2x1ZGluZ1xuICogdGhvc2Ugd3JpdHRlbiBpbiBhIHByZXZpb3VzIGFwcCBzZXNzaW9uKSwgYnV0IGl0IGRvZXMgbm90IHdhaXQgZm9yIHdyaXRlc1xuICogdGhhdCB3ZXJlIGFkZGVkIGFmdGVyIHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQuIElmIHlvdSB3YW50IHRvIHdhaXQgZm9yXG4gKiBhZGRpdGlvbmFsIHdyaXRlcywgY2FsbCBgd2FpdEZvclBlbmRpbmdXcml0ZXMoKWAgYWdhaW4uXG4gKlxuICogQW55IG91dHN0YW5kaW5nIGB3YWl0Rm9yUGVuZGluZ1dyaXRlcygpYCBwcm9taXNlcyBhcmUgcmVqZWN0ZWQgZHVyaW5nIHVzZXJcbiAqIGNoYW5nZXMuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgd2hpY2ggcmVzb2x2ZXMgd2hlbiBhbGwgY3VycmVudGx5IHBlbmRpbmcgd3JpdGVzIGhhdmUgYmVlblxuICogYWNrbm93bGVkZ2VkIGJ5IHRoZSBiYWNrZW5kLlxuICovIGZ1bmN0aW9uIHdhaXRGb3JQZW5kaW5nV3JpdGVzKGUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFdhaXRGb3JQZW5kaW5nV3JpdGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gX19QUklWQVRFX3N5bmNFbmdpbmVSZWdpc3RlclBlbmRpbmdXcml0ZXNDYWxsYmFjayhhd2FpdCBfX1BSSVZBVEVfZ2V0U3luY0VuZ2luZShlKSwgdCkpKSwgXG4gICAgICAgIHQucHJvbWlzZTtcbiAgICB9KGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpKTtcbn1cblxuLyoqXG4gKiBSZS1lbmFibGVzIHVzZSBvZiB0aGUgbmV0d29yayBmb3IgdGhpcyB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSBhZnRlciBhIHByaW9yXG4gKiBjYWxsIHRvIHtAbGluayBkaXNhYmxlTmV0d29ya30uXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCBvbmNlIHRoZSBuZXR3b3JrIGhhcyBiZWVuIGVuYWJsZWQuXG4gKi8gZnVuY3Rpb24gZW5hYmxlTmV0d29yayhlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRFbmFibGVOZXR3b3JrKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpKTtcbn1cblxuLyoqXG4gKiBEaXNhYmxlcyBuZXR3b3JrIHVzYWdlIGZvciB0aGlzIGluc3RhbmNlLiBJdCBjYW4gYmUgcmUtZW5hYmxlZCB2aWEge0BsaW5rXG4gKiBlbmFibGVOZXR3b3JrfS4gV2hpbGUgdGhlIG5ldHdvcmsgaXMgZGlzYWJsZWQsIGFueSBzbmFwc2hvdCBsaXN0ZW5lcnMsXG4gKiBgZ2V0RG9jKClgIG9yIGBnZXREb2NzKClgIGNhbGxzIHdpbGwgcmV0dXJuIHJlc3VsdHMgZnJvbSBjYWNoZSwgYW5kIGFueSB3cml0ZVxuICogb3BlcmF0aW9ucyB3aWxsIGJlIHF1ZXVlZCB1bnRpbCB0aGUgbmV0d29yayBpcyByZXN0b3JlZC5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIG9uY2UgdGhlIG5ldHdvcmsgaGFzIGJlZW4gZGlzYWJsZWQuXG4gKi8gZnVuY3Rpb24gZGlzYWJsZU5ldHdvcmsoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50RGlzYWJsZU5ldHdvcmsoZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSkpO1xufVxuXG4vKipcbiAqIFRlcm1pbmF0ZXMgdGhlIHByb3ZpZGVkIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlLlxuICpcbiAqIEFmdGVyIGNhbGxpbmcgYHRlcm1pbmF0ZSgpYCBvbmx5IHRoZSBgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCBmdW5jdGlvblxuICogbWF5IGJlIHVzZWQuIEFueSBvdGhlciBmdW5jdGlvbiB3aWxsIHRocm93IGEgYEZpcmVzdG9yZUVycm9yYC5cbiAqXG4gKiBUbyByZXN0YXJ0IGFmdGVyIHRlcm1pbmF0aW9uLCBjcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgRmlyZWJhc2VGaXJlc3RvcmUgd2l0aFxuICoge0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9LlxuICpcbiAqIFRlcm1pbmF0aW9uIGRvZXMgbm90IGNhbmNlbCBhbnkgcGVuZGluZyB3cml0ZXMsIGFuZCBhbnkgcHJvbWlzZXMgdGhhdCBhcmVcbiAqIGF3YWl0aW5nIGEgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyIHdpbGwgbm90IGJlIHJlc29sdmVkLiBJZiB5b3UgaGF2ZVxuICogcGVyc2lzdGVuY2UgZW5hYmxlZCwgdGhlIG5leHQgdGltZSB5b3Ugc3RhcnQgdGhpcyBpbnN0YW5jZSwgaXQgd2lsbCByZXN1bWVcbiAqIHNlbmRpbmcgdGhlc2Ugd3JpdGVzIHRvIHRoZSBzZXJ2ZXIuXG4gKlxuICogTm90ZTogVW5kZXIgbm9ybWFsIGNpcmN1bXN0YW5jZXMsIGNhbGxpbmcgYHRlcm1pbmF0ZSgpYCBpcyBub3QgcmVxdWlyZWQuIFRoaXNcbiAqIGZ1bmN0aW9uIGlzIHVzZWZ1bCBvbmx5IHdoZW4geW91IHdhbnQgdG8gZm9yY2UgdGhpcyBpbnN0YW5jZSB0byByZWxlYXNlIGFsbFxuICogb2YgaXRzIHJlc291cmNlcyBvciBpbiBjb21iaW5hdGlvbiB3aXRoIGBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlKClgIHRvXG4gKiBlbnN1cmUgdGhhdCBhbGwgbG9jYWwgc3RhdGUgaXMgZGVzdHJveWVkIGJldHdlZW4gdGVzdCBydW5zLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgd2hlbiB0aGUgaW5zdGFuY2UgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5XG4gKiB0ZXJtaW5hdGVkLlxuICovIGZ1bmN0aW9uIHRlcm1pbmF0ZShlKSB7XG4gICAgcmV0dXJuIF9yZW1vdmVTZXJ2aWNlSW5zdGFuY2UoZS5hcHAsIFwiZmlyZXN0b3JlXCIsIGUuX2RhdGFiYXNlSWQuZGF0YWJhc2UpLCBlLl9kZWxldGUoKTtcbn1cblxuLyoqXG4gKiBMb2FkcyBhIEZpcmVzdG9yZSBidW5kbGUgaW50byB0aGUgbG9jYWwgY2FjaGUuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIFRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB0byBsb2FkIGJ1bmRsZXMgZm9yLlxuICogQHBhcmFtIGJ1bmRsZURhdGEgLSBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBidW5kbGUgdG8gYmUgbG9hZGVkLiBWYWxpZFxuICogb2JqZWN0cyBhcmUgYEFycmF5QnVmZmVyYCwgYFJlYWRhYmxlU3RyZWFtPFVpbnQ4QXJyYXk+YCBvciBgc3RyaW5nYC5cbiAqXG4gKiBAcmV0dXJucyBBIGBMb2FkQnVuZGxlVGFza2Agb2JqZWN0LCB3aGljaCBub3RpZmllcyBjYWxsZXJzIHdpdGggcHJvZ3Jlc3NcbiAqIHVwZGF0ZXMsIGFuZCBjb21wbGV0aW9uIG9yIGVycm9yIGV2ZW50cy4gSXQgY2FuIGJlIHVzZWQgYXMgYVxuICogYFByb21pc2U8TG9hZEJ1bmRsZVRhc2tQcm9ncmVzcz5gLlxuICovIGZ1bmN0aW9uIGxvYWRCdW5kbGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKSwgciA9IG5ldyBMb2FkQnVuZGxlVGFzaztcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudExvYWRCdW5kbGUobiwgZS5fZGF0YWJhc2VJZCwgdCwgciksIHI7XG59XG5cbi8qKlxuICogUmVhZHMgYSBGaXJlc3RvcmUge0BsaW5rIFF1ZXJ5fSBmcm9tIGxvY2FsIGNhY2hlLCBpZGVudGlmaWVkIGJ5IHRoZSBnaXZlblxuICogbmFtZS5cbiAqXG4gKiBUaGUgbmFtZWQgcXVlcmllcyBhcmUgcGFja2FnZWQgIGludG8gYnVuZGxlcyBvbiB0aGUgc2VydmVyIHNpZGUgKGFsb25nXG4gKiB3aXRoIHJlc3VsdGluZyBkb2N1bWVudHMpLCBhbmQgbG9hZGVkIHRvIGxvY2FsIGNhY2hlIHVzaW5nIGBsb2FkQnVuZGxlYC4gT25jZVxuICogaW4gbG9jYWwgY2FjaGUsIHVzZSB0aGlzIG1ldGhvZCB0byBleHRyYWN0IGEge0BsaW5rIFF1ZXJ5fSBieSBuYW1lLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gcmVhZCB0aGUgcXVlcnkgZnJvbS5cbiAqIEBwYXJhbSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHF1ZXJ5LlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCB3aXRoIHRoZSBRdWVyeSBvciBgbnVsbGAuXG4gKi8gZnVuY3Rpb24gbmFtZWRRdWVyeShlLCB0KSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXROYW1lZFF1ZXJ5KGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpLCB0KS50aGVuKCh0ID0+IHQgPyBuZXcgUXVlcnkoZSwgbnVsbCwgdC5xdWVyeSkgOiBudWxsKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGFuIGFnZ3JlZ2F0aW9uIHRoYXQgY2FuIGJlIHBlcmZvcm1lZCBieSBGaXJlc3RvcmUuXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbmNsYXNzIEFnZ3JlZ2F0ZUZpZWxkIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgQWdncmVnYXRlRmllbGQ8VD5cbiAgICAgKiBAcGFyYW0gYWdncmVnYXRlVHlwZSBTcGVjaWZpZXMgdGhlIHR5cGUgb2YgYWdncmVnYXRpb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0uXG4gICAgICogQHBhcmFtIF9pbnRlcm5hbEZpZWxkUGF0aCBPcHRpb25hbGx5IHNwZWNpZmllcyB0aGUgZmllbGQgdGhhdCBpcyBhZ2dyZWdhdGVkLlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUgPSBcImNvdW50XCIsIHQpIHtcbiAgICAgICAgdGhpcy5faW50ZXJuYWxGaWVsZFBhdGggPSB0LCBcbiAgICAgICAgLyoqIEEgdHlwZSBzdHJpbmcgdG8gdW5pcXVlbHkgaWRlbnRpZnkgaW5zdGFuY2VzIG9mIHRoaXMgY2xhc3MuICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiQWdncmVnYXRlRmllbGRcIiwgdGhpcy5hZ2dyZWdhdGVUeXBlID0gZTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIHJlc3VsdHMgb2YgZXhlY3V0aW5nIGFuIGFnZ3JlZ2F0aW9uIHF1ZXJ5LlxuICovIGNsYXNzIEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3Qge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICB0aGlzLl91c2VyRGF0YVdyaXRlciA9IHQsIHRoaXMuX2RhdGEgPSBuLCBcbiAgICAgICAgLyoqIEEgdHlwZSBzdHJpbmcgdG8gdW5pcXVlbHkgaWRlbnRpZnkgaW5zdGFuY2VzIG9mIHRoaXMgY2xhc3MuICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiQWdncmVnYXRlUXVlcnlTbmFwc2hvdFwiLCB0aGlzLnF1ZXJ5ID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgcmVzdWx0cyBvZiB0aGUgYWdncmVnYXRpb25zIHBlcmZvcm1lZCBvdmVyIHRoZSB1bmRlcmx5aW5nXG4gICAgICogcXVlcnkuXG4gICAgICpcbiAgICAgKiBUaGUga2V5cyBvZiB0aGUgcmV0dXJuZWQgb2JqZWN0IHdpbGwgYmUgdGhlIHNhbWUgYXMgdGhvc2Ugb2YgdGhlXG4gICAgICogYEFnZ3JlZ2F0ZVNwZWNgIG9iamVjdCBzcGVjaWZpZWQgdG8gdGhlIGFnZ3JlZ2F0aW9uIG1ldGhvZCwgYW5kIHRoZSB2YWx1ZXNcbiAgICAgKiB3aWxsIGJlIHRoZSBjb3JyZXNwb25kaW5nIGFnZ3JlZ2F0aW9uIHJlc3VsdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSByZXN1bHRzIG9mIHRoZSBhZ2dyZWdhdGlvbnMgcGVyZm9ybWVkIG92ZXIgdGhlIHVuZGVybHlpbmdcbiAgICAgKiBxdWVyeS5cbiAgICAgKi8gICAgZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRPYmplY3RNYXAodGhpcy5fZGF0YSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbW11dGFibGUgb2JqZWN0IHJlcHJlc2VudGluZyBhbiBhcnJheSBvZiBieXRlcy5cbiAqLyBjbGFzcyBCeXRlcyB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuX2J5dGVTdHJpbmcgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGBCeXRlc2Agb2JqZWN0IGZyb20gdGhlIGdpdmVuIEJhc2U2NCBzdHJpbmcsIGNvbnZlcnRpbmcgaXQgdG9cbiAgICAgKiBieXRlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBiYXNlNjQgLSBUaGUgQmFzZTY0IHN0cmluZyB1c2VkIHRvIGNyZWF0ZSB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHN0YXRpYyBmcm9tQmFzZTY0U3RyaW5nKGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZXMoQnl0ZVN0cmluZy5mcm9tQmFzZTY0U3RyaW5nKGUpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJGYWlsZWQgdG8gY29uc3RydWN0IGRhdGEgZnJvbSBCYXNlNjQgc3RyaW5nOiBcIiArIGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgYEJ5dGVzYCBvYmplY3QgZnJvbSB0aGUgZ2l2ZW4gVWludDhBcnJheS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhcnJheSAtIFRoZSBVaW50OEFycmF5IHVzZWQgdG8gY3JlYXRlIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21VaW50OEFycmF5KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCeXRlcyhCeXRlU3RyaW5nLmZyb21VaW50OEFycmF5KGUpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdW5kZXJseWluZyBieXRlcyBhcyBhIEJhc2U2NC1lbmNvZGVkIHN0cmluZy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcgY3JlYXRlZCBmcm9tIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgdG9CYXNlNjQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ieXRlU3RyaW5nLnRvQmFzZTY0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHVuZGVybHlpbmcgYnl0ZXMgaW4gYSBuZXcgYFVpbnQ4QXJyYXlgLlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIFVpbnQ4QXJyYXkgY3JlYXRlZCBmcm9tIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgdG9VaW50OEFycmF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZVN0cmluZy50b1VpbnQ4QXJyYXkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gXCJCeXRlcyhiYXNlNjQ6IFwiICsgdGhpcy50b0Jhc2U2NCgpICsgXCIpXCI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBCeXRlc2Agb2JqZWN0IGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgYEJ5dGVzYCBvYmplY3QgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgQnl0ZXNgIG9iamVjdCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J5dGVTdHJpbmcuaXNFcXVhbChlLl9ieXRlU3RyaW5nKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYEZpZWxkUGF0aGAgcmVmZXJzIHRvIGEgZmllbGQgaW4gYSBkb2N1bWVudC4gVGhlIHBhdGggbWF5IGNvbnNpc3Qgb2YgYVxuICogc2luZ2xlIGZpZWxkIG5hbWUgKHJlZmVycmluZyB0byBhIHRvcC1sZXZlbCBmaWVsZCBpbiB0aGUgZG9jdW1lbnQpLCBvciBhXG4gKiBsaXN0IG9mIGZpZWxkIG5hbWVzIChyZWZlcnJpbmcgdG8gYSBuZXN0ZWQgZmllbGQgaW4gdGhlIGRvY3VtZW50KS5cbiAqXG4gKiBDcmVhdGUgYSBgRmllbGRQYXRoYCBieSBwcm92aWRpbmcgZmllbGQgbmFtZXMuIElmIG1vcmUgdGhhbiBvbmUgZmllbGRcbiAqIG5hbWUgaXMgcHJvdmlkZWQsIHRoZSBwYXRoIHdpbGwgcG9pbnQgdG8gYSBuZXN0ZWQgZmllbGQgaW4gYSBkb2N1bWVudC5cbiAqLyBjbGFzcyBGaWVsZFBhdGgge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBgRmllbGRQYXRoYCBmcm9tIHRoZSBwcm92aWRlZCBmaWVsZCBuYW1lcy4gSWYgbW9yZSB0aGFuIG9uZSBmaWVsZFxuICAgICAqIG5hbWUgaXMgcHJvdmlkZWQsIHRoZSBwYXRoIHdpbGwgcG9pbnQgdG8gYSBuZXN0ZWQgZmllbGQgaW4gYSBkb2N1bWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWVsZE5hbWVzIC0gQSBsaXN0IG9mIGZpZWxkIG5hbWVzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKC4uLmUpIHtcbiAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCBlLmxlbmd0aDsgKyt0KSBpZiAoMCA9PT0gZVt0XS5sZW5ndGgpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiSW52YWxpZCBmaWVsZCBuYW1lIGF0IGFyZ3VtZW50ICQoaSArIDEpLiBGaWVsZCBuYW1lcyBtdXN0IG5vdCBiZSBlbXB0eS5cIik7XG4gICAgICAgIHRoaXMuX2ludGVybmFsUGF0aCA9IG5ldyBGaWVsZFBhdGgkMShlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgYEZpZWxkUGF0aGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgRmllbGRQYXRoYCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBGaWVsZFBhdGhgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICovICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJuYWxQYXRoLmlzRXF1YWwoZS5faW50ZXJuYWxQYXRoKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNwZWNpYWwgc2VudGluZWwgYEZpZWxkUGF0aGAgdG8gcmVmZXIgdG8gdGhlIElEIG9mIGEgZG9jdW1lbnQuXG4gKiBJdCBjYW4gYmUgdXNlZCBpbiBxdWVyaWVzIHRvIHNvcnQgb3IgZmlsdGVyIGJ5IHRoZSBkb2N1bWVudCBJRC5cbiAqLyBmdW5jdGlvbiBkb2N1bWVudElkKCkge1xuICAgIHJldHVybiBuZXcgRmllbGRQYXRoKFwiX19uYW1lX19cIik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNlbnRpbmVsIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gd3JpdGluZyBkb2N1bWVudCBmaWVsZHMgd2l0aCBgc2V0KClgXG4gKiBvciBgdXBkYXRlKClgLlxuICovIGNsYXNzIEZpZWxkVmFsdWUge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBfbWV0aG9kTmFtZSAtIFRoZSBwdWJsaWMgQVBJIGVuZHBvaW50IHRoYXQgcmV0dXJucyB0aGlzIGNsYXNzLlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuX21ldGhvZE5hbWUgPSBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW1tdXRhYmxlIG9iamVjdCByZXByZXNlbnRpbmcgYSBnZW9ncmFwaGljIGxvY2F0aW9uIGluIEZpcmVzdG9yZS4gVGhlXG4gKiBsb2NhdGlvbiBpcyByZXByZXNlbnRlZCBhcyBsYXRpdHVkZS9sb25naXR1ZGUgcGFpci5cbiAqXG4gKiBMYXRpdHVkZSB2YWx1ZXMgYXJlIGluIHRoZSByYW5nZSBvZiBbLTkwLCA5MF0uXG4gKiBMb25naXR1ZGUgdmFsdWVzIGFyZSBpbiB0aGUgcmFuZ2Ugb2YgWy0xODAsIDE4MF0uXG4gKi8gY2xhc3MgR2VvUG9pbnQge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW1tdXRhYmxlIGBHZW9Qb2ludGAgb2JqZWN0IHdpdGggdGhlIHByb3ZpZGVkIGxhdGl0dWRlIGFuZFxuICAgICAqIGxvbmdpdHVkZSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIGxhdGl0dWRlIC0gVGhlIGxhdGl0dWRlIGFzIG51bWJlciBiZXR3ZWVuIC05MCBhbmQgOTAuXG4gICAgICogQHBhcmFtIGxvbmdpdHVkZSAtIFRoZSBsb25naXR1ZGUgYXMgbnVtYmVyIGJldHdlZW4gLTE4MCBhbmQgMTgwLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgaWYgKCFpc0Zpbml0ZShlKSB8fCBlIDwgLTkwIHx8IGUgPiA5MCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJMYXRpdHVkZSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gLTkwIGFuZCA5MCwgYnV0IHdhczogXCIgKyBlKTtcbiAgICAgICAgaWYgKCFpc0Zpbml0ZSh0KSB8fCB0IDwgLTE4MCB8fCB0ID4gMTgwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBcIkxvbmdpdHVkZSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gLTE4MCBhbmQgMTgwLCBidXQgd2FzOiBcIiArIHQpO1xuICAgICAgICB0aGlzLl9sYXQgPSBlLCB0aGlzLl9sb25nID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGxhdGl0dWRlIG9mIHRoaXMgYEdlb1BvaW50YCBpbnN0YW5jZS5cbiAgICAgKi8gICAgZ2V0IGxhdGl0dWRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGF0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgbG9uZ2l0dWRlIG9mIHRoaXMgYEdlb1BvaW50YCBpbnN0YW5jZS5cbiAgICAgKi8gICAgZ2V0IGxvbmdpdHVkZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvbmc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBHZW9Qb2ludGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgR2VvUG9pbnRgIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYEdlb1BvaW50YCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xhdCA9PT0gZS5fbGF0ICYmIHRoaXMuX2xvbmcgPT09IGUuX2xvbmc7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBHZW9Qb2ludC4gKi8gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGF0aXR1ZGU6IHRoaXMuX2xhdCxcbiAgICAgICAgICAgIGxvbmdpdHVkZTogdGhpcy5fbG9uZ1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBY3R1YWxseSBwcml2YXRlIHRvIEpTIGNvbnN1bWVycyBvZiBvdXIgQVBJLCBzbyB0aGlzIGZ1bmN0aW9uIGlzIHByZWZpeGVkXG4gICAgICogd2l0aCBhbiB1bmRlcnNjb3JlLlxuICAgICAqLyAgICBfY29tcGFyZVRvKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHRoaXMuX2xhdCwgZS5fbGF0KSB8fCBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcih0aGlzLl9sb25nLCBlLl9sb25nKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDI0IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSB2ZWN0b3IgdHlwZSBpbiBGaXJlc3RvcmUgZG9jdW1lbnRzLlxuICogQ3JlYXRlIGFuIGluc3RhbmNlIHdpdGgge0BsaW5rIEZpZWxkVmFsdWUudmVjdG9yfS5cbiAqXG4gKiBAY2xhc3MgVmVjdG9yVmFsdWVcbiAqLyBjbGFzcyBWZWN0b3JWYWx1ZSB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIC8vIE1ha2luZyBhIGNvcHkgb2YgdGhlIHBhcmFtZXRlci5cbiAgICAgICAgdGhpcy5fdmFsdWVzID0gKGUgfHwgW10pLm1hcCgoZSA9PiBlKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSByYXcgbnVtYmVyIGFycmF5IGZvcm0gb2YgdGhlIHZlY3Rvci5cbiAgICAgKi8gICAgdG9BcnJheSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlcy5tYXAoKGUgPT4gZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdHdvIFZlY3RvclZhbHVlIGhhcyB0aGUgc2FtZSByYXcgbnVtYmVyIGFycmF5cywgcmV0dXJucyBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfaXNQcmltaXRpdmVBcnJheUVxdWFsKGUsIHQpIHtcbiAgICAgICAgICAgIGlmIChlLmxlbmd0aCAhPT0gdC5sZW5ndGgpIHJldHVybiAhMTtcbiAgICAgICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGg7ICsrbikgaWYgKGVbbl0gIT09IHRbbl0pIHJldHVybiAhMTtcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgfSh0aGlzLl92YWx1ZXMsIGUuX3ZhbHVlcyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBiZSA9IC9eX18uKl9fJC87XG5cbi8qKiBUaGUgcmVzdWx0IG9mIHBhcnNpbmcgZG9jdW1lbnQgZGF0YSAoZS5nLiBmb3IgYSBzZXREYXRhIGNhbGwpLiAqLyBjbGFzcyBQYXJzZWRTZXREYXRhIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IGUsIHRoaXMuZmllbGRNYXNrID0gdCwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBuO1xuICAgIH1cbiAgICB0b011dGF0aW9uKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHRoaXMuZmllbGRNYXNrID8gbmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGUsIHRoaXMuZGF0YSwgdGhpcy5maWVsZE1hc2ssIHQsIHRoaXMuZmllbGRUcmFuc2Zvcm1zKSA6IG5ldyBfX1BSSVZBVEVfU2V0TXV0YXRpb24oZSwgdGhpcy5kYXRhLCB0LCB0aGlzLmZpZWxkVHJhbnNmb3Jtcyk7XG4gICAgfVxufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBwYXJzaW5nIFwidXBkYXRlXCIgZGF0YSAoaS5lLiBmb3IgYW4gdXBkYXRlRGF0YSBjYWxsKS4gKi8gY2xhc3MgUGFyc2VkVXBkYXRlRGF0YSB7XG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLy8gVGhlIGZpZWxkTWFzayBkb2VzIG5vdCBpbmNsdWRlIGRvY3VtZW50IHRyYW5zZm9ybXMuXG4gICAgdCwgbikge1xuICAgICAgICB0aGlzLmRhdGEgPSBlLCB0aGlzLmZpZWxkTWFzayA9IHQsIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gbjtcbiAgICB9XG4gICAgdG9NdXRhdGlvbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BhdGNoTXV0YXRpb24oZSwgdGhpcy5kYXRhLCB0aGlzLmZpZWxkTWFzaywgdCwgdGhpcy5maWVsZFRyYW5zZm9ybXMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2lzV3JpdGUoZSkge1xuICAgIHN3aXRjaCAoZSkge1xuICAgICAgY2FzZSAwIC8qIFVzZXJEYXRhU291cmNlLlNldCAqLyA6XG4gLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBVc2VyRGF0YVNvdXJjZS5NZXJnZVNldCAqLyA6XG4gLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgICAgICAgIGNhc2UgMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gOlxuICAgICAgICByZXR1cm4gITA7XG5cbiAgICAgIGNhc2UgMyAvKiBVc2VyRGF0YVNvdXJjZS5Bcmd1bWVudCAqLyA6XG4gICAgICBjYXNlIDQgLyogVXNlckRhdGFTb3VyY2UuQXJyYXlBcmd1bWVudCAqLyA6XG4gICAgICAgIHJldHVybiAhMTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqIEEgXCJjb250ZXh0XCIgb2JqZWN0IHBhc3NlZCBhcm91bmQgd2hpbGUgcGFyc2luZyB1c2VyIGRhdGEuICovIGNsYXNzIF9fUFJJVkFURV9QYXJzZUNvbnRleHRJbXBsIHtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBhIFBhcnNlQ29udGV4dCB3aXRoIHRoZSBnaXZlbiBzb3VyY2UgYW5kIHBhdGguXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2V0dGluZ3MgLSBUaGUgc2V0dGluZ3MgZm9yIHRoZSBwYXJzZXIuXG4gICAgICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgZGF0YWJhc2UgSUQgb2YgdGhlIEZpcmVzdG9yZSBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0gc2VyaWFsaXplciAtIFRoZSBzZXJpYWxpemVyIHRvIHVzZSB0byBnZW5lcmF0ZSB0aGUgVmFsdWUgcHJvdG8uXG4gICAgICogQHBhcmFtIGlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgLSBXaGV0aGVyIHRvIGlnbm9yZSB1bmRlZmluZWQgcHJvcGVydGllc1xuICAgICAqIHJhdGhlciB0aGFuIHRocm93LlxuICAgICAqIEBwYXJhbSBmaWVsZFRyYW5zZm9ybXMgLSBBIG11dGFibGUgbGlzdCBvZiBmaWVsZCB0cmFuc2Zvcm1zIGVuY291bnRlcmVkXG4gICAgICogd2hpbGUgcGFyc2luZyB0aGUgZGF0YS5cbiAgICAgKiBAcGFyYW0gZmllbGRNYXNrIC0gQSBtdXRhYmxlIGxpc3Qgb2YgZmllbGQgcGF0aHMgZW5jb3VudGVyZWQgd2hpbGUgcGFyc2luZ1xuICAgICAqIHRoZSBkYXRhLlxuICAgICAqXG4gICAgICogVE9ETyhiLzM0ODcxMTMxKTogV2UgZG9uJ3Qgc3VwcG9ydCBhcnJheSBwYXRocyByaWdodCBub3csIHNvIHBhdGggY2FuIGJlXG4gICAgICogbnVsbCB0byBpbmRpY2F0ZSB0aGUgY29udGV4dCByZXByZXNlbnRzIGFueSBsb2NhdGlvbiB3aXRoaW4gYW4gYXJyYXkgKGluXG4gICAgICogd2hpY2ggY2FzZSBjZXJ0YWluIGZlYXR1cmVzIHdpbGwgbm90IHdvcmsgYW5kIGVycm9ycyB3aWxsIGJlIHNvbWV3aGF0XG4gICAgICogY29tcHJvbWlzZWQpLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IGUsIHRoaXMuZGF0YWJhc2VJZCA9IHQsIHRoaXMuc2VyaWFsaXplciA9IG4sIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IHIsIFxuICAgICAgICAvLyBNaW5vciBoYWNrOiBJZiBmaWVsZFRyYW5zZm9ybXMgaXMgdW5kZWZpbmVkLCB3ZSBhc3N1bWUgdGhpcyBpcyBhblxuICAgICAgICAvLyBleHRlcm5hbCBjYWxsIGFuZCB3ZSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBlbnRpcmUgcGF0aC5cbiAgICAgICAgdm9pZCAwID09PSBpICYmIHRoaXMudnUoKSwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBpIHx8IFtdLCB0aGlzLmZpZWxkTWFzayA9IHMgfHwgW107XG4gICAgfVxuICAgIGdldCBwYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5wYXRoO1xuICAgIH1cbiAgICBnZXQgQ3UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLkN1O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIG5ldyBjb250ZXh0IHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncyBvdmVyd3JpdHRlbi4gKi8gICAgRnUoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9QYXJzZUNvbnRleHRJbXBsKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zZXR0aW5ncyksIGUpLCB0aGlzLmRhdGFiYXNlSWQsIHRoaXMuc2VyaWFsaXplciwgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzLCB0aGlzLmZpZWxkVHJhbnNmb3JtcywgdGhpcy5maWVsZE1hc2spO1xuICAgIH1cbiAgICBNdShlKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICBjb25zdCBuID0gbnVsbCA9PT0gKHQgPSB0aGlzLnBhdGgpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuY2hpbGQoZSksIHIgPSB0aGlzLkZ1KHtcbiAgICAgICAgICAgIHBhdGg6IG4sXG4gICAgICAgICAgICB4dTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByLk91KGUpLCByO1xuICAgIH1cbiAgICBOdShlKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICBjb25zdCBuID0gbnVsbCA9PT0gKHQgPSB0aGlzLnBhdGgpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuY2hpbGQoZSksIHIgPSB0aGlzLkZ1KHtcbiAgICAgICAgICAgIHBhdGg6IG4sXG4gICAgICAgICAgICB4dTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByLnZ1KCksIHI7XG4gICAgfVxuICAgIEx1KGUpIHtcbiAgICAgICAgLy8gVE9ETyhiLzM0ODcxMTMxKTogV2UgZG9uJ3Qgc3VwcG9ydCBhcnJheSBwYXRocyByaWdodCBub3c7IHNvIG1ha2UgcGF0aFxuICAgICAgICAvLyB1bmRlZmluZWQuXG4gICAgICAgIHJldHVybiB0aGlzLkZ1KHtcbiAgICAgICAgICAgIHBhdGg6IHZvaWQgMCxcbiAgICAgICAgICAgIHh1OiAhMFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgQnUoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NyZWF0ZUVycm9yKGUsIHRoaXMuc2V0dGluZ3MubWV0aG9kTmFtZSwgdGhpcy5zZXR0aW5ncy5rdSB8fCAhMSwgdGhpcy5wYXRoLCB0aGlzLnNldHRpbmdzLnF1KTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgJ3RydWUnIGlmICdmaWVsZFBhdGgnIHdhcyB0cmF2ZXJzZWQgd2hlbiBjcmVhdGluZyB0aGlzIGNvbnRleHQuICovICAgIGNvbnRhaW5zKGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5maWVsZE1hc2suZmluZCgodCA9PiBlLmlzUHJlZml4T2YodCkpKSB8fCB2b2lkIDAgIT09IHRoaXMuZmllbGRUcmFuc2Zvcm1zLmZpbmQoKHQgPT4gZS5pc1ByZWZpeE9mKHQuZmllbGQpKSk7XG4gICAgfVxuICAgIHZ1KCkge1xuICAgICAgICAvLyBUT0RPKGIvMzQ4NzExMzEpOiBSZW1vdmUgbnVsbCBjaGVjayBvbmNlIHdlIGhhdmUgcHJvcGVyIHBhdGhzIGZvciBmaWVsZHNcbiAgICAgICAgLy8gd2l0aGluIGFycmF5cy5cbiAgICAgICAgaWYgKHRoaXMucGF0aCkgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLnBhdGgubGVuZ3RoOyBlKyspIHRoaXMuT3UodGhpcy5wYXRoLmdldChlKSk7XG4gICAgfVxuICAgIE91KGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUubGVuZ3RoKSB0aHJvdyB0aGlzLkJ1KFwiRG9jdW1lbnQgZmllbGRzIG11c3Qgbm90IGJlIGVtcHR5XCIpO1xuICAgICAgICBpZiAoX19QUklWQVRFX2lzV3JpdGUodGhpcy5DdSkgJiYgYmUudGVzdChlKSkgdGhyb3cgdGhpcy5CdSgnRG9jdW1lbnQgZmllbGRzIGNhbm5vdCBiZWdpbiBhbmQgZW5kIHdpdGggXCJfX1wiJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciBmb3IgcGFyc2luZyByYXcgdXNlciBpbnB1dCAocHJvdmlkZWQgdmlhIHRoZSBBUEkpIGludG8gaW50ZXJuYWwgbW9kZWxcbiAqIGNsYXNzZXMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1VzZXJEYXRhUmVhZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJZCA9IGUsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IHQsIHRoaXMuc2VyaWFsaXplciA9IG4gfHwgX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZSk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IHRvcC1sZXZlbCBwYXJzZSBjb250ZXh0LiAqLyAgICBRdShlLCB0LCBuLCByID0gITEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUGFyc2VDb250ZXh0SW1wbCh7XG4gICAgICAgICAgICBDdTogZSxcbiAgICAgICAgICAgIG1ldGhvZE5hbWU6IHQsXG4gICAgICAgICAgICBxdTogbixcbiAgICAgICAgICAgIHBhdGg6IEZpZWxkUGF0aCQxLmVtcHR5UGF0aCgpLFxuICAgICAgICAgICAgeHU6ICExLFxuICAgICAgICAgICAga3U6IHJcbiAgICAgICAgfSwgdGhpcy5kYXRhYmFzZUlkLCB0aGlzLnNlcmlhbGl6ZXIsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSkge1xuICAgIGNvbnN0IHQgPSBlLl9mcmVlemVTZXR0aW5ncygpLCBuID0gX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZS5fZGF0YWJhc2VJZCk7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfVXNlckRhdGFSZWFkZXIoZS5fZGF0YWJhc2VJZCwgISF0Lmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMsIG4pO1xufVxuXG4vKiogUGFyc2UgZG9jdW1lbnQgZGF0YSBmcm9tIGEgc2V0KCkgY2FsbC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlU2V0RGF0YShlLCB0LCBuLCByLCBpLCBzID0ge30pIHtcbiAgICBjb25zdCBvID0gZS5RdShzLm1lcmdlIHx8IHMubWVyZ2VGaWVsZHMgPyAyIC8qIFVzZXJEYXRhU291cmNlLk1lcmdlU2V0ICovIDogMCAvKiBVc2VyRGF0YVNvdXJjZS5TZXQgKi8gLCB0LCBuLCBpKTtcbiAgICBfX1BSSVZBVEVfdmFsaWRhdGVQbGFpbk9iamVjdChcIkRhdGEgbXVzdCBiZSBhbiBvYmplY3QsIGJ1dCBpdCB3YXM6XCIsIG8sIHIpO1xuICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfcGFyc2VPYmplY3Qociwgbyk7XG4gICAgbGV0IGEsIHU7XG4gICAgaWYgKHMubWVyZ2UpIGEgPSBuZXcgRmllbGRNYXNrKG8uZmllbGRNYXNrKSwgdSA9IG8uZmllbGRUcmFuc2Zvcm1zOyBlbHNlIGlmIChzLm1lcmdlRmllbGRzKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCByIG9mIHMubWVyZ2VGaWVsZHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50JDEodCwgciwgbik7XG4gICAgICAgICAgICBpZiAoIW8uY29udGFpbnMoaSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBGaWVsZCAnJHtpfScgaXMgc3BlY2lmaWVkIGluIHlvdXIgZmllbGQgbWFzayBidXQgbWlzc2luZyBmcm9tIHlvdXIgaW5wdXQgZGF0YS5gKTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9maWVsZE1hc2tDb250YWlucyhlLCBpKSB8fCBlLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgICAgYSA9IG5ldyBGaWVsZE1hc2soZSksIHUgPSBvLmZpZWxkVHJhbnNmb3Jtcy5maWx0ZXIoKGUgPT4gYS5jb3ZlcnMoZS5maWVsZCkpKTtcbiAgICB9IGVsc2UgYSA9IG51bGwsIHUgPSBvLmZpZWxkVHJhbnNmb3JtcztcbiAgICByZXR1cm4gbmV3IFBhcnNlZFNldERhdGEobmV3IE9iamVjdFZhbHVlKF8pLCBhLCB1KTtcbn1cblxuY2xhc3MgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsIGV4dGVuZHMgRmllbGRWYWx1ZSB7XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBpZiAoMiAvKiBVc2VyRGF0YVNvdXJjZS5NZXJnZVNldCAqLyAhPT0gZS5DdSkgdGhyb3cgMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gPT09IGUuQ3UgPyBlLkJ1KGAke3RoaXMuX21ldGhvZE5hbWV9KCkgY2FuIG9ubHkgYXBwZWFyIGF0IHRoZSB0b3AgbGV2ZWwgb2YgeW91ciB1cGRhdGUgZGF0YWApIDogZS5CdShgJHt0aGlzLl9tZXRob2ROYW1lfSgpIGNhbm5vdCBiZSB1c2VkIHdpdGggc2V0KCkgdW5sZXNzIHlvdSBwYXNzIHttZXJnZTp0cnVlfWApO1xuICAgICAgICAvLyBObyB0cmFuc2Zvcm0gdG8gYWRkIGZvciBhIGRlbGV0ZSwgYnV0IHdlIG5lZWQgdG8gYWRkIGl0IHRvIG91clxuICAgICAgICAvLyBmaWVsZE1hc2sgc28gaXQgZ2V0cyBkZWxldGVkLlxuICAgICAgICByZXR1cm4gZS5maWVsZE1hc2sucHVzaChlLnBhdGgpLCBudWxsO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfRGVsZXRlRmllbGRWYWx1ZUltcGw7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBjaGlsZCBjb250ZXh0IGZvciBwYXJzaW5nIFNlcmlhbGl6YWJsZUZpZWxkVmFsdWVzLlxuICpcbiAqIFRoaXMgaXMgZGlmZmVyZW50IHRoYW4gY2FsbGluZyBgUGFyc2VDb250ZXh0LmNvbnRleHRXaXRoYCBiZWNhdXNlIGl0IGtlZXBzXG4gKiB0aGUgZmllbGRUcmFuc2Zvcm1zIGFuZCBmaWVsZE1hc2sgc2VwYXJhdGUuXG4gKlxuICogVGhlIGNyZWF0ZWQgY29udGV4dCBoYXMgaXRzIGBkYXRhU291cmNlYCBzZXQgdG8gYFVzZXJEYXRhU291cmNlLkFyZ3VtZW50YC5cbiAqIEFsdGhvdWdoIHRoZXNlIHZhbHVlcyBhcmUgdXNlZCB3aXRoIHdyaXRlcywgYW55IGVsZW1lbnRzIGluIHRoZXNlIEZpZWxkVmFsdWVzXG4gKiBhcmUgbm90IGNvbnNpZGVyZWQgd3JpdGVzIHNpbmNlIHRoZXkgY2Fubm90IGNvbnRhaW4gYW55IEZpZWxkVmFsdWUgc2VudGluZWxzLFxuICogZXRjLlxuICpcbiAqIEBwYXJhbSBmaWVsZFZhbHVlIC0gVGhlIHNlbnRpbmVsIEZpZWxkVmFsdWUgZm9yIHdoaWNoIHRvIGNyZWF0ZSBhIGNoaWxkXG4gKiAgICAgY29udGV4dC5cbiAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIHBhcmVudCBjb250ZXh0LlxuICogQHBhcmFtIGFycmF5RWxlbWVudCAtIFdoZXRoZXIgb3Igbm90IHRoZSBGaWVsZFZhbHVlIGhhcyBhbiBhcnJheS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlU2VudGluZWxDaGlsZENvbnRleHQoZSwgdCwgbikge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BhcnNlQ29udGV4dEltcGwoe1xuICAgICAgICBDdTogMyAvKiBVc2VyRGF0YVNvdXJjZS5Bcmd1bWVudCAqLyAsXG4gICAgICAgIHF1OiB0LnNldHRpbmdzLnF1LFxuICAgICAgICBtZXRob2ROYW1lOiBlLl9tZXRob2ROYW1lLFxuICAgICAgICB4dTogblxuICAgIH0sIHQuZGF0YWJhc2VJZCwgdC5zZXJpYWxpemVyLCB0Lmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMpO1xufVxuXG5jbGFzcyBfX1BSSVZBVEVfU2VydmVyVGltZXN0YW1wRmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBfdG9GaWVsZFRyYW5zZm9ybShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRUcmFuc2Zvcm0oZS5wYXRoLCBuZXcgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBGaWVsZFZhbHVlSW1wbDtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9BcnJheVVuaW9uRmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUpLCB0aGlzLkt1ID0gdDtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2NyZWF0ZVNlbnRpbmVsQ2hpbGRDb250ZXh0KHRoaXMsIGUsIFxuICAgICAgICAvKmFycmF5PSovICEwKSwgbiA9IHRoaXMuS3UubWFwKChlID0+IF9fUFJJVkFURV9wYXJzZURhdGEoZSwgdCkpKSwgciA9IG5ldyBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbihuKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFRyYW5zZm9ybShlLnBhdGgsIHIpO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvbkZpZWxkVmFsdWVJbXBsICYmIGRlZXBFcXVhbCh0aGlzLkt1LCBlLkt1KTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9BcnJheVJlbW92ZUZpZWxkVmFsdWVJbXBsIGV4dGVuZHMgRmllbGRWYWx1ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlKSwgdGhpcy5LdSA9IHQ7XG4gICAgfVxuICAgIF90b0ZpZWxkVHJhbnNmb3JtKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9jcmVhdGVTZW50aW5lbENoaWxkQ29udGV4dCh0aGlzLCBlLCBcbiAgICAgICAgLyphcnJheT0qLyAhMCksIG4gPSB0aGlzLkt1Lm1hcCgoZSA9PiBfX1BSSVZBVEVfcGFyc2VEYXRhKGUsIHQpKSksIHIgPSBuZXcgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKG4pO1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkVHJhbnNmb3JtKGUucGF0aCwgcik7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVJlbW92ZUZpZWxkVmFsdWVJbXBsICYmIGRlZXBFcXVhbCh0aGlzLkt1LCBlLkt1KTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50RmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUpLCB0aGlzLiR1ID0gdDtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uKGUuc2VyaWFsaXplciwgdG9OdW1iZXIoZS5zZXJpYWxpemVyLCB0aGlzLiR1KSk7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRUcmFuc2Zvcm0oZS5wYXRoLCB0KTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRGaWVsZFZhbHVlSW1wbCAmJiB0aGlzLiR1ID09PSBlLiR1O1xuICAgIH1cbn1cblxuLyoqIFBhcnNlIHVwZGF0ZSBkYXRhIGZyb20gYW4gdXBkYXRlKCkgY2FsbC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlVXBkYXRlRGF0YShlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IGUuUXUoMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gLCB0LCBuKTtcbiAgICBfX1BSSVZBVEVfdmFsaWRhdGVQbGFpbk9iamVjdChcIkRhdGEgbXVzdCBiZSBhbiBvYmplY3QsIGJ1dCBpdCB3YXM6XCIsIGksIHIpO1xuICAgIGNvbnN0IHMgPSBbXSwgbyA9IE9iamVjdFZhbHVlLmVtcHR5KCk7XG4gICAgZm9yRWFjaChyLCAoKGUsIHIpID0+IHtcbiAgICAgICAgY29uc3QgXyA9IF9fUFJJVkFURV9maWVsZFBhdGhGcm9tRG90U2VwYXJhdGVkU3RyaW5nKHQsIGUsIG4pO1xuICAgICAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgICAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAgICAgciA9IGdldE1vZHVsYXJJbnN0YW5jZShyKTtcbiAgICAgICAgY29uc3QgYSA9IGkuTnUoXyk7XG4gICAgICAgIGlmIChyIGluc3RhbmNlb2YgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsKSBcbiAgICAgICAgLy8gQWRkIGl0IHRvIHRoZSBmaWVsZCBtYXNrLCBidXQgZG9uJ3QgYWRkIGFueXRoaW5nIHRvIHVwZGF0ZURhdGEuXG4gICAgICAgIHMucHVzaChfKTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX3BhcnNlRGF0YShyLCBhKTtcbiAgICAgICAgICAgIG51bGwgIT0gZSAmJiAocy5wdXNoKF8pLCBvLnNldChfLCBlKSk7XG4gICAgICAgIH1cbiAgICB9KSk7XG4gICAgY29uc3QgXyA9IG5ldyBGaWVsZE1hc2socyk7XG4gICAgcmV0dXJuIG5ldyBQYXJzZWRVcGRhdGVEYXRhKG8sIF8sIGkuZmllbGRUcmFuc2Zvcm1zKTtcbn1cblxuLyoqIFBhcnNlIHVwZGF0ZSBkYXRhIGZyb20gYSBsaXN0IG9mIGZpZWxkL3ZhbHVlIGFyZ3VtZW50cy4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlVXBkYXRlVmFyYXJncyhlLCB0LCBuLCByLCBpLCBzKSB7XG4gICAgY29uc3QgbyA9IGUuUXUoMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gLCB0LCBuKSwgXyA9IFsgX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKHQsIHIsIG4pIF0sIGEgPSBbIGkgXTtcbiAgICBpZiAocy5sZW5ndGggJSAyICE9IDApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBGdW5jdGlvbiAke3R9KCkgbmVlZHMgdG8gYmUgY2FsbGVkIHdpdGggYW4gZXZlbiBudW1iZXIgb2YgYXJndW1lbnRzIHRoYXQgYWx0ZXJuYXRlIGJldHdlZW4gZmllbGQgbmFtZXMgYW5kIHZhbHVlcy5gKTtcbiAgICBmb3IgKGxldCBlID0gMDsgZSA8IHMubGVuZ3RoOyBlICs9IDIpIF8ucHVzaChfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50JDEodCwgc1tlXSkpLCBcbiAgICBhLnB1c2goc1tlICsgMV0pO1xuICAgIGNvbnN0IHUgPSBbXSwgYyA9IE9iamVjdFZhbHVlLmVtcHR5KCk7XG4gICAgLy8gV2UgaXRlcmF0ZSBpbiByZXZlcnNlIG9yZGVyIHRvIHBpY2sgdGhlIGxhc3QgdmFsdWUgZm9yIGEgZmllbGQgaWYgdGhlXG4gICAgLy8gdXNlciBzcGVjaWZpZWQgdGhlIGZpZWxkIG11bHRpcGxlIHRpbWVzLlxuICAgIGZvciAobGV0IGUgPSBfLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSBpZiAoIV9fUFJJVkFURV9maWVsZE1hc2tDb250YWlucyh1LCBfW2VdKSkge1xuICAgICAgICBjb25zdCB0ID0gX1tlXTtcbiAgICAgICAgbGV0IG4gPSBhW2VdO1xuICAgICAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgICAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAgICAgbiA9IGdldE1vZHVsYXJJbnN0YW5jZShuKTtcbiAgICAgICAgY29uc3QgciA9IG8uTnUodCk7XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsKSBcbiAgICAgICAgLy8gQWRkIGl0IHRvIHRoZSBmaWVsZCBtYXNrLCBidXQgZG9uJ3QgYWRkIGFueXRoaW5nIHRvIHVwZGF0ZURhdGEuXG4gICAgICAgIHUucHVzaCh0KTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX3BhcnNlRGF0YShuLCByKTtcbiAgICAgICAgICAgIG51bGwgIT0gZSAmJiAodS5wdXNoKHQpLCBjLnNldCh0LCBlKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgbCA9IG5ldyBGaWVsZE1hc2sodSk7XG4gICAgcmV0dXJuIG5ldyBQYXJzZWRVcGRhdGVEYXRhKGMsIGwsIG8uZmllbGRUcmFuc2Zvcm1zKTtcbn1cblxuLyoqXG4gKiBQYXJzZSBhIFwicXVlcnkgdmFsdWVcIiAoZS5nLiB2YWx1ZSBpbiBhIHdoZXJlIGZpbHRlciBvciBhIHZhbHVlIGluIGEgY3Vyc29yXG4gKiBib3VuZCkuXG4gKlxuICogQHBhcmFtIGFsbG93QXJyYXlzIC0gV2hldGhlciB0aGUgcXVlcnkgdmFsdWUgaXMgYW4gYXJyYXkgdGhhdCBtYXkgZGlyZWN0bHlcbiAqIGNvbnRhaW4gYWRkaXRpb25hbCBhcnJheXMgKGUuZy4gdGhlIG9wZXJhbmQgb2YgYW4gYGluYCBxdWVyeSkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlUXVlcnlWYWx1ZShlLCB0LCBuLCByID0gITEpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX3BhcnNlRGF0YShuLCBlLlF1KHIgPyA0IC8qIFVzZXJEYXRhU291cmNlLkFycmF5QXJndW1lbnQgKi8gOiAzIC8qIFVzZXJEYXRhU291cmNlLkFyZ3VtZW50ICovICwgdCkpO1xufVxuXG4vKipcbiAqIFBhcnNlcyB1c2VyIGRhdGEgdG8gUHJvdG9idWYgVmFsdWVzLlxuICpcbiAqIEBwYXJhbSBpbnB1dCAtIERhdGEgdG8gYmUgcGFyc2VkLlxuICogQHBhcmFtIGNvbnRleHQgLSBBIGNvbnRleHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBwYXRoIGJlaW5nIHBhcnNlZCxcbiAqIHRoZSBzb3VyY2Ugb2YgdGhlIGRhdGEgYmVpbmcgcGFyc2VkLCBldGMuXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIHZhbHVlLCBvciBudWxsIGlmIHRoZSB2YWx1ZSB3YXMgYSBGaWVsZFZhbHVlIHNlbnRpbmVsXG4gKiB0aGF0IHNob3VsZCBub3QgYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdGluZyBwYXJzZWQgZGF0YS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VEYXRhKGUsIHQpIHtcbiAgICBpZiAoX19QUklWQVRFX2xvb2tzTGlrZUpzb25PYmplY3QoXG4gICAgLy8gVW53cmFwIHRoZSBBUEkgdHlwZSBmcm9tIHRoZSBDb21wYXQgU0RLLiBUaGlzIHdpbGwgcmV0dXJuIHRoZSBBUEkgdHlwZVxuICAgIC8vIGZyb20gZmlyZXN0b3JlLWV4cC5cbiAgICBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKSkgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZVBsYWluT2JqZWN0KFwiVW5zdXBwb3J0ZWQgZmllbGQgdmFsdWU6XCIsIHQsIGUpLCBcbiAgICBfX1BSSVZBVEVfcGFyc2VPYmplY3QoZSwgdCk7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBGaWVsZFZhbHVlKSBcbiAgICAvLyBGaWVsZFZhbHVlcyB1c3VhbGx5IHBhcnNlIGludG8gdHJhbnNmb3JtcyAoZXhjZXB0IGRlbGV0ZUZpZWxkKCkpXG4gICAgLy8gaW4gd2hpY2ggY2FzZSB3ZSBkbyBub3Qgd2FudCB0byBpbmNsdWRlIHRoaXMgZmllbGQgaW4gb3VyIHBhcnNlZCBkYXRhXG4gICAgLy8gKGFzIGRvaW5nIHNvIHdpbGwgb3ZlcndyaXRlIHRoZSBmaWVsZCBkaXJlY3RseSBwcmlvciB0byB0aGUgdHJhbnNmb3JtXG4gICAgLy8gdHJ5aW5nIHRvIHRyYW5zZm9ybSBpdCkuIFNvIHdlIGRvbid0IGFkZCB0aGlzIGxvY2F0aW9uIHRvXG4gICAgLy8gY29udGV4dC5maWVsZE1hc2sgYW5kIHdlIHJldHVybiBudWxsIGFzIG91ciBwYXJzaW5nIHJlc3VsdC5cbiAgICAvKipcbiAqIFwiUGFyc2VzXCIgdGhlIHByb3ZpZGVkIEZpZWxkVmFsdWVJbXBsLCBhZGRpbmcgYW55IG5lY2Vzc2FyeSB0cmFuc2Zvcm1zIHRvXG4gKiBjb250ZXh0LmZpZWxkVHJhbnNmb3Jtcy5cbiAqL1xuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VTZW50aW5lbEZpZWxkVmFsdWUoZSwgdCkge1xuICAgICAgICAvLyBTZW50aW5lbHMgYXJlIG9ubHkgc3VwcG9ydGVkIHdpdGggd3JpdGVzLCBhbmQgbm90IHdpdGhpbiBhcnJheXMuXG4gICAgICAgIGlmICghX19QUklWQVRFX2lzV3JpdGUodC5DdSkpIHRocm93IHQuQnUoYCR7ZS5fbWV0aG9kTmFtZX0oKSBjYW4gb25seSBiZSB1c2VkIHdpdGggdXBkYXRlKCkgYW5kIHNldCgpYCk7XG4gICAgICAgIGlmICghdC5wYXRoKSB0aHJvdyB0LkJ1KGAke2UuX21ldGhvZE5hbWV9KCkgaXMgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgaW5zaWRlIGFycmF5c2ApO1xuICAgICAgICBjb25zdCBuID0gZS5fdG9GaWVsZFRyYW5zZm9ybSh0KTtcbiAgICAgICAgbiAmJiB0LmZpZWxkVHJhbnNmb3Jtcy5wdXNoKG4pO1xuICAgIH1cbiAgICAvKipcbiAqIEhlbHBlciB0byBwYXJzZSBhIHNjYWxhciB2YWx1ZSAoaS5lLiBub3QgYW4gT2JqZWN0LCBBcnJheSwgb3IgRmllbGRWYWx1ZSlcbiAqXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIHZhbHVlXG4gKi8gKGUsIHQpLCBudWxsO1xuICAgIGlmICh2b2lkIDAgPT09IGUgJiYgdC5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzKSBcbiAgICAvLyBJZiB0aGUgaW5wdXQgaXMgdW5kZWZpbmVkIGl0IGNhbiBuZXZlciBwYXJ0aWNpcGF0ZSBpbiB0aGUgZmllbGRNYXNrLCBzb1xuICAgIC8vIGRvbid0IGhhbmRsZSB0aGlzIGJlbG93LiBJZiBgaWdub3JlVW5kZWZpbmVkUHJvcGVydGllc2AgaXMgZmFsc2UsXG4gICAgLy8gYHBhcnNlU2NhbGFyVmFsdWVgIHdpbGwgcmVqZWN0IGFuIHVuZGVmaW5lZCB2YWx1ZS5cbiAgICByZXR1cm4gbnVsbDtcbiAgICBpZiAoXG4gICAgLy8gSWYgY29udGV4dC5wYXRoIGlzIG51bGwgd2UgYXJlIGluc2lkZSBhbiBhcnJheSBhbmQgd2UgZG9uJ3Qgc3VwcG9ydFxuICAgIC8vIGZpZWxkIG1hc2sgcGF0aHMgbW9yZSBncmFudWxhciB0aGFuIHRoZSB0b3AtbGV2ZWwgYXJyYXkuXG4gICAgdC5wYXRoICYmIHQuZmllbGRNYXNrLnB1c2godC5wYXRoKSwgZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIC8vIFRPRE8oYi8zNDg3MTEzMSk6IEluY2x1ZGUgdGhlIHBhdGggY29udGFpbmluZyB0aGUgYXJyYXkgaW4gdGhlIGVycm9yXG4gICAgICAgIC8vIG1lc3NhZ2UuXG4gICAgICAgIC8vIEluIHRoZSBjYXNlIG9mIElOIHF1ZXJpZXMsIHRoZSBwYXJzZWQgZGF0YSBpcyBhbiBhcnJheSAocmVwcmVzZW50aW5nXG4gICAgICAgIC8vIHRoZSBzZXQgb2YgdmFsdWVzIHRvIGJlIGluY2x1ZGVkIGZvciB0aGUgSU4gcXVlcnkpIHRoYXQgbWF5IGRpcmVjdGx5XG4gICAgICAgIC8vIGNvbnRhaW4gYWRkaXRpb25hbCBhcnJheXMgKGVhY2ggcmVwcmVzZW50aW5nIGFuIGluZGl2aWR1YWwgZmllbGRcbiAgICAgICAgLy8gdmFsdWUpLCBzbyB3ZSBkaXNhYmxlIHRoaXMgdmFsaWRhdGlvbi5cbiAgICAgICAgaWYgKHQuc2V0dGluZ3MueHUgJiYgNCAvKiBVc2VyRGF0YVNvdXJjZS5BcnJheUFyZ3VtZW50ICovICE9PSB0LkN1KSB0aHJvdyB0LkJ1KFwiTmVzdGVkIGFycmF5cyBhcmUgbm90IHN1cHBvcnRlZFwiKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZUFycmF5KGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgICAgIGxldCByID0gMDtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBlKSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSBfX1BSSVZBVEVfcGFyc2VEYXRhKGksIHQuTHUocikpO1xuICAgICAgICAgICAgICAgIG51bGwgPT0gZSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gSnVzdCBpbmNsdWRlIG51bGxzIGluIHRoZSBhcnJheSBmb3IgZmllbGRzIGJlaW5nIHJlcGxhY2VkIHdpdGggYVxuICAgICAgICAgICAgICAgIC8vIHNlbnRpbmVsLlxuICAgICAgICAgICAgICAgIGUgPSB7XG4gICAgICAgICAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgICAgICAgICB9KSwgbi5wdXNoKGUpLCByKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfShlLCB0KTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZVNjYWxhclZhbHVlKGUsIHQpIHtcbiAgICAgICAgaWYgKG51bGwgPT09IChlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKSkgcmV0dXJuIHtcbiAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIGUpIHJldHVybiB0b051bWJlcih0LnNlcmlhbGl6ZXIsIGUpO1xuICAgICAgICBpZiAoXCJib29sZWFuXCIgPT0gdHlwZW9mIGUpIHJldHVybiB7XG4gICAgICAgICAgICBib29sZWFuVmFsdWU6IGVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpIHJldHVybiB7XG4gICAgICAgICAgICBzdHJpbmdWYWx1ZTogZVxuICAgICAgICB9O1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBUaW1lc3RhbXAuZnJvbURhdGUoZSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpbWVzdGFtcFZhbHVlOiB0b1RpbWVzdGFtcCh0LnNlcmlhbGl6ZXIsIG4pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgVGltZXN0YW1wKSB7XG4gICAgICAgICAgICAvLyBGaXJlc3RvcmUgYmFja2VuZCB0cnVuY2F0ZXMgcHJlY2lzaW9uIGRvd24gdG8gbWljcm9zZWNvbmRzLiBUbyBlbnN1cmVcbiAgICAgICAgICAgIC8vIG9mZmxpbmUgbW9kZSB3b3JrcyB0aGUgc2FtZSB3aXRoIHJlZ2FyZHMgdG8gdHJ1bmNhdGlvbiwgcGVyZm9ybSB0aGVcbiAgICAgICAgICAgIC8vIHRydW5jYXRpb24gaW1tZWRpYXRlbHkgd2l0aG91dCB3YWl0aW5nIGZvciB0aGUgYmFja2VuZCB0byBkbyB0aGF0LlxuICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBUaW1lc3RhbXAoZS5zZWNvbmRzLCAxZTMgKiBNYXRoLmZsb29yKGUubmFub3NlY29uZHMgLyAxZTMpKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGltZXN0YW1wVmFsdWU6IHRvVGltZXN0YW1wKHQuc2VyaWFsaXplciwgbilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBHZW9Qb2ludCkgcmV0dXJuIHtcbiAgICAgICAgICAgIGdlb1BvaW50VmFsdWU6IHtcbiAgICAgICAgICAgICAgICBsYXRpdHVkZTogZS5sYXRpdHVkZSxcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IGUubG9uZ2l0dWRlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQnl0ZXMpIHJldHVybiB7XG4gICAgICAgICAgICBieXRlc1ZhbHVlOiBfX1BSSVZBVEVfdG9CeXRlcyh0LnNlcmlhbGl6ZXIsIGUuX2J5dGVTdHJpbmcpXG4gICAgICAgIH07XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmRhdGFiYXNlSWQsIHIgPSBlLmZpcmVzdG9yZS5fZGF0YWJhc2VJZDtcbiAgICAgICAgICAgIGlmICghci5pc0VxdWFsKG4pKSB0aHJvdyB0LkJ1KGBEb2N1bWVudCByZWZlcmVuY2UgaXMgZm9yIGRhdGFiYXNlICR7ci5wcm9qZWN0SWR9LyR7ci5kYXRhYmFzZX0gYnV0IHNob3VsZCBiZSBmb3IgZGF0YWJhc2UgJHtuLnByb2plY3RJZH0vJHtuLmRhdGFiYXNlfWApO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VWYWx1ZTogX19QUklWQVRFX3RvUmVzb3VyY2VOYW1lKGUuZmlyZXN0b3JlLl9kYXRhYmFzZUlkIHx8IHQuZGF0YWJhc2VJZCwgZS5fa2V5LnBhdGgpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgVmVjdG9yVmFsdWUpIFxuICAgICAgICAvKipcbiAqIENyZWF0ZXMgYSBuZXcgVmVjdG9yVmFsdWUgcHJvdG8gdmFsdWUgKHVzaW5nIHRoZSBpbnRlcm5hbCBmb3JtYXQpLlxuICovXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VWZWN0b3JWYWx1ZShlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgX190eXBlX186IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZTogXCJfX3ZlY3Rvcl9fXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBlLnRvQXJyYXkoKS5tYXAoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFwibnVtYmVyXCIgIT0gdHlwZW9mIGUpIHRocm93IHQuQnUoXCJWZWN0b3JWYWx1ZXMgbXVzdCBvbmx5IGNvbnRhaW4gbnVtZXJpYyB2YWx1ZXMuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV90b0RvdWJsZSh0LnNlcmlhbGl6ZXIsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQ2hlY2tzIHdoZXRoZXIgYW4gb2JqZWN0IGxvb2tzIGxpa2UgYSBKU09OIG9iamVjdCB0aGF0IHNob3VsZCBiZSBjb252ZXJ0ZWRcbiAqIGludG8gYSBzdHJ1Y3QuIE5vcm1hbCBjbGFzcy9wcm90b3R5cGUgaW5zdGFuY2VzIGFyZSBjb25zaWRlcmVkIHRvIGxvb2sgbGlrZVxuICogSlNPTiBvYmplY3RzIHNpbmNlIHRoZXkgc2hvdWxkIGJlIGNvbnZlcnRlZCB0byBhIHN0cnVjdCB2YWx1ZS4gQXJyYXlzLCBEYXRlcyxcbiAqIEdlb1BvaW50cywgZXRjLiBhcmUgbm90IGNvbnNpZGVyZWQgdG8gbG9vayBsaWtlIEpTT04gb2JqZWN0cyBzaW5jZSB0aGV5IG1hcFxuICogdG8gc3BlY2lmaWMgRmllbGRWYWx1ZSB0eXBlcyBvdGhlciB0aGFuIE9iamVjdFZhbHVlLlxuICovIChlLCB0KTtcbiAgICAgICAgdGhyb3cgdC5CdShgVW5zdXBwb3J0ZWQgZmllbGQgdmFsdWU6ICR7X19QUklWQVRFX3ZhbHVlRGVzY3JpcHRpb24oZSl9YCk7XG4gICAgfShlLCB0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlT2JqZWN0KGUsIHQpIHtcbiAgICBjb25zdCBuID0ge307XG4gICAgcmV0dXJuIGlzRW1wdHkoZSkgPyBcbiAgICAvLyBJZiB3ZSBlbmNvdW50ZXIgYW4gZW1wdHkgb2JqZWN0LCB3ZSBleHBsaWNpdGx5IGFkZCBpdCB0byB0aGUgdXBkYXRlXG4gICAgLy8gbWFzayB0byBlbnN1cmUgdGhhdCB0aGUgc2VydmVyIGNyZWF0ZXMgYSBtYXAgZW50cnkuXG4gICAgdC5wYXRoICYmIHQucGF0aC5sZW5ndGggPiAwICYmIHQuZmllbGRNYXNrLnB1c2godC5wYXRoKSA6IGZvckVhY2goZSwgKChlLCByKSA9PiB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfcGFyc2VEYXRhKHIsIHQuTXUoZSkpO1xuICAgICAgICBudWxsICE9IGkgJiYgKG5bZV0gPSBpKTtcbiAgICB9KSksIHtcbiAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgIGZpZWxkczogblxuICAgICAgICB9XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2xvb2tzTGlrZUpzb25PYmplY3QoZSkge1xuICAgIHJldHVybiAhKFwib2JqZWN0XCIgIT0gdHlwZW9mIGUgfHwgbnVsbCA9PT0gZSB8fCBlIGluc3RhbmNlb2YgQXJyYXkgfHwgZSBpbnN0YW5jZW9mIERhdGUgfHwgZSBpbnN0YW5jZW9mIFRpbWVzdGFtcCB8fCBlIGluc3RhbmNlb2YgR2VvUG9pbnQgfHwgZSBpbnN0YW5jZW9mIEJ5dGVzIHx8IGUgaW5zdGFuY2VvZiBEb2N1bWVudFJlZmVyZW5jZSB8fCBlIGluc3RhbmNlb2YgRmllbGRWYWx1ZSB8fCBlIGluc3RhbmNlb2YgVmVjdG9yVmFsdWUpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVQbGFpbk9iamVjdChlLCB0LCBuKSB7XG4gICAgaWYgKCFfX1BSSVZBVEVfbG9va3NMaWtlSnNvbk9iamVjdChuKSB8fCAhZnVuY3Rpb24gX19QUklWQVRFX2lzUGxhaW5PYmplY3QoZSkge1xuICAgICAgICByZXR1cm4gXCJvYmplY3RcIiA9PSB0eXBlb2YgZSAmJiBudWxsICE9PSBlICYmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSkgPT09IE9iamVjdC5wcm90b3R5cGUgfHwgbnVsbCA9PT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGUpKTtcbiAgICB9KG4pKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfdmFsdWVEZXNjcmlwdGlvbihuKTtcbiAgICAgICAgdGhyb3cgXCJhbiBvYmplY3RcIiA9PT0gciA/IHQuQnUoZSArIFwiIGEgY3VzdG9tIG9iamVjdFwiKSA6IHQuQnUoZSArIFwiIFwiICsgcik7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0aGF0IGNhbGxzIGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoKSBidXQgd3JhcHMgYW55IGVycm9yIHRocm93bi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50JDEoZSwgdCwgbikge1xuICAgIGlmICgoXG4gICAgLy8gSWYgcmVxdWlyZWQsIHJlcGxhY2UgdGhlIEZpZWxkUGF0aCBDb21wYXQgY2xhc3Mgd2l0aCB0aGUgZmlyZXN0b3JlLWV4cFxuICAgIC8vIEZpZWxkUGF0aC5cbiAgICB0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSBpbnN0YW5jZW9mIEZpZWxkUGF0aCkgcmV0dXJuIHQuX2ludGVybmFsUGF0aDtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCkgcmV0dXJuIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tRG90U2VwYXJhdGVkU3RyaW5nKGUsIHQpO1xuICAgIHRocm93IF9fUFJJVkFURV9jcmVhdGVFcnJvcihcIkZpZWxkIHBhdGggYXJndW1lbnRzIG11c3QgYmUgb2YgdHlwZSBzdHJpbmcgb3IgXCIsIGUsIFxuICAgIC8qIGhhc0NvbnZlcnRlcj0gKi8gITEsIFxuICAgIC8qIHBhdGg9ICovIHZvaWQgMCwgbik7XG59XG5cbi8qKlxuICogTWF0Y2hlcyBhbnkgY2hhcmFjdGVycyBpbiBhIGZpZWxkIHBhdGggc3RyaW5nIHRoYXQgYXJlIHJlc2VydmVkLlxuICovIGNvbnN0IERlID0gbmV3IFJlZ0V4cChcIlt+XFxcXCovXFxcXFtcXFxcXV1cIik7XG5cbi8qKlxuICogV3JhcHMgZnJvbURvdFNlcGFyYXRlZFN0cmluZyB3aXRoIGFuIGVycm9yIG1lc3NhZ2UgYWJvdXQgdGhlIG1ldGhvZCB0aGF0XG4gKiB3YXMgdGhyb3duLlxuICogQHBhcmFtIG1ldGhvZE5hbWUgLSBUaGUgcHVibGljbHkgdmlzaWJsZSBtZXRob2QgbmFtZVxuICogQHBhcmFtIHBhdGggLSBUaGUgZG90LXNlcGFyYXRlZCBzdHJpbmcgZm9ybSBvZiBhIGZpZWxkIHBhdGggd2hpY2ggd2lsbCBiZVxuICogc3BsaXQgb24gZG90cy5cbiAqIEBwYXJhbSB0YXJnZXREb2MgLSBUaGUgZG9jdW1lbnQgYWdhaW5zdCB3aGljaCB0aGUgZmllbGQgcGF0aCB3aWxsIGJlXG4gKiBldmFsdWF0ZWQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoZSwgdCwgbikge1xuICAgIGlmICh0LnNlYXJjaChEZSkgPj0gMCkgdGhyb3cgX19QUklWQVRFX2NyZWF0ZUVycm9yKGBJbnZhbGlkIGZpZWxkIHBhdGggKCR7dH0pLiBQYXRocyBtdXN0IG5vdCBjb250YWluICd+JywgJyonLCAnLycsICdbJywgb3IgJ10nYCwgZSwgXG4gICAgLyogaGFzQ29udmVydGVyPSAqLyAhMSwgXG4gICAgLyogcGF0aD0gKi8gdm9pZCAwLCBuKTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkUGF0aCguLi50LnNwbGl0KFwiLlwiKSkuX2ludGVybmFsUGF0aDtcbiAgICB9IGNhdGNoIChyKSB7XG4gICAgICAgIHRocm93IF9fUFJJVkFURV9jcmVhdGVFcnJvcihgSW52YWxpZCBmaWVsZCBwYXRoICgke3R9KS4gUGF0aHMgbXVzdCBub3QgYmUgZW1wdHksIGJlZ2luIHdpdGggJy4nLCBlbmQgd2l0aCAnLicsIG9yIGNvbnRhaW4gJy4uJ2AsIGUsIFxuICAgICAgICAvKiBoYXNDb252ZXJ0ZXI9ICovICExLCBcbiAgICAgICAgLyogcGF0aD0gKi8gdm9pZCAwLCBuKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVFcnJvcihlLCB0LCBuLCByLCBpKSB7XG4gICAgY29uc3QgcyA9IHIgJiYgIXIuaXNFbXB0eSgpLCBvID0gdm9pZCAwICE9PSBpO1xuICAgIGxldCBfID0gYEZ1bmN0aW9uICR7dH0oKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGRhdGFgO1xuICAgIG4gJiYgKF8gKz0gXCIgKHZpYSBgdG9GaXJlc3RvcmUoKWApXCIpLCBfICs9IFwiLiBcIjtcbiAgICBsZXQgYSA9IFwiXCI7XG4gICAgcmV0dXJuIChzIHx8IG8pICYmIChhICs9IFwiIChmb3VuZFwiLCBzICYmIChhICs9IGAgaW4gZmllbGQgJHtyfWApLCBvICYmIChhICs9IGAgaW4gZG9jdW1lbnQgJHtpfWApLCBcbiAgICBhICs9IFwiKVwiKSwgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXyArIGUgKyBhKTtcbn1cblxuLyoqIENoZWNrcyBgaGF5c3RhY2tgIGlmIEZpZWxkUGF0aCBgbmVlZGxlYCBpcyBwcmVzZW50LiBSdW5zIGluIE8obikuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maWVsZE1hc2tDb250YWlucyhlLCB0KSB7XG4gICAgcmV0dXJuIGUuc29tZSgoZSA9PiBlLmlzRXF1YWwodCkpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBgRG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyIEZpcmVzdG9yZVxuICogZGF0YWJhc2UuIFRoZSBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvXG4gKiBnZXQgYSBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBGb3IgYSBgRG9jdW1lbnRTbmFwc2hvdGAgdGhhdCBwb2ludHMgdG8gYSBub24tZXhpc3RpbmcgZG9jdW1lbnQsIGFueSBkYXRhXG4gKiBhY2Nlc3Mgd2lsbCByZXR1cm4gJ3VuZGVmaW5lZCcuIFlvdSBjYW4gdXNlIHRoZSBgZXhpc3RzKClgIG1ldGhvZCB0b1xuICogZXhwbGljaXRseSB2ZXJpZnkgYSBkb2N1bWVudCdzIGV4aXN0ZW5jZS5cbiAqLyBjbGFzcyBEb2N1bWVudFNuYXBzaG90JDEge1xuICAgIC8vIE5vdGU6IFRoaXMgY2xhc3MgaXMgc3RyaXBwZWQgZG93biB2ZXJzaW9uIG9mIHRoZSBEb2N1bWVudFNuYXBzaG90IGluXG4gICAgLy8gdGhlIGxlZ2FjeSBTREsuIFRoZSBjaGFuZ2VzIGFyZTpcbiAgICAvLyAtIE5vIHN1cHBvcnQgZm9yIFNuYXBzaG90TWV0YWRhdGEuXG4gICAgLy8gLSBObyBzdXBwb3J0IGZvciBTbmFwc2hvdE9wdGlvbnMuXG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgcHJvdGVjdGVkICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICB0aGlzLl9maXJlc3RvcmUgPSBlLCB0aGlzLl91c2VyRGF0YVdyaXRlciA9IHQsIHRoaXMuX2tleSA9IG4sIHRoaXMuX2RvY3VtZW50ID0gciwgXG4gICAgICAgIHRoaXMuX2NvbnZlcnRlciA9IGk7XG4gICAgfVxuICAgIC8qKiBQcm9wZXJ0eSBvZiB0aGUgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcHJvdmlkZXMgdGhlIGRvY3VtZW50J3MgSUQuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBgRG9jdW1lbnRSZWZlcmVuY2VgIGZvciB0aGUgZG9jdW1lbnQgaW5jbHVkZWQgaW4gdGhlIGBEb2N1bWVudFNuYXBzaG90YC5cbiAgICAgKi8gICAgZ2V0IHJlZigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLl9maXJlc3RvcmUsIHRoaXMuX2NvbnZlcnRlciwgdGhpcy5fa2V5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2lnbmFscyB3aGV0aGVyIG9yIG5vdCB0aGUgZG9jdW1lbnQgYXQgdGhlIHNuYXBzaG90J3MgbG9jYXRpb24gZXhpc3RzLlxuICAgICAqXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgZG9jdW1lbnQgZXhpc3RzLlxuICAgICAqLyAgICBleGlzdHMoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLl9kb2N1bWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBbiBgT2JqZWN0YCBjb250YWluaW5nIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IG9yIGB1bmRlZmluZWRgXG4gICAgICogaWYgdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICovICAgIGRhdGEoKSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbnZlcnRlcikge1xuICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgd2FudCB0byB1c2UgdGhlIGNvbnZlcnRlciBhbmQgY3JlYXRlIGEgbmV3IERvY3VtZW50U25hcHNob3RcbiAgICAgICAgICAgICAgICAvLyBpZiBhIGNvbnZlcnRlciBoYXMgYmVlbiBwcm92aWRlZC5cbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCQxKHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIHRoaXMuX2tleSwgdGhpcy5fZG9jdW1lbnQsIFxuICAgICAgICAgICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRlci5mcm9tRmlyZXN0b3JlKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZSh0aGlzLl9kb2N1bWVudC5kYXRhLnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGZpZWxkIHNwZWNpZmllZCBieSBgZmllbGRQYXRoYC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBvciBmaWVsZCBkb2Vzbid0IGV4aXN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIChmb3IgZXhhbXBsZSAnZm9vJyBvciAnZm9vLmJhcicpIHRvIGEgc3BlY2lmaWNcbiAgICAgKiBmaWVsZC5cbiAgICAgKiBAcmV0dXJucyBUaGUgZGF0YSBhdCB0aGUgc3BlY2lmaWVkIGZpZWxkIGxvY2F0aW9uIG9yIHVuZGVmaW5lZCBpZiBubyBzdWNoXG4gICAgICogZmllbGQgZXhpc3RzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICAvLyBXZSBhcmUgdXNpbmcgYGFueWAgaGVyZSB0byBhdm9pZCBhbiBleHBsaWNpdCBjYXN0IGJ5IG91ciB1c2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGdldChlKSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuX2RvY3VtZW50LmRhdGEuZmllbGQoX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudChcIkRvY3VtZW50U25hcHNob3QuZ2V0XCIsIGUpKTtcbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0KSByZXR1cm4gdGhpcy5fdXNlckRhdGFXcml0ZXIuY29udmVydFZhbHVlKHQpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UgYXMgcGFydCBvZiBhIHF1ZXJ5LiBUaGUgZG9jdW1lbnQgaXMgZ3VhcmFudGVlZCB0byBleGlzdFxuICogYW5kIGl0cyBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvIGdldCBhXG4gKiBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIG9mZmVycyB0aGUgc2FtZSBBUEkgc3VyZmFjZSBhcyBhXG4gKiBgRG9jdW1lbnRTbmFwc2hvdGAuIFNpbmNlIHF1ZXJ5IHJlc3VsdHMgY29udGFpbiBvbmx5IGV4aXN0aW5nIGRvY3VtZW50cywgdGhlXG4gKiBgZXhpc3RzYCBwcm9wZXJ0eSB3aWxsIGFsd2F5cyBiZSB0cnVlIGFuZCBgZGF0YSgpYCB3aWxsIG5ldmVyIHJldHVyblxuICogJ3VuZGVmaW5lZCcuXG4gKi8gY2xhc3MgUXVlcnlEb2N1bWVudFNuYXBzaG90JDEgZXh0ZW5kcyBEb2N1bWVudFNuYXBzaG90JDEge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBhcyBhbiBgT2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBvdmVycmlkZVxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRhdGEoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRoYXQgY2FsbHMgYGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoKWAgYnV0IHdyYXBzIGFueSBlcnJvciB0aHJvd24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudChlLCB0KSB7XG4gICAgcmV0dXJuIFwic3RyaW5nXCIgPT0gdHlwZW9mIHQgPyBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbURvdFNlcGFyYXRlZFN0cmluZyhlLCB0KSA6IHQgaW5zdGFuY2VvZiBGaWVsZFBhdGggPyB0Ll9pbnRlcm5hbFBhdGggOiB0Ll9kZWxlZ2F0ZS5faW50ZXJuYWxQYXRoO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVIYXNFeHBsaWNpdE9yZGVyQnlGb3JMaW1pdFRvTGFzdChlKSB7XG4gICAgaWYgKFwiTFwiIC8qIExpbWl0VHlwZS5MYXN0ICovID09PSBlLmxpbWl0VHlwZSAmJiAwID09PSBlLmV4cGxpY2l0T3JkZXJCeS5sZW5ndGgpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELlVOSU1QTEVNRU5URUQsIFwibGltaXRUb0xhc3QoKSBxdWVyaWVzIHJlcXVpcmUgc3BlY2lmeWluZyBhdCBsZWFzdCBvbmUgb3JkZXJCeSgpIGNsYXVzZVwiKTtcbn1cblxuLyoqXG4gKiBBbiBgQXBwbGlhYmxlQ29uc3RyYWludGAgaXMgYW4gYWJzdHJhY3Rpb24gb2YgYSBjb25zdHJhaW50IHRoYXQgY2FuIGJlIGFwcGxpZWRcbiAqIHRvIGEgRmlyZXN0b3JlIHF1ZXJ5LlxuICovIGNsYXNzIEFwcGxpYWJsZUNvbnN0cmFpbnQge31cblxuLyoqXG4gKiBBIGBRdWVyeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5IGFcbiAqIEZpcmVzdG9yZSBxdWVyeS4gYFF1ZXJ5Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayB3aGVyZX0sXG4gKiB7QGxpbmsgb3JkZXJCeX0sIHtAbGluayAoc3RhcnRBdDoxKX0sIHtAbGluayAoc3RhcnRBZnRlcjoxKX0sIHtAbGlua1xuICogKGVuZEJlZm9yZToxKX0sIHtAbGluayAoZW5kQXQ6MSl9LCB7QGxpbmsgbGltaXR9LCB7QGxpbmsgbGltaXRUb0xhc3R9IGFuZFxuICogY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhIG5ldyBxdWVyeSBpbnN0YW5jZSB0aGF0XG4gKiBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5Q29uc3RyYWludGAuXG4gKi8gY2xhc3MgUXVlcnlDb25zdHJhaW50IGV4dGVuZHMgQXBwbGlhYmxlQ29uc3RyYWludCB7fVxuXG5mdW5jdGlvbiBxdWVyeShlLCB0LCAuLi5uKSB7XG4gICAgbGV0IHIgPSBbXTtcbiAgICB0IGluc3RhbmNlb2YgQXBwbGlhYmxlQ29uc3RyYWludCAmJiByLnB1c2godCksIHIgPSByLmNvbmNhdChuKSwgZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlUXVlcnlDb25zdHJhaW50QXJyYXkoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5maWx0ZXIoKGUgPT4gZSBpbnN0YW5jZW9mIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludCkpLmxlbmd0aCwgbiA9IGUuZmlsdGVyKChlID0+IGUgaW5zdGFuY2VvZiBRdWVyeUZpZWxkRmlsdGVyQ29uc3RyYWludCkpLmxlbmd0aDtcbiAgICAgICAgaWYgKHQgPiAxIHx8IHQgPiAwICYmIG4gPiAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBcIkludmFsaWRRdWVyeS4gV2hlbiB1c2luZyBjb21wb3NpdGUgZmlsdGVycywgeW91IGNhbm5vdCB1c2UgbW9yZSB0aGFuIG9uZSBmaWx0ZXIgYXQgdGhlIHRvcCBsZXZlbC4gQ29uc2lkZXIgbmVzdGluZyB0aGUgbXVsdGlwbGUgZmlsdGVycyB3aXRoaW4gYW4gYGFuZCguLi4pYCBzdGF0ZW1lbnQuIEZvciBleGFtcGxlOiBjaGFuZ2UgYHF1ZXJ5KHF1ZXJ5LCB3aGVyZSguLi4pLCBvciguLi4pKWAgdG8gYHF1ZXJ5KHF1ZXJ5LCBhbmQod2hlcmUoLi4uKSwgb3IoLi4uKSkpYC5cIik7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLyoqXG4gKiBDb252ZXJ0cyBGaXJlc3RvcmUncyBpbnRlcm5hbCB0eXBlcyB0byB0aGUgSmF2YVNjcmlwdCB0eXBlcyB0aGF0IHdlIGV4cG9zZVxuICogdG8gdGhlIHVzZXIuXG4gKlxuICogQGludGVybmFsXG4gKi8gKHIpO1xuICAgIGZvciAoY29uc3QgdCBvZiByKSBlID0gdC5fYXBwbHkoZSk7XG4gICAgcmV0dXJuIGU7XG59XG5cbi8qKlxuICogQSBgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5XG4gKiBhIEZpcmVzdG9yZSBxdWVyeSBieSBmaWx0ZXJpbmcgb24gb25lIG9yIG1vcmUgZG9jdW1lbnQgZmllbGRzLlxuICogYFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIHdoZXJlfSBhbmQgY2FuIHRoZW5cbiAqIGJlIHBhc3NlZCB0byB7QGxpbmsgKHF1ZXJ5OjEpfSB0byBjcmVhdGUgYSBuZXcgcXVlcnkgaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zXG4gKiB0aGlzIGBRdWVyeUZpZWxkRmlsdGVyQ29uc3RyYWludGAuXG4gKi8gY2xhc3MgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5fZmllbGQgPSBlLCB0aGlzLl9vcCA9IHQsIHRoaXMuX3ZhbHVlID0gbiwgXG4gICAgICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJ3aGVyZVwiO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQoZSwgdCwgbik7XG4gICAgfVxuICAgIF9hcHBseShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLl9wYXJzZShlKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZU5ld0ZpZWxkRmlsdGVyKGUuX3F1ZXJ5LCB0KSwgbmV3IFF1ZXJ5KGUuZmlyZXN0b3JlLCBlLmNvbnZlcnRlciwgX19QUklWQVRFX3F1ZXJ5V2l0aEFkZGVkRmlsdGVyKGUuX3F1ZXJ5LCB0KSk7XG4gICAgfVxuICAgIF9wYXJzZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZS5maXJlc3RvcmUpLCBuID0gZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5RmlsdGVyKGUsIHQsIG4sIHIsIGksIHMsIG8pIHtcbiAgICAgICAgICAgIGxldCBfO1xuICAgICAgICAgICAgaWYgKGkuaXNLZXlGaWVsZCgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA9PT0gcyB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gcykgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgUXVlcnkuIFlvdSBjYW4ndCBwZXJmb3JtICcke3N9JyBxdWVyaWVzIG9uIGRvY3VtZW50SWQoKS5gKTtcbiAgICAgICAgICAgICAgICBpZiAoXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSBzIHx8IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSBzKSB7XG4gICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV92YWxpZGF0ZURpc2p1bmN0aXZlRmlsdGVyRWxlbWVudHMobywgcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIG8pIHQucHVzaChfX1BSSVZBVEVfcGFyc2VEb2N1bWVudElkVmFsdWUociwgZSwgbikpO1xuICAgICAgICAgICAgICAgICAgICBfID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogdFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBfID0gX19QUklWQVRFX3BhcnNlRG9jdW1lbnRJZFZhbHVlKHIsIGUsIG8pO1xuICAgICAgICAgICAgfSBlbHNlIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAhPT0gcyAmJiBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAhPT0gcyAmJiBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyAhPT0gcyB8fCBfX1BSSVZBVEVfdmFsaWRhdGVEaXNqdW5jdGl2ZUZpbHRlckVsZW1lbnRzKG8sIHMpLCBcbiAgICAgICAgICAgIF8gPSBfX1BSSVZBVEVfcGFyc2VRdWVyeVZhbHVlKG4sIHQsIG8sIFxuICAgICAgICAgICAgLyogYWxsb3dBcnJheXM9ICovIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA9PT0gcyB8fCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA9PT0gcyk7XG4gICAgICAgICAgICByZXR1cm4gRmllbGRGaWx0ZXIuY3JlYXRlKGksIHMsIF8pO1xuICAgICAgICB9KGUuX3F1ZXJ5LCBcIndoZXJlXCIsIHQsIGUuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCB0aGlzLl9maWVsZCwgdGhpcy5fb3AsIHRoaXMuX3ZhbHVlKTtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnR9IHRoYXQgZW5mb3JjZXMgdGhhdCBkb2N1bWVudHNcbiAqIG11c3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIGZpZWxkIGFuZCB0aGF0IHRoZSB2YWx1ZSBzaG91bGQgc2F0aXNmeSB0aGVcbiAqIHJlbGF0aW9uIGNvbnN0cmFpbnQgcHJvdmlkZWQuXG4gKlxuICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIHRvIGNvbXBhcmVcbiAqIEBwYXJhbSBvcFN0ciAtIFRoZSBvcGVyYXRpb24gc3RyaW5nIChlLmcgXCImbHQ7XCIsIFwiJmx0Oz1cIiwgXCI9PVwiLCBcIiZsdDtcIixcbiAqICAgXCImbHQ7PVwiLCBcIiE9XCIpLlxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIGZvciBjb21wYXJpc29uXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIHdoZXJlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gdCwgaSA9IF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQoXCJ3aGVyZVwiLCBlKTtcbiAgICByZXR1cm4gUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShpLCByLCBuKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzXG4gKiByZXR1cm5lZCBieSBhIEZpcmVzdG9yZSBxdWVyeSBieSBwZXJmb3JtaW5nIHRoZSBsb2dpY2FsIE9SIG9yIEFORCBvZiBtdWx0aXBsZVxuICoge0BsaW5rIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50fXMgb3Ige0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH1zLlxuICogYFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayBvcn0gb3JcbiAqIHtAbGluayBhbmR9IGFuZCBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIChxdWVyeToxKX0gdG8gY3JlYXRlIGEgbmV3IHF1ZXJ5XG4gKiBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhlIGBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludCBleHRlbmRzIEFwcGxpYWJsZUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICBlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IGUsIHRoaXMuX3F1ZXJ5Q29uc3RyYWludHMgPSB0O1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50KGUsIHQpO1xuICAgIH1cbiAgICBfcGFyc2UoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5fcXVlcnlDb25zdHJhaW50cy5tYXAoKHQgPT4gdC5fcGFyc2UoZSkpKS5maWx0ZXIoKGUgPT4gZS5nZXRGaWx0ZXJzKCkubGVuZ3RoID4gMCkpO1xuICAgICAgICByZXR1cm4gMSA9PT0gdC5sZW5ndGggPyB0WzBdIDogQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZSh0LCB0aGlzLl9nZXRPcGVyYXRvcigpKTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuX3BhcnNlKGUpO1xuICAgICAgICByZXR1cm4gMCA9PT0gdC5nZXRGaWx0ZXJzKCkubGVuZ3RoID8gZSA6IChmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVOZXdGaWx0ZXIoZSwgdCkge1xuICAgICAgICAgICAgbGV0IG4gPSBlO1xuICAgICAgICAgICAgY29uc3QgciA9IHQuZ2V0RmxhdHRlbmVkRmlsdGVycygpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHIpIF9fUFJJVkFURV92YWxpZGF0ZU5ld0ZpZWxkRmlsdGVyKG4sIGUpLCBuID0gX19QUklWQVRFX3F1ZXJ5V2l0aEFkZGVkRmlsdGVyKG4sIGUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrcyBpZiBhbnkgb2YgdGhlIHByb3ZpZGVkIGZpbHRlciBvcGVyYXRvcnMgYXJlIGluY2x1ZGVkIGluIHRoZSBnaXZlbiBsaXN0IG9mIGZpbHRlcnMgYW5kXG4gICAgICAgIC8vIHJldHVybnMgdGhlIGZpcnN0IG9uZSB0aGF0IGlzLCBvciBudWxsIGlmIG5vbmUgYXJlLlxuICAgICAgICAoZS5fcXVlcnksIHQpLCBuZXcgUXVlcnkoZS5maXJlc3RvcmUsIGUuY29udmVydGVyLCBfX1BSSVZBVEVfcXVlcnlXaXRoQWRkZWRGaWx0ZXIoZS5fcXVlcnksIHQpKSk7XG4gICAgfVxuICAgIF9nZXRRdWVyeUNvbnN0cmFpbnRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnlDb25zdHJhaW50cztcbiAgICB9XG4gICAgX2dldE9wZXJhdG9yKCkge1xuICAgICAgICByZXR1cm4gXCJhbmRcIiA9PT0gdGhpcy50eXBlID8gXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8gOiBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi87XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcge0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH0gdGhhdCBpcyBhIGRpc2p1bmN0aW9uIG9mXG4gKiB0aGUgZ2l2ZW4gZmlsdGVyIGNvbnN0cmFpbnRzLiBBIGRpc2p1bmN0aW9uIGZpbHRlciBpbmNsdWRlcyBhIGRvY3VtZW50IGlmIGl0XG4gKiBzYXRpc2ZpZXMgYW55IG9mIHRoZSBnaXZlbiBmaWx0ZXJzLlxuICpcbiAqIEBwYXJhbSBxdWVyeUNvbnN0cmFpbnRzIC0gT3B0aW9uYWwuIFRoZSBsaXN0IG9mXG4gKiB7QGxpbmsgUXVlcnlGaWx0ZXJDb25zdHJhaW50fXMgdG8gcGVyZm9ybSBhIGRpc2p1bmN0aW9uIGZvci4gVGhlc2UgbXVzdCBiZVxuICogY3JlYXRlZCB3aXRoIGNhbGxzIHRvIHtAbGluayB3aGVyZX0sIHtAbGluayBvcn0sIG9yIHtAbGluayBhbmR9LlxuICogQHJldHVybnMgVGhlIG5ld2x5IGNyZWF0ZWQge0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH0uXG4gKi8gZnVuY3Rpb24gb3IoLi4uZSkge1xuICAgIC8vIE9ubHkgc3VwcG9ydCBRdWVyeUZpbHRlckNvbnN0cmFpbnRzXG4gICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiBfX1BSSVZBVEVfdmFsaWRhdGVRdWVyeUZpbHRlckNvbnN0cmFpbnQoXCJvclwiLCBlKSkpLCBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8gLCBlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9IHRoYXQgaXMgYSBjb25qdW5jdGlvbiBvZlxuICogdGhlIGdpdmVuIGZpbHRlciBjb25zdHJhaW50cy4gQSBjb25qdW5jdGlvbiBmaWx0ZXIgaW5jbHVkZXMgYSBkb2N1bWVudCBpZiBpdFxuICogc2F0aXNmaWVzIGFsbCBvZiB0aGUgZ2l2ZW4gZmlsdGVycy5cbiAqXG4gKiBAcGFyYW0gcXVlcnlDb25zdHJhaW50cyAtIE9wdGlvbmFsLiBUaGUgbGlzdCBvZlxuICoge0BsaW5rIFF1ZXJ5RmlsdGVyQ29uc3RyYWludH1zIHRvIHBlcmZvcm0gYSBjb25qdW5jdGlvbiBmb3IuIFRoZXNlIG11c3QgYmVcbiAqIGNyZWF0ZWQgd2l0aCBjYWxscyB0byB7QGxpbmsgd2hlcmV9LCB7QGxpbmsgb3J9LCBvciB7QGxpbmsgYW5kfS5cbiAqIEByZXR1cm5zIFRoZSBuZXdseSBjcmVhdGVkIHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIGFuZCguLi5lKSB7XG4gICAgLy8gT25seSBzdXBwb3J0IFF1ZXJ5RmlsdGVyQ29uc3RyYWludHNcbiAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IF9fUFJJVkFURV92YWxpZGF0ZVF1ZXJ5RmlsdGVyQ29uc3RyYWludChcImFuZFwiLCBlKSkpLCBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyAsIGUpO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gc29ydCB0aGUgc2V0IG9mIGRvY3VtZW50cyByZXR1cm5lZCBieSBhXG4gKiBGaXJlc3RvcmUgcXVlcnkuIGBRdWVyeU9yZGVyQnlDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmdcbiAqIHtAbGluayBvcmRlckJ5fSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhIG5ldyBxdWVyeVxuICogaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnRgLlxuICpcbiAqIE5vdGU6IERvY3VtZW50cyB0aGF0IGRvIG5vdCBjb250YWluIHRoZSBvcmRlckJ5IGZpZWxkIHdpbGwgbm90IGJlIHByZXNlbnQgaW5cbiAqIHRoZSBxdWVyeSByZXN1bHQuXG4gKi8gY2xhc3MgUXVlcnlPcmRlckJ5Q29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLl9maWVsZCA9IGUsIHRoaXMuX2RpcmVjdGlvbiA9IHQsIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwib3JkZXJCeVwiO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlPcmRlckJ5Q29uc3RyYWludChlLCB0KTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeU9yZGVyQnkoZSwgdCwgbikge1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IGUuc3RhcnRBdCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBZb3UgbXVzdCBub3QgY2FsbCBzdGFydEF0KCkgb3Igc3RhcnRBZnRlcigpIGJlZm9yZSBjYWxsaW5nIG9yZGVyQnkoKS5cIik7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gZS5lbmRBdCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBZb3UgbXVzdCBub3QgY2FsbCBlbmRBdCgpIG9yIGVuZEJlZm9yZSgpIGJlZm9yZSBjYWxsaW5nIG9yZGVyQnkoKS5cIik7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE9yZGVyQnkodCwgbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBDcmVhdGUgYSBgQm91bmRgIGZyb20gYSBxdWVyeSBhbmQgYSBkb2N1bWVudC5cbiAqXG4gKiBOb3RlIHRoYXQgdGhlIGBCb3VuZGAgd2lsbCBhbHdheXMgaW5jbHVkZSB0aGUga2V5IG9mIHRoZSBkb2N1bWVudFxuICogYW5kIHNvIG9ubHkgdGhlIHByb3ZpZGVkIGRvY3VtZW50IHdpbGwgY29tcGFyZSBlcXVhbCB0byB0aGUgcmV0dXJuZWRcbiAqIHBvc2l0aW9uLlxuICpcbiAqIFdpbGwgdGhyb3cgaWYgdGhlIGRvY3VtZW50IGRvZXMgbm90IGNvbnRhaW4gYWxsIGZpZWxkcyBvZiB0aGUgb3JkZXIgYnlcbiAqIG9mIHRoZSBxdWVyeSBvciBpZiBhbnkgb2YgdGhlIGZpZWxkcyBpbiB0aGUgb3JkZXIgYnkgYXJlIGFuIHVuY29tbWl0dGVkXG4gKiBzZXJ2ZXIgdGltZXN0YW1wLlxuICovIChlLl9xdWVyeSwgdGhpcy5fZmllbGQsIHRoaXMuX2RpcmVjdGlvbik7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnkoZS5maXJlc3RvcmUsIGUuY29udmVydGVyLCBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlXaXRoQWRkZWRPcmRlckJ5KGUsIHQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oZGltb25kKTogdmFsaWRhdGUgdGhhdCBvcmRlckJ5IGRvZXMgbm90IGxpc3QgdGhlIHNhbWUga2V5IHR3aWNlLlxuICAgICAgICAgICAgY29uc3QgbiA9IGUuZXhwbGljaXRPcmRlckJ5LmNvbmNhdChbIHQgXSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgbiwgZS5maWx0ZXJzLnNsaWNlKCksIGUubGltaXQsIGUubGltaXRUeXBlLCBlLnN0YXJ0QXQsIGUuZW5kQXQpO1xuICAgICAgICB9KGUuX3F1ZXJ5LCB0KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUXVlcnlPcmRlckJ5Q29uc3RyYWludH0gdGhhdCBzb3J0cyB0aGUgcXVlcnkgcmVzdWx0IGJ5IHRoZVxuICogc3BlY2lmaWVkIGZpZWxkLCBvcHRpb25hbGx5IGluIGRlc2NlbmRpbmcgb3JkZXIgaW5zdGVhZCBvZiBhc2NlbmRpbmcuXG4gKlxuICogTm90ZTogRG9jdW1lbnRzIHRoYXQgZG8gbm90IGNvbnRhaW4gdGhlIHNwZWNpZmllZCBmaWVsZCB3aWxsIG5vdCBiZSBwcmVzZW50XG4gKiBpbiB0aGUgcXVlcnkgcmVzdWx0LlxuICpcbiAqIEBwYXJhbSBmaWVsZFBhdGggLSBUaGUgZmllbGQgdG8gc29ydCBieS5cbiAqIEBwYXJhbSBkaXJlY3Rpb25TdHIgLSBPcHRpb25hbCBkaXJlY3Rpb24gdG8gc29ydCBieSAoJ2FzYycgb3IgJ2Rlc2MnKS4gSWZcbiAqIG5vdCBzcGVjaWZpZWQsIG9yZGVyIHdpbGwgYmUgYXNjZW5kaW5nLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQge0BsaW5rIFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIG9yZGVyQnkoZSwgdCA9IFwiYXNjXCIpIHtcbiAgICBjb25zdCBuID0gdCwgciA9IF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQoXCJvcmRlckJ5XCIsIGUpO1xuICAgIHJldHVybiBRdWVyeU9yZGVyQnlDb25zdHJhaW50Ll9jcmVhdGUociwgbik7XG59XG5cbi8qKlxuICogQSBgUXVlcnlMaW1pdENvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbGltaXQgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgcmV0dXJuZWQgYnlcbiAqIGEgRmlyZXN0b3JlIHF1ZXJ5LlxuICogYFF1ZXJ5TGltaXRDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIGxpbWl0fSBvclxuICoge0BsaW5rIGxpbWl0VG9MYXN0fSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhIG5ld1xuICogcXVlcnkgaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5TGltaXRDb25zdHJhaW50YC5cbiAqLyBjbGFzcyBRdWVyeUxpbWl0Q29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgcXVlcnkgY29uc3RyYWludCAqL1xuICAgIGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy50eXBlID0gZSwgdGhpcy5fbGltaXQgPSB0LCB0aGlzLl9saW1pdFR5cGUgPSBuO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlMaW1pdENvbnN0cmFpbnQoZSwgdCwgbik7XG4gICAgfVxuICAgIF9hcHBseShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnkoZS5maXJlc3RvcmUsIGUuY29udmVydGVyLCBfX1BSSVZBVEVfcXVlcnlXaXRoTGltaXQoZS5fcXVlcnksIHRoaXMuX2xpbWl0LCB0aGlzLl9saW1pdFR5cGUpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIHtAbGluayBRdWVyeUxpbWl0Q29uc3RyYWludH0gdGhhdCBvbmx5IHJldHVybnMgdGhlIGZpcnN0IG1hdGNoaW5nXG4gKiBkb2N1bWVudHMuXG4gKlxuICogQHBhcmFtIGxpbWl0IC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIHRvIHJldHVybi5cbiAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIHtAbGluayBRdWVyeUxpbWl0Q29uc3RyYWludH0uXG4gKi8gZnVuY3Rpb24gbGltaXQoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVQb3NpdGl2ZU51bWJlcihcImxpbWl0XCIsIGUpLCBRdWVyeUxpbWl0Q29uc3RyYWludC5fY3JlYXRlKFwibGltaXRcIiwgZSwgXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5TGltaXRDb25zdHJhaW50fSB0aGF0IG9ubHkgcmV0dXJucyB0aGUgbGFzdCBtYXRjaGluZ1xuICogZG9jdW1lbnRzLlxuICpcbiAqIFlvdSBtdXN0IHNwZWNpZnkgYXQgbGVhc3Qgb25lIGBvcmRlckJ5YCBjbGF1c2UgZm9yIGBsaW1pdFRvTGFzdGAgcXVlcmllcyxcbiAqIG90aGVyd2lzZSBhbiBleGNlcHRpb24gd2lsbCBiZSB0aHJvd24gZHVyaW5nIGV4ZWN1dGlvbi5cbiAqXG4gKiBAcGFyYW0gbGltaXQgLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgaXRlbXMgdG8gcmV0dXJuLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQge0BsaW5rIFF1ZXJ5TGltaXRDb25zdHJhaW50fS5cbiAqLyBmdW5jdGlvbiBsaW1pdFRvTGFzdChlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZVBvc2l0aXZlTnVtYmVyKFwibGltaXRUb0xhc3RcIiwgZSksIFF1ZXJ5TGltaXRDb25zdHJhaW50Ll9jcmVhdGUoXCJsaW1pdFRvTGFzdFwiLCBlLCBcIkxcIiAvKiBMaW1pdFR5cGUuTGFzdCAqLyk7XG59XG5cbi8qKlxuICogQSBgUXVlcnlTdGFydEF0Q29uc3RyYWludGAgaXMgdXNlZCB0byBleGNsdWRlIGRvY3VtZW50cyBmcm9tIHRoZSBzdGFydCBvZiBhXG4gKiByZXN1bHQgc2V0IHJldHVybmVkIGJ5IGEgRmlyZXN0b3JlIHF1ZXJ5LlxuICogYFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnRgcyBhcmUgY3JlYXRlZCBieSBpbnZva2luZyB7QGxpbmsgKHN0YXJ0QXQ6MSl9IG9yXG4gKiB7QGxpbmsgKHN0YXJ0QWZ0ZXI6MSl9IGFuZCBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIChxdWVyeToxKX0gdG8gY3JlYXRlIGFcbiAqIG5ldyBxdWVyeSBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhpcyBgUXVlcnlTdGFydEF0Q29uc3RyYWludGAuXG4gKi8gY2xhc3MgUXVlcnlTdGFydEF0Q29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgcXVlcnkgY29uc3RyYWludCAqL1xuICAgIGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy50eXBlID0gZSwgdGhpcy5fZG9jT3JGaWVsZHMgPSB0LCB0aGlzLl9pbmNsdXNpdmUgPSBuO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlTdGFydEF0Q29uc3RyYWludChlLCB0LCBuKTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9uZXdRdWVyeUJvdW5kRnJvbURvY09yRmllbGRzKGUsIHRoaXMudHlwZSwgdGhpcy5fZG9jT3JGaWVsZHMsIHRoaXMuX2luY2x1c2l2ZSk7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnkoZS5maXJlc3RvcmUsIGUuY29udmVydGVyLCBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlXaXRoU3RhcnRBdChlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgZS5maWx0ZXJzLnNsaWNlKCksIGUubGltaXQsIGUubGltaXRUeXBlLCB0LCBlLmVuZEF0KTtcbiAgICAgICAgfShlLl9xdWVyeSwgdCkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc3RhcnRBdCguLi5lKSB7XG4gICAgcmV0dXJuIFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnQuX2NyZWF0ZShcInN0YXJ0QXRcIiwgZSwgXG4gICAgLyppbmNsdXNpdmU9Ki8gITApO1xufVxuXG5mdW5jdGlvbiBzdGFydEFmdGVyKC4uLmUpIHtcbiAgICByZXR1cm4gUXVlcnlTdGFydEF0Q29uc3RyYWludC5fY3JlYXRlKFwic3RhcnRBZnRlclwiLCBlLCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMSk7XG59XG5cbi8qKlxuICogQSBgUXVlcnlFbmRBdENvbnN0cmFpbnRgIGlzIHVzZWQgdG8gZXhjbHVkZSBkb2N1bWVudHMgZnJvbSB0aGUgZW5kIG9mIGFcbiAqIHJlc3VsdCBzZXQgcmV0dXJuZWQgYnkgYSBGaXJlc3RvcmUgcXVlcnkuXG4gKiBgUXVlcnlFbmRBdENvbnN0cmFpbnRgcyBhcmUgY3JlYXRlZCBieSBpbnZva2luZyB7QGxpbmsgKGVuZEF0OjEpfSBvclxuICoge0BsaW5rIChlbmRCZWZvcmU6MSl9IGFuZCBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIChxdWVyeToxKX0gdG8gY3JlYXRlIGEgbmV3XG4gKiBxdWVyeSBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhpcyBgUXVlcnlFbmRBdENvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5RW5kQXRDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgZSwgdCwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnR5cGUgPSBlLCB0aGlzLl9kb2NPckZpZWxkcyA9IHQsIHRoaXMuX2luY2x1c2l2ZSA9IG47XG4gICAgfVxuICAgIHN0YXRpYyBfY3JlYXRlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUVuZEF0Q29uc3RyYWludChlLCB0LCBuKTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9uZXdRdWVyeUJvdW5kRnJvbURvY09yRmllbGRzKGUsIHRoaXMudHlwZSwgdGhpcy5fZG9jT3JGaWVsZHMsIHRoaXMuX2luY2x1c2l2ZSk7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnkoZS5maXJlc3RvcmUsIGUuY29udmVydGVyLCBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlXaXRoRW5kQXQoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIGUuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIGUuZmlsdGVycy5zbGljZSgpLCBlLmxpbWl0LCBlLmxpbWl0VHlwZSwgZS5zdGFydEF0LCB0KTtcbiAgICAgICAgfShlLl9xdWVyeSwgdCkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZW5kQmVmb3JlKC4uLmUpIHtcbiAgICByZXR1cm4gUXVlcnlFbmRBdENvbnN0cmFpbnQuX2NyZWF0ZShcImVuZEJlZm9yZVwiLCBlLCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMSk7XG59XG5cbmZ1bmN0aW9uIGVuZEF0KC4uLmUpIHtcbiAgICByZXR1cm4gUXVlcnlFbmRBdENvbnN0cmFpbnQuX2NyZWF0ZShcImVuZEF0XCIsIGUsIFxuICAgIC8qaW5jbHVzaXZlPSovICEwKTtcbn1cblxuLyoqIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgYSBib3VuZCBmcm9tIGEgZG9jdW1lbnQgb3IgZmllbGRzICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeUJvdW5kRnJvbURvY09yRmllbGRzKGUsIHQsIG4sIHIpIHtcbiAgICBpZiAoblswXSA9IGdldE1vZHVsYXJJbnN0YW5jZShuWzBdKSwgblswXSBpbnN0YW5jZW9mIERvY3VtZW50U25hcHNob3QkMSkgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeUJvdW5kRnJvbURvY3VtZW50KGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgaWYgKCFyKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5OT1RfRk9VTkQsIGBDYW4ndCB1c2UgYSBEb2N1bWVudFNuYXBzaG90IHRoYXQgZG9lc24ndCBleGlzdCBmb3IgJHtufSgpLmApO1xuICAgICAgICBjb25zdCBzID0gW107XG4gICAgICAgIC8vIEJlY2F1c2UgcGVvcGxlIGV4cGVjdCB0byBjb250aW51ZS9lbmQgYSBxdWVyeSBhdCB0aGUgZXhhY3QgZG9jdW1lbnRcbiAgICAgICAgLy8gcHJvdmlkZWQsIHdlIG5lZWQgdG8gdXNlIHRoZSBpbXBsaWNpdCBzb3J0IG9yZGVyIHJhdGhlciB0aGFuIHRoZSBleHBsaWNpdFxuICAgICAgICAvLyBzb3J0IG9yZGVyLCBiZWNhdXNlIGl0J3MgZ3VhcmFudGVlZCB0byBjb250YWluIHRoZSBkb2N1bWVudCBrZXkuIFRoYXQgd2F5XG4gICAgICAgIC8vIHRoZSBwb3NpdGlvbiBiZWNvbWVzIHVuYW1iaWd1b3VzIGFuZCB0aGUgcXVlcnkgY29udGludWVzL2VuZHMgZXhhY3RseSBhdFxuICAgICAgICAvLyB0aGUgcHJvdmlkZWQgZG9jdW1lbnQuIFdpdGhvdXQgdGhlIGtleSAoYnkgdXNpbmcgdGhlIGV4cGxpY2l0IHNvcnRcbiAgICAgICAgLy8gb3JkZXJzKSwgbXVsdGlwbGUgZG9jdW1lbnRzIGNvdWxkIG1hdGNoIHRoZSBwb3NpdGlvbiwgeWllbGRpbmcgZHVwbGljYXRlXG4gICAgICAgIC8vIHJlc3VsdHMuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIF9fUFJJVkFURV9xdWVyeU5vcm1hbGl6ZWRPcmRlckJ5KGUpKSBpZiAobi5maWVsZC5pc0tleUZpZWxkKCkpIHMucHVzaChfX1BSSVZBVEVfcmVmVmFsdWUodCwgci5rZXkpKTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gci5kYXRhLmZpZWxkKG4uZmllbGQpO1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcChlKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgJ0ludmFsaWQgcXVlcnkuIFlvdSBhcmUgdHJ5aW5nIHRvIHN0YXJ0IG9yIGVuZCBhIHF1ZXJ5IHVzaW5nIGEgZG9jdW1lbnQgZm9yIHdoaWNoIHRoZSBmaWVsZCBcIicgKyBuLmZpZWxkICsgJ1wiIGlzIGFuIHVuY29tbWl0dGVkIHNlcnZlciB0aW1lc3RhbXAuIChTaW5jZSB0aGUgdmFsdWUgb2YgdGhpcyBmaWVsZCBpcyB1bmtub3duLCB5b3UgY2Fubm90IHN0YXJ0L2VuZCBhIHF1ZXJ5IHdpdGggaXQuKScpO1xuICAgICAgICAgICAgaWYgKG51bGwgPT09IGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbi5maWVsZC5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGFyZSB0cnlpbmcgdG8gc3RhcnQgb3IgZW5kIGEgcXVlcnkgdXNpbmcgYSBkb2N1bWVudCBmb3Igd2hpY2ggdGhlIGZpZWxkICcke2V9JyAodXNlZCBhcyB0aGUgb3JkZXJCeSkgZG9lcyBub3QgZXhpc3QuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzLnB1c2goZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBCb3VuZChzLCBpKTtcbiAgICB9XG4gICAgLyoqXG4gKiBDb252ZXJ0cyBhIGxpc3Qgb2YgZmllbGQgdmFsdWVzIHRvIGEgYEJvdW5kYCBmb3IgdGhlIGdpdmVuIHF1ZXJ5LlxuICovIChlLl9xdWVyeSwgZS5maXJlc3RvcmUuX2RhdGFiYXNlSWQsIHQsIG5bMF0uX2RvY3VtZW50LCByKTtcbiAgICB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZS5maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5Qm91bmRGcm9tRmllbGRzKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgICAgIC8vIFVzZSBleHBsaWNpdCBvcmRlciBieSdzIGJlY2F1c2UgaXQgaGFzIHRvIG1hdGNoIHRoZSBxdWVyeSB0aGUgdXNlciBtYWRlXG4gICAgICAgICAgICBjb25zdCBvID0gZS5leHBsaWNpdE9yZGVyQnk7XG4gICAgICAgICAgICBpZiAoaS5sZW5ndGggPiBvLmxlbmd0aCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYFRvbyBtYW55IGFyZ3VtZW50cyBwcm92aWRlZCB0byAke3J9KCkuIFRoZSBudW1iZXIgb2YgYXJndW1lbnRzIG11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygb3JkZXJCeSgpIGNsYXVzZXNgKTtcbiAgICAgICAgICAgIGNvbnN0IF8gPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgaS5sZW5ndGg7IHMrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBpW3NdO1xuICAgICAgICAgICAgICAgIGlmIChvW3NdLmZpZWxkLmlzS2V5RmllbGQoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgYSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIEV4cGVjdGVkIGEgc3RyaW5nIGZvciBkb2N1bWVudCBJRCBpbiAke3J9KCksIGJ1dCBnb3QgYSAke3R5cGVvZiBhfWApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIV9fUFJJVkFURV9pc0NvbGxlY3Rpb25Hcm91cFF1ZXJ5KGUpICYmIC0xICE9PSBhLmluZGV4T2YoXCIvXCIpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyBhIGNvbGxlY3Rpb24gYW5kIG9yZGVyaW5nIGJ5IGRvY3VtZW50SWQoKSwgdGhlIHZhbHVlIHBhc3NlZCB0byAke3J9KCkgbXVzdCBiZSBhIHBsYWluIGRvY3VtZW50IElELCBidXQgJyR7YX0nIGNvbnRhaW5zIGEgc2xhc2guYCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlLnBhdGguY2hpbGQoUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoYSkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIURvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkobikpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIGEgY29sbGVjdGlvbiBncm91cCBhbmQgb3JkZXJpbmcgYnkgZG9jdW1lbnRJZCgpLCB0aGUgdmFsdWUgcGFzc2VkIHRvICR7cn0oKSBtdXN0IHJlc3VsdCBpbiBhIHZhbGlkIGRvY3VtZW50IHBhdGgsIGJ1dCAnJHtufScgaXMgbm90IGJlY2F1c2UgaXQgY29udGFpbnMgYW4gb2RkIG51bWJlciBvZiBzZWdtZW50cy5gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBEb2N1bWVudEtleShuKTtcbiAgICAgICAgICAgICAgICAgICAgXy5wdXNoKF9fUFJJVkFURV9yZWZWYWx1ZSh0LCBpKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9wYXJzZVF1ZXJ5VmFsdWUobiwgciwgYSk7XG4gICAgICAgICAgICAgICAgICAgIF8ucHVzaChlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEJvdW5kKF8sIHMpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUGFyc2VzIHRoZSBnaXZlbiBgZG9jdW1lbnRJZFZhbHVlYCBpbnRvIGEgYFJlZmVyZW5jZVZhbHVlYCwgdGhyb3dpbmdcbiAqIGFwcHJvcHJpYXRlIGVycm9ycyBpZiB0aGUgdmFsdWUgaXMgYW55dGhpbmcgb3RoZXIgdGhhbiBhIGBEb2N1bWVudFJlZmVyZW5jZWBcbiAqIG9yIGBzdHJpbmdgLCBvciBpZiB0aGUgc3RyaW5nIGlzIG1hbGZvcm1lZC5cbiAqLyAoZS5fcXVlcnksIGUuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCBpLCB0LCBuLCByKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZURvY3VtZW50SWRWYWx1ZShlLCB0LCBuKSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIChuID0gZ2V0TW9kdWxhckluc3RhbmNlKG4pKSkge1xuICAgICAgICBpZiAoXCJcIiA9PT0gbikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIHdpdGggZG9jdW1lbnRJZCgpLCB5b3UgbXVzdCBwcm92aWRlIGEgdmFsaWQgZG9jdW1lbnQgSUQsIGJ1dCBpdCB3YXMgYW4gZW1wdHkgc3RyaW5nLlwiKTtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfaXNDb2xsZWN0aW9uR3JvdXBRdWVyeSh0KSAmJiAtMSAhPT0gbi5pbmRleE9mKFwiL1wiKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGJ5IGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHBsYWluIGRvY3VtZW50IElELCBidXQgJyR7bn0nIGNvbnRhaW5zIGEgJy8nIGNoYXJhY3Rlci5gKTtcbiAgICAgICAgY29uc3QgciA9IHQucGF0aC5jaGlsZChSZXNvdXJjZVBhdGguZnJvbVN0cmluZyhuKSk7XG4gICAgICAgIGlmICghRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShyKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGdyb3VwIGJ5IGRvY3VtZW50SWQoKSwgdGhlIHZhbHVlIHByb3ZpZGVkIG11c3QgcmVzdWx0IGluIGEgdmFsaWQgZG9jdW1lbnQgcGF0aCwgYnV0ICcke3J9JyBpcyBub3QgYmVjYXVzZSBpdCBoYXMgYW4gb2RkIG51bWJlciBvZiBzZWdtZW50cyAoJHtyLmxlbmd0aH0pLmApO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlZlZhbHVlKGUsIG5ldyBEb2N1bWVudEtleShyKSk7XG4gICAgfVxuICAgIGlmIChuIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UpIHJldHVybiBfX1BSSVZBVEVfcmVmVmFsdWUoZSwgbi5fa2V5KTtcbiAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyB3aXRoIGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHZhbGlkIHN0cmluZyBvciBhIERvY3VtZW50UmVmZXJlbmNlLCBidXQgaXQgd2FzOiAke19fUFJJVkFURV92YWx1ZURlc2NyaXB0aW9uKG4pfS5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCB0aGUgdmFsdWUgcGFzc2VkIGludG8gYSBkaXNqdW5jdGl2ZSBmaWx0ZXIgc2F0aXNmaWVzIGFsbFxuICogYXJyYXkgcmVxdWlyZW1lbnRzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZURpc2p1bmN0aXZlRmlsdGVyRWxlbWVudHMoZSwgdCkge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShlKSB8fCAwID09PSBlLmxlbmd0aCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgUXVlcnkuIEEgbm9uLWVtcHR5IGFycmF5IGlzIHJlcXVpcmVkIGZvciAnJHt0LnRvU3RyaW5nKCl9JyBmaWx0ZXJzLmApO1xufVxuXG4vKipcbiAqIEdpdmVuIGFuIG9wZXJhdG9yLCByZXR1cm5zIHRoZSBzZXQgb2Ygb3BlcmF0b3JzIHRoYXQgY2Fubm90IGJlIHVzZWQgd2l0aCBpdC5cbiAqXG4gKiBUaGlzIGlzIG5vdCBhIGNvbXByZWhlbnNpdmUgY2hlY2ssIGFuZCB0aGlzIGZ1bmN0aW9uIHNob3VsZCBiZSByZW1vdmVkIGluIHRoZVxuICogbG9uZyB0ZXJtLiBWYWxpZGF0aW9ucyBzaG91bGQgb2NjdXIgaW4gdGhlIEZpcmVzdG9yZSBiYWNrZW5kLlxuICpcbiAqIE9wZXJhdG9ycyBpbiBhIHF1ZXJ5IG11c3QgYWRoZXJlIHRvIHRoZSBmb2xsb3dpbmcgc2V0IG9mIHJ1bGVzOlxuICogMS4gT25seSBvbmUgaW5lcXVhbGl0eSBwZXIgcXVlcnkuXG4gKiAyLiBgTk9UX0lOYCBjYW5ub3QgYmUgdXNlZCB3aXRoIGFycmF5LCBkaXNqdW5jdGl2ZSwgb3IgYE5PVF9FUVVBTGAgb3BlcmF0b3JzLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZU5ld0ZpZWxkRmlsdGVyKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZnVuY3Rpb24gX19QUklWQVRFX2ZpbmRPcEluc2lkZUZpbHRlcnMoZSwgdCkge1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZSkgZm9yIChjb25zdCBlIG9mIG4uZ2V0RmxhdHRlbmVkRmlsdGVycygpKSBpZiAodC5pbmRleE9mKGUub3ApID49IDApIHJldHVybiBlLm9wO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9KGUuZmlsdGVycywgZnVuY3Rpb24gX19QUklWQVRFX2NvbmZsaWN0aW5nT3BzKGUpIHtcbiAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiBbIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyBdO1xuXG4gICAgICAgICAgY2FzZSBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA6XG4gICAgICAgICAgY2FzZSBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFsgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gXTtcblxuICAgICAgICAgIGNhc2UgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFsgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gLCBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAsIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gXTtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICB9KHQub3ApKTtcbiAgICBpZiAobnVsbCAhPT0gbikgXG4gICAgLy8gU3BlY2lhbCBjYXNlIHdoZW4gaXQncyBhIGR1cGxpY2F0ZSBvcCB0byBnaXZlIGEgc2xpZ2h0bHkgY2xlYXJlciBlcnJvciBtZXNzYWdlLlxuICAgIHRocm93IG4gPT09IHQub3AgPyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGNhbm5vdCB1c2UgbW9yZSB0aGFuIG9uZSAnJHt0Lm9wLnRvU3RyaW5nKCl9JyBmaWx0ZXIuYCkgOiBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGNhbm5vdCB1c2UgJyR7dC5vcC50b1N0cmluZygpfScgZmlsdGVycyB3aXRoICcke24udG9TdHJpbmcoKX0nIGZpbHRlcnMuYCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVF1ZXJ5RmlsdGVyQ29uc3RyYWludChlLCB0KSB7XG4gICAgaWYgKCEodCBpbnN0YW5jZW9mIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50IHx8IHQgaW5zdGFuY2VvZiBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHtlfSgpIHJlcXVpcmVzIEFwcGxpYWJsZUNvbnN0cmFpbnRzIGNyZWF0ZWQgd2l0aCBhIGNhbGwgdG8gJ3doZXJlKC4uLiknLCAnb3IoLi4uKScsIG9yICdhbmQoLi4uKScuYCk7XG59XG5cbmNsYXNzIEFic3RyYWN0VXNlckRhdGFXcml0ZXIge1xuICAgIGNvbnZlcnRWYWx1ZShlLCB0ID0gXCJub25lXCIpIHtcbiAgICAgICAgc3dpdGNoIChfX1BSSVZBVEVfdHlwZU9yZGVyKGUpKSB7XG4gICAgICAgICAgY2FzZSAwIC8qIFR5cGVPcmRlci5OdWxsVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICBjYXNlIDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZS5ib29sZWFuVmFsdWU7XG5cbiAgICAgICAgICBjYXNlIDIgLyogVHlwZU9yZGVyLk51bWJlclZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuaW50ZWdlclZhbHVlIHx8IGUuZG91YmxlVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VGltZXN0YW1wKGUudGltZXN0YW1wVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSA0IC8qIFR5cGVPcmRlci5TZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0U2VydmVyVGltZXN0YW1wKGUsIHQpO1xuXG4gICAgICAgICAgY2FzZSA1IC8qIFR5cGVPcmRlci5TdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZS5zdHJpbmdWYWx1ZTtcblxuICAgICAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRCeXRlcyhfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyhlLmJ5dGVzVmFsdWUpKTtcblxuICAgICAgICAgIGNhc2UgNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydFJlZmVyZW5jZShlLnJlZmVyZW5jZVZhbHVlKTtcblxuICAgICAgICAgIGNhc2UgOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0R2VvUG9pbnQoZS5nZW9Qb2ludFZhbHVlKTtcblxuICAgICAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0QXJyYXkoZS5hcnJheVZhbHVlLCB0KTtcblxuICAgICAgICAgIGNhc2UgMTEgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRPYmplY3QoZS5tYXBWYWx1ZSwgdCk7XG5cbiAgICAgICAgICBjYXNlIDEwIC8qIFR5cGVPcmRlci5WZWN0b3JWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VmVjdG9yVmFsdWUoZS5tYXBWYWx1ZSk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnZlcnRPYmplY3QoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0T2JqZWN0TWFwKGUuZmllbGRzLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovICAgIGNvbnZlcnRPYmplY3RNYXAoZSwgdCA9IFwibm9uZVwiKSB7XG4gICAgICAgIGNvbnN0IG4gPSB7fTtcbiAgICAgICAgcmV0dXJuIGZvckVhY2goZSwgKChlLCByKSA9PiB7XG4gICAgICAgICAgICBuW2VdID0gdGhpcy5jb252ZXJ0VmFsdWUociwgdCk7XG4gICAgICAgIH0pKSwgbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovICAgIGNvbnZlcnRWZWN0b3JWYWx1ZShlKSB7XG4gICAgICAgIHZhciB0LCBuLCByO1xuICAgICAgICBjb25zdCBpID0gbnVsbCA9PT0gKHIgPSBudWxsID09PSAobiA9IG51bGwgPT09ICh0ID0gZS5maWVsZHMpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQudmFsdWUuYXJyYXlWYWx1ZSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi52YWx1ZXMpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIubWFwKChlID0+IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5kb3VibGVWYWx1ZSkpKTtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3JWYWx1ZShpKTtcbiAgICB9XG4gICAgY29udmVydEdlb1BvaW50KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBHZW9Qb2ludChfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubGF0aXR1ZGUpLCBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubG9uZ2l0dWRlKSk7XG4gICAgfVxuICAgIGNvbnZlcnRBcnJheShlLCB0KSB7XG4gICAgICAgIHJldHVybiAoZS52YWx1ZXMgfHwgW10pLm1hcCgoZSA9PiB0aGlzLmNvbnZlcnRWYWx1ZShlLCB0KSkpO1xuICAgIH1cbiAgICBjb252ZXJ0U2VydmVyVGltZXN0YW1wKGUsIHQpIHtcbiAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgY2FzZSBcInByZXZpb3VzXCI6XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUoZSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBuID8gbnVsbCA6IHRoaXMuY29udmVydFZhbHVlKG4sIHQpO1xuXG4gICAgICAgICAgY2FzZSBcImVzdGltYXRlXCI6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VGltZXN0YW1wKF9fUFJJVkFURV9nZXRMb2NhbFdyaXRlVGltZShlKSk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udmVydFRpbWVzdGFtcChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpO1xuICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcCh0LnNlY29uZHMsIHQubmFub3MpO1xuICAgIH1cbiAgICBjb252ZXJ0RG9jdW1lbnRLZXkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZSk7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KF9fUFJJVkFURV9pc1ZhbGlkUmVzb3VyY2VOYW1lKG4pKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBEYXRhYmFzZUlkKG4uZ2V0KDEpLCBuLmdldCgzKSksIGkgPSBuZXcgRG9jdW1lbnRLZXkobi5wb3BGaXJzdCg1KSk7XG4gICAgICAgIHJldHVybiByLmlzRXF1YWwodCkgfHwgXG4gICAgICAgIC8vIFRPRE8oYi82NDEzMDIwMik6IFNvbWVob3cgc3VwcG9ydCBmb3JlaWduIHJlZmVyZW5jZXMuXG4gICAgICAgIF9fUFJJVkFURV9sb2dFcnJvcihgRG9jdW1lbnQgJHtpfSBjb250YWlucyBhIGRvY3VtZW50IHJlZmVyZW5jZSB3aXRoaW4gYSBkaWZmZXJlbnQgZGF0YWJhc2UgKCR7ci5wcm9qZWN0SWR9LyR7ci5kYXRhYmFzZX0pIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQuIEl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHJlZmVyZW5jZSBpbiB0aGUgY3VycmVudCBkYXRhYmFzZSAoJHt0LnByb2plY3RJZH0vJHt0LmRhdGFiYXNlfSkgaW5zdGVhZC5gKSwgXG4gICAgICAgIGk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDb252ZXJ0cyBjdXN0b20gbW9kZWwgb2JqZWN0IG9mIHR5cGUgVCBpbnRvIGBEb2N1bWVudERhdGFgIGJ5IGFwcGx5aW5nIHRoZVxuICogY29udmVydGVyIGlmIGl0IGV4aXN0cy5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgd2hlbiBjb252ZXJ0aW5nIHVzZXIgb2JqZWN0cyB0byBgRG9jdW1lbnREYXRhYFxuICogYmVjYXVzZSB3ZSB3YW50IHRvIHByb3ZpZGUgdGhlIHVzZXIgd2l0aCBhIG1vcmUgc3BlY2lmaWMgZXJyb3IgbWVzc2FnZSBpZlxuICogdGhlaXIgYHNldCgpYCBvciBmYWlscyBkdWUgdG8gaW52YWxpZCBkYXRhIG9yaWdpbmF0aW5nIGZyb20gYSBgdG9GaXJlc3RvcmUoKWBcbiAqIGNhbGwuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RmlyZXN0b3JlRGF0YUNvbnZlcnRlcihlLCB0LCBuKSB7XG4gICAgbGV0IHI7XG4gICAgLy8gQ2FzdCB0byBgYW55YCBpbiBvcmRlciB0byBzYXRpc2Z5IHRoZSB1bmlvbiB0eXBlIGNvbnN0cmFpbnQgb25cbiAgICAvLyB0b0ZpcmVzdG9yZSgpLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgcmV0dXJuIHIgPSBlID8gbiAmJiAobi5tZXJnZSB8fCBuLm1lcmdlRmllbGRzKSA/IGUudG9GaXJlc3RvcmUodCwgbikgOiBlLnRvRmlyZXN0b3JlKHQpIDogdCwgXG4gICAgcjtcbn1cblxuY2xhc3MgX19QUklWQVRFX0xpdGVVc2VyRGF0YVdyaXRlciBleHRlbmRzIEFic3RyYWN0VXNlckRhdGFXcml0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5maXJlc3RvcmUgPSBlO1xuICAgIH1cbiAgICBjb252ZXJ0Qnl0ZXMoZSkge1xuICAgICAgICByZXR1cm4gbmV3IEJ5dGVzKGUpO1xuICAgIH1cbiAgICBjb252ZXJ0UmVmZXJlbmNlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuY29udmVydERvY3VtZW50S2V5KGUsIHRoaXMuZmlyZXN0b3JlLl9kYXRhYmFzZUlkKTtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgLyogY29udmVydGVyPSAqLyBudWxsLCB0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENyZWF0ZSBhbiBBZ2dyZWdhdGVGaWVsZCBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBjb21wdXRlIHRoZSBzdW0gb2ZcbiAqIGEgc3BlY2lmaWVkIGZpZWxkIG92ZXIgYSByYW5nZSBvZiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqIEBwYXJhbSBmaWVsZCBTcGVjaWZpZXMgdGhlIGZpZWxkIHRvIHN1bSBhY3Jvc3MgdGhlIHJlc3VsdCBzZXQuXG4gKi8gZnVuY3Rpb24gc3VtKGUpIHtcbiAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0ZUZpZWxkKFwic3VtXCIsIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQkMShcInN1bVwiLCBlKSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFuIEFnZ3JlZ2F0ZUZpZWxkIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgdGhlIGF2ZXJhZ2Ugb2ZcbiAqIGEgc3BlY2lmaWVkIGZpZWxkIG92ZXIgYSByYW5nZSBvZiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqIEBwYXJhbSBmaWVsZCBTcGVjaWZpZXMgdGhlIGZpZWxkIHRvIGF2ZXJhZ2UgYWNyb3NzIHRoZSByZXN1bHQgc2V0LlxuICovIGZ1bmN0aW9uIGF2ZXJhZ2UoZSkge1xuICAgIHJldHVybiBuZXcgQWdncmVnYXRlRmllbGQoXCJhdmdcIiwgX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKFwiYXZlcmFnZVwiLCBlKSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFuIEFnZ3JlZ2F0ZUZpZWxkIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgdGhlIGNvdW50IG9mXG4gKiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBjb3VudCgpIHtcbiAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0ZUZpZWxkKFwiY291bnRcIik7XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdHdvICdBZ2dyZWdhdGVGaWVsZGAgaW5zdGFuY2VzIGZvciBlcXVhbGl0eS5cbiAqXG4gKiBAcGFyYW0gbGVmdCBDb21wYXJlIHRoaXMgQWdncmVnYXRlRmllbGQgdG8gdGhlIGByaWdodGAuXG4gKiBAcGFyYW0gcmlnaHQgQ29tcGFyZSB0aGlzIEFnZ3JlZ2F0ZUZpZWxkIHRvIHRoZSBgbGVmdGAuXG4gKi8gZnVuY3Rpb24gYWdncmVnYXRlRmllbGRFcXVhbChlLCB0KSB7XG4gICAgdmFyIG4sIHI7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBBZ2dyZWdhdGVGaWVsZCAmJiB0IGluc3RhbmNlb2YgQWdncmVnYXRlRmllbGQgJiYgZS5hZ2dyZWdhdGVUeXBlID09PSB0LmFnZ3JlZ2F0ZVR5cGUgJiYgKG51bGwgPT09IChuID0gZS5faW50ZXJuYWxGaWVsZFBhdGgpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uY2Fub25pY2FsU3RyaW5nKCkpID09PSAobnVsbCA9PT0gKHIgPSB0Ll9pbnRlcm5hbEZpZWxkUGF0aCkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5jYW5vbmljYWxTdHJpbmcoKSk7XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdHdvIGBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90YCBpbnN0YW5jZXMgZm9yIGVxdWFsaXR5LlxuICpcbiAqIFR3byBgQWdncmVnYXRlUXVlcnlTbmFwc2hvdGAgaW5zdGFuY2VzIGFyZSBjb25zaWRlcmVkIFwiZXF1YWxcIiBpZiB0aGV5IGhhdmVcbiAqIHVuZGVybHlpbmcgcXVlcmllcyB0aGF0IGNvbXBhcmUgZXF1YWwsIGFuZCB0aGUgc2FtZSBkYXRhLlxuICpcbiAqIEBwYXJhbSBsZWZ0IC0gVGhlIGZpcnN0IGBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90YCB0byBjb21wYXJlLlxuICogQHBhcmFtIHJpZ2h0IC0gVGhlIHNlY29uZCBgQWdncmVnYXRlUXVlcnlTbmFwc2hvdGAgdG8gY29tcGFyZS5cbiAqXG4gKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9iamVjdHMgYXJlIFwiZXF1YWxcIiwgYXMgZGVmaW5lZCBhYm92ZSwgb3IgYGZhbHNlYFxuICogb3RoZXJ3aXNlLlxuICovIGZ1bmN0aW9uIGFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RFcXVhbChlLCB0KSB7XG4gICAgcmV0dXJuIHF1ZXJ5RXF1YWwoZS5xdWVyeSwgdC5xdWVyeSkgJiYgZGVlcEVxdWFsKGUuZGF0YSgpLCB0LmRhdGEoKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIE1ldGFkYXRhIGFib3V0IGEgc25hcHNob3QsIGRlc2NyaWJpbmcgdGhlIHN0YXRlIG9mIHRoZSBzbmFwc2hvdC5cbiAqLyBjbGFzcyBTbmFwc2hvdE1ldGFkYXRhIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5oYXNQZW5kaW5nV3JpdGVzID0gZSwgdGhpcy5mcm9tQ2FjaGUgPSB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgU25hcHNob3RNZXRhZGF0YWAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgU25hcHNob3RNZXRhZGF0YWAgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgU25hcHNob3RNZXRhZGF0YWAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc1BlbmRpbmdXcml0ZXMgPT09IGUuaGFzUGVuZGluZ1dyaXRlcyAmJiB0aGlzLmZyb21DYWNoZSA9PT0gZS5mcm9tQ2FjaGU7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91ciBGaXJlc3RvcmVcbiAqIGRhdGFiYXNlLiBUaGUgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0b1xuICogZ2V0IGEgc3BlY2lmaWMgZmllbGQuXG4gKlxuICogRm9yIGEgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcG9pbnRzIHRvIGEgbm9uLWV4aXN0aW5nIGRvY3VtZW50LCBhbnkgZGF0YVxuICogYWNjZXNzIHdpbGwgcmV0dXJuICd1bmRlZmluZWQnLiBZb3UgY2FuIHVzZSB0aGUgYGV4aXN0cygpYCBtZXRob2QgdG9cbiAqIGV4cGxpY2l0bHkgdmVyaWZ5IGEgZG9jdW1lbnQncyBleGlzdGVuY2UuXG4gKi8gY2xhc3MgRG9jdW1lbnRTbmFwc2hvdCBleHRlbmRzIERvY3VtZW50U25hcHNob3QkMSB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgcHJvdGVjdGVkICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcykge1xuICAgICAgICBzdXBlcihlLCB0LCBuLCByLCBzKSwgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fZmlyZXN0b3JlSW1wbCA9IGUsIHRoaXMubWV0YWRhdGEgPSBpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBkYXRhIGV4aXN0cy4gVHJ1ZSBpZiB0aGUgZG9jdW1lbnQgZXhpc3RzLlxuICAgICAqLyAgICBleGlzdHMoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5leGlzdHMoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICpcbiAgICAgKiBCeSBkZWZhdWx0LCBgc2VydmVyVGltZXN0YW1wKClgIHZhbHVlcyB0aGF0IGhhdmUgbm90IHlldCBiZWVuXG4gICAgICogc2V0IHRvIHRoZWlyIGZpbmFsIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQgYXMgYG51bGxgLiBZb3UgY2FuIG92ZXJyaWRlXG4gICAgICogdGhpcyBieSBwYXNzaW5nIGFuIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgaG93IGRhdGEgaXMgcmV0cmlldmVkIGZyb21cbiAgICAgKiB0aGUgc25hcHNob3QgKGZvciBleGFtcGxlIHRoZSBkZXNpcmVkIGJlaGF2aW9yIGZvciBzZXJ2ZXIgdGltZXN0YW1wcyB0aGF0XG4gICAgICogaGF2ZSBub3QgeWV0IGJlZW4gc2V0IHRvIHRoZWlyIGZpbmFsIHZhbHVlKS5cbiAgICAgKiBAcmV0dXJucyBBbiBgT2JqZWN0YCBjb250YWluaW5nIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IG9yIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICovICAgIGRhdGEoZSA9IHt9KSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbnZlcnRlcikge1xuICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgd2FudCB0byB1c2UgdGhlIGNvbnZlcnRlciBhbmQgY3JlYXRlIGEgbmV3IERvY3VtZW50U25hcHNob3RcbiAgICAgICAgICAgICAgICAvLyBpZiBhIGNvbnZlcnRlciBoYXMgYmVlbiBwcm92aWRlZC5cbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCh0aGlzLl9maXJlc3RvcmUsIHRoaXMuX3VzZXJEYXRhV3JpdGVyLCB0aGlzLl9rZXksIHRoaXMuX2RvY3VtZW50LCB0aGlzLm1ldGFkYXRhLCBcbiAgICAgICAgICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0ZXIuZnJvbUZpcmVzdG9yZSh0LCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YVdyaXRlci5jb252ZXJ0VmFsdWUodGhpcy5fZG9jdW1lbnQuZGF0YS52YWx1ZSwgZS5zZXJ2ZXJUaW1lc3RhbXBzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGZpZWxkIHNwZWNpZmllZCBieSBgZmllbGRQYXRoYC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBvciBmaWVsZCBkb2Vzbid0IGV4aXN0LlxuICAgICAqXG4gICAgICogQnkgZGVmYXVsdCwgYSBgc2VydmVyVGltZXN0YW1wKClgIHRoYXQgaGFzIG5vdCB5ZXQgYmVlbiBzZXQgdG9cbiAgICAgKiBpdHMgZmluYWwgdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBhcyBgbnVsbGAuIFlvdSBjYW4gb3ZlcnJpZGUgdGhpcyBieVxuICAgICAqIHBhc3NpbmcgYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmllbGRQYXRoIC0gVGhlIHBhdGggKGZvciBleGFtcGxlICdmb28nIG9yICdmb28uYmFyJykgdG8gYSBzcGVjaWZpY1xuICAgICAqIGZpZWxkLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQW4gb3B0aW9ucyBvYmplY3QgdG8gY29uZmlndXJlIGhvdyB0aGUgZmllbGQgaXMgcmV0cmlldmVkXG4gICAgICogZnJvbSB0aGUgc25hcHNob3QgKGZvciBleGFtcGxlIHRoZSBkZXNpcmVkIGJlaGF2aW9yIGZvciBzZXJ2ZXIgdGltZXN0YW1wc1xuICAgICAqIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gc2V0IHRvIHRoZWlyIGZpbmFsIHZhbHVlKS5cbiAgICAgKiBAcmV0dXJucyBUaGUgZGF0YSBhdCB0aGUgc3BlY2lmaWVkIGZpZWxkIGxvY2F0aW9uIG9yIHVuZGVmaW5lZCBpZiBubyBzdWNoXG4gICAgICogZmllbGQgZXhpc3RzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICAvLyBXZSBhcmUgdXNpbmcgYGFueWAgaGVyZSB0byBhdm9pZCBhbiBleHBsaWNpdCBjYXN0IGJ5IG91ciB1c2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGdldChlLCB0ID0ge30pIHtcbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5fZG9jdW1lbnQuZGF0YS5maWVsZChfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50KFwiRG9jdW1lbnRTbmFwc2hvdC5nZXRcIiwgZSkpO1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IG4pIHJldHVybiB0aGlzLl91c2VyRGF0YVdyaXRlci5jb252ZXJ0VmFsdWUobiwgdC5zZXJ2ZXJUaW1lc3RhbXBzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91clxuICogRmlyZXN0b3JlIGRhdGFiYXNlIGFzIHBhcnQgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50IGlzIGd1YXJhbnRlZWQgdG8gZXhpc3RcbiAqIGFuZCBpdHMgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0byBnZXQgYVxuICogc3BlY2lmaWMgZmllbGQuXG4gKlxuICogQSBgUXVlcnlEb2N1bWVudFNuYXBzaG90YCBvZmZlcnMgdGhlIHNhbWUgQVBJIHN1cmZhY2UgYXMgYVxuICogYERvY3VtZW50U25hcHNob3RgLiBTaW5jZSBxdWVyeSByZXN1bHRzIGNvbnRhaW4gb25seSBleGlzdGluZyBkb2N1bWVudHMsIHRoZVxuICogYGV4aXN0c2AgcHJvcGVydHkgd2lsbCBhbHdheXMgYmUgdHJ1ZSBhbmQgYGRhdGEoKWAgd2lsbCBuZXZlciByZXR1cm5cbiAqICd1bmRlZmluZWQnLlxuICovIGNsYXNzIFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCBleHRlbmRzIERvY3VtZW50U25hcHNob3Qge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBhcyBhbiBgT2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQsIGBzZXJ2ZXJUaW1lc3RhbXAoKWAgdmFsdWVzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW5cbiAgICAgKiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBhcyBgbnVsbGAuIFlvdSBjYW4gb3ZlcnJpZGVcbiAgICAgKiB0aGlzIGJ5IHBhc3NpbmcgYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAb3ZlcnJpZGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSBob3cgZGF0YSBpcyByZXRyaWV2ZWQgZnJvbVxuICAgICAqIHRoZSBzbmFwc2hvdCAoZm9yIGV4YW1wbGUgdGhlIGRlc2lyZWQgYmVoYXZpb3IgZm9yIHNlcnZlciB0aW1lc3RhbXBzIHRoYXRcbiAgICAgKiBoYXZlIG5vdCB5ZXQgYmVlbiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUpLlxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgZGF0YShlID0ge30pIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRhdGEoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYFF1ZXJ5U25hcHNob3RgIGNvbnRhaW5zIHplcm8gb3IgbW9yZSBgRG9jdW1lbnRTbmFwc2hvdGAgb2JqZWN0c1xuICogcmVwcmVzZW50aW5nIHRoZSByZXN1bHRzIG9mIGEgcXVlcnkuIFRoZSBkb2N1bWVudHMgY2FuIGJlIGFjY2Vzc2VkIGFzIGFuXG4gKiBhcnJheSB2aWEgdGhlIGBkb2NzYCBwcm9wZXJ0eSBvciBlbnVtZXJhdGVkIHVzaW5nIHRoZSBgZm9yRWFjaGAgbWV0aG9kLiBUaGVcbiAqIG51bWJlciBvZiBkb2N1bWVudHMgY2FuIGJlIGRldGVybWluZWQgdmlhIHRoZSBgZW1wdHlgIGFuZCBgc2l6ZWBcbiAqIHByb3BlcnRpZXMuXG4gKi8gY2xhc3MgUXVlcnlTbmFwc2hvdCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMuX2ZpcmVzdG9yZSA9IGUsIHRoaXMuX3VzZXJEYXRhV3JpdGVyID0gdCwgdGhpcy5fc25hcHNob3QgPSByLCB0aGlzLm1ldGFkYXRhID0gbmV3IFNuYXBzaG90TWV0YWRhdGEoci5oYXNQZW5kaW5nV3JpdGVzLCByLmZyb21DYWNoZSksIFxuICAgICAgICB0aGlzLnF1ZXJ5ID0gbjtcbiAgICB9XG4gICAgLyoqIEFuIGFycmF5IG9mIGFsbCB0aGUgZG9jdW1lbnRzIGluIHRoZSBgUXVlcnlTbmFwc2hvdGAuICovICAgIGdldCBkb2NzKCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKHQgPT4gZS5wdXNoKHQpKSksIGU7XG4gICAgfVxuICAgIC8qKiBUaGUgbnVtYmVyIG9mIGRvY3VtZW50cyBpbiB0aGUgYFF1ZXJ5U25hcHNob3RgLiAqLyAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBzaG90LmRvY3Muc2l6ZTtcbiAgICB9XG4gICAgLyoqIFRydWUgaWYgdGhlcmUgYXJlIG5vIGRvY3VtZW50cyBpbiB0aGUgYFF1ZXJ5U25hcHNob3RgLiAqLyAgICBnZXQgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiAwID09PSB0aGlzLnNpemU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVudW1lcmF0ZXMgYWxsIG9mIHRoZSBkb2N1bWVudHMgaW4gdGhlIGBRdWVyeVNuYXBzaG90YC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIEEgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdpdGggYSBgUXVlcnlEb2N1bWVudFNuYXBzaG90YCBmb3JcbiAgICAgKiBlYWNoIGRvY3VtZW50IGluIHRoZSBzbmFwc2hvdC5cbiAgICAgKiBAcGFyYW0gdGhpc0FyZyAtIFRoZSBgdGhpc2AgYmluZGluZyBmb3IgdGhlIGNhbGxiYWNrLlxuICAgICAqLyAgICBmb3JFYWNoKGUsIHQpIHtcbiAgICAgICAgdGhpcy5fc25hcHNob3QuZG9jcy5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgICAgIGUuY2FsbCh0LCBuZXcgUXVlcnlEb2N1bWVudFNuYXBzaG90KHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIG4ua2V5LCBuLCBuZXcgU25hcHNob3RNZXRhZGF0YSh0aGlzLl9zbmFwc2hvdC5tdXRhdGVkS2V5cy5oYXMobi5rZXkpLCB0aGlzLl9zbmFwc2hvdC5mcm9tQ2FjaGUpLCB0aGlzLnF1ZXJ5LmNvbnZlcnRlcikpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2YgdGhlIGRvY3VtZW50cyBjaGFuZ2VzIHNpbmNlIHRoZSBsYXN0IHNuYXBzaG90LiBJZiB0aGlzXG4gICAgICogaXMgdGhlIGZpcnN0IHNuYXBzaG90LCBhbGwgZG9jdW1lbnRzIHdpbGwgYmUgaW4gdGhlIGxpc3QgYXMgJ2FkZGVkJ1xuICAgICAqIGNoYW5nZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIGBTbmFwc2hvdExpc3Rlbk9wdGlvbnNgIHRoYXQgY29udHJvbCB3aGV0aGVyIG1ldGFkYXRhLW9ubHlcbiAgICAgKiBjaGFuZ2VzIChpLmUuIG9ubHkgYERvY3VtZW50U25hcHNob3QubWV0YWRhdGFgIGNoYW5nZWQpIHNob3VsZCB0cmlnZ2VyXG4gICAgICogc25hcHNob3QgZXZlbnRzLlxuICAgICAqLyAgICBkb2NDaGFuZ2VzKGUgPSB7fSkge1xuICAgICAgICBjb25zdCB0ID0gISFlLmluY2x1ZGVNZXRhZGF0YUNoYW5nZXM7XG4gICAgICAgIGlmICh0ICYmIHRoaXMuX3NuYXBzaG90LmV4Y2x1ZGVzTWV0YWRhdGFDaGFuZ2VzKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoRC5JTlZBTElEX0FSR1VNRU5ULCBcIlRvIGluY2x1ZGUgbWV0YWRhdGEgY2hhbmdlcyB3aXRoIHlvdXIgZG9jdW1lbnQgY2hhbmdlcywgeW91IG11c3QgYWxzbyBwYXNzIHsgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczp0cnVlIH0gdG8gb25TbmFwc2hvdCgpLlwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZENoYW5nZXMgJiYgdGhpcy5fY2FjaGVkQ2hhbmdlc0luY2x1ZGVNZXRhZGF0YUNoYW5nZXMgPT09IHQgfHwgKHRoaXMuX2NhY2hlZENoYW5nZXMgPSBcbiAgICAgICAgLyoqIENhbGN1bGF0ZXMgdGhlIGFycmF5IG9mIGBEb2N1bWVudENoYW5nZWBzIGZvciBhIGdpdmVuIGBWaWV3U25hcHNob3RgLiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfY2hhbmdlc0Zyb21TbmFwc2hvdChlLCB0KSB7XG4gICAgICAgICAgICBpZiAoZS5fc25hcHNob3Qub2xkRG9jcy5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuX3NuYXBzaG90LmRvY0NoYW5nZXMubWFwKChuID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IG5ldyBRdWVyeURvY3VtZW50U25hcHNob3QoZS5fZmlyZXN0b3JlLCBlLl91c2VyRGF0YVdyaXRlciwgbi5kb2Mua2V5LCBuLmRvYywgbmV3IFNuYXBzaG90TWV0YWRhdGEoZS5fc25hcHNob3QubXV0YXRlZEtleXMuaGFzKG4uZG9jLmtleSksIGUuX3NuYXBzaG90LmZyb21DYWNoZSksIGUucXVlcnkuY29udmVydGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uZG9jLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImFkZGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2M6IHIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRJbmRleDogLTEsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdJbmRleDogdCsrXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8vIEEgYERvY3VtZW50U2V0YCB0aGF0IGlzIHVwZGF0ZWQgaW5jcmVtZW50YWxseSBhcyBjaGFuZ2VzIGFyZSBhcHBsaWVkIHRvIHVzZVxuICAgICAgICAgICAgICAgIC8vIHRvIGxvb2t1cCB0aGUgaW5kZXggb2YgYSBkb2N1bWVudC5cbiAgICAgICAgICAgICAgICBsZXQgbiA9IGUuX3NuYXBzaG90Lm9sZERvY3M7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuX3NuYXBzaG90LmRvY0NoYW5nZXMuZmlsdGVyKChlID0+IHQgfHwgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovICE9PSBlLnR5cGUpKS5tYXAoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gbmV3IFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdChlLl9maXJlc3RvcmUsIGUuX3VzZXJEYXRhV3JpdGVyLCB0LmRvYy5rZXksIHQuZG9jLCBuZXcgU25hcHNob3RNZXRhZGF0YShlLl9zbmFwc2hvdC5tdXRhdGVkS2V5cy5oYXModC5kb2Mua2V5KSwgZS5fc25hcHNob3QuZnJvbUNhY2hlKSwgZS5xdWVyeS5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IC0xLCBzID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gIT09IHQudHlwZSAmJiAoaSA9IG4uaW5kZXhPZih0LmRvYy5rZXkpLCBuID0gbi5kZWxldGUodC5kb2Mua2V5KSksIFxuICAgICAgICAgICAgICAgICAgICAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAhPT0gdC50eXBlICYmIChuID0gbi5hZGQodC5kb2MpLCBzID0gbi5pbmRleE9mKHQuZG9jLmtleSkpLCBcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogX19QUklWQVRFX3Jlc3VsdENoYW5nZVR5cGUodC50eXBlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYzogcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZEluZGV4OiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SW5kZXg6IHNcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0odGhpcywgdCksIHRoaXMuX2NhY2hlZENoYW5nZXNJbmNsdWRlTWV0YWRhdGFDaGFuZ2VzID0gdCksIHRoaXMuX2NhY2hlZENoYW5nZXM7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVzdWx0Q2hhbmdlVHlwZShlKSB7XG4gICAgc3dpdGNoIChlKSB7XG4gICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgIHJldHVybiBcImFkZGVkXCI7XG5cbiAgICAgIGNhc2UgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDpcbiAgICAgIGNhc2UgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovIDpcbiAgICAgICAgcmV0dXJuIFwibW9kaWZpZWRcIjtcblxuICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgIHJldHVybiBcInJlbW92ZWRcIjtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICB9XG59XG5cbi8vIFRPRE8oZmlyZXN0b3JlZXhwKTogQWRkIHRlc3RzIGZvciBzbmFwc2hvdEVxdWFsIHdpdGggZGlmZmVyZW50IHNuYXBzaG90XG4vLyBtZXRhZGF0YVxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHByb3ZpZGVkIHNuYXBzaG90cyBhcmUgZXF1YWwuXG4gKlxuICogQHBhcmFtIGxlZnQgLSBBIHNuYXBzaG90IHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0gcmlnaHQgLSBBIHNuYXBzaG90IHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBzbmFwc2hvdHMgYXJlIGVxdWFsLlxuICovIGZ1bmN0aW9uIHNuYXBzaG90RXF1YWwoZSwgdCkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgRG9jdW1lbnRTbmFwc2hvdCAmJiB0IGluc3RhbmNlb2YgRG9jdW1lbnRTbmFwc2hvdCA/IGUuX2ZpcmVzdG9yZSA9PT0gdC5fZmlyZXN0b3JlICYmIGUuX2tleS5pc0VxdWFsKHQuX2tleSkgJiYgKG51bGwgPT09IGUuX2RvY3VtZW50ID8gbnVsbCA9PT0gdC5fZG9jdW1lbnQgOiBlLl9kb2N1bWVudC5pc0VxdWFsKHQuX2RvY3VtZW50KSkgJiYgZS5fY29udmVydGVyID09PSB0Ll9jb252ZXJ0ZXIgOiBlIGluc3RhbmNlb2YgUXVlcnlTbmFwc2hvdCAmJiB0IGluc3RhbmNlb2YgUXVlcnlTbmFwc2hvdCAmJiAoZS5fZmlyZXN0b3JlID09PSB0Ll9maXJlc3RvcmUgJiYgcXVlcnlFcXVhbChlLnF1ZXJ5LCB0LnF1ZXJ5KSAmJiBlLm1ldGFkYXRhLmlzRXF1YWwodC5tZXRhZGF0YSkgJiYgZS5fc25hcHNob3QuaXNFcXVhbCh0Ll9zbmFwc2hvdCkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgLlxuICpcbiAqIE5vdGU6IGBnZXREb2MoKWAgYXR0ZW1wdHMgdG8gcHJvdmlkZSB1cC10by1kYXRlIGRhdGEgd2hlbiBwb3NzaWJsZSBieSB3YWl0aW5nXG4gKiBmb3IgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGJ1dCBpdCBtYXkgcmV0dXJuIGNhY2hlZCBkYXRhIG9yIGZhaWwgaWYgeW91IGFyZVxuICogb2ZmbGluZSBhbmQgdGhlIHNlcnZlciBjYW5ub3QgYmUgcmVhY2hlZC4gVG8gc3BlY2lmeSB0aGlzIGJlaGF2aW9yLCBpbnZva2VcbiAqIHtAbGluayBnZXREb2NGcm9tQ2FjaGV9IG9yIHtAbGluayBnZXREb2NGcm9tU2VydmVyfS5cbiAqXG4gKiBAcGFyYW0gcmVmZXJlbmNlIC0gVGhlIHJlZmVyZW5jZSBvZiB0aGUgZG9jdW1lbnQgdG8gZmV0Y2guXG4gKiBAcmV0dXJucyBBIFByb21pc2UgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFNuYXBzaG90YCBjb250YWluaW5nIHRoZVxuICogY3VycmVudCBkb2N1bWVudCBjb250ZW50cy5cbiAqLyBmdW5jdGlvbiBnZXREb2MoZSkge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBEb2N1bWVudFJlZmVyZW5jZSk7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRWaWFTbmFwc2hvdExpc3RlbmVyKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIGUuX2tleSkudGhlbigobiA9PiBfX1BSSVZBVEVfY29udmVydFRvRG9jU25hcHNob3QodCwgZSwgbikpKTtcbn1cblxuY2xhc3MgX19QUklWQVRFX0V4cFVzZXJEYXRhV3JpdGVyIGV4dGVuZHMgQWJzdHJhY3RVc2VyRGF0YVdyaXRlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpcmVzdG9yZSA9IGU7XG4gICAgfVxuICAgIGNvbnZlcnRCeXRlcyhlKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnl0ZXMoZSk7XG4gICAgfVxuICAgIGNvbnZlcnRSZWZlcmVuY2UoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5jb252ZXJ0RG9jdW1lbnRLZXkoZSwgdGhpcy5maXJlc3RvcmUuX2RhdGFiYXNlSWQpO1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50UmVmZXJlbmNlKHRoaXMuZmlyZXN0b3JlLCAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgIGZyb20gY2FjaGUuXG4gKiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBkb2N1bWVudCBpcyBub3QgY3VycmVudGx5IGNhY2hlZC5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5pbmcgdGhlXG4gKiBjdXJyZW50IGRvY3VtZW50IGNvbnRlbnRzLlxuICovIGZ1bmN0aW9uIGdldERvY0Zyb21DYWNoZShlKSB7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIERvY3VtZW50UmVmZXJlbmNlKTtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSksIG4gPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKHQpLCByID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcih0KTtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50RnJvbUxvY2FsQ2FjaGUobiwgZS5fa2V5KS50aGVuKChuID0+IG5ldyBEb2N1bWVudFNuYXBzaG90KHQsIHIsIGUuX2tleSwgbiwgbmV3IFNuYXBzaG90TWV0YWRhdGEobnVsbCAhPT0gbiAmJiBuLmhhc0xvY2FsTXV0YXRpb25zLCBcbiAgICAvKiBmcm9tQ2FjaGU9ICovICEwKSwgZS5jb252ZXJ0ZXIpKSk7XG59XG5cbi8qKlxuICogUmVhZHMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoaXMgYERvY3VtZW50UmVmZXJlbmNlYCBmcm9tIHRoZSBzZXJ2ZXIuXG4gKiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBuZXR3b3JrIGlzIG5vdCBhdmFpbGFibGUuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFNuYXBzaG90YCBjb250YWluaW5nIHRoZVxuICogY3VycmVudCBkb2N1bWVudCBjb250ZW50cy5cbiAqLyBmdW5jdGlvbiBnZXREb2NGcm9tU2VydmVyKGUpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgRG9jdW1lbnRSZWZlcmVuY2UpO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKTtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50VmlhU25hcHNob3RMaXN0ZW5lcihlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKHQpLCBlLl9rZXksIHtcbiAgICAgICAgc291cmNlOiBcInNlcnZlclwiXG4gICAgfSkudGhlbigobiA9PiBfX1BSSVZBVEVfY29udmVydFRvRG9jU25hcHNob3QodCwgZSwgbikpKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgcXVlcnkgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMgYXMgYSBgUXVlcnlTbmFwc2hvdGAuXG4gKlxuICogTm90ZTogYGdldERvY3MoKWAgYXR0ZW1wdHMgdG8gcHJvdmlkZSB1cC10by1kYXRlIGRhdGEgd2hlbiBwb3NzaWJsZSBieVxuICogd2FpdGluZyBmb3IgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGJ1dCBpdCBtYXkgcmV0dXJuIGNhY2hlZCBkYXRhIG9yIGZhaWwgaWZcbiAqIHlvdSBhcmUgb2ZmbGluZSBhbmQgdGhlIHNlcnZlciBjYW5ub3QgYmUgcmVhY2hlZC4gVG8gc3BlY2lmeSB0aGlzIGJlaGF2aW9yLFxuICogaW52b2tlIHtAbGluayBnZXREb2NzRnJvbUNhY2hlfSBvciB7QGxpbmsgZ2V0RG9jc0Zyb21TZXJ2ZXJ9LlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBnZXREb2NzKGUpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgUXVlcnkpO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgbiA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIHIgPSBuZXcgX19QUklWQVRFX0V4cFVzZXJEYXRhV3JpdGVyKHQpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVIYXNFeHBsaWNpdE9yZGVyQnlGb3JMaW1pdFRvTGFzdChlLl9xdWVyeSksIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNWaWFTbmFwc2hvdExpc3RlbmVyKG4sIGUuX3F1ZXJ5KS50aGVuKChuID0+IG5ldyBRdWVyeVNuYXBzaG90KHQsIHIsIGUsIG4pKSk7XG59XG5cbi8qKlxuICogRXhlY3V0ZXMgdGhlIHF1ZXJ5IGFuZCByZXR1cm5zIHRoZSByZXN1bHRzIGFzIGEgYFF1ZXJ5U25hcHNob3RgIGZyb20gY2FjaGUuXG4gKiBSZXR1cm5zIGFuIGVtcHR5IHJlc3VsdCBzZXQgaWYgbm8gZG9jdW1lbnRzIG1hdGNoaW5nIHRoZSBxdWVyeSBhcmUgY3VycmVudGx5XG4gKiBjYWNoZWQuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdpdGggdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5LlxuICovIGZ1bmN0aW9uIGdldERvY3NGcm9tQ2FjaGUoZSkge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBRdWVyeSk7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCh0KSwgciA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIodCk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNGcm9tTG9jYWxDYWNoZShuLCBlLl9xdWVyeSkudGhlbigobiA9PiBuZXcgUXVlcnlTbmFwc2hvdCh0LCByLCBlLCBuKSkpO1xufVxuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBxdWVyeSBhbmQgcmV0dXJucyB0aGUgcmVzdWx0cyBhcyBhIGBRdWVyeVNuYXBzaG90YCBmcm9tIHRoZVxuICogc2VydmVyLiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBuZXR3b3JrIGlzIG5vdCBhdmFpbGFibGUuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdpdGggdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5LlxuICovIGZ1bmN0aW9uIGdldERvY3NGcm9tU2VydmVyKGUpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgUXVlcnkpO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgbiA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIHIgPSBuZXcgX19QUklWQVRFX0V4cFVzZXJEYXRhV3JpdGVyKHQpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRzVmlhU25hcHNob3RMaXN0ZW5lcihuLCBlLl9xdWVyeSwge1xuICAgICAgICBzb3VyY2U6IFwic2VydmVyXCJcbiAgICB9KS50aGVuKChuID0+IG5ldyBRdWVyeVNuYXBzaG90KHQsIHIsIGUsIG4pKSk7XG59XG5cbmZ1bmN0aW9uIHNldERvYyhlLCB0LCBuKSB7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIERvY3VtZW50UmVmZXJlbmNlKTtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSksIGkgPSBfX1BSSVZBVEVfYXBwbHlGaXJlc3RvcmVEYXRhQ29udmVydGVyKGUuY29udmVydGVyLCB0LCBuKTtcbiAgICByZXR1cm4gZXhlY3V0ZVdyaXRlKHIsIFsgX19QUklWQVRFX3BhcnNlU2V0RGF0YShfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIociksIFwic2V0RG9jXCIsIGUuX2tleSwgaSwgbnVsbCAhPT0gZS5jb252ZXJ0ZXIsIG4pLnRvTXV0YXRpb24oZS5fa2V5LCBQcmVjb25kaXRpb24ubm9uZSgpKSBdKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlRG9jKGUsIHQsIG4sIC4uLnIpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgRG9jdW1lbnRSZWZlcmVuY2UpO1xuICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgcyA9IF9fUFJJVkFURV9uZXdVc2VyRGF0YVJlYWRlcihpKTtcbiAgICBsZXQgbztcbiAgICBvID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgKFxuICAgIC8vIEZvciBDb21wYXQgdHlwZXMsIHdlIGhhdmUgdG8gXCJleHRyYWN0XCIgdGhlIHVuZGVybHlpbmcgdHlwZXMgYmVmb3JlXG4gICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgIHQgPSBnZXRNb2R1bGFySW5zdGFuY2UodCkpIHx8IHQgaW5zdGFuY2VvZiBGaWVsZFBhdGggPyBfX1BSSVZBVEVfcGFyc2VVcGRhdGVWYXJhcmdzKHMsIFwidXBkYXRlRG9jXCIsIGUuX2tleSwgdCwgbiwgcikgOiBfX1BSSVZBVEVfcGFyc2VVcGRhdGVEYXRhKHMsIFwidXBkYXRlRG9jXCIsIGUuX2tleSwgdCk7XG4gICAgcmV0dXJuIGV4ZWN1dGVXcml0ZShpLCBbIG8udG9NdXRhdGlvbihlLl9rZXksIFByZWNvbmRpdGlvbi5leGlzdHMoITApKSBdKTtcbn1cblxuLyoqXG4gKiBEZWxldGVzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGUgc3BlY2lmaWVkIGBEb2N1bWVudFJlZmVyZW5jZWAuXG4gKlxuICogQHBhcmFtIHJlZmVyZW5jZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBkZWxldGUuXG4gKiBAcmV0dXJucyBBIFByb21pc2UgcmVzb2x2ZWQgb25jZSB0aGUgZG9jdW1lbnQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5XG4gKiBkZWxldGVkIGZyb20gdGhlIGJhY2tlbmQgKG5vdGUgdGhhdCBpdCB3b24ndCByZXNvbHZlIHdoaWxlIHlvdSdyZSBvZmZsaW5lKS5cbiAqLyBmdW5jdGlvbiBkZWxldGVEb2MoZSkge1xuICAgIHJldHVybiBleGVjdXRlV3JpdGUoX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSksIFsgbmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihlLl9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpIF0pO1xufVxuXG4vKipcbiAqIEFkZCBhIG5ldyBkb2N1bWVudCB0byBzcGVjaWZpZWQgYENvbGxlY3Rpb25SZWZlcmVuY2VgIHdpdGggdGhlIGdpdmVuIGRhdGEsXG4gKiBhc3NpZ25pbmcgaXQgYSBkb2N1bWVudCBJRCBhdXRvbWF0aWNhbGx5LlxuICpcbiAqIEBwYXJhbSByZWZlcmVuY2UgLSBBIHJlZmVyZW5jZSB0byB0aGUgY29sbGVjdGlvbiB0byBhZGQgdGhpcyBkb2N1bWVudCB0by5cbiAqIEBwYXJhbSBkYXRhIC0gQW4gT2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEgZm9yIHRoZSBuZXcgZG9jdW1lbnQuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50UmVmZXJlbmNlYCBwb2ludGluZyB0byB0aGVcbiAqIG5ld2x5IGNyZWF0ZWQgZG9jdW1lbnQgYWZ0ZXIgaXQgaGFzIGJlZW4gd3JpdHRlbiB0byB0aGUgYmFja2VuZCAoTm90ZSB0aGF0IGl0XG4gKiB3b24ndCByZXNvbHZlIHdoaWxlIHlvdSdyZSBvZmZsaW5lKS5cbiAqLyBmdW5jdGlvbiBhZGREb2MoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgciA9IGRvYyhlKSwgaSA9IF9fUFJJVkFURV9hcHBseUZpcmVzdG9yZURhdGFDb252ZXJ0ZXIoZS5jb252ZXJ0ZXIsIHQpO1xuICAgIHJldHVybiBleGVjdXRlV3JpdGUobiwgWyBfX1BSSVZBVEVfcGFyc2VTZXREYXRhKF9fUFJJVkFURV9uZXdVc2VyRGF0YVJlYWRlcihlLmZpcmVzdG9yZSksIFwiYWRkRG9jXCIsIHIuX2tleSwgaSwgbnVsbCAhPT0gZS5jb252ZXJ0ZXIsIHt9KS50b011dGF0aW9uKHIuX2tleSwgUHJlY29uZGl0aW9uLmV4aXN0cyghMSkpIF0pLnRoZW4oKCgpID0+IHIpKTtcbn1cblxuZnVuY3Rpb24gb25TbmFwc2hvdChlLCAuLi50KSB7XG4gICAgdmFyIG4sIHIsIGk7XG4gICAgZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKTtcbiAgICBsZXQgcyA9IHtcbiAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogITEsXG4gICAgICAgIHNvdXJjZTogXCJkZWZhdWx0XCJcbiAgICB9LCBvID0gMDtcbiAgICBcIm9iamVjdFwiICE9IHR5cGVvZiB0W29dIHx8IF9fUFJJVkFURV9pc1BhcnRpYWxPYnNlcnZlcih0W29dKSB8fCAocyA9IHRbb10sIG8rKyk7XG4gICAgY29uc3QgXyA9IHtcbiAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogcy5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzLFxuICAgICAgICBzb3VyY2U6IHMuc291cmNlXG4gICAgfTtcbiAgICBpZiAoX19QUklWQVRFX2lzUGFydGlhbE9ic2VydmVyKHRbb10pKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0W29dO1xuICAgICAgICB0W29dID0gbnVsbCA9PT0gKG4gPSBlLm5leHQpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uYmluZChlKSwgdFtvICsgMV0gPSBudWxsID09PSAociA9IGUuZXJyb3IpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuYmluZChlKSwgXG4gICAgICAgIHRbbyArIDJdID0gbnVsbCA9PT0gKGkgPSBlLmNvbXBsZXRlKSB8fCB2b2lkIDAgPT09IGkgPyB2b2lkIDAgOiBpLmJpbmQoZSk7XG4gICAgfVxuICAgIGxldCBhLCB1LCBjO1xuICAgIGlmIChlIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UpIHUgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgXG4gICAgYyA9IF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgoZS5fa2V5LnBhdGgpLCBhID0ge1xuICAgICAgICBuZXh0OiBuID0+IHtcbiAgICAgICAgICAgIHRbb10gJiYgdFtvXShfX1BSSVZBVEVfY29udmVydFRvRG9jU25hcHNob3QodSwgZSwgbikpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogdFtvICsgMV0sXG4gICAgICAgIGNvbXBsZXRlOiB0W28gKyAyXVxuICAgIH07IGVsc2Uge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2Nhc3QoZSwgUXVlcnkpO1xuICAgICAgICB1ID0gX19QUklWQVRFX2Nhc3Qobi5maXJlc3RvcmUsIEZpcmVzdG9yZSksIGMgPSBuLl9xdWVyeTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIodSk7XG4gICAgICAgIGEgPSB7XG4gICAgICAgICAgICBuZXh0OiBlID0+IHtcbiAgICAgICAgICAgICAgICB0W29dICYmIHRbb10obmV3IFF1ZXJ5U25hcHNob3QodSwgciwgbiwgZSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB0W28gKyAxXSxcbiAgICAgICAgICAgIGNvbXBsZXRlOiB0W28gKyAyXVxuICAgICAgICB9LCBfX1BSSVZBVEVfdmFsaWRhdGVIYXNFeHBsaWNpdE9yZGVyQnlGb3JMaW1pdFRvTGFzdChlLl9xdWVyeSk7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50TGlzdGVuKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfQXN5bmNPYnNlcnZlcihyKSwgcyA9IG5ldyBfX1BSSVZBVEVfUXVlcnlMaXN0ZW5lcih0LCBpLCBuKTtcbiAgICAgICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyTGlzdGVuKGF3YWl0IF9fUFJJVkFURV9nZXRFdmVudE1hbmFnZXIoZSksIHMpKSksIFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICBpLlphKCksIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyVW5saXN0ZW4oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgcykpKTtcbiAgICAgICAgfTtcbiAgICB9KGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodSksIGMsIF8sIGEpO1xufVxuXG5mdW5jdGlvbiBvblNuYXBzaG90c0luU3luYyhlLCB0KSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRBZGRTbmFwc2hvdHNJblN5bmNMaXN0ZW5lcihlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKSwgX19QUklWQVRFX2lzUGFydGlhbE9ic2VydmVyKHQpID8gdCA6IHtcbiAgICAgICAgbmV4dDogdFxuICAgIH0pO1xufVxuXG4vKipcbiAqIExvY2FsbHkgd3JpdGVzIGBtdXRhdGlvbnNgIG9uIHRoZSBhc3luYyBxdWV1ZS5cbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIGV4ZWN1dGVXcml0ZShlLCB0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRXcml0ZShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IF9fUFJJVkFURV9zeW5jRW5naW5lV3JpdGUoYXdhaXQgX19QUklWQVRFX2dldFN5bmNFbmdpbmUoZSksIHQsIG4pKSksIFxuICAgICAgICBuLnByb21pc2U7XG4gICAgfShlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUpLCB0KTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIHtAbGluayBWaWV3U25hcHNob3R9IHRoYXQgY29udGFpbnMgdGhlIHNpbmdsZSBkb2N1bWVudCBzcGVjaWZpZWQgYnkgYHJlZmBcbiAqIHRvIGEge0BsaW5rIERvY3VtZW50U25hcHNob3R9LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jb252ZXJ0VG9Eb2NTbmFwc2hvdChlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IG4uZG9jcy5nZXQodC5fa2V5KSwgaSA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIoZSk7XG4gICAgcmV0dXJuIG5ldyBEb2N1bWVudFNuYXBzaG90KGUsIGksIHQuX2tleSwgciwgbmV3IFNuYXBzaG90TWV0YWRhdGEobi5oYXNQZW5kaW5nV3JpdGVzLCBuLmZyb21DYWNoZSksIHQuY29udmVydGVyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgbnVtYmVyIG9mIGRvY3VtZW50cyBpbiB0aGUgcmVzdWx0IHNldCBvZiB0aGUgZ2l2ZW4gcXVlcnlcbiAqIHdpdGhvdXQgYWN0dWFsbHkgZG93bmxvYWRpbmcgdGhlIGRvY3VtZW50cy5cbiAqXG4gKiBVc2luZyB0aGlzIGZ1bmN0aW9uIHRvIGNvdW50IHRoZSBkb2N1bWVudHMgaXMgZWZmaWNpZW50IGJlY2F1c2Ugb25seSB0aGVcbiAqIGZpbmFsIGNvdW50LCBub3QgdGhlIGRvY3VtZW50cycgZGF0YSwgaXMgZG93bmxvYWRlZC4gVGhpcyBmdW5jdGlvbiBjYW5cbiAqIGNvdW50IHRoZSBkb2N1bWVudHMgaW4gY2FzZXMgd2hlcmUgdGhlIHJlc3VsdCBzZXQgaXMgcHJvaGliaXRpdmVseSBsYXJnZSB0b1xuICogZG93bmxvYWQgZW50aXJlbHkgKHRob3VzYW5kcyBvZiBkb2N1bWVudHMpLlxuICpcbiAqIFRoZSByZXN1bHQgcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyIGlzIHByZXNlbnRlZCwgdW5hbHRlcmVkLCB3aXRob3V0XG4gKiBjb25zaWRlcmluZyBhbnkgbG9jYWwgc3RhdGUuIFRoYXQgaXMsIGRvY3VtZW50cyBpbiB0aGUgbG9jYWwgY2FjaGUgYXJlIG5vdFxuICogdGFrZW4gaW50byBjb25zaWRlcmF0aW9uLCBuZWl0aGVyIGFyZSBsb2NhbCBtb2RpZmljYXRpb25zIG5vdCB5ZXRcbiAqIHN5bmNocm9uaXplZCB3aXRoIHRoZSBzZXJ2ZXIuIFByZXZpb3VzbHktZG93bmxvYWRlZCByZXN1bHRzLCBpZiBhbnksIGFyZSBub3RcbiAqIHVzZWQuIEV2ZXJ5IGludm9jYXRpb24gb2YgdGhpcyBmdW5jdGlvbiBuZWNlc3NhcmlseSBpbnZvbHZlcyBhIHJvdW5kIHRyaXAgdG9cbiAqIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IFRoZSBxdWVyeSB3aG9zZSByZXN1bHQgc2V0IHNpemUgaXMgY2FsY3VsYXRlZC5cbiAqIEByZXR1cm5zIEEgUHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgY291bnQ7IHRoZSBjb3VudCBjYW4gYmVcbiAqIHJldHJpZXZlZCBmcm9tIGBzbmFwc2hvdC5kYXRhKCkuY291bnRgLCB3aGVyZSBgc25hcHNob3RgIGlzIHRoZVxuICogYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIHRvIHdoaWNoIHRoZSByZXR1cm5lZCBQcm9taXNlIHJlc29sdmVzLlxuICovIGZ1bmN0aW9uIGdldENvdW50RnJvbVNlcnZlcihlKSB7XG4gICAgcmV0dXJuIGdldEFnZ3JlZ2F0ZUZyb21TZXJ2ZXIoZSwge1xuICAgICAgICBjb3VudDogY291bnQoKVxuICAgIH0pO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHNwZWNpZmllZCBhZ2dyZWdhdGlvbnMgb3ZlciB0aGUgZG9jdW1lbnRzIGluIHRoZSByZXN1bHRcbiAqIHNldCBvZiB0aGUgZ2l2ZW4gcXVlcnkgd2l0aG91dCBhY3R1YWxseSBkb3dubG9hZGluZyB0aGUgZG9jdW1lbnRzLlxuICpcbiAqIFVzaW5nIHRoaXMgZnVuY3Rpb24gdG8gcGVyZm9ybSBhZ2dyZWdhdGlvbnMgaXMgZWZmaWNpZW50IGJlY2F1c2Ugb25seSB0aGVcbiAqIGZpbmFsIGFnZ3JlZ2F0aW9uIHZhbHVlcywgbm90IHRoZSBkb2N1bWVudHMnIGRhdGEsIGFyZSBkb3dubG9hZGVkLiBUaGlzXG4gKiBmdW5jdGlvbiBjYW4gcGVyZm9ybSBhZ2dyZWdhdGlvbnMgb2YgdGhlIGRvY3VtZW50cyBpbiBjYXNlcyB3aGVyZSB0aGUgcmVzdWx0XG4gKiBzZXQgaXMgcHJvaGliaXRpdmVseSBsYXJnZSB0byBkb3dubG9hZCBlbnRpcmVseSAodGhvdXNhbmRzIG9mIGRvY3VtZW50cykuXG4gKlxuICogVGhlIHJlc3VsdCByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIgaXMgcHJlc2VudGVkLCB1bmFsdGVyZWQsIHdpdGhvdXRcbiAqIGNvbnNpZGVyaW5nIGFueSBsb2NhbCBzdGF0ZS4gVGhhdCBpcywgZG9jdW1lbnRzIGluIHRoZSBsb2NhbCBjYWNoZSBhcmUgbm90XG4gKiB0YWtlbiBpbnRvIGNvbnNpZGVyYXRpb24sIG5laXRoZXIgYXJlIGxvY2FsIG1vZGlmaWNhdGlvbnMgbm90IHlldFxuICogc3luY2hyb25pemVkIHdpdGggdGhlIHNlcnZlci4gUHJldmlvdXNseS1kb3dubG9hZGVkIHJlc3VsdHMsIGlmIGFueSwgYXJlIG5vdFxuICogdXNlZC4gRXZlcnkgaW52b2NhdGlvbiBvZiB0aGlzIGZ1bmN0aW9uIG5lY2Vzc2FyaWx5IGludm9sdmVzIGEgcm91bmQgdHJpcCB0b1xuICogdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0gcXVlcnkgVGhlIHF1ZXJ5IHdob3NlIHJlc3VsdCBzZXQgaXMgYWdncmVnYXRlZCBvdmVyLlxuICogQHBhcmFtIGFnZ3JlZ2F0ZVNwZWMgQW4gYEFnZ3JlZ2F0ZVNwZWNgIG9iamVjdCB0aGF0IHNwZWNpZmllcyB0aGUgYWdncmVnYXRlc1xuICogdG8gcGVyZm9ybSBvdmVyIHRoZSByZXN1bHQgc2V0LiBUaGUgQWdncmVnYXRlU3BlYyBzcGVjaWZpZXMgYWxpYXNlcyBmb3IgZWFjaFxuICogYWdncmVnYXRlLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXRyaWV2ZSB0aGUgYWdncmVnYXRlIHJlc3VsdC5cbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCBhZ2dyZWdhdGVTbmFwc2hvdCA9IGF3YWl0IGdldEFnZ3JlZ2F0ZUZyb21TZXJ2ZXIocXVlcnksIHtcbiAqICAgY291bnRPZkRvY3M6IGNvdW50KCksXG4gKiAgIHRvdGFsSG91cnM6IHN1bSgnaG91cnMnKSxcbiAqICAgYXZlcmFnZVNjb3JlOiBhdmVyYWdlKCdzY29yZScpXG4gKiB9KTtcbiAqXG4gKiBjb25zdCBjb3VudE9mRG9jczogbnVtYmVyID0gYWdncmVnYXRlU25hcHNob3QuZGF0YSgpLmNvdW50T2ZEb2NzO1xuICogY29uc3QgdG90YWxIb3VyczogbnVtYmVyID0gYWdncmVnYXRlU25hcHNob3QuZGF0YSgpLnRvdGFsSG91cnM7XG4gKiBjb25zdCBhdmVyYWdlU2NvcmU6IG51bWJlciB8IG51bGwgPSBhZ2dyZWdhdGVTbmFwc2hvdC5kYXRhKCkuYXZlcmFnZVNjb3JlO1xuICogYGBgXG4gKi8gZnVuY3Rpb24gZ2V0QWdncmVnYXRlRnJvbVNlcnZlcihlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCByID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChuKSwgaSA9IF9fUFJJVkFURV9tYXBUb0FycmF5KHQsICgoZSwgdCkgPT4gbmV3IF9fUFJJVkFURV9BZ2dyZWdhdGVJbXBsKHQsIGUuYWdncmVnYXRlVHlwZSwgZS5faW50ZXJuYWxGaWVsZFBhdGgpKSk7XG4gICAgLy8gUnVuIHRoZSBhZ2dyZWdhdGlvbiBhbmQgY29udmVydCB0aGUgcmVzdWx0c1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50UnVuQWdncmVnYXRlUXVlcnkociwgZS5fcXVlcnksIGkpLnRoZW4oKHQgPT4gXG4gICAgLyoqXG4gKiBDb252ZXJ0cyB0aGUgY29yZSBhZ2dyZWdhdGlvbiByZXN1bHQgdG8gYW4gYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgXG4gKiB0aGF0IGNhbiBiZSByZXR1cm5lZCB0byB0aGUgY29uc3VtZXIuXG4gKiBAcGFyYW0gcXVlcnlcbiAqIEBwYXJhbSBhZ2dyZWdhdGVSZXN1bHQgQ29yZSBhZ2dyZWdhdGlvbiByZXN1bHRcbiAqIEBpbnRlcm5hbFxuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2NvbnZlcnRUb0FnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3QoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcihlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90KHQsIHIsIG4pO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAobiwgZSwgdCkpKTtcbn1cblxuY2xhc3MgX19QUklWQVRFX01lbW9yeUxvY2FsQ2FjaGVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua2luZCA9IFwibWVtb3J5XCIsIHRoaXMuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyID0gT25saW5lQ29tcG9uZW50UHJvdmlkZXIucHJvdmlkZXIsIFxuICAgICAgICAobnVsbCA9PSBlID8gdm9pZCAwIDogZS5nYXJiYWdlQ29sbGVjdG9yKSA/IHRoaXMuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA9IGUuZ2FyYmFnZUNvbGxlY3Rvci5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIDogdGhpcy5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyID0gX19QUklWQVRFX01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlci5wcm92aWRlcjtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2luZDogdGhpcy5raW5kXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfUGVyc2lzdGVudExvY2FsQ2FjaGVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIGxldCB0O1xuICAgICAgICB0aGlzLmtpbmQgPSBcInBlcnNpc3RlbnRcIiwgKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUudGFiTWFuYWdlcikgPyAoZS50YWJNYW5hZ2VyLl9pbml0aWFsaXplKGUpLCBcbiAgICAgICAgdCA9IGUudGFiTWFuYWdlcikgOiAodCA9IHBlcnNpc3RlbnRTaW5nbGVUYWJNYW5hZ2VyKHZvaWQgMCksIHQuX2luaXRpYWxpemUoZSkpLCBcbiAgICAgICAgdGhpcy5fb25saW5lQ29tcG9uZW50UHJvdmlkZXIgPSB0Ll9vbmxpbmVDb21wb25lbnRQcm92aWRlciwgdGhpcy5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyID0gdC5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlFYWdlckdhcmJhZ2VDb2xsZWN0b3JJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5raW5kID0gXCJtZW1vcnlFYWdlclwiLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSBfX1BSSVZBVEVfTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9ySW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmtpbmQgPSBcIm1lbW9yeUxydVwiLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSB7XG4gICAgICAgICAgICBidWlsZDogKCkgPT4gbmV3IF9fUFJJVkFURV9McnVHY01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlcihlKVxuICAgICAgICB9O1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBgTWVtb3J5RWFnZXJHYXJiYWdlQ29sbGVjdG9yYC4gVGhpcyBpcyBhbHNvIHRoZVxuICogZGVmYXVsdCBnYXJiYWdlIGNvbGxlY3RvciB1bmxlc3MgaXQgaXMgZXhwbGljaXRseSBzcGVjaWZpZWQgb3RoZXJ3aXNlLlxuICovIGZ1bmN0aW9uIG1lbW9yeUVhZ2VyR2FyYmFnZUNvbGxlY3RvcigpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlFYWdlckdhcmJhZ2VDb2xsZWN0b3JJbXBsO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYE1lbW9yeUxydUdhcmJhZ2VDb2xsZWN0b3JgLlxuICpcbiAqIEEgdGFyZ2V0IHNpemUgY2FuIGJlIHNwZWNpZmllZCBhcyBwYXJ0IG9mIHRoZSBzZXR0aW5nIHBhcmFtZXRlci4gVGhlXG4gKiBjb2xsZWN0b3Igd2lsbCBzdGFydCBkZWxldGluZyBkb2N1bWVudHMgb25jZSB0aGUgY2FjaGUgc2l6ZSBleGNlZWRzXG4gKiB0aGUgZ2l2ZW4gc2l6ZS4gVGhlIGRlZmF1bHQgY2FjaGUgc2l6ZSBpcyA0ME1CICg0MCAqIDEwMjQgKiAxMDI0IGJ5dGVzKS5cbiAqLyBmdW5jdGlvbiBtZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9yKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9ySW1wbChudWxsID09IGUgPyB2b2lkIDAgOiBlLmNhY2hlU2l6ZUJ5dGVzKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBNZW1vcnlMb2NhbENhY2hlYC4gVGhlIGluc3RhbmNlIGNhbiBiZSBzZXQgdG9cbiAqIGBGaXJlc3RvcmVTZXR0aW5ncy5jYWNoZWAgdG8gdGVsbCB0aGUgU0RLIHdoaWNoIGNhY2hlIGxheWVyIHRvIHVzZS5cbiAqLyBmdW5jdGlvbiBtZW1vcnlMb2NhbENhY2hlKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlMb2NhbENhY2hlSW1wbChlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBQZXJzaXN0ZW50TG9jYWxDYWNoZWAuIFRoZSBpbnN0YW5jZSBjYW4gYmUgc2V0IHRvXG4gKiBgRmlyZXN0b3JlU2V0dGluZ3MuY2FjaGVgIHRvIHRlbGwgdGhlIFNESyB3aGljaCBjYWNoZSBsYXllciB0byB1c2UuXG4gKlxuICogUGVyc2lzdGVudCBjYWNoZSBjYW5ub3QgYmUgdXNlZCBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQuXG4gKi8gZnVuY3Rpb24gcGVyc2lzdGVudExvY2FsQ2FjaGUoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BlcnNpc3RlbnRMb2NhbENhY2hlSW1wbChlKTtcbn1cblxuY2xhc3MgX19QUklWQVRFX1NpbmdsZVRhYk1hbmFnZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuZm9yY2VPd25lcnNoaXAgPSBlLCB0aGlzLmtpbmQgPSBcInBlcnNpc3RlbnRTaW5nbGVUYWJcIjtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2luZDogdGhpcy5raW5kXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqLyAgICBfaW5pdGlhbGl6ZShlKSB7XG4gICAgICAgIHRoaXMuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyID0gT25saW5lQ29tcG9uZW50UHJvdmlkZXIucHJvdmlkZXIsIHRoaXMuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA9IHtcbiAgICAgICAgICAgIGJ1aWxkOiB0ID0+IG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKHQsIG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuY2FjaGVTaXplQnl0ZXMsIHRoaXMuZm9yY2VPd25lcnNoaXApXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfTXVsdGlUYWJNYW5hZ2VySW1wbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMua2luZCA9IFwiUGVyc2lzdGVudE11bHRpcGxlVGFiXCI7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtpbmQ6IHRoaXMua2luZFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi8gICAgX2luaXRpYWxpemUoZSkge1xuICAgICAgICB0aGlzLl9vbmxpbmVDb21wb25lbnRQcm92aWRlciA9IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSB7XG4gICAgICAgICAgICBidWlsZDogdCA9PiBuZXcgX19QUklWQVRFX011bHRpVGFiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKHQsIG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuY2FjaGVTaXplQnl0ZXMpXG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYFBlcnNpc3RlbnRTaW5nbGVUYWJNYW5hZ2VyYC5cbiAqXG4gKiBAcGFyYW0gc2V0dGluZ3MgQ29uZmlndXJlcyB0aGUgY3JlYXRlZCB0YWIgbWFuYWdlci5cbiAqLyBmdW5jdGlvbiBwZXJzaXN0ZW50U2luZ2xlVGFiTWFuYWdlcihlKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2luZ2xlVGFiTWFuYWdlckltcGwobnVsbCA9PSBlID8gdm9pZCAwIDogZS5mb3JjZU93bmVyc2hpcCk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBgUGVyc2lzdGVudE11bHRpcGxlVGFiTWFuYWdlcmAuXG4gKi8gZnVuY3Rpb24gcGVyc2lzdGVudE11bHRpcGxlVGFiTWFuYWdlcigpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NdWx0aVRhYk1hbmFnZXJJbXBsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCB2ZSA9IHtcbiAgICBtYXhBdHRlbXB0czogNVxufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSB3cml0ZSBiYXRjaCwgdXNlZCB0byBwZXJmb3JtIG11bHRpcGxlIHdyaXRlcyBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAqXG4gKiBBIGBXcml0ZUJhdGNoYCBvYmplY3QgY2FuIGJlIGFjcXVpcmVkIGJ5IGNhbGxpbmcge0BsaW5rIHdyaXRlQmF0Y2h9LiBJdFxuICogcHJvdmlkZXMgbWV0aG9kcyBmb3IgYWRkaW5nIHdyaXRlcyB0byB0aGUgd3JpdGUgYmF0Y2guIE5vbmUgb2YgdGhlIHdyaXRlc1xuICogd2lsbCBiZSBjb21taXR0ZWQgKG9yIHZpc2libGUgbG9jYWxseSkgdW50aWwge0BsaW5rIFdyaXRlQmF0Y2guY29tbWl0fSBpc1xuICogY2FsbGVkLlxuICovXG5jbGFzcyBXcml0ZUJhdGNoIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fY29tbWl0SGFuZGxlciA9IHQsIHRoaXMuX211dGF0aW9ucyA9IFtdLCB0aGlzLl9jb21taXR0ZWQgPSAhMSwgXG4gICAgICAgIHRoaXMuX2RhdGFSZWFkZXIgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSk7XG4gICAgfVxuICAgIHNldChlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuX3ZlcmlmeU5vdENvbW1pdHRlZCgpO1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3ZhbGlkYXRlUmVmZXJlbmNlKGUsIHRoaXMuX2ZpcmVzdG9yZSksIGkgPSBfX1BSSVZBVEVfYXBwbHlGaXJlc3RvcmVEYXRhQ29udmVydGVyKHIuY29udmVydGVyLCB0LCBuKSwgcyA9IF9fUFJJVkFURV9wYXJzZVNldERhdGEodGhpcy5fZGF0YVJlYWRlciwgXCJXcml0ZUJhdGNoLnNldFwiLCByLl9rZXksIGksIG51bGwgIT09IHIuY29udmVydGVyLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucy5wdXNoKHMudG9NdXRhdGlvbihyLl9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpKSwgdGhpcztcbiAgICB9XG4gICAgdXBkYXRlKGUsIHQsIG4sIC4uLnIpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIGxldCBzO1xuICAgICAgICByZXR1cm4gcyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mICh0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSB8fCB0IGluc3RhbmNlb2YgRmllbGRQYXRoID8gX19QUklWQVRFX3BhcnNlVXBkYXRlVmFyYXJncyh0aGlzLl9kYXRhUmVhZGVyLCBcIldyaXRlQmF0Y2gudXBkYXRlXCIsIGkuX2tleSwgdCwgbiwgcikgOiBfX1BSSVZBVEVfcGFyc2VVcGRhdGVEYXRhKHRoaXMuX2RhdGFSZWFkZXIsIFwiV3JpdGVCYXRjaC51cGRhdGVcIiwgaS5fa2V5LCB0KSwgXG4gICAgICAgIHRoaXMuX211dGF0aW9ucy5wdXNoKHMudG9NdXRhdGlvbihpLl9rZXksIFByZWNvbmRpdGlvbi5leGlzdHMoITApKSksIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZXMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIGRlbGV0ZWQuXG4gICAgICogQHJldHVybnMgVGhpcyBgV3JpdGVCYXRjaGAgaW5zdGFuY2UuIFVzZWQgZm9yIGNoYWluaW5nIG1ldGhvZCBjYWxscy5cbiAgICAgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucyA9IHRoaXMuX211dGF0aW9ucy5jb25jYXQobmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbih0Ll9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpKSwgXG4gICAgICAgIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbW1pdHMgYWxsIG9mIHRoZSB3cml0ZXMgaW4gdGhpcyB3cml0ZSBiYXRjaCBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAgICAgKlxuICAgICAqIFRoZSByZXN1bHQgb2YgdGhlc2Ugd3JpdGVzIHdpbGwgb25seSBiZSByZWZsZWN0ZWQgaW4gZG9jdW1lbnQgcmVhZHMgdGhhdFxuICAgICAqIG9jY3VyIGFmdGVyIHRoZSByZXR1cm5lZCBwcm9taXNlIHJlc29sdmVzLiBJZiB0aGUgY2xpZW50IGlzIG9mZmxpbmUsIHRoZVxuICAgICAqIHdyaXRlIGZhaWxzLiBJZiB5b3Ugd291bGQgbGlrZSB0byBzZWUgbG9jYWwgbW9kaWZpY2F0aW9ucyBvciBidWZmZXIgd3JpdGVzXG4gICAgICogdW50aWwgdGhlIGNsaWVudCBpcyBvbmxpbmUsIHVzZSB0aGUgZnVsbCBGaXJlc3RvcmUgU0RLLlxuICAgICAqXG4gICAgICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgb25jZSBhbGwgb2YgdGhlIHdyaXRlcyBpbiB0aGUgYmF0Y2ggaGF2ZSBiZWVuXG4gICAgICogc3VjY2Vzc2Z1bGx5IHdyaXR0ZW4gdG8gdGhlIGJhY2tlbmQgYXMgYW4gYXRvbWljIHVuaXQgKG5vdGUgdGhhdCBpdCB3b24ndFxuICAgICAqIHJlc29sdmUgd2hpbGUgeW91J3JlIG9mZmxpbmUpLlxuICAgICAqLyAgICBjb21taXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92ZXJpZnlOb3RDb21taXR0ZWQoKSwgdGhpcy5fY29tbWl0dGVkID0gITAsIHRoaXMuX211dGF0aW9ucy5sZW5ndGggPiAwID8gdGhpcy5fY29tbWl0SGFuZGxlcih0aGlzLl9tdXRhdGlvbnMpIDogUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIF92ZXJpZnlOb3RDb21taXR0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb21taXR0ZWQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELkZBSUxFRF9QUkVDT05ESVRJT04sIFwiQSB3cml0ZSBiYXRjaCBjYW4gbm8gbG9uZ2VyIGJlIHVzZWQgYWZ0ZXIgY29tbWl0KCkgaGFzIGJlZW4gY2FsbGVkLlwiKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0KSB7XG4gICAgaWYgKChlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKS5maXJlc3RvcmUgIT09IHQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiUHJvdmlkZWQgZG9jdW1lbnQgcmVmZXJlbmNlIGlzIGZyb20gYSBkaWZmZXJlbnQgRmlyZXN0b3JlIGluc3RhbmNlLlwiKTtcbiAgICByZXR1cm4gZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRPRE8obXJzY2htaWR0KSBDb25zaWRlciB1c2luZyBgQmFzZVRyYW5zYWN0aW9uYCBhcyB0aGUgYmFzZSBjbGFzcyBpbiB0aGVcbi8vIGxlZ2FjeSBTREsuXG4vKipcbiAqIEEgcmVmZXJlbmNlIHRvIGEgdHJhbnNhY3Rpb24uXG4gKlxuICogVGhlIGBUcmFuc2FjdGlvbmAgb2JqZWN0IHBhc3NlZCB0byBhIHRyYW5zYWN0aW9uJ3MgYHVwZGF0ZUZ1bmN0aW9uYCBwcm92aWRlc1xuICogdGhlIG1ldGhvZHMgdG8gcmVhZCBhbmQgd3JpdGUgZGF0YSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uIGNvbnRleHQuIFNlZVxuICoge0BsaW5rIHJ1blRyYW5zYWN0aW9ufS5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSByZWZlcmVuY2UgdG8gYSB0cmFuc2FjdGlvbi5cbiAqXG4gKiBUaGUgYFRyYW5zYWN0aW9uYCBvYmplY3QgcGFzc2VkIHRvIGEgdHJhbnNhY3Rpb24ncyBgdXBkYXRlRnVuY3Rpb25gIHByb3ZpZGVzXG4gKiB0aGUgbWV0aG9kcyB0byByZWFkIGFuZCB3cml0ZSBkYXRhIHdpdGhpbiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dC4gU2VlXG4gKiB7QGxpbmsgcnVuVHJhbnNhY3Rpb259LlxuICovXG5jbGFzcyBUcmFuc2FjdGlvbiBleHRlbmRzIGNsYXNzIFRyYW5zYWN0aW9uJDEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLl9maXJlc3RvcmUgPSBlLCB0aGlzLl90cmFuc2FjdGlvbiA9IHQsIHRoaXMuX2RhdGFSZWFkZXIgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIHRoZSBkb2N1bWVudCByZWZlcmVuY2VkIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIHJlYWQuXG4gICAgICogQHJldHVybnMgQSBgRG9jdW1lbnRTbmFwc2hvdGAgd2l0aCB0aGUgcmVhZCBkYXRhLlxuICAgICAqLyAgICBnZXQoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3ZhbGlkYXRlUmVmZXJlbmNlKGUsIHRoaXMuX2ZpcmVzdG9yZSksIG4gPSBuZXcgX19QUklWQVRFX0xpdGVVc2VyRGF0YVdyaXRlcih0aGlzLl9maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNhY3Rpb24ubG9va3VwKFsgdC5fa2V5IF0pLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgaWYgKCFlIHx8IDEgIT09IGUubGVuZ3RoKSByZXR1cm4gZmFpbCgpO1xuICAgICAgICAgICAgY29uc3QgciA9IGVbMF07XG4gICAgICAgICAgICBpZiAoci5pc0ZvdW5kRG9jdW1lbnQoKSkgcmV0dXJuIG5ldyBEb2N1bWVudFNuYXBzaG90JDEodGhpcy5fZmlyZXN0b3JlLCBuLCByLmtleSwgciwgdC5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgaWYgKHIuaXNOb0RvY3VtZW50KCkpIHJldHVybiBuZXcgRG9jdW1lbnRTbmFwc2hvdCQxKHRoaXMuX2ZpcmVzdG9yZSwgbiwgdC5fa2V5LCBudWxsLCB0LmNvbnZlcnRlcik7XG4gICAgICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2V0KGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0aGlzLl9maXJlc3RvcmUpLCBpID0gX19QUklWQVRFX2FwcGx5RmlyZXN0b3JlRGF0YUNvbnZlcnRlcihyLmNvbnZlcnRlciwgdCwgbiksIHMgPSBfX1BSSVZBVEVfcGFyc2VTZXREYXRhKHRoaXMuX2RhdGFSZWFkZXIsIFwiVHJhbnNhY3Rpb24uc2V0XCIsIHIuX2tleSwgaSwgbnVsbCAhPT0gci5jb252ZXJ0ZXIsIG4pO1xuICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNhY3Rpb24uc2V0KHIuX2tleSwgcyksIHRoaXM7XG4gICAgfVxuICAgIHVwZGF0ZShlLCB0LCBuLCAuLi5yKSB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIGxldCBzO1xuICAgICAgICByZXR1cm4gcyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mICh0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSB8fCB0IGluc3RhbmNlb2YgRmllbGRQYXRoID8gX19QUklWQVRFX3BhcnNlVXBkYXRlVmFyYXJncyh0aGlzLl9kYXRhUmVhZGVyLCBcIlRyYW5zYWN0aW9uLnVwZGF0ZVwiLCBpLl9rZXksIHQsIG4sIHIpIDogX19QUklWQVRFX3BhcnNlVXBkYXRlRGF0YSh0aGlzLl9kYXRhUmVhZGVyLCBcIlRyYW5zYWN0aW9uLnVwZGF0ZVwiLCBpLl9rZXksIHQpLCBcbiAgICAgICAgdGhpcy5fdHJhbnNhY3Rpb24udXBkYXRlKGkuX2tleSwgcyksIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZXMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIGRlbGV0ZWQuXG4gICAgICogQHJldHVybnMgVGhpcyBgVHJhbnNhY3Rpb25gIGluc3RhbmNlLiBVc2VkIGZvciBjaGFpbmluZyBtZXRob2QgY2FsbHMuXG4gICAgICovICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zYWN0aW9uLmRlbGV0ZSh0Ll9rZXkpLCB0aGlzO1xuICAgIH1cbn0ge1xuICAgIC8vIFRoaXMgY2xhc3MgaW1wbGVtZW50cyB0aGUgc2FtZSBsb2dpYyBhcyB0aGUgVHJhbnNhY3Rpb24gQVBJIGluIHRoZSBMaXRlIFNES1xuICAgIC8vIGJ1dCBpcyBzdWJjbGFzc2VkIGluIG9yZGVyIHRvIHJldHVybiBpdHMgb3duIERvY3VtZW50U25hcHNob3QgdHlwZXMuXG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIHQpLCB0aGlzLl9maXJlc3RvcmUgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJlbmNlZCBieSB0aGUgcHJvdmlkZWQge0BsaW5rIERvY3VtZW50UmVmZXJlbmNlfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudFJlZiAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBiZSByZWFkLlxuICAgICAqIEByZXR1cm5zIEEgYERvY3VtZW50U25hcHNob3RgIHdpdGggdGhlIHJlYWQgZGF0YS5cbiAgICAgKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0aGlzLl9maXJlc3RvcmUpLCBuID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcih0aGlzLl9maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0KGUpLnRoZW4oKGUgPT4gbmV3IERvY3VtZW50U25hcHNob3QodGhpcy5fZmlyZXN0b3JlLCBuLCB0Ll9rZXksIGUuX2RvY3VtZW50LCBuZXcgU25hcHNob3RNZXRhZGF0YShcbiAgICAgICAgLyogaGFzUGVuZGluZ1dyaXRlcz0gKi8gITEsIFxuICAgICAgICAvKiBmcm9tQ2FjaGU9ICovICExKSwgdC5jb252ZXJ0ZXIpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBnaXZlbiBgdXBkYXRlRnVuY3Rpb25gIGFuZCB0aGVuIGF0dGVtcHRzIHRvIGNvbW1pdCB0aGUgY2hhbmdlc1xuICogYXBwbGllZCB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uLiBJZiBhbnkgZG9jdW1lbnQgcmVhZCB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uXG4gKiBoYXMgY2hhbmdlZCwgQ2xvdWQgRmlyZXN0b3JlIHJldHJpZXMgdGhlIGB1cGRhdGVGdW5jdGlvbmAuIElmIGl0IGZhaWxzIHRvXG4gKiBjb21taXQgYWZ0ZXIgNSBhdHRlbXB0cywgdGhlIHRyYW5zYWN0aW9uIGZhaWxzLlxuICpcbiAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB3cml0ZXMgYWxsb3dlZCBpbiBhIHNpbmdsZSB0cmFuc2FjdGlvbiBpcyA1MDAuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBGaXJlc3RvcmUgZGF0YWJhc2UgdG8gcnVuIHRoaXNcbiAqIHRyYW5zYWN0aW9uIGFnYWluc3QuXG4gKiBAcGFyYW0gdXBkYXRlRnVuY3Rpb24gLSBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uXG4gKiBjb250ZXh0LlxuICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgbWF4aW11bSBudW1iZXIgb2YgYXR0ZW1wdHMgdG9cbiAqIGNvbW1pdC5cbiAqIEByZXR1cm5zIElmIHRoZSB0cmFuc2FjdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IG9yIHdhcyBleHBsaWNpdGx5IGFib3J0ZWRcbiAqICh0aGUgYHVwZGF0ZUZ1bmN0aW9uYCByZXR1cm5lZCBhIGZhaWxlZCBwcm9taXNlKSwgdGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhlXG4gKiBgdXBkYXRlRnVuY3Rpb24gYGlzIHJldHVybmVkIGhlcmUuIE90aGVyd2lzZSwgaWYgdGhlIHRyYW5zYWN0aW9uIGZhaWxlZCwgYVxuICogcmVqZWN0ZWQgcHJvbWlzZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIGZhaWx1cmUgZXJyb3IgaXMgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gcnVuVHJhbnNhY3Rpb24oZSwgdCwgbikge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpO1xuICAgIGNvbnN0IHIgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHZlKSwgbik7XG4gICAgIWZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVRyYW5zYWN0aW9uT3B0aW9ucyhlKSB7XG4gICAgICAgIGlmIChlLm1heEF0dGVtcHRzIDwgMSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJNYXggYXR0ZW1wdHMgbXVzdCBiZSBhdCBsZWFzdCAxXCIpO1xuICAgIH0ocik7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRUcmFuc2FjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBhd2FpdCBfX1BSSVZBVEVfZ2V0RGF0YXN0b3JlKGUpO1xuICAgICAgICAgICAgbmV3IF9fUFJJVkFURV9UcmFuc2FjdGlvblJ1bm5lcihlLmFzeW5jUXVldWUsIGksIG4sIHQsIHIpLmF1KCk7XG4gICAgICAgIH0pKSwgci5wcm9taXNlO1xuICAgIH0oZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlKSwgKG4gPT4gdChuZXcgVHJhbnNhY3Rpb24oZSwgbikpKSwgcik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgYSBzZW50aW5lbCBmb3IgdXNlIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSBvclxuICoge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSB3aXRoIGB7bWVyZ2U6IHRydWV9YCB0byBtYXJrIGEgZmllbGQgZm9yIGRlbGV0aW9uLlxuICovIGZ1bmN0aW9uIGRlbGV0ZUZpZWxkKCkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsKFwiZGVsZXRlRmllbGRcIik7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNlbnRpbmVsIHVzZWQgd2l0aCB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyhzZXREb2M6MSl9IG9yIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHVwZGF0ZURvYzoxKX0gdG9cbiAqIGluY2x1ZGUgYSBzZXJ2ZXItZ2VuZXJhdGVkIHRpbWVzdGFtcCBpbiB0aGUgd3JpdHRlbiBkYXRhLlxuICovIGZ1bmN0aW9uIHNlcnZlclRpbWVzdGFtcCgpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBGaWVsZFZhbHVlSW1wbChcInNlcnZlclRpbWVzdGFtcFwiKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCB2YWx1ZSB0aGF0IGNhbiBiZSB1c2VkIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSBvciB7QGxpbmtcbiAqIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSB0aGF0IHRlbGxzIHRoZSBzZXJ2ZXIgdG8gdW5pb24gdGhlIGdpdmVuIGVsZW1lbnRzIHdpdGggYW55IGFycmF5XG4gKiB2YWx1ZSB0aGF0IGFscmVhZHkgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIuIEVhY2ggc3BlY2lmaWVkIGVsZW1lbnQgdGhhdCBkb2Vzbid0XG4gKiBhbHJlYWR5IGV4aXN0IGluIHRoZSBhcnJheSB3aWxsIGJlIGFkZGVkIHRvIHRoZSBlbmQuIElmIHRoZSBmaWVsZCBiZWluZ1xuICogbW9kaWZpZWQgaXMgbm90IGFscmVhZHkgYW4gYXJyYXkgaXQgd2lsbCBiZSBvdmVyd3JpdHRlbiB3aXRoIGFuIGFycmF5XG4gKiBjb250YWluaW5nIGV4YWN0bHkgdGhlIHNwZWNpZmllZCBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudHMgLSBUaGUgZWxlbWVudHMgdG8gdW5pb24gaW50byB0aGUgYXJyYXkuXG4gKiBAcmV0dXJucyBUaGUgYEZpZWxkVmFsdWVgIHNlbnRpbmVsIGZvciB1c2UgaW4gYSBjYWxsIHRvIGBzZXREb2MoKWAgb3JcbiAqIGB1cGRhdGVEb2MoKWAuXG4gKi8gZnVuY3Rpb24gYXJyYXlVbmlvbiguLi5lKSB7XG4gICAgLy8gTk9URTogV2UgZG9uJ3QgYWN0dWFsbHkgcGFyc2UgdGhlIGRhdGEgdW50aWwgaXQncyB1c2VkIGluIHNldCgpIG9yXG4gICAgLy8gdXBkYXRlKCkgc2luY2Ugd2UnZCBuZWVkIHRoZSBGaXJlc3RvcmUgaW5zdGFuY2UgdG8gZG8gdGhpcy5cbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9BcnJheVVuaW9uRmllbGRWYWx1ZUltcGwoXCJhcnJheVVuaW9uXCIsIGUpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzcGVjaWFsIHZhbHVlIHRoYXQgY2FuIGJlIHVzZWQgd2l0aCB7QGxpbmsgKHNldERvYzoxKX0gb3Ige0BsaW5rXG4gKiB1cGRhdGVEb2M6MX0gdGhhdCB0ZWxscyB0aGUgc2VydmVyIHRvIHJlbW92ZSB0aGUgZ2l2ZW4gZWxlbWVudHMgZnJvbSBhbnlcbiAqIGFycmF5IHZhbHVlIHRoYXQgYWxyZWFkeSBleGlzdHMgb24gdGhlIHNlcnZlci4gQWxsIGluc3RhbmNlcyBvZiBlYWNoIGVsZW1lbnRcbiAqIHNwZWNpZmllZCB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgYXJyYXkuIElmIHRoZSBmaWVsZCBiZWluZyBtb2RpZmllZCBpcyBub3RcbiAqIGFscmVhZHkgYW4gYXJyYXkgaXQgd2lsbCBiZSBvdmVyd3JpdHRlbiB3aXRoIGFuIGVtcHR5IGFycmF5LlxuICpcbiAqIEBwYXJhbSBlbGVtZW50cyAtIFRoZSBlbGVtZW50cyB0byByZW1vdmUgZnJvbSB0aGUgYXJyYXkuXG4gKiBAcmV0dXJucyBUaGUgYEZpZWxkVmFsdWVgIHNlbnRpbmVsIGZvciB1c2UgaW4gYSBjYWxsIHRvIGBzZXREb2MoKWAgb3JcbiAqIGB1cGRhdGVEb2MoKWBcbiAqLyBmdW5jdGlvbiBhcnJheVJlbW92ZSguLi5lKSB7XG4gICAgLy8gTk9URTogV2UgZG9uJ3QgYWN0dWFsbHkgcGFyc2UgdGhlIGRhdGEgdW50aWwgaXQncyB1c2VkIGluIHNldCgpIG9yXG4gICAgLy8gdXBkYXRlKCkgc2luY2Ugd2UnZCBuZWVkIHRoZSBGaXJlc3RvcmUgaW5zdGFuY2UgdG8gZG8gdGhpcy5cbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9BcnJheVJlbW92ZUZpZWxkVmFsdWVJbXBsKFwiYXJyYXlSZW1vdmVcIiwgZSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNwZWNpYWwgdmFsdWUgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHNldERvYzoxKX0gb3Ige0BsaW5rXG4gKiBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHVwZGF0ZURvYzoxKX0gdGhhdCB0ZWxscyB0aGUgc2VydmVyIHRvIGluY3JlbWVudCB0aGUgZmllbGQncyBjdXJyZW50IHZhbHVlIGJ5XG4gKiB0aGUgZ2l2ZW4gdmFsdWUuXG4gKlxuICogSWYgZWl0aGVyIHRoZSBvcGVyYW5kIG9yIHRoZSBjdXJyZW50IGZpZWxkIHZhbHVlIHVzZXMgZmxvYXRpbmcgcG9pbnRcbiAqIHByZWNpc2lvbiwgYWxsIGFyaXRobWV0aWMgZm9sbG93cyBJRUVFIDc1NCBzZW1hbnRpY3MuIElmIGJvdGggdmFsdWVzIGFyZVxuICogaW50ZWdlcnMsIHZhbHVlcyBvdXRzaWRlIG9mIEphdmFTY3JpcHQncyBzYWZlIG51bWJlciByYW5nZVxuICogKGBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUmAgdG8gYE51bWJlci5NQVhfU0FGRV9JTlRFR0VSYCkgYXJlIGFsc28gc3ViamVjdCB0b1xuICogcHJlY2lzaW9uIGxvc3MuIEZ1cnRoZXJtb3JlLCBvbmNlIHByb2Nlc3NlZCBieSB0aGUgRmlyZXN0b3JlIGJhY2tlbmQsIGFsbFxuICogaW50ZWdlciBvcGVyYXRpb25zIGFyZSBjYXBwZWQgYmV0d2VlbiAtMl42MyBhbmQgMl42My0xLlxuICpcbiAqIElmIHRoZSBjdXJyZW50IGZpZWxkIHZhbHVlIGlzIG5vdCBvZiB0eXBlIGBudW1iZXJgLCBvciBpZiB0aGUgZmllbGQgZG9lcyBub3RcbiAqIHlldCBleGlzdCwgdGhlIHRyYW5zZm9ybWF0aW9uIHNldHMgdGhlIGZpZWxkIHRvIHRoZSBnaXZlbiB2YWx1ZS5cbiAqXG4gKiBAcGFyYW0gbiAtIFRoZSB2YWx1ZSB0byBpbmNyZW1lbnQgYnkuXG4gKiBAcmV0dXJucyBUaGUgYEZpZWxkVmFsdWVgIHNlbnRpbmVsIGZvciB1c2UgaW4gYSBjYWxsIHRvIGBzZXREb2MoKWAgb3JcbiAqIGB1cGRhdGVEb2MoKWBcbiAqLyBmdW5jdGlvbiBpbmNyZW1lbnQoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRGaWVsZFZhbHVlSW1wbChcImluY3JlbWVudFwiLCBlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGBWZWN0b3JWYWx1ZWAgY29uc3RydWN0ZWQgd2l0aCBhIGNvcHkgb2YgdGhlIGdpdmVuIGFycmF5IG9mIG51bWJlcnMuXG4gKlxuICogQHBhcmFtIHZhbHVlcyAtIENyZWF0ZSBhIGBWZWN0b3JWYWx1ZWAgaW5zdGFuY2Ugd2l0aCBhIGNvcHkgb2YgdGhpcyBhcnJheSBvZiBudW1iZXJzLlxuICpcbiAqIEByZXR1cm5zIEEgbmV3IGBWZWN0b3JWYWx1ZWAgY29uc3RydWN0ZWQgd2l0aCBhIGNvcHkgb2YgdGhlIGdpdmVuIGFycmF5IG9mIG51bWJlcnMuXG4gKi8gZnVuY3Rpb24gdmVjdG9yKGUpIHtcbiAgICByZXR1cm4gbmV3IFZlY3RvclZhbHVlKGUpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDcmVhdGVzIGEgd3JpdGUgYmF0Y2gsIHVzZWQgZm9yIHBlcmZvcm1pbmcgbXVsdGlwbGUgd3JpdGVzIGFzIGEgc2luZ2xlXG4gKiBhdG9taWMgb3BlcmF0aW9uLiBUaGUgbWF4aW11bSBudW1iZXIgb2Ygd3JpdGVzIGFsbG93ZWQgaW4gYSBzaW5nbGUge0BsaW5rIFdyaXRlQmF0Y2h9XG4gKiBpcyA1MDAuXG4gKlxuICogVW5saWtlIHRyYW5zYWN0aW9ucywgd3JpdGUgYmF0Y2hlcyBhcmUgcGVyc2lzdGVkIG9mZmxpbmUgYW5kIHRoZXJlZm9yZSBhcmVcbiAqIHByZWZlcmFibGUgd2hlbiB5b3UgZG9uJ3QgbmVlZCB0byBjb25kaXRpb24geW91ciB3cml0ZXMgb24gcmVhZCBkYXRhLlxuICpcbiAqIEByZXR1cm5zIEEge0BsaW5rIFdyaXRlQmF0Y2h9IHRoYXQgY2FuIGJlIHVzZWQgdG8gYXRvbWljYWxseSBleGVjdXRlIG11bHRpcGxlXG4gKiB3cml0ZXMuXG4gKi8gZnVuY3Rpb24gd3JpdGVCYXRjaChlKSB7XG4gICAgcmV0dXJuIGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpLCBuZXcgV3JpdGVCYXRjaChlLCAodCA9PiBleGVjdXRlV3JpdGUoZSwgdCkpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gZnVuY3Rpb24gc2V0SW5kZXhDb25maWd1cmF0aW9uKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSk7XG4gICAgaWYgKCFuLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyIHx8IFwibWVtb3J5XCIgPT09IG4uX3VuaW5pdGlhbGl6ZWRDb21wb25lbnRzUHJvdmlkZXIuX29mZmxpbmUua2luZCkgXG4gICAgLy8gUE9SVElORyBOT1RFOiBXZSBkb24ndCByZXR1cm4gYW4gZXJyb3IgaWYgdGhlIHVzZXIgaGFzIG5vdCBlbmFibGVkXG4gICAgLy8gcGVyc2lzdGVuY2Ugc2luY2UgYGVuYWJsZUluZGV4ZWRkYlBlcnNpc3RlbmNlKClgIGNhbiBmYWlsIG9uIHRoZSBXZWIuXG4gICAgcmV0dXJuIF9fUFJJVkFURV9sb2dXYXJuKFwiQ2Fubm90IGVuYWJsZSBpbmRleGVzIHdoZW4gcGVyc2lzdGVuY2UgaXMgZGlzYWJsZWRcIiksIFxuICAgIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIGNvbnN0IHIgPSBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VJbmRleGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfdHJ5UGFyc2VKc29uKGUpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgXCJGYWlsZWQgdG8gcGFyc2UgSlNPTjogXCIgKyAobnVsbCA9PSBlID8gdm9pZCAwIDogZS5tZXNzYWdlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oZSkgOiBlLCBuID0gW107XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHQuaW5kZXhlcykpIGZvciAoY29uc3QgZSBvZiB0LmluZGV4ZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdHJ5R2V0U3RyaW5nKGUsIFwiY29sbGVjdGlvbkdyb3VwXCIpLCByID0gW107XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlLmZpZWxkcykpIGZvciAoY29uc3QgdCBvZiBlLmZpZWxkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbURvdFNlcGFyYXRlZFN0cmluZyhcInNldEluZGV4Q29uZmlndXJhdGlvblwiLCBfX1BSSVZBVEVfdHJ5R2V0U3RyaW5nKHQsIFwiZmllbGRQYXRoXCIpKTtcbiAgICAgICAgICAgICAgICBcIkNPTlRBSU5TXCIgPT09IHQuYXJyYXlDb25maWcgPyByLnB1c2gobmV3IEluZGV4U2VnbWVudChlLCAyIC8qIEluZGV4S2luZC5DT05UQUlOUyAqLykpIDogXCJBU0NFTkRJTkdcIiA9PT0gdC5vcmRlciA/IHIucHVzaChuZXcgSW5kZXhTZWdtZW50KGUsIDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLykpIDogXCJERVNDRU5ESU5HXCIgPT09IHQub3JkZXIgJiYgci5wdXNoKG5ldyBJbmRleFNlZ21lbnQoZSwgMSAvKiBJbmRleEtpbmQuREVTQ0VORElORyAqLykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbi5wdXNoKG5ldyBGaWVsZEluZGV4KEZpZWxkSW5kZXguVU5LTk9XTl9JRCwgdCwgciwgSW5kZXhTdGF0ZS5lbXB0eSgpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfSh0KTtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFNldEluZGV4Q29uZmlndXJhdGlvbihuLCByKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RyeUdldFN0cmluZyhlLCB0KSB7XG4gICAgaWYgKFwic3RyaW5nXCIgIT0gdHlwZW9mIGVbdF0pIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihELklOVkFMSURfQVJHVU1FTlQsIFwiTWlzc2luZyBzdHJpbmcgdmFsdWUgZm9yOiBcIiArIHQpO1xuICAgIHJldHVybiBlW3RdO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBQZXJzaXN0ZW50Q2FjaGVJbmRleE1hbmFnZXJgIGZvciBjb25maWd1cmluZyBwZXJzaXN0ZW50IGNhY2hlIGluZGV4ZXMgdXNlZFxuICogZm9yIGxvY2FsIHF1ZXJ5IGV4ZWN1dGlvbi5cbiAqXG4gKiBUbyB1c2UsIGNhbGwgYGdldFBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlcigpYCB0byBnZXQgYW4gaW5zdGFuY2UuXG4gKi8gY2xhc3MgUGVyc2lzdGVudENhY2hlSW5kZXhNYW5hZ2VyIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgXG4gICAgICAgIC8qKiBBIHR5cGUgc3RyaW5nIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IGluc3RhbmNlcyBvZiB0aGlzIGNsYXNzLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcIlBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlclwiO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBQZXJzaXN0ZW50Q2FjaGUgSW5kZXggTWFuYWdlciB1c2VkIGJ5IHRoZSBnaXZlbiBgRmlyZXN0b3JlYFxuICogb2JqZWN0LlxuICpcbiAqIEByZXR1cm4gVGhlIGBQZXJzaXN0ZW50Q2FjaGVJbmRleE1hbmFnZXJgIGluc3RhbmNlLCBvciBgbnVsbGAgaWYgbG9jYWxcbiAqIHBlcnNpc3RlbnQgc3RvcmFnZSBpcyBub3QgaW4gdXNlLlxuICovIGZ1bmN0aW9uIGdldFBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlcihlKSB7XG4gICAgdmFyIHQ7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSk7XG4gICAgY29uc3QgbiA9IENlLmdldChlKTtcbiAgICBpZiAobikgcmV0dXJuIG47XG4gICAgaWYgKFwicGVyc2lzdGVudFwiICE9PSAobnVsbCA9PT0gKHQgPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUpLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0Ll9vZmZsaW5lLmtpbmQpKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCByID0gbmV3IFBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlcihlKTtcbiAgICByZXR1cm4gQ2Uuc2V0KGUsIHIpLCByO1xufVxuXG4vKipcbiAqIEVuYWJsZXMgdGhlIFNESyB0byBjcmVhdGUgcGVyc2lzdGVudCBjYWNoZSBpbmRleGVzIGF1dG9tYXRpY2FsbHkgZm9yIGxvY2FsXG4gKiBxdWVyeSBleGVjdXRpb24gd2hlbiB0aGUgU0RLIGJlbGlldmVzIGNhY2hlIGluZGV4ZXMgY2FuIGhlbHAgaW1wcm92ZVxuICogcGVyZm9ybWFuY2UuXG4gKlxuICogVGhpcyBmZWF0dXJlIGlzIGRpc2FibGVkIGJ5IGRlZmF1bHQuXG4gKi8gZnVuY3Rpb24gZW5hYmxlUGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb24oZSkge1xuICAgIF9fUFJJVkFURV9zZXRQZXJzaXN0ZW50Q2FjaGVJbmRleEF1dG9DcmVhdGlvbkVuYWJsZWQoZSwgITApO1xufVxuXG4vKipcbiAqIFN0b3BzIGNyZWF0aW5nIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXhlcyBhdXRvbWF0aWNhbGx5IGZvciBsb2NhbCBxdWVyeVxuICogZXhlY3V0aW9uLiBUaGUgaW5kZXhlcyB3aGljaCBoYXZlIGJlZW4gY3JlYXRlZCBieSBjYWxsaW5nXG4gKiBgZW5hYmxlUGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb24oKWAgc3RpbGwgdGFrZSBlZmZlY3QuXG4gKi8gZnVuY3Rpb24gZGlzYWJsZVBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uKGUpIHtcbiAgICBfX1BSSVZBVEVfc2V0UGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb25FbmFibGVkKGUsICExKTtcbn1cblxuLyoqXG4gKiBSZW1vdmVzIGFsbCBwZXJzaXN0ZW50IGNhY2hlIGluZGV4ZXMuXG4gKlxuICogUGxlYXNlIG5vdGUgdGhpcyBmdW5jdGlvbiB3aWxsIGFsc28gZGVsZXRlcyBpbmRleGVzIGdlbmVyYXRlZCBieVxuICogYHNldEluZGV4Q29uZmlndXJhdGlvbigpYCwgd2hpY2ggaXMgZGVwcmVjYXRlZC5cbiAqLyBmdW5jdGlvbiBkZWxldGVBbGxQZXJzaXN0ZW50Q2FjaGVJbmRleGVzKGUpIHtcbiAgICBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50RGVsZXRlQWxsRmllbGRJbmRleGVzKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZS5fZmlyZXN0b3JlKSkudGhlbigoZSA9PiBfX1BSSVZBVEVfbG9nRGVidWcoXCJkZWxldGluZyBhbGwgcGVyc2lzdGVudCBjYWNoZSBpbmRleGVzIHN1Y2NlZWRlZFwiKSkpLmNhdGNoKChlID0+IF9fUFJJVkFURV9sb2dXYXJuKFwiZGVsZXRpbmcgYWxsIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXhlcyBmYWlsZWRcIiwgZSkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3NldFBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uRW5hYmxlZChlLCB0KSB7XG4gICAgX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFNldFBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uRW5hYmxlZChlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUuX2ZpcmVzdG9yZSksIHQpLnRoZW4oKGUgPT4gX19QUklWQVRFX2xvZ0RlYnVnKGBzZXR0aW5nIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXggYXV0byBjcmVhdGlvbiBpc0VuYWJsZWQ9JHt0fSBzdWNjZWVkZWRgKSkpLmNhdGNoKChlID0+IF9fUFJJVkFURV9sb2dXYXJuKGBzZXR0aW5nIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXggYXV0byBjcmVhdGlvbiBpc0VuYWJsZWQ9JHt0fSBmYWlsZWRgLCBlKSkpO1xufVxuXG4vKipcbiAqIE1hcHMgYEZpcmVzdG9yZWAgaW5zdGFuY2VzIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmdcbiAqIGBQZXJzaXN0ZW50Q2FjaGVJbmRleE1hbmFnZXJgIGluc3RhbmNlcy5cbiAqXG4gKiBVc2UgYSBgV2Vha01hcGAgc28gdGhhdCB0aGUgbWFwcGluZyB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZHJvcHBlZCB3aGVuIHRoZVxuICogYEZpcmVzdG9yZWAgaW5zdGFuY2UgaXMgZ2FyYmFnZSBjb2xsZWN0ZWQuIFRoaXMgZW11bGF0ZXMgYSBwcml2YXRlIG1lbWJlclxuICogYXMgZGVzY3JpYmVkIGluIGh0dHBzOi8vZ29vLmdsZS80NTR5dnVnLlxuICovIGNvbnN0IENlID0gbmV3IFdlYWtNYXA7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBpbnRlcm5hbFxuICogQHByaXZhdGVcbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAqXG4gKiBSZXR1cm5zIHRoZSBgUXVlcnlUYXJnZXRgIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBxdWVyeS4gUmV0dXJucyBgbnVsbGBcbiAqIGlmIHRoZSBGaXJlc3RvcmUgY2xpZW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgZ2l2ZW4gcXVlcnkgaGFzIG5vdCBiZWVuXG4gKiBpbml0aWFsaXplZCBvciBoYXMgYmVlbiB0ZXJtaW5hdGVkLlxuICpcbiAqIEBwYXJhbSBxdWVyeSAtIFRoZSBRdWVyeSB0byBjb252ZXJ0IHRvIHByb3RvIHJlcHJlc2VudGF0aW9uLlxuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuZnVuY3Rpb24gX2ludGVybmFsUXVlcnlUb1Byb3RvUXVlcnlUYXJnZXQoZSkge1xuICAgIHZhciB0O1xuICAgIGNvbnN0IG4gPSBudWxsID09PSAodCA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSkpLl9vbmxpbmVDb21wb25lbnRzKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0LmRhdGFzdG9yZS5zZXJpYWxpemVyO1xuICAgIHJldHVybiB2b2lkIDAgPT09IG4gPyBudWxsIDogX19QUklWQVRFX3RvUXVlcnlUYXJnZXQobiwgX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoZS5fcXVlcnkpKS5fdDtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqIEBwcml2YXRlXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gKlxuICogUmV0dXJucyBgUnVuQWdncmVnYXRpb25RdWVyeVJlcXVlc3RgIHdoaWNoIGNvbnRhaW5zIHRoZSBwcm90byByZXByZXNlbnRhdGlvblxuICogb2YgdGhlIGdpdmVuIGFnZ3JlZ2F0aW9uIHF1ZXJ5IHJlcXVlc3QuIFJldHVybnMgbnVsbCBpZiB0aGUgRmlyZXN0b3JlIGNsaWVudFxuICogYXNzb2NpYXRlZCB3aXRoIHRoZSBnaXZlbiBxdWVyeSBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQgb3IgaGFzIGJlZW5cbiAqIHRlcm1pbmF0ZWQuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IC0gVGhlIFF1ZXJ5IHRvIGNvbnZlcnQgdG8gcHJvdG8gcmVwcmVzZW50YXRpb24uXG4gKiBAcGFyYW0gYWdncmVnYXRlU3BlYyAtIFRoZSBzZXQgb2YgYWdncmVnYXRpb25zIGFuZCB0aGVpciBhbGlhc2VzLlxuICovIGZ1bmN0aW9uIF9pbnRlcm5hbEFnZ3JlZ2F0aW9uUXVlcnlUb1Byb3RvUnVuQWdncmVnYXRpb25RdWVyeVJlcXVlc3QoZSwgdCkge1xuICAgIHZhciBuO1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbWFwVG9BcnJheSh0LCAoKGUsIHQpID0+IG5ldyBfX1BSSVZBVEVfQWdncmVnYXRlSW1wbCh0LCBlLmFnZ3JlZ2F0ZVR5cGUsIGUuX2ludGVybmFsRmllbGRQYXRoKSkpLCBpID0gbnVsbCA9PT0gKG4gPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpKS5fb25saW5lQ29tcG9uZW50cykgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5kYXRhc3RvcmUuc2VyaWFsaXplcjtcbiAgICByZXR1cm4gdm9pZCAwID09PSBpID8gbnVsbCA6IF9fUFJJVkFURV90b1J1bkFnZ3JlZ2F0aW9uUXVlcnlSZXF1ZXN0KGksIF9fUFJJVkFURV9xdWVyeVRvQWdncmVnYXRlVGFyZ2V0KGUuX3F1ZXJ5KSwgciwgXG4gICAgLyogc2tpcEFsaWFzaW5nPSAqLyAhMCkucmVxdWVzdDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGVzdGluZyBob29rcyBmb3IgdXNlIGJ5IEZpcmVzdG9yZSdzIGludGVncmF0aW9uIHRlc3Qgc3VpdGUgdG8gcmVhY2ggaW50byB0aGVcbiAqIFNESyBpbnRlcm5hbHMgdG8gdmFsaWRhdGUgbG9naWMgYW5kIGJlaGF2aW9yIHRoYXQgaXMgbm90IHZpc2libGUgZnJvbSB0aGVcbiAqIHB1YmxpYyBBUEkgc3VyZmFjZS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBUZXN0aW5nSG9va3Mge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBzaG91bGQgbm90IGJlIGNyZWF0ZWRcIik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlZ2lzdGVycyBhIGNhbGxiYWNrIHRvIGJlIG5vdGlmaWVkIHdoZW4gYW4gZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaFxuICAgICAqIG9jY3VycyBpbiB0aGUgV2F0Y2ggbGlzdGVuIHN0cmVhbS5cbiAgICAgKlxuICAgICAqIFRoZSByZWxhdGl2ZSBvcmRlciBpbiB3aGljaCBjYWxsYmFja3MgYXJlIG5vdGlmaWVkIGlzIHVuc3BlY2lmaWVkOyBkbyBub3RcbiAgICAgKiByZWx5IG9uIGFueSBwYXJ0aWN1bGFyIG9yZGVyaW5nLiBJZiBhIGdpdmVuIGNhbGxiYWNrIGlzIHJlZ2lzdGVyZWQgbXVsdGlwbGVcbiAgICAgKiB0aW1lcyB0aGVuIGl0IHdpbGwgYmUgbm90aWZpZWQgbXVsdGlwbGUgdGltZXMsIG9uY2UgcGVyIHJlZ2lzdHJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjYWxsYmFjayB0aGUgY2FsbGJhY2sgdG8gaW52b2tlIHVwb24gZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSBmdW5jdGlvbiB0aGF0LCB3aGVuIGNhbGxlZCwgdW5yZWdpc3RlcnMgdGhlIGdpdmVuIGNhbGxiYWNrOyBvbmx5XG4gICAgICogdGhlIGZpcnN0IGludm9jYXRpb24gb2YgdGhlIHJldHVybmVkIGZ1bmN0aW9uIGRvZXMgYW55dGhpbmc7IGFsbCBzdWJzZXF1ZW50XG4gICAgICogaW52b2NhdGlvbnMgZG8gbm90aGluZy5cbiAgICAgKi8gICAgc3RhdGljIG9uRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2goZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX1Rlc3RpbmdIb29rc1NwaUltcGwuaW5zdGFuY2Uub25FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaChlKTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGltcGxlbWVudGF0aW9uIG9mIGBUZXN0aW5nSG9va3NTcGlgLlxuICovIGNsYXNzIF9fUFJJVkFURV9UZXN0aW5nSG9va3NTcGlJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5VdSA9IG5ldyBNYXA7XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgaW5zdGFuY2UoKSB7XG4gICAgICAgIHJldHVybiBGZSB8fCAoRmUgPSBuZXcgX19QUklWQVRFX1Rlc3RpbmdIb29rc1NwaUltcGwsIGZ1bmN0aW9uIF9fUFJJVkFURV9zZXRUZXN0aW5nSG9va3NTcGkoZSkge1xuICAgICAgICAgICAgaWYgKFBlKSB0aHJvdyBuZXcgRXJyb3IoXCJhIFRlc3RpbmdIb29rc1NwaSBpbnN0YW5jZSBpcyBhbHJlYWR5IHNldFwiKTtcbiAgICAgICAgICAgIFBlID0gZTtcbiAgICAgICAgfShGZSkpLCBGZTtcbiAgICB9XG4gICAgZXQoZSkge1xuICAgICAgICB0aGlzLlV1LmZvckVhY2goKHQgPT4gdChlKSkpO1xuICAgIH1cbiAgICBvbkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFN5bWJvbCgpLCBuID0gdGhpcy5VdTtcbiAgICAgICAgcmV0dXJuIG4uc2V0KHQsIGUpLCAoKSA9PiBuLmRlbGV0ZSh0KTtcbiAgICB9XG59XG5cbmxldCBGZSA9IG51bGw7XG5cbi8qKlxuICogQ2xvdWQgRmlyZXN0b3JlXG4gKlxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXG4gKi8gIWZ1bmN0aW9uIF9fUFJJVkFURV9yZWdpc3RlckZpcmVzdG9yZShlLCB0ID0gITApIHtcbiAgICAhZnVuY3Rpb24gX19QUklWQVRFX3NldFNES1ZlcnNpb24oZSkge1xuICAgICAgICBTID0gZTtcbiAgICB9KFNES19WRVJTSU9OKSwgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoXCJmaXJlc3RvcmVcIiwgKChlLCB7aW5zdGFuY2VJZGVudGlmaWVyOiBuLCBvcHRpb25zOiByfSkgPT4ge1xuICAgICAgICBjb25zdCBpID0gZS5nZXRQcm92aWRlcihcImFwcFwiKS5nZXRJbW1lZGlhdGUoKSwgcyA9IG5ldyBGaXJlc3RvcmUobmV3IF9fUFJJVkFURV9GaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyKGUuZ2V0UHJvdmlkZXIoXCJhdXRoLWludGVybmFsXCIpKSwgbmV3IF9fUFJJVkFURV9GaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlcihlLmdldFByb3ZpZGVyKFwiYXBwLWNoZWNrLWludGVybmFsXCIpKSwgZnVuY3Rpb24gX19QUklWQVRFX2RhdGFiYXNlSWRGcm9tQXBwKGUsIHQpIHtcbiAgICAgICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5hcHBseShlLm9wdGlvbnMsIFsgXCJwcm9qZWN0SWRcIiBdKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEQuSU5WQUxJRF9BUkdVTUVOVCwgJ1wicHJvamVjdElkXCIgbm90IHByb3ZpZGVkIGluIGZpcmViYXNlLmluaXRpYWxpemVBcHAuJyk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGFiYXNlSWQoZS5vcHRpb25zLnByb2plY3RJZCwgdCk7XG4gICAgICAgIH0oaSwgbiksIGkpO1xuICAgICAgICByZXR1cm4gciA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgdXNlRmV0Y2hTdHJlYW1zOiB0XG4gICAgICAgIH0sIHIpLCBzLl9zZXRTZXR0aW5ncyhyKSwgcztcbiAgICB9KSwgXCJQVUJMSUNcIikuc2V0TXVsdGlwbGVJbnN0YW5jZXMoITApKSwgcmVnaXN0ZXJWZXJzaW9uKHcsIFwiNC43LjNcIiwgZSksIFxuICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uXG4gICAgcmVnaXN0ZXJWZXJzaW9uKHcsIFwiNC43LjNcIiwgXCJlc20yMDE3XCIpO1xufSgpO1xuXG5leHBvcnQgeyBBYnN0cmFjdFVzZXJEYXRhV3JpdGVyLCBBZ2dyZWdhdGVGaWVsZCwgQWdncmVnYXRlUXVlcnlTbmFwc2hvdCwgQnl0ZXMsIFNlIGFzIENBQ0hFX1NJWkVfVU5MSU1JVEVELCBDb2xsZWN0aW9uUmVmZXJlbmNlLCBEb2N1bWVudFJlZmVyZW5jZSwgRG9jdW1lbnRTbmFwc2hvdCwgRmllbGRQYXRoLCBGaWVsZFZhbHVlLCBGaXJlc3RvcmUsIEZpcmVzdG9yZUVycm9yLCBHZW9Qb2ludCwgTG9hZEJ1bmRsZVRhc2ssIFBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlciwgUXVlcnksIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludCwgUXVlcnlDb25zdHJhaW50LCBRdWVyeURvY3VtZW50U25hcHNob3QsIFF1ZXJ5RW5kQXRDb25zdHJhaW50LCBRdWVyeUZpZWxkRmlsdGVyQ29uc3RyYWludCwgUXVlcnlMaW1pdENvbnN0cmFpbnQsIFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnQsIFF1ZXJ5U25hcHNob3QsIFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnQsIFNuYXBzaG90TWV0YWRhdGEsIFRpbWVzdGFtcCwgVHJhbnNhY3Rpb24sIFZlY3RvclZhbHVlLCBXcml0ZUJhdGNoLCBfX1BSSVZBVEVfQXV0b0lkIGFzIF9BdXRvSWQsIEJ5dGVTdHJpbmcgYXMgX0J5dGVTdHJpbmcsIERhdGFiYXNlSWQgYXMgX0RhdGFiYXNlSWQsIERvY3VtZW50S2V5IGFzIF9Eb2N1bWVudEtleSwgX19QUklWQVRFX0VtcHR5QXBwQ2hlY2tUb2tlblByb3ZpZGVyIGFzIF9FbXB0eUFwcENoZWNrVG9rZW5Qcm92aWRlciwgX19QUklWQVRFX0VtcHR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXIgYXMgX0VtcHR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXIsIEZpZWxkUGF0aCQxIGFzIF9GaWVsZFBhdGgsIFRlc3RpbmdIb29rcyBhcyBfVGVzdGluZ0hvb2tzLCBfX1BSSVZBVEVfY2FzdCBhcyBfY2FzdCwgX19QUklWQVRFX2RlYnVnQXNzZXJ0IGFzIF9kZWJ1Z0Fzc2VydCwgX2ludGVybmFsQWdncmVnYXRpb25RdWVyeVRvUHJvdG9SdW5BZ2dyZWdhdGlvblF1ZXJ5UmVxdWVzdCwgX2ludGVybmFsUXVlcnlUb1Byb3RvUXVlcnlUYXJnZXQsIF9fUFJJVkFURV9pc0Jhc2U2NEF2YWlsYWJsZSBhcyBfaXNCYXNlNjRBdmFpbGFibGUsIF9fUFJJVkFURV9sb2dXYXJuIGFzIF9sb2dXYXJuLCBfX1BSSVZBVEVfdmFsaWRhdGVJc05vdFVzZWRUb2dldGhlciBhcyBfdmFsaWRhdGVJc05vdFVzZWRUb2dldGhlciwgYWRkRG9jLCBhZ2dyZWdhdGVGaWVsZEVxdWFsLCBhZ2dyZWdhdGVRdWVyeVNuYXBzaG90RXF1YWwsIGFuZCwgYXJyYXlSZW1vdmUsIGFycmF5VW5pb24sIGF2ZXJhZ2UsIGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2UsIGNvbGxlY3Rpb24sIGNvbGxlY3Rpb25Hcm91cCwgY29ubmVjdEZpcmVzdG9yZUVtdWxhdG9yLCBjb3VudCwgZGVsZXRlQWxsUGVyc2lzdGVudENhY2hlSW5kZXhlcywgZGVsZXRlRG9jLCBkZWxldGVGaWVsZCwgZGlzYWJsZU5ldHdvcmssIGRpc2FibGVQZXJzaXN0ZW50Q2FjaGVJbmRleEF1dG9DcmVhdGlvbiwgZG9jLCBkb2N1bWVudElkLCBlbmFibGVJbmRleGVkRGJQZXJzaXN0ZW5jZSwgZW5hYmxlTXVsdGlUYWJJbmRleGVkRGJQZXJzaXN0ZW5jZSwgZW5hYmxlTmV0d29yaywgZW5hYmxlUGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb24sIGVuZEF0LCBlbmRCZWZvcmUsIGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQsIGV4ZWN1dGVXcml0ZSwgZ2V0QWdncmVnYXRlRnJvbVNlcnZlciwgZ2V0Q291bnRGcm9tU2VydmVyLCBnZXREb2MsIGdldERvY0Zyb21DYWNoZSwgZ2V0RG9jRnJvbVNlcnZlciwgZ2V0RG9jcywgZ2V0RG9jc0Zyb21DYWNoZSwgZ2V0RG9jc0Zyb21TZXJ2ZXIsIGdldEZpcmVzdG9yZSwgZ2V0UGVyc2lzdGVudENhY2hlSW5kZXhNYW5hZ2VyLCBpbmNyZW1lbnQsIGluaXRpYWxpemVGaXJlc3RvcmUsIGxpbWl0LCBsaW1pdFRvTGFzdCwgbG9hZEJ1bmRsZSwgbWVtb3J5RWFnZXJHYXJiYWdlQ29sbGVjdG9yLCBtZW1vcnlMb2NhbENhY2hlLCBtZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9yLCBuYW1lZFF1ZXJ5LCBvblNuYXBzaG90LCBvblNuYXBzaG90c0luU3luYywgb3IsIG9yZGVyQnksIHBlcnNpc3RlbnRMb2NhbENhY2hlLCBwZXJzaXN0ZW50TXVsdGlwbGVUYWJNYW5hZ2VyLCBwZXJzaXN0ZW50U2luZ2xlVGFiTWFuYWdlciwgcXVlcnksIHF1ZXJ5RXF1YWwsIHJlZkVxdWFsLCBydW5UcmFuc2FjdGlvbiwgc2VydmVyVGltZXN0YW1wLCBzZXREb2MsIHNldEluZGV4Q29uZmlndXJhdGlvbiwgc2V0TG9nTGV2ZWwsIHNuYXBzaG90RXF1YWwsIHN0YXJ0QWZ0ZXIsIHN0YXJ0QXQsIHN1bSwgdGVybWluYXRlLCB1cGRhdGVEb2MsIHZlY3Rvciwgd2FpdEZvclBlbmRpbmdXcml0ZXMsIHdoZXJlLCB3cml0ZUJhdGNoIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgaW5pdGlhbGl6ZUFwcCB9IGZyb20gJ2ZpcmViYXNlL2FwcCc7XHJcbmltcG9ydCB7IGdldEF1dGggfSBmcm9tICdmaXJlYmFzZS9hdXRoJztcclxuaW1wb3J0IHsgZ2V0RmlyZXN0b3JlIH0gZnJvbSAnZmlyZWJhc2UvZmlyZXN0b3JlJztcclxuXHJcbmNvbnN0IGZpcmViYXNlQ29uZmlnID0ge1xyXG4gICAgYXBpS2V5OiBcIkFJemFTeUFLa2VXT25JRjNGS0RzdlFWNE9TQy13bEtVU0thNmRDNFwiLFxyXG4gICAgYXV0aERvbWFpbjogXCJmYi1hZHMtYW5hbHl6ZXIuZmlyZWJhc2VhcHAuY29tXCIsXHJcbiAgICBwcm9qZWN0SWQ6IFwiZmItYWRzLWFuYWx5emVyXCIsXHJcbiAgICBzdG9yYWdlQnVja2V0OiBcImZiLWFkcy1hbmFseXplci5maXJlYmFzZXN0b3JhZ2UuYXBwXCIsXHJcbiAgICBtZXNzYWdpbmdTZW5kZXJJZDogXCI5ODc3MzAyNTAxNjBcIixcclxuICAgIGFwcElkOiBcIjE6OTg3NzMwMjUwMTYwOndlYjo0N2QzYjk5YThiOTc2MTJjMThhZTc1XCIsXHJcbiAgICBtZWFzdXJlbWVudElkOiBcIkctWldKS1ZXMFc1WFwiXHJcbn07XHJcblxyXG5jb25zdCBhcHAgPSBpbml0aWFsaXplQXBwKGZpcmViYXNlQ29uZmlnKTtcclxuZXhwb3J0IGNvbnN0IGF1dGggPSBnZXRBdXRoKGFwcCk7XHJcbmV4cG9ydCBjb25zdCBkYiA9IGdldEZpcmVzdG9yZShhcHApO1xyXG4iLCJpbXBvcnQgeyBhdXRoIH0gZnJvbSAnLi9maXJlYmFzZUNvbmZpZy5qcyc7XHJcbmltcG9ydCB7XHJcbiAgICBzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZCxcclxuICAgIGNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZCxcclxuICAgIHNpZ25PdXQsXHJcbiAgICBvbkF1dGhTdGF0ZUNoYW5nZWRcclxufSBmcm9tICdmaXJlYmFzZS9hdXRoJztcclxuXHJcbmNvbnNvbGUubG9nKCdbUG9wdXBdIExvYWRlZCcpO1xyXG5cclxuLy8gRE9NIEVsZW1lbnRzXHJcbmNvbnN0IGF1dGhTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dGhTZWN0aW9uJyk7XHJcbmNvbnN0IGxvZ2luRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbkZvcm0nKTtcclxuY29uc3QgdXNlclByb2ZpbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlclByb2ZpbGUnKTtcclxuY29uc3QgdXNlckVtYWlsU3BhbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyRW1haWwnKTtcclxuY29uc3QgZW1haWxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbWFpbElucHV0Jyk7XHJcbmNvbnN0IHBhc3N3b3JkSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmRJbnB1dCcpO1xyXG5jb25zdCBhdXRoRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0aEVycm9yJyk7XHJcbmNvbnN0IG1haW5Db250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5Db250ZW50Jyk7XHJcblxyXG4vLyBBdXRoIFN0YXRlIExpc3RlbmVyXHJcbm9uQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCAodXNlcikgPT4ge1xyXG4gICAgaWYgKHVzZXIpIHtcclxuICAgICAgICAvLyBVc2VyIGlzIHNpZ25lZCBpblxyXG4gICAgICAgIHNob3dNYWluQ29udGVudCh1c2VyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gTm8gdXNlciBpcyBzaWduZWQgaW5cclxuICAgICAgICBzaG93QXV0aEZvcm0oKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5mdW5jdGlvbiBzaG93TWFpbkNvbnRlbnQodXNlcikge1xyXG4gICAgbG9naW5Gb3JtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICB1c2VyUHJvZmlsZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgIHVzZXJFbWFpbFNwYW4udGV4dENvbnRlbnQgPSB1c2VyLmVtYWlsO1xyXG4gICAgbWFpbkNvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dBdXRoRm9ybSgpIHtcclxuICAgIGxvZ2luRm9ybS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgIHVzZXJQcm9maWxlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICBtYWluQ29udGVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgZW1haWxJbnB1dC52YWx1ZSA9ICcnO1xyXG4gICAgcGFzc3dvcmRJbnB1dC52YWx1ZSA9ICcnO1xyXG4gICAgYXV0aEVycm9yLnRleHRDb250ZW50ID0gJyc7XHJcbn1cclxuXHJcbi8vIEV2ZW50IExpc3RlbmVyc1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xyXG4gICAgc2V0dXBFdmVudExpc3RlbmVycygpO1xyXG4gICAgc2V0dXBBdXRoTGlzdGVuZXJzKCk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gc2V0dXBBdXRoTGlzdGVuZXJzKCkge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luQnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVtYWlsID0gZW1haWxJbnB1dC52YWx1ZTtcclxuICAgICAgICBjb25zdCBwYXNzd29yZCA9IHBhc3N3b3JkSW5wdXQudmFsdWU7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBhdXRoRXJyb3IudGV4dENvbnRlbnQgPSBlcnJvci5tZXNzYWdlO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWdudXBCdG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW1haWwgPSBlbWFpbElucHV0LnZhbHVlO1xyXG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gcGFzc3dvcmRJbnB1dC52YWx1ZTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCBjcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBhdXRoRXJyb3IudGV4dENvbnRlbnQgPSBlcnJvci5tZXNzYWdlO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dvdXRCdG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgc2lnbk91dChhdXRoKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdMb2dvdXQgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0dXBFdmVudExpc3RlbmVycygpIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydEJ0bicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHN0YXJ0QW5hbHlzaXMpO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlb3BlbkJ0bicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlb3BlbkFuYWx5c2lzKTtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbXBvcnRCdG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpLmNsaWNrKCk7XHJcbiAgICB9KTtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlSW5wdXQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgaW1wb3J0RGF0YSk7XHJcbn1cclxuXHJcbi8vIC4uLiBSZXVzZWQgZnVuY3Rpb25zIGZyb20gb3JpZ2luYWwgcG9wdXAuanMgLi4uXHJcbi8vIENvcHlpbmcgb3JpZ2luYWwgbG9naWMgaGVyZSBidXQgYWRhcHRpbmcgdG8gbm90IHJ1biBpbW1lZGlhdGVseSBvbiBsb2FkIHNpbmNlIHdlIHdyYXAgaW4gRE9NQ29udGVudExvYWRlZFxyXG5cclxuYXN5bmMgZnVuY3Rpb24gY2hlY2tJZk9uRmFjZWJvb2soKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IFt0YWJdID0gYXdhaXQgY2hyb21lLnRhYnMucXVlcnkoeyBhY3RpdmU6IHRydWUsIGN1cnJlbnRXaW5kb3c6IHRydWUgfSk7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnRCdG4nKTtcclxuXHJcbiAgICAgICAgaWYgKHRhYj8udXJsPy5pbmNsdWRlcygnZmFjZWJvb2suY29tL2Fkcy9saWJyYXJ5JykpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQb3B1cF0gT24gRmFjZWJvb2sgQWRzIExpYnJhcnkgcGFnZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbUG9wdXBdIE5vdCBvbiBBZHMgTGlicmFyeScpO1xyXG4gICAgICAgICAgICBpZiAoc3RhcnRCdG4pIHtcclxuICAgICAgICAgICAgICAgIHN0YXJ0QnRuLnRleHRDb250ZW50ID0gJ/CflJcgR28gdG8gQWRzIExpYnJhcnknO1xyXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHByaW1hcnkgY2xhc3MgdG8gaW5kaWNhdGUgbmF2aWdhdGlvbj8gVXNlciBkaWRuJ3QgcmVxdWVzdCBzdHlsZSBjaGFuZ2UsIGJ1dCB0ZXh0IGNoYW5nZS5cclxuICAgICAgICAgICAgICAgIC8vIEtlZXBpbmcgYnRuLXByaW1hcnkgaXMgZmluZSBhcyBpdCdzIHRoZSBwcmltYXJ5IGFjdGlvbi5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignW1BvcHVwXSBFcnJvciBjaGVja2luZyB0YWI6JywgZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBjaGVja0ZvckV4aXN0aW5nQW5hbHlzaXMoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IFt0YWJdID0gYXdhaXQgY2hyb21lLnRhYnMucXVlcnkoeyBhY3RpdmU6IHRydWUsIGN1cnJlbnRXaW5kb3c6IHRydWUgfSk7XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIG92ZXJsYXkgYWxyZWFkeSBleGlzdHMgd2l0aCBkYXRhXHJcbiAgICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCB7IGFjdGlvbjogJ2NoZWNrRXhpc3RpbmcnIH0sIChyZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1BvcHVwXSBObyBleGlzdGluZyBhbmFseXNpcyBmb3VuZCcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuaGFzT3ZlcmxheSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQb3B1cF0gRm91bmQgZXhpc3RpbmcgYW5hbHlzaXMnKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlb3BlbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW9wZW5CdG4nKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rlc2NyaXB0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydEJ0bicpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlb3BlbkJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gJ0xhc3QgYW5hbHlzaXMgYXZhaWxhYmxlISBSZW9wZW4gb3Igc3RhcnQgZnJlc2guJztcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBNYWtlIFN0YXJ0IEFuYWx5c2lzIGJ1dHRvbiBzZWNvbmRhcnkgc3R5bGUgd2hlbiByZW9wZW4gaXMgYXZhaWxhYmxlXHJcbiAgICAgICAgICAgICAgICBzdGFydEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdidG4tcHJpbWFyeScpO1xyXG4gICAgICAgICAgICAgICAgc3RhcnRCdG4uY2xhc3NMaXN0LmFkZCgnYnRuLXNlY29uZGFyeScpO1xyXG4gICAgICAgICAgICAgICAgc3RhcnRCdG4uaW5uZXJIVE1MID0gJ/CflIQgU3RhcnQgTmV3IEFuYWx5c2lzJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbUG9wdXBdIEVycm9yIGNoZWNraW5nIGZvciBleGlzdGluZyBhbmFseXNpczonLCBlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHJlb3BlbkFuYWx5c2lzKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBbdGFiXSA9IGF3YWl0IGNocm9tZS50YWJzLnF1ZXJ5KHsgYWN0aXZlOiB0cnVlLCBjdXJyZW50V2luZG93OiB0cnVlIH0pO1xyXG5cclxuICAgICAgICBzaG93U3RhdHVzKCfinIUgUmVvcGVuaW5nIGFuYWx5c2lzLi4uJywgJ3N1Y2Nlc3MnKTtcclxuXHJcbiAgICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCB7IGFjdGlvbjogJ3Jlb3Blbk92ZXJsYXknIH0sIChyZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbUG9wdXBdIEVycm9yOicsIGNocm9tZS5ydW50aW1lLmxhc3RFcnJvcik7XHJcbiAgICAgICAgICAgICAgICBzaG93U3RhdHVzKCfinYwgRXJyb3I6IENvdWxkIG5vdCByZW9wZW4nLCAnZXJyb3InKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW1BvcHVwXSBPdmVybGF5IHJlb3BlbmVkOicsIHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0sIDUwMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbUG9wdXBdIEVycm9yIHJlb3BlbmluZyBhbmFseXNpczonLCBlcnJvcik7XHJcbiAgICAgICAgc2hvd1N0YXR1cygn4p2MIEVycm9yOiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0QW5hbHlzaXMoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IFt0YWJdID0gYXdhaXQgY2hyb21lLnRhYnMucXVlcnkoeyBhY3RpdmU6IHRydWUsIGN1cnJlbnRXaW5kb3c6IHRydWUgfSk7XHJcblxyXG4gICAgICAgIGlmICghdGFiPy51cmw/LmluY2x1ZGVzKCdmYWNlYm9vay5jb20vYWRzL2xpYnJhcnknKSkge1xyXG4gICAgICAgICAgICAvLyBOb3Qgb24gQWRzIExpYnJhcnksIHJlZGlyZWN0XHJcbiAgICAgICAgICAgIGNocm9tZS50YWJzLmNyZWF0ZSh7IHVybDogJ2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9hZHMvbGlicmFyeScgfSk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5jbG9zZSgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzaG93U3RhdHVzKCfinIUgQW5hbHlzaXMgc3RhcnRlZCEgQ2hlY2sgdGhlIEZhY2Vib29rIHBhZ2UuLi4nLCAnc3VjY2VzcycpO1xyXG5cclxuICAgICAgICAvLyBGZXRjaCBBSSBzZXR0aW5ncyBmcm9tIEZpcmVzdG9yZVxyXG4gICAgICAgIGNvbnN0IGFpQ29uZmlnID0gYXdhaXQgZmV0Y2hBSUNvbmZpZygpO1xyXG5cclxuICAgICAgICAvLyBTZW5kIG1lc3NhZ2UgdG8gY29udGVudCBzY3JpcHQgdG8gc3RhcnQgc2NyYXBpbmcgYW5kIHNob3cgdmlzdWFsaXplclxyXG4gICAgICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYi5pZCwge1xyXG4gICAgICAgICAgICBhY3Rpb246ICdzdGFydFNjcmFwaW5nJyxcclxuICAgICAgICAgICAgYWlDb25maWc6IGFpQ29uZmlnXHJcbiAgICAgICAgfSwgKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tQb3B1cF0gRXJyb3I6JywgY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKTtcclxuICAgICAgICAgICAgICAgIHNob3dTdGF0dXMoJ+KdjCBFcnJvcjogUmVmcmVzaCB0aGUgRmFjZWJvb2sgcGFnZSBhbmQgdHJ5IGFnYWluJywgJ2Vycm9yJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tQb3B1cF0gU2NyYXBpbmcgc3RhcnRlZDonLCByZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDbG9zZSBwb3B1cCBhZnRlciBhIGRlbGF5XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0sIDE1MDApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignW1BvcHVwXSBFcnJvciBzdGFydGluZyBhbmFseXNpczonLCBlcnJvcik7XHJcbiAgICAgICAgc2hvd1N0YXR1cygn4p2MIEVycm9yOiAnICsgZXJyb3IubWVzc2FnZSwgJ2Vycm9yJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGltcG9ydERhdGEoZXZlbnQpIHtcclxuICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07XHJcbiAgICBpZiAoIWZpbGUpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgcmVhZGVyLm9ubG9hZCA9IGFzeW5jIChlKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2UoZS50YXJnZXQucmVzdWx0KTtcclxuICAgICAgICAgICAgLy8gVmFsaWRhdGUgc3RydWN0dXJlXHJcbiAgICAgICAgICAgIGlmICghanNvbi5jYW1wYWlnbnMpIHtcclxuICAgICAgICAgICAgICAgIHNob3dTdGF0dXMoJ+KdjCBJbnZhbGlkIGZpbGUgZm9ybWF0IChtaXNzaW5nIGNhbXBhaWducyknLCAnZXJyb3InKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFqc29uLmNhbXBhaWducykge1xyXG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cygn4p2MIEludmFsaWQgZmlsZSBmb3JtYXQgKG1pc3NpbmcgY2FtcGFpZ25zKScsICdlcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBhaUNvbmZpZyA9IGF3YWl0IGZldGNoQUlDb25maWcoKTtcclxuICAgICAgICAgICAgY29uc3QgW3RhYl0gPSBhd2FpdCBjaHJvbWUudGFicy5xdWVyeSh7IGFjdGl2ZTogdHJ1ZSwgY3VycmVudFdpbmRvdzogdHJ1ZSB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGFyZSBvbiBhIHZhbGlkIHBhZ2UgKHRlY2huaWNhbGx5IGltcG9ydCBjYW4gd29yayBhbnl3aGVyZSBpZiB3ZSBpbmplY3QsIFxyXG4gICAgICAgICAgICAvLyBidXQgZWZmZWN0aXZlbHkgd2UgdXN1YWxseSBqdXN0IHdhbnQgaXQgb24gRkIgb3IgYW55IHBhZ2Ugd2hlcmUgd2UgaW5qZWN0IHRoZSB2aXN1YWxpemVyKVxyXG4gICAgICAgICAgICAvLyBGb3Igbm93LCBsZXQncyBhc3N1bWUgd2UgYWxsb3cgaXQgYW55d2hlcmUgb3Igc3RyaWN0IHRvIEZCLlxyXG4gICAgICAgICAgICAvLyBVc2VyIHNhaWQgXCJ3b3JrcyBmcm9tIHRoZSBtb2RhbFwiIGltcGx5aW5nIHRoZXkgYXJlIG9uIHRoZSBwYWdlLlxyXG5cclxuICAgICAgICAgICAgaWYgKCF0YWIpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIC8vIEVuc3VyZSB2aXN1YWxpemVyIGlzIGluamVjdGVkIGZpcnN0P1xyXG4gICAgICAgICAgICAvLyBTZW5kaW5nIG1lc3NhZ2UgJ2ltcG9ydERhdGEnIHRvIGNvbnRlbnQgc2NyaXB0XHJcbiAgICAgICAgICAgIC8vIFNlbmRpbmcgbWVzc2FnZSAnaW1wb3J0RGF0YScgdG8gY29udGVudCBzY3JpcHRcclxuICAgICAgICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdpbXBvcnREYXRhJyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IGpzb24sXHJcbiAgICAgICAgICAgICAgICBhaUNvbmZpZzogYWlDb25maWdcclxuICAgICAgICAgICAgfSwgKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd1N0YXR1cygn4p2MIEVycm9yOiBSZWZyZXNoIHRoZSBwYWdlIGFuZCB0cnkgYWdhaW4nLCAnZXJyb3InKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1BvcHVwXSBEYXRhIGxvYWRlZDonLCByZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ2xvc2UgcG9wdXAgYWZ0ZXIgYSBkZWxheVxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxNTAwKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBzaG93U3RhdHVzKCfinYwgRmFpbGVkIHRvIHBhcnNlIEpTT046ICcgKyBlcnIubWVzc2FnZSwgJ2Vycm9yJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpO1xyXG5cclxuICAgIC8vIFJlc2V0IGZpbGUgaW5wdXRcclxuICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBmZXRjaEFJQ29uZmlnKCkge1xyXG4gICAgbGV0IGFpQ29uZmlnID0gbnVsbDtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tQb3B1cF0gRmV0Y2hpbmcgQUkgc2V0dGluZ3MuIEF1dGggVXNlcjonLCBhdXRoLmN1cnJlbnRVc2VyID8gYXV0aC5jdXJyZW50VXNlci51aWQgOiAnbnVsbCcpO1xyXG4gICAgICAgIGNvbnN0IHsgZGIgfSA9IGF3YWl0IGltcG9ydCgnLi9maXJlYmFzZUNvbmZpZy5qcycpO1xyXG4gICAgICAgIGNvbnN0IHsgZG9jLCBnZXREb2MgfSA9IGF3YWl0IGltcG9ydCgnZmlyZWJhc2UvZmlyZXN0b3JlJyk7XHJcbiAgICAgICAgY29uc3QgZG9jUmVmID0gZG9jKGRiLCBcInNldHRpbmdzXCIsIFwiY29uZmlnXCIpO1xyXG4gICAgICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBnZXREb2MoZG9jUmVmKTtcclxuXHJcbiAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHtcclxuICAgICAgICAgICAgYWlDb25maWcgPSBkb2NTbmFwLmRhdGEoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tQb3B1cF0g4pqg77iPIE5vIEFJIHNldHRpbmdzIGZvdW5kLicpO1xyXG4gICAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tQb3B1cF0g4p2MIEVycm9yIGZldGNoaW5nIEFJIHNldHRpbmdzOicsIGVycik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYWlDb25maWc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNob3dTdGF0dXModGV4dCwgdHlwZSkge1xyXG4gICAgY29uc3Qgc3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1cycpO1xyXG4gICAgc3RhdHVzLnRleHRDb250ZW50ID0gdGV4dDtcclxuICAgIHN0YXR1cy5jbGFzc05hbWUgPSAnc3RhdHVzIHNob3cgJyArIHR5cGU7XHJcbn1cclxuXHJcbi8vIENhbGwgaW5pdCBmdW5jdGlvbnMgb25seSB3aGVuIGxvZ2dlZCBpblxyXG5mdW5jdGlvbiBpbml0QXBwKCkge1xyXG4gICAgY2hlY2tJZk9uRmFjZWJvb2soKTtcclxuICAgIGNoZWNrRm9yRXhpc3RpbmdBbmFseXNpcygpO1xyXG59XHJcblxyXG4vLyBIb29rIGluaXRBcHAgaW50byBzaG93TWFpbkNvbnRlbnRcclxuY29uc3Qgb3JpZ2luYWxTaG93TWFpbkNvbnRlbnQgPSBzaG93TWFpbkNvbnRlbnQ7XHJcbnNob3dNYWluQ29udGVudCA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICBvcmlnaW5hbFNob3dNYWluQ29udGVudCh1c2VyKTtcclxuICAgIGluaXRBcHAoKTtcclxufTsiXSwiZmlsZSI6ImFzc2V0cy9wb3B1cC13LVdyU1lEUS5qcyJ9