console.log("[FB Ads Analyzer] Background script loaded");
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "analyzeAI") {
    handleAIAnalysis(request, sendResponse);
    return true;
  }
});
const CLOUD_FUNCTION_URL = "https://us-central1-fb-ads-analyzer.cloudfunctions.net/analyzeAds";
async function handleAIAnalysis(request, sendResponse) {
  try {
    console.log("[Background] Starting AI Analysis via Cloud Function...");
    const { systemPrompt, userContent } = request.payload;
    const storage = await chrome.storage.local.get("fbAdsIdToken");
    const token = storage.fbAdsIdToken;
    if (!token) {
      throw new Error("User not authenticated. Please open the extension popup to refresh login.");
    }
    const response = await fetch(CLOUD_FUNCTION_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify({
        systemPrompt,
        userContent
      })
    });
    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(`Server Error: ${response.status} - ${errorText}`);
    }
    const data = await response.json();
    if (data.error) {
      throw new Error(data.error);
    }
    console.log("[Background] AI Analysis successful");
    sendResponse({ success: true, analysis: data.analysis });
  } catch (error) {
    console.error("[Background] AI Analysis failed:", error);
    sendResponse({ success: false, error: error.message });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2dyb3VuZC5qcy1JN3NzaEVhTS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2JhY2tncm91bmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQmFja2dyb3VuZCBTZXJ2aWNlIFdvcmtlclxyXG5jb25zb2xlLmxvZygnW0ZCIEFkcyBBbmFseXplcl0gQmFja2dyb3VuZCBzY3JpcHQgbG9hZGVkJyk7XHJcblxyXG5jaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKHJlcXVlc3QsIHNlbmRlciwgc2VuZFJlc3BvbnNlKSA9PiB7XHJcbiAgICBpZiAocmVxdWVzdC5hY3Rpb24gPT09ICdhbmFseXplQUknKSB7XHJcbiAgICAgICAgaGFuZGxlQUlBbmFseXNpcyhyZXF1ZXN0LCBzZW5kUmVzcG9uc2UpO1xyXG4gICAgICAgIHJldHVybiB0cnVlOyAvLyBLZWVwIG1lc3NhZ2UgY2hhbm5lbCBvcGVuIGZvciBhc3luYyByZXNwb25zZVxyXG4gICAgfVxyXG59KTtcclxuXHJcbi8vIFRPRE86IFJlcGxhY2Ugd2l0aCB5b3VyIGFjdHVhbCBDbG91ZCBGdW5jdGlvbiBVUkwgYWZ0ZXIgZGVwbG95bWVudFxyXG4vLyBFeGFtcGxlOiBodHRwczovL3VzLWNlbnRyYWwxLWZiLWFkcy1hbmFseXplci5jbG91ZGZ1bmN0aW9ucy5uZXQvYW5hbHl6ZUFkc1xyXG5jb25zdCBDTE9VRF9GVU5DVElPTl9VUkwgPSAnaHR0cHM6Ly91cy1jZW50cmFsMS1mYi1hZHMtYW5hbHl6ZXIuY2xvdWRmdW5jdGlvbnMubmV0L2FuYWx5emVBZHMnO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlQUlBbmFseXNpcyhyZXF1ZXN0LCBzZW5kUmVzcG9uc2UpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tCYWNrZ3JvdW5kXSBTdGFydGluZyBBSSBBbmFseXNpcyB2aWEgQ2xvdWQgRnVuY3Rpb24uLi4nKTtcclxuICAgICAgICBjb25zdCB7IHN5c3RlbVByb21wdCwgdXNlckNvbnRlbnQgfSA9IHJlcXVlc3QucGF5bG9hZDtcclxuXHJcbiAgICAgICAgLy8gR2V0IEF1dGggVG9rZW5cclxuICAgICAgICBjb25zdCBzdG9yYWdlID0gYXdhaXQgY2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KCdmYkFkc0lkVG9rZW4nKTtcclxuICAgICAgICBjb25zdCB0b2tlbiA9IHN0b3JhZ2UuZmJBZHNJZFRva2VuO1xyXG5cclxuICAgICAgICBpZiAoIXRva2VuKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgYXV0aGVudGljYXRlZC4gUGxlYXNlIG9wZW4gdGhlIGV4dGVuc2lvbiBwb3B1cCB0byByZWZyZXNoIGxvZ2luLicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChDTE9VRF9GVU5DVElPTl9VUkwsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0b2tlbn1gXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgIHN5c3RlbVByb21wdCxcclxuICAgICAgICAgICAgICAgIHVzZXJDb250ZW50XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlcnZlciBFcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9IC0gJHtlcnJvclRleHR9YCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG5cclxuICAgICAgICBpZiAoZGF0YS5lcnJvcikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnW0JhY2tncm91bmRdIEFJIEFuYWx5c2lzIHN1Y2Nlc3NmdWwnKTtcclxuICAgICAgICBzZW5kUmVzcG9uc2UoeyBzdWNjZXNzOiB0cnVlLCBhbmFseXNpczogZGF0YS5hbmFseXNpcyB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tCYWNrZ3JvdW5kXSBBSSBBbmFseXNpcyBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICAgIHNlbmRSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgIH1cclxufVxyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsUUFBUSxJQUFJLDRDQUE0QztBQUV4RCxPQUFPLFFBQVEsVUFBVSxZQUFZLENBQUMsU0FBUyxRQUFRLGlCQUFpQjtBQUNwRSxNQUFJLFFBQVEsV0FBVyxhQUFhO0FBQ2hDLHFCQUFpQixTQUFTLFlBQVk7QUFDdEMsV0FBTztBQUFBLEVBQ1g7QUFDSixDQUFDO0FBSUQsTUFBTSxxQkFBcUI7QUFFM0IsZUFBZSxpQkFBaUIsU0FBUyxjQUFjO0FBQ25ELE1BQUk7QUFDQSxZQUFRLElBQUkseURBQXlEO0FBQ3JFLFVBQU0sRUFBRSxjQUFjLGdCQUFnQixRQUFRO0FBRzlDLFVBQU0sVUFBVSxNQUFNLE9BQU8sUUFBUSxNQUFNLElBQUksY0FBYztBQUM3RCxVQUFNLFFBQVEsUUFBUTtBQUV0QixRQUFJLENBQUMsT0FBTztBQUNSLFlBQU0sSUFBSSxNQUFNLDJFQUEyRTtBQUFBLElBQy9GO0FBRUEsVUFBTSxXQUFXLE1BQU0sTUFBTSxvQkFBb0I7QUFBQSxNQUM3QyxRQUFRO0FBQUEsTUFDUixTQUFTO0FBQUEsUUFDTCxnQkFBZ0I7QUFBQSxRQUNoQixpQkFBaUIsVUFBVSxLQUFLO0FBQUEsTUFDaEQ7QUFBQSxNQUNZLE1BQU0sS0FBSyxVQUFVO0FBQUEsUUFDakI7QUFBQSxRQUNBO0FBQUEsTUFDaEIsQ0FBYTtBQUFBLElBQ2IsQ0FBUztBQUVELFFBQUksQ0FBQyxTQUFTLElBQUk7QUFDZCxZQUFNLFlBQVksTUFBTSxTQUFTO0FBQ2pDLFlBQU0sSUFBSSxNQUFNLGlCQUFpQixTQUFTLE1BQU0sTUFBTSxTQUFTLEVBQUU7QUFBQSxJQUNyRTtBQUVBLFVBQU0sT0FBTyxNQUFNLFNBQVM7QUFFNUIsUUFBSSxLQUFLLE9BQU87QUFDWixZQUFNLElBQUksTUFBTSxLQUFLLEtBQUs7QUFBQSxJQUM5QjtBQUVBLFlBQVEsSUFBSSxxQ0FBcUM7QUFDakQsaUJBQWEsRUFBRSxTQUFTLE1BQU0sVUFBVSxLQUFLLFNBQVEsQ0FBRTtBQUFBLEVBRTNELFNBQVMsT0FBTztBQUNaLFlBQVEsTUFBTSxvQ0FBb0MsS0FBSztBQUN2RCxpQkFBYSxFQUFFLFNBQVMsT0FBTyxPQUFPLE1BQU0sUUFBTyxDQUFFO0FBQUEsRUFDekQ7QUFDSjsifQ==
